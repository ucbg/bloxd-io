/*! For license information please see 6feo6.882.e0bab467.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[882],{66973:function(Z,M,j){"use strict";var K=j(11138),b=j(21668),g=j(9603);j.g.__TYPEDARRAY_POOL||(j.g.__TYPEDARRAY_POOL={UINT8:b([32,0]),UINT16:b([32,0]),UINT32:b([32,0]),INT8:b([32,0]),INT16:b([32,0]),INT32:b([32,0]),FLOAT:b([32,0]),DOUBLE:b([32,0]),DATA:b([32,0]),UINT8C:b([32,0]),BUFFER:b([32,0])});var O="undefined"!==typeof Uint8ClampedArray,Q=j.g.__TYPEDARRAY_POOL;Q.UINT8C||(Q.UINT8C=b([32,0])),Q.BUFFER||(Q.BUFFER=b([32,0]));var Y=Q.DATA,I=Q.BUFFER;function E(Z){if(Z){var M=Z.length||Z.byteLength,j=K.log2(M);Y[j].push(Z)}}function s(Z){Z=K.nextPow2(Z);var M=K.log2(Z),j=Y[M];return j.length>0?j.pop():new ArrayBuffer(Z)}function i(Z){return new Uint8Array(s(Z),0,Z)}function a(Z){return new Uint16Array(s(2*Z),0,Z)}function z(Z){return new Uint32Array(s(4*Z),0,Z)}function V(Z){return new Int8Array(s(Z),0,Z)}function o(Z){return new Int16Array(s(2*Z),0,Z)}function c(Z){return new Int32Array(s(4*Z),0,Z)}function G(Z){return new Float32Array(s(4*Z),0,Z)}function f(Z){return new Float64Array(s(8*Z),0,Z)}function X(Z){return O?new Uint8ClampedArray(s(Z),0,Z):i(Z)}function d(Z){return new DataView(s(Z),0,Z)}M.free=function(Z){if(g(Z))I[K.log2(Z.length)].push(Z);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(Z)&&(Z=Z.buffer),!Z)return;var M=Z.length||Z.byteLength,j=0|K.log2(M);Y[j].push(Z)}},M.freeUint8=M.freeUint16=M.freeUint32=M.freeInt8=M.freeInt16=M.freeInt32=M.freeFloat32=M.freeFloat=M.freeFloat64=M.freeDouble=M.freeUint8Clamped=M.freeDataView=function(Z){E(Z.buffer)},M.freeArrayBuffer=E,M.freeBuffer=function(Z){I[K.log2(Z.length)].push(Z)},M.malloc=function(Z,M){if(void 0===M||"arraybuffer"===M)return s(Z);switch(M){case"uint8":return i(Z);case"uint16":return a(Z);case"uint32":return z(Z);case"int8":return V(Z);case"int16":return o(Z);case"int32":return c(Z);case"float":case"float32":return G(Z);case"double":case"float64":return f(Z);case"uint8_clamped":return X(Z);case"buffer":throw"Buffer not supported";case"data":case"dataview":return d(Z);default:return null}return null},M.mallocArrayBuffer=s,M.mallocUint8=i,M.mallocUint16=a,M.mallocUint32=z,M.mallocInt8=V,M.mallocInt16=o,M.mallocInt32=c,M.mallocFloat32=M.mallocFloat=G,M.mallocFloat64=M.mallocDouble=f,M.mallocUint8Clamped=X,M.mallocDataView=d,M.clearCache=function(){for(var Z=0;Z<32;++Z)Q.UINT8[Z].length=0,Q.UINT16[Z].length=0,Q.UINT32[Z].length=0,Q.INT8[Z].length=0,Q.INT16[Z].length=0,Q.INT32[Z].length=0,Q.FLOAT[Z].length=0,Q.DOUBLE[Z].length=0,Q.UINT8C[Z].length=0,Y[Z].length=0,I[Z].length=0}},97887:function(Z,M,j){Z.exports=b;var K=j(59344);function b(Z,M){if(!(this instanceof b))return new b(Z,M);var j=K.create();K.add(j,Z,M),this.base=K.min(K.create(),Z,j),this.vec=K.clone(M),this.max=K.max(K.create(),Z,j),this.mag=K.length(this.vec)}var g=b.prototype;g.width=function(){return this.vec[0]},g.height=function(){return this.vec[1]},g.depth=function(){return this.vec[2]},g.x0=function(){return this.base[0]},g.y0=function(){return this.base[1]},g.z0=function(){return this.base[2]},g.x1=function(){return this.max[0]},g.y1=function(){return this.max[1]},g.z1=function(){return this.max[2]},g.translate=function(Z){return K.add(this.max,this.max,Z),K.add(this.base,this.base,Z),this},g.setPosition=function(Z){return K.add(this.max,Z,this.vec),K.copy(this.base,Z),this},g.expand=function(Z){var M=K.create(),j=K.create();return K.max(M,Z.max,this.max),K.min(j,Z.base,this.base),K.subtract(M,M,j),new b(j,M)},g.intersects=function(Z){return!(Z.base[0]>this.max[0])&&(!(Z.base[1]>this.max[1])&&(!(Z.base[2]>this.max[2])&&(!(Z.max[0]<this.base[0])&&(!(Z.max[1]<this.base[1])&&!(Z.max[2]<this.base[2])))))},g.touches=function(Z){var M=this.union(Z);return null!==M&&(0==M.width()||0==M.height()||0==M.depth())},g.union=function(Z){if(!this.intersects(Z))return null;var M=Math.max(Z.base[0],this.base[0]),j=Math.max(Z.base[1],this.base[1]),K=Math.max(Z.base[2],this.base[2]);return new b([M,j,K],[Math.min(Z.max[0],this.max[0])-M,Math.min(Z.max[1],this.max[1])-j,Math.min(Z.max[2],this.max[2])-K])}},11138:function(Z,M){"use strict";function j(Z){var M=32;return(Z&=-Z)&&M--,65535&Z&&(M-=16),16711935&Z&&(M-=8),252645135&Z&&(M-=4),858993459&Z&&(M-=2),1431655765&Z&&(M-=1),M}M.INT_BITS=32,M.INT_MAX=2147483647,M.INT_MIN=-1<<31,M.sign=function(Z){return(Z>0)-(Z<0)},M.abs=function(Z){var M=Z>>31;return(Z^M)-M},M.min=function(Z,M){return M^(Z^M)&-(Z<M)},M.max=function(Z,M){return Z^(Z^M)&-(Z<M)},M.isPow2=function(Z){return!(Z&Z-1)&&!!Z},M.log2=function(Z){var M,j;return M=(Z>65535)<<4,M|=j=((Z>>>=M)>255)<<3,M|=j=((Z>>>=j)>15)<<2,(M|=j=((Z>>>=j)>3)<<1)|(Z>>>=j)>>1},M.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},M.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},M.countTrailingZeros=j,M.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},M.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},M.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var K=new Array(256);!function(Z){for(var M=0;M<256;++M){var j=M,K=M,b=7;for(j>>>=1;j;j>>>=1)K<<=1,K|=1&j,--b;Z[M]=K<<b&255}}(K),M.reverse=function(Z){return K[255&Z]<<24|K[Z>>>8&255]<<16|K[Z>>>16&255]<<8|K[Z>>>24&255]},M.interleave2=function(Z,M){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))<<1},M.deinterleave2=function(Z,M){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>M&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},M.interleave3=function(Z,M,j){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2))<<1)|(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<2},M.deinterleave3=function(Z,M){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>M&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},M.nextCombination=function(Z){var M=Z|Z-1;return M+1|(~M&-~M)-1>>>j(Z)+1}},49172:function(Z,M,j){"use strict";Z.exports=function(Z,M,j){switch(arguments.length){case 1:return s(Z);case 2:return"function"===typeof M?I(Z,Z,M,!0):i(Z,M);case 3:return I(Z,M,j,!1);default:throw new Error("box-intersect: Invalid arguments")}};var K,b=j(66973),g=j(63222),O=j(5841);function Q(Z,M){for(var j=0;j<Z;++j)if(!(M[j]<=M[j+Z]))return!0;return!1}function Y(Z,M,j,K){for(var b=0,g=0,O=0,Y=Z.length;O<Y;++O){var I=Z[O];if(!Q(M,I)){for(var E=0;E<2*M;++E)j[b++]=I[E];K[g++]=O}}return g}function I(Z,M,j,K){var Q=Z.length,I=M.length;if(!(Q<=0||I<=0)){var E=Z[0].length>>>1;if(!(E<=0)){var s,i=b.mallocDouble(2*E*Q),a=b.mallocInt32(Q);if((Q=Y(Z,E,i,a))>0){if(1===E&&K)g.init(Q),s=g.sweepComplete(E,j,0,Q,i,a,0,Q,i,a);else{var z=b.mallocDouble(2*E*I),V=b.mallocInt32(I);(I=Y(M,E,z,V))>0&&(g.init(Q+I),s=1===E?g.sweepBipartite(E,j,0,Q,i,a,0,I,z,V):O(E,j,K,Q,i,a,I,z,V),b.free(z),b.free(V))}b.free(i),b.free(a)}return s}}}function E(Z,M){K.push([Z,M])}function s(Z){return K=[],I(Z,Z,E,!0),K}function i(Z,M){return K=[],I(Z,M,E,!1),K}},51801:function(Z,M){"use strict";var j="d",K="ax",b="fp",g="es",O="rs",Q="re",Y="rb",I="bs",E="be",s="bb",i=[j,K,"vv",O,Q,Y,"ri",I,E,s,"bi"];function a(Z){var M="bruteForce"+(Z?"Full":"Partial"),K=[],O=i.slice();Z||O.splice(3,0,b);var Q=["function "+M+"("+O.join()+"){"];function Y(M,b){var O=function(Z,M,K){var b="bruteForce"+(Z?"Red":"Blue")+(M?"Flip":"")+(K?"Full":""),O=["function ",b,"(",i.join(),"){","var ",g,"=2*",j,";"],Q="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",Y="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(K?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return Z?O.push(Q,"Q",":",Y):O.push(Y,"Q",":",Q),K?O.push("if(y1<x0||x1<y0)continue;"):M?O.push("if(y0<=x0||x1<y0)continue;"):O.push("if(y0<x0||x1<y0)continue;"),O.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),M?O.push("yi,xi"):O.push("xi,yi"),O.push(");if(rv!==void 0)return rv;}}}"),{name:b,code:O.join("")}}(M,b,Z);K.push(O.code),Q.push("return "+O.name+"("+i.join()+");")}Q.push("if(re-rs>be-bs){"),Z?(Y(!0,!1),Q.push("}else{"),Y(!1,!1)):(Q.push("if(fp){"),Y(!0,!0),Q.push("}else{"),Y(!0,!1),Q.push("}}else{if(fp){"),Y(!1,!0),Q.push("}else{"),Y(!1,!1),Q.push("}")),Q.push("}}return "+M);var I=K.join("")+Q.join("");return new Function(I)()}M.partial=a(!1),M.full=a(!0)},5841:function(Z,M,j){"use strict";Z.exports=function(Z,M,j,g,E,W,A,q,T){!function(Z,M){var j=8*b.log2(M+1)*(Z+1)|0,g=b.nextPow2(6*j);c.length<g&&(K.free(c),c=K.mallocInt32(g));var O=b.nextPow2(2*j);G.length<O&&(K.free(G),G=K.mallocDouble(O))}(Z,g+A);var B,N=0,U=2*Z;f(N++,0,0,g,0,A,j?16:0,-1/0,1/0),j||f(N++,0,0,A,0,g,1,-1/0,1/0);for(;N>0;){var n=6*(N-=1),k=c[n],x=c[n+1],R=c[n+2],e=c[n+3],u=c[n+4],F=c[n+5],C=2*N,y=G[C],S=G[C+1],h=1&F,w=!!(16&F),p=E,m=W,J=q,P=T;if(h&&(p=q,m=T,J=E,P=W),!(2&F&&(R=a(Z,k,x,R,p,m,S),x>=R))&&!(4&F&&(x=z(Z,k,x,R,p,m,y))>=R)){var H=R-x,D=u-e;if(w){if(Z*H*(H+D)<4194304){if(void 0!==(B=Y.scanComplete(Z,k,M,x,R,p,m,e,u,J,P)))return B;continue}}else{if(Z*Math.min(H,D)<128){if(void 0!==(B=O(Z,k,M,h,x,R,p,m,e,u,J,P)))return B;continue}if(Z*H*D<4194304){if(void 0!==(B=Y.scanBipartite(Z,k,M,h,x,R,p,m,e,u,J,P)))return B;continue}}var l=s(Z,k,x,R,p,m,y,S);if(x<l)if(Z*(l-x)<128){if(void 0!==(B=Q(Z,k+1,M,x,l,p,m,e,u,J,P)))return B}else if(k===Z-2){if(void 0!==(B=h?Y.sweepBipartite(Z,M,e,u,J,P,x,l,p,m):Y.sweepBipartite(Z,M,x,l,p,m,e,u,J,P)))return B}else f(N++,k+1,x,l,e,u,h,-1/0,1/0),f(N++,k+1,e,u,x,l,1^h,-1/0,1/0);if(l<R){var t=I(Z,k,e,u,J,P),v=J[U*t+k],r=i(Z,k,t,u,J,P,v);if(r<u&&f(N++,k,l,R,r,u,(4|h)+(w?16:0),v,S),e<t&&f(N++,k,l,R,e,t,(2|h)+(w?16:0),y,v),t+1===r){if(void 0!==(B=w?d(Z,k,M,l,R,p,m,t,J,P[t]):X(Z,k,M,h,l,R,p,m,t,J,P[t])))return B}else if(t<r){var L;if(w){if(L=V(Z,k,l,R,p,m,v),l<L){var ZZ=i(Z,k,l,L,p,m,v);if(k===Z-2){if(l<ZZ&&void 0!==(B=Y.sweepComplete(Z,M,l,ZZ,p,m,t,r,J,P)))return B;if(ZZ<L&&void 0!==(B=Y.sweepBipartite(Z,M,ZZ,L,p,m,t,r,J,P)))return B}else l<ZZ&&f(N++,k+1,l,ZZ,t,r,16,-1/0,1/0),ZZ<L&&(f(N++,k+1,ZZ,L,t,r,0,-1/0,1/0),f(N++,k+1,t,r,ZZ,L,1,-1/0,1/0))}}else L=h?o(Z,k,l,R,p,m,v):V(Z,k,l,R,p,m,v),l<L&&(k===Z-2?B=h?Y.sweepBipartite(Z,M,t,r,J,P,l,L,p,m):Y.sweepBipartite(Z,M,l,L,p,m,t,r,J,P):(f(N++,k+1,l,L,t,r,h,-1/0,1/0),f(N++,k+1,t,r,l,L,1^h,-1/0,1/0)))}}}}};var K=j(66973),b=j(11138),g=j(51801),O=g.partial,Q=g.full,Y=j(63222),I=j(62299),E=j(21424),s=E("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),i=E("lo===p0",["p0"]),a=E("lo<p0",["p0"]),z=E("hi<=p0",["p0"]),V=E("lo<=p0&&p0<=hi",["p0"]),o=E("lo<p0&&p0<=hi",["p0"]),c=K.mallocInt32(1024),G=K.mallocDouble(1024);function f(Z,M,j,K,b,g,O,Q,Y){var I=6*Z;c[I]=M,c[I+1]=j,c[I+2]=K,c[I+3]=b,c[I+4]=g,c[I+5]=O;var E=2*Z;G[E]=Q,G[E+1]=Y}function X(Z,M,j,K,b,g,O,Q,Y,I,E){var s=2*Z,i=Y*s,a=I[i+M];Z:for(var z=b,V=b*s;z<g;++z,V+=s){var o=O[V+M],c=O[V+M+Z];if(!(a<o||c<a)&&(!K||a!==o)){for(var G,f=Q[z],X=M+1;X<Z;++X){o=O[V+X],c=O[V+X+Z];var d=I[i+X],W=I[i+X+Z];if(c<d||W<o)continue Z}if(void 0!==(G=K?j(E,f):j(f,E)))return G}}}function d(Z,M,j,K,b,g,O,Q,Y,I){var E=2*Z,s=Q*E,i=Y[s+M];Z:for(var a=K,z=K*E;a<b;++a,z+=E){var V=O[a];if(V!==I){var o=g[z+M],c=g[z+M+Z];if(!(i<o||c<i)){for(var G=M+1;G<Z;++G){o=g[z+G],c=g[z+G+Z];var f=Y[s+G],X=Y[s+G+Z];if(c<f||X<o)continue Z}var d=j(V,I);if(void 0!==d)return d}}}}},62299:function(Z,M,j){"use strict";Z.exports=function(Z,M,j,g,O,Q){if(g<=j+1)return j;var Y=j,I=g,E=g+j>>>1,s=2*Z,i=E,a=O[s*E+M];for(;Y<I;){if(I-Y<8){b(Z,M,Y,I,O,Q),a=O[s*E+M];break}var z=I-Y,V=Math.random()*z+Y|0,o=O[s*V+M],c=Math.random()*z+Y|0,G=O[s*c+M],f=Math.random()*z+Y|0,X=O[s*f+M];o<=G?X>=G?(i=c,a=G):o>=X?(i=V,a=o):(i=f,a=X):G>=X?(i=c,a=G):X>=o?(i=V,a=o):(i=f,a=X);for(var d=s*(I-1),W=s*i,A=0;A<s;++A,++d,++W){var q=O[d];O[d]=O[W],O[W]=q}var T=Q[I-1];Q[I-1]=Q[i],Q[i]=T,i=K(Z,M,Y,I-1,O,Q,a);for(d=s*(I-1),W=s*i,A=0;A<s;++A,++d,++W){q=O[d];O[d]=O[W],O[W]=q}T=Q[I-1];if(Q[I-1]=Q[i],Q[i]=T,E<i){for(I=i-1;Y<I&&O[s*(I-1)+M]===a;)I-=1;I+=1}else{if(!(i<E))break;for(Y=i+1;Y<I&&O[s*Y+M]===a;)Y+=1}}return K(Z,M,j,E,O,Q,O[s*E+M])};var K=j(21424)("lo<p0",["p0"]);function b(Z,M,j,K,b,g){for(var O=2*Z,Q=O*(j+1)+M,Y=j+1;Y<K;++Y,Q+=O)for(var I=b[Q],E=Y,s=O*(Y-1);E>j&&b[s+M]>I;--E,s-=O){for(var i=s,a=s+O,z=0;z<O;++z,++i,++a){var V=b[i];b[i]=b[a],b[a]=V}var o=g[E];g[E]=g[E-1],g[E-1]=o}}},21424:function(Z){"use strict";Z.exports=function(Z,M){var j="abcdef".split("").concat(M),K=[];Z.indexOf("lo")>=0&&K.push("lo=e[k+n]");Z.indexOf("hi")>=0&&K.push("hi=e[k+o]");return j.push("for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m".replace("_",K.join()).replace("$",Z)),Function.apply(void 0,j)}},42693:function(Z){"use strict";Z.exports=function(Z,j){j<=128?M(0,j-1,Z):Y(0,j-1,Z)};function M(Z,M,j){for(var K=2*(Z+1),b=Z+1;b<=M;++b){for(var g=j[K++],O=j[K++],Q=b,Y=K-2;Q-- >Z;){var I=j[Y-2],E=j[Y-1];if(I<g)break;if(I===g&&E<O)break;j[Y]=I,j[Y+1]=E,Y-=2}j[Y]=g,j[Y+1]=O}}function j(Z,M,j){M*=2;var K=j[Z*=2],b=j[Z+1];j[Z]=j[M],j[Z+1]=j[M+1],j[M]=K,j[M+1]=b}function K(Z,M,j){M*=2,j[Z*=2]=j[M],j[Z+1]=j[M+1]}function b(Z,M,j,K){M*=2,j*=2;var b=K[Z*=2],g=K[Z+1];K[Z]=K[M],K[Z+1]=K[M+1],K[M]=K[j],K[M+1]=K[j+1],K[j]=b,K[j+1]=g}function g(Z,M,j,K,b){M*=2,b[Z*=2]=b[M],b[M]=j,b[Z+1]=b[M+1],b[M+1]=K}function O(Z,M,j){M*=2;var K=j[Z*=2],b=j[M];return!(K<b)&&(K!==b||j[Z+1]>j[M+1])}function Q(Z,M,j,K){var b=K[Z*=2];return b<M||b===M&&K[Z+1]<j}function Y(Z,I,E){var s=(I-Z+1)/6|0,i=Z+s,a=I-s,z=Z+I>>1,V=z-s,o=z+s,c=i,G=V,f=z,X=o,d=a,W=Z+1,A=I-1,q=0;O(c,G,E)&&(q=c,c=G,G=q),O(X,d,E)&&(q=X,X=d,d=q),O(c,f,E)&&(q=c,c=f,f=q),O(G,f,E)&&(q=G,G=f,f=q),O(c,X,E)&&(q=c,c=X,X=q),O(f,X,E)&&(q=f,f=X,X=q),O(G,d,E)&&(q=G,G=d,d=q),O(G,f,E)&&(q=G,G=f,f=q),O(X,d,E)&&(q=X,X=d,d=q);for(var T=E[2*G],B=E[2*G+1],N=E[2*X],U=E[2*X+1],n=2*c,k=2*f,x=2*d,R=2*i,e=2*z,u=2*a,F=0;F<2;++F){var C=E[n+F],y=E[k+F],S=E[x+F];E[R+F]=C,E[e+F]=y,E[u+F]=S}K(V,Z,E),K(o,I,E);for(var h=W;h<=A;++h)if(Q(h,T,B,E))h!==W&&j(h,W,E),++W;else if(!Q(h,N,U,E))for(;;){if(Q(A,N,U,E)){Q(A,T,B,E)?(b(h,W,A,E),++W,--A):(j(h,A,E),--A);break}if(--A<h)break}g(Z,W-1,T,B,E),g(I,A+1,N,U,E),W-2-Z<=32?M(Z,W-2,E):Y(Z,W-2,E),I-(A+2)<=32?M(A+2,I,E):Y(A+2,I,E),A-W<=32?M(W,A,E):Y(W,A,E)}},63222:function(Z,M,j){"use strict";Z.exports={init:function(Z){var M=b.nextPow2(Z);Y.length<M&&(K.free(Y),Y=K.mallocInt32(M));I.length<M&&(K.free(I),I=K.mallocInt32(M));E.length<M&&(K.free(E),E=K.mallocInt32(M));s.length<M&&(K.free(s),s=K.mallocInt32(M));i.length<M&&(K.free(i),i=K.mallocInt32(M));a.length<M&&(K.free(a),a=K.mallocInt32(M));var j=8*M;z.length<j&&(K.free(z),z=K.mallocDouble(j))},sweepBipartite:function(Z,M,j,K,b,Q,i,a,c,G){for(var f=0,X=2*Z,d=Z-1,W=X-1,A=j;A<K;++A){var q=Q[A],T=X*A;z[f++]=b[T+d],z[f++]=-(q+1),z[f++]=b[T+W],z[f++]=q}for(A=i;A<a;++A){q=G[A]+O;var B=X*A;z[f++]=c[B+d],z[f++]=-q,z[f++]=c[B+W],z[f++]=q}var N=f>>>1;g(z,N);var U=0,n=0;for(A=0;A<N;++A){var k=0|z[2*A+1];if(k>=O)V(E,s,n--,k=k-O|0);else if(k>=0)V(Y,I,U--,k);else if(k<=-268435456){k=-k-O|0;for(var x=0;x<U;++x){if(void 0!==(R=M(Y[x],k)))return R}o(E,s,n++,k)}else{k=-k-1|0;for(x=0;x<n;++x){var R;if(void 0!==(R=M(k,E[x])))return R}o(Y,I,U++,k)}}},sweepComplete:function(Z,M,j,K,b,O,Q,c,G,f){for(var X=0,d=2*Z,W=Z-1,A=d-1,q=j;q<K;++q){var T=O[q]+1<<1,B=d*q;z[X++]=b[B+W],z[X++]=-T,z[X++]=b[B+A],z[X++]=T}for(q=Q;q<c;++q){T=f[q]+1<<1;var N=d*q;z[X++]=G[N+W],z[X++]=1|-T,z[X++]=G[N+A],z[X++]=1|T}var U=X>>>1;g(z,U);var n=0,k=0,x=0;for(q=0;q<U;++q){var R=0|z[2*q+1],e=1&R;if(q<U-1&&R>>1===z[2*q+3]>>1&&(e=2,q+=1),R<0){for(var u=-(R>>1)-1,F=0;F<x;++F){if(void 0!==(C=M(i[F],u)))return C}if(0!==e)for(F=0;F<n;++F){if(void 0!==(C=M(Y[F],u)))return C}if(1!==e)for(F=0;F<k;++F){var C;if(void 0!==(C=M(E[F],u)))return C}0===e?o(Y,I,n++,u):1===e?o(E,s,k++,u):2===e&&o(i,a,x++,u)}else{u=(R>>1)-1;0===e?V(Y,I,n--,u):1===e?V(E,s,k--,u):2===e&&V(i,a,x--,u)}}},scanBipartite:function(Z,M,j,K,b,Q,E,s,i,a,c,G){var f=0,X=2*Z,d=M,W=M+Z,A=1,q=1;K?q=O:A=O;for(var T=b;T<Q;++T){var B=T+A,N=X*T;z[f++]=E[N+d],z[f++]=-B,z[f++]=E[N+W],z[f++]=B}for(T=i;T<a;++T){B=T+q;var U=X*T;z[f++]=c[U+d],z[f++]=-B}var n=f>>>1;g(z,n);var k=0;for(T=0;T<n;++T){var x=0|z[2*T+1];if(x<0){var R=!1;if((B=-x)>=O?(R=!K,B-=O):(R=!!K,B-=1),R)o(Y,I,k++,B);else{var e=G[B],u=X*B,F=c[u+M+1],C=c[u+M+1+Z];Z:for(var y=0;y<k;++y){var S=Y[y],h=X*S;if(!(C<E[h+M+1]||E[h+M+1+Z]<F)){for(var w=M+2;w<Z;++w)if(c[u+w+Z]<E[h+w]||E[h+w+Z]<c[u+w])continue Z;var p,m=s[S];if(void 0!==(p=K?j(e,m):j(m,e)))return p}}}}else V(Y,I,k--,x-A)}},scanComplete:function(Z,M,j,K,b,Q,I,E,s,i,a){for(var V=0,o=2*Z,c=M,G=M+Z,f=K;f<b;++f){var X=f+O,d=o*f;z[V++]=Q[d+c],z[V++]=-X,z[V++]=Q[d+G],z[V++]=X}for(f=E;f<s;++f){X=f+1;var W=o*f;z[V++]=i[W+c],z[V++]=-X}var A=V>>>1;g(z,A);var q=0;for(f=0;f<A;++f){var T=0|z[2*f+1];if(T<0){if((X=-T)>=O)Y[q++]=X-O;else{var B=a[X-=1],N=o*X,U=i[N+M+1],n=i[N+M+1+Z];Z:for(var k=0;k<q;++k){var x=Y[k],R=I[x];if(R===B)break;var e=o*x;if(!(n<Q[e+M+1]||Q[e+M+1+Z]<U)){for(var u=M+2;u<Z;++u)if(i[N+u+Z]<Q[e+u]||Q[e+u+Z]<i[N+u])continue Z;var F=j(R,B);if(void 0!==F)return F}}}}else{for(X=T-O,k=q-1;k>=0;--k)if(Y[k]===X){for(u=k+1;u<q;++u)Y[u-1]=Y[u];break}--q}}}};var K=j(66973),b=j(11138),g=j(42693),O=1<<28,Q=1024,Y=K.mallocInt32(Q),I=K.mallocInt32(Q),E=K.mallocInt32(Q),s=K.mallocInt32(Q),i=K.mallocInt32(Q),a=K.mallocInt32(Q),z=K.mallocDouble(8192);function V(Z,M,j,K){var b=M[K],g=Z[j-1];Z[b]=g,M[g]=b}function o(Z,M,j,K){Z[j]=K,M[K]=j}},21668:function(Z){"use strict";function M(Z,j,K){var b=0|Z[K];if(b<=0)return[];var g,O=new Array(b);if(K===Z.length-1)for(g=0;g<b;++g)O[g]=j;else for(g=0;g<b;++g)O[g]=M(Z,j,K+1);return O}Z.exports=function(Z,j){switch("undefined"===typeof j&&(j=0),typeof Z){case"number":if(Z>0)return function(Z,M){var j,K;for(j=new Array(Z),K=0;K<Z;++K)j[K]=M;return j}(0|Z,j);break;case"object":if("number"===typeof Z.length)return M(Z,j,0)}return[]}},65532:function(Z,M,j){Z.exports=function(){var Z=this;this.components={},this.comps=this.components;var M=this.components,j=1,b={},g=[],O=[],Q={timeout:!1,removals:[],multiComps:[]};function Y(Z,j){var K=M[j],g=b[j],O=g.hash[Z];O&&(g.remove(Z),K.onRemove&&(K.multi?(O.forEach((function(M){M&&K.onRemove(Z,M)})),O.length=0):K.onRemove(Z,O)),Q.removals.push(g),I())}function I(){Q.timeout||(Q.timeout=!0,setTimeout(E,1))}function E(){Q.timeout=!1,s()}function s(){Q.multiComps.length&&function(Z){for(var M=0;M<Z.length;M++){var j=Z[M],K=j.entID,b=j.data,g=b.hash[K];if(g){for(var O=0;O<g.length;O++)g[O]||(g.splice(O,1),O--);0===g.length&&(b.remove(K),Q.removals.push(b))}}Z.length=0}(Q.multiComps),Q.removals.length&&function(Z){for(var M=0;M<Z.length;M++){Z[M].flush()}Z.length=0}(Q.removals)}this._storage=b,this._systems=g,this._renderSystems=O,this.createEntity=function(M){var K=j++;return Array.isArray(M)&&M.forEach((function(M){return Z.addComponent(K,M)})),K},this.deleteEntity=function(M){return Object.keys(b).forEach((function(Z){b[Z].hash[M]&&Y(M,Z)})),Z},this.createComponent=function(Z){if(!Z)throw new Error("Missing component definition");var j=Z.name;if(!j)throw new Error("Component definition must have a name property.");if("string"!==typeof j)throw new Error("Component name must be a string.");if(""===j)throw new Error("Component name must be a non-empty string.");if(b[j])throw new Error("Component ".concat(j," already exists."));var Q={};return Q.name=j,Q.multi=!!Z.multi,Q.order=isNaN(Z.order)?99:Z.order,Q.stateConstructor=Z.stateConstructor||null,Q.state=Z.state||{},Q.onAdd=Z.onAdd||null,Q.onRemove=Z.onRemove||null,Q.system=Z.system||null,Q.renderSystem=Z.renderSystem||null,M[j]=Q,b[j]=new K,b[j]._pendingMultiCleanup=!1,b[j]._multiCleanupIDs=Q.multi?[]:null,Q.system&&(g.push(j),g.sort((function(Z,j){return M[Z].order-M[j].order}))),Q.renderSystem&&(O.push(j),O.sort((function(Z,j){return M[Z].order-M[j].order}))),j},this.overwriteComponent=function(Z,j){var K=M[Z];if(!K)throw new Error("Unknown component: ".concat(Z));if(!j)throw new Error("Missing component definition");if(K.name!==j.name)throw new Error("Overwriting component must use the same name property.");var Q={};Q.name=Z,Q.multi=!!j.multi,Q.order=isNaN(j.order)?99:j.order,Q.state=j.state||{},Q.onAdd=j.onAdd||null,Q.onRemove=j.onRemove||null,Q.system=j.system||null,Q.renderSystem=j.renderSystem||null,M[Z]=Q,b[Z]._pendingMultiCleanup=!1,b[Z]._multiCleanupIDs=Q.multi?[]:null;var Y=g.indexOf(Z);Q.system&&Y<0&&g.push(Z),!Q.system&&Y>=0&&g.splice(Y,1),g.sort((function(Z,j){return M[Z].order-M[j].order}));var I=O.indexOf(Z);Q.renderSystem&&I<0&&O.push(Z),!Q.renderSystem&&I>=0&&O.splice(I,1),O.sort((function(Z,j){return M[Z].order-M[j].order}));var E=Q.state;return this.getStatesList(Z).forEach((function(Z){for(var M in E)M in Z||(Z[M]=E[M]);Q.onAdd&&Q.onAdd(Z.__id,Z)})),Z},this.deleteComponent=function(j){var K=b[j];if(!K)throw new Error("Unknown component: ".concat(j));K.flush(),K.list.forEach((function(Z){Z&&Y(Z.__id||Z[0].__id,j)}));var Q=g.indexOf(j),I=O.indexOf(j);return Q>-1&&g.splice(Q,1),I>-1&&O.splice(I,1),b[j].dispose(),delete b[j],delete M[j],Z},this.addComponent=function(Z,j,K){var g,O=M[j],Q=b[j];if(!Q)throw new Error("Unknown component: ".concat(j,"."));if(Q.hash[Z]&&!O.multi)throw new Error("Entity ".concat(Z," already has component: ").concat(j,"."));if(O.stateConstructor){if(!(g=new O.stateConstructor).hasOwnProperty("__id"))throw new Error("Component ".concat(O.name," stateConstructor type does not have property __id"))}else g=Object.assign({},{__id:Z},O.state,K);if(g.__id=Z,O.multi){var Y=Q.hash[Z];Y||(Y=[],Q.add(Z,Y)),Y.push(g)}else Q.add(Z,g);return O.onAdd&&O.onAdd(Z,g),this},this.hasComponent=function(Z,M){var j=b[M];if(!j)throw new Error("Unknown component: ".concat(M,"."));return!!j.hash[Z]},this.removeComponent=function(M,j){if(!b[j])throw new Error("Unknown component: ".concat(j,"."));return Y(M,j),Z},this.getState=function(Z,M){var j=b[M];if(!j)throw new Error("Unknown component: ".concat(M,"."));return j.hash[Z]},this.getStatesList=function(Z){var M=b[Z];if(!M)throw new Error("Unknown component: ".concat(Z,"."));return s(),M.list},this.getStateAccessor=function(Z){if(!b[Z])throw new Error("Unknown component: ".concat(Z,"."));var M=b[Z].hash;return function(Z){return M[Z]}},this.getComponentAccessor=function(Z){if(!b[Z])throw new Error("Unknown component: ".concat(Z,"."));var M=b[Z].hash;return function(Z){return!!M[Z]}},this.tick=function(j){s();for(var K=0;K<g.length;K++){var O=g[K],Q=M[O],Y=b[O];Q.system(j,Y.list),s()}return Z},this.render=function(j){s();for(var K=0;K<O.length;K++){var g=O[K],Q=M[g],Y=b[g];Q.renderSystem(j,Y.list),s()}return Z},this.removeMultiComponent=function(j,K,g){var O=M[K],Y=b[K];if(!Y)throw new Error("Unknown component: ".concat(K,"."));if(!O.multi)throw new Error("removeMultiComponent called on non-multi component");return function(Z,M,j,K){var b=j.hash[Z];if(b){var g=b[K];g&&(b[K]=null,M.onRemove&&M.onRemove(Z,g),Q.multiComps.push({entID:Z,data:j}),I())}}(j,O,Y,g),Z}};var K=j(56707)},56707:function(Z,M,j){var K=j(56690).default,b=j(89728).default;function g(Z,M){var j=Z._map[M];if(delete Z.hash[M],delete Z._map[M],j===Z.list.length-1)Z.list.pop();else{var K=Z.list.pop();if(Z.list[j]=K,null===K||null===K[0]){var b=Z.list.length;for(var g in Z._map)if(Z._map[g]===b)return void(Z._map[g]=j)}else{var O=K.__id||K[0].__id;Z._map[O]=j}}}Z.exports=function(){"use strict";function Z(){K(this,Z),this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}return b(Z,[{key:"add",value:function(Z,M){if("number"===typeof this._map[Z]){var j=this._map[Z];this.hash[Z]=M,this.list[j]=M}else this._map[Z]=this.list.length,this.hash[Z]=M,this.list.push(M)}},{key:"remove",value:function(Z){var M=this._map[Z];this.hash[Z]=null,this.list[M]=null,this._pendingRemovals.push(Z)}},{key:"dispose",value:function(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}},{key:"flush",value:function(){for(var Z=0;Z<this._pendingRemovals.length;Z++){var M=this._pendingRemovals[Z];null===this.hash[M]&&g(this,M)}this._pendingRemovals.length=0}}]),Z}()},91330:function(Z){"use strict";var M,j="object"===typeof Reflect?Reflect:null,K=j&&"function"===typeof j.apply?j.apply:function(Z,M,j){return Function.prototype.apply.call(Z,M,j)};M=j&&"function"===typeof j.ownKeys?j.ownKeys:Object.getOwnPropertySymbols?function(Z){return Object.getOwnPropertyNames(Z).concat(Object.getOwnPropertySymbols(Z))}:function(Z){return Object.getOwnPropertyNames(Z)};var b=Number.isNaN||function(Z){return Z!==Z};function g(){g.init.call(this)}Z.exports=g,Z.exports.once=function(Z,M){return new Promise((function(j,K){function b(j){Z.removeListener(M,g),K(j)}function g(){"function"===typeof Z.removeListener&&Z.removeListener("error",b),j([].slice.call(arguments))}V(Z,M,g,{once:!0}),"error"!==M&&function(Z,M,j){"function"===typeof Z.on&&V(Z,"error",M,j)}(Z,b,{once:!0})}))},g.EventEmitter=g,g.prototype._events=void 0,g.prototype._eventsCount=0,g.prototype._maxListeners=void 0;var O=10;function Q(Z){if("function"!==typeof Z)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Z)}function Y(Z){return void 0===Z._maxListeners?g.defaultMaxListeners:Z._maxListeners}function I(Z,M,j,K){var b,g,O,I;if(Q(j),void 0===(g=Z._events)?(g=Z._events=Object.create(null),Z._eventsCount=0):(void 0!==g.newListener&&(Z.emit("newListener",M,j.listener?j.listener:j),g=Z._events),O=g[M]),void 0===O)O=g[M]=j,++Z._eventsCount;else if("function"===typeof O?O=g[M]=K?[j,O]:[O,j]:K?O.unshift(j):O.push(j),(b=Y(Z))>0&&O.length>b&&!O.warned){O.warned=!0;var E=new Error("Possible EventEmitter memory leak detected. "+O.length+" "+String(M)+" listeners added. Use emitter.setMaxListeners() to increase limit");E.name="MaxListenersExceededWarning",E.emitter=Z,E.type=M,E.count=O.length,I=E,console&&console.warn&&console.warn(I)}return Z}function E(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function s(Z,M,j){var K={fired:!1,wrapFn:void 0,target:Z,type:M,listener:j},b=E.bind(K);return b.listener=j,K.wrapFn=b,b}function i(Z,M,j){var K=Z._events;if(void 0===K)return[];var b=K[M];return void 0===b?[]:"function"===typeof b?j?[b.listener||b]:[b]:j?function(Z){for(var M=new Array(Z.length),j=0;j<M.length;++j)M[j]=Z[j].listener||Z[j];return M}(b):z(b,b.length)}function a(Z){var M=this._events;if(void 0!==M){var j=M[Z];if("function"===typeof j)return 1;if(void 0!==j)return j.length}return 0}function z(Z,M){for(var j=new Array(M),K=0;K<M;++K)j[K]=Z[K];return j}function V(Z,M,j,K){if("function"===typeof Z.on)K.once?Z.once(M,j):Z.on(M,j);else{if("function"!==typeof Z.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Z);Z.addEventListener(M,(function b(g){K.once&&Z.removeEventListener(M,b),j(g)}))}}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return O},set:function(Z){if("number"!==typeof Z||Z<0||b(Z))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Z+".");O=Z}}),g.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},g.prototype.setMaxListeners=function(Z){if("number"!==typeof Z||Z<0||b(Z))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Z+".");return this._maxListeners=Z,this},g.prototype.getMaxListeners=function(){return Y(this)},g.prototype.emit=function(Z){for(var M=[],j=1;j<arguments.length;j++)M.push(arguments[j]);var b="error"===Z,g=this._events;if(void 0!==g)b=b&&void 0===g.error;else if(!b)return!1;if(b){var O;if(M.length>0&&(O=M[0]),O instanceof Error)throw O;var Q=new Error("Unhandled error."+(O?" ("+O.message+")":""));throw Q.context=O,Q}var Y=g[Z];if(void 0===Y)return!1;if("function"===typeof Y)K(Y,this,M);else{var I=Y.length,E=z(Y,I);for(j=0;j<I;++j)K(E[j],this,M)}return!0},g.prototype.addListener=function(Z,M){return I(this,Z,M,!1)},g.prototype.on=g.prototype.addListener,g.prototype.prependListener=function(Z,M){return I(this,Z,M,!0)},g.prototype.once=function(Z,M){return Q(M),this.on(Z,s(this,Z,M)),this},g.prototype.prependOnceListener=function(Z,M){return Q(M),this.prependListener(Z,s(this,Z,M)),this},g.prototype.removeListener=function(Z,M){var j,K,b,g,O;if(Q(M),void 0===(K=this._events))return this;if(void 0===(j=K[Z]))return this;if(j===M||j.listener===M)0===--this._eventsCount?this._events=Object.create(null):(delete K[Z],K.removeListener&&this.emit("removeListener",Z,j.listener||M));else if("function"!==typeof j){for(b=-1,g=j.length-1;g>=0;g--)if(j[g]===M||j[g].listener===M){O=j[g].listener,b=g;break}if(b<0)return this;0===b?j.shift():function(Z,M){for(;M+1<Z.length;M++)Z[M]=Z[M+1];Z.pop()}(j,b),1===j.length&&(K[Z]=j[0]),void 0!==K.removeListener&&this.emit("removeListener",Z,O||M)}return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(Z){var M,j,K;if(void 0===(j=this._events))return this;if(void 0===j.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==j[Z]&&(0===--this._eventsCount?this._events=Object.create(null):delete j[Z]),this;if(0===arguments.length){var b,g=Object.keys(j);for(K=0;K<g.length;++K)"removeListener"!==(b=g[K])&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(M=j[Z]))this.removeListener(Z,M);else if(void 0!==M)for(K=M.length-1;K>=0;K--)this.removeListener(Z,M[K]);return this},g.prototype.listeners=function(Z){return i(this,Z,!0)},g.prototype.rawListeners=function(Z){return i(this,Z,!1)},g.listenerCount=function(Z,M){return"function"===typeof Z.listenerCount?Z.listenerCount(M):a.call(Z,M)},g.prototype.listenerCount=a,g.prototype.eventNames=function(){return this._eventsCount>0?M(this._events):[]}},30109:function(Z){"use strict";Z.exports=function(Z,M,j,K,b,g){var O=+M[0],Q=+M[1],Y=+M[2],I=+j[0],E=+j[1],s=+j[2],i=Math.sqrt(I*I+E*E+s*s);if(0===i)throw new Error("Can't raycast along a zero vector");return function(Z,M,j,K,b,g,O,Q,Y,I){for(var E=0,s=Math.floor,i=0|s(M),a=0|s(j),z=0|s(K),V=b>0?1:-1,o=g>0?1:-1,c=O>0?1:-1,G=Math.abs(1/b),f=Math.abs(1/g),X=Math.abs(1/O),d=G<1/0?G*(V>0?i+1-M:M-i):1/0,W=f<1/0?f*(o>0?a+1-j:j-a):1/0,A=X<1/0?X*(c>0?z+1-K:K-z):1/0,q=-1;E<=Q;){var T=Z(i,a,z);if(T)return Y&&(Y[0]=M+E*b,Y[1]=j+E*g,Y[2]=K+E*O),I&&(I[0]=I[1]=I[2]=0,0===q&&(I[0]=-V),1===q&&(I[1]=-o),2===q&&(I[2]=-c)),T;d<W?d<A?(i+=V,E=d,d+=G,q=0):(z+=c,E=A,A+=X,q=2):W<A?(a+=o,E=W,W+=f,q=1):(z+=c,E=A,A+=X,q=2)}return Y&&(Y[0]=M+E*b,Y[1]=j+E*g,Y[2]=K+E*O),I&&(I[0]=I[1]=I[2]=0),0}(Z,O,Q,Y,I/=i,E/=i,s/=i,K="undefined"===typeof K?64:+K,b,g)}},71870:function(Z,M,j){"use strict";j.d(M,{d:function(){return Q}});var K=j(15671),b=j(43144),g=j(91330);function O(){this.preventDefaults=!1,this.stopPropagation=!1,this.allowContextMenu=!1,this.disabled=!1}console.log("Here");var Q=function(){function Z(M,j){var b=this;(0,K.e)(this,Z),this.version="0.7.0";var Q=Object.assign({},new O,j||{});this.element=M||document,this.preventDefaults=!!Q.preventDefaults,this.stopPropagation=!!Q.stopPropagation,this.allowContextMenu=!!Q.allowContextMenu,this.disabled=!!Q.disabled,this.filterEvents=function(Z,M){return!0},this.down=new g.EventEmitter,this.up=new g.EventEmitter,this.state={},this.pointerState={dx:0,dy:0,scrollx:0,scrolly:0,scrollz:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?I(this):document.addEventListener("DOMContentLoaded",(function(Z){I(b)}),{once:!0})}return(0,b.b)(Z,[{key:"bind",value:function(Z){for(var M=this,j=arguments.length,K=new Array(j>1?j-1:0),b=1;b<j;b++)K[b-1]=arguments[b];K.forEach((function(j){var K=M._keyBindmap[j]||[];K.includes(Z)||(K.push(Z),M._keyBindmap[j]=K)})),this.state[Z]=!!this.state[Z],this.pressCount[Z]=this.pressCount[Z]||0,this.releaseCount[Z]=this.releaseCount[Z]||0}},{key:"unbind",value:function(Z){for(var M in this._keyBindmap){var j=this._keyBindmap[M],K=j.indexOf(Z);K>-1&&j.splice(K,1)}}},{key:"getBindings",value:function(){var Z={};for(var M in this._keyBindmap){this._keyBindmap[M].forEach((function(j){Z[j]=Z[j]||[],Z[j].push(M)}))}return Z}},{key:"tick",value:function(){Y(this.pointerState),Y(this.pressCount),Y(this.releaseCount)}}]),Z}();function Y(Z){for(var M in Z)Z[M]=0}function I(Z){window.addEventListener("keydown",o.bind(null,Z,!0),!1),window.addEventListener("keyup",o.bind(null,Z,!1),!1);var M={passive:!0};Z.element.addEventListener("touchstart",a.bind(void 0,Z),{passive:!1}),Z.element.addEventListener("touchend",V.bind(void 0,Z),M),Z.element.addEventListener("mousedown",c.bind(null,Z,!0),M),window.document.addEventListener("mouseup",c.bind(null,Z,!1),M),Z.element.addEventListener("touchmove",G.bind(null,Z),M),Z.element.addEventListener("mousemove",G.bind(null,Z),M),window.PointerEvent,Z.element.addEventListener("wheel",f.bind(null,Z),M),Z.element.addEventListener("contextmenu",X.bind(null,Z),!1),window.addEventListener("blur",d.bind(null,Z),!1)}var E=0,s=0,i=null;function a(Z,M){M.preventDefault(),z(M)}function z(Z){for(var M=!1,j=0;j<Z.touches.length;++j)if(Z.touches[j].identifier===i){M=!0;break}if(!M){var K=Z.changedTouches[0];E=K.clientX,s=K.clientY,i=K.identifier}}function V(Z,M){for(var j=M.changedTouches,K=0;K<j.length;++K)j[K].identifier===i&&(i=null)}function o(Z,M,j){W(j.code,M,Z,j)}function c(Z,M,j){if("pointerId"in j)if(M){if(null!==Z._touches.currID)return;Z._touches.currID=j.pointerId}else{if(Z._touches.currID!==j.pointerId)return;Z._touches.currID=null}return W("Mouse"+("button"in j?j.button+1:1),M,Z,j),!1}function G(Z,M){var j=M.movementX||M.mozMovementX||0,K=M.movementY||M.mozMovementY||0;if(M.touches&&0===(j|K)){var b=function(Z){z(Z);for(var M=0;M<Z.changedTouches.length;++M)if(Z.changedTouches[M].identifier==i){var j=Z.changedTouches[M],K=[j.clientX-E,j.clientY-s];return E=j.clientX,s=j.clientY,K}return console.error("Did not find touch id ".concat(i)),[0,0]}(M);j=b[0],K=b[1]}Z.pointerState.dx+=j,Z.pointerState.dy+=K}function f(Z,M){var j=1;switch(M.deltaMode){case 0:j=1;break;case 1:j=12;break;case 2:j=Z.element.clientHeight||window.innerHeight}Z.pointerState.scrollx+=(M.deltaX||0)*j,Z.pointerState.scrolly+=(M.deltaY||0)*j,Z.pointerState.scrollz+=(M.deltaZ||0)*j}function X(Z,M){if(!Z.allowContextMenu)return M.preventDefault(),!1}function d(Z){for(var M in Z._keyStates)Z._keyStates[M]&&(/^Mouse\d/.test(M)||W(M,!1,Z,{code:M,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:function(){},stopPropagation:function(){}}))}function W(Z,M,j,K){var b=j._keyBindmap[Z];b&&(A(j._keyStates[Z],M)&&(j._keyStates[Z]=M,b.forEach((function(Z){(!j.filterEvents||j.filterEvents(K,Z))&&function(Z,M,j,K){var b=M?j.pressCount:j.releaseCount;b[Z]=(b[Z]||0)+1;var g=j._bindPressCount[Z]||0;(g+=M?1:-1)<0&&(g=0);if(j._bindPressCount[Z]=g,A(j.state[Z],g)){j.state[Z]=g>0;var O=M?j.down:j.up;j.disabled||O.emit(Z,K)}}(Z,M,j,K)}))),"button"in K||(j.preventDefaults&&!K.defaultPrevented&&K.preventDefault(),j.stopPropagation&&K.stopPropagation()))}function A(Z,M){return Z?!M:M}},43128:function(Z){Z.exports=function(Z,M,j){return Z[0]=M[0]+j[0],Z[1]=M[1]+j[1],Z[2]=M[2]+j[2],Z}},86893:function(Z,M,j){Z.exports=function(Z,M){var j=K(Z[0],Z[1],Z[2]),O=K(M[0],M[1],M[2]);b(j,j),b(O,O);var Q=g(j,O);return Q>1?0:Math.acos(Q)};var K=j(9990),b=j(21363),g=j(37570)},78739:function(Z){Z.exports=function(Z,M){return Z[0]=Math.ceil(M[0]),Z[1]=Math.ceil(M[1]),Z[2]=Math.ceil(M[2]),Z}},24232:function(Z){Z.exports=function(Z){var M=new Float32Array(3);return M[0]=Z[0],M[1]=Z[1],M[2]=Z[2],M}},11940:function(Z){Z.exports=function(Z,M){return Z[0]=M[0],Z[1]=M[1],Z[2]=M[2],Z}},26313:function(Z){Z.exports=function(){var Z=new Float32Array(3);return Z[0]=0,Z[1]=0,Z[2]=0,Z}},39747:function(Z){Z.exports=function(Z,M,j){var K=M[0],b=M[1],g=M[2],O=j[0],Q=j[1],Y=j[2];return Z[0]=b*Y-g*Q,Z[1]=g*O-K*Y,Z[2]=K*Q-b*O,Z}},46223:function(Z,M,j){Z.exports=j(92e3)},92e3:function(Z){Z.exports=function(Z,M){var j=M[0]-Z[0],K=M[1]-Z[1],b=M[2]-Z[2];return Math.sqrt(j*j+K*K+b*b)}},24553:function(Z,M,j){Z.exports=j(24889)},24889:function(Z){Z.exports=function(Z,M,j){return Z[0]=M[0]/j[0],Z[1]=M[1]/j[1],Z[2]=M[2]/j[2],Z}},37570:function(Z){Z.exports=function(Z,M){return Z[0]*M[0]+Z[1]*M[1]+Z[2]*M[2]}},78294:function(Z){Z.exports=1e-6},46485:function(Z,M,j){Z.exports=function(Z,M){var j=Z[0],b=Z[1],g=Z[2],O=M[0],Q=M[1],Y=M[2];return Math.abs(j-O)<=K*Math.max(1,Math.abs(j),Math.abs(O))&&Math.abs(b-Q)<=K*Math.max(1,Math.abs(b),Math.abs(Q))&&Math.abs(g-Y)<=K*Math.max(1,Math.abs(g),Math.abs(Y))};var K=j(78294)},95388:function(Z){Z.exports=function(Z,M){return Z[0]===M[0]&&Z[1]===M[1]&&Z[2]===M[2]}},37598:function(Z){Z.exports=function(Z,M){return Z[0]=Math.floor(M[0]),Z[1]=Math.floor(M[1]),Z[2]=Math.floor(M[2]),Z}},45880:function(Z,M,j){Z.exports=function(Z,M,j,b,g,O){var Q,Y;M||(M=3);j||(j=0);Y=b?Math.min(b*M+j,Z.length):Z.length;for(Q=j;Q<Y;Q+=M)K[0]=Z[Q],K[1]=Z[Q+1],K[2]=Z[Q+2],g(K,K,O),Z[Q]=K[0],Z[Q+1]=K[1],Z[Q+2]=K[2];return Z};var K=j(26313)()},9990:function(Z){Z.exports=function(Z,M,j){var K=new Float32Array(3);return K[0]=Z,K[1]=M,K[2]=j,K}},59344:function(Z,M,j){Z.exports={EPSILON:j(78294),create:j(26313),clone:j(24232),angle:j(86893),fromValues:j(9990),copy:j(11940),set:j(47329),equals:j(46485),exactEquals:j(95388),add:j(43128),subtract:j(90143),sub:j(88314),multiply:j(88572),mul:j(18104),divide:j(24889),div:j(24553),min:j(62544),max:j(82453),floor:j(37598),ceil:j(78739),round:j(12742),scale:j(1442),scaleAndAdd:j(78268),distance:j(92e3),dist:j(46223),squaredDistance:j(94584),sqrDist:j(84140),length:j(45978),len:j(6763),squaredLength:j(82258),sqrLen:j(79926),negate:j(232),inverse:j(54933),normalize:j(21363),dot:j(37570),cross:j(39747),lerp:j(243),random:j(27926),transformMat4:j(95101),transformMat3:j(9512),transformQuat:j(70552),rotateX:j(8400),rotateY:j(75140),rotateZ:j(72444),forEach:j(45880)}},54933:function(Z){Z.exports=function(Z,M){return Z[0]=1/M[0],Z[1]=1/M[1],Z[2]=1/M[2],Z}},6763:function(Z,M,j){Z.exports=j(45978)},45978:function(Z){Z.exports=function(Z){var M=Z[0],j=Z[1],K=Z[2];return Math.sqrt(M*M+j*j+K*K)}},243:function(Z){Z.exports=function(Z,M,j,K){var b=M[0],g=M[1],O=M[2];return Z[0]=b+K*(j[0]-b),Z[1]=g+K*(j[1]-g),Z[2]=O+K*(j[2]-O),Z}},82453:function(Z){Z.exports=function(Z,M,j){return Z[0]=Math.max(M[0],j[0]),Z[1]=Math.max(M[1],j[1]),Z[2]=Math.max(M[2],j[2]),Z}},62544:function(Z){Z.exports=function(Z,M,j){return Z[0]=Math.min(M[0],j[0]),Z[1]=Math.min(M[1],j[1]),Z[2]=Math.min(M[2],j[2]),Z}},18104:function(Z,M,j){Z.exports=j(88572)},88572:function(Z){Z.exports=function(Z,M,j){return Z[0]=M[0]*j[0],Z[1]=M[1]*j[1],Z[2]=M[2]*j[2],Z}},232:function(Z){Z.exports=function(Z,M){return Z[0]=-M[0],Z[1]=-M[1],Z[2]=-M[2],Z}},21363:function(Z){Z.exports=function(Z,M){var j=M[0],K=M[1],b=M[2],g=j*j+K*K+b*b;g>0&&(g=1/Math.sqrt(g),Z[0]=M[0]*g,Z[1]=M[1]*g,Z[2]=M[2]*g);return Z}},27926:function(Z){Z.exports=function(Z,M){M=M||1;var j=2*Math.random()*Math.PI,K=2*Math.random()-1,b=Math.sqrt(1-K*K)*M;return Z[0]=Math.cos(j)*b,Z[1]=Math.sin(j)*b,Z[2]=K*M,Z}},8400:function(Z){Z.exports=function(Z,M,j,K){var b=j[1],g=j[2],O=M[1]-b,Q=M[2]-g,Y=Math.sin(K),I=Math.cos(K);return Z[0]=M[0],Z[1]=b+O*I-Q*Y,Z[2]=g+O*Y+Q*I,Z}},75140:function(Z){Z.exports=function(Z,M,j,K){var b=j[0],g=j[2],O=M[0]-b,Q=M[2]-g,Y=Math.sin(K),I=Math.cos(K);return Z[0]=b+Q*Y+O*I,Z[1]=M[1],Z[2]=g+Q*I-O*Y,Z}},72444:function(Z){Z.exports=function(Z,M,j,K){var b=j[0],g=j[1],O=M[0]-b,Q=M[1]-g,Y=Math.sin(K),I=Math.cos(K);return Z[0]=b+O*I-Q*Y,Z[1]=g+O*Y+Q*I,Z[2]=M[2],Z}},12742:function(Z){Z.exports=function(Z,M){return Z[0]=Math.round(M[0]),Z[1]=Math.round(M[1]),Z[2]=Math.round(M[2]),Z}},1442:function(Z){Z.exports=function(Z,M,j){return Z[0]=M[0]*j,Z[1]=M[1]*j,Z[2]=M[2]*j,Z}},78268:function(Z){Z.exports=function(Z,M,j,K){return Z[0]=M[0]+j[0]*K,Z[1]=M[1]+j[1]*K,Z[2]=M[2]+j[2]*K,Z}},47329:function(Z){Z.exports=function(Z,M,j,K){return Z[0]=M,Z[1]=j,Z[2]=K,Z}},84140:function(Z,M,j){Z.exports=j(94584)},79926:function(Z,M,j){Z.exports=j(82258)},94584:function(Z){Z.exports=function(Z,M){var j=M[0]-Z[0],K=M[1]-Z[1],b=M[2]-Z[2];return j*j+K*K+b*b}},82258:function(Z){Z.exports=function(Z){var M=Z[0],j=Z[1],K=Z[2];return M*M+j*j+K*K}},88314:function(Z,M,j){Z.exports=j(90143)},90143:function(Z){Z.exports=function(Z,M,j){return Z[0]=M[0]-j[0],Z[1]=M[1]-j[1],Z[2]=M[2]-j[2],Z}},9512:function(Z){Z.exports=function(Z,M,j){var K=M[0],b=M[1],g=M[2];return Z[0]=K*j[0]+b*j[3]+g*j[6],Z[1]=K*j[1]+b*j[4]+g*j[7],Z[2]=K*j[2]+b*j[5]+g*j[8],Z}},95101:function(Z){Z.exports=function(Z,M,j){var K=M[0],b=M[1],g=M[2],O=j[3]*K+j[7]*b+j[11]*g+j[15];return O=O||1,Z[0]=(j[0]*K+j[4]*b+j[8]*g+j[12])/O,Z[1]=(j[1]*K+j[5]*b+j[9]*g+j[13])/O,Z[2]=(j[2]*K+j[6]*b+j[10]*g+j[14])/O,Z}},70552:function(Z){Z.exports=function(Z,M,j){var K=M[0],b=M[1],g=M[2],O=j[0],Q=j[1],Y=j[2],I=j[3],E=I*K+Q*g-Y*b,s=I*b+Y*K-O*g,i=I*g+O*b-Q*K,a=-O*K-Q*b-Y*g;return Z[0]=E*I+a*-O+s*-Y-i*-Q,Z[1]=s*I+a*-Q+i*-O-E*-Y,Z[2]=i*I+a*-Y+E*-Q-s*-O,Z}},41844:function(Z){"use strict";Z.exports=function(Z){for(var M=new Array(Z),j=0;j<Z;++j)M[j]=j;return M}},9603:function(Z){Z.exports=function(Z){return null!=Z&&null!=Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}},22110:function(Z,M,j){"use strict";j.d(M,{b:function(){return g}});var K=j(43144),b=j(15671),g=(0,K.b)((function Z(M){var j=this,K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;(0,b.e)(this,Z),this.stickyPointerLock=!1,this.stickyFullscreen=!1,this.tickRate=30,this.maxRenderRate=0,this.pointerLock=!1,this.fullscreen=!1,this.onTick=function(Z){},this.onRender=function(){},this.onInit=function(){},this.onResize=function(){},this.onPointerLockChanged=function(Z){},this.onFullscreenChanged=function(Z){},s((function(){O(j,K),I(j,M),j.onInit()}))}));function O(Z,M){Z._nowObject=performance||Date,Z._lastTick=0,Z._renderAccum=0,Z._rt=0,Z._frameCB=Y.bind(null,Z),requestAnimationFrame(Z._frameCB),M>0&&(Z._intervalCB=Q.bind(null,Z),Z._interval=setInterval(Z._intervalCB,Math.max(M,1e3/Z.tickRate/2)))}function Q(Z){for(var M=1e3/Z.tickRate,j=Z._nowObject.now()+20,K=0;Z._nowObject.now()>=Z._lastTick+M&&Z._nowObject.now()<j&&++K<=3;)Z.onTick(M),Z._lastTick+=M;var b=5*(M+5),g=Z._nowObject.now();if(g-Z._lastTick>b)for(;g>=Z._lastTick+M;)Z._lastTick+=M}function Y(Z){requestAnimationFrame(Z._frameCB),Q(Z);var M=Z._nowObject.now(),j=M-Z._rt;if(Z._rt=M,Z.maxRenderRate>0){Z._renderAccum+=j;var K=1e3/Z.maxRenderRate;if(Z._renderAccum<K)return;Z._renderAccum=Math.min(Z._renderAccum-K,K)}var b=1e3/Z.tickRate,g=(M-Z._lastTick)/b;Z.onRender(j,g,b)}function I(Z,M){if(M){var j=!1,K=!1;document.addEventListener("pointerlockchange",(function(K){j=document.pointerLockElement===M,Z.onPointerLockChanged(j)})),document.addEventListener("fullscreenchange",(function(j){K=document.fullscreenElement===M,Z.onFullscreenChanged(K)})),Object.defineProperty(Z,"pointerLock",{get:function(){return j},set:function(Z){Z&&!j?E(M):j&&!Z&&function(Z){Z.exitPointerLock&&Z.exitPointerLock()}(document)}}),Object.defineProperty(Z,"fullscreen",{get:function(){return K},set:function(Z){Z&&!K?M.requestFullscreen():K&&!Z&&document.exitFullscreen()}}),M.addEventListener("click",(function(b){Z.stickyPointerLock&&!j&&E(M),Z.stickyFullscreen&&!K&&M.requestFullscreen()}));var b=function(){return Z.onResize()};if(window.ResizeObserver)new ResizeObserver(b).observe(M);else window.addEventListener("resize",b)}}function E(Z){Z.requestPointerLock&&Z.requestPointerLock()}var s=function(Z){if("loading"===document.readyState){document.addEventListener("readystatechange",(function M(){document.removeEventListener("readystatechange",M),Z()}))}else setTimeout(Z,1)}},38794:function(Z,M,j){var K=j(41844),b=j(8669),g="undefined"!==typeof Float64Array;function O(Z,M){return Z[0]-M[0]}function Q(){var Z,M=this.stride,j=new Array(M.length);for(Z=0;Z<j.length;++Z)j[Z]=[Math.abs(M[Z]),Z];j.sort(O);var K=new Array(j.length);for(Z=0;Z<K.length;++Z)K[Z]=j[Z][1];return K}function Y(Z,M){var j=["View",M,"d",Z].join("");M<0&&(j="View_Nil"+Z);var b="generic"===Z;if(-1===M){var g="function "+j+"(a){this.data=a;};var proto="+j+".prototype;proto.dtype='"+Z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+j+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+j+"(a){return new "+j+"(a);}";return new Function(g)()}if(0===M){g="function "+j+"(a,d) {this.data = a;this.offset = d};var proto="+j+".prototype;proto.dtype='"+Z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+j+"_copy() {return new "+j+"(this.data,this.offset)};proto.pick=function "+j+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+j+"_get(){return "+(b?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+j+"_set(v){return "+(b?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+j+"(a,b,c,d){return new "+j+"(a,d)}";return new Function("TrivialArray",g)(I[Z][0])}g=["'use strict'"];var O=K(M),Y=O.map((function(Z){return"i"+Z})),E="this.offset+"+O.map((function(Z){return"this.stride["+Z+"]*i"+Z})).join("+"),s=O.map((function(Z){return"b"+Z})).join(","),i=O.map((function(Z){return"c"+Z})).join(",");g.push("function "+j+"(a,"+s+","+i+",d){this.data=a","this.shape=["+s+"]","this.stride=["+i+"]","this.offset=d|0}","var proto="+j+".prototype","proto.dtype='"+Z+"'","proto.dimension="+M),g.push("Object.defineProperty(proto,'size',{get:function "+j+"_size(){return "+O.map((function(Z){return"this.shape["+Z+"]"})).join("*"),"}})"),1===M?g.push("proto.order=[0]"):(g.push("Object.defineProperty(proto,'order',{get:"),M<4?(g.push("function "+j+"_order(){"),2===M?g.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===M&&g.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):g.push("ORDER})")),g.push("proto.set=function "+j+"_set("+Y.join(",")+",v){"),b?g.push("return this.data.set("+E+",v)}"):g.push("return this.data["+E+"]=v}"),g.push("proto.get=function "+j+"_get("+Y.join(",")+"){"),b?g.push("return this.data.get("+E+")}"):g.push("return this.data["+E+"]}"),g.push("proto.index=function "+j+"_index(",Y.join(),"){return "+E+"}"),g.push("proto.hi=function "+j+"_hi("+Y.join(",")+"){return new "+j+"(this.data,"+O.map((function(Z){return["(typeof i",Z,"!=='number'||i",Z,"<0)?this.shape[",Z,"]:i",Z,"|0"].join("")})).join(",")+","+O.map((function(Z){return"this.stride["+Z+"]"})).join(",")+",this.offset)}");var a=O.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})),z=O.map((function(Z){return"c"+Z+"=this.stride["+Z+"]"}));g.push("proto.lo=function "+j+"_lo("+Y.join(",")+"){var b=this.offset,d=0,"+a.join(",")+","+z.join(","));for(var V=0;V<M;++V)g.push("if(typeof i"+V+"==='number'&&i"+V+">=0){d=i"+V+"|0;b+=c"+V+"*d;a"+V+"-=d}");g.push("return new "+j+"(this.data,"+O.map((function(Z){return"a"+Z})).join(",")+","+O.map((function(Z){return"c"+Z})).join(",")+",b)}"),g.push("proto.step=function "+j+"_step("+Y.join(",")+"){var "+O.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})).join(",")+","+O.map((function(Z){return"b"+Z+"=this.stride["+Z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(V=0;V<M;++V)g.push("if(typeof i"+V+"==='number'){d=i"+V+"|0;if(d<0){c+=b"+V+"*(a"+V+"-1);a"+V+"=ceil(-a"+V+"/d)}else{a"+V+"=ceil(a"+V+"/d)}b"+V+"*=d}");g.push("return new "+j+"(this.data,"+O.map((function(Z){return"a"+Z})).join(",")+","+O.map((function(Z){return"b"+Z})).join(",")+",c)}");var o=new Array(M),c=new Array(M);for(V=0;V<M;++V)o[V]="a[i"+V+"]",c[V]="b[i"+V+"]";g.push("proto.transpose=function "+j+"_transpose("+Y+"){"+Y.map((function(Z,M){return Z+"=("+Z+"===undefined?"+M+":"+Z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+j+"(this.data,"+o.join(",")+","+c.join(",")+",this.offset)}"),g.push("proto.pick=function "+j+"_pick("+Y+"){var a=[],b=[],c=this.offset");for(V=0;V<M;++V)g.push("if(typeof i"+V+"==='number'&&i"+V+">=0){c=(c+this.stride["+V+"]*i"+V+")|0}else{a.push(this.shape["+V+"]);b.push(this.stride["+V+"])}");return g.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),g.push("return function construct_"+j+"(data,shape,stride,offset){return new "+j+"(data,"+O.map((function(Z){return"shape["+Z+"]"})).join(",")+","+O.map((function(Z){return"stride["+Z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",g.join("\n"))(I[Z],Q)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Z.exports=function(Z,M,j,K){if(void 0===Z)return(0,I.array[0])([]);"number"===typeof Z&&(Z=[Z]),void 0===M&&(M=[Z.length]);var O=M.length;if(void 0===j){j=new Array(O);for(var Q=O-1,E=1;Q>=0;--Q)j[Q]=E,E*=M[Q]}if(void 0===K){K=0;for(Q=0;Q<O;++Q)j[Q]<0&&(K-=(M[Q]-1)*j[Q])}for(var s=function(Z){if(b(Z))return"buffer";if(g)switch(Object.prototype.toString.call(Z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Z)?"array":"generic"}(Z),i=I[s];i.length<=O+1;)i.push(Y(s,i.length-1));return(0,i[O+1])(Z,M,j,K)}},8669:function(Z){function M(Z){return!!Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}Z.exports=function(Z){return null!=Z&&(M(Z)||function(Z){return"function"===typeof Z.readFloatLE&&"function"===typeof Z.slice&&M(Z.slice(0,0))}(Z)||!!Z._isBuffer)}},12773:function(Z){"use strict";var M=[],j=[],K=[],b=[],g=[],O=[],Q=[],Y=[],I=[],E=[],s=[],i=[];Z.exports=function(Z,a,z,V,o,c){for(var G=Q,f=I,X=E,d=i,W=0;W<3;W++)G[W]=+z[W],X[W]=+a.max[W],f[W]=+a.base[W];c||(c=1e-10);var A=function(Z,Q,I,E,i,a){var z=M,V=j,o=K,c=b,G=g,f=O,X=Y,d=Math.floor,W=0,A=0,q=0,T=0,B=0;if(N(),0===q)return 0;for(T=k();A<=q;){if(U(T)&&n())return W;T=k()}for(W+=q,B=0;B<3;B++)E[B]+=I[B],i[B]+=I[B];return W;function N(){if(A=0,0!==(q=Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2])))for(var Z=0;Z<3;Z++){var M=I[Z]>=0;c[Z]=M?1:-1;var j=M?i[Z]:E[Z];z[Z]=M?E[Z]:i[Z],V[Z]=x(j,c[Z]),o[Z]=R(z[Z],c[Z]),X[Z]=I[Z]/q,G[Z]=Math.abs(1/X[Z]);var K=M?V[Z]+1-j:j-V[Z];f[Z]=G[Z]<1/0?G[Z]*K:1/0}}function U(M){for(var j=c[0],K=0===M?V[0]:o[0],b=V[0]+j,g=c[1],O=1===M?V[1]:o[1],Q=V[1]+g,Y=c[2],I=2===M?V[2]:o[2],E=V[2]+Y,s=K;s!=b;s+=j)for(var i=O;i!=Q;i+=g)for(var a=I;a!=E;a+=Y)if(Z(s,i,a))return!0;return!1}function n(){W+=A;var Z=c[T],M=A/q,j=s;for(B=0;B<3;B++){var K=I[B]*M;E[B]+=K,i[B]+=K,j[B]=I[B]-K}if(Z>0?i[T]=Math.round(i[T]):E[T]=Math.round(E[T]),Q(W,T,Z,j))return!0;for(B=0;B<3;B++)I[B]=j[B];return N(),0===q}function k(){var Z=f[0]<f[1]?f[0]<f[2]?0:2:f[1]<f[2]?1:2,M=f[Z]-A;for(A=f[Z],V[Z]+=c[Z],f[Z]+=G[Z],B=0;B<3;B++)z[B]+=M*X[B],o[B]=R(z[B],c[B]);return Z}function x(Z,M){return d(Z-M*a)}function R(Z,M){return d(Z+M*a)}}(Z,V,G,f,X,c);if(!o){for(W=0;W<3;W++)d[W]=z[W]>0?X[W]-a.max[W]:f[W]-a.base[W];a.translate(d)}return A}},82743:function(Z,M,j){"use strict";j.d(M,{c:function(){return a}});var K=j(15671),b=j(43144),g=j(97887),O=j(59344),Q=function(){function Z(M,j,b,Q,Y,I,E){(0,K.e)(this,Z),this.aabb=new g(M.base,M.vec),this.mass=j,this.friction=b,this.restitution=Q,this.gravityMultiplier=Y,this.onCollide=I,this.autoStep=!!E,this.airDrag=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.onStep=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.velocity=O.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=O.create(),this._impulses=O.create(),this._sleepFrameCount=10}return(0,b.b)(Z,[{key:"loadFromCopy",value:function(Z){O.copy(this.aabb.base,Z.aabb.base),O.copy(this.aabb.vec,Z.aabb.vec),O.copy(this.aabb.max,Z.aabb.max),this.aabb.mag=Z.aabb.mag,this.mass=Z.mass,this.friction=Z.friction,this.restitution=Z.restitution,this.gravityMultiplier=Z.gravityMultiplier,this.onCollide=Z.onCollide,this.autoStep=Z.autoStep,this.airDrag=Z.airDrag,this.fluidDrag=Z.fluidDrag,this.onStep=Z.onStep,this.preventFallOffEdge=Z.preventFallOffEdge,this.rolledBackLastTick=Z.rolledBackLastTick,O.copy(this.velocity,Z.velocity),O.copy(this.resting,Z.resting),this.inFluid=Z.inFluid,this._ratioInFluid=Z._ratioInFluid,O.copy(this._forces,Z._forces),O.copy(this._impulses,Z._impulses),this._sleepFrameCount=Z._sleepFrameCount}},{key:"setPosition",value:function(Z){Y(Z),O.subtract(Z,Z,this.aabb.base),this.aabb.translate(Z),this._markActive()}},{key:"getPosition",value:function(){return O.clone(this.aabb.base)}},{key:"applyForce",value:function(Z){Y(Z),O.add(this._forces,this._forces,Z),this._markActive()}},{key:"applyImpulse",value:function(Z){Y(Z),O.add(this._impulses,this._impulses,Z),this._markActive()}},{key:"_markActive",value:function(){this._sleepFrameCount=10}},{key:"atRestX",value:function(){return this.resting[0]}},{key:"atRestY",value:function(){return this.resting[1]}},{key:"atRestZ",value:function(){return this.resting[2]}}]),Z}(),Y=function(Z){};var I=j(97887),E=j(59344),s=j(12773);function i(){this.airDrag=.1,this.fluidDrag=.4,this.fluidDensity=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function a(Z,M,j){Z=Object.assign(new i,Z),this.gravity=Z.gravity||[0,-10,0],this.airDrag=Z.airDrag||.1,this.fluidDensity=Z.fluidDensity||2,this.fluidDrag=Z.fluidDrag||.4,this.minBounceImpulse=Z.minBounceImpulse,this.bodies=[],this.isBodyInsideUnloadedBlock=Z.isBodyInsideUnloadedBlock,this.testSolid=M,this.testFluid=j}a.prototype.addBody=function(Z,M,j,K,b,g){Z=Z||new I([0,0,0],[1,1,1]),"undefined"==typeof M&&(M=1),"undefined"==typeof j&&(j=1),"undefined"==typeof K&&(K=0),"undefined"==typeof b&&(b=1);var O=new Q(Z,M,j,K,b,g);return this.bodies.push(O),O},a.prototype.removeBody=function(Z){var M=this.bodies.indexOf(Z);M<0||(this.bodies.splice(M,1),Z.aabb=Z.onCollide=null)};var z=E.create(),V=E.create(),o=E.create(),c=E.create(),G=E.create(),f=E.create(),X=E.create(),d=new I([0,0,0],[1,1,1]),W=new Q(d,1,1,0,1,(function(){}),!1);function A(Z,M,j){return M=j,M*=1-Math.pow(1-Z.ratioInFluid,2)}a.prototype.tick=function(Z){var M=this;Z/=1e3;var j=h(0,E.squaredLength(this.gravity));this.bodies.forEach((function(K){return function(Z,M,j,K){E.copy(G,M.resting),Z.isBodyInsideUnloadedBlock&&W.loadFromCopy(M);if(M.mass<=0)return E.set(M.velocity,0,0,0),E.set(M._forces,0,0,0),void E.set(M._impulses,0,0,0);var b=K||0===M.gravityMultiplier;if(function(Z,M,j,K){if(M._sleepFrameCount>0)return!1;if(K)return!0;var b=!1,g=.5*j*j*M.gravityMultiplier;return E.scale(S,Z.gravity,g),s(Z.testSolid,M.aabb,S,(function(){return b=!0,!0}),!0),b}(Z,M,j,b))return;M._sleepFrameCount--,function(Z,M){var j=M.aabb,K=Math.floor(j.base[0]),b=Math.floor(j.base[2]),g=Math.floor(j.base[1]),O=Math.floor(j.max[1]);if(!Z.testFluid(K,g,b))return M.inFluid=!1,void(M.ratioInFluid=0);var Q=1,Y=g+1;for(;Y<=O&&Z.testFluid(K,Y,b);)Q++,Y++;var I=(g+Q-j.base[1])/j.vec[1];I>1&&(I=1);var s=j.vec[0]*j.vec[1]*j.vec[2]*I,i=T;E.scale(i,Z.gravity,-Z.fluidDensity*s*M.gravityMultiplier),M.applyForce(i),M.inFluid=!0,M.ratioInFluid=I}(Z,M),p(M._forces),p(M._impulses),p(M.velocity),p(M.resting),E.scale(z,M._forces,1/M.mass),E.scaleAndAdd(z,z,Z.gravity,M.gravityMultiplier),E.scale(V,M._impulses,1/M.mass),E.scaleAndAdd(V,V,z,j),E.add(M.velocity,M.velocity,V),M.friction&&(B(Z,0,M,V,j),B(Z,1,M,V,j),B(Z,2,M,V,j));var g=M.fluidDrag>=0?M.fluidDrag:Z.fluidDrag,O=M.airDrag>=0?M.airDrag:Z.airDrag,Q=O,Y=O;M.inFluid&&(Q=A(M,Q,M.fluidDragHoriz>=0?M.fluidDragHoriz:g),Y=A(M,Y,M.fluidDragVert>=0?M.fluidDragVert:g));Q=Math.max(1-Q*j/M.mass,0),Y=Math.max(1-Y*j/M.mass,0),E.set(q,Q,Y,Q),E.multiply(M.velocity,M.velocity,q),E.scale(o,M.velocity,j),E.set(M._forces,0,0,0),E.set(M._impulses,0,0,0),M.autoStep&&w(n,M.aabb);E.copy(f,o),E.set(X,0,0,0),M.preventFallOffEdge&&function(Z,M,j,K){if(!M.resting[1]||j[1]>0)return;var b=F;w(b,M.aabb);for(var g=0;g<3;g+=2){E.set(u,0,0,0),u[g]=j[g];var O=!0;(O=(O=(O=(O=O&&!y(Z,b.base[0]+u[0]+1e-5,b.base[1],b.base[2]+u[2]+1e-5))&&!y(Z,b.max[0]+u[0]-1e-5,b.base[1],b.base[2]+u[2]+1e-5))&&!y(Z,b.base[0]+u[0]+1e-5,b.base[1],b.max[2]+u[2]-1e-5))&&!y(Z,b.max[0]+u[0]-1e-5,b.base[1],b.max[2]+u[2]-1e-5))?(K[g]=j[g]>0?1:-1,j[g]=0):0===g&&(E.set(C,j[0],0,0),U(Z,b,C,K,M.slideOnCollision))}}(Z,M,o,X);U(Z,M.aabb,o,M.resting,M.slideOnCollision),M.autoStep&&function(Z,M,j,K){if(M.resting[1]>=0&&!M.inFluid)return;var b=0!==M.resting[0],g=0!==M.resting[2];if(!b&&!g)return;var O=Math.abs(K[0]/K[2]),Q=4;if(!b&&O>Q)return;if(!g&&O<1/Q)return;E.add(x,j.base,K);var Y=Z.testSolid;s(Y,j,K,(function(Z,M,j,K){if(1!==M)return!0;K[M]=0}));var I=j.base[1],i=Math.floor(I+1.001)-I;E.set(R,0,i,0);var a=!1;if(s(Y,j,R,(function(Z,M,j,K){return a=!0,!0})),a)return;E.subtract(e,x,j.base),e[1]=0,U(Z,j,e,k,!0);var z=h(j.base[0],x[0]),V=h(j.base[2],x[2]);if(b&&!z&&(!V||!g))return;if(g&&(!z||!b)&&!V)return;var o=!0;if(o=(o=(o=(o=o&&!y(Z,j.base[0]+1e-5,j.base[1],j.base[2]+1e-5))&&!y(Z,j.max[0]-1e-5,j.base[1],j.base[2]+1e-5))&&!y(Z,j.base[0]+1e-5,j.base[1],j.max[2]-1e-5))&&!y(Z,j.max[0]-1e-5,j.base[1],j.max[2]-1e-5))return;w(M.aabb,j),M.resting[0]=k[0],M.resting[2]=k[2],M.onStep&&M.onStep()}(Z,M,n,f);for(var I=0;I<3;++I)M.resting[I]=M.resting[I]||X[I],c[I]=0,M.resting[I]&&(G[I]||(c[I]=-M.velocity[I]),M.velocity[I]=0);var i=E.length(c);i>.001&&(E.scale(c,c,M.mass),M.onCollide&&M.onCollide(c),M.restitution>0&&i>Z.minBounceImpulse&&(E.scale(c,c,M.restitution),M.applyImpulse(c)));E.squaredLength(M.velocity)>1e-5&&M._markActive();Z.isBodyInsideUnloadedBlock&&Z.isBodyInsideUnloadedBlock(M)?(M.loadFromCopy(W),M.rolledBackLastTick=!0):M.rolledBackLastTick=!1}(M,K,Z,j)}))};var q=E.create([0,0,0]);var T=E.create();function B(Z,M,j,K,b){var g=j.resting[M],O=K[M];if(!j.alwaysApplyHorizFriction||1!==M){if(0===g)return;if(g*O<=0)return}E.copy(N,j.velocity),N[M]=0;var Q=E.length(N);if(!h(Q,0)){var Y=Math.abs(j.friction*Z.gravity[M]*b),I=Q>Y?(Q-Y)/Q:0;j.velocity[(M+1)%3]*=I,j.velocity[(M+2)%3]*=I}}var N=E.create();function U(Z,M,j,K,b){return E.set(K,0,0,0),s(Z.testSolid,M,j,(function(Z,M,j,g){K[M]=j,g[M]=0,b||(g[0]=0,g[1]=0,g[2]=0)}))}var n=new I([],[]),k=E.create(),x=E.create(),R=E.create(),e=E.create();var u=E.create(),F=new I([],[]),C=E.create();function y(Z,M,j,K){return Z.testSolid(Math.floor(M),Math.floor(j-1),Math.floor(K))}var S=E.create();function h(Z,M){return Math.abs(Z-M)<1e-5}function w(Z,M){for(var j=0;j<3;j++)Z.base[j]=M.base[j],Z.max[j]=M.max[j],Z.vec[j]=M.vec[j]}var p=function(Z){}},50061:function(Z,M){!function(Z){"use strict";var M=function(Z,j){return M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Z,M){Z.__proto__=M}||function(Z,M){for(var j in M)Object.prototype.hasOwnProperty.call(M,j)&&(Z[j]=M[j])},M(Z,j)};function j(Z,j){if("function"!==typeof j&&null!==j)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");function K(){this.constructor=Z}M(Z,j),Z.prototype=null===j?Object.create(j):(K.prototype=j.prototype,new K)}function K(Z,M,j,K){var b,g=arguments.length,O=g<3?M:null===K?K=Object.getOwnPropertyDescriptor(M,j):K;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)O=Reflect.decorate(Z,M,j,K);else for(var Q=Z.length-1;Q>=0;Q--)(b=Z[Q])&&(O=(g<3?b(O):g>3?b(M,j,O):b(M,j))||O);return g>3&&O&&Object.defineProperty(M,j,O),O}function b(Z,M,j){if(j||2===arguments.length)for(var K,b=0,g=M.length;b<g;b++)!K&&b in M||(K||(K=Array.prototype.slice.call(M,0,b)),K[b]=M[b]);return Z.concat(K||Array.prototype.slice.call(M))}var g,O=255,Q=213;Z.OPERATION=void 0,(g=Z.OPERATION||(Z.OPERATION={}))[g.ADD=128]="ADD",g[g.REPLACE=0]="REPLACE",g[g.DELETE=64]="DELETE",g[g.DELETE_AND_ADD=192]="DELETE_AND_ADD",g[g.TOUCH=1]="TOUCH",g[g.CLEAR=10]="CLEAR";var Y=function(){function M(Z,M,j){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=Z,this.setParent(M,j)}return M.prototype.setParent=function(Z,M,j){var K=this;if(this.indexes||(this.indexes=this.ref instanceof xZ?this.ref._definition.indexes:{}),this.parent=Z,this.parentIndex=j,M)if(this.root=M,this.ref instanceof xZ){var b=this.ref._definition;for(var g in b.schema){var O=this.ref[g];if(O&&O.$changes){var Q=b.indexes[g];O.$changes.setParent(this.ref,M,Q)}}}else"object"===typeof this.ref&&this.ref.forEach((function(Z,M){if(Z instanceof xZ){var j=Z.$changes,b=K.ref.$changes.indexes[M];j.setParent(K.ref,K.root,b)}}))},M.prototype.operation=function(Z){this.changes.set(--this.currentCustomOperation,Z)},M.prototype.change=function(M,j){void 0===j&&(j=Z.OPERATION.ADD);var K="number"===typeof M?M:this.indexes[M];this.assertValidIndex(K,M);var b=this.changes.get(K);b&&b.op!==Z.OPERATION.DELETE&&b.op!==Z.OPERATION.TOUCH||this.changes.set(K,{op:b&&b.op===Z.OPERATION.DELETE?Z.OPERATION.DELETE_AND_ADD:j,index:K}),this.allChanges.add(K),this.changed=!0,this.touchParents()},M.prototype.touch=function(M){var j="number"===typeof M?M:this.indexes[M];this.assertValidIndex(j,M),this.changes.has(j)||this.changes.set(j,{op:Z.OPERATION.TOUCH,index:j}),this.allChanges.add(j),this.touchParents()},M.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},M.prototype.getType=function(Z){if(this.ref._definition)return(M=this.ref._definition).schema[M.fieldsByIndex[Z]];var M,j=(M=this.parent._definition).schema[M.fieldsByIndex[this.parentIndex]];return Object.values(j)[0]},M.prototype.getChildrenFilter=function(){var Z=this.parent._definition.childFilters;return Z&&Z[this.parentIndex]},M.prototype.getValue=function(Z){return this.ref.getByIndex(Z)},M.prototype.delete=function(M){var j="number"===typeof M?M:this.indexes[M];if(void 0!==j){var K=this.getValue(j);this.changes.set(j,{op:Z.OPERATION.DELETE,index:j}),this.allChanges.delete(j),delete this.caches[j],K&&K.$changes&&(K.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(M," (").concat(j,")"))},M.prototype.discard=function(M,j){var K=this;void 0===M&&(M=!1),void 0===j&&(j=!1),this.ref instanceof xZ||this.changes.forEach((function(M){if(M.op===Z.OPERATION.DELETE){var j=K.ref.getIndex(M.index);delete K.indexes[j]}})),this.changes.clear(),this.changed=M,j&&this.allChanges.clear(),this.currentCustomOperation=0},M.prototype.discardAll=function(){var Z=this;this.changes.forEach((function(M){var j=Z.getValue(M.index);j&&j.$changes&&j.$changes.discardAll()})),this.discard()},M.prototype.cache=function(Z,M){this.caches[Z]=M},M.prototype.clone=function(){return new M(this.ref,this.parent,this.root)},M.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},M.prototype.assertValidIndex=function(Z,M){if(void 0===Z)throw new Error('ChangeTree: missing index for field "'.concat(M,'"'))},M}();function I(Z,M,j,K){return Z[M]||(Z[M]=[]),Z[M].push(j),null===K||void 0===K||K.forEach((function(Z,M){return j(Z,M)})),function(){return s(Z[M],Z[M].indexOf(j))}}function E(M){var j=this,K="string"!==typeof this.$changes.getType();this.$items.forEach((function(b,g){M.push({refId:j.$changes.refId,op:Z.OPERATION.DELETE,field:g,value:void 0,previousValue:b}),K&&j.$changes.root.removeRef(b.$changes.refId)}))}function s(Z,M){if(-1===M||M>=Z.length)return!1;for(var j=Z.length-1,K=M;K<j;K++)Z[K]=Z[K+1];return Z.length=j,!0}var i=function(Z,M){var j=Z.toString(),K=M.toString();return j<K?-1:j>K?1:0};function a(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,M){return"symbol"===typeof M||isNaN(M)?Z[M]:Z.at(M)},set:function(Z,M,j){if("symbol"===typeof M||isNaN(M))Z[M]=j;else{var K=Array.from(Z.$items.keys()),b=parseInt(K[M]||M);void 0===j||null===j?Z.deleteAt(b):Z.setAt(b,j)}return!0},deleteProperty:function(Z,M){return"number"===typeof M?Z.deleteAt(M):delete Z[M],!0}})}var z=function(){function M(){for(var Z=[],M=0;M<arguments.length;M++)Z[M]=arguments[M];this.$changes=new Y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,Z)}return M.prototype.onAdd=function(M,j){return void 0===j&&(j=!0),I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,M,j?this.$items:void 0)},M.prototype.onRemove=function(M){return I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,M)},M.is=function(Z){return Array.isArray(Z)||void 0!==Z.array},Object.defineProperty(M.prototype,"length",{get:function(){return this.$items.size},set:function(Z){0===Z?this.clear():this.splice(Z,this.length-Z)},enumerable:!1,configurable:!0}),M.prototype.push=function(){for(var Z,M=this,j=[],K=0;K<arguments.length;K++)j[K]=arguments[K];return j.forEach((function(j){Z=M.$refId++,M.setAt(Z,j)})),Z},M.prototype.pop=function(){var Z=Array.from(this.$indexes.values()).pop();if(void 0!==Z){this.$changes.delete(Z),this.$indexes.delete(Z);var M=this.$items.get(Z);return this.$items.delete(Z),M}},M.prototype.at=function(Z){var M=Array.from(this.$items.keys())[Z];return this.$items.get(M)},M.prototype.setAt=function(M,j){var K,b;if(void 0!==j&&null!==j){if(this.$items.get(M)!==j){void 0!==j.$changes&&j.$changes.setParent(this,this.$changes.root,M);var g=null!==(b=null===(K=this.$changes.indexes[M])||void 0===K?void 0:K.op)&&void 0!==b?b:Z.OPERATION.ADD;this.$changes.indexes[M]=M,this.$indexes.set(M,M),this.$items.set(M,j),this.$changes.change(M,g)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},M.prototype.deleteAt=function(Z){var M=Array.from(this.$items.keys())[Z];return void 0!==M&&this.$deleteAt(M)},M.prototype.$deleteAt=function(Z){return this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z)},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&E.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.concat=function(){for(var Z,j=[],K=0;K<arguments.length;K++)j[K]=arguments[K];return new(M.bind.apply(M,b([void 0],(Z=Array.from(this.$items.values())).concat.apply(Z,j),!1)))},M.prototype.join=function(Z){return Array.from(this.$items.values()).join(Z)},M.prototype.reverse=function(){var Z=this,M=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(j,K){Z.setAt(M[K],j)})),this},M.prototype.shift=function(){var Z=Array.from(this.$items.keys()).shift();if(void 0!==Z){var M=this.$items.get(Z);return this.$deleteAt(Z),M}},M.prototype.slice=function(Z,j){var K=new M;return K.push.apply(K,Array.from(this.$items.values()).slice(Z,j)),K},M.prototype.sort=function(Z){var M=this;void 0===Z&&(Z=i);var j=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(Z).forEach((function(Z,K){M.setAt(j[K],Z)})),this},M.prototype.splice=function(Z,M){void 0===M&&(M=this.length-Z);for(var j=Array.from(this.$items.keys()),K=[],b=Z;b<Z+M;b++)K.push(this.$items.get(j[b])),this.$deleteAt(j[b]);return K},M.prototype.unshift=function(){for(var Z=this,M=[],j=0;j<arguments.length;j++)M[j]=arguments[j];var K=this.length,b=M.length,g=Array.from(this.$items.values());return M.forEach((function(M,j){Z.setAt(j,M)})),g.forEach((function(M,j){Z.setAt(b+j,M)})),K+b},M.prototype.indexOf=function(Z,M){return Array.from(this.$items.values()).indexOf(Z,M)},M.prototype.lastIndexOf=function(Z,M){return void 0===M&&(M=this.length-1),Array.from(this.$items.values()).lastIndexOf(Z,M)},M.prototype.every=function(Z,M){return Array.from(this.$items.values()).every(Z,M)},M.prototype.some=function(Z,M){return Array.from(this.$items.values()).some(Z,M)},M.prototype.forEach=function(Z,M){Array.from(this.$items.values()).forEach(Z,M)},M.prototype.map=function(Z,M){return Array.from(this.$items.values()).map(Z,M)},M.prototype.filter=function(Z,M){return Array.from(this.$items.values()).filter(Z,M)},M.prototype.reduce=function(Z,M){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},M.prototype.reduceRight=function(Z,M){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},M.prototype.find=function(Z,M){return Array.from(this.$items.values()).find(Z,M)},M.prototype.findIndex=function(Z,M){return Array.from(this.$items.values()).findIndex(Z,M)},M.prototype.fill=function(Z,M,j){throw new Error("ArraySchema#fill() not implemented")},M.prototype.copyWithin=function(Z,M,j){throw new Error("ArraySchema#copyWithin() not implemented")},M.prototype.toString=function(){return this.$items.toString()},M.prototype.toLocaleString=function(){return this.$items.toLocaleString()},M.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(M,Symbol.species,{get:function(){return M},enumerable:!1,configurable:!0}),M.prototype.entries=function(){return this.$items.entries()},M.prototype.keys=function(){return this.$items.keys()},M.prototype.values=function(){return this.$items.values()},M.prototype.includes=function(Z,M){return Array.from(this.$items.values()).includes(Z,M)},M.prototype.flatMap=function(Z,M){throw new Error("ArraySchema#flatMap() is not supported.")},M.prototype.flat=function(Z){throw new Error("ArraySchema#flat() is not supported.")},M.prototype.findLast=function(){var Z=Array.from(this.$items.values());return Z.findLast.apply(Z,arguments)},M.prototype.findLastIndex=function(){var Z=Array.from(this.$items.values());return Z.findLastIndex.apply(Z,arguments)},M.prototype.setIndex=function(Z,M){this.$indexes.set(Z,M)},M.prototype.getIndex=function(Z){return this.$indexes.get(Z)},M.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},M.prototype.deleteByIndex=function(Z){var M=this.$indexes.get(Z);this.$items.delete(M),this.$indexes.delete(Z)},M.prototype.toArray=function(){return Array.from(this.$items.values())},M.prototype.toJSON=function(){return this.toArray().map((function(Z){return"function"===typeof Z.toJSON?Z.toJSON():Z}))},M.prototype.clone=function(Z){return Z?new(M.bind.apply(M,b([void 0],Array.from(this.$items.values()),!1))):new(M.bind.apply(M,b([void 0],this.map((function(Z){return Z.$changes?Z.clone():Z})),!1)))},M}();function V(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,M){return"symbol"!==typeof M&&"undefined"===typeof Z[M]?Z.get(M):Z[M]},set:function(Z,M,j){return"symbol"!==typeof M&&-1===M.indexOf("$")&&"onAdd"!==M&&"onRemove"!==M&&"onChange"!==M?Z.set(M,j):Z[M]=j,!0},deleteProperty:function(Z,M){return Z.delete(M),!0}})}var o=function(){function M(Z){var j=this;if(this.$changes=new Y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z)if(Z instanceof Map||Z instanceof M)Z.forEach((function(Z,M){return j.set(M,Z)}));else for(var K in Z)this.set(K,Z[K])}return M.prototype.onAdd=function(M,j){return void 0===j&&(j=!0),I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,M,j?this.$items:void 0)},M.prototype.onRemove=function(M){return I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,M)},M.is=function(Z){return void 0!==Z.map},M.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(M.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(M,Symbol.species,{get:function(){return M},enumerable:!1,configurable:!0}),M.prototype.set=function(M,j){if(void 0===j||null===j)throw new Error("MapSchema#set('".concat(M,"', ").concat(j,"): trying to set ").concat(j," value on '").concat(M,"'."));M=M.toString();var K="undefined"!==typeof this.$changes.indexes[M],b=K?this.$changes.indexes[M]:this.$refId++,g=K?Z.OPERATION.REPLACE:Z.OPERATION.ADD,O=void 0!==j.$changes;if(O&&j.$changes.setParent(this,this.$changes.root,b),K){if(!O&&this.$items.get(M)===j)return;O&&this.$items.get(M)!==j&&(g=Z.OPERATION.ADD)}else this.$changes.indexes[M]=b,this.$indexes.set(b,M);return this.$items.set(M,j),this.$changes.change(M,g),this},M.prototype.get=function(Z){return this.$items.get(Z)},M.prototype.delete=function(Z){return this.$changes.delete(Z),this.$items.delete(Z)},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&E.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.has=function(Z){return this.$items.has(Z)},M.prototype.forEach=function(Z){this.$items.forEach(Z)},M.prototype.entries=function(){return this.$items.entries()},M.prototype.keys=function(){return this.$items.keys()},M.prototype.values=function(){return this.$items.values()},Object.defineProperty(M.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),M.prototype.setIndex=function(Z,M){this.$indexes.set(Z,M)},M.prototype.getIndex=function(Z){return this.$indexes.get(Z)},M.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},M.prototype.deleteByIndex=function(Z){var M=this.$indexes.get(Z);this.$items.delete(M),this.$indexes.delete(Z)},M.prototype.toJSON=function(){var Z={};return this.forEach((function(M,j){Z[j]="function"===typeof M.toJSON?M.toJSON():M})),Z},M.prototype.clone=function(Z){var j;return Z?j=Object.assign(new M,this):(j=new M,this.forEach((function(Z,M){Z.$changes?j.set(M,Z.clone()):j.set(M,Z)}))),j},M}(),c={};function G(Z,M){c[Z]=M}function f(Z){return c[Z]}var X=function(){function Z(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return Z.create=function(M){var j=new Z;return j.schema=Object.assign({},M&&M.schema||{}),j.indexes=Object.assign({},M&&M.indexes||{}),j.fieldsByIndex=Object.assign({},M&&M.fieldsByIndex||{}),j.descriptors=Object.assign({},M&&M.descriptors||{}),j.deprecated=Object.assign({},M&&M.deprecated||{}),j},Z.prototype.addField=function(Z,M){var j=this.getNextFieldIndex();this.fieldsByIndex[j]=Z,this.indexes[Z]=j,this.schema[Z]=Array.isArray(M)?{array:M[0]}:M},Z.prototype.hasField=function(Z){return void 0!==this.indexes[Z]},Z.prototype.addFilter=function(Z,M){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[Z]]=M,this.indexesWithFilters.push(this.indexes[Z]),!0},Z.prototype.addChildrenFilter=function(Z,M){var j=this.indexes[Z],K=this.schema[Z];if(f(Object.keys(K)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[j]=M,!0;console.warn("@filterChildren: field '".concat(Z,"' can't have children. Ignoring filter."))},Z.prototype.getChildrenFilter=function(Z){return this.childFilters&&this.childFilters[this.indexes[Z]]},Z.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},Z}();function d(Z){return Z._context&&Z._context.useFilters}var W=function(){function Z(){this.types={},this.schemas=new Map,this.useFilters=!1}return Z.prototype.has=function(Z){return this.schemas.has(Z)},Z.prototype.get=function(Z){return this.types[Z]},Z.prototype.add=function(Z,M){void 0===M&&(M=this.schemas.size),Z._definition=X.create(Z._definition),Z._typeid=M,this.types[M]=Z,this.schemas.set(Z,M)},Z.create=function(M){return void 0===M&&(M={}),function(j){return M.context||(M.context=new Z),q(j,M)}},Z}(),A=new W;function q(Z,M){return void 0===M&&(M={}),function(j,K){var g=M.context||A,O=j.constructor;if(O._context=g,!Z)throw new Error("".concat(O.name,': @type() reference provided for "').concat(K,"\" is undefined. Make sure you don't have any circular dependencies."));g.has(O)||g.add(O);var Q=O._definition;if(Q.addField(K,Z),Q.descriptors[K]){if(Q.deprecated[K])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(K,"' definition on '").concat(O.name,"'.\nCheck @type() annotation"))}catch(Z){var Y=Z.stack.split("\n")[4].trim();throw new Error("".concat(Z.message," ").concat(Y))}}var I=z.is(Z),E=!I&&o.is(Z);if("string"!==typeof Z&&!xZ.is(Z)){var s=Object.values(Z)[0];"string"===typeof s||g.has(s)||g.add(s)}if(M.manual)Q.descriptors[K]={enumerable:!0,configurable:!0,writable:!0};else{var i="_".concat(K);Q.descriptors[i]={enumerable:!1,configurable:!1,writable:!0},Q.descriptors[K]={get:function(){return this[i]},set:function(Z){Z!==this[i]&&(void 0!==Z&&null!==Z?(!I||Z instanceof z||(Z=new(z.bind.apply(z,b([void 0],Z,!1)))),!E||Z instanceof o||(Z=new o(Z)),void 0===Z.$proxy&&(E?Z=V(Z):I&&(Z=a(Z))),this.$changes.change(K),Z.$changes&&Z.$changes.setParent(this,this.$changes.root,this._definition.indexes[K])):this[i]&&this.$changes.delete(K),this[i]=Z)},enumerable:!0,configurable:!0}}}}function T(Z){return function(M,j){var K=M.constructor;K._definition.addFilter(j,Z)&&(K._context.useFilters=!0)}}function B(Z){return function(M,j){var K=M.constructor;K._definition.addChildrenFilter(j,Z)&&(K._context.useFilters=!0)}}function N(Z){return void 0===Z&&(Z=!0),function(M,j){var K=M.constructor._definition;K.deprecated[j]=!0,Z&&(K.descriptors[j]={get:function(){throw new Error("".concat(j," is deprecated."))},set:function(Z){},enumerable:!1,configurable:!0})}}function U(Z,M,j){for(var K in void 0===j&&(j={}),j.context||(j.context=Z._context||j.context||A),M)q(M[K],j)(Z.prototype,K);return Z}function n(Z){for(var M=0,j=0,K=0,b=Z.length;K<b;K++)(M=Z.charCodeAt(K))<128?j+=1:M<2048?j+=2:M<55296||M>=57344?j+=3:(K++,j+=4);return j}function k(Z,M,j){for(var K=0,b=0,g=j.length;b<g;b++)(K=j.charCodeAt(b))<128?Z[M++]=K:K<2048?(Z[M++]=192|K>>6,Z[M++]=128|63&K):K<55296||K>=57344?(Z[M++]=224|K>>12,Z[M++]=128|K>>6&63,Z[M++]=128|63&K):(b++,K=65536+((1023&K)<<10|1023&j.charCodeAt(b)),Z[M++]=240|K>>18,Z[M++]=128|K>>12&63,Z[M++]=128|K>>6&63,Z[M++]=128|63&K)}function x(Z,M){Z.push(255&M)}function R(Z,M){Z.push(255&M)}function e(Z,M){Z.push(255&M),Z.push(M>>8&255)}function u(Z,M){Z.push(255&M),Z.push(M>>8&255)}function F(Z,M){Z.push(255&M),Z.push(M>>8&255),Z.push(M>>16&255),Z.push(M>>24&255)}function C(Z,M){var j=M>>24,K=M>>16,b=M>>8,g=M;Z.push(255&g),Z.push(255&b),Z.push(255&K),Z.push(255&j)}function y(Z,M){var j=Math.floor(M/Math.pow(2,32));C(Z,M>>>0),C(Z,j)}function S(Z,M){var j=M/Math.pow(2,32)>>0;C(Z,M>>>0),C(Z,j)}function h(Z,M){P(Z,M)}function w(Z,M){H(Z,M)}var p=new Int32Array(2),m=new Float32Array(p.buffer),J=new Float64Array(p.buffer);function P(Z,M){m[0]=M,F(Z,p[0])}function H(Z,M){J[0]=M,F(Z,p[0]),F(Z,p[1])}function D(Z,M){return R(Z,M?1:0)}function l(Z,M){M||(M="");var j=n(M),K=0;if(j<32)Z.push(160|j),K=1;else if(j<256)Z.push(217),R(Z,j),K=2;else if(j<65536)Z.push(218),u(Z,j),K=3;else{if(!(j<4294967296))throw new Error("String too long");Z.push(219),C(Z,j),K=5}return k(Z,Z.length,M),K+j}function t(Z,M){return isNaN(M)?t(Z,0):isFinite(M)?M!==(0|M)?(Z.push(203),H(Z,M),9):M>=0?M<128?(R(Z,M),1):M<256?(Z.push(204),R(Z,M),2):M<65536?(Z.push(205),u(Z,M),3):M<4294967296?(Z.push(206),C(Z,M),5):(Z.push(207),S(Z,M),9):M>=-32?(Z.push(224|M+32),1):M>=-128?(Z.push(208),x(Z,M),2):M>=-32768?(Z.push(209),e(Z,M),3):M>=-2147483648?(Z.push(210),F(Z,M),5):(Z.push(211),y(Z,M),9):t(Z,M>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var v=Object.freeze({__proto__:null,utf8Write:k,int8:x,uint8:R,int16:e,uint16:u,int32:F,uint32:C,int64:y,uint64:S,float32:h,float64:w,writeFloat32:P,writeFloat64:H,boolean:D,string:l,number:t});function r(Z,M,j){for(var K="",b=0,g=M,O=M+j;g<O;g++){var Q=Z[g];0!==(128&Q)?192!==(224&Q)?224!==(240&Q)?240!==(248&Q)?console.error("Invalid byte "+Q.toString(16)):(b=(7&Q)<<18|(63&Z[++g])<<12|(63&Z[++g])<<6|(63&Z[++g])<<0)>=65536?(b-=65536,K+=String.fromCharCode(55296+(b>>>10),56320+(1023&b))):K+=String.fromCharCode(b):K+=String.fromCharCode((15&Q)<<12|(63&Z[++g])<<6|(63&Z[++g])<<0):K+=String.fromCharCode((31&Q)<<6|63&Z[++g]):K+=String.fromCharCode(Q)}return K}function L(Z,M){return ZZ(Z,M)<<24>>24}function ZZ(Z,M){return Z[M.offset++]}function MZ(Z,M){return jZ(Z,M)<<16>>16}function jZ(Z,M){return Z[M.offset++]|Z[M.offset++]<<8}function KZ(Z,M){return Z[M.offset++]|Z[M.offset++]<<8|Z[M.offset++]<<16|Z[M.offset++]<<24}function bZ(Z,M){return KZ(Z,M)>>>0}function gZ(Z,M){return iZ(Z,M)}function OZ(Z,M){return aZ(Z,M)}function QZ(Z,M){var j=bZ(Z,M);return KZ(Z,M)*Math.pow(2,32)+j}function YZ(Z,M){var j=bZ(Z,M);return bZ(Z,M)*Math.pow(2,32)+j}var IZ=new Int32Array(2),EZ=new Float32Array(IZ.buffer),sZ=new Float64Array(IZ.buffer);function iZ(Z,M){return IZ[0]=KZ(Z,M),EZ[0]}function aZ(Z,M){return IZ[0]=KZ(Z,M),IZ[1]=KZ(Z,M),sZ[0]}function zZ(Z,M){return ZZ(Z,M)>0}function VZ(Z,M){var j,K=Z[M.offset++];K<192?j=31&K:217===K?j=ZZ(Z,M):218===K?j=jZ(Z,M):219===K&&(j=bZ(Z,M));var b=r(Z,M.offset,j);return M.offset+=j,b}function oZ(Z,M){var j=Z[M.offset];return j<192&&j>160||217===j||218===j||219===j}function cZ(Z,M){var j=Z[M.offset++];return j<128?j:202===j?iZ(Z,M):203===j?aZ(Z,M):204===j?ZZ(Z,M):205===j?jZ(Z,M):206===j?bZ(Z,M):207===j?YZ(Z,M):208===j?L(Z,M):209===j?MZ(Z,M):210===j?KZ(Z,M):211===j?QZ(Z,M):j>223?-1*(255-j+1):void 0}function GZ(Z,M){var j=Z[M.offset];return j<128||j>=202&&j<=211}function fZ(Z,M){return Z[M.offset]<160}function XZ(Z,M){return Z[M.offset-1]===O&&(Z[M.offset]<128||Z[M.offset]>=202&&Z[M.offset]<=211)}var dZ=Object.freeze({__proto__:null,int8:L,uint8:ZZ,int16:MZ,uint16:jZ,int32:KZ,uint32:bZ,float32:gZ,float64:OZ,int64:QZ,uint64:YZ,readFloat32:iZ,readFloat64:aZ,boolean:zZ,string:VZ,stringCheck:oZ,number:cZ,numberCheck:GZ,arrayCheck:fZ,switchStructureCheck:XZ}),WZ=function(){function M(Z){var M=this;this.$changes=new Y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return M.add(Z)}))}return M.prototype.onAdd=function(M,j){return void 0===j&&(j=!0),I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,M,j?this.$items:void 0)},M.prototype.onRemove=function(M){return I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,M)},M.is=function(Z){return void 0!==Z.collection},M.prototype.add=function(Z){var M=this.$refId++;return void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,M),this.$changes.indexes[M]=M,this.$indexes.set(M,M),this.$items.set(M,Z),this.$changes.change(M),M},M.prototype.at=function(Z){var M=Array.from(this.$items.keys())[Z];return this.$items.get(M)},M.prototype.entries=function(){return this.$items.entries()},M.prototype.delete=function(Z){for(var M,j,K=this.$items.entries();(j=K.next())&&!j.done;)if(Z===j.value[1]){M=j.value[0];break}return void 0!==M&&(this.$changes.delete(M),this.$indexes.delete(M),this.$items.delete(M))},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&E.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.has=function(Z){return Array.from(this.$items.values()).some((function(M){return M===Z}))},M.prototype.forEach=function(Z){var M=this;this.$items.forEach((function(j,K,b){return Z(j,K,M)}))},M.prototype.values=function(){return this.$items.values()},Object.defineProperty(M.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),M.prototype.setIndex=function(Z,M){this.$indexes.set(Z,M)},M.prototype.getIndex=function(Z){return this.$indexes.get(Z)},M.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},M.prototype.deleteByIndex=function(Z){var M=this.$indexes.get(Z);this.$items.delete(M),this.$indexes.delete(Z)},M.prototype.toArray=function(){return Array.from(this.$items.values())},M.prototype.toJSON=function(){var Z=[];return this.forEach((function(M,j){Z.push("function"===typeof M.toJSON?M.toJSON():M)})),Z},M.prototype.clone=function(Z){var j;return Z?j=Object.assign(new M,this):(j=new M,this.forEach((function(Z){Z.$changes?j.add(Z.clone()):j.add(Z)}))),j},M}(),AZ=function(){function M(Z){var M=this;this.$changes=new Y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return M.add(Z)}))}return M.prototype.onAdd=function(M,j){return void 0===j&&(j=!0),I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,M,j?this.$items:void 0)},M.prototype.onRemove=function(M){return I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,M)},M.is=function(Z){return void 0!==Z.set},M.prototype.add=function(M){var j,K;if(this.has(M))return!1;var b=this.$refId++;void 0!==M.$changes&&M.$changes.setParent(this,this.$changes.root,b);var g=null!==(K=null===(j=this.$changes.indexes[b])||void 0===j?void 0:j.op)&&void 0!==K?K:Z.OPERATION.ADD;return this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,M),this.$changes.change(b,g),b},M.prototype.entries=function(){return this.$items.entries()},M.prototype.delete=function(Z){for(var M,j,K=this.$items.entries();(j=K.next())&&!j.done;)if(Z===j.value[1]){M=j.value[0];break}return void 0!==M&&(this.$changes.delete(M),this.$indexes.delete(M),this.$items.delete(M))},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&E.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.has=function(Z){for(var M,j=this.$items.values(),K=!1;(M=j.next())&&!M.done;)if(Z===M.value){K=!0;break}return K},M.prototype.forEach=function(Z){var M=this;this.$items.forEach((function(j,K,b){return Z(j,K,M)}))},M.prototype.values=function(){return this.$items.values()},Object.defineProperty(M.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),M.prototype.setIndex=function(Z,M){this.$indexes.set(Z,M)},M.prototype.getIndex=function(Z){return this.$indexes.get(Z)},M.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},M.prototype.deleteByIndex=function(Z){var M=this.$indexes.get(Z);this.$items.delete(M),this.$indexes.delete(Z)},M.prototype.toArray=function(){return Array.from(this.$items.values())},M.prototype.toJSON=function(){var Z=[];return this.forEach((function(M,j){Z.push("function"===typeof M.toJSON?M.toJSON():M)})),Z},M.prototype.clone=function(Z){var j;return Z?j=Object.assign(new M,this):(j=new M,this.forEach((function(Z){Z.$changes?j.add(Z.clone()):j.add(Z)}))),j},M}(),qZ=function(){function Z(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return Z.prototype.addRefId=function(Z){this.refIds.has(Z)||(this.refIds.add(Z),this.containerIndexes.set(Z,new Set))},Z.get=function(M){return void 0===M.$filterState&&(M.$filterState=new Z),M.$filterState},Z}(),TZ=function(){function Z(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return Z.prototype.getNextUniqueId=function(){return this.nextUniqueId++},Z.prototype.addRef=function(Z,M,j){void 0===j&&(j=!0),this.refs.set(Z,M),j&&(this.refCounts[Z]=(this.refCounts[Z]||0)+1)},Z.prototype.removeRef=function(Z){this.refCounts[Z]=this.refCounts[Z]-1,this.deletedRefs.add(Z)},Z.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},Z.prototype.garbageCollectDeletedRefs=function(){var Z=this;this.deletedRefs.forEach((function(M){if(!(Z.refCounts[M]>0)){var j=Z.refs.get(M);if(j instanceof xZ)for(var K in j._definition.schema)"string"!==typeof j._definition.schema[K]&&j[K]&&j[K].$changes&&Z.removeRef(j[K].$changes.refId);else{var b=j.$changes.parent._definition,g=b.schema[b.fieldsByIndex[j.$changes.parentIndex]];"function"===typeof Object.values(g)[0]&&Array.from(j.values()).forEach((function(M){return Z.removeRef(M.$changes.refId)}))}Z.refs.delete(M),delete Z.refCounts[M]}})),this.deletedRefs.clear()},Z}(),BZ=function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}return j(M,Z),M}(Error);function NZ(Z,M,j,K){var b,g=!1;switch(M){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":b="number",isNaN(Z)&&console.log('trying to encode "NaN" in '.concat(j.constructor.name,"#").concat(K));break;case"string":b="string",g=!0;break;case"boolean":return}if(typeof Z!==b&&(!g||g&&null!==Z)){var O="'".concat(JSON.stringify(Z),"'").concat(Z&&Z.constructor&&" (".concat(Z.constructor.name,")")||"");throw new BZ("a '".concat(b,"' was expected, but ").concat(O," was provided in ").concat(j.constructor.name,"#").concat(K))}}function UZ(Z,M,j,K){if(!(Z instanceof M))throw new BZ("a '".concat(M.name,"' was expected, but '").concat(Z.constructor.name,"' was provided in ").concat(j.constructor.name,"#").concat(K))}function nZ(Z,M,j,K,b){NZ(j,Z,K,b);var g=v[Z];if(!g)throw new BZ("a '".concat(Z,"' was expected, but ").concat(j," was provided in ").concat(K.constructor.name,"#").concat(b));g(M,j)}function kZ(Z,M,j){return dZ[Z](M,j)}var xZ=function(){function M(){for(var Z=[],M=0;M<arguments.length;M++)Z[M]=arguments[M];Object.defineProperties(this,{$changes:{value:new Y(this,void 0,new TZ),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var j=this._definition.descriptors;j&&Object.defineProperties(this,j),Z[0]&&this.assign(Z[0])}return M.onError=function(Z){console.error(Z)},M.is=function(Z){return Z._definition&&void 0!==Z._definition.schema},M.prototype.onChange=function(M){return I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,M)},M.prototype.onRemove=function(M){return I(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,M)},M.prototype.assign=function(Z){return Object.assign(this,Z),this},Object.defineProperty(M.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),M.prototype.setDirty=function(Z,M){this.$changes.change(Z,M)},M.prototype.listen=function(Z,M,j){var K=this;return void 0===j&&(j=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[Z]||(this.$callbacks[Z]=[]),this.$callbacks[Z].push(M),j&&void 0!==this[Z]&&M(this[Z],void 0),function(){return s(K.$callbacks[Z],K.$callbacks[Z].indexOf(M))}},M.prototype.decode=function(j,K,b){var g;void 0===K&&(K={offset:0}),void 0===b&&(b=this);var Q=[],Y=this.$changes.root,I=j.length,E=0;for(Y.refs.set(E,this);K.offset<I;){var s=j[K.offset++];if(s!=O){var i=b.$changes,a=void 0!==b._definition,V=a?s>>6<<6:s;if(V!==Z.OPERATION.CLEAR){var c=a?s%(V||255):cZ(j,K),G=a?b._definition.fieldsByIndex[c]:"",X=i.getType(c),d=void 0,W=void 0,A=void 0;if(a?W=b["_".concat(G)]:(W=b.getByIndex(c),(V&Z.OPERATION.ADD)===Z.OPERATION.ADD?(A=b instanceof o?VZ(j,K):c,b.setIndex(c,A)):A=b.getIndex(c)),(V&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&(V!==Z.OPERATION.DELETE_AND_ADD&&b.deleteByIndex(c),W&&W.$changes&&Y.removeRef(W.$changes.refId),d=null),void 0!==G){if(V===Z.OPERATION.DELETE);else if(M.is(X)){var q=cZ(j,K);if(d=Y.refs.get(q),V!==Z.OPERATION.REPLACE){var T=this.getSchemaType(j,K,X);d||((d=this.createTypeInstance(T)).$changes.refId=q,W&&(d.$callbacks=W.$callbacks,W.$changes.refId&&q!==W.$changes.refId&&Y.removeRef(W.$changes.refId))),Y.addRef(q,d,d!==W)}}else if("string"===typeof X)d=kZ(X,j,K);else{var B=f(Object.keys(X)[0]),N=cZ(j,K),U=Y.refs.has(N)?W||Y.refs.get(N):new B.constructor;if((d=U.clone(!0)).$changes.refId=N,W&&(d.$callbacks=W.$callbacks,W.$changes.refId&&N!==W.$changes.refId)){Y.removeRef(W.$changes.refId);for(var n=W.entries(),k=void 0;(k=n.next())&&!k.done;){var x=(g=k.value)[0],R=g[1];Q.push({refId:N,op:Z.OPERATION.DELETE,field:x,value:void 0,previousValue:R})}}Y.addRef(N,d,U!==W)}if(null!==d&&void 0!==d)if(d.$changes&&d.$changes.setParent(i.ref,i.root,c),b instanceof M)b[G]=d;else if(b instanceof o)x=A,b.$items.set(x,d),b.$changes.allChanges.add(c);else if(b instanceof z)b.setAt(c,d);else if(b instanceof WZ){var e=b.add(d);b.setIndex(c,e)}else b instanceof AZ&&!1!==(e=b.add(d))&&b.setIndex(c,e);W!==d&&Q.push({refId:E,op:V,field:G,dynamicIndex:A,value:d,previousValue:W})}else{console.warn("@colyseus/schema: definition mismatch");for(var u={offset:K.offset};K.offset<I&&(!XZ(j,K)||(u.offset=K.offset+1,!Y.refs.has(cZ(j,u))));)K.offset++}}else b.clear(Q)}else{E=cZ(j,K);var F=Y.refs.get(E);if(!F)throw new Error('"refId" not found: '.concat(E));b=F}}return this._triggerChanges(Q),Y.garbageCollectDeletedRefs(),Q},M.prototype.encode=function(j,K,b){void 0===j&&(j=!1),void 0===K&&(K=[]),void 0===b&&(b=!1);for(var g=this.$changes,Q=new WeakSet,Y=[g],I=1,E=0;E<I;E++){var s=Y[E],i=s.ref,a=i instanceof M;s.ensureRefId(),Q.add(s),s!==g&&(s.changed||j)&&(R(K,O),t(K,s.refId));for(var z=j?Array.from(s.allChanges):Array.from(s.changes.values()),V=0,c=z.length;V<c;V++){var G=j?{op:Z.OPERATION.ADD,index:z[V]}:z[V],X=G.index,d=a?i._definition.fieldsByIndex&&i._definition.fieldsByIndex[X]:X,W=K.length;if(G.op!==Z.OPERATION.TOUCH)if(a)R(K,X|G.op);else{if(R(K,G.op),G.op===Z.OPERATION.CLEAR)continue;t(K,X)}if(a||(G.op&Z.OPERATION.ADD)!=Z.OPERATION.ADD||i instanceof o&&l(K,s.ref.$indexes.get(X)),G.op!==Z.OPERATION.DELETE){var A=s.getType(X),q=s.getValue(X);if(q&&q.$changes&&!Q.has(q.$changes)&&(Y.push(q.$changes),q.$changes.ensureRefId(),I++),G.op!==Z.OPERATION.TOUCH){if(M.is(A))UZ(q,A,i,d),t(K,q.$changes.refId),(G.op&Z.OPERATION.ADD)===Z.OPERATION.ADD&&this.tryEncodeTypeId(K,A,q.constructor);else if("string"===typeof A)nZ(A,K,q,i,d);else{var T=f(Object.keys(A)[0]);UZ(i["_".concat(d)],T.constructor,i,d),t(K,q.$changes.refId)}b&&s.cache(X,K.slice(W))}}}j||b||s.discard()}return K},M.prototype.encodeAll=function(Z){return this.encode(!0,[],Z)},M.prototype.applyFilters=function(j,K){var b,g;void 0===K&&(K=!1);for(var Q=this,Y=new Set,I=qZ.get(j),E=[this.$changes],s=1,i=[],a=function(a){var z=E[a];if(Y.has(z.refId))return"continue";var V=z.ref,c=V instanceof M;R(i,O),t(i,z.refId);var G=I.refIds.has(z),f=K||!G;I.addRefId(z);var X=I.containerIndexes.get(z),d=f?Array.from(z.allChanges):Array.from(z.changes.values());!K&&c&&V._definition.indexesWithFilters&&V._definition.indexesWithFilters.forEach((function(M){!X.has(M)&&z.allChanges.has(M)&&(f?d.push(M):d.push({op:Z.OPERATION.ADD,index:M}))}));for(var W=0,A=d.length;W<A;W++){var q=f?{op:Z.OPERATION.ADD,index:d[W]}:d[W];if(q.op!==Z.OPERATION.CLEAR){var T=q.index;if(q.op!==Z.OPERATION.DELETE){var B=z.getValue(T),N=z.getType(T);if(c){if((U=V._definition.filters&&V._definition.filters[T])&&!U.call(V,j,B,Q)){B&&B.$changes&&Y.add(B.$changes.refId);continue}}else{var U,n=z.parent;if((U=z.getChildrenFilter())&&!U.call(n,j,V.$indexes.get(T),B,Q)){B&&B.$changes&&Y.add(B.$changes.refId);continue}}if(B.$changes&&(E.push(B.$changes),s++),q.op!==Z.OPERATION.TOUCH)if(q.op===Z.OPERATION.ADD||c)i.push.apply(i,null!==(b=z.caches[T])&&void 0!==b?b:[]),X.add(T);else if(X.has(T))i.push.apply(i,null!==(g=z.caches[T])&&void 0!==g?g:[]);else{if(X.add(T),R(i,Z.OPERATION.ADD),t(i,T),V instanceof o){var k=z.ref.$indexes.get(T);l(i,k)}B.$changes?t(i,B.$changes.refId):v[N](i,B)}else B.$changes&&!c&&(R(i,Z.OPERATION.ADD),t(i,T),V instanceof o&&(k=z.ref.$indexes.get(T),l(i,k)),t(i,B.$changes.refId))}else c?R(i,q.op|T):(R(i,q.op),t(i,T))}else R(i,q.op)}},z=0;z<s;z++)a(z);return i},M.prototype.clone=function(){var Z,M=new this.constructor,j=this._definition.schema;for(var K in j)"object"===typeof this[K]&&"function"===typeof(null===(Z=this[K])||void 0===Z?void 0:Z.clone)?M[K]=this[K].clone():M[K]=this[K];return M},M.prototype.toJSON=function(){var Z=this._definition.schema,M=this._definition.deprecated,j={};for(var K in Z)M[K]||null===this[K]||"undefined"===typeof this[K]||(j[K]="function"===typeof this[K].toJSON?this[K].toJSON():this["_".concat(K)]);return j},M.prototype.discardAllChanges=function(){this.$changes.discardAll()},M.prototype.getByIndex=function(Z){return this[this._definition.fieldsByIndex[Z]]},M.prototype.deleteByIndex=function(Z){this[this._definition.fieldsByIndex[Z]]=void 0},M.prototype.tryEncodeTypeId=function(Z,M,j){M._typeid!==j._typeid&&(R(Z,Q),t(Z,j._typeid))},M.prototype.getSchemaType=function(Z,M,j){var K;return Z[M.offset]===Q&&(M.offset++,K=this.constructor._context.get(cZ(Z,M))),K||j},M.prototype.createTypeInstance=function(Z){var M=new Z;return M.$changes.root=this.$changes.root,M},M.prototype._triggerChanges=function(j){for(var K,b,g,O,Q,Y,I,E,s,i=new Set,a=this.$changes.root.refs,z=function(z){var V=j[z],o=V.refId,c=a.get(o),G=c.$callbacks;if((V.op&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&V.previousValue instanceof M&&(null===(b=null===(K=V.previousValue.$callbacks)||void 0===K?void 0:K[Z.OPERATION.DELETE])||void 0===b||b.forEach((function(Z){return Z()}))),!G)return"continue";if(c instanceof M){if(!i.has(o))try{null===(g=null===G||void 0===G?void 0:G[Z.OPERATION.REPLACE])||void 0===g||g.forEach((function(Z){return Z()}))}catch(Z){M.onError(Z)}try{G.hasOwnProperty(V.field)&&(null===(O=G[V.field])||void 0===O||O.forEach((function(Z){return Z(V.value,V.previousValue)})))}catch(Z){M.onError(Z)}}else V.op===Z.OPERATION.ADD&&void 0===V.previousValue?null===(Q=G[Z.OPERATION.ADD])||void 0===Q||Q.forEach((function(Z){var M;return Z(V.value,null!==(M=V.dynamicIndex)&&void 0!==M?M:V.field)})):V.op===Z.OPERATION.DELETE?void 0!==V.previousValue&&(null===(Y=G[Z.OPERATION.DELETE])||void 0===Y||Y.forEach((function(Z){var M;return Z(V.previousValue,null!==(M=V.dynamicIndex)&&void 0!==M?M:V.field)}))):V.op===Z.OPERATION.DELETE_AND_ADD&&(void 0!==V.previousValue&&(null===(I=G[Z.OPERATION.DELETE])||void 0===I||I.forEach((function(Z){var M;return Z(V.previousValue,null!==(M=V.dynamicIndex)&&void 0!==M?M:V.field)}))),null===(E=G[Z.OPERATION.ADD])||void 0===E||E.forEach((function(Z){var M;return Z(V.value,null!==(M=V.dynamicIndex)&&void 0!==M?M:V.field)}))),V.value!==V.previousValue&&(null===(s=G[Z.OPERATION.REPLACE])||void 0===s||s.forEach((function(Z){var M;return Z(V.value,null!==(M=V.dynamicIndex)&&void 0!==M?M:V.field)})));i.add(o)},V=0;V<j.length;V++)z(V)},M._definition=X.create(),M}();function RZ(Z){for(var M=[Z.$changes],j=1,K={},b=K,g=function(Z){var j=M[Z];j.changes.forEach((function(Z){var M=j.ref,K=Z.index,g=M._definition?M._definition.fieldsByIndex[K]:M.$indexes.get(K);b[g]=j.getValue(K)}))},O=0;O<j;O++)g(O);return K}var eZ={context:new W},uZ=function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}return j(M,Z),K([q("string",eZ)],M.prototype,"name",void 0),K([q("string",eZ)],M.prototype,"type",void 0),K([q("number",eZ)],M.prototype,"referencedType",void 0),M}(xZ),FZ=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.fields=new z,M}return j(M,Z),K([q("number",eZ)],M.prototype,"id",void 0),K([q([uZ],eZ)],M.prototype,"fields",void 0),M}(xZ),CZ=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.types=new z,M}return j(M,Z),M.encode=function(Z){var j=Z.constructor,K=new M;K.rootType=j._typeid;var b=function(Z,M){for(var j in M){var b=new uZ;b.name=j;var g=void 0;if("string"===typeof M[j])g=M[j];else{var O=M[j],Q=void 0;xZ.is(O)?(g="ref",Q=M[j]):"string"===typeof O[g=Object.keys(O)[0]]?g+=":"+O[g]:Q=O[g],b.referencedType=Q?Q._typeid:-1}b.type=g,Z.fields.push(b)}K.types.push(Z)},g=j._context.types;for(var O in g){var Q=new FZ;Q.id=Number(O),b(Q,g[O]._definition.schema)}return K.encodeAll()},M.decode=function(Z,K){var b=new W,g=new M;g.decode(Z,K);var O=g.types.reduce((function(Z,M){var K=function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}return j(M,Z),M}(xZ),g=M.id;return Z[g]=K,b.add(K,g),Z}),{});g.types.forEach((function(Z){var M=O[Z.id];Z.fields.forEach((function(Z){var j;if(void 0!==Z.referencedType){var K=Z.type,g=O[Z.referencedType];if(!g){var Q=Z.type.split(":");K=Q[0],g=Q[1]}"ref"===K?q(g,{context:b})(M.prototype,Z.name):q(((j={})[K]=g,j),{context:b})(M.prototype,Z.name)}else q(Z.type,{context:b})(M.prototype,Z.name)}))}));var Q=O[g.rootType],Y=new Q;for(var I in Q._definition.schema){var E=Q._definition.schema[I];"string"!==typeof E&&(Y[I]="function"===typeof E?new E:new(f(Object.keys(E)[0]).constructor))}return Y},K([q([FZ],eZ)],M.prototype,"types",void 0),K([q("number",eZ)],M.prototype,"rootType",void 0),M}(xZ);G("map",{constructor:o}),G("array",{constructor:z}),G("set",{constructor:AZ}),G("collection",{constructor:WZ}),Z.ArraySchema=z,Z.CollectionSchema=WZ,Z.Context=W,Z.MapSchema=o,Z.Reflection=CZ,Z.ReflectionField=uZ,Z.ReflectionType=FZ,Z.Schema=xZ,Z.SchemaDefinition=X,Z.SetSchema=AZ,Z.decode=dZ,Z.defineTypes=U,Z.deprecated=N,Z.dumpChanges=RZ,Z.encode=v,Z.filter=T,Z.filterChildren=B,Z.hasFilter=d,Z.registerType=G,Z.type=q,Object.defineProperty(Z,"__esModule",{value:!0})}(M)},81238:function(Z){"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12628:function(Z,M,j){var K=j(81238),b=j(52796),g=Object.hasOwnProperty,O=Object.create(null);for(var Q in K)g.call(K,Q)&&(O[K[Q]]=Q);var Y=Z.exports={to:{},get:{}};function I(Z,M,j){return Math.min(Math.max(M,Z),j)}function E(Z){var M=Math.round(Z).toString(16).toUpperCase();return M.length<2?"0"+M:M}Y.get=function(Z){var M,j;switch(Z.substring(0,3).toLowerCase()){case"hsl":M=Y.get.hsl(Z),j="hsl";break;case"hwb":M=Y.get.hwb(Z),j="hwb";break;default:M=Y.get.rgb(Z),j="rgb"}return M?{model:j,value:M}:null},Y.get.rgb=function(Z){if(!Z)return null;var M,j,b,O=[0,0,0,1];if(M=Z.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(b=M[2],M=M[1],j=0;j<3;j++){var Q=2*j;O[j]=parseInt(M.slice(Q,Q+2),16)}b&&(O[3]=parseInt(b,16)/255)}else if(M=Z.match(/^#([a-f0-9]{3,4})$/i)){for(b=(M=M[1])[3],j=0;j<3;j++)O[j]=parseInt(M[j]+M[j],16);b&&(O[3]=parseInt(b+b,16)/255)}else if(M=Z.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(j=0;j<3;j++)O[j]=parseInt(M[j+1],0);M[4]&&(M[5]?O[3]=.01*parseFloat(M[4]):O[3]=parseFloat(M[4]))}else{if(!(M=Z.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(M=Z.match(/^(\w+)$/))?"transparent"===M[1]?[0,0,0,0]:g.call(K,M[1])?((O=K[M[1]])[3]=1,O):null:null;for(j=0;j<3;j++)O[j]=Math.round(2.55*parseFloat(M[j+1]));M[4]&&(M[5]?O[3]=.01*parseFloat(M[4]):O[3]=parseFloat(M[4]))}for(j=0;j<3;j++)O[j]=I(O[j],0,255);return O[3]=I(O[3],0,1),O},Y.get.hsl=function(Z){if(!Z)return null;var M=Z.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(M){var j=parseFloat(M[4]);return[(parseFloat(M[1])%360+360)%360,I(parseFloat(M[2]),0,100),I(parseFloat(M[3]),0,100),I(isNaN(j)?1:j,0,1)]}return null},Y.get.hwb=function(Z){if(!Z)return null;var M=Z.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(M){var j=parseFloat(M[4]);return[(parseFloat(M[1])%360+360)%360,I(parseFloat(M[2]),0,100),I(parseFloat(M[3]),0,100),I(isNaN(j)?1:j,0,1)]}return null},Y.to.hex=function(){var Z=b(arguments);return"#"+E(Z[0])+E(Z[1])+E(Z[2])+(Z[3]<1?E(Math.round(255*Z[3])):"")},Y.to.rgb=function(){var Z=b(arguments);return Z.length<4||1===Z[3]?"rgb("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+")":"rgba("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+", "+Z[3]+")"},Y.to.rgb.percent=function(){var Z=b(arguments),M=Math.round(Z[0]/255*100),j=Math.round(Z[1]/255*100),K=Math.round(Z[2]/255*100);return Z.length<4||1===Z[3]?"rgb("+M+"%, "+j+"%, "+K+"%)":"rgba("+M+"%, "+j+"%, "+K+"%, "+Z[3]+")"},Y.to.hsl=function(){var Z=b(arguments);return Z.length<4||1===Z[3]?"hsl("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%)":"hsla("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%, "+Z[3]+")"},Y.to.hwb=function(){var Z=b(arguments),M="";return Z.length>=4&&1!==Z[3]&&(M=", "+Z[3]),"hwb("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%"+M+")"},Y.to.keyword=function(Z){return O[Z.slice(0,3)]}},32901:function(Z,M,j){for(var K=j(27424).default,b=j(74704).default,g=j(861).default,O=j(12628),Q=j(43143),Y=["keyword","gray","hex"],I={},E=0,s=Object.keys(Q);E<s.length;E++){var i=s[E];I[g(Q[i].labels).sort().join("")]=i}var a={};function z(Z,M){if(!(this instanceof z))return new z(Z,M);if(M&&M in Y&&(M=null),M&&!(M in Q))throw new Error("Unknown model: "+M);var j,K;if(null==Z)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(Z instanceof z)this.model=Z.model,this.color=g(Z.color),this.valpha=Z.valpha;else if("string"===typeof Z){var b=O.get(Z);if(null===b)throw new Error("Unable to parse color from string: "+Z);this.model=b.model,K=Q[this.model].channels,this.color=b.value.slice(0,K),this.valpha="number"===typeof b.value[K]?b.value[K]:1}else if(Z.length>0){this.model=M||"rgb",K=Q[this.model].channels;var E=Array.prototype.slice.call(Z,0,K);this.color=d(E,K),this.valpha="number"===typeof Z[K]?Z[K]:1}else if("number"===typeof Z)this.model="rgb",this.color=[Z>>16&255,Z>>8&255,255&Z],this.valpha=1;else{this.valpha=1;var s=Object.keys(Z);"alpha"in Z&&(s.splice(s.indexOf("alpha"),1),this.valpha="number"===typeof Z.alpha?Z.alpha:0);var i=s.sort().join("");if(!(i in I))throw new Error("Unable to parse color from object: "+JSON.stringify(Z));this.model=I[i];var V=Q[this.model].labels,o=[];for(j=0;j<V.length;j++)o.push(Z[V[j]]);this.color=d(o)}if(a[this.model])for(K=Q[this.model].channels,j=0;j<K;j++){var c=a[this.model][j];c&&(this.color[j]=c(this.color[j]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}z.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(Z){var M=this.model in O.to?this:this.rgb(),j=1===(M=M.round("number"===typeof Z?Z:1)).valpha?M.color:[].concat(g(M.color),[this.valpha]);return O.to[M.model](j)},percentString:function(Z){var M=this.rgb().round("number"===typeof Z?Z:1),j=1===M.valpha?M.color:[].concat(g(M.color),[this.valpha]);return O.to.rgb.percent(j)},array:function(){return 1===this.valpha?g(this.color):[].concat(g(this.color),[this.valpha])},object:function(){for(var Z={},M=Q[this.model].channels,j=Q[this.model].labels,K=0;K<M;K++)Z[j[K]]=this.color[K];return 1!==this.valpha&&(Z.alpha=this.valpha),Z},unitArray:function(){var Z=this.rgb().color;return Z[0]/=255,Z[1]/=255,Z[2]/=255,1!==this.valpha&&Z.push(this.valpha),Z},unitObject:function(){var Z=this.rgb().object();return Z.r/=255,Z.g/=255,Z.b/=255,1!==this.valpha&&(Z.alpha=this.valpha),Z},round:function(Z){return Z=Math.max(Z||0,0),new z([].concat(g(this.color.map(function(Z){return function(M){return function(Z,M){return Number(Z.toFixed(M))}(M,Z)}}(Z))),[this.valpha]),this.model)},alpha:function(Z){return void 0!==Z?new z([].concat(g(this.color),[Math.max(0,Math.min(1,Z))]),this.model):this.valpha},red:G("rgb",0,f(255)),green:G("rgb",1,f(255)),blue:G("rgb",2,f(255)),hue:G(["hsl","hsv","hsl","hwb","hcg"],0,(function(Z){return(Z%360+360)%360})),saturationl:G("hsl",1,f(100)),lightness:G("hsl",2,f(100)),saturationv:G("hsv",1,f(100)),value:G("hsv",2,f(100)),chroma:G("hcg",1,f(100)),gray:G("hcg",2,f(100)),white:G("hwb",1,f(100)),wblack:G("hwb",2,f(100)),cyan:G("cmyk",0,f(100)),magenta:G("cmyk",1,f(100)),yellow:G("cmyk",2,f(100)),black:G("cmyk",3,f(100)),x:G("xyz",0,f(95.047)),y:G("xyz",1,f(100)),z:G("xyz",2,f(108.833)),l:G("lab",0,f(100)),a:G("lab",1),b:G("lab",2),keyword:function(Z){return void 0!==Z?new z(Z):Q[this.model].keyword(this.color)},hex:function(Z){return void 0!==Z?new z(Z):O.to.hex(this.rgb().round().color)},hexa:function(Z){if(void 0!==Z)return new z(Z);var M=this.rgb().round().color,j=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===j.length&&(j="0"+j),O.to.hex(M)+j},rgbNumber:function(){var Z=this.rgb().color;return(255&Z[0])<<16|(255&Z[1])<<8|255&Z[2]},luminosity:function(){var Z,M=this.rgb().color,j=[],g=b(M.entries());try{for(g.s();!(Z=g.n()).done;){var O=K(Z.value,2),Q=O[0],Y=O[1]/255;j[Q]=Y<=.04045?Y/12.92:Math.pow((Y+.055)/1.055,2.4)}}catch(Z){g.e(Z)}finally{g.f()}return.2126*j[0]+.7152*j[1]+.0722*j[2]},contrast:function(Z){var M=this.luminosity(),j=Z.luminosity();return M>j?(M+.05)/(j+.05):(j+.05)/(M+.05)},level:function(Z){var M=this.contrast(Z);return M>=7?"AAA":M>=4.5?"AA":""},isDark:function(){var Z=this.rgb().color;return(2126*Z[0]+7152*Z[1]+722*Z[2])/1e4<128},isLight:function(){return!this.isDark()},negate:function(){for(var Z=this.rgb(),M=0;M<3;M++)Z.color[M]=255-Z.color[M];return Z},lighten:function(Z){var M=this.hsl();return M.color[2]+=M.color[2]*Z,M},darken:function(Z){var M=this.hsl();return M.color[2]-=M.color[2]*Z,M},saturate:function(Z){var M=this.hsl();return M.color[1]+=M.color[1]*Z,M},desaturate:function(Z){var M=this.hsl();return M.color[1]-=M.color[1]*Z,M},whiten:function(Z){var M=this.hwb();return M.color[1]+=M.color[1]*Z,M},blacken:function(Z){var M=this.hwb();return M.color[2]+=M.color[2]*Z,M},grayscale:function(){var Z=this.rgb().color,M=.3*Z[0]+.59*Z[1]+.11*Z[2];return z.rgb(M,M,M)},fade:function(Z){return this.alpha(this.valpha-this.valpha*Z)},opaquer:function(Z){return this.alpha(this.valpha+this.valpha*Z)},rotate:function(Z){var M=this.hsl(),j=M.color[0];return j=(j=(j+Z)%360)<0?360+j:j,M.color[0]=j,M},mix:function(Z,M){if(!Z||!Z.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof Z);var j=Z.rgb(),K=this.rgb(),b=void 0===M?.5:M,g=2*b-1,O=j.alpha()-K.alpha(),Q=((g*O===-1?g:(g+O)/(1+g*O))+1)/2,Y=1-Q;return z.rgb(Q*j.red()+Y*K.red(),Q*j.green()+Y*K.green(),Q*j.blue()+Y*K.blue(),j.alpha()*b+K.alpha()*(1-b))}};for(var V=function(){var Z=c[o];if(Y.includes(Z))return"continue";var M=Q[Z].channels;z.prototype[Z]=function(){if(this.model===Z)return new z(this);for(var M=arguments.length,j=new Array(M),K=0;K<M;K++)j[K]=arguments[K];return j.length>0?new z(j,Z):new z([].concat(g(X(Q[this.model][Z].raw(this.color))),[this.valpha]),Z)},z[Z]=function(){for(var j=arguments.length,K=new Array(j),b=0;b<j;b++)K[b]=arguments[b];var g=K[0];return"number"===typeof g&&(g=d(K,M)),new z(g,Z)}},o=0,c=Object.keys(Q);o<c.length;o++)V();function G(Z,M,j){Z=Array.isArray(Z)?Z:[Z];var K,g=b(Z);try{for(g.s();!(K=g.n()).done;){var O=K.value;(a[O]||(a[O]=[]))[M]=j}}catch(Z){g.e(Z)}finally{g.f()}return Z=Z[0],function(K){var b;return void 0!==K?(j&&(K=j(K)),(b=this[Z]()).color[M]=K,b):(b=this[Z]().color[M],j&&(b=j(b)),b)}}function f(Z){return function(M){return Math.max(0,Math.min(Z,M))}}function X(Z){return Array.isArray(Z)?Z:[Z]}function d(Z,M){for(var j=0;j<M;j++)"number"!==typeof Z[j]&&(Z[j]=0);return Z}Z.exports=z},20198:function(Z,M,j){for(var K=j(27424).default,b=j(15987),g={},O=0,Q=Object.keys(b);O<Q.length;O++){var Y=Q[O];g[b[Y]]=Y}var I={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Z.exports=I;for(var E=0,s=Object.keys(I);E<s.length;E++){var i=s[E];if(!("channels"in I[i]))throw new Error("missing channels property: "+i);if(!("labels"in I[i]))throw new Error("missing channel labels property: "+i);if(I[i].labels.length!==I[i].channels)throw new Error("channel and label counts mismatch: "+i);var a=I[i],z=a.channels,V=a.labels;delete I[i].channels,delete I[i].labels,Object.defineProperty(I[i],"channels",{value:z}),Object.defineProperty(I[i],"labels",{value:V})}I.rgb.hsl=function(Z){var M,j=Z[0]/255,K=Z[1]/255,b=Z[2]/255,g=Math.min(j,K,b),O=Math.max(j,K,b),Q=O-g;O===g?M=0:j===O?M=(K-b)/Q:K===O?M=2+(b-j)/Q:b===O&&(M=4+(j-K)/Q),(M=Math.min(60*M,360))<0&&(M+=360);var Y=(g+O)/2;return[M,100*(O===g?0:Y<=.5?Q/(O+g):Q/(2-O-g)),100*Y]},I.rgb.hsv=function(Z){var M,j,K,b,g,O=Z[0]/255,Q=Z[1]/255,Y=Z[2]/255,I=Math.max(O,Q,Y),E=I-Math.min(O,Q,Y),s=function(Z){return(I-Z)/6/E+.5};return 0===E?(b=0,g=0):(g=E/I,M=s(O),j=s(Q),K=s(Y),O===I?b=K-j:Q===I?b=1/3+M-K:Y===I&&(b=2/3+j-M),b<0?b+=1:b>1&&(b-=1)),[360*b,100*g,100*I]},I.rgb.hwb=function(Z){var M=Z[0],j=Z[1],K=Z[2];return[I.rgb.hsl(Z)[0],100*(1/255*Math.min(M,Math.min(j,K))),100*(K=1-1/255*Math.max(M,Math.max(j,K)))]},I.rgb.cmyk=function(Z){var M=Z[0]/255,j=Z[1]/255,K=Z[2]/255,b=Math.min(1-M,1-j,1-K);return[100*((1-M-b)/(1-b)||0),100*((1-j-b)/(1-b)||0),100*((1-K-b)/(1-b)||0),100*b]},I.rgb.keyword=function(Z){var M=g[Z];if(M)return M;for(var j,K,O,Q=1/0,Y=0,I=Object.keys(b);Y<I.length;Y++){var E=I[Y],s=b[E],i=(K=Z,O=s,Math.pow(K[0]-O[0],2)+Math.pow(K[1]-O[1],2)+Math.pow(K[2]-O[2],2));i<Q&&(Q=i,j=E)}return j},I.keyword.rgb=function(Z){return b[Z]},I.rgb.xyz=function(Z){var M=Z[0]/255,j=Z[1]/255,K=Z[2]/255;return[100*(.4124*(M=M>.04045?Math.pow((M+.055)/1.055,2.4):M/12.92)+.3576*(j=j>.04045?Math.pow((j+.055)/1.055,2.4):j/12.92)+.1805*(K=K>.04045?Math.pow((K+.055)/1.055,2.4):K/12.92)),100*(.2126*M+.7152*j+.0722*K),100*(.0193*M+.1192*j+.9505*K)]},I.rgb.lab=function(Z){var M=I.rgb.xyz(Z),j=M[0],K=M[1],b=M[2];return K/=100,b/=108.883,j=(j/=95.047)>.008856?Math.pow(j,1/3):7.787*j+16/116,[116*(K=K>.008856?Math.pow(K,1/3):7.787*K+16/116)-16,500*(j-K),200*(K-(b=b>.008856?Math.pow(b,1/3):7.787*b+16/116))]},I.hsl.rgb=function(Z){var M,j,K,b=Z[0]/360,g=Z[1]/100,O=Z[2]/100;if(0===g)return[K=255*O,K,K];for(var Q=2*O-(M=O<.5?O*(1+g):O+g-O*g),Y=[0,0,0],I=0;I<3;I++)(j=b+1/3*-(I-1))<0&&j++,j>1&&j--,K=6*j<1?Q+6*(M-Q)*j:2*j<1?M:3*j<2?Q+(M-Q)*(2/3-j)*6:Q,Y[I]=255*K;return Y},I.hsl.hsv=function(Z){var M=Z[0],j=Z[1]/100,K=Z[2]/100,b=j,g=Math.max(K,.01);return j*=(K*=2)<=1?K:2-K,b*=g<=1?g:2-g,[M,100*(0===K?2*b/(g+b):2*j/(K+j)),100*((K+j)/2)]},I.hsv.rgb=function(Z){var M=Z[0]/60,j=Z[1]/100,K=Z[2]/100,b=Math.floor(M)%6,g=M-Math.floor(M),O=255*K*(1-j),Q=255*K*(1-j*g),Y=255*K*(1-j*(1-g));switch(K*=255,b){case 0:return[K,Y,O];case 1:return[Q,K,O];case 2:return[O,K,Y];case 3:return[O,Q,K];case 4:return[Y,O,K];case 5:return[K,O,Q]}},I.hsv.hsl=function(Z){var M,j,K=Z[0],b=Z[1]/100,g=Z[2]/100,O=Math.max(g,.01);j=(2-b)*g;var Q=(2-b)*O;return M=b*O,[K,100*(M=(M/=Q<=1?Q:2-Q)||0),100*(j/=2)]},I.hwb.rgb=function(Z){var M,j=Z[0]/360,K=Z[1]/100,b=Z[2]/100,g=K+b;g>1&&(K/=g,b/=g);var O=Math.floor(6*j),Q=1-b;M=6*j-O,0!==(1&O)&&(M=1-M);var Y,I,E,s=K+M*(Q-K);switch(O){default:case 6:case 0:Y=Q,I=s,E=K;break;case 1:Y=s,I=Q,E=K;break;case 2:Y=K,I=Q,E=s;break;case 3:Y=K,I=s,E=Q;break;case 4:Y=s,I=K,E=Q;break;case 5:Y=Q,I=K,E=s}return[255*Y,255*I,255*E]},I.cmyk.rgb=function(Z){var M=Z[0]/100,j=Z[1]/100,K=Z[2]/100,b=Z[3]/100;return[255*(1-Math.min(1,M*(1-b)+b)),255*(1-Math.min(1,j*(1-b)+b)),255*(1-Math.min(1,K*(1-b)+b))]},I.xyz.rgb=function(Z){var M,j,K,b=Z[0]/100,g=Z[1]/100,O=Z[2]/100;return j=-.9689*b+1.8758*g+.0415*O,K=.0557*b+-.204*g+1.057*O,M=(M=3.2406*b+-1.5372*g+-.4986*O)>.0031308?1.055*Math.pow(M,1/2.4)-.055:12.92*M,j=j>.0031308?1.055*Math.pow(j,1/2.4)-.055:12.92*j,K=K>.0031308?1.055*Math.pow(K,1/2.4)-.055:12.92*K,[255*(M=Math.min(Math.max(0,M),1)),255*(j=Math.min(Math.max(0,j),1)),255*(K=Math.min(Math.max(0,K),1))]},I.xyz.lab=function(Z){var M=Z[0],j=Z[1],K=Z[2];return j/=100,K/=108.883,M=(M/=95.047)>.008856?Math.pow(M,1/3):7.787*M+16/116,[116*(j=j>.008856?Math.pow(j,1/3):7.787*j+16/116)-16,500*(M-j),200*(j-(K=K>.008856?Math.pow(K,1/3):7.787*K+16/116))]},I.lab.xyz=function(Z){var M,j,K,b=Z[0];M=Z[1]/500+(j=(b+16)/116),K=j-Z[2]/200;var g=Math.pow(j,3),O=Math.pow(M,3),Q=Math.pow(K,3);return j=g>.008856?g:(j-16/116)/7.787,M=O>.008856?O:(M-16/116)/7.787,K=Q>.008856?Q:(K-16/116)/7.787,[M*=95.047,j*=100,K*=108.883]},I.lab.lch=function(Z){var M,j=Z[0],K=Z[1],b=Z[2];return(M=360*Math.atan2(b,K)/2/Math.PI)<0&&(M+=360),[j,Math.sqrt(K*K+b*b),M]},I.lch.lab=function(Z){var M=Z[0],j=Z[1],K=Z[2]/360*2*Math.PI;return[M,j*Math.cos(K),j*Math.sin(K)]},I.rgb.ansi16=function(Z){var M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=K(Z,3),b=j[0],g=j[1],O=j[2],Q=null===M?I.rgb.hsv(Z)[2]:M;if(0===(Q=Math.round(Q/50)))return 30;var Y=30+(Math.round(O/255)<<2|Math.round(g/255)<<1|Math.round(b/255));return 2===Q&&(Y+=60),Y},I.hsv.ansi16=function(Z){return I.rgb.ansi16(I.hsv.rgb(Z),Z[2])},I.rgb.ansi256=function(Z){var M=Z[0],j=Z[1],K=Z[2];return M===j&&j===K?M<8?16:M>248?231:Math.round((M-8)/247*24)+232:16+36*Math.round(M/255*5)+6*Math.round(j/255*5)+Math.round(K/255*5)},I.ansi16.rgb=function(Z){var M=Z%10;if(0===M||7===M)return Z>50&&(M+=3.5),[M=M/10.5*255,M,M];var j=.5*(1+~~(Z>50));return[(1&M)*j*255,(M>>1&1)*j*255,(M>>2&1)*j*255]},I.ansi256.rgb=function(Z){if(Z>=232){var M=10*(Z-232)+8;return[M,M,M]}var j;return Z-=16,[Math.floor(Z/36)/5*255,Math.floor((j=Z%36)/6)/5*255,j%6/5*255]},I.rgb.hex=function(Z){var M=(((255&Math.round(Z[0]))<<16)+((255&Math.round(Z[1]))<<8)+(255&Math.round(Z[2]))).toString(16).toUpperCase();return"000000".substring(M.length)+M},I.hex.rgb=function(Z){var M=Z.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!M)return[0,0,0];var j=M[0];3===M[0].length&&(j=j.split("").map((function(Z){return Z+Z})).join(""));var K=parseInt(j,16);return[K>>16&255,K>>8&255,255&K]},I.rgb.hcg=function(Z){var M,j=Z[0]/255,K=Z[1]/255,b=Z[2]/255,g=Math.max(Math.max(j,K),b),O=Math.min(Math.min(j,K),b),Q=g-O;return M=Q<=0?0:g===j?(K-b)/Q%6:g===K?2+(b-j)/Q:4+(j-K)/Q,M/=6,[360*(M%=1),100*Q,100*(Q<1?O/(1-Q):0)]},I.hsl.hcg=function(Z){var M=Z[1]/100,j=Z[2]/100,K=j<.5?2*M*j:2*M*(1-j),b=0;return K<1&&(b=(j-.5*K)/(1-K)),[Z[0],100*K,100*b]},I.hsv.hcg=function(Z){var M=Z[1]/100,j=Z[2]/100,K=M*j,b=0;return K<1&&(b=(j-K)/(1-K)),[Z[0],100*K,100*b]},I.hcg.rgb=function(Z){var M=Z[0]/360,j=Z[1]/100,K=Z[2]/100;if(0===j)return[255*K,255*K,255*K];var b,g=[0,0,0],O=M%1*6,Q=O%1,Y=1-Q;switch(Math.floor(O)){case 0:g[0]=1,g[1]=Q,g[2]=0;break;case 1:g[0]=Y,g[1]=1,g[2]=0;break;case 2:g[0]=0,g[1]=1,g[2]=Q;break;case 3:g[0]=0,g[1]=Y,g[2]=1;break;case 4:g[0]=Q,g[1]=0,g[2]=1;break;default:g[0]=1,g[1]=0,g[2]=Y}return b=(1-j)*K,[255*(j*g[0]+b),255*(j*g[1]+b),255*(j*g[2]+b)]},I.hcg.hsv=function(Z){var M=Z[1]/100,j=M+Z[2]/100*(1-M),K=0;return j>0&&(K=M/j),[Z[0],100*K,100*j]},I.hcg.hsl=function(Z){var M=Z[1]/100,j=Z[2]/100*(1-M)+.5*M,K=0;return j>0&&j<.5?K=M/(2*j):j>=.5&&j<1&&(K=M/(2*(1-j))),[Z[0],100*K,100*j]},I.hcg.hwb=function(Z){var M=Z[1]/100,j=M+Z[2]/100*(1-M);return[Z[0],100*(j-M),100*(1-j)]},I.hwb.hcg=function(Z){var M=Z[1]/100,j=1-Z[2]/100,K=j-M,b=0;return K<1&&(b=(j-K)/(1-K)),[Z[0],100*K,100*b]},I.apple.rgb=function(Z){return[Z[0]/65535*255,Z[1]/65535*255,Z[2]/65535*255]},I.rgb.apple=function(Z){return[Z[0]/255*65535,Z[1]/255*65535,Z[2]/255*65535]},I.gray.rgb=function(Z){return[Z[0]/100*255,Z[0]/100*255,Z[0]/100*255]},I.gray.hsl=function(Z){return[0,0,Z[0]]},I.gray.hsv=I.gray.hsl,I.gray.hwb=function(Z){return[0,100,Z[0]]},I.gray.cmyk=function(Z){return[0,0,0,Z[0]]},I.gray.lab=function(Z){return[Z[0],0,0]},I.gray.hex=function(Z){var M=255&Math.round(Z[0]/100*255),j=((M<<16)+(M<<8)+M).toString(16).toUpperCase();return"000000".substring(j.length)+j},I.rgb.gray=function(Z){return[(Z[0]+Z[1]+Z[2])/3/255*100]}},43143:function(Z,M,j){var K=j(20198),b=j(63150),g={};Object.keys(K).forEach((function(Z){g[Z]={},Object.defineProperty(g[Z],"channels",{value:K[Z].channels}),Object.defineProperty(g[Z],"labels",{value:K[Z].labels});var M=b(Z);Object.keys(M).forEach((function(j){var K=M[j];g[Z][j]=function(Z){var M=function(){for(var M=arguments.length,j=new Array(M),K=0;K<M;K++)j[K]=arguments[K];var b=j[0];if(void 0===b||null===b)return b;b.length>1&&(j=b);var g=Z(j);if("object"===typeof g)for(var O=g.length,Q=0;Q<O;Q++)g[Q]=Math.round(g[Q]);return g};return"conversion"in Z&&(M.conversion=Z.conversion),M}(K),g[Z][j].raw=function(Z){var M=function(){for(var M=arguments.length,j=new Array(M),K=0;K<M;K++)j[K]=arguments[K];var b=j[0];return void 0===b||null===b?b:(b.length>1&&(j=b),Z(j))};return"conversion"in Z&&(M.conversion=Z.conversion),M}(K)}))})),Z.exports=g},63150:function(Z,M,j){var K=j(20198);function b(Z){var M=function(){for(var Z={},M=Object.keys(K),j=M.length,b=0;b<j;b++)Z[M[b]]={distance:-1,parent:null};return Z}(),j=[Z];for(M[Z].distance=0;j.length;)for(var b=j.pop(),g=Object.keys(K[b]),O=g.length,Q=0;Q<O;Q++){var Y=g[Q],I=M[Y];-1===I.distance&&(I.distance=M[b].distance+1,I.parent=b,j.unshift(Y))}return M}function g(Z,M){return function(j){return M(Z(j))}}function O(Z,M){for(var j=[M[Z].parent,Z],b=K[M[Z].parent][Z],O=M[Z].parent;M[O].parent;)j.unshift(M[O].parent),b=g(K[M[O].parent][O],b),O=M[O].parent;return b.conversion=j,b}Z.exports=function(Z){for(var M=b(Z),j={},K=Object.keys(M),g=K.length,Q=0;Q<g;Q++){var Y=K[Q];null!==M[Y].parent&&(j[Y]=O(Y,M))}return j}},15987:function(Z){"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},37981:function(Z,M,j){"use strict";var K=j(64687),b=j(56690).default,g=j(89728).default,O=this&&this.__createBinding||(Object.create?function(Z,M,j,K){void 0===K&&(K=j);var b=Object.getOwnPropertyDescriptor(M,j);b&&!("get"in b?!M.__esModule:b.writable||b.configurable)||(b={enumerable:!0,get:function(){return M[j]}}),Object.defineProperty(Z,K,b)}:function(Z,M,j,K){void 0===K&&(K=j),Z[K]=M[j]}),Q=this&&this.__setModuleDefault||(Object.create?function(Z,M){Object.defineProperty(Z,"default",{enumerable:!0,value:M})}:function(Z,M){Z.default=M}),Y=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var M={};if(null!=Z)for(var j in Z)"default"!==j&&Object.prototype.hasOwnProperty.call(Z,j)&&O(M,Z,j);return Q(M,Z),M},I=this&&this.__awaiter||function(Z,M,j,K){return new(j||(j=Promise))((function(b,g){function O(Z){try{Y(K.next(Z))}catch(Z){g(Z)}}function Q(Z){try{Y(K.throw(Z))}catch(Z){g(Z)}}function Y(Z){var M;Z.done?b(Z.value):(M=Z.value,M instanceof j?M:new j((function(Z){Z(M)}))).then(O,Q)}Y((K=K.apply(Z,M||[])).next())}))};Object.defineProperty(M,"__esModule",{value:!0}),M.Auth=M.Platform=void 0;var E=Y(j(22494)),s=j(98216),i="colyseus-auth-token";!function(Z){Z.ios="ios",Z.android="android"}(M.Platform||(M.Platform={}));var a=function(){function Z(M){var j=this;b(this,Z),this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=M.replace("ws","http"),(0,s.getItem)(i,(function(Z){return j.token=Z}))}return g(Z,[{key:"hasToken",get:function(){return!!this.token}},{key:"login",value:function(){var Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return I(this,void 0,void 0,K.mark((function M(){var j,b,g;return K.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:return j=Object.assign({},Z),this.hasToken&&(j.token=this.token),M.next=4,this.request("post","/auth",j);case 4:for(g in b=M.sent,this.token=b.token,(0,s.setItem)(i,this.token),b)this.hasOwnProperty(g)&&(this[g]=b[g]);return this.registerPingService(),M.abrupt("return",this);case 10:case"end":return M.stop()}}),M,this)})))}},{key:"save",value:function(){return I(this,void 0,void 0,K.mark((function Z(){return K.wrap((function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone});case 2:return Z.abrupt("return",this);case 3:case"end":return Z.stop()}}),Z,this)})))}},{key:"getFriends",value:function(){return I(this,void 0,void 0,K.mark((function Z(){return K.wrap((function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,this.request("get","/friends/all");case 2:return Z.abrupt("return",Z.sent);case 3:case"end":return Z.stop()}}),Z,this)})))}},{key:"getOnlineFriends",value:function(){return I(this,void 0,void 0,K.mark((function Z(){return K.wrap((function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,this.request("get","/friends/online");case 2:return Z.abrupt("return",Z.sent);case 3:case"end":return Z.stop()}}),Z,this)})))}},{key:"getFriendRequests",value:function(){return I(this,void 0,void 0,K.mark((function Z(){return K.wrap((function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,this.request("get","/friends/requests");case 2:return Z.abrupt("return",Z.sent);case 3:case"end":return Z.stop()}}),Z,this)})))}},{key:"sendFriendRequest",value:function(Z){return I(this,void 0,void 0,K.mark((function M(){return K.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.request("post","/friends/requests",{userId:Z});case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}}),M,this)})))}},{key:"acceptFriendRequest",value:function(Z){return I(this,void 0,void 0,K.mark((function M(){return K.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.request("put","/friends/requests",{userId:Z});case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}}),M,this)})))}},{key:"declineFriendRequest",value:function(Z){return I(this,void 0,void 0,K.mark((function M(){return K.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.request("del","/friends/requests",{userId:Z});case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}}),M,this)})))}},{key:"blockUser",value:function(Z){return I(this,void 0,void 0,K.mark((function M(){return K.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.request("post","/friends/block",{userId:Z});case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}}),M,this)})))}},{key:"unblockUser",value:function(Z){return I(this,void 0,void 0,K.mark((function M(){return K.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.request("put","/friends/block",{userId:Z});case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}}),M,this)})))}},{key:"request",value:function(Z,M){var j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},b=arguments.length>3?arguments[3]:void 0,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return I(this,void 0,void 0,K.mark((function O(){var Q,Y,I,s;return K.wrap((function(K){for(;;)switch(K.prev=K.next){case 0:for(Y in g.Accept="application/json",this.hasToken&&(g.Authorization="Bearer "+this.token),Q=[],j)Q.push("".concat(Y,"=").concat(j[Y]));return I=Q.length>0?"?".concat(Q.join("&")):"",s={headers:g},b&&(s.body=b),K.next=9,E[Z]("".concat(this.endpoint).concat(M).concat(I),s);case 9:return K.abrupt("return",K.sent.data);case 10:case"end":return K.stop()}}),O,this)})))}},{key:"logout",value:function(){this.token=void 0,(0,s.removeItem)(i),this.unregisterPingService()}},{key:"registerPingService",value:function(){var Z=this,M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((function(){return Z.request("get","/auth")}),M)}},{key:"unregisterPingService",value:function(){clearInterval(this.keepOnlineInterval)}}]),Z}();M.Auth=a},90442:function(Z,M,j){"use strict";var K,b=j(27424).default,g=j(64687),O=j(89728).default,Q=j(56690).default,Y=j(66115).default,I=j(61655).default,E=j(26389).default,s=j(33496).default,i=this&&this.__awaiter||function(Z,M,j,K){return new(j||(j=Promise))((function(b,g){function O(Z){try{Y(K.next(Z))}catch(Z){g(Z)}}function Q(Z){try{Y(K.throw(Z))}catch(Z){g(Z)}}function Y(Z){var M;Z.done?b(Z.value):(M=Z.value,M instanceof j?M:new j((function(Z){Z(M)}))).then(O,Q)}Y((K=K.apply(Z,M||[])).next())}))};Object.defineProperty(M,"__esModule",{value:!0}),M.Client=M.MatchMakeError=void 0;var a=j(22494),z=j(33739),V=j(62898),o=function(Z){I(j,Z);var M=E(j);function j(Z,K){var b;return Q(this,j),(b=M.call(this,Z)).code=K,Object.setPrototypeOf(Y(b),j.prototype),b}return O(j)}(s(Error));M.MatchMakeError=o;var c="undefined"!==typeof window&&"undefined"!==typeof(null===(K=null===window||void 0===window?void 0:window.location)||void 0===K?void 0:K.hostname)?"".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.hostname).concat(window.location.port&&":".concat(window.location.port)):"ws://127.0.0.1:2567",G=function(){function Z(){var M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;if(Q(this,Z),"string"===typeof M){var j=new URL(M),K="https:"===j.protocol||"wss:"===j.protocol,b=Number(j.port||(K?443:80));this.settings={hostname:j.hostname,pathname:"/"!==j.pathname?j.pathname:"",port:b,secure:K}}else void 0===M.port&&(M.port=M.secure?443:80),void 0===M.pathname&&(M.pathname=""),this.settings=M}return O(Z,[{key:"joinOrCreate",value:function(Z){var M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,g.mark((function K(){return g.wrap((function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,this.createMatchMakeRequest("joinOrCreate",Z,M,j);case 2:return K.abrupt("return",K.sent);case 3:case"end":return K.stop()}}),K,this)})))}},{key:"create",value:function(Z){var M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,g.mark((function K(){return g.wrap((function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,this.createMatchMakeRequest("create",Z,M,j);case 2:return K.abrupt("return",K.sent);case 3:case"end":return K.stop()}}),K,this)})))}},{key:"join",value:function(Z){var M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,g.mark((function K(){return g.wrap((function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,this.createMatchMakeRequest("join",Z,M,j);case 2:return K.abrupt("return",K.sent);case 3:case"end":return K.stop()}}),K,this)})))}},{key:"joinById",value:function(Z){var M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,g.mark((function K(){return g.wrap((function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,this.createMatchMakeRequest("joinById",Z,M,j);case 2:return K.abrupt("return",K.sent);case 3:case"end":return K.stop()}}),K,this)})))}},{key:"reconnect",value:function(Z,M){return i(this,void 0,void 0,g.mark((function j(){var K,O,Q,Y;return g.wrap((function(j){for(;;)switch(j.prev=j.next){case 0:if("string"!==typeof Z||"string"!==typeof M){j.next=2;break}throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");case 2:return K=Z.split(":"),O=b(K,2),Q=O[0],Y=O[1],j.next=5,this.createMatchMakeRequest("reconnect",Q,{reconnectionToken:Y},M);case 5:return j.abrupt("return",j.sent);case 6:case"end":return j.stop()}}),j,this)})))}},{key:"getAvailableRooms",value:function(){var Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return i(this,void 0,void 0,g.mark((function M(){return g.wrap((function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,(0,a.get)(this.getHttpEndpoint("".concat(Z)),{headers:{Accept:"application/json"}});case 2:return M.abrupt("return",M.sent.data);case 3:case"end":return M.stop()}}),M,this)})))}},{key:"consumeSeatReservation",value:function(Z,M,j){return i(this,void 0,void 0,g.mark((function K(){var b,O,Q,Y=this;return g.wrap((function(K){for(;;)switch(K.prev=K.next){case 0:return(b=this.createRoom(Z.room.name,M)).roomId=Z.room.roomId,b.sessionId=Z.sessionId,O={sessionId:b.sessionId},Z.reconnectionToken&&(O.reconnectionToken=Z.reconnectionToken),Q=j||b,b.connect(this.buildEndpoint(Z.room,O),Z.devMode&&function(){return i(Y,void 0,void 0,g.mark((function j(){var K,O,Y=this;return g.wrap((function(j){for(;;)switch(j.prev=j.next){case 0:console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," Re-establishing connection with room id '").concat(b.roomId,"'...")),K=0,8,O=function j(){return i(Y,void 0,void 0,g.mark((function O(){return g.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return K++,g.prev=1,g.next=4,this.consumeSeatReservation(Z,M,Q);case 4:console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(9989)," Successfully re-established connection with room '").concat(b.roomId,"'")),g.next=10;break;case 7:g.prev=7,g.t0=g.catch(1),K<8?(console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," retrying... (").concat(K," out of ").concat(8,")")),setTimeout(j,2e3)):console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(10060)," Failed to reconnect. Is your server running? Please check server logs."));case 10:case"end":return g.stop()}}),O,this,[[1,7]])})))},setTimeout(O,2e3);case 5:case"end":return j.stop()}}),j)})))},Q),K.abrupt("return",new Promise((function(Z,M){var j=function(Z,j){return M(new z.ServerError(Z,j))};Q.onError.once(j),Q.onJoin.once((function(){Q.onError.remove(j),Z(Q)}))})));case 8:case"end":return K.stop()}}),K,this)})))}},{key:"createMatchMakeRequest",value:function(Z,M){var j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},K=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0;return i(this,void 0,void 0,g.mark((function O(){var Q;return g.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,(0,a.post)(this.getHttpEndpoint("".concat(Z,"/").concat(M)),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(j)});case 2:if(!(Q=g.sent.data).error){g.next=5;break}throw new o(Q.error,Q.code);case 5:return"reconnect"===Z&&(Q.reconnectionToken=j.reconnectionToken),g.next=8,this.consumeSeatReservation(Q,K,b);case 8:return g.abrupt("return",g.sent);case 9:case"end":return g.stop()}}),O,this)})))}},{key:"createRoom",value:function(Z,M){return new V.Room(Z,M)}},{key:"buildEndpoint",value:function(Z){var M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=[];for(var K in M)M.hasOwnProperty(K)&&j.push("".concat(K,"=").concat(M[K]));var b=this.settings.secure?"wss://":"ws://";return Z.publicAddress?b+="".concat(Z.publicAddress):b+="".concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname),"".concat(b,"/").concat(Z.processId,"/").concat(Z.roomId,"?").concat(j.join("&"))}},{key:"getHttpEndpoint",value:function(){var Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(this.settings.secure?"https":"http","://").concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname,"/matchmake/").concat(Z)}},{key:"getEndpointPort",value:function(){return 80!==this.settings.port&&443!==this.settings.port?":".concat(this.settings.port):""}}]),Z}();M.Client=G},34787:function(Z,M,j){"use strict";var K=j(56690).default,b=j(89728).default;Object.defineProperty(M,"__esModule",{value:!0}),M.Connection=void 0;var g=j(52054),O=function(){function Z(){K(this,Z),this.events={},this.transport=new g.WebSocketTransport(this.events)}return b(Z,[{key:"send",value:function(Z){this.transport.send(Z)}},{key:"connect",value:function(Z){this.transport.connect(Z)}},{key:"close",value:function(Z,M){this.transport.close(Z,M)}},{key:"isOpen",get:function(){return this.transport.isOpen}}]),Z}();M.Connection=O},65211:function(Z,M){"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.utf8Length=M.utf8Read=M.ErrorCode=M.Protocol=void 0,function(Z){Z[Z.HANDSHAKE=9]="HANDSHAKE",Z[Z.JOIN_ROOM=10]="JOIN_ROOM",Z[Z.ERROR=11]="ERROR",Z[Z.LEAVE_ROOM=12]="LEAVE_ROOM",Z[Z.ROOM_DATA=13]="ROOM_DATA",Z[Z.ROOM_STATE=14]="ROOM_STATE",Z[Z.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",Z[Z.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",Z[Z.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(M.Protocol||(M.Protocol={})),function(Z){Z[Z.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",Z[Z.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",Z[Z.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",Z[Z.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",Z[Z.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",Z[Z.AUTH_FAILED=4215]="AUTH_FAILED",Z[Z.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(M.ErrorCode||(M.ErrorCode={})),M.utf8Read=function(Z,M){for(var j=Z[M++],K="",b=0,g=M,O=M+j;g<O;g++){var Q=Z[g];if(0!==(128&Q))if(192!==(224&Q))if(224!==(240&Q)){if(240!==(248&Q))throw new Error("Invalid byte "+Q.toString(16));(b=(7&Q)<<18|(63&Z[++g])<<12|(63&Z[++g])<<6|(63&Z[++g])<<0)>=65536?(b-=65536,K+=String.fromCharCode(55296+(b>>>10),56320+(1023&b))):K+=String.fromCharCode(b)}else K+=String.fromCharCode((15&Q)<<12|(63&Z[++g])<<6|(63&Z[++g])<<0);else K+=String.fromCharCode((31&Q)<<6|63&Z[++g]);else K+=String.fromCharCode(Q)}return K},M.utf8Length=function(){for(var Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",M=0,j=0,K=0,b=Z.length;K<b;K++)(M=Z.charCodeAt(K))<128?j+=1:M<2048?j+=2:M<55296||M>=57344?j+=3:(K++,j+=4);return j+1}},62898:function(Z,M,j){"use strict";var K=j(56690).default,b=j(89728).default,g=this&&this.__createBinding||(Object.create?function(Z,M,j,K){void 0===K&&(K=j);var b=Object.getOwnPropertyDescriptor(M,j);b&&!("get"in b?!M.__esModule:b.writable||b.configurable)||(b={enumerable:!0,get:function(){return M[j]}}),Object.defineProperty(Z,K,b)}:function(Z,M,j,K){void 0===K&&(K=j),Z[K]=M[j]}),O=this&&this.__setModuleDefault||(Object.create?function(Z,M){Object.defineProperty(Z,"default",{enumerable:!0,value:M})}:function(Z,M){Z.default=M}),Q=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var M={};if(null!=Z)for(var j in Z)"default"!==j&&Object.prototype.hasOwnProperty.call(Z,j)&&g(M,Z,j);return O(M,Z),M};Object.defineProperty(M,"__esModule",{value:!0}),M.Room=void 0;var Y=Q(j(61627)),I=j(34787),E=j(65211),s=j(40765),i=j(8491),a=j(10025),z=j(50061),V=j(33739),o=function(){function Z(M,j){var b=this;K(this,Z),this.onStateChange=(0,a.createSignal)(),this.onError=(0,a.createSignal)(),this.onLeave=(0,a.createSignal)(),this.onJoin=(0,a.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,i.createNanoEvents)(),this.roomId=null,this.name=M,j&&(this.serializer=new((0,s.getSerializer)("schema")),this.rootSchema=j,this.serializer.state=new j),this.onError((function(Z,M){var j;return null===(j=console.warn)||void 0===j?void 0:j.call(console,"colyseus.js - onError => (".concat(Z,") ").concat(M))})),this.onLeave((function(){return b.removeAllListeners()}))}return b(Z,[{key:"id",get:function(){return this.roomId}},{key:"connect",value:function(M,j){var K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,b=new I.Connection;K.connection=b,b.events.onmessage=Z.prototype.onMessageCallback.bind(K),b.events.onclose=function(Z){var M;if(!K.hasJoined)return null===(M=console.warn)||void 0===M||M.call(console,"Room connection was closed unexpectedly (".concat(Z.code,"): ").concat(Z.reason)),void K.onError.invoke(Z.code,Z.reason);Z.code===V.CloseCode.DEVMODE_RESTART&&j?j():(K.onLeave.invoke(Z.code),K.destroy())},b.events.onerror=function(Z){var M;null===(M=console.warn)||void 0===M||M.call(console,"Room, onError (".concat(Z.code,"): ").concat(Z.reason)),K.onError.invoke(Z.code,Z.reason)},b.connect(M)}},{key:"leave",value:function(){var Z=this,M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((function(j){Z.onLeave((function(Z){return j(Z)})),Z.connection?M?Z.connection.send([E.Protocol.LEAVE_ROOM]):Z.connection.close():Z.onLeave.invoke(V.CloseCode.CONSENTED)}))}},{key:"onMessage",value:function(Z,M){return this.onMessageHandlers.on(this.getMessageHandlerKey(Z),M)}},{key:"send",value:function(Z,M){var j,K=[E.Protocol.ROOM_DATA];if("string"===typeof Z?z.encode.string(K,Z):z.encode.number(K,Z),void 0!==M){var b=Y.encode(M);(j=new Uint8Array(K.length+b.byteLength)).set(new Uint8Array(K),0),j.set(new Uint8Array(b),K.length)}else j=new Uint8Array(K);this.connection.send(j.buffer)}},{key:"sendBytes",value:function(Z,M){var j,K=[E.Protocol.ROOM_DATA_BYTES];"string"===typeof Z?z.encode.string(K,Z):z.encode.number(K,Z),(j=new Uint8Array(K.length+(M.byteLength||M.length))).set(new Uint8Array(K),0),j.set(new Uint8Array(M),K.length),this.connection.send(j.buffer)}},{key:"state",get:function(){return this.serializer.getState()}},{key:"removeAllListeners",value:function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}},{key:"onMessageCallback",value:function(Z){var M=Array.from(new Uint8Array(Z.data)),j=M[0];if(j===E.Protocol.JOIN_ROOM){var K=1,b=(0,E.utf8Read)(M,K);if(K+=(0,E.utf8Length)(b),this.serializerId=(0,E.utf8Read)(M,K),K+=(0,E.utf8Length)(this.serializerId),!this.serializer){var g=(0,s.getSerializer)(this.serializerId);this.serializer=new g}M.length>K&&this.serializer.handshake&&this.serializer.handshake(M,{offset:K}),this.reconnectionToken="".concat(this.roomId,":").concat(b),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([E.Protocol.JOIN_ROOM])}else if(j===E.Protocol.ERROR){var O={offset:1},Q=z.decode.number(M,O),I=z.decode.string(M,O);this.onError.invoke(Q,I)}else if(j===E.Protocol.LEAVE_ROOM)this.leave();else if(j===E.Protocol.ROOM_DATA_SCHEMA){var i={offset:1},a=this.serializer.getState().constructor._context.get(z.decode.number(M,i)),V=new a;V.decode(M,i),this.dispatchMessage(a,V)}else if(j===E.Protocol.ROOM_STATE)M.shift(),this.setState(M);else if(j===E.Protocol.ROOM_STATE_PATCH)M.shift(),this.patch(M);else if(j===E.Protocol.ROOM_DATA){var o={offset:1},c=z.decode.stringCheck(M,o)?z.decode.string(M,o):z.decode.number(M,o),G=M.length>o.offset?Y.decode(Z.data,o.offset):void 0;this.dispatchMessage(c,G)}else if(j===E.Protocol.ROOM_DATA_BYTES){var f={offset:1},X=z.decode.stringCheck(M,f)?z.decode.string(M,f):z.decode.number(M,f);this.dispatchMessage(X,new Uint8Array(M.slice(f.offset)))}}},{key:"setState",value:function(Z){this.serializer.setState(Z),this.onStateChange.invoke(this.serializer.getState())}},{key:"patch",value:function(Z){this.serializer.patch(Z),this.onStateChange.invoke(this.serializer.getState())}},{key:"dispatchMessage",value:function(Z,M){var j,K=this.getMessageHandlerKey(Z);this.onMessageHandlers.events[K]?this.onMessageHandlers.emit(K,M):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",Z,M):null===(j=console.warn)||void 0===j||j.call(console,"colyseus.js: onMessage() not registered for type '".concat(Z,"'."))}},{key:"destroy",value:function(){this.serializer&&this.serializer.teardown()}},{key:"getMessageHandlerKey",value:function(Z){switch(typeof Z){case"function":return"$".concat(Z._typeid);case"string":return Z;case"number":return"i".concat(Z);default:throw new Error("invalid message type.")}}}]),Z}();M.Room=o},98216:function(Z,M){"use strict";var j;function K(){return j||(j="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(Z,M){this.cache[Z]=M},getItem:function(Z){this.cache[Z]},removeItem:function(Z){delete this.cache[Z]}}),j}Object.defineProperty(M,"__esModule",{value:!0}),M.getItem=M.removeItem=M.setItem=void 0,M.setItem=function(Z,M){K().setItem(Z,M)},M.removeItem=function(Z){K().removeItem(Z)},M.getItem=function(Z,M){var j=K().getItem(Z);"undefined"!==typeof Promise&&j instanceof Promise?j.then((function(Z){return M(Z)})):M(j)}},8491:function(Z,M){"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.createNanoEvents=void 0;M.createNanoEvents=function(){return{emit:function(Z){for(var M=this.events[Z]||[],j=arguments.length,K=new Array(j>1?j-1:0),b=1;b<j;b++)K[b-1]=arguments[b];for(var g=0,O=M.length;g<O;g++)M[g].apply(M,K)},events:{},on:function(Z,M){var j,K=this;return(null===(j=this.events[Z])||void 0===j?void 0:j.push(M))||(this.events[Z]=[M]),function(){var j;K.events[Z]=null===(j=K.events[Z])||void 0===j?void 0:j.filter((function(Z){return M!==Z}))}}}}},10025:function(Z,M,j){"use strict";var K=j(56690).default,b=j(89728).default;Object.defineProperty(M,"__esModule",{value:!0}),M.createSignal=M.EventEmitter=void 0;var g=function(){function Z(){K(this,Z),this.handlers=[]}return b(Z,[{key:"register",value:function(Z){return this.handlers.push(Z),this}},{key:"invoke",value:function(){for(var Z=this,M=arguments.length,j=new Array(M),K=0;K<M;K++)j[K]=arguments[K];this.handlers.forEach((function(M){return M.apply(Z,j)}))}},{key:"invokeAsync",value:function(){for(var Z=this,M=arguments.length,j=new Array(M),K=0;K<M;K++)j[K]=arguments[K];return Promise.all(this.handlers.map((function(M){return M.apply(Z,j)})))}},{key:"remove",value:function(Z){var M=this.handlers.indexOf(Z);this.handlers[M]=this.handlers[this.handlers.length-1],this.handlers.pop()}},{key:"clear",value:function(){this.handlers=[]}}]),Z}();M.EventEmitter=g,M.createSignal=function(){var Z=new g;function M(M){return Z.register(M,null===this)}return M.once=function(M){Z.register((function j(){for(var K=arguments.length,b=new Array(K),g=0;g<K;g++)b[g]=arguments[g];M.apply(this,b),Z.remove(j)}))},M.remove=function(M){return Z.remove(M)},M.invoke=function(){return Z.invoke.apply(Z,arguments)},M.invokeAsync=function(){return Z.invokeAsync.apply(Z,arguments)},M.clear=function(){return Z.clear()},M}},33739:function(Z,M,j){"use strict";var K=j(89728).default,b=j(56690).default,g=j(61655).default,O=j(26389).default,Q=j(33496).default;Object.defineProperty(M,"__esModule",{value:!0}),M.ServerError=M.CloseCode=void 0,function(Z){Z[Z.CONSENTED=4e3]="CONSENTED",Z[Z.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(M.CloseCode||(M.CloseCode={}));var Y=function(Z){g(j,Z);var M=O(j);function j(Z,K){var g;return b(this,j),(g=M.call(this,K)).name="ServerError",g.code=Z,g}return K(j)}(Q(Error));M.ServerError=Y},21021:function(Z,M,j){"use strict";M.e=void 0,j(80876);var K=j(90442);Object.defineProperty(M,"e",{enumerable:!0,get:function(){return K.Client}});var b=j(65211);var g=j(62898);var O=j(37981);var Q=j(74042);var Y=j(94183),I=j(40765);(0,I.registerSerializer)("schema",Q.SchemaSerializer),(0,I.registerSerializer)("none",Y.NoneSerializer)},80876:function(){ArrayBuffer.isView||(ArrayBuffer.isView=function(Z){return null!==Z&&"object"===typeof Z&&Z.buffer instanceof ArrayBuffer}),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},61627:function(Z,M){"use strict";function j(Z,M){if(this._offset=M,Z instanceof ArrayBuffer)this._buffer=Z,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(Z))throw new Error("Invalid argument");this._buffer=Z.buffer,this._view=new DataView(this._buffer,Z.byteOffset,Z.byteLength)}}Object.defineProperty(M,"__esModule",{value:!0}),M.decode=M.encode=void 0,j.prototype._array=function(Z){for(var M=new Array(Z),j=0;j<Z;j++)M[j]=this._parse();return M},j.prototype._map=function(Z){for(var M={},j=0;j<Z;j++)M[this._parse()]=this._parse();return M},j.prototype._str=function(Z){var M=function(Z,M,j){for(var K="",b=0,g=M,O=M+j;g<O;g++){var Q=Z.getUint8(g);if(0!==(128&Q))if(192!==(224&Q))if(224!==(240&Q)){if(240!==(248&Q))throw new Error("Invalid byte "+Q.toString(16));(b=(7&Q)<<18|(63&Z.getUint8(++g))<<12|(63&Z.getUint8(++g))<<6|(63&Z.getUint8(++g))<<0)>=65536?(b-=65536,K+=String.fromCharCode(55296+(b>>>10),56320+(1023&b))):K+=String.fromCharCode(b)}else K+=String.fromCharCode((15&Q)<<12|(63&Z.getUint8(++g))<<6|(63&Z.getUint8(++g))<<0);else K+=String.fromCharCode((31&Q)<<6|63&Z.getUint8(++g));else K+=String.fromCharCode(Q)}return K}(this._view,this._offset,Z);return this._offset+=Z,M},j.prototype._bin=function(Z){var M=this._buffer.slice(this._offset,this._offset+Z);return this._offset+=Z,M},j.prototype._parse=function(){var Z,M=this._view.getUint8(this._offset++),j=0,K=0,b=0,g=0;if(M<192)return M<128?M:M<144?this._map(15&M):M<160?this._array(15&M):this._str(31&M);if(M>223)return-1*(255-M+1);switch(M){case 192:return null;case 194:return!1;case 195:return!0;case 196:return j=this._view.getUint8(this._offset),this._offset+=1,this._bin(j);case 197:return j=this._view.getUint16(this._offset),this._offset+=2,this._bin(j);case 198:return j=this._view.getUint32(this._offset),this._offset+=4,this._bin(j);case 199:if(j=this._view.getUint8(this._offset),K=this._view.getInt8(this._offset+1),this._offset+=2,-1===K){var O=this._view.getUint32(this._offset);return b=this._view.getInt32(this._offset+4),g=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*b+g)+O/1e6)}return[K,this._bin(j)];case 200:return j=this._view.getUint16(this._offset),K=this._view.getInt8(this._offset+2),this._offset+=3,[K,this._bin(j)];case 201:return j=this._view.getUint32(this._offset),K=this._view.getInt8(this._offset+4),this._offset+=5,[K,this._bin(j)];case 202:return Z=this._view.getFloat32(this._offset),this._offset+=4,Z;case 203:return Z=this._view.getFloat64(this._offset),this._offset+=8,Z;case 204:return Z=this._view.getUint8(this._offset),this._offset+=1,Z;case 205:return Z=this._view.getUint16(this._offset),this._offset+=2,Z;case 206:return Z=this._view.getUint32(this._offset),this._offset+=4,Z;case 207:return b=this._view.getUint32(this._offset)*Math.pow(2,32),g=this._view.getUint32(this._offset+4),this._offset+=8,b+g;case 208:return Z=this._view.getInt8(this._offset),this._offset+=1,Z;case 209:return Z=this._view.getInt16(this._offset),this._offset+=2,Z;case 210:return Z=this._view.getInt32(this._offset),this._offset+=4,Z;case 211:return b=this._view.getInt32(this._offset)*Math.pow(2,32),g=this._view.getUint32(this._offset+4),this._offset+=8,b+g;case 212:return K=this._view.getInt8(this._offset),this._offset+=1,0===K?void(this._offset+=1):[K,this._bin(1)];case 213:return K=this._view.getInt8(this._offset),this._offset+=1,[K,this._bin(2)];case 214:return K=this._view.getInt8(this._offset),this._offset+=1,-1===K?(Z=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*Z)):[K,this._bin(4)];case 215:return K=this._view.getInt8(this._offset),this._offset+=1,0===K?(b=this._view.getInt32(this._offset)*Math.pow(2,32),g=this._view.getUint32(this._offset+4),this._offset+=8,new Date(b+g)):-1===K?(b=this._view.getUint32(this._offset),g=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&b)+g)+(b>>>2)/1e6)):[K,this._bin(8)];case 216:return K=this._view.getInt8(this._offset),this._offset+=1,[K,this._bin(16)];case 217:return j=this._view.getUint8(this._offset),this._offset+=1,this._str(j);case 218:return j=this._view.getUint16(this._offset),this._offset+=2,this._str(j);case 219:return j=this._view.getUint32(this._offset),this._offset+=4,this._str(j);case 220:return j=this._view.getUint16(this._offset),this._offset+=2,this._array(j);case 221:return j=this._view.getUint32(this._offset),this._offset+=4,this._array(j);case 222:return j=this._view.getUint16(this._offset),this._offset+=2,this._map(j);case 223:return j=this._view.getUint32(this._offset),this._offset+=4,this._map(j)}throw new Error("Could not parse")},M.decode=function(Z){var M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=new j(Z,M),b=K._parse();if(K._offset!==Z.byteLength)throw new Error(Z.byteLength-K._offset+" trailing bytes");return b};function K(Z,M,j){for(var K=0,b=0,g=j.length;b<g;b++)(K=j.charCodeAt(b))<128?Z.setUint8(M++,K):K<2048?(Z.setUint8(M++,192|K>>6),Z.setUint8(M++,128|63&K)):K<55296||K>=57344?(Z.setUint8(M++,224|K>>12),Z.setUint8(M++,128|K>>6&63),Z.setUint8(M++,128|63&K)):(b++,K=65536+((1023&K)<<10|1023&j.charCodeAt(b)),Z.setUint8(M++,240|K>>18),Z.setUint8(M++,128|K>>12&63),Z.setUint8(M++,128|K>>6&63),Z.setUint8(M++,128|63&K))}function b(Z,M,j){var K=typeof j,g=0,O=0,Q=0,Y=0,I=0,E=0;if("string"===K){if(I=function(Z){for(var M=0,j=0,K=0,b=Z.length;K<b;K++)(M=Z.charCodeAt(K))<128?j+=1:M<2048?j+=2:M<55296||M>=57344?j+=3:(K++,j+=4);return j}(j),I<32)Z.push(160|I),E=1;else if(I<256)Z.push(217,I),E=2;else if(I<65536)Z.push(218,I>>8,I),E=3;else{if(!(I<4294967296))throw new Error("String too long");Z.push(219,I>>24,I>>16,I>>8,I),E=5}return M.push({_str:j,_length:I,_offset:Z.length}),E+I}if("number"===K)return Math.floor(j)===j&&isFinite(j)?j>=0?j<128?(Z.push(j),1):j<256?(Z.push(204,j),2):j<65536?(Z.push(205,j>>8,j),3):j<4294967296?(Z.push(206,j>>24,j>>16,j>>8,j),5):(Q=j/Math.pow(2,32)>>0,Y=j>>>0,Z.push(207,Q>>24,Q>>16,Q>>8,Q,Y>>24,Y>>16,Y>>8,Y),9):j>=-32?(Z.push(j),1):j>=-128?(Z.push(208,j),2):j>=-32768?(Z.push(209,j>>8,j),3):j>=-2147483648?(Z.push(210,j>>24,j>>16,j>>8,j),5):(Q=Math.floor(j/Math.pow(2,32)),Y=j>>>0,Z.push(211,Q>>24,Q>>16,Q>>8,Q,Y>>24,Y>>16,Y>>8,Y),9):(Z.push(203),M.push({_float:j,_length:8,_offset:Z.length}),9);if("object"===K){if(null===j)return Z.push(192),1;if(Array.isArray(j)){if((I=j.length)<16)Z.push(144|I),E=1;else if(I<65536)Z.push(220,I>>8,I),E=3;else{if(!(I<4294967296))throw new Error("Array too large");Z.push(221,I>>24,I>>16,I>>8,I),E=5}for(g=0;g<I;g++)E+=b(Z,M,j[g]);return E}if(j instanceof Date){var s=j.getTime(),i=Math.floor(s/1e3),a=1e6*(s-1e3*i);return i>=0&&a>=0&&i<=17179869183?0===a&&i<=4294967295?(Z.push(214,255,i>>24,i>>16,i>>8,i),6):(Q=i/4294967296,Y=4294967295&i,Z.push(215,255,a>>22,a>>14,a>>6,Q,Y>>24,Y>>16,Y>>8,Y),10):(Q=Math.floor(i/4294967296),Y=i>>>0,Z.push(199,12,255,a>>24,a>>16,a>>8,a,Q>>24,Q>>16,Q>>8,Q,Y>>24,Y>>16,Y>>8,Y),15)}if(j instanceof ArrayBuffer){if((I=j.byteLength)<256)Z.push(196,I),E=2;else if(I<65536)Z.push(197,I>>8,I),E=3;else{if(!(I<4294967296))throw new Error("Buffer too large");Z.push(198,I>>24,I>>16,I>>8,I),E=5}return M.push({_bin:j,_length:I,_offset:Z.length}),E+I}if("function"===typeof j.toJSON)return b(Z,M,j.toJSON());var z=[],V="",o=Object.keys(j);for(g=0,O=o.length;g<O;g++)void 0!==j[V=o[g]]&&"function"!==typeof j[V]&&z.push(V);if((I=z.length)<16)Z.push(128|I),E=1;else if(I<65536)Z.push(222,I>>8,I),E=3;else{if(!(I<4294967296))throw new Error("Object too large");Z.push(223,I>>24,I>>16,I>>8,I),E=5}for(g=0;g<I;g++)E+=b(Z,M,V=z[g]),E+=b(Z,M,j[V]);return E}if("boolean"===K)return Z.push(j?195:194),1;if("undefined"===K)return Z.push(192),1;if("function"===typeof j.toJSON)return b(Z,M,j.toJSON());throw new Error("Could not encode")}M.encode=function(Z){var M=[],j=[],g=b(M,j,Z),O=new ArrayBuffer(g),Q=new DataView(O),Y=0,I=0,E=-1;j.length>0&&(E=j[0]._offset);for(var s,i=0,a=0,z=0,V=M.length;z<V;z++)if(Q.setUint8(I+z,M[z]),z+1===E){if(i=(s=j[Y])._length,a=I+E,s._bin)for(var o=new Uint8Array(s._bin),c=0;c<i;c++)Q.setUint8(a+c,o[c]);else s._str?K(Q,a,s._str):void 0!==s._float&&Q.setFloat64(a,s._float);I+=i,j[++Y]&&(E=j[Y]._offset)}return O}},94183:function(Z,M,j){"use strict";var K=j(56690).default,b=j(89728).default;Object.defineProperty(M,"__esModule",{value:!0}),M.NoneSerializer=void 0;var g=function(){function Z(){K(this,Z)}return b(Z,[{key:"setState",value:function(Z){}},{key:"getState",value:function(){return null}},{key:"patch",value:function(Z){}},{key:"teardown",value:function(){}},{key:"handshake",value:function(Z){}}]),Z}();M.NoneSerializer=g},74042:function(Z,M,j){"use strict";var K=j(56690).default,b=j(89728).default;Object.defineProperty(M,"__esModule",{value:!0}),M.SchemaSerializer=void 0;var g=j(50061),O=function(){function Z(){K(this,Z)}return b(Z,[{key:"setState",value:function(Z){return this.state.decode(Z)}},{key:"getState",value:function(){return this.state}},{key:"patch",value:function(Z){return this.state.decode(Z)}},{key:"teardown",value:function(){var Z,M;null===(M=null===(Z=this.state)||void 0===Z?void 0:Z.$changes)||void 0===M||M.root.clearRefs()}},{key:"handshake",value:function(Z,M){this.state?(new g.Reflection).decode(Z,M):this.state=g.Reflection.decode(Z,M)}}]),Z}();M.SchemaSerializer=O},40765:function(Z,M){"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.getSerializer=M.registerSerializer=void 0;var j={};M.registerSerializer=function(Z,M){j[Z]=M},M.getSerializer=function(Z){var M=j[Z];if(!M)throw new Error("missing serializer: "+Z);return M}},52054:function(Z,M,j){"use strict";var K=j(56690).default,b=j(89728).default,g=this&&this.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(M,"__esModule",{value:!0}),M.WebSocketTransport=void 0;var O=g(j(32299)),Q=globalThis.WebSocket||O.default,Y=function(){function Z(M){K(this,Z),this.events=M}return b(Z,[{key:"send",value:function(Z){Z instanceof ArrayBuffer?this.ws.send(Z):Array.isArray(Z)&&this.ws.send(new Uint8Array(Z).buffer)}},{key:"connect",value:function(Z){this.ws=new Q(Z,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}},{key:"close",value:function(Z,M){this.ws.close(Z,M)}},{key:"isOpen",get:function(){return this.ws.readyState===Q.OPEN}}]),Z}();M.WebSocketTransport=Y},32299:function(Z){"use strict";Z.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},69113:function(Z,M,j){"use strict";var K=K||function(Z,M){var j={},K=j.lib={},b=function(){},g=K.Base={extend:function(Z){b.prototype=this;var M=new b;return Z&&M.mixIn(Z),M.hasOwnProperty("init")||(M.init=function(){M.$super.init.apply(this,arguments)}),M.init.prototype=M,M.$super=this,M},create:function(){var Z=this.extend();return Z.init.apply(Z,arguments),Z},init:function(){},mixIn:function(Z){for(var M in Z)Z.hasOwnProperty(M)&&(this[M]=Z[M]);Z.hasOwnProperty("toString")&&(this.toString=Z.toString)},clone:function(){return this.init.prototype.extend(this)}},O=K.WordArray=g.extend({init:function(Z,M){Z=this.words=Z||[],this.sigBytes=undefined!=M?M:4*Z.length},toString:function(Z){return(Z||Y).stringify(this)},concat:function(Z){var M=this.words,j=Z.words,K=this.sigBytes;if(Z=Z.sigBytes,this.clamp(),K%4)for(var b=0;b<Z;b++)M[K+b>>>2]|=(j[b>>>2]>>>24-b%4*8&255)<<24-(K+b)%4*8;else if(65535<j.length)for(b=0;b<Z;b+=4)M[K+b>>>2]=j[b>>>2];else M.push.apply(M,j);return this.sigBytes+=Z,this},clamp:function(){var M=this.words,j=this.sigBytes;M[j>>>2]&=4294967295<<32-j%4*8,M.length=Z.ceil(j/4)},clone:function(){var Z=g.clone.call(this);return Z.words=this.words.slice(0),Z},random:function(M){for(var j=[],K=0;K<M;K+=4)j.push(4294967296*Z.random()|0);return new O.init(j,M)}}),Q=j.enc={},Y=Q.Hex={stringify:function(Z){var M=Z.words;Z=Z.sigBytes;for(var j=[],K=0;K<Z;K++){var b=M[K>>>2]>>>24-K%4*8&255;j.push((b>>>4).toString(16)),j.push((15&b).toString(16))}return j.join("")},parse:function(Z){for(var M=Z.length,j=[],K=0;K<M;K+=2)j[K>>>3]|=parseInt(Z.substr(K,2),16)<<24-K%8*4;return new O.init(j,M/2)}},I=Q.Latin1={stringify:function(Z){var M=Z.words;Z=Z.sigBytes;for(var j=[],K=0;K<Z;K++)j.push(String.fromCharCode(M[K>>>2]>>>24-K%4*8&255));return j.join("")},parse:function(Z){for(var M=Z.length,j=[],K=0;K<M;K++)j[K>>>2]|=(255&Z.charCodeAt(K))<<24-K%4*8;return new O.init(j,M)}},E=Q.Utf8={stringify:function(Z){try{return decodeURIComponent(escape(I.stringify(Z)))}catch(Z){throw Error("Malformed UTF-8 data")}},parse:function(Z){return I.parse(unescape(encodeURIComponent(Z)))}},s=K.BufferedBlockAlgorithm=g.extend({reset:function(){this._data=new O.init,this._nDataBytes=0},_append:function(Z){"string"==typeof Z&&(Z=E.parse(Z)),this._data.concat(Z),this._nDataBytes+=Z.sigBytes},_process:function(M){var j=this._data,K=j.words,b=j.sigBytes,g=this.blockSize,Q=b/(4*g);if(M=(Q=M?Z.ceil(Q):Z.max((0|Q)-this._minBufferSize,0))*g,b=Z.min(4*M,b),M){for(var Y=0;Y<M;Y+=g)this._doProcessBlock(K,Y);Y=K.splice(0,M),j.sigBytes-=b}return new O.init(Y,b)},clone:function(){var Z=g.clone.call(this);return Z._data=this._data.clone(),Z},_minBufferSize:0});K.Hasher=s.extend({cfg:g.extend(),init:function(Z){this.cfg=this.cfg.extend(Z),this.reset()},reset:function(){s.reset.call(this),this._doReset()},update:function(Z){return this._append(Z),this._process(),this},finalize:function(Z){return Z&&this._append(Z),this._doFinalize()},blockSize:16,_createHelper:function(Z){return function(M,j){return new Z.init(j).finalize(M)}},_createHmacHelper:function(Z){return function(M,j){return new i.HMAC.init(Z,j).finalize(M)}}});var i=j.algo={};return j}(Math);!function(Z){for(var M=K,j=(g=M.lib).WordArray,b=g.Hasher,g=M.algo,O=[],Q=[],Y=function(Z){return 4294967296*(Z-(0|Z))|0},I=2,E=0;64>E;){var s;Z:{s=I;for(var i=Z.sqrt(s),a=2;a<=i;a++)if(!(s%a)){s=!1;break Z}s=!0}s&&(8>E&&(O[E]=Y(Z.pow(I,.5))),Q[E]=Y(Z.pow(I,1/3)),E++),I++}var z=[];g=g.SHA256=b.extend({_doReset:function(){this._hash=new j.init(O.slice(0))},_doProcessBlock:function(Z,M){for(var j=this._hash.words,K=j[0],b=j[1],g=j[2],O=j[3],Y=j[4],I=j[5],E=j[6],s=j[7],i=0;64>i;i++){if(16>i)z[i]=0|Z[M+i];else{var a=z[i-15],V=z[i-2];z[i]=((a<<25|a>>>7)^(a<<14|a>>>18)^a>>>3)+z[i-7]+((V<<15|V>>>17)^(V<<13|V>>>19)^V>>>10)+z[i-16]}a=s+((Y<<26|Y>>>6)^(Y<<21|Y>>>11)^(Y<<7|Y>>>25))+(Y&I^~Y&E)+Q[i]+z[i],V=((K<<30|K>>>2)^(K<<19|K>>>13)^(K<<10|K>>>22))+(K&b^K&g^b&g),s=E,E=I,I=Y,Y=O+a|0,O=g,g=b,b=K,K=a+V|0}j[0]=j[0]+K|0,j[1]=j[1]+b|0,j[2]=j[2]+g|0,j[3]=j[3]+O|0,j[4]=j[4]+Y|0,j[5]=j[5]+I|0,j[6]=j[6]+E|0,j[7]=j[7]+s|0},_doFinalize:function(){var M=this._data,j=M.words,K=8*this._nDataBytes,b=8*M.sigBytes;return j[b>>>5]|=128<<24-b%32,j[14+(b+64>>>9<<4)]=Z.floor(K/4294967296),j[15+(b+64>>>9<<4)]=K,M.sigBytes=4*j.length,this._process(),this._hash},clone:function(){var Z=b.clone.call(this);return Z._hash=this._hash.clone(),Z}});M.SHA256=b._createHelper(g),M.HmacSHA256=b._createHmacHelper(g)}(Math),function(){var Z=K,M=Z.enc.Utf8;Z.algo.HMAC=Z.lib.Base.extend({init:function(Z,j){Z=this._hasher=new Z.init,"string"==typeof j&&(j=M.parse(j));var K=Z.blockSize,b=4*K;j.sigBytes>b&&(j=Z.finalize(j)),j.clamp();for(var g=this._oKey=j.clone(),O=this._iKey=j.clone(),Q=g.words,Y=O.words,I=0;I<K;I++)Q[I]^=1549556828,Y[I]^=909522486;g.sigBytes=O.sigBytes=b,this.reset()},reset:function(){var Z=this._hasher;Z.reset(),Z.update(this._iKey)},update:function(Z){return this._hasher.update(Z),this},finalize:function(Z){var M=this._hasher;return Z=M.finalize(Z),M.reset(),M.finalize(this._oKey.clone().concat(Z))}})}(),function(){var Z=K,M=Z.lib.WordArray;Z.enc.Base64={stringify:function(Z){var M=Z.words,j=Z.sigBytes,K=this._map;Z.clamp(),Z=[];for(var b=0;b<j;b+=3)for(var g=(M[b>>>2]>>>24-b%4*8&255)<<16|(M[b+1>>>2]>>>24-(b+1)%4*8&255)<<8|M[b+2>>>2]>>>24-(b+2)%4*8&255,O=0;4>O&&b+.75*O<j;O++)Z.push(K.charAt(g>>>6*(3-O)&63));if(M=K.charAt(64))for(;Z.length%4;)Z.push(M);return Z.join("")},parse:function(Z){var j=Z.length,K=this._map;(b=K.charAt(64))&&(-1!=(b=Z.indexOf(b))&&(j=b));for(var b=[],g=0,O=0;O<j;O++)if(O%4){var Q=K.indexOf(Z.charAt(O-1))<<O%4*2,Y=K.indexOf(Z.charAt(O))>>>6-O%4*2;b[g>>>2]|=(Q|Y)<<24-g%4*8,g++}return M.create(b,g)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(Z){!function(Z){Z[Z.Undefined=0]="Undefined",Z[Z.Debug=1]="Debug",Z[Z.Info=2]="Info",Z[Z.Warning=3]="Warning",Z[Z.Error=4]="Error",Z[Z.Critical=5]="Critical"}(Z.EGAErrorSeverity||(Z.EGAErrorSeverity={})),function(Z){Z[Z.Undefined=0]="Undefined",Z[Z.Start=1]="Start",Z[Z.Complete=2]="Complete",Z[Z.Fail=3]="Fail"}(Z.EGAProgressionStatus||(Z.EGAProgressionStatus={})),function(Z){Z[Z.Undefined=0]="Undefined",Z[Z.Source=1]="Source",Z[Z.Sink=2]="Sink"}(Z.EGAResourceFlowType||(Z.EGAResourceFlowType={})),function(Z){Z[Z.Undefined=0]="Undefined",Z[Z.Clicked=1]="Clicked",Z[Z.Show=2]="Show",Z[Z.FailedShow=3]="FailedShow",Z[Z.RewardReceived=4]="RewardReceived"}(Z.EGAAdAction||(Z.EGAAdAction={})),function(Z){Z[Z.Undefined=0]="Undefined",Z[Z.Unknown=1]="Unknown",Z[Z.Offline=2]="Offline",Z[Z.NoFill=3]="NoFill",Z[Z.InternalError=4]="InternalError",Z[Z.InvalidRequest=5]="InvalidRequest",Z[Z.UnableToPrecache=6]="UnableToPrecache"}(Z.EGAAdError||(Z.EGAAdError={})),function(Z){Z[Z.Undefined=0]="Undefined",Z[Z.Video=1]="Video",Z[Z.RewardedVideo=2]="RewardedVideo",Z[Z.Playable=3]="Playable",Z[Z.Interstitial=4]="Interstitial",Z[Z.OfferWall=5]="OfferWall",Z[Z.Banner=6]="Banner"}(Z.EGAAdType||(Z.EGAAdType={})),function(Z){!function(Z){Z[Z.NoResponse=0]="NoResponse",Z[Z.BadResponse=1]="BadResponse",Z[Z.RequestTimeout=2]="RequestTimeout",Z[Z.JsonEncodeFailed=3]="JsonEncodeFailed",Z[Z.JsonDecodeFailed=4]="JsonDecodeFailed",Z[Z.InternalServerError=5]="InternalServerError",Z[Z.BadRequest=6]="BadRequest",Z[Z.Unauthorized=7]="Unauthorized",Z[Z.UnknownResponseCode=8]="UnknownResponseCode",Z[Z.Ok=9]="Ok",Z[Z.Created=10]="Created"}(Z.EGAHTTPApiResponse||(Z.EGAHTTPApiResponse={}))}(Z.http||(Z.http={})),function(Z){!function(Z){Z[Z.Undefined=0]="Undefined",Z[Z.EventValidation=1]="EventValidation",Z[Z.Database=2]="Database",Z[Z.Init=3]="Init",Z[Z.Http=4]="Http",Z[Z.Json=5]="Json"}(Z.EGASdkErrorCategory||(Z.EGASdkErrorCategory={})),function(Z){Z[Z.Undefined=0]="Undefined",Z[Z.BusinessEvent=1]="BusinessEvent",Z[Z.ResourceEvent=2]="ResourceEvent",Z[Z.ProgressionEvent=3]="ProgressionEvent",Z[Z.DesignEvent=4]="DesignEvent",Z[Z.ErrorEvent=5]="ErrorEvent",Z[Z.InitHttp=9]="InitHttp",Z[Z.EventsHttp=10]="EventsHttp",Z[Z.ProcessEvents=11]="ProcessEvents",Z[Z.AddEventsToStore=12]="AddEventsToStore",Z[Z.AdEvent=20]="AdEvent"}(Z.EGASdkErrorArea||(Z.EGASdkErrorArea={})),function(Z){Z[Z.Undefined=0]="Undefined",Z[Z.InvalidCurrency=1]="InvalidCurrency",Z[Z.InvalidShortString=2]="InvalidShortString",Z[Z.InvalidEventPartLength=3]="InvalidEventPartLength",Z[Z.InvalidEventPartCharacters=4]="InvalidEventPartCharacters",Z[Z.InvalidStore=5]="InvalidStore",Z[Z.InvalidFlowType=6]="InvalidFlowType",Z[Z.StringEmptyOrNull=7]="StringEmptyOrNull",Z[Z.NotFoundInAvailableCurrencies=8]="NotFoundInAvailableCurrencies",Z[Z.InvalidAmount=9]="InvalidAmount",Z[Z.NotFoundInAvailableItemTypes=10]="NotFoundInAvailableItemTypes",Z[Z.WrongProgressionOrder=11]="WrongProgressionOrder",Z[Z.InvalidEventIdLength=12]="InvalidEventIdLength",Z[Z.InvalidEventIdCharacters=13]="InvalidEventIdCharacters",Z[Z.InvalidProgressionStatus=15]="InvalidProgressionStatus",Z[Z.InvalidSeverity=16]="InvalidSeverity",Z[Z.InvalidLongString=17]="InvalidLongString",Z[Z.DatabaseTooLarge=18]="DatabaseTooLarge",Z[Z.DatabaseOpenOrCreate=19]="DatabaseOpenOrCreate",Z[Z.JsonError=25]="JsonError",Z[Z.FailHttpJsonDecode=29]="FailHttpJsonDecode",Z[Z.FailHttpJsonEncode=30]="FailHttpJsonEncode",Z[Z.InvalidAdAction=31]="InvalidAdAction",Z[Z.InvalidAdType=32]="InvalidAdType",Z[Z.InvalidString=33]="InvalidString"}(Z.EGASdkErrorAction||(Z.EGASdkErrorAction={})),function(Z){Z[Z.Undefined=0]="Undefined",Z[Z.Currency=1]="Currency",Z[Z.CartType=2]="CartType",Z[Z.ItemType=3]="ItemType",Z[Z.ItemId=4]="ItemId",Z[Z.Store=5]="Store",Z[Z.FlowType=6]="FlowType",Z[Z.Amount=7]="Amount",Z[Z.Progression01=8]="Progression01",Z[Z.Progression02=9]="Progression02",Z[Z.Progression03=10]="Progression03",Z[Z.EventId=11]="EventId",Z[Z.ProgressionStatus=12]="ProgressionStatus",Z[Z.Severity=13]="Severity",Z[Z.Message=14]="Message",Z[Z.AdAction=15]="AdAction",Z[Z.AdType=16]="AdType",Z[Z.AdSdkName=17]="AdSdkName",Z[Z.AdPlacement=18]="AdPlacement"}(Z.EGASdkErrorParameter||(Z.EGASdkErrorParameter={}))}(Z.events||(Z.events={}))}(b||(b={}));var b;b.EGAErrorSeverity,b.EGAProgressionStatus,b.EGAResourceFlowType;!function(Z){!function(Z){var M;!function(Z){Z[Z.Error=0]="Error",Z[Z.Warning=1]="Warning",Z[Z.Info=2]="Info",Z[Z.Debug=3]="Debug"}(M||(M={}));var j=function(){function Z(){Z.debugEnabled=!1}return Z.setInfoLog=function(M){Z.instance.infoLogEnabled=M},Z.setVerboseLog=function(M){Z.instance.infoLogVerboseEnabled=M},Z.i=function(j){if(Z.instance.infoLogEnabled){var K="Info/"+Z.Tag+": "+j;Z.instance.sendNotificationMessage(K,M.Info)}},Z.w=function(j){var K="Warning/"+Z.Tag+": "+j;Z.instance.sendNotificationMessage(K,M.Warning)},Z.e=function(j){var K="Error/"+Z.Tag+": "+j;Z.instance.sendNotificationMessage(K,M.Error)},Z.ii=function(j){if(Z.instance.infoLogVerboseEnabled){var K="Verbose/"+Z.Tag+": "+j;Z.instance.sendNotificationMessage(K,M.Info)}},Z.d=function(j){if(Z.debugEnabled){var K="Debug/"+Z.Tag+": "+j;Z.instance.sendNotificationMessage(K,M.Debug)}},Z.prototype.sendNotificationMessage=function(Z,j){switch(j){case M.Error:console.error(Z);break;case M.Warning:console.warn(Z);break;case M.Debug:"function"===typeof console.debug?console.debug(Z):console.log(Z);break;case M.Info:console.log(Z)}},Z.instance=new Z,Z.Tag="GameAnalytics",Z}();Z.GALogger=j}(Z.logging||(Z.logging={}))}(b||(b={})),function(Z){!function(M){var j=Z.logging.GALogger,b=function(){function Z(){}return Z.getHmac=function(Z,M){var j=K.HmacSHA256(M,Z);return K.enc.Base64.stringify(j)},Z.stringMatch=function(Z,M){return!(!Z||!M)&&M.test(Z)},Z.joinStringArray=function(Z,M){for(var j="",K=0,b=Z.length;K<b;K++)K>0&&(j+=M),j+=Z[K];return j},Z.stringArrayContainsString=function(Z,M){if(0===Z.length)return!1;for(var j in Z)if(Z[j]===M)return!0;return!1},Z.encode64=function(M){M=encodeURI(M);var j,K,b,g,O,Q="",Y=0,I=0,E=0;do{b=(j=M.charCodeAt(E++))>>2,g=(3&j)<<4|(K=M.charCodeAt(E++))>>4,O=(15&K)<<2|(Y=M.charCodeAt(E++))>>6,I=63&Y,isNaN(K)?O=I=64:isNaN(Y)&&(I=64),Q=Q+Z.keyStr.charAt(b)+Z.keyStr.charAt(g)+Z.keyStr.charAt(O)+Z.keyStr.charAt(I),j=K=Y=0,b=g=O=I=0}while(E<M.length);return Q},Z.decode64=function(M){var K,b,g,O,Q="",Y=0,I=0,E=0;/[^A-Za-z0-9\+\/\=]/g.exec(M)&&j.w("There were invalid base64 characters in the input text. Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='. Expect errors in decoding."),M=M.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{K=Z.keyStr.indexOf(M.charAt(E++))<<2|(g=Z.keyStr.indexOf(M.charAt(E++)))>>4,b=(15&g)<<4|(O=Z.keyStr.indexOf(M.charAt(E++)))>>2,Y=(3&O)<<6|(I=Z.keyStr.indexOf(M.charAt(E++))),Q+=String.fromCharCode(K),64!=O&&(Q+=String.fromCharCode(b)),64!=I&&(Q+=String.fromCharCode(Y)),K=b=Y=0,g=O=I=0}while(E<M.length);return decodeURI(Q)},Z.timeIntervalSince1970=function(){var Z=new Date;return Math.round(Z.getTime()/1e3)},Z.createGuid=function(){return(Z.s4()+Z.s4()+"-"+Z.s4()+"-4"+Z.s4().substr(0,3)+"-"+Z.s4()+"-"+Z.s4()+Z.s4()+Z.s4()).toLowerCase()},Z.s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},Z.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Z}();M.GAUtilities=b}(Z.utilities||(Z.utilities={}))}(b||(b={})),function(Z){!function(M){var j=Z.logging.GALogger,K=Z.utilities.GAUtilities,b=Z.events.EGASdkErrorCategory,g=Z.events.EGASdkErrorArea,O=Z.events.EGASdkErrorAction,Q=Z.events.EGASdkErrorParameter,Y=function(Z,M,j,K,b){this.category=Z,this.area=M,this.action=j,this.parameter=K,this.reason=b};M.ValidationResult=Y;var I=function(){function M(){}return M.validateBusinessEvent=function(Z,K,I,E,s){return M.validateCurrency(Z)?K<0?(j.w("Validation fail - business event - amount. Cannot be less than 0. Failed amount: "+K),new Y(b.EventValidation,g.BusinessEvent,O.InvalidAmount,Q.Amount,K+"")):M.validateShortString(I,!0)?M.validateEventPartLength(E,!1)?M.validateEventPartCharacters(E)?M.validateEventPartLength(s,!1)?M.validateEventPartCharacters(s)?null:(j.w("Validation fail - business event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+s),new Y(b.EventValidation,g.BusinessEvent,O.InvalidEventPartCharacters,Q.ItemId,s)):(j.w("Validation fail - business event - itemId. Cannot be (null), empty or above 64 characters. String: "+s),new Y(b.EventValidation,g.BusinessEvent,O.InvalidEventPartLength,Q.ItemId,s)):(j.w("Validation fail - business event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+E),new Y(b.EventValidation,g.BusinessEvent,O.InvalidEventPartCharacters,Q.ItemType,E)):(j.w("Validation fail - business event - itemType: Cannot be (null), empty or above 64 characters. String: "+E),new Y(b.EventValidation,g.BusinessEvent,O.InvalidEventPartLength,Q.ItemType,E)):(j.w("Validation fail - business event - cartType. Cannot be above 32 length. String: "+I),new Y(b.EventValidation,g.BusinessEvent,O.InvalidShortString,Q.CartType,I)):(j.w("Validation fail - business event - currency: Cannot be (null) and need to be A-Z, 3 characters and in the standard at openexchangerates.org. Failed currency: "+Z),new Y(b.EventValidation,g.BusinessEvent,O.InvalidCurrency,Q.Currency,Z))},M.validateResourceEvent=function(I,E,s,i,a,z,V){return I==Z.EGAResourceFlowType.Undefined?(j.w("Validation fail - resource event - flowType: Invalid flow type."),new Y(b.EventValidation,g.ResourceEvent,O.InvalidFlowType,Q.FlowType,"")):E?K.stringArrayContainsString(z,E)?s>0?i?M.validateEventPartLength(i,!1)?M.validateEventPartCharacters(i)?K.stringArrayContainsString(V,i)?M.validateEventPartLength(a,!1)?M.validateEventPartCharacters(a)?null:(j.w("Validation fail - resource event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+a),new Y(b.EventValidation,g.ResourceEvent,O.InvalidEventPartCharacters,Q.ItemId,a)):(j.w("Validation fail - resource event - itemId: Cannot be (null), empty or above 64 characters. String: "+a),new Y(b.EventValidation,g.ResourceEvent,O.InvalidEventPartLength,Q.ItemId,a)):(j.w("Validation fail - resource event - itemType: Not found in list of pre-defined available resource itemTypes. String: "+i),new Y(b.EventValidation,g.ResourceEvent,O.NotFoundInAvailableItemTypes,Q.ItemType,i)):(j.w("Validation fail - resource event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+i),new Y(b.EventValidation,g.ResourceEvent,O.InvalidEventPartCharacters,Q.ItemType,i)):(j.w("Validation fail - resource event - itemType: Cannot be (null), empty or above 64 characters. String: "+i),new Y(b.EventValidation,g.ResourceEvent,O.InvalidEventPartLength,Q.ItemType,i)):(j.w("Validation fail - resource event - itemType: Cannot be (null)"),new Y(b.EventValidation,g.ResourceEvent,O.StringEmptyOrNull,Q.ItemType,"")):(j.w("Validation fail - resource event - amount: Float amount cannot be 0 or negative. Value: "+s),new Y(b.EventValidation,g.ResourceEvent,O.InvalidAmount,Q.Amount,s+"")):(j.w("Validation fail - resource event - currency: Not found in list of pre-defined available resource currencies. String: "+E),new Y(b.EventValidation,g.ResourceEvent,O.NotFoundInAvailableCurrencies,Q.Currency,E)):(j.w("Validation fail - resource event - currency: Cannot be (null)"),new Y(b.EventValidation,g.ResourceEvent,O.StringEmptyOrNull,Q.Currency,""))},M.validateProgressionEvent=function(K,I,E,s){if(K==Z.EGAProgressionStatus.Undefined)return j.w("Validation fail - progression event: Invalid progression status."),new Y(b.EventValidation,g.ProgressionEvent,O.InvalidProgressionStatus,Q.ProgressionStatus,"");if(s&&!E&&I)return j.w("Validation fail - progression event: 03 found but 01+02 are invalid. Progression must be set as either 01, 01+02 or 01+02+03."),new Y(b.EventValidation,g.ProgressionEvent,O.WrongProgressionOrder,Q.Undefined,I+":"+E+":"+s);if(E&&!I)return j.w("Validation fail - progression event: 02 found but not 01. Progression must be set as either 01, 01+02 or 01+02+03"),new Y(b.EventValidation,g.ProgressionEvent,O.WrongProgressionOrder,Q.Undefined,I+":"+E+":"+s);if(!I)return j.w("Validation fail - progression event: progression01 not valid. Progressions must be set as either 01, 01+02 or 01+02+03"),new Y(b.EventValidation,g.ProgressionEvent,O.WrongProgressionOrder,Q.Undefined,(I||"")+":"+(E||"")+":"+(s||""));if(!M.validateEventPartLength(I,!1))return j.w("Validation fail - progression event - progression01: Cannot be (null), empty or above 64 characters. String: "+I),new Y(b.EventValidation,g.ProgressionEvent,O.InvalidEventPartLength,Q.Progression01,I);if(!M.validateEventPartCharacters(I))return j.w("Validation fail - progression event - progression01: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+I),new Y(b.EventValidation,g.ProgressionEvent,O.InvalidEventPartCharacters,Q.Progression01,I);if(E){if(!M.validateEventPartLength(E,!0))return j.w("Validation fail - progression event - progression02: Cannot be empty or above 64 characters. String: "+E),new Y(b.EventValidation,g.ProgressionEvent,O.InvalidEventPartLength,Q.Progression02,E);if(!M.validateEventPartCharacters(E))return j.w("Validation fail - progression event - progression02: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+E),new Y(b.EventValidation,g.ProgressionEvent,O.InvalidEventPartCharacters,Q.Progression02,E)}if(s){if(!M.validateEventPartLength(s,!0))return j.w("Validation fail - progression event - progression03: Cannot be empty or above 64 characters. String: "+s),new Y(b.EventValidation,g.ProgressionEvent,O.InvalidEventPartLength,Q.Progression03,s);if(!M.validateEventPartCharacters(s))return j.w("Validation fail - progression event - progression03: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+s),new Y(b.EventValidation,g.ProgressionEvent,O.InvalidEventPartCharacters,Q.Progression03,s)}return null},M.validateDesignEvent=function(Z){return M.validateEventIdLength(Z)?M.validateEventIdCharacters(Z)?null:(j.w("Validation fail - design event - eventId: Non valid characters. Only allowed A-z, 0-9, -_., ()!?. String: "+Z),new Y(b.EventValidation,g.DesignEvent,O.InvalidEventIdCharacters,Q.EventId,Z)):(j.w("Validation fail - design event - eventId: Cannot be (null) or empty. Only 5 event parts allowed seperated by :. Each part need to be 32 characters or less. String: "+Z),new Y(b.EventValidation,g.DesignEvent,O.InvalidEventIdLength,Q.EventId,Z))},M.validateErrorEvent=function(K,I){return K==Z.EGAErrorSeverity.Undefined?(j.w("Validation fail - error event - severity: Severity was unsupported value."),new Y(b.EventValidation,g.ErrorEvent,O.InvalidSeverity,Q.Severity,"")):M.validateLongString(I,!0)?null:(j.w("Validation fail - error event - message: Message cannot be above 8192 characters."),new Y(b.EventValidation,g.ErrorEvent,O.InvalidLongString,Q.Message,I))},M.validateAdEvent=function(K,I,E,s){return K==Z.EGAAdAction.Undefined?(j.w("Validation fail - error event - severity: Severity was unsupported value."),new Y(b.EventValidation,g.AdEvent,O.InvalidAdAction,Q.AdAction,"")):I==Z.EGAAdType.Undefined?(j.w("Validation fail - ad event - adType: Ad type was unsupported value."),new Y(b.EventValidation,g.AdEvent,O.InvalidAdType,Q.AdType,"")):M.validateShortString(E,!1)?M.validateString(s,!1)?null:(j.w("Validation fail - ad event - message: Ad placement cannot be above 64 characters."),new Y(b.EventValidation,g.AdEvent,O.InvalidString,Q.AdPlacement,s)):(j.w("Validation fail - ad event - message: Ad SDK name cannot be above 32 characters."),new Y(b.EventValidation,g.AdEvent,O.InvalidShortString,Q.AdSdkName,E))},M.validateSdkErrorEvent=function(Z,K,Q,Y,I){return!!M.validateKeys(Z,K)&&(Q===b.Undefined?(j.w("Validation fail - sdk error event - type: Category was unsupported value."),!1):Y===g.Undefined?(j.w("Validation fail - sdk error event - type: Area was unsupported value."),!1):I!==O.Undefined||(j.w("Validation fail - sdk error event - type: Action was unsupported value."),!1))},M.validateKeys=function(Z,M){return!(!K.stringMatch(Z,/^[A-z0-9]{32}$/)||!K.stringMatch(M,/^[A-z0-9]{40}$/))},M.validateCurrency=function(Z){return!!Z&&!!K.stringMatch(Z,/^[A-Z]{3}$/)},M.validateEventPartLength=function(Z,M){return!(!M||Z)||!!Z&&!(Z.length>64)},M.validateEventPartCharacters=function(Z){return!!K.stringMatch(Z,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}$/)},M.validateEventIdLength=function(Z){return!!Z&&!!K.stringMatch(Z,/^[^:]{1,64}(?::[^:]{1,64}){0,4}$/)},M.validateEventIdCharacters=function(Z){return!!Z&&!!K.stringMatch(Z,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}(:[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}){0,4}$/)},M.validateAndCleanInitRequestResponse=function(Z,M){if(null==Z)return j.w("validateInitRequestResponse failed - no response dictionary."),null;var K={};try{var b=Z.server_ts;if(!(b>0))return j.w("validateInitRequestResponse failed - invalid value in 'server_ts' field."),null;K.server_ts=b}catch(M){return j.w("validateInitRequestResponse failed - invalid type in 'server_ts' field. type="+typeof Z.server_ts+", value="+Z.server_ts+", "+M),null}if(M){try{var g=Z.configs;K.configs=g}catch(M){return j.w("validateInitRequestResponse failed - invalid type in 'configs' field. type="+typeof Z.configs+", value="+Z.configs+", "+M),null}try{var O=Z.configs_hash;K.configs_hash=O}catch(M){return j.w("validateInitRequestResponse failed - invalid type in 'configs_hash' field. type="+typeof Z.configs_hash+", value="+Z.configs_hash+", "+M),null}try{var Q=Z.ab_id;K.ab_id=Q}catch(M){return j.w("validateInitRequestResponse failed - invalid type in 'ab_id' field. type="+typeof Z.ab_id+", value="+Z.ab_id+", "+M),null}try{var Y=Z.ab_variant_id;K.ab_variant_id=Y}catch(M){return j.w("validateInitRequestResponse failed - invalid type in 'ab_variant_id' field. type="+typeof Z.ab_variant_id+", value="+Z.ab_variant_id+", "+M),null}}return K},M.validateBuild=function(Z){return!!M.validateShortString(Z,!1)},M.validateSdkWrapperVersion=function(Z){return!!K.stringMatch(Z,/^(unity|unreal|gamemaker|cocos2d|construct|defold|godot) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/)},M.validateEngineVersion=function(Z){return!(!Z||!K.stringMatch(Z,/^(unity|unreal|gamemaker|cocos2d|construct|defold|godot) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/))},M.validateUserId=function(Z){return!!M.validateString(Z,!1)||(j.w("Validation fail - user id: id cannot be (null), empty or above 64 characters."),!1)},M.validateShortString=function(Z,M){return!(!M||Z)||!(!Z||Z.length>32)},M.validateString=function(Z,M){return!(!M||Z)||!(!Z||Z.length>64)},M.validateLongString=function(Z,M){return!(!M||Z)||!(!Z||Z.length>8192)},M.validateConnectionType=function(Z){return K.stringMatch(Z,/^(wwan|wifi|lan|offline)$/)},M.validateCustomDimensions=function(Z){return M.validateArrayOfStrings(20,32,!1,"custom dimensions",Z)},M.validateResourceCurrencies=function(Z){if(!M.validateArrayOfStrings(20,64,!1,"resource currencies",Z))return!1;for(var b=0;b<Z.length;++b)if(!K.stringMatch(Z[b],/^[A-Za-z]+$/))return j.w("resource currencies validation failed: a resource currency can only be A-Z, a-z. String was: "+Z[b]),!1;return!0},M.validateResourceItemTypes=function(Z){if(!M.validateArrayOfStrings(20,32,!1,"resource item types",Z))return!1;for(var K=0;K<Z.length;++K)if(!M.validateEventPartCharacters(Z[K]))return j.w("resource item types validation failed: a resource item type cannot contain other characters than A-z, 0-9, -_., ()!?. String was: "+Z[K]),!1;return!0},M.validateDimension01=function(Z,M){return!Z||!!K.stringArrayContainsString(M,Z)},M.validateDimension02=function(Z,M){return!Z||!!K.stringArrayContainsString(M,Z)},M.validateDimension03=function(Z,M){return!Z||!!K.stringArrayContainsString(M,Z)},M.validateArrayOfStrings=function(Z,M,K,b,g){var O=b;if(O||(O="Array"),!g)return j.w(O+" validation failed: array cannot be null. "),!1;if(0==K&&0==g.length)return j.w(O+" validation failed: array cannot be empty. "),!1;if(Z>0&&g.length>Z)return j.w(O+" validation failed: array cannot exceed "+Z+" values. It has "+g.length+" values."),!1;for(var Q=0;Q<g.length;++Q){var Y=g[Q]?g[Q].length:0;if(0===Y)return j.w(O+" validation failed: contained an empty string. Array="+JSON.stringify(g)),!1;if(M>0&&Y>M)return j.w(O+" validation failed: a string exceeded max allowed length (which is: "+M+"). String was: "+g[Q]),!1}return!0},M.validateClientTs=function(Z){return!(Z<0||Z>99999999999)},M}();M.GAValidator=I}(Z.validators||(Z.validators={}))}(b||(b={})),function(Z){!function(Z){var M=function(Z,M,j){this.name=Z,this.value=M,this.version=j};Z.NameValueVersion=M;var j=function(Z,M){this.name=Z,this.version=M};Z.NameVersion=j;var K=function(){function Z(){}return Z.touch=function(){},Z.getRelevantSdkVersion=function(){return Z.sdkGameEngineVersion?Z.sdkGameEngineVersion:Z.sdkWrapperVersion},Z.getConnectionType=function(){return Z.connectionType},Z.updateConnectionType=function(){navigator.onLine?"ios"===Z.buildPlatform||"android"===Z.buildPlatform?Z.connectionType="wwan":Z.connectionType="lan":Z.connectionType="offline"},Z.getOSVersionString=function(){return Z.buildPlatform+" "+Z.osVersionPair.version},Z.runtimePlatformToString=function(){return Z.osVersionPair.name},Z.getBrowserVersionString=function(){var M,j=navigator.userAgent,K=j.match(/(opera|chrome|safari|firefox|ubrowser|msie|trident|fbav(?=\/))\/?\s*(\d+)/i)||[];if(0==K.length&&"ios"===Z.buildPlatform)return"webkit_"+Z.osVersion;if(/trident/i.test(K[1]))return"IE "+((M=/\brv[ :]+(\d+)/g.exec(j)||[])[1]||"");if("Chrome"===K[1]&&null!=(M=j.match(/\b(OPR|Edge|UBrowser)\/(\d+)/)))return M.slice(1).join(" ").replace("OPR","Opera").replace("UBrowser","UC").toLowerCase();if(K[1]&&"fbav"===K[1].toLowerCase()&&(K[1]="facebook",K[2]))return"facebook "+K[2];var b=K[2]?[K[1],K[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!=(M=j.match(/version\/(\d+)/i))&&b.splice(1,1,M[1]),b.join(" ").toLowerCase()},Z.getDeviceModel=function(){return"unknown"},Z.getDeviceManufacturer=function(){return"unknown"},Z.matchItem=function(Z,M){var K,b,g,O,Q=new j("unknown","0.0.0"),Y=0,I=0;for(Y=0;Y<M.length;Y+=1)if(new RegExp(M[Y].value,"i").test(Z)){if(K=new RegExp(M[Y].version+"[- /:;]([\\d._]+)","i"),O="",(b=Z.match(K))&&b[1]&&(g=b[1]),g){var E=g.split(/[._]+/);for(I=0;I<Math.min(E.length,3);I+=1)O+=E[I]+(I<Math.min(E.length,3)-1?".":"")}else O="0.0.0";return Q.name=M[Y].name,Q.version=O,Q}return Q},Z.sdkWrapperVersion="javascript 4.1.6",Z.osVersionPair=Z.matchItem([navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor].join(" "),[new M("windows_phone","Windows Phone","OS"),new M("windows","Win","NT"),new M("ios","iPhone","OS"),new M("ios","iPad","OS"),new M("ios","iPod","OS"),new M("android","Android","Android"),new M("blackBerry","BlackBerry","/"),new M("mac_osx","Mac","OS X"),new M("tizen","Tizen","Tizen"),new M("linux","Linux","rv"),new M("kai_os","KAIOS","KAIOS")]),Z.buildPlatform=Z.runtimePlatformToString(),Z.deviceModel=Z.getDeviceModel(),Z.deviceManufacturer=Z.getDeviceManufacturer(),Z.osVersion=Z.getOSVersionString(),Z.browserVersion=Z.getBrowserVersionString(),Z}();Z.GADevice=K}(Z.device||(Z.device={}))}(b||(b={})),function(Z){!function(Z){var M=function(){function Z(M){this.deadline=M,this.ignore=!1,this.async=!1,this.running=!1,this.id=++Z.idCounter}return Z.idCounter=0,Z}();Z.TimedBlock=M}(Z.threading||(Z.threading={}))}(b||(b={})),function(Z){!function(Z){var M=function(){function Z(Z){this.comparer=Z,this._subQueues={},this._sortedKeys=[]}return Z.prototype.enqueue=function(Z,M){-1===this._sortedKeys.indexOf(Z)&&this.addQueueOfPriority(Z),this._subQueues[Z].push(M)},Z.prototype.addQueueOfPriority=function(Z){var M=this;this._sortedKeys.push(Z),this._sortedKeys.sort((function(Z,j){return M.comparer.compare(Z,j)})),this._subQueues[Z]=[]},Z.prototype.peek=function(){if(this.hasItems())return this._subQueues[this._sortedKeys[0]][0];throw new Error("The queue is empty")},Z.prototype.hasItems=function(){return this._sortedKeys.length>0},Z.prototype.dequeue=function(){if(this.hasItems())return this.dequeueFromHighPriorityQueue();throw new Error("The queue is empty")},Z.prototype.dequeueFromHighPriorityQueue=function(){var Z=this._sortedKeys[0],M=this._subQueues[Z].shift();return 0===this._subQueues[Z].length&&(this._sortedKeys.shift(),delete this._subQueues[Z]),M},Z}();Z.PriorityQueue=M}(Z.threading||(Z.threading={}))}(b||(b={})),function(Z){!function(M){var j,K,b=Z.logging.GALogger;!function(Z){Z[Z.Equal=0]="Equal",Z[Z.LessOrEqual=1]="LessOrEqual",Z[Z.NotEqual=2]="NotEqual"}(j=M.EGAStoreArgsOperator||(M.EGAStoreArgsOperator={})),function(Z){Z[Z.Events=0]="Events",Z[Z.Sessions=1]="Sessions",Z[Z.Progression=2]="Progression"}(K=M.EGAStore||(M.EGAStore={}));var g=function(){function Z(){this.eventsStore=[],this.sessionsStore=[],this.progressionStore=[],this.storeItems={};try{"object"===typeof localStorage?(localStorage.setItem("testingLocalStorage","yes"),localStorage.removeItem("testingLocalStorage"),Z.storageAvailable=!0):Z.storageAvailable=!1}catch(Z){}}return Z.isStorageAvailable=function(){return Z.storageAvailable},Z.isStoreTooLargeForEvents=function(){return Z.instance.eventsStore.length+Z.instance.sessionsStore.length>Z.MaxNumberOfEntries},Z.select=function(M,K,b,g){void 0===K&&(K=[]),void 0===b&&(b=!1),void 0===g&&(g=0);var O=Z.getStore(M);if(!O)return null;for(var Q=[],Y=0;Y<O.length;++Y){for(var I=O[Y],E=!0,s=0;s<K.length;++s){var i=K[s];if(I[i[0]])switch(i[1]){case j.Equal:E=I[i[0]]==i[2];break;case j.LessOrEqual:E=I[i[0]]<=i[2];break;case j.NotEqual:E=I[i[0]]!=i[2];break;default:E=!1}else E=!1;if(!E)break}E&&Q.push(I)}return b&&Q.sort((function(Z,M){return Z.client_ts-M.client_ts})),g>0&&Q.length>g&&(Q=Q.slice(0,g+1)),Q},Z.update=function(M,K,b){void 0===b&&(b=[]);var g=Z.getStore(M);if(!g)return!1;for(var O=0;O<g.length;++O){for(var Q=g[O],Y=!0,I=0;I<b.length;++I){var E=b[I];if(Q[E[0]])switch(E[1]){case j.Equal:Y=Q[E[0]]==E[2];break;case j.LessOrEqual:Y=Q[E[0]]<=E[2];break;case j.NotEqual:Y=Q[E[0]]!=E[2];break;default:Y=!1}else Y=!1;if(!Y)break}if(Y)for(I=0;I<K.length;++I){var s=K[I];Q[s[0]]=s[1]}}return!0},Z.delete=function(M,K){var b=Z.getStore(M);if(b)for(var g=0;g<b.length;++g){for(var O=b[g],Q=!0,Y=0;Y<K.length;++Y){var I=K[Y];if(O[I[0]])switch(I[1]){case j.Equal:Q=O[I[0]]==I[2];break;case j.LessOrEqual:Q=O[I[0]]<=I[2];break;case j.NotEqual:Q=O[I[0]]!=I[2];break;default:Q=!1}else Q=!1;if(!Q)break}Q&&(b.splice(g,1),--g)}},Z.insert=function(M,j,K,b){void 0===K&&(K=!1),void 0===b&&(b=null);var g=Z.getStore(M);if(g)if(K){if(!b)return;for(var O=!1,Q=0;Q<g.length;++Q){var Y=g[Q];if(Y[b]==j[b]){for(var I in j)Y[I]=j[I];O=!0;break}}O||g.push(j)}else g.push(j)},Z.save=function(M){Z.isStorageAvailable()?(localStorage.setItem(Z.StringFormat(Z.KeyFormat,M,Z.EventsStoreKey),JSON.stringify(Z.instance.eventsStore)),localStorage.setItem(Z.StringFormat(Z.KeyFormat,M,Z.SessionsStoreKey),JSON.stringify(Z.instance.sessionsStore)),localStorage.setItem(Z.StringFormat(Z.KeyFormat,M,Z.ProgressionStoreKey),JSON.stringify(Z.instance.progressionStore)),localStorage.setItem(Z.StringFormat(Z.KeyFormat,M,Z.ItemsStoreKey),JSON.stringify(Z.instance.storeItems))):b.w("Storage is not available, cannot save.")},Z.load=function(M){if(Z.isStorageAvailable()){try{Z.instance.eventsStore=JSON.parse(localStorage.getItem(Z.StringFormat(Z.KeyFormat,M,Z.EventsStoreKey))),Z.instance.eventsStore||(Z.instance.eventsStore=[])}catch(M){b.w("Load failed for 'events' store. Using empty store."),Z.instance.eventsStore=[]}try{Z.instance.sessionsStore=JSON.parse(localStorage.getItem(Z.StringFormat(Z.KeyFormat,M,Z.SessionsStoreKey))),Z.instance.sessionsStore||(Z.instance.sessionsStore=[])}catch(M){b.w("Load failed for 'sessions' store. Using empty store."),Z.instance.sessionsStore=[]}try{Z.instance.progressionStore=JSON.parse(localStorage.getItem(Z.StringFormat(Z.KeyFormat,M,Z.ProgressionStoreKey))),Z.instance.progressionStore||(Z.instance.progressionStore=[])}catch(M){b.w("Load failed for 'progression' store. Using empty store."),Z.instance.progressionStore=[]}try{Z.instance.storeItems=JSON.parse(localStorage.getItem(Z.StringFormat(Z.KeyFormat,M,Z.ItemsStoreKey))),Z.instance.storeItems||(Z.instance.storeItems={})}catch(M){b.w("Load failed for 'items' store. Using empty store."),Z.instance.progressionStore=[]}}else b.w("Storage is not available, cannot load.")},Z.setItem=function(M,j,K){var b=Z.StringFormat(Z.KeyFormat,M,j);K?Z.instance.storeItems[b]=K:b in Z.instance.storeItems&&delete Z.instance.storeItems[b]},Z.getItem=function(M,j){var K=Z.StringFormat(Z.KeyFormat,M,j);return K in Z.instance.storeItems?Z.instance.storeItems[K]:null},Z.getStore=function(M){switch(M){case K.Events:return Z.instance.eventsStore;case K.Sessions:return Z.instance.sessionsStore;case K.Progression:return Z.instance.progressionStore;default:return b.w("GAStore.getStore(): Cannot find store: "+M),null}},Z.instance=new Z,Z.MaxNumberOfEntries=2e3,Z.StringFormat=function(Z){for(var M=[],j=1;j<arguments.length;j++)M[j-1]=arguments[j];return Z.replace(/{(\d+)}/g,(function(Z,j){return M[j]||""}))},Z.KeyFormat="GA::{0}::{1}",Z.EventsStoreKey="ga_event",Z.SessionsStoreKey="ga_session",Z.ProgressionStoreKey="ga_progression",Z.ItemsStoreKey="ga_items",Z}();M.GAStore=g}(Z.store||(Z.store={}))}(b||(b={})),function(Z){!function(M){var j=Z.validators.GAValidator,K=Z.utilities.GAUtilities,b=Z.logging.GALogger,g=Z.store.GAStore,O=Z.device.GADevice,Q=Z.store.EGAStore,Y=Z.store.EGAStoreArgsOperator,I=function(){function Z(){this.availableCustomDimensions01=[],this.availableCustomDimensions02=[],this.availableCustomDimensions03=[],this.availableResourceCurrencies=[],this.availableResourceItemTypes=[],this.configurations={},this.remoteConfigsListeners=[],this.sdkConfigDefault={},this.sdkConfig={},this.progressionTries={},this._isEventSubmissionEnabled=!0}return Z.setUserId=function(M){Z.instance.userId=M,Z.cacheIdentifier()},Z.getIdentifier=function(){return Z.instance.identifier},Z.isInitialized=function(){return Z.instance.initialized},Z.setInitialized=function(M){Z.instance.initialized=M},Z.getSessionStart=function(){return Z.instance.sessionStart},Z.getSessionNum=function(){return Z.instance.sessionNum},Z.getTransactionNum=function(){return Z.instance.transactionNum},Z.getSessionId=function(){return Z.instance.sessionId},Z.getCurrentCustomDimension01=function(){return Z.instance.currentCustomDimension01},Z.getCurrentCustomDimension02=function(){return Z.instance.currentCustomDimension02},Z.getCurrentCustomDimension03=function(){return Z.instance.currentCustomDimension03},Z.getGameKey=function(){return Z.instance.gameKey},Z.getGameSecret=function(){return Z.instance.gameSecret},Z.getAvailableCustomDimensions01=function(){return Z.instance.availableCustomDimensions01},Z.setAvailableCustomDimensions01=function(M){j.validateCustomDimensions(M)&&(Z.instance.availableCustomDimensions01=M,Z.validateAndFixCurrentDimensions(),b.i("Set available custom01 dimension values: ("+K.joinStringArray(M,", ")+")"))},Z.getAvailableCustomDimensions02=function(){return Z.instance.availableCustomDimensions02},Z.setAvailableCustomDimensions02=function(M){j.validateCustomDimensions(M)&&(Z.instance.availableCustomDimensions02=M,Z.validateAndFixCurrentDimensions(),b.i("Set available custom02 dimension values: ("+K.joinStringArray(M,", ")+")"))},Z.getAvailableCustomDimensions03=function(){return Z.instance.availableCustomDimensions03},Z.setAvailableCustomDimensions03=function(M){j.validateCustomDimensions(M)&&(Z.instance.availableCustomDimensions03=M,Z.validateAndFixCurrentDimensions(),b.i("Set available custom03 dimension values: ("+K.joinStringArray(M,", ")+")"))},Z.getAvailableResourceCurrencies=function(){return Z.instance.availableResourceCurrencies},Z.setAvailableResourceCurrencies=function(M){j.validateResourceCurrencies(M)&&(Z.instance.availableResourceCurrencies=M,b.i("Set available resource currencies: ("+K.joinStringArray(M,", ")+")"))},Z.getAvailableResourceItemTypes=function(){return Z.instance.availableResourceItemTypes},Z.setAvailableResourceItemTypes=function(M){j.validateResourceItemTypes(M)&&(Z.instance.availableResourceItemTypes=M,b.i("Set available resource item types: ("+K.joinStringArray(M,", ")+")"))},Z.getBuild=function(){return Z.instance.build},Z.setBuild=function(M){Z.instance.build=M,b.i("Set build version: "+M)},Z.getUseManualSessionHandling=function(){return Z.instance.useManualSessionHandling},Z.isEventSubmissionEnabled=function(){return Z.instance._isEventSubmissionEnabled},Z.getABTestingId=function(){return Z.instance.abId},Z.getABTestingVariantId=function(){return Z.instance.abVariantId},Z.prototype.setDefaultId=function(M){this.defaultUserId=M||"",Z.cacheIdentifier()},Z.getDefaultId=function(){return Z.instance.defaultUserId},Z.getSdkConfig=function(){var M=0;for(var j in Z.instance.sdkConfig)0===M&&(K=j),++M;if(K&&M>0)return Z.instance.sdkConfig;var K;M=0;for(var j in Z.instance.sdkConfigCached)0===M&&(K=j),++M;return K&&M>0?Z.instance.sdkConfigCached:Z.instance.sdkConfigDefault},Z.isEnabled=function(){return!!Z.instance.initAuthorized},Z.setCustomDimension01=function(M){Z.instance.currentCustomDimension01=M,g.setItem(Z.getGameKey(),Z.Dimension01Key,M),b.i("Set custom01 dimension value: "+M)},Z.setCustomDimension02=function(M){Z.instance.currentCustomDimension02=M,g.setItem(Z.getGameKey(),Z.Dimension02Key,M),b.i("Set custom02 dimension value: "+M)},Z.setCustomDimension03=function(M){Z.instance.currentCustomDimension03=M,g.setItem(Z.getGameKey(),Z.Dimension03Key,M),b.i("Set custom03 dimension value: "+M)},Z.incrementSessionNum=function(){var M=Z.getSessionNum()+1;Z.instance.sessionNum=M},Z.incrementTransactionNum=function(){var M=Z.getTransactionNum()+1;Z.instance.transactionNum=M},Z.incrementProgressionTries=function(M){var j=Z.getProgressionTries(M)+1;Z.instance.progressionTries[M]=j;var K={};K.progression=M,K.tries=j,g.insert(Q.Progression,K,!0,"progression")},Z.getProgressionTries=function(M){return M in Z.instance.progressionTries?Z.instance.progressionTries[M]:0},Z.clearProgressionTries=function(M){M in Z.instance.progressionTries&&delete Z.instance.progressionTries[M];var j=[];j.push(["progression",Y.Equal,M]),g.delete(Q.Progression,j)},Z.setKeys=function(M,j){Z.instance.gameKey=M,Z.instance.gameSecret=j},Z.setManualSessionHandling=function(M){Z.instance.useManualSessionHandling=M,b.i("Use manual session handling: "+M)},Z.setEnabledEventSubmission=function(M){Z.instance._isEventSubmissionEnabled=M},Z.getEventAnnotations=function(){var M={v:2};M.user_id=Z.instance.identifier,M.client_ts=Z.getClientTsAdjusted(),M.sdk_version=O.getRelevantSdkVersion(),M.os_version=O.osVersion,M.manufacturer=O.deviceManufacturer,M.device=O.deviceModel,M.browser_version=O.browserVersion,M.platform=O.buildPlatform,M.session_id=Z.instance.sessionId,M[Z.SessionNumKey]=Z.instance.sessionNum;var K=O.getConnectionType();if(j.validateConnectionType(K)&&(M.connection_type=K),O.gameEngineVersion&&(M.engine_version=O.gameEngineVersion),Z.instance.configurations){var b=0;for(var g in Z.instance.configurations){b++;break}b>0&&(M.configurations=Z.instance.configurations)}return Z.instance.abId&&(M.ab_id=Z.instance.abId),Z.instance.abVariantId&&(M.ab_variant_id=Z.instance.abVariantId),Z.instance.build&&(M.build=Z.instance.build),M},Z.getSdkErrorEventAnnotations=function(){var M={v:2};M.category=Z.CategorySdkError,M.sdk_version=O.getRelevantSdkVersion(),M.os_version=O.osVersion,M.manufacturer=O.deviceManufacturer,M.device=O.deviceModel,M.platform=O.buildPlatform;var K=O.getConnectionType();return j.validateConnectionType(K)&&(M.connection_type=K),O.gameEngineVersion&&(M.engine_version=O.gameEngineVersion),M},Z.getInitAnnotations=function(){var M={};return Z.getIdentifier()||Z.cacheIdentifier(),M.user_id=Z.getIdentifier(),M.sdk_version=O.getRelevantSdkVersion(),M.os_version=O.osVersion,M.platform=O.buildPlatform,Z.getBuild()?M.build=Z.getBuild():M.build=null,M.session_num=Z.getSessionNum(),M.random_salt=Z.getSessionNum(),M},Z.getClientTsAdjusted=function(){var M=K.timeIntervalSince1970(),b=M+Z.instance.clientServerTimeOffset;return j.validateClientTs(b)?b:M},Z.sessionIsStarted=function(){return 0!=Z.instance.sessionStart},Z.cacheIdentifier=function(){Z.instance.userId?Z.instance.identifier=Z.instance.userId:Z.instance.defaultUserId&&(Z.instance.identifier=Z.instance.defaultUserId)},Z.ensurePersistedStates=function(){g.isStorageAvailable()&&g.load(Z.getGameKey());var M=Z.instance;M.setDefaultId(null!=g.getItem(Z.getGameKey(),Z.DefaultUserIdKey)?g.getItem(Z.getGameKey(),Z.DefaultUserIdKey):K.createGuid()),M.sessionNum=null!=g.getItem(Z.getGameKey(),Z.SessionNumKey)?Number(g.getItem(Z.getGameKey(),Z.SessionNumKey)):0,M.transactionNum=null!=g.getItem(Z.getGameKey(),Z.TransactionNumKey)?Number(g.getItem(Z.getGameKey(),Z.TransactionNumKey)):0,M.currentCustomDimension01?g.setItem(Z.getGameKey(),Z.Dimension01Key,M.currentCustomDimension01):(M.currentCustomDimension01=null!=g.getItem(Z.getGameKey(),Z.Dimension01Key)?g.getItem(Z.getGameKey(),Z.Dimension01Key):"",M.currentCustomDimension01),M.currentCustomDimension02?g.setItem(Z.getGameKey(),Z.Dimension02Key,M.currentCustomDimension02):(M.currentCustomDimension02=null!=g.getItem(Z.getGameKey(),Z.Dimension02Key)?g.getItem(Z.getGameKey(),Z.Dimension02Key):"",M.currentCustomDimension02),M.currentCustomDimension03?g.setItem(Z.getGameKey(),Z.Dimension03Key,M.currentCustomDimension03):(M.currentCustomDimension03=null!=g.getItem(Z.getGameKey(),Z.Dimension03Key)?g.getItem(Z.getGameKey(),Z.Dimension03Key):"",M.currentCustomDimension03);var j=null!=g.getItem(Z.getGameKey(),Z.SdkConfigCachedKey)?g.getItem(Z.getGameKey(),Z.SdkConfigCachedKey):"";if(j){var b=JSON.parse(K.decode64(j));b&&(M.sdkConfigCached=b)}var O=Z.getSdkConfig();M.configsHash=O.configs_hash?O.configs_hash:"",M.abId=O.ab_id?O.ab_id:"",M.abVariantId=O.ab_variant_id?O.ab_variant_id:"";var Y=g.select(Q.Progression);if(Y)for(var I=0;I<Y.length;++I){var E=Y[I];E&&(M.progressionTries[E.progression]=E.tries)}},Z.calculateServerTimeOffset=function(Z){return Z-K.timeIntervalSince1970()},Z.validateAndCleanCustomFields=function(M){var j={};if(M){var g=0;for(var O in M){var Q=M[O];if(O&&Q)if(g<Z.MAX_CUSTOM_FIELDS_COUNT){var Y=new RegExp("^[a-zA-Z0-9_]{1,"+Z.MAX_CUSTOM_FIELDS_KEY_LENGTH+"}$");if(K.stringMatch(O,Y)){var I=typeof Q;if("string"===I||Q instanceof String){var E=Q;E.length<=Z.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH&&E.length>0?(j[O]=E,++g):b.w("validateAndCleanCustomFields: entry with key="+O+", value="+Q+" has been omitted because its value is an empty string or exceeds the max number of characters ("+Z.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH+")")}else if("number"===I||Q instanceof Number){var s=Q;j[O]=s,++g}else b.w("validateAndCleanCustomFields: entry with key="+O+", value="+Q+" has been omitted because its value is not a string or number")}else b.w("validateAndCleanCustomFields: entry with key="+O+", value="+Q+" has been omitted because its key contains illegal character, is empty or exceeds the max number of characters ("+Z.MAX_CUSTOM_FIELDS_KEY_LENGTH+")")}else b.w("validateAndCleanCustomFields: entry with key="+O+", value="+Q+" has been omitted because it exceeds the max number of custom fields ("+Z.MAX_CUSTOM_FIELDS_COUNT+")");else b.w("validateAndCleanCustomFields: entry with key="+O+", value="+Q+" has been omitted because its key or value is null")}}return j},Z.validateAndFixCurrentDimensions=function(){j.validateDimension01(Z.getCurrentCustomDimension01(),Z.getAvailableCustomDimensions01())||Z.setCustomDimension01(""),j.validateDimension02(Z.getCurrentCustomDimension02(),Z.getAvailableCustomDimensions02())||Z.setCustomDimension02(""),j.validateDimension03(Z.getCurrentCustomDimension03(),Z.getAvailableCustomDimensions03())||Z.setCustomDimension03("")},Z.getConfigurationStringValue=function(M,j){return Z.instance.configurations[M]?Z.instance.configurations[M].toString():j},Z.isRemoteConfigsReady=function(){return Z.instance.remoteConfigsIsReady},Z.addRemoteConfigsListener=function(M){Z.instance.remoteConfigsListeners.indexOf(M)<0&&Z.instance.remoteConfigsListeners.push(M)},Z.removeRemoteConfigsListener=function(M){var j=Z.instance.remoteConfigsListeners.indexOf(M);j>-1&&Z.instance.remoteConfigsListeners.splice(j,1)},Z.getRemoteConfigsContentAsString=function(){return JSON.stringify(Z.instance.configurations)},Z.populateConfigurations=function(M){var j=M.configs;if(j){Z.instance.configurations={};for(var K=0;K<j.length;++K){var b=j[K];if(b){var g=b.key,O=b.value,Q=b.start_ts?b.start_ts:Number.MIN_VALUE,Y=b.end_ts?b.end_ts:Number.MAX_VALUE,I=Z.getClientTsAdjusted();g&&O&&I>Q&&I<Y&&(Z.instance.configurations[g]=O)}}}Z.instance.remoteConfigsIsReady=!0;var E=Z.instance.remoteConfigsListeners;for(K=0;K<E.length;++K)E[K]&&E[K].onRemoteConfigsUpdated()},Z.CategorySdkError="sdk_error",Z.MAX_CUSTOM_FIELDS_COUNT=50,Z.MAX_CUSTOM_FIELDS_KEY_LENGTH=64,Z.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH=256,Z.instance=new Z,Z.DefaultUserIdKey="default_user_id",Z.SessionNumKey="session_num",Z.TransactionNumKey="transaction_num",Z.Dimension01Key="dimension01",Z.Dimension02Key="dimension02",Z.Dimension03Key="dimension03",Z.SdkConfigCachedKey="sdk_config_cached",Z}();M.GAState=I}(Z.state||(Z.state={}))}(b||(b={})),function(Z){!function(M){var j=Z.utilities.GAUtilities,K=Z.logging.GALogger,b=function(){function Z(){}return Z.execute=function(M,b,g,O){var Q=new Date;if(Z.timestampMap[b]||(Z.timestampMap[b]=Q),Z.countMap[b]||(Z.countMap[b]=0),(Q.getTime()-Z.timestampMap[b].getTime())/1e3>=3600&&(Z.timestampMap[b]=Q,Z.countMap[b]=0),!(Z.countMap[b]>=Z.MaxCount)){var Y=j.getHmac(O,g),I=new XMLHttpRequest;I.onreadystatechange=function(){if(4===I.readyState){if(!I.responseText)return;if(200!=I.status)return void K.w("sdk error failed. response code not 200. status code: "+I.status+", description: "+I.statusText+", body: "+I.responseText);Z.countMap[b]=Z.countMap[b]+1}},I.open("POST",M,!0),I.setRequestHeader("Content-Type","application/json"),I.setRequestHeader("Authorization",Y);try{I.send(g)}catch(Z){console.error(Z)}}},Z.MaxCount=10,Z.countMap={},Z.timestampMap={},Z}();M.SdkErrorTask=b}(Z.tasks||(Z.tasks={}))}(b||(b={})),function(Z){!function(M){var j=Z.state.GAState,K=Z.logging.GALogger,b=Z.utilities.GAUtilities,g=Z.validators.GAValidator,O=Z.tasks.SdkErrorTask,Q=Z.events.EGASdkErrorCategory,Y=Z.events.EGASdkErrorArea,I=Z.events.EGASdkErrorAction,E=Z.events.EGASdkErrorParameter,s=function(){function Z(){this.protocol="https",this.hostName="api.gameanalytics.com",this.version="v2",this.remoteConfigsVersion="v1",this.baseUrl=this.protocol+"://"+this.hostName+"/"+this.version,this.remoteConfigsBaseUrl=this.protocol+"://"+this.hostName+"/remote_configs/"+this.remoteConfigsVersion,this.initializeUrlPath="init",this.eventsUrlPath="events",this.useGzip=!1}return Z.prototype.requestInit=function(K,b){var g=j.getGameKey(),O=this.remoteConfigsBaseUrl+"/"+this.initializeUrlPath+"?game_key="+g+"&interval_seconds=0&configs_hash="+K,Q=j.getInitAnnotations(),Y=JSON.stringify(Q);if(Y){var I=this.createPayloadData(Y,this.useGzip),E=[];E.push(Y),Z.sendRequest(O,I,E,this.useGzip,Z.initRequestCallback,b)}else b(M.EGAHTTPApiResponse.JsonEncodeFailed,null)},Z.prototype.sendEventsInArray=function(K,b,g){if(0!=K.length){var O=j.getGameKey(),Q=this.baseUrl+"/"+O+"/"+this.eventsUrlPath,Y=JSON.stringify(K);if(Y){var I=this.createPayloadData(Y,this.useGzip),E=[];E.push(Y),E.push(b),E.push(K.length.toString()),Z.sendRequest(Q,I,E,this.useGzip,Z.sendEventInArrayRequestCallback,g)}else g(M.EGAHTTPApiResponse.JsonEncodeFailed,null,b,K.length)}},Z.prototype.sendSdkErrorEvent=function(M,b,Q,Y,I,E,s){if(j.isEventSubmissionEnabled()&&g.validateSdkErrorEvent(E,s,M,b,Q)){var i,a=this.baseUrl+"/"+E+"/"+this.eventsUrlPath,z="",V=j.getSdkErrorEventAnnotations(),o=Z.sdkErrorCategoryString(M);V.error_category=o,z+=o;var c=Z.sdkErrorAreaString(b);V.error_area=c,z+=":"+c;var G=Z.sdkErrorActionString(Q);V.error_action=G;var f=Z.sdkErrorParameterString(Y);if(f.length>0&&(V.error_parameter=f),I.length>0){var X=I;if(I.length>Z.MAX_ERROR_MESSAGE_LENGTH)X=I.substring(0,Z.MAX_ERROR_MESSAGE_LENGTH);V.reason=X}var d=[];d.push(V),(i=JSON.stringify(d))?O.execute(a,z,i,s):K.w("sendSdkErrorEvent: JSON encoding failed.")}},Z.sendEventInArrayRequestCallback=function(K,b,g,O){void 0===O&&(O=null);O[0],O[1];var s,i,a=O[2],z=parseInt(O[3]);s=K.responseText,i=K.status;var V=Z.instance.processRequestResponse(i,K.statusText,s,"Events");if(V==M.EGAHTTPApiResponse.Ok||V==M.EGAHTTPApiResponse.Created||V==M.EGAHTTPApiResponse.BadRequest){var o=s?JSON.parse(s):{};if(null==o)return g(M.EGAHTTPApiResponse.JsonDecodeFailed,null,a,z),void Z.instance.sendSdkErrorEvent(Q.Http,Y.EventsHttp,I.FailHttpJsonDecode,E.Undefined,s,j.getGameKey(),j.getGameSecret());M.EGAHTTPApiResponse.BadRequest,g(V,o,a,z)}else g(V,null,a,z)},Z.sendRequest=function(Z,M,K,g,O,Q){var Y=new XMLHttpRequest,I=j.getGameSecret(),E=b.getHmac(I,M),s=[];for(var i in s.push(E),K)s.push(K[i]);if(Y.onreadystatechange=function(){4===Y.readyState&&O(Y,Z,Q,s)},Y.open("POST",Z,!0),Y.setRequestHeader("Content-Type","application/json"),Y.setRequestHeader("Authorization",E),g)throw new Error("gzip not supported");try{Y.send(M)}catch(Z){console.error(Z.stack)}},Z.initRequestCallback=function(K,b,O,s){void 0===s&&(s=null);var i,a;s[0],s[1];i=K.responseText,a=K.status;var z=i?JSON.parse(i):{},V=Z.instance.processRequestResponse(a,K.statusText,i,"Init");if(V==M.EGAHTTPApiResponse.Ok||V==M.EGAHTTPApiResponse.Created||V==M.EGAHTTPApiResponse.BadRequest){if(null==z)return O(M.EGAHTTPApiResponse.JsonDecodeFailed,null,"",0),void Z.instance.sendSdkErrorEvent(Q.Http,Y.InitHttp,I.FailHttpJsonDecode,E.Undefined,i,j.getGameKey(),j.getGameSecret());if(V!==M.EGAHTTPApiResponse.BadRequest){var o=g.validateAndCleanInitRequestResponse(z,V===M.EGAHTTPApiResponse.Created);o?O(V,o,"",0):O(M.EGAHTTPApiResponse.BadResponse,null,"",0)}else O(V,null,"",0)}else O(V,null,"",0)},Z.prototype.createPayloadData=function(Z,M){if(M)throw new Error("gzip not supported");return Z},Z.prototype.processRequestResponse=function(Z,j,K,b){return K?200===Z?M.EGAHTTPApiResponse.Ok:201===Z?M.EGAHTTPApiResponse.Created:0===Z||401===Z?M.EGAHTTPApiResponse.Unauthorized:400===Z?M.EGAHTTPApiResponse.BadRequest:500===Z?M.EGAHTTPApiResponse.InternalServerError:M.EGAHTTPApiResponse.UnknownResponseCode:M.EGAHTTPApiResponse.NoResponse},Z.sdkErrorCategoryString=function(Z){switch(Z){case Q.EventValidation:return"event_validation";case Q.Database:return"db";case Q.Init:return"init";case Q.Http:return"http";case Q.Json:return"json"}return""},Z.sdkErrorAreaString=function(Z){switch(Z){case Y.BusinessEvent:return"business";case Y.ResourceEvent:return"resource";case Y.ProgressionEvent:return"progression";case Y.DesignEvent:return"design";case Y.ErrorEvent:return"error";case Y.InitHttp:return"init_http";case Y.EventsHttp:return"events_http";case Y.ProcessEvents:return"process_events";case Y.AddEventsToStore:return"add_events_to_store"}return""},Z.sdkErrorActionString=function(Z){switch(Z){case I.InvalidCurrency:return"invalid_currency";case I.InvalidShortString:return"invalid_short_string";case I.InvalidEventPartLength:return"invalid_event_part_length";case I.InvalidEventPartCharacters:return"invalid_event_part_characters";case I.InvalidStore:return"invalid_store";case I.InvalidFlowType:return"invalid_flow_type";case I.StringEmptyOrNull:return"string_empty_or_null";case I.NotFoundInAvailableCurrencies:return"not_found_in_available_currencies";case I.InvalidAmount:return"invalid_amount";case I.NotFoundInAvailableItemTypes:return"not_found_in_available_item_types";case I.WrongProgressionOrder:return"wrong_progression_order";case I.InvalidEventIdLength:return"invalid_event_id_length";case I.InvalidEventIdCharacters:return"invalid_event_id_characters";case I.InvalidProgressionStatus:return"invalid_progression_status";case I.InvalidSeverity:return"invalid_severity";case I.InvalidLongString:return"invalid_long_string";case I.DatabaseTooLarge:return"db_too_large";case I.DatabaseOpenOrCreate:return"db_open_or_create";case I.JsonError:return"json_error";case I.FailHttpJsonDecode:return"fail_http_json_decode";case I.FailHttpJsonEncode:return"fail_http_json_encode"}return""},Z.sdkErrorParameterString=function(Z){switch(Z){case E.Currency:return"currency";case E.CartType:return"cart_type";case E.ItemType:return"item_type";case E.ItemId:return"item_id";case E.Store:return"store";case E.FlowType:return"flow_type";case E.Amount:return"amount";case E.Progression01:return"progression01";case E.Progression02:return"progression02";case E.Progression03:return"progression03";case E.EventId:return"event_id";case E.ProgressionStatus:return"progression_status";case E.Severity:return"severity";case E.Message:return"message"}return""},Z.instance=new Z,Z.MAX_ERROR_MESSAGE_LENGTH=256,Z}();M.GAHTTPApi=s}(Z.http||(Z.http={}))}(b||(b={})),function(Z){!function(M){var j=Z.store.GAStore,K=Z.store.EGAStore,b=Z.store.EGAStoreArgsOperator,g=Z.state.GAState,O=Z.logging.GALogger,Q=Z.utilities.GAUtilities,Y=Z.http.EGAHTTPApiResponse,I=Z.http.GAHTTPApi,E=Z.validators.GAValidator,s=function(){function s(){}return s.addSessionStartEvent=function(){if(g.isEventSubmissionEnabled()){var Z={};Z.category=s.CategorySessionStart,g.incrementSessionNum(),j.setItem(g.getGameKey(),g.SessionNumKey,g.getSessionNum().toString()),s.addDimensionsToEvent(Z),s.addEventToStore(Z),O.i("Add SESSION START event"),s.processEvents(s.CategorySessionStart,!1)}},s.addSessionEndEvent=function(){if(g.isEventSubmissionEnabled()){var Z=g.getSessionStart(),M=g.getClientTsAdjusted()-Z;M<0&&(O.w("Session length was calculated to be less then 0. Should not be possible. Resetting to 0."),M=0);var j={};j.category=s.CategorySessionEnd,j.length=M,s.addDimensionsToEvent(j),s.addEventToStore(j),O.i("Add SESSION END event."),s.processEvents("",!1)}},s.addBusinessEvent=function(Z,M,K,b,Q,Y){if(void 0===Q&&(Q=null),g.isEventSubmissionEnabled()){var i=E.validateBusinessEvent(Z,M,Q,K,b);if(null==i){var a={};g.incrementTransactionNum(),j.setItem(g.getGameKey(),g.TransactionNumKey,g.getTransactionNum().toString()),a.event_id=K+":"+b,a.category=s.CategoryBusiness,a.currency=Z,a.amount=M,a[g.TransactionNumKey]=g.getTransactionNum(),Q&&(a.cart_type=Q),s.addDimensionsToEvent(a),s.addFieldsToEvent(a,g.validateAndCleanCustomFields(Y)),O.i("Add BUSINESS event: {currency:"+Z+", amount:"+M+", itemType:"+K+", itemId:"+b+", cartType:"+Q+"}"),s.addEventToStore(a)}else I.instance.sendSdkErrorEvent(i.category,i.area,i.action,i.parameter,i.reason,g.getGameKey(),g.getGameSecret())}},s.addResourceEvent=function(M,j,K,b,Q,Y){if(g.isEventSubmissionEnabled()){var i=E.validateResourceEvent(M,j,K,b,Q,g.getAvailableResourceCurrencies(),g.getAvailableResourceItemTypes());if(null==i){M===Z.EGAResourceFlowType.Sink&&(K*=-1);var a={},z=s.resourceFlowTypeToString(M);a.event_id=z+":"+j+":"+b+":"+Q,a.category=s.CategoryResource,a.amount=K,s.addDimensionsToEvent(a),s.addFieldsToEvent(a,g.validateAndCleanCustomFields(Y)),O.i("Add RESOURCE event: {currency:"+j+", amount:"+K+", itemType:"+b+", itemId:"+Q+"}"),s.addEventToStore(a)}else I.instance.sendSdkErrorEvent(i.category,i.area,i.action,i.parameter,i.reason,g.getGameKey(),g.getGameSecret())}},s.addProgressionEvent=function(M,j,K,b,Q,Y,i){if(g.isEventSubmissionEnabled()){var a=s.progressionStatusToString(M),z=E.validateProgressionEvent(M,j,K,b);if(null==z){var V,o={};V=K?b?j+":"+K+":"+b:j+":"+K:j,o.category=s.CategoryProgression,o.event_id=a+":"+V;var c=0;Y&&M!=Z.EGAProgressionStatus.Start&&(o.score=Q),M===Z.EGAProgressionStatus.Fail&&g.incrementProgressionTries(V),M===Z.EGAProgressionStatus.Complete&&(g.incrementProgressionTries(V),c=g.getProgressionTries(V),o.attempt_num=c,g.clearProgressionTries(V)),s.addDimensionsToEvent(o),s.addFieldsToEvent(o,g.validateAndCleanCustomFields(i)),O.i("Add PROGRESSION event: {status:"+a+", progression01:"+j+", progression02:"+K+", progression03:"+b+", score:"+Q+", attempt:"+c+"}"),s.addEventToStore(o)}else I.instance.sendSdkErrorEvent(z.category,z.area,z.action,z.parameter,z.reason,g.getGameKey(),g.getGameSecret())}},s.addDesignEvent=function(Z,M,j,K){if(g.isEventSubmissionEnabled()){var b=E.validateDesignEvent(Z);if(null==b){var Q={};Q.category=s.CategoryDesign,Q.event_id=Z,j&&(Q.value=M),s.addDimensionsToEvent(Q),s.addFieldsToEvent(Q,g.validateAndCleanCustomFields(K)),O.i("Add DESIGN event: {eventId:"+Z+", value:"+M+"}"),s.addEventToStore(Q)}else I.instance.sendSdkErrorEvent(b.category,b.area,b.action,b.parameter,b.reason,g.getGameKey(),g.getGameSecret())}},s.addErrorEvent=function(Z,M,j){if(g.isEventSubmissionEnabled()){var K=s.errorSeverityToString(Z),b=E.validateErrorEvent(Z,M);if(null==b){var Q={};Q.category=s.CategoryError,Q.severity=K,Q.message=M,s.addDimensionsToEvent(Q),s.addFieldsToEvent(Q,g.validateAndCleanCustomFields(j)),O.i("Add ERROR event: {severity:"+K+", message:"+M+"}"),s.addEventToStore(Q)}else I.instance.sendSdkErrorEvent(b.category,b.area,b.action,b.parameter,b.reason,g.getGameKey(),g.getGameSecret())}},s.addAdEvent=function(M,j,K,b,Q,Y,i,a){if(g.isEventSubmissionEnabled()){var z=s.adActionToString(M),V=s.adTypeToString(j),o=s.adErrorToString(Q),c=E.validateAdEvent(M,j,K,b);if(null==c){var G={};G.category=s.CategoryAds,G.ad_sdk_name=K,G.ad_placement=b,G.ad_type=V,G.ad_action=z,M==Z.EGAAdAction.FailedShow&&o.length>0&&(G.ad_fail_show_reason=o),!i||j!=Z.EGAAdType.RewardedVideo&&j!=Z.EGAAdType.Video||(G.ad_duration=Y),s.addDimensionsToEvent(G),s.addFieldsToEvent(G,g.validateAndCleanCustomFields(a)),O.i("Add AD event: {ad_sdk_name:"+K+", ad_placement:"+b+", ad_type:"+V+", ad_action:"+z+(M==Z.EGAAdAction.FailedShow&&o.length>0?", ad_fail_show_reason:"+o:"")+(!i||j!=Z.EGAAdType.RewardedVideo&&j!=Z.EGAAdType.Video?"":", ad_duration:"+Y)+"}"),s.addEventToStore(G)}else I.instance.sendSdkErrorEvent(c.category,c.area,c.action,c.parameter,c.reason,g.getGameKey(),g.getGameSecret())}},s.processEvents=function(Z,Y){if(g.isEventSubmissionEnabled())try{var i=Q.createGuid();Y&&(s.cleanupEvents(),s.fixMissingSessionEndEvents());var a=[];a.push(["status",b.Equal,"new"]);var z=[];z.push(["status",b.Equal,"new"]),Z&&(a.push(["category",b.Equal,Z]),z.push(["category",b.Equal,Z]));var V=[];V.push(["status",i]);var o=j.select(K.Events,a);if(!o||0==o.length)return O.i("Event queue: No events to send"),void s.updateSessionStore();if(o.length>s.MaxEventCount){if(!(o=j.select(K.Events,a,!0,s.MaxEventCount)))return;var c=o[o.length-1].client_ts;if(a.push(["client_ts",b.LessOrEqual,c]),!(o=j.select(K.Events,a)))return;z.push(["client_ts",b.LessOrEqual,c])}if(O.i("Event queue: Sending "+o.length+" events."),!j.update(K.Events,V,z))return;for(var G=[],f=0;f<o.length;++f){var X=o[f],d=JSON.parse(Q.decode64(X.event));if(0!=d.length){var W=d.client_ts;W&&!E.validateClientTs(W)&&delete d.client_ts,G.push(d)}}I.instance.sendEventsInArray(G,i,s.processEventsCallback)}catch(Z){O.e("Error during ProcessEvents(): "+Z.stack),I.instance.sendSdkErrorEvent(M.EGASdkErrorCategory.Json,M.EGASdkErrorArea.ProcessEvents,M.EGASdkErrorAction.JsonError,M.EGASdkErrorParameter.Undefined,Z.stack,g.getGameKey(),g.getGameSecret())}},s.processEventsCallback=function(Z,M,g,Q){var I=[];if(I.push(["status",b.Equal,g]),Z===Y.Ok)j.delete(K.Events,I),O.i("Event queue: "+Q+" events sent.");else if(Z===Y.NoResponse){var E=[];E.push(["status","new"]),O.w("Event queue: Failed to send events to collector - Retrying next time"),j.update(K.Events,E,I)}else{if(M){var s,i=0;for(var a in M)0==i&&(s=M[a]),++i;Z===Y.BadRequest&&s.constructor===Array?O.w("Event queue: "+Q+" events sent. "+i+" events failed GA server validation."):O.w("Event queue: Failed to send events.")}else O.w("Event queue: Failed to send events.");j.delete(K.Events,I)}},s.cleanupEvents=function(){j.update(K.Events,[["status","new"]])},s.fixMissingSessionEndEvents=function(){if(g.isEventSubmissionEnabled()){var Z=[];Z.push(["session_id",b.NotEqual,g.getSessionId()]);var M=j.select(K.Sessions,Z);if(M&&0!=M.length){O.i(M.length+" session(s) located with missing session_end event.");for(var Y=0;Y<M.length;++Y){var I=JSON.parse(Q.decode64(M[Y].event)),E=I.client_ts-M[Y].timestamp;E=Math.max(0,E),I.category=s.CategorySessionEnd,I.length=E,s.addEventToStore(I)}}}},s.addEventToStore=function(Z){if(g.isEventSubmissionEnabled())if(g.isInitialized())try{if(j.isStoreTooLargeForEvents()&&!Q.stringMatch(Z.category,/^(user|session_end|business)$/))return O.w("Database too large. Event has been blocked."),void I.instance.sendSdkErrorEvent(M.EGASdkErrorCategory.Database,M.EGASdkErrorArea.AddEventsToStore,M.EGASdkErrorAction.DatabaseTooLarge,M.EGASdkErrorParameter.Undefined,"",g.getGameKey(),g.getGameSecret());var Y=g.getEventAnnotations(),E=Q.encode64(JSON.stringify(Y));for(var i in Z)Y[i]=Z[i];var a=JSON.stringify(Y);O.ii("Event added to queue: "+a);var z={status:"new"};z.category=Y.category,z.session_id=Y.session_id,z.client_ts=Y.client_ts,z.event=Q.encode64(JSON.stringify(Y)),j.insert(K.Events,z),Z.category==s.CategorySessionEnd?j.delete(K.Sessions,[["session_id",b.Equal,Y.session_id]]):((z={}).session_id=Y.session_id,z.timestamp=g.getSessionStart(),z.event=E,j.insert(K.Sessions,z,!0,"session_id")),j.isStorageAvailable()&&j.save(g.getGameKey())}catch(i){O.e("addEventToStore: error"),O.e(i.stack),I.instance.sendSdkErrorEvent(M.EGASdkErrorCategory.Database,M.EGASdkErrorArea.AddEventsToStore,M.EGASdkErrorAction.DatabaseTooLarge,M.EGASdkErrorParameter.Undefined,i.stack,g.getGameKey(),g.getGameSecret())}else O.w("Could not add event: SDK is not initialized")},s.updateSessionStore=function(){if(g.sessionIsStarted()){var Z={};Z.session_id=g.instance.sessionId,Z.timestamp=g.getSessionStart(),Z.event=Q.encode64(JSON.stringify(g.getEventAnnotations())),j.insert(K.Sessions,Z,!0,"session_id"),j.isStorageAvailable()&&j.save(g.getGameKey())}},s.addDimensionsToEvent=function(Z){Z&&(g.getCurrentCustomDimension01()&&(Z.custom_01=g.getCurrentCustomDimension01()),g.getCurrentCustomDimension02()&&(Z.custom_02=g.getCurrentCustomDimension02()),g.getCurrentCustomDimension03()&&(Z.custom_03=g.getCurrentCustomDimension03()))},s.addFieldsToEvent=function(Z,M){Z&&M&&Object.keys(M).length>0&&(Z.custom_fields=M)},s.resourceFlowTypeToString=function(M){return M==Z.EGAResourceFlowType.Source||M==Z.EGAResourceFlowType[Z.EGAResourceFlowType.Source]?"Source":M==Z.EGAResourceFlowType.Sink||M==Z.EGAResourceFlowType[Z.EGAResourceFlowType.Sink]?"Sink":""},s.progressionStatusToString=function(M){return M==Z.EGAProgressionStatus.Start||M==Z.EGAProgressionStatus[Z.EGAProgressionStatus.Start]?"Start":M==Z.EGAProgressionStatus.Complete||M==Z.EGAProgressionStatus[Z.EGAProgressionStatus.Complete]?"Complete":M==Z.EGAProgressionStatus.Fail||M==Z.EGAProgressionStatus[Z.EGAProgressionStatus.Fail]?"Fail":""},s.errorSeverityToString=function(M){return M==Z.EGAErrorSeverity.Debug||M==Z.EGAErrorSeverity[Z.EGAErrorSeverity.Debug]?"debug":M==Z.EGAErrorSeverity.Info||M==Z.EGAErrorSeverity[Z.EGAErrorSeverity.Info]?"info":M==Z.EGAErrorSeverity.Warning||M==Z.EGAErrorSeverity[Z.EGAErrorSeverity.Warning]?"warning":M==Z.EGAErrorSeverity.Error||M==Z.EGAErrorSeverity[Z.EGAErrorSeverity.Error]?"error":M==Z.EGAErrorSeverity.Critical||M==Z.EGAErrorSeverity[Z.EGAErrorSeverity.Critical]?"critical":""},s.adActionToString=function(M){return M==Z.EGAAdAction.Clicked||M==Z.EGAAdAction[Z.EGAAdAction.Clicked]?"clicked":M==Z.EGAAdAction.Show||M==Z.EGAAdAction[Z.EGAAdAction.Show]?"show":M==Z.EGAAdAction.FailedShow||M==Z.EGAAdAction[Z.EGAAdAction.FailedShow]?"failed_show":M==Z.EGAAdAction.RewardReceived||M==Z.EGAAdAction[Z.EGAAdAction.RewardReceived]?"reward_received":""},s.adErrorToString=function(M){return M==Z.EGAAdError.Unknown||M==Z.EGAAdError[Z.EGAAdError.Unknown]?"unknown":M==Z.EGAAdError.Offline||M==Z.EGAAdError[Z.EGAAdError.Offline]?"offline":M==Z.EGAAdError.NoFill||M==Z.EGAAdError[Z.EGAAdError.NoFill]?"no_fill":M==Z.EGAAdError.InternalError||M==Z.EGAAdError[Z.EGAAdError.InternalError]?"internal_error":M==Z.EGAAdError.InvalidRequest||M==Z.EGAAdError[Z.EGAAdError.InvalidRequest]?"invalid_request":M==Z.EGAAdError.UnableToPrecache||M==Z.EGAAdError[Z.EGAAdError.UnableToPrecache]?"unable_to_precache":""},s.adTypeToString=function(M){return M==Z.EGAAdType.Video||M==Z.EGAAdType[Z.EGAAdType.Video]?"video":M==Z.EGAAdType.RewardedVideo||M==Z.EGAAdError[Z.EGAAdType.RewardedVideo]?"rewarded_video":M==Z.EGAAdType.Playable||M==Z.EGAAdError[Z.EGAAdType.Playable]?"playable":M==Z.EGAAdType.Interstitial||M==Z.EGAAdError[Z.EGAAdType.Interstitial]?"interstitial":M==Z.EGAAdType.OfferWall||M==Z.EGAAdError[Z.EGAAdType.OfferWall]?"offer_wall":M==Z.EGAAdType.Banner||M==Z.EGAAdError[Z.EGAAdType.Banner]?"banner":""},s.CategorySessionStart="user",s.CategorySessionEnd="session_end",s.CategoryDesign="design",s.CategoryBusiness="business",s.CategoryProgression="progression",s.CategoryResource="resource",s.CategoryError="error",s.CategoryAds="ads",s.MaxEventCount=500,s}();M.GAEvents=s}(Z.events||(Z.events={}))}(b||(b={})),function(Z){!function(M){var j=Z.logging.GALogger,K=Z.state.GAState,b=Z.events.GAEvents,g=function(){function Z(){this.blocks=new M.PriorityQueue({compare:function(Z,M){return Z-M}}),this.id2TimedBlockMap={},Z.startThread()}return Z.createTimedBlock=function(Z){void 0===Z&&(Z=0);var j=new Date;return j.setSeconds(j.getSeconds()+Z),new M.TimedBlock(j)},Z.performTaskOnGAThread=function(j,K){void 0===K&&(K=0);var b=new Date;b.setSeconds(b.getSeconds()+K);var g=new M.TimedBlock(b);g.block=j,Z.instance.id2TimedBlockMap[g.id]=g,Z.instance.addTimedBlock(g)},Z.performTimedBlockOnGAThread=function(M){Z.instance.id2TimedBlockMap[M.id]=M,Z.instance.addTimedBlock(M)},Z.scheduleTimer=function(j,K){var b=new Date;b.setSeconds(b.getSeconds()+j);var g=new M.TimedBlock(b);return g.block=K,Z.instance.id2TimedBlockMap[g.id]=g,Z.instance.addTimedBlock(g),g.id},Z.getTimedBlockById=function(M){return M in Z.instance.id2TimedBlockMap?Z.instance.id2TimedBlockMap[M]:null},Z.ensureEventQueueIsRunning=function(){Z.instance.keepRunning=!0,Z.instance.isRunning||(Z.instance.isRunning=!0,Z.scheduleTimer(Z.ProcessEventsIntervalInSeconds,Z.processEventQueue))},Z.endSessionAndStopQueue=function(){K.isInitialized()&&(j.i("Ending session."),Z.stopEventQueue(),K.isEnabled()&&K.sessionIsStarted()&&(b.addSessionEndEvent(),K.instance.sessionStart=0))},Z.stopEventQueue=function(){Z.instance.keepRunning=!1},Z.ignoreTimer=function(M){M in Z.instance.id2TimedBlockMap&&(Z.instance.id2TimedBlockMap[M].ignore=!0)},Z.setEventProcessInterval=function(M){M>0&&(Z.ProcessEventsIntervalInSeconds=M)},Z.prototype.addTimedBlock=function(Z){this.blocks.enqueue(Z.deadline.getTime(),Z)},Z.run=function(){clearTimeout(Z.runTimeoutId);try{for(var M;M=Z.getNextBlock();)if(!M.ignore)if(M.async){if(!M.running){M.running=!0,M.block();break}}else M.block();return void(Z.runTimeoutId=setTimeout(Z.run,Z.ThreadWaitTimeInMs))}catch(Z){j.e("Error on GA thread"),j.e(Z.stack)}},Z.startThread=function(){Z.runTimeoutId=setTimeout(Z.run,0)},Z.getNextBlock=function(){var M=new Date;return Z.instance.blocks.hasItems()&&Z.instance.blocks.peek().deadline.getTime()<=M.getTime()?Z.instance.blocks.peek().async&&Z.instance.blocks.peek().running?Z.instance.blocks.peek():Z.instance.blocks.dequeue():null},Z.processEventQueue=function(){b.processEvents("",!0),Z.instance.keepRunning?Z.scheduleTimer(Z.ProcessEventsIntervalInSeconds,Z.processEventQueue):Z.instance.isRunning=!1},Z.instance=new Z,Z.ThreadWaitTimeInMs=1e3,Z.ProcessEventsIntervalInSeconds=8,Z}();M.GAThreading=g}(Z.threading||(Z.threading={}))}(b||(b={})),function(Z){var M=Z.threading.GAThreading,K=Z.logging.GALogger,b=Z.store.GAStore,g=Z.state.GAState,O=Z.http.GAHTTPApi,Q=Z.device.GADevice,Y=Z.validators.GAValidator,I=Z.http.EGAHTTPApiResponse,E=Z.utilities.GAUtilities,s=Z.events.GAEvents,i=function(){function i(){}return i.getGlobalObject=function(){return"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof j.g?j.g:void 0},i.init=function(){if(Q.touch(),i.methodMap.configureAvailableCustomDimensions01=i.configureAvailableCustomDimensions01,i.methodMap.configureAvailableCustomDimensions02=i.configureAvailableCustomDimensions02,i.methodMap.configureAvailableCustomDimensions03=i.configureAvailableCustomDimensions03,i.methodMap.configureAvailableResourceCurrencies=i.configureAvailableResourceCurrencies,i.methodMap.configureAvailableResourceItemTypes=i.configureAvailableResourceItemTypes,i.methodMap.configureBuild=i.configureBuild,i.methodMap.configureSdkGameEngineVersion=i.configureSdkGameEngineVersion,i.methodMap.configureGameEngineVersion=i.configureGameEngineVersion,i.methodMap.configureUserId=i.configureUserId,i.methodMap.initialize=i.initialize,i.methodMap.addBusinessEvent=i.addBusinessEvent,i.methodMap.addResourceEvent=i.addResourceEvent,i.methodMap.addProgressionEvent=i.addProgressionEvent,i.methodMap.addDesignEvent=i.addDesignEvent,i.methodMap.addErrorEvent=i.addErrorEvent,i.methodMap.addErrorEvent=i.addErrorEvent,i.methodMap.setEnabledInfoLog=i.setEnabledInfoLog,i.methodMap.setEnabledVerboseLog=i.setEnabledVerboseLog,i.methodMap.setEnabledManualSessionHandling=i.setEnabledManualSessionHandling,i.methodMap.setEnabledEventSubmission=i.setEnabledEventSubmission,i.methodMap.setCustomDimension01=i.setCustomDimension01,i.methodMap.setCustomDimension02=i.setCustomDimension02,i.methodMap.setCustomDimension03=i.setCustomDimension03,i.methodMap.setEventProcessInterval=i.setEventProcessInterval,i.methodMap.startSession=i.startSession,i.methodMap.endSession=i.endSession,i.methodMap.onStop=i.onStop,i.methodMap.onResume=i.onResume,i.methodMap.addRemoteConfigsListener=i.addRemoteConfigsListener,i.methodMap.removeRemoteConfigsListener=i.removeRemoteConfigsListener,i.methodMap.getRemoteConfigsValueAsString=i.getRemoteConfigsValueAsString,i.methodMap.isRemoteConfigsReady=i.isRemoteConfigsReady,i.methodMap.getRemoteConfigsContentAsString=i.getRemoteConfigsContentAsString,"undefined"!==typeof i.getGlobalObject()&&"undefined"!==typeof i.getGlobalObject().GameAnalytics&&"undefined"!==typeof i.getGlobalObject().GameAnalytics.q){var Z=i.getGlobalObject().GameAnalytics.q;for(var j in Z)i.gaCommand.apply(null,Z[j])}window.addEventListener("beforeunload",(function(){console.log("addEventListener unload"),M.endSessionAndStopQueue()}))},i.gaCommand=function(){for(var M=[],j=0;j<arguments.length;j++)M[j]=arguments[j];M.length>0&&M[0]in Z.GameAnalytics.methodMap&&(M.length>1?Z.GameAnalytics.methodMap[M[0]].apply(null,Array.prototype.slice.call(M,1)):Z.GameAnalytics.methodMap[M[0]]())},i.configureAvailableCustomDimensions01=function(Z){void 0===Z&&(Z=[]),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!1)?K.w("Available custom dimensions must be set before SDK is initialized"):g.setAvailableCustomDimensions01(Z)}))},i.configureAvailableCustomDimensions02=function(Z){void 0===Z&&(Z=[]),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!1)?K.w("Available custom dimensions must be set before SDK is initialized"):g.setAvailableCustomDimensions02(Z)}))},i.configureAvailableCustomDimensions03=function(Z){void 0===Z&&(Z=[]),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!1)?K.w("Available custom dimensions must be set before SDK is initialized"):g.setAvailableCustomDimensions03(Z)}))},i.configureAvailableResourceCurrencies=function(Z){void 0===Z&&(Z=[]),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!1)?K.w("Available resource currencies must be set before SDK is initialized"):g.setAvailableResourceCurrencies(Z)}))},i.configureAvailableResourceItemTypes=function(Z){void 0===Z&&(Z=[]),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!1)?K.w("Available resource item types must be set before SDK is initialized"):g.setAvailableResourceItemTypes(Z)}))},i.configureBuild=function(Z){void 0===Z&&(Z=""),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!1)?K.w("Build version must be set before SDK is initialized."):Y.validateBuild(Z)?g.setBuild(Z):K.i("Validation fail - configure build: Cannot be null, empty or above 32 length. String: "+Z)}))},i.configureSdkGameEngineVersion=function(Z){void 0===Z&&(Z=""),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!1)||(Y.validateSdkWrapperVersion(Z)?Q.sdkGameEngineVersion=Z:K.i("Validation fail - configure sdk version: Sdk version not supported. String: "+Z))}))},i.configureGameEngineVersion=function(Z){void 0===Z&&(Z=""),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!1)||(Y.validateEngineVersion(Z)?Q.gameEngineVersion=Z:K.i("Validation fail - configure game engine version: Game engine version not supported. String: "+Z))}))},i.configureUserId=function(Z){void 0===Z&&(Z=""),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!1)?K.w("A custom user id must be set before SDK is initialized."):Y.validateUserId(Z)?g.setUserId(Z):K.i("Validation fail - configure user_id: Cannot be null, empty or above 64 length. Will use default user_id method. Used string: "+Z)}))},i.initialize=function(Z,j){void 0===Z&&(Z=""),void 0===j&&(j=""),Q.updateConnectionType();var b=M.createTimedBlock();b.async=!0,i.initTimedBlockId=b.id,b.block=function(){i.isSdkReady(!0,!1)?K.w("SDK already initialized. Can only be called once."):Y.validateKeys(Z,j)?(g.setKeys(Z,j),i.internalInitialize()):K.w("SDK failed initialize. Game key or secret key is invalid. Can only contain characters A-z 0-9, gameKey is 32 length, gameSecret is 40 length. Failed keys - gameKey: "+Z+", secretKey: "+j)},M.performTimedBlockOnGAThread(b)},i.addBusinessEvent=function(Z,j,K,b,g){void 0===Z&&(Z=""),void 0===j&&(j=0),void 0===K&&(K=""),void 0===b&&(b=""),void 0===g&&(g=""),Q.updateConnectionType(),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!0,"Could not add business event")&&s.addBusinessEvent(Z,j,K,b,g,{})}))},i.addResourceEvent=function(j,K,b,g,O){void 0===j&&(j=Z.EGAResourceFlowType.Undefined),void 0===K&&(K=""),void 0===b&&(b=0),void 0===g&&(g=""),void 0===O&&(O=""),Q.updateConnectionType(),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!0,"Could not add resource event")&&s.addResourceEvent(j,K,b,g,O,{})}))},i.addProgressionEvent=function(j,K,b,g,O){void 0===j&&(j=Z.EGAProgressionStatus.Undefined),void 0===K&&(K=""),void 0===b&&(b=""),void 0===g&&(g=""),Q.updateConnectionType(),M.performTaskOnGAThread((function(){if(i.isSdkReady(!0,!0,"Could not add progression event")){var Z="number"===typeof O;s.addProgressionEvent(j,K,b,g,Z?O:0,Z,{})}}))},i.addDesignEvent=function(Z,j){Q.updateConnectionType(),M.performTaskOnGAThread((function(){if(i.isSdkReady(!0,!0,"Could not add design event")){var M="number"===typeof j;s.addDesignEvent(Z,M?j:0,M,{})}}))},i.addErrorEvent=function(j,K){void 0===j&&(j=Z.EGAErrorSeverity.Undefined),void 0===K&&(K=""),Q.updateConnectionType(),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!0,"Could not add error event")&&s.addErrorEvent(j,K,{})}))},i.addAdEventWithNoAdReason=function(j,K,b,g,O){void 0===j&&(j=Z.EGAAdAction.Undefined),void 0===K&&(K=Z.EGAAdType.Undefined),void 0===b&&(b=""),void 0===g&&(g=""),void 0===O&&(O=Z.EGAAdError.Undefined),Q.updateConnectionType(),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!0,"Could not add ad event")&&s.addAdEvent(j,K,b,g,O,0,!1,{})}))},i.addAdEventWithDuration=function(j,K,b,g,O){void 0===j&&(j=Z.EGAAdAction.Undefined),void 0===K&&(K=Z.EGAAdType.Undefined),void 0===b&&(b=""),void 0===g&&(g=""),void 0===O&&(O=0),Q.updateConnectionType(),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!0,"Could not add ad event")&&s.addAdEvent(j,K,b,g,Z.EGAAdError.Undefined,O,!0,{})}))},i.addAdEvent=function(j,K,b,g){void 0===j&&(j=Z.EGAAdAction.Undefined),void 0===K&&(K=Z.EGAAdType.Undefined),void 0===b&&(b=""),void 0===g&&(g=""),Q.updateConnectionType(),M.performTaskOnGAThread((function(){i.isSdkReady(!0,!0,"Could not add ad event")&&s.addAdEvent(j,K,b,g,Z.EGAAdError.Undefined,0,!1,{})}))},i.setEnabledInfoLog=function(Z){void 0===Z&&(Z=!1),M.performTaskOnGAThread((function(){Z?(K.setInfoLog(Z),K.i("Info logging enabled")):(K.i("Info logging disabled"),K.setInfoLog(Z))}))},i.setEnabledVerboseLog=function(Z){void 0===Z&&(Z=!1),M.performTaskOnGAThread((function(){Z?(K.setVerboseLog(Z),K.i("Verbose logging enabled")):(K.i("Verbose logging disabled"),K.setVerboseLog(Z))}))},i.setEnabledManualSessionHandling=function(Z){void 0===Z&&(Z=!1),M.performTaskOnGAThread((function(){g.setManualSessionHandling(Z)}))},i.setEnabledEventSubmission=function(Z){void 0===Z&&(Z=!1),M.performTaskOnGAThread((function(){Z?(g.setEnabledEventSubmission(Z),K.i("Event submission enabled")):(K.i("Event submission disabled"),g.setEnabledEventSubmission(Z))}))},i.setCustomDimension01=function(Z){void 0===Z&&(Z=""),M.performTaskOnGAThread((function(){Y.validateDimension01(Z,g.getAvailableCustomDimensions01())?g.setCustomDimension01(Z):K.w("Could not set custom01 dimension value to '"+Z+"'. Value not found in available custom01 dimension values")}))},i.setCustomDimension02=function(Z){void 0===Z&&(Z=""),M.performTaskOnGAThread((function(){Y.validateDimension02(Z,g.getAvailableCustomDimensions02())?g.setCustomDimension02(Z):K.w("Could not set custom02 dimension value to '"+Z+"'. Value not found in available custom02 dimension values")}))},i.setCustomDimension03=function(Z){void 0===Z&&(Z=""),M.performTaskOnGAThread((function(){Y.validateDimension03(Z,g.getAvailableCustomDimensions03())?g.setCustomDimension03(Z):K.w("Could not set custom03 dimension value to '"+Z+"'. Value not found in available custom03 dimension values")}))},i.setEventProcessInterval=function(Z){M.performTaskOnGAThread((function(){M.setEventProcessInterval(Z)}))},i.startSession=function(){if(g.isInitialized()){var Z=M.createTimedBlock();Z.async=!0,i.initTimedBlockId=Z.id,Z.block=function(){g.isEnabled()&&g.sessionIsStarted()&&M.endSessionAndStopQueue(),i.resumeSessionAndStartQueue()},M.performTimedBlockOnGAThread(Z)}},i.endSession=function(){i.onStop()},i.onStop=function(){M.performTaskOnGAThread((function(){try{M.endSessionAndStopQueue()}catch(Z){}}))},i.onResume=function(){var Z=M.createTimedBlock();Z.async=!0,i.initTimedBlockId=Z.id,Z.block=function(){i.resumeSessionAndStartQueue()},M.performTimedBlockOnGAThread(Z)},i.getRemoteConfigsValueAsString=function(Z,M){return void 0===M&&(M=null),g.getConfigurationStringValue(Z,M)},i.isRemoteConfigsReady=function(){return g.isRemoteConfigsReady()},i.addRemoteConfigsListener=function(Z){g.addRemoteConfigsListener(Z)},i.removeRemoteConfigsListener=function(Z){g.removeRemoteConfigsListener(Z)},i.getRemoteConfigsContentAsString=function(){return g.getRemoteConfigsContentAsString()},i.getABTestingId=function(){return g.getABTestingId()},i.getABTestingVariantId=function(){return g.getABTestingVariantId()},i.internalInitialize=function(){g.ensurePersistedStates(),b.setItem(g.getGameKey(),g.DefaultUserIdKey,g.getDefaultId()),g.setInitialized(!0),i.newSession(),g.isEnabled()&&M.ensureEventQueueIsRunning()},i.newSession=function(){K.i("Starting a new session."),g.validateAndFixCurrentDimensions(),O.instance.requestInit(g.instance.configsHash,i.startNewSessionCallback)},i.startNewSessionCallback=function(Z,j){if(Z!==I.Ok&&Z!==I.Created||!j)Z==I.Unauthorized?(K.w("Initialize SDK failed - Unauthorized"),g.instance.initAuthorized=!1):(Z===I.NoResponse||Z===I.RequestTimeout?K.i("Init call (session start) failed - no response. Could be offline or timeout."):Z===I.BadResponse||Z===I.JsonEncodeFailed||Z===I.JsonDecodeFailed?K.i("Init call (session start) failed - bad response. Could be bad response from proxy or GA servers."):Z!==I.BadRequest&&Z!==I.UnknownResponseCode||K.i("Init call (session start) failed - bad request or unknown response."),null==g.instance.sdkConfig?null!=g.instance.sdkConfigCached?(K.i("Init call (session start) failed - using cached init values."),g.instance.sdkConfig=g.instance.sdkConfigCached):(K.i("Init call (session start) failed - using default init values."),g.instance.sdkConfig=g.instance.sdkConfigDefault):K.i("Init call (session start) failed - using cached init values."),g.instance.initAuthorized=!0);else{var O=0;if(j.server_ts){var Q=j.server_ts;O=g.calculateServerTimeOffset(Q)}if(j.time_offset=O,Z!=I.Created){var Y=g.getSdkConfig();Y.configs&&(j.configs=Y.configs),Y.configs_hash&&(j.configs_hash=Y.configs_hash),Y.ab_id&&(j.ab_id=Y.ab_id),Y.ab_variant_id&&(j.ab_variant_id=Y.ab_variant_id)}g.instance.configsHash=j.configs_hash?j.configs_hash:"",g.instance.abId=j.ab_id?j.ab_id:"",g.instance.abVariantId=j.ab_variant_id?j.ab_variant_id:"",b.setItem(g.getGameKey(),g.SdkConfigCachedKey,E.encode64(JSON.stringify(j))),g.instance.sdkConfigCached=j,g.instance.sdkConfig=j,g.instance.initAuthorized=!0}if(g.instance.clientServerTimeOffset=g.getSdkConfig().time_offset?g.getSdkConfig().time_offset:0,g.populateConfigurations(g.getSdkConfig()),!g.isEnabled())return K.w("Could not start session: SDK is disabled."),void M.stopEventQueue();M.ensureEventQueueIsRunning();var a=E.createGuid();g.instance.sessionId=a,g.instance.sessionStart=g.getClientTsAdjusted(),s.addSessionStartEvent();var z=M.getTimedBlockById(i.initTimedBlockId);null!=z&&(z.running=!1),i.initTimedBlockId=-1},i.resumeSessionAndStartQueue=function(){g.isInitialized()&&(K.i("Resuming session."),g.sessionIsStarted()||i.newSession())},i.isSdkReady=function(Z,M,j){return void 0===M&&(M=!0),void 0===j&&(j=""),j&&(j+=": "),Z&&!g.isInitialized()?(M&&K.w(j+"SDK is not initialized"),!1):Z&&!g.isEnabled()?(M&&K.w(j+"SDK is disabled"),!1):!(Z&&!g.sessionIsStarted())||(M&&K.w(j+"Session has not started yet"),!1)},i.initTimedBlockId=-1,i.methodMap={},i}();Z.GameAnalytics=i}(b||(b={})),b.GameAnalytics.init();b.GameAnalytics.gaCommand;Z.exports=b},379:function(Z){"use strict";Z.exports=function(Z){for(var M=new Array(Z),j=0;j<Z;++j)M[j]=j;return M}},23110:function(Z){function M(Z){return!!Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}Z.exports=function(Z){return null!=Z&&(M(Z)||function(Z){return"function"===typeof Z.readFloatLE&&"function"===typeof Z.slice&&M(Z.slice(0,0))}(Z)||!!Z._isBuffer)}},74654:function(Z,M,j){Z=j.nmd(Z);var K="__lodash_hash_undefined__",b=9007199254740991,g="[object Arguments]",O="[object Boolean]",Q="[object Date]",Y="[object Function]",I="[object GeneratorFunction]",E="[object Map]",s="[object Number]",i="[object Object]",a="[object Promise]",z="[object RegExp]",V="[object Set]",o="[object String]",c="[object Symbol]",G="[object WeakMap]",f="[object ArrayBuffer]",X="[object DataView]",d="[object Float32Array]",W="[object Float64Array]",A="[object Int8Array]",q="[object Int16Array]",T="[object Int32Array]",B="[object Uint8Array]",N="[object Uint8ClampedArray]",U="[object Uint16Array]",n="[object Uint32Array]",k=/\w*$/,x=/^\[object .+?Constructor\]$/,R=/^(?:0|[1-9]\d*)$/,e={};e[g]=e["[object Array]"]=e[f]=e[X]=e[O]=e[Q]=e[d]=e[W]=e[A]=e[q]=e[T]=e[E]=e[s]=e[i]=e[z]=e[V]=e[o]=e[c]=e[B]=e[N]=e[U]=e[n]=!0,e["[object Error]"]=e[Y]=e[G]=!1;var u="object"==typeof j.g&&j.g&&j.g.Object===Object&&j.g,F="object"==typeof self&&self&&self.Object===Object&&self,C=u||F||Function("return this")(),y=M&&!M.nodeType&&M,S=y&&Z&&!Z.nodeType&&Z,h=S&&S.exports===y;function w(Z,M){return Z.set(M[0],M[1]),Z}function p(Z,M){return Z.add(M),Z}function m(Z,M,j,K){var b=-1,g=Z?Z.length:0;for(K&&g&&(j=Z[++b]);++b<g;)j=M(j,Z[b],b,Z);return j}function J(Z){var M=!1;if(null!=Z&&"function"!=typeof Z.toString)try{M=!!(Z+"")}catch(Z){}return M}function P(Z){var M=-1,j=Array(Z.size);return Z.forEach((function(Z,K){j[++M]=[K,Z]})),j}function H(Z,M){return function(j){return Z(M(j))}}function D(Z){var M=-1,j=Array(Z.size);return Z.forEach((function(Z){j[++M]=Z})),j}var l=Array.prototype,t=Function.prototype,v=Object.prototype,r=C["__core-js_shared__"],L=function(){var Z=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return Z?"Symbol(src)_1."+Z:""}(),ZZ=t.toString,MZ=v.hasOwnProperty,jZ=v.toString,KZ=RegExp("^"+ZZ.call(MZ).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bZ=h?C.Buffer:void 0,gZ=C.Symbol,OZ=C.Uint8Array,QZ=H(Object.getPrototypeOf,Object),YZ=Object.create,IZ=v.propertyIsEnumerable,EZ=l.splice,sZ=Object.getOwnPropertySymbols,iZ=bZ?bZ.isBuffer:void 0,aZ=H(Object.keys,Object),zZ=hZ(C,"DataView"),VZ=hZ(C,"Map"),oZ=hZ(C,"Promise"),cZ=hZ(C,"Set"),GZ=hZ(C,"WeakMap"),fZ=hZ(Object,"create"),XZ=PZ(zZ),dZ=PZ(VZ),WZ=PZ(oZ),AZ=PZ(cZ),qZ=PZ(GZ),TZ=gZ?gZ.prototype:void 0,BZ=TZ?TZ.valueOf:void 0;function NZ(Z){var M=-1,j=Z?Z.length:0;for(this.clear();++M<j;){var K=Z[M];this.set(K[0],K[1])}}function UZ(Z){var M=-1,j=Z?Z.length:0;for(this.clear();++M<j;){var K=Z[M];this.set(K[0],K[1])}}function nZ(Z){var M=-1,j=Z?Z.length:0;for(this.clear();++M<j;){var K=Z[M];this.set(K[0],K[1])}}function kZ(Z){this.__data__=new UZ(Z)}function xZ(Z,M){var j=DZ(Z)||function(Z){return function(Z){return function(Z){return!!Z&&"object"==typeof Z}(Z)&&lZ(Z)}(Z)&&MZ.call(Z,"callee")&&(!IZ.call(Z,"callee")||jZ.call(Z)==g)}(Z)?function(Z,M){for(var j=-1,K=Array(Z);++j<Z;)K[j]=M(j);return K}(Z.length,String):[],K=j.length,b=!!K;for(var O in Z)!M&&!MZ.call(Z,O)||b&&("length"==O||mZ(O,K))||j.push(O);return j}function RZ(Z,M,j){var K=Z[M];MZ.call(Z,M)&&HZ(K,j)&&(void 0!==j||M in Z)||(Z[M]=j)}function eZ(Z,M){for(var j=Z.length;j--;)if(HZ(Z[j][0],M))return j;return-1}function uZ(Z,M,j,K,b,a,G){var x;if(K&&(x=a?K(Z,b,a,G):K(Z)),void 0!==x)return x;if(!rZ(Z))return Z;var R=DZ(Z);if(R){if(x=function(Z){var M=Z.length,j=Z.constructor(M);M&&"string"==typeof Z[0]&&MZ.call(Z,"index")&&(j.index=Z.index,j.input=Z.input);return j}(Z),!M)return function(Z,M){var j=-1,K=Z.length;M||(M=Array(K));for(;++j<K;)M[j]=Z[j];return M}(Z,x)}else{var u=pZ(Z),F=u==Y||u==I;if(tZ(Z))return function(Z,M){if(M)return Z.slice();var j=new Z.constructor(Z.length);return Z.copy(j),j}(Z,M);if(u==i||u==g||F&&!a){if(J(Z))return a?Z:{};if(x=function(Z){return"function"!=typeof Z.constructor||JZ(Z)?{}:(M=QZ(Z),rZ(M)?YZ(M):{});var M}(F?{}:Z),!M)return function(Z,M){return yZ(Z,wZ(Z),M)}(Z,function(Z,M){return Z&&yZ(M,LZ(M),Z)}(x,Z))}else{if(!e[u])return a?Z:{};x=function(Z,M,j,K){var b=Z.constructor;switch(M){case f:return CZ(Z);case O:case Q:return new b(+Z);case X:return function(Z,M){var j=M?CZ(Z.buffer):Z.buffer;return new Z.constructor(j,Z.byteOffset,Z.byteLength)}(Z,K);case d:case W:case A:case q:case T:case B:case N:case U:case n:return function(Z,M){var j=M?CZ(Z.buffer):Z.buffer;return new Z.constructor(j,Z.byteOffset,Z.length)}(Z,K);case E:return function(Z,M,j){return m(M?j(P(Z),!0):P(Z),w,new Z.constructor)}(Z,K,j);case s:case o:return new b(Z);case z:return function(Z){var M=new Z.constructor(Z.source,k.exec(Z));return M.lastIndex=Z.lastIndex,M}(Z);case V:return function(Z,M,j){return m(M?j(D(Z),!0):D(Z),p,new Z.constructor)}(Z,K,j);case c:return g=Z,BZ?Object(BZ.call(g)):{}}var g}(Z,u,uZ,M)}}G||(G=new kZ);var C=G.get(Z);if(C)return C;if(G.set(Z,x),!R)var y=j?function(Z){return function(Z,M,j){var K=M(Z);return DZ(Z)?K:function(Z,M){for(var j=-1,K=M.length,b=Z.length;++j<K;)Z[b+j]=M[j];return Z}(K,j(Z))}(Z,LZ,wZ)}(Z):LZ(Z);return function(Z,M){for(var j=-1,K=Z?Z.length:0;++j<K&&!1!==M(Z[j],j,Z););}(y||Z,(function(b,g){y&&(b=Z[g=b]),RZ(x,g,uZ(b,M,j,K,g,Z,G))})),x}function FZ(Z){return!(!rZ(Z)||(M=Z,L&&L in M))&&(vZ(Z)||J(Z)?KZ:x).test(PZ(Z));var M}function CZ(Z){var M=new Z.constructor(Z.byteLength);return new OZ(M).set(new OZ(Z)),M}function yZ(Z,M,j,K){j||(j={});for(var b=-1,g=M.length;++b<g;){var O=M[b],Q=K?K(j[O],Z[O],O,j,Z):void 0;RZ(j,O,void 0===Q?Z[O]:Q)}return j}function SZ(Z,M){var j=Z.__data__;return function(Z){var M=typeof Z;return"string"==M||"number"==M||"symbol"==M||"boolean"==M?"__proto__"!==Z:null===Z}(M)?j["string"==typeof M?"string":"hash"]:j.map}function hZ(Z,M){var j=function(Z,M){return null==Z?void 0:Z[M]}(Z,M);return FZ(j)?j:void 0}NZ.prototype.clear=function(){this.__data__=fZ?fZ(null):{}},NZ.prototype.delete=function(Z){return this.has(Z)&&delete this.__data__[Z]},NZ.prototype.get=function(Z){var M=this.__data__;if(fZ){var j=M[Z];return j===K?void 0:j}return MZ.call(M,Z)?M[Z]:void 0},NZ.prototype.has=function(Z){var M=this.__data__;return fZ?void 0!==M[Z]:MZ.call(M,Z)},NZ.prototype.set=function(Z,M){return this.__data__[Z]=fZ&&void 0===M?K:M,this},UZ.prototype.clear=function(){this.__data__=[]},UZ.prototype.delete=function(Z){var M=this.__data__,j=eZ(M,Z);return!(j<0)&&(j==M.length-1?M.pop():EZ.call(M,j,1),!0)},UZ.prototype.get=function(Z){var M=this.__data__,j=eZ(M,Z);return j<0?void 0:M[j][1]},UZ.prototype.has=function(Z){return eZ(this.__data__,Z)>-1},UZ.prototype.set=function(Z,M){var j=this.__data__,K=eZ(j,Z);return K<0?j.push([Z,M]):j[K][1]=M,this},nZ.prototype.clear=function(){this.__data__={hash:new NZ,map:new(VZ||UZ),string:new NZ}},nZ.prototype.delete=function(Z){return SZ(this,Z).delete(Z)},nZ.prototype.get=function(Z){return SZ(this,Z).get(Z)},nZ.prototype.has=function(Z){return SZ(this,Z).has(Z)},nZ.prototype.set=function(Z,M){return SZ(this,Z).set(Z,M),this},kZ.prototype.clear=function(){this.__data__=new UZ},kZ.prototype.delete=function(Z){return this.__data__.delete(Z)},kZ.prototype.get=function(Z){return this.__data__.get(Z)},kZ.prototype.has=function(Z){return this.__data__.has(Z)},kZ.prototype.set=function(Z,M){var j=this.__data__;if(j instanceof UZ){var K=j.__data__;if(!VZ||K.length<199)return K.push([Z,M]),this;j=this.__data__=new nZ(K)}return j.set(Z,M),this};var wZ=sZ?H(sZ,Object):function(){return[]},pZ=function(Z){return jZ.call(Z)};function mZ(Z,M){return!!(M=null==M?b:M)&&("number"==typeof Z||R.test(Z))&&Z>-1&&Z%1==0&&Z<M}function JZ(Z){var M=Z&&Z.constructor;return Z===("function"==typeof M&&M.prototype||v)}function PZ(Z){if(null!=Z){try{return ZZ.call(Z)}catch(Z){}try{return Z+""}catch(Z){}}return""}function HZ(Z,M){return Z===M||Z!==Z&&M!==M}(zZ&&pZ(new zZ(new ArrayBuffer(1)))!=X||VZ&&pZ(new VZ)!=E||oZ&&pZ(oZ.resolve())!=a||cZ&&pZ(new cZ)!=V||GZ&&pZ(new GZ)!=G)&&(pZ=function(Z){var M=jZ.call(Z),j=M==i?Z.constructor:void 0,K=j?PZ(j):void 0;if(K)switch(K){case XZ:return X;case dZ:return E;case WZ:return a;case AZ:return V;case qZ:return G}return M});var DZ=Array.isArray;function lZ(Z){return null!=Z&&function(Z){return"number"==typeof Z&&Z>-1&&Z%1==0&&Z<=b}(Z.length)&&!vZ(Z)}var tZ=iZ||function(){return!1};function vZ(Z){var M=rZ(Z)?jZ.call(Z):"";return M==Y||M==I}function rZ(Z){var M=typeof Z;return!!Z&&("object"==M||"function"==M)}function LZ(Z){return lZ(Z)?xZ(Z):function(Z){if(!JZ(Z))return aZ(Z);var M=[];for(var j in Object(Z))MZ.call(Z,j)&&"constructor"!=j&&M.push(j);return M}(Z)}Z.exports=function(Z){return uZ(Z,!0,!0)}},47786:function(Z,M,j){var K=j(379),b=j(23110),g="undefined"!==typeof Float64Array;function O(Z,M){return Z[0]-M[0]}function Q(){var Z,M=this.stride,j=new Array(M.length);for(Z=0;Z<j.length;++Z)j[Z]=[Math.abs(M[Z]),Z];j.sort(O);var K=new Array(j.length);for(Z=0;Z<K.length;++Z)K[Z]=j[Z][1];return K}function Y(Z,M){var j=["View",M,"d",Z].join("");M<0&&(j="View_Nil"+Z);var b="generic"===Z;if(-1===M){var g="function "+j+"(a){this.data=a;};var proto="+j+".prototype;proto.dtype='"+Z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+j+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+j+"(a){return new "+j+"(a);}";return new Function(g)()}if(0===M){g="function "+j+"(a,d) {this.data = a;this.offset = d};var proto="+j+".prototype;proto.dtype='"+Z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+j+"_copy() {return new "+j+"(this.data,this.offset)};proto.pick=function "+j+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+j+"_get(){return "+(b?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+j+"_set(v){return "+(b?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+j+"(a,b,c,d){return new "+j+"(a,d)}";return new Function("TrivialArray",g)(I[Z][0])}g=["'use strict'"];var O=K(M),Y=O.map((function(Z){return"i"+Z})),E="this.offset+"+O.map((function(Z){return"this.stride["+Z+"]*i"+Z})).join("+"),s=O.map((function(Z){return"b"+Z})).join(","),i=O.map((function(Z){return"c"+Z})).join(",");g.push("function "+j+"(a,"+s+","+i+",d){this.data=a","this.shape=["+s+"]","this.stride=["+i+"]","this.offset=d|0}","var proto="+j+".prototype","proto.dtype='"+Z+"'","proto.dimension="+M),g.push("Object.defineProperty(proto,'size',{get:function "+j+"_size(){return "+O.map((function(Z){return"this.shape["+Z+"]"})).join("*"),"}})"),1===M?g.push("proto.order=[0]"):(g.push("Object.defineProperty(proto,'order',{get:"),M<4?(g.push("function "+j+"_order(){"),2===M?g.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===M&&g.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):g.push("ORDER})")),g.push("proto.set=function "+j+"_set("+Y.join(",")+",v){"),b?g.push("return this.data.set("+E+",v)}"):g.push("return this.data["+E+"]=v}"),g.push("proto.get=function "+j+"_get("+Y.join(",")+"){"),b?g.push("return this.data.get("+E+")}"):g.push("return this.data["+E+"]}"),g.push("proto.index=function "+j+"_index(",Y.join(),"){return "+E+"}"),g.push("proto.hi=function "+j+"_hi("+Y.join(",")+"){return new "+j+"(this.data,"+O.map((function(Z){return["(typeof i",Z,"!=='number'||i",Z,"<0)?this.shape[",Z,"]:i",Z,"|0"].join("")})).join(",")+","+O.map((function(Z){return"this.stride["+Z+"]"})).join(",")+",this.offset)}");var a=O.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})),z=O.map((function(Z){return"c"+Z+"=this.stride["+Z+"]"}));g.push("proto.lo=function "+j+"_lo("+Y.join(",")+"){var b=this.offset,d=0,"+a.join(",")+","+z.join(","));for(var V=0;V<M;++V)g.push("if(typeof i"+V+"==='number'&&i"+V+">=0){d=i"+V+"|0;b+=c"+V+"*d;a"+V+"-=d}");g.push("return new "+j+"(this.data,"+O.map((function(Z){return"a"+Z})).join(",")+","+O.map((function(Z){return"c"+Z})).join(",")+",b)}"),g.push("proto.step=function "+j+"_step("+Y.join(",")+"){var "+O.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})).join(",")+","+O.map((function(Z){return"b"+Z+"=this.stride["+Z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(V=0;V<M;++V)g.push("if(typeof i"+V+"==='number'){d=i"+V+"|0;if(d<0){c+=b"+V+"*(a"+V+"-1);a"+V+"=ceil(-a"+V+"/d)}else{a"+V+"=ceil(a"+V+"/d)}b"+V+"*=d}");g.push("return new "+j+"(this.data,"+O.map((function(Z){return"a"+Z})).join(",")+","+O.map((function(Z){return"b"+Z})).join(",")+",c)}");var o=new Array(M),c=new Array(M);for(V=0;V<M;++V)o[V]="a[i"+V+"]",c[V]="b[i"+V+"]";g.push("proto.transpose=function "+j+"_transpose("+Y+"){"+Y.map((function(Z,M){return Z+"=("+Z+"===undefined?"+M+":"+Z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+j+"(this.data,"+o.join(",")+","+c.join(",")+",this.offset)}"),g.push("proto.pick=function "+j+"_pick("+Y+"){var a=[],b=[],c=this.offset");for(V=0;V<M;++V)g.push("if(typeof i"+V+"==='number'&&i"+V+">=0){c=(c+this.stride["+V+"]*i"+V+")|0}else{a.push(this.shape["+V+"]);b.push(this.stride["+V+"])}");return g.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),g.push("return function construct_"+j+"(data,shape,stride,offset){return new "+j+"(data,"+O.map((function(Z){return"shape["+Z+"]"})).join(",")+","+O.map((function(Z){return"stride["+Z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",g.join("\n"))(I[Z],Q)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Z.exports=function(Z,M,j,K){if(void 0===Z)return(0,I.array[0])([]);"number"===typeof Z&&(Z=[Z]),void 0===M&&(M=[Z.length]);var O=M.length;if(void 0===j){j=new Array(O);for(var Q=O-1,E=1;Q>=0;--Q)j[Q]=E,E*=M[Q]}if(void 0===K){K=0;for(Q=0;Q<O;++Q)j[Q]<0&&(K-=(M[Q]-1)*j[Q])}for(var s=function(Z){if(b(Z))return"buffer";if(g)switch(Object.prototype.toString.call(Z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Z)?"array":"generic"}(Z),i=I[s];i.length<=O+1;)i.push(Y(s,i.length-1));return(0,i[O+1])(Z,M,j,K)}},13529:function(Z){self,Z.exports=function(){"use strict";var Z={d:function(M,j){for(var K in j)Z.o(j,K)&&!Z.o(M,K)&&Object.defineProperty(M,K,{enumerable:!0,get:j[K]})},o:function(Z,M){return Object.prototype.hasOwnProperty.call(Z,M)}},M={};Z.d(M,{default:function(){return x}});var j,K=function(Z,M){var j=M.x-Z.x,K=M.y-Z.y;return Math.sqrt(j*j+K*K)},b=function(Z){return Z*(Math.PI/180)},g=new Map,O=function(Z){g.has(Z)&&clearTimeout(g.get(Z)),g.set(Z,setTimeout(Z,100))},Q=function(Z,M,j){for(var K,b=M.split(/[ ,]+/g),g=0;g<b.length;g+=1)K=b[g],Z.addEventListener?Z.addEventListener(K,j,!1):Z.attachEvent&&Z.attachEvent(K,j)},Y=function(Z,M,j){for(var K,b=M.split(/[ ,]+/g),g=0;g<b.length;g+=1)K=b[g],Z.removeEventListener?Z.removeEventListener(K,j):Z.detachEvent&&Z.detachEvent(K,j)},I=function(Z){return Z.preventDefault(),Z.type.match(/^touch/)?Z.changedTouches:Z},E=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},s=function(Z,M){M.top||M.right||M.bottom||M.left?(Z.style.top=M.top,Z.style.right=M.right,Z.style.bottom=M.bottom,Z.style.left=M.left):(Z.style.left=M.x+"px",Z.style.top=M.y+"px")},i=function(Z,M,j){var K=a(Z);for(var b in K)if(K.hasOwnProperty(b))if("string"==typeof M)K[b]=M+" "+j;else{for(var g="",O=0,Q=M.length;O<Q;O+=1)g+=M[O]+" "+j+", ";K[b]=g.slice(0,-2)}return K},a=function(Z){var M={};return M[Z]="",["webkit","Moz","o"].forEach((function(j){M[j+Z.charAt(0).toUpperCase()+Z.slice(1)]=""})),M},z=function(Z,M){for(var j in M)M.hasOwnProperty(j)&&(Z[j]=M[j]);return Z},V=function(Z,M){if(Z.length)for(var j=0,K=Z.length;j<K;j+=1)M(Z[j]);else M(Z)},o="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,c=!!("ontouchstart"in window),G=!!window.PointerEvent,f=!!window.MSPointerEvent,X={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},d={start:"mousedown",move:"mousemove",end:"mouseup"},W={};function A(){}o?j=X:G?j={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:f?j={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:c?(j=X,W=d):j=d,A.prototype.on=function(Z,M){var j,K=this,b=Z.split(/[ ,]+/g);K._handlers_=K._handlers_||{};for(var g=0;g<b.length;g+=1)j=b[g],K._handlers_[j]=K._handlers_[j]||[],K._handlers_[j].push(M);return K},A.prototype.off=function(Z,M){var j=this;return j._handlers_=j._handlers_||{},void 0===Z?j._handlers_={}:void 0===M?j._handlers_[Z]=null:j._handlers_[Z]&&j._handlers_[Z].indexOf(M)>=0&&j._handlers_[Z].splice(j._handlers_[Z].indexOf(M),1),j},A.prototype.trigger=function(Z,M){var j,K=this,b=Z.split(/[ ,]+/g);K._handlers_=K._handlers_||{};for(var g=0;g<b.length;g+=1)j=b[g],K._handlers_[j]&&K._handlers_[j].length&&K._handlers_[j].forEach((function(Z){Z.call(K,{type:j,target:K},M)}))},A.prototype.config=function(Z){var M=this;M.options=M.defaults||{},Z&&(M.options=function(Z,M){var j={};for(var K in Z)Z.hasOwnProperty(K)&&M.hasOwnProperty(K)?j[K]=M[K]:Z.hasOwnProperty(K)&&(j[K]=Z[K]);return j}(M.options,Z))},A.prototype.bindEvt=function(Z,M){var K=this;return K._domHandlers_=K._domHandlers_||{},K._domHandlers_[M]=function(){"function"==typeof K["on"+M]?K["on"+M].apply(K,arguments):console.warn('[WARNING] : Missing "on'+M+'" handler.')},Q(Z,j[M],K._domHandlers_[M]),W[M]&&Q(Z,W[M],K._domHandlers_[M]),K},A.prototype.unbindEvt=function(Z,M){var K=this;return K._domHandlers_=K._domHandlers_||{},Y(Z,j[M],K._domHandlers_[M]),W[M]&&Y(Z,W[M],K._domHandlers_[M]),delete K._domHandlers_[M],this};var q=A;function T(Z,M){return this.identifier=M.identifier,this.position=M.position,this.frontPosition=M.frontPosition,this.collection=Z,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(M),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=T.id,T.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}T.prototype=new q,T.constructor=T,T.id=0,T.prototype.buildEl=function(Z){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},T.prototype.stylize=function(){if(this.options.dataOnly)return this;var Z=this.options.fadeTime+"ms",M=function(Z,M){var j=a("borderRadius");for(var K in j)j.hasOwnProperty(K)&&(j[K]="0.5rem");return j}(),j=i("transition","opacity",Z),K={};return K.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},K.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},K.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},z(K.el,j),"circle"===this.options.shape&&z(K.back,M),z(K.front,M),this.applyStyles(K),this},T.prototype.applyStyles=function(Z){for(var M in this.ui)if(this.ui.hasOwnProperty(M))for(var j in Z[M])this.ui[M].style[j]=Z[M][j];return this},T.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},T.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},T.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},T.prototype.show=function(Z){var M=this;return M.options.dataOnly||(clearTimeout(M.removeTimeout),clearTimeout(M.showTimeout),clearTimeout(M.restTimeout),M.addToDom(),M.restCallback(),setTimeout((function(){M.ui.el.style.opacity=1}),0),M.showTimeout=setTimeout((function(){M.trigger("shown",M.instance),"function"==typeof Z&&Z.call(this)}),M.options.fadeTime)),M},T.prototype.hide=function(Z){var M=this;if(M.options.dataOnly)return M;if(M.ui.el.style.opacity=M.options.restOpacity,clearTimeout(M.removeTimeout),clearTimeout(M.showTimeout),clearTimeout(M.restTimeout),M.removeTimeout=setTimeout((function(){var j="dynamic"===M.options.mode?"none":"block";M.ui.el.style.display=j,"function"==typeof Z&&Z.call(M),M.trigger("hidden",M.instance)}),M.options.fadeTime),M.options.restJoystick){var j=M.options.restJoystick,K={};K.x=!0===j||!1!==j.x?0:M.instance.frontPosition.x,K.y=!0===j||!1!==j.y?0:M.instance.frontPosition.y,M.setPosition(Z,K)}return M},T.prototype.setPosition=function(Z,M){var j=this;j.frontPosition={x:M.x,y:M.y};var K=j.options.fadeTime+"ms",b={};b.front=i("transition",["transform"],K);var g={front:{}};g.front={transform:"translate("+j.frontPosition.x+"px,"+j.frontPosition.y+"px)"},j.applyStyles(b),j.applyStyles(g),j.restTimeout=setTimeout((function(){"function"==typeof Z&&Z.call(j),j.restCallback()}),j.options.fadeTime)},T.prototype.restCallback=function(){var Z=this,M={};M.front=i("transition","none",""),Z.applyStyles(M),Z.trigger("rested",Z.instance)},T.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},T.prototype.computeDirection=function(Z){var M,j,K,b=Z.angle.radian,g=Math.PI/4,O=Math.PI/2;if(b>g&&b<3*g&&!Z.lockX?M="up":b>-g&&b<=g&&!Z.lockY?M="left":b>3*-g&&b<=-g&&!Z.lockX?M="down":Z.lockY||(M="right"),Z.lockY||(j=b>-O&&b<O?"left":"right"),Z.lockX||(K=b>0?"up":"down"),Z.force>this.options.threshold){var Q,Y={};for(Q in this.direction)this.direction.hasOwnProperty(Q)&&(Y[Q]=this.direction[Q]);var I={};for(Q in this.direction={x:j,y:K,angle:M},Z.direction=this.direction,Y)Y[Q]===this.direction[Q]&&(I[Q]=!0);if(I.x&&I.y&&I.angle)return Z;I.x&&I.y||this.trigger("plain",Z),I.x||this.trigger("plain:"+j,Z),I.y||this.trigger("plain:"+K,Z),I.angle||this.trigger("dir dir:"+M,Z)}else this.resetDirection();return Z};var B=T;function N(Z,M){var j=this;j.nipples=[],j.idles=[],j.actives=[],j.ids=[],j.pressureIntervals={},j.manager=Z,j.id=N.id,N.id+=1,j.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},j.config(M),"static"!==j.options.mode&&"semi"!==j.options.mode||(j.options.multitouch=!1),j.options.multitouch||(j.options.maxNumberOfNipples=1);var K=getComputedStyle(j.options.zone.parentElement);return K&&"flex"===K.display&&(j.parentIsFlex=!0),j.updateBox(),j.prepareNipples(),j.bindings(),j.begin(),j.nipples}N.prototype=new q,N.constructor=N,N.id=0,N.prototype.prepareNipples=function(){var Z=this,M=Z.nipples;M.on=Z.on.bind(Z),M.off=Z.off.bind(Z),M.options=Z.options,M.destroy=Z.destroy.bind(Z),M.ids=Z.ids,M.id=Z.id,M.processOnMove=Z.processOnMove.bind(Z),M.processOnEnd=Z.processOnEnd.bind(Z),M.get=function(Z){if(void 0===Z)return M[0];for(var j=0,K=M.length;j<K;j+=1)if(M[j].identifier===Z)return M[j];return!1}},N.prototype.bindings=function(){var Z=this;Z.bindEvt(Z.options.zone,"start"),Z.options.zone.style.touchAction="none",Z.options.zone.style.msTouchAction="none"},N.prototype.begin=function(){var Z=this,M=Z.options;if("static"===M.mode){var j=Z.createNipple(M.position,Z.manager.getIdentifier());j.add(),Z.idles.push(j)}},N.prototype.createNipple=function(Z,M){var j=this,K=j.manager.scroll,b={},g=j.options,O=j.parentIsFlex?K.x:K.x+j.box.left,Q=j.parentIsFlex?K.y:K.y+j.box.top;if(Z.x&&Z.y)b={x:Z.x-O,y:Z.y-Q};else if(Z.top||Z.right||Z.bottom||Z.left){var Y=document.createElement("DIV");Y.style.display="hidden",Y.style.top=Z.top,Y.style.right=Z.right,Y.style.bottom=Z.bottom,Y.style.left=Z.left,Y.style.position="absolute",g.zone.appendChild(Y);var I=Y.getBoundingClientRect();g.zone.removeChild(Y),b=Z,Z={x:I.left+K.x,y:I.top+K.y}}var E=new B(j,{color:g.color,size:g.size,threshold:g.threshold,fadeTime:g.fadeTime,dataOnly:g.dataOnly,restJoystick:g.restJoystick,restOpacity:g.restOpacity,mode:g.mode,identifier:M,position:Z,zone:g.zone,frontPosition:{x:0,y:0},shape:g.shape});return g.dataOnly||(s(E.ui.el,b),s(E.ui.front,E.frontPosition)),j.nipples.push(E),j.trigger("added "+E.identifier+":added",E),j.manager.trigger("added "+E.identifier+":added",E),j.bindNipple(E),E},N.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},N.prototype.bindNipple=function(Z){var M,j=this,K=function(Z,K){M=Z.type+" "+K.id+":"+Z.type,j.trigger(M,K)};Z.on("destroyed",j.onDestroyed.bind(j)),Z.on("shown hidden rested dir plain",K),Z.on("dir:up dir:right dir:down dir:left",K),Z.on("plain:up plain:right plain:down plain:left",K)},N.prototype.pressureFn=function(Z,M,j){var K=this,b=0;clearInterval(K.pressureIntervals[j]),K.pressureIntervals[j]=setInterval(function(){var j=Z.force||Z.pressure||Z.webkitForce||0;j!==b&&(M.trigger("pressure",j),K.trigger("pressure "+M.identifier+":pressure",j),b=j)}.bind(K),100)},N.prototype.onstart=function(Z){var M=this,j=M.options,K=Z;return Z=I(Z),M.updateBox(),V(Z,(function(b){M.actives.length<j.maxNumberOfNipples?M.processOnStart(b):K.type.match(/^touch/)&&(Object.keys(M.manager.ids).forEach((function(j){if(Object.values(K.touches).findIndex((function(Z){return Z.identifier===j}))<0){var b=[Z[0]];b.identifier=j,M.processOnEnd(b)}})),M.actives.length<j.maxNumberOfNipples&&M.processOnStart(b))})),M.manager.bindDocument(),!1},N.prototype.processOnStart=function(Z){var M,j=this,b=j.options,g=j.manager.getIdentifier(Z),O=Z.force||Z.pressure||Z.webkitForce||0,Q={x:Z.pageX,y:Z.pageY},Y=j.getOrCreate(g,Q);Y.identifier!==g&&j.manager.removeIdentifier(Y.identifier),Y.identifier=g;var I=function(M){M.trigger("start",M),j.trigger("start "+M.id+":start",M),M.show(),O>0&&j.pressureFn(Z,M,M.identifier),j.processOnMove(Z)};if((M=j.idles.indexOf(Y))>=0&&j.idles.splice(M,1),j.actives.push(Y),j.ids.push(Y.identifier),"semi"!==b.mode)I(Y);else{if(!(K(Q,Y.position)<=b.catchDistance))return Y.destroy(),void j.processOnStart(Z);I(Y)}return Y},N.prototype.getOrCreate=function(Z,M){var j,K=this,b=K.options;return/(semi|static)/.test(b.mode)?(j=K.idles[0])?(K.idles.splice(0,1),j):"semi"===b.mode?K.createNipple(M,Z):(console.warn("Coudln't find the needed nipple."),!1):j=K.createNipple(M,Z)},N.prototype.processOnMove=function(Z){var M=this,j=M.options,g=M.manager.getIdentifier(Z),O=M.nipples.get(g),Q=M.manager.scroll;if(function(Z){return isNaN(Z.buttons)?0!==Z.pressure:0!==Z.buttons}(Z)){if(!O)return console.error("Found zombie joystick with ID "+g),void M.manager.removeIdentifier(g);if(j.dynamicPage){var Y=O.el.getBoundingClientRect();O.position={x:Q.x+Y.left,y:Q.y+Y.top}}O.identifier=g;var I=O.options.size/2,E={x:Z.pageX,y:Z.pageY};j.lockX&&(E.y=O.position.y),j.lockY&&(E.x=O.position.x);var s,i,a,z,V,o,c,G,f,X,d=K(E,O.position),W=(s=E,a=(i=O.position).x-s.x,z=i.y-s.y,function(Z){return Z*(180/Math.PI)}(Math.atan2(z,a))),A=b(W),q=d/I,T={distance:d,position:E};if("circle"===O.options.shape?(V=Math.min(d,I),c=O.position,G=V,X={x:0,y:0},f=b(f=W),X.x=c.x-G*Math.cos(f),X.y=c.y-G*Math.sin(f),o=X):(o=function(Z,M,j){return{x:Math.min(Math.max(Z.x,M.x-j),M.x+j),y:Math.min(Math.max(Z.y,M.y-j),M.y+j)}}(E,O.position,I),V=K(o,O.position)),j.follow){if(d>I){var B=E.x-o.x,N=E.y-o.y;O.position.x+=B,O.position.y+=N,O.el.style.top=O.position.y-(M.box.top+Q.y)+"px",O.el.style.left=O.position.x-(M.box.left+Q.x)+"px",d=K(E,O.position)}}else E=o,d=V;var U=E.x-O.position.x,n=E.y-O.position.y;O.frontPosition={x:U,y:n},j.dataOnly||(O.ui.front.style.transform="translate("+U+"px,"+n+"px)");var k={identifier:O.identifier,position:E,force:q,pressure:Z.force||Z.pressure||Z.webkitForce||0,distance:d,angle:{radian:A,degree:W},vector:{x:U/I,y:-n/I},raw:T,instance:O,lockX:j.lockX,lockY:j.lockY};(k=O.computeDirection(k)).angle={radian:b(180-W),degree:180-W},O.trigger("move",k),M.trigger("move "+O.id+":move",k)}else this.processOnEnd(Z)},N.prototype.processOnEnd=function(Z){var M=this,j=M.options,K=M.manager.getIdentifier(Z),b=M.nipples.get(K),g=M.manager.removeIdentifier(b.identifier);b&&(j.dataOnly||b.hide((function(){"dynamic"===j.mode&&(b.trigger("removed",b),M.trigger("removed "+b.id+":removed",b),M.manager.trigger("removed "+b.id+":removed",b),b.destroy())})),clearInterval(M.pressureIntervals[b.identifier]),b.resetDirection(),b.trigger("end",b),M.trigger("end "+b.id+":end",b),M.ids.indexOf(b.identifier)>=0&&M.ids.splice(M.ids.indexOf(b.identifier),1),M.actives.indexOf(b)>=0&&M.actives.splice(M.actives.indexOf(b),1),/(semi|static)/.test(j.mode)?M.idles.push(b):M.nipples.indexOf(b)>=0&&M.nipples.splice(M.nipples.indexOf(b),1),M.manager.unbindDocument(),/(semi|static)/.test(j.mode)&&(M.manager.ids[g.id]=g.identifier))},N.prototype.onDestroyed=function(Z,M){var j=this;j.nipples.indexOf(M)>=0&&j.nipples.splice(j.nipples.indexOf(M),1),j.actives.indexOf(M)>=0&&j.actives.splice(j.actives.indexOf(M),1),j.idles.indexOf(M)>=0&&j.idles.splice(j.idles.indexOf(M),1),j.ids.indexOf(M.identifier)>=0&&j.ids.splice(j.ids.indexOf(M.identifier),1),j.manager.removeIdentifier(M.identifier),j.manager.unbindDocument()},N.prototype.destroy=function(){var Z=this;for(var M in Z.unbindEvt(Z.options.zone,"start"),Z.nipples.forEach((function(Z){Z.destroy()})),Z.pressureIntervals)Z.pressureIntervals.hasOwnProperty(M)&&clearInterval(Z.pressureIntervals[M]);Z.trigger("destroyed",Z.nipples),Z.manager.unbindDocument(),Z.off()};var U=N;function n(Z){var M=this;M.ids={},M.index=0,M.collections=[],M.scroll=E(),M.config(Z),M.prepareCollections();var j=function(){var Z;M.collections.forEach((function(j){j.forEach((function(j){Z=j.el.getBoundingClientRect(),j.position={x:M.scroll.x+Z.left,y:M.scroll.y+Z.top}}))}))};Q(window,"resize",(function(){O(j)}));var K=function(){M.scroll=E()};return Q(window,"scroll",(function(){O(K)})),M.collections}n.prototype=new q,n.constructor=n,n.prototype.prepareCollections=function(){var Z=this;Z.collections.create=Z.create.bind(Z),Z.collections.on=Z.on.bind(Z),Z.collections.off=Z.off.bind(Z),Z.collections.destroy=Z.destroy.bind(Z),Z.collections.get=function(M){var j;return Z.collections.every((function(Z){return!(j=Z.get(M))})),j}},n.prototype.create=function(Z){return this.createCollection(Z)},n.prototype.createCollection=function(Z){var M=this,j=new U(M,Z);return M.bindCollection(j),M.collections.push(j),j},n.prototype.bindCollection=function(Z){var M,j=this,K=function(Z,K){M=Z.type+" "+K.id+":"+Z.type,j.trigger(M,K)};Z.on("destroyed",j.onDestroyed.bind(j)),Z.on("shown hidden rested dir plain",K),Z.on("dir:up dir:right dir:down dir:left",K),Z.on("plain:up plain:right plain:down plain:left",K)},n.prototype.bindDocument=function(){var Z=this;Z.binded||(Z.bindEvt(document,"move").bindEvt(document,"end"),Z.binded=!0)},n.prototype.unbindDocument=function(Z){var M=this;Object.keys(M.ids).length&&!0!==Z||(M.unbindEvt(document,"move").unbindEvt(document,"end"),M.binded=!1)},n.prototype.getIdentifier=function(Z){var M;return Z?void 0===(M=void 0===Z.identifier?Z.pointerId:Z.identifier)&&(M=this.latest||0):M=this.index,void 0===this.ids[M]&&(this.ids[M]=this.index,this.index+=1),this.latest=M,this.ids[M]},n.prototype.removeIdentifier=function(Z){var M={};for(var j in this.ids)if(this.ids[j]===Z){M.id=j,M.identifier=this.ids[j],delete this.ids[j];break}return M},n.prototype.onmove=function(Z){return this.onAny("move",Z),!1},n.prototype.onend=function(Z){return this.onAny("end",Z),!1},n.prototype.oncancel=function(Z){return this.onAny("end",Z),!1},n.prototype.onAny=function(Z,M){var j,K=this,b="processOn"+Z.charAt(0).toUpperCase()+Z.slice(1);M=I(M);var g=function(Z,M,j){j.ids.indexOf(M)>=0&&(j[b](Z),Z._found_=!0)};return V(M,(function(Z){j=K.getIdentifier(Z),V(K.collections,g.bind(null,Z,j)),Z._found_||K.removeIdentifier(j)})),!1},n.prototype.destroy=function(){var Z=this;Z.unbindDocument(!0),Z.ids={},Z.index=0,Z.collections.forEach((function(Z){Z.destroy()})),Z.off()},n.prototype.onDestroyed=function(Z,M){var j=this;if(j.collections.indexOf(M)<0)return!1;j.collections.splice(j.collections.indexOf(M),1)};var k=new n,x={create:function(Z){return k.create(Z)},factory:k};return M.default}()},77604:function(Z,M,j){"use strict";var K=j(70547),b=K.Deflate,g=K.deflate,O=K.deflateRaw,Q=K.gzip,Y=j(74785),I=Y.Inflate,E=Y.inflate,s=Y.inflateRaw,i=Y.ungzip,a=j(27572);Z.exports.Deflate=b,Z.exports.deflate=g,Z.exports.deflateRaw=O,Z.exports.gzip=Q,Z.exports.Inflate=I,Z.exports.inflate=E,Z.exports.inflateRaw=s,Z.exports.ungzip=i,Z.exports.constants=a},70547:function(Z,M,j){"use strict";var K=j(38106),b=j(16931),g=j(58415),O=j(74274),Q=j(70400),Y=Object.prototype.toString,I=j(27572),E=I.Z_NO_FLUSH,s=I.Z_SYNC_FLUSH,i=I.Z_FULL_FLUSH,a=I.Z_FINISH,z=I.Z_OK,V=I.Z_STREAM_END,o=I.Z_DEFAULT_COMPRESSION,c=I.Z_DEFAULT_STRATEGY,G=I.Z_DEFLATED;function f(Z){this.options=b.assign({level:o,method:G,chunkSize:16384,windowBits:15,memLevel:8,strategy:c},Z||{});var M=this.options;M.raw&&M.windowBits>0?M.windowBits=-M.windowBits:M.gzip&&M.windowBits>0&&M.windowBits<16&&(M.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;var j=K.deflateInit2(this.strm,M.level,M.method,M.windowBits,M.memLevel,M.strategy);if(j!==z)throw new Error(O[j]);if(M.header&&K.deflateSetHeader(this.strm,M.header),M.dictionary){var I;if(I="string"===typeof M.dictionary?g.string2buf(M.dictionary):"[object ArrayBuffer]"===Y.call(M.dictionary)?new Uint8Array(M.dictionary):M.dictionary,(j=K.deflateSetDictionary(this.strm,I))!==z)throw new Error(O[j]);this._dict_set=!0}}function X(Z,M){var j=new f(M);if(j.push(Z,!0),j.err)throw j.msg||O[j.err];return j.result}f.prototype.push=function(Z,M){var j,b,O=this.strm,Q=this.options.chunkSize;if(this.ended)return!1;for(b=M===~~M?M:!0===M?a:E,"string"===typeof Z?O.input=g.string2buf(Z):"[object ArrayBuffer]"===Y.call(Z)?O.input=new Uint8Array(Z):O.input=Z,O.next_in=0,O.avail_in=O.input.length;;)if(0===O.avail_out&&(O.output=new Uint8Array(Q),O.next_out=0,O.avail_out=Q),(b===s||b===i)&&O.avail_out<=6)this.onData(O.output.subarray(0,O.next_out)),O.avail_out=0;else{if((j=K.deflate(O,b))===V)return O.next_out>0&&this.onData(O.output.subarray(0,O.next_out)),j=K.deflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===z;if(0!==O.avail_out){if(b>0&&O.next_out>0)this.onData(O.output.subarray(0,O.next_out)),O.avail_out=0;else if(0===O.avail_in)break}else this.onData(O.output)}return!0},f.prototype.onData=function(Z){this.chunks.push(Z)},f.prototype.onEnd=function(Z){Z===z&&(this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.msg=this.strm.msg},Z.exports.Deflate=f,Z.exports.deflate=X,Z.exports.deflateRaw=function(Z,M){return(M=M||{}).raw=!0,X(Z,M)},Z.exports.gzip=function(Z,M){return(M=M||{}).gzip=!0,X(Z,M)},Z.exports.constants=j(27572)},74785:function(Z,M,j){"use strict";var K=j(31833),b=j(16931),g=j(58415),O=j(74274),Q=j(70400),Y=j(84284),I=Object.prototype.toString,E=j(27572),s=E.Z_NO_FLUSH,i=E.Z_FINISH,a=E.Z_OK,z=E.Z_STREAM_END,V=E.Z_NEED_DICT,o=E.Z_STREAM_ERROR,c=E.Z_DATA_ERROR,G=E.Z_MEM_ERROR;function f(Z){this.options=b.assign({chunkSize:65536,windowBits:15,to:""},Z||{});var M=this.options;M.raw&&M.windowBits>=0&&M.windowBits<16&&(M.windowBits=-M.windowBits,0===M.windowBits&&(M.windowBits=-15)),!(M.windowBits>=0&&M.windowBits<16)||Z&&Z.windowBits||(M.windowBits+=32),M.windowBits>15&&M.windowBits<48&&0===(15&M.windowBits)&&(M.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;var j=K.inflateInit2(this.strm,M.windowBits);if(j!==a)throw new Error(O[j]);if(this.header=new Y,K.inflateGetHeader(this.strm,this.header),M.dictionary&&("string"===typeof M.dictionary?M.dictionary=g.string2buf(M.dictionary):"[object ArrayBuffer]"===I.call(M.dictionary)&&(M.dictionary=new Uint8Array(M.dictionary)),M.raw&&(j=K.inflateSetDictionary(this.strm,M.dictionary))!==a))throw new Error(O[j])}function X(Z,M){var j=new f(M);if(j.push(Z),j.err)throw j.msg||O[j.err];return j.result}f.prototype.push=function(Z,M){var j,b,O,Q=this.strm,Y=this.options.chunkSize,E=this.options.dictionary;if(this.ended)return!1;for(b=M===~~M?M:!0===M?i:s,"[object ArrayBuffer]"===I.call(Z)?Q.input=new Uint8Array(Z):Q.input=Z,Q.next_in=0,Q.avail_in=Q.input.length;;){for(0===Q.avail_out&&(Q.output=new Uint8Array(Y),Q.next_out=0,Q.avail_out=Y),(j=K.inflate(Q,b))===V&&E&&((j=K.inflateSetDictionary(Q,E))===a?j=K.inflate(Q,b):j===c&&(j=V));Q.avail_in>0&&j===z&&Q.state.wrap>0&&0!==Z[Q.next_in];)K.inflateReset(Q),j=K.inflate(Q,b);switch(j){case o:case c:case V:case G:return this.onEnd(j),this.ended=!0,!1}if(O=Q.avail_out,Q.next_out&&(0===Q.avail_out||j===z))if("string"===this.options.to){var f=g.utf8border(Q.output,Q.next_out),X=Q.next_out-f,d=g.buf2string(Q.output,f);Q.next_out=X,Q.avail_out=Y-X,X&&Q.output.set(Q.output.subarray(f,f+X),0),this.onData(d)}else this.onData(Q.output.length===Q.next_out?Q.output:Q.output.subarray(0,Q.next_out));if(j!==a||0!==O){if(j===z)return j=K.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,!0;if(0===Q.avail_in)break}}return!0},f.prototype.onData=function(Z){this.chunks.push(Z)},f.prototype.onEnd=function(Z){Z===a&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.msg=this.strm.msg},Z.exports.Inflate=f,Z.exports.inflate=X,Z.exports.inflateRaw=function(Z,M){return(M=M||{}).raw=!0,X(Z,M)},Z.exports.ungzip=X,Z.exports.constants=j(27572)},16931:function(Z){"use strict";var M=function(Z,M){return Object.prototype.hasOwnProperty.call(Z,M)};Z.exports.assign=function(Z){for(var j=Array.prototype.slice.call(arguments,1);j.length;){var K=j.shift();if(K){if("object"!==typeof K)throw new TypeError(K+"must be non-object");for(var b in K)M(K,b)&&(Z[b]=K[b])}}return Z},Z.exports.flattenChunks=function(Z){for(var M=0,j=0,K=Z.length;j<K;j++)M+=Z[j].length;for(var b=new Uint8Array(M),g=0,O=0,Q=Z.length;g<Q;g++){var Y=Z[g];b.set(Y,O),O+=Y.length}return b}},58415:function(Z){"use strict";var M=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Z){M=!1}for(var j=new Uint8Array(256),K=0;K<256;K++)j[K]=K>=252?6:K>=248?5:K>=240?4:K>=224?3:K>=192?2:1;j[254]=j[254]=1,Z.exports.string2buf=function(Z){if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(Z);var M,j,K,b,g,O=Z.length,Q=0;for(b=0;b<O;b++)55296===(64512&(j=Z.charCodeAt(b)))&&b+1<O&&56320===(64512&(K=Z.charCodeAt(b+1)))&&(j=65536+(j-55296<<10)+(K-56320),b++),Q+=j<128?1:j<2048?2:j<65536?3:4;for(M=new Uint8Array(Q),g=0,b=0;g<Q;b++)55296===(64512&(j=Z.charCodeAt(b)))&&b+1<O&&56320===(64512&(K=Z.charCodeAt(b+1)))&&(j=65536+(j-55296<<10)+(K-56320),b++),j<128?M[g++]=j:j<2048?(M[g++]=192|j>>>6,M[g++]=128|63&j):j<65536?(M[g++]=224|j>>>12,M[g++]=128|j>>>6&63,M[g++]=128|63&j):(M[g++]=240|j>>>18,M[g++]=128|j>>>12&63,M[g++]=128|j>>>6&63,M[g++]=128|63&j);return M};Z.exports.buf2string=function(Z,K){var b,g,O=K||Z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(Z.subarray(0,K));var Q=new Array(2*O);for(g=0,b=0;b<O;){var Y=Z[b++];if(Y<128)Q[g++]=Y;else{var I=j[Y];if(I>4)Q[g++]=65533,b+=I-1;else{for(Y&=2===I?31:3===I?15:7;I>1&&b<O;)Y=Y<<6|63&Z[b++],I--;I>1?Q[g++]=65533:Y<65536?Q[g++]=Y:(Y-=65536,Q[g++]=55296|Y>>10&1023,Q[g++]=56320|1023&Y)}}}return function(Z,j){if(j<65534&&Z.subarray&&M)return String.fromCharCode.apply(null,Z.length===j?Z:Z.subarray(0,j));for(var K="",b=0;b<j;b++)K+=String.fromCharCode(Z[b]);return K}(Q,g)},Z.exports.utf8border=function(Z,M){(M=M||Z.length)>Z.length&&(M=Z.length);for(var K=M-1;K>=0&&128===(192&Z[K]);)K--;return K<0||0===K?M:K+j[Z[K]]>M?K:M}},3040:function(Z){"use strict";Z.exports=function(Z,M,j,K){for(var b=65535&Z|0,g=Z>>>16&65535|0,O=0;0!==j;){j-=O=j>2e3?2e3:j;do{g=g+(b=b+M[K++]|0)|0}while(--O);b%=65521,g%=65521}return b|g<<16|0}},27572:function(Z){"use strict";Z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},36558:function(Z){"use strict";var M=new Uint32Array(function(){for(var Z,M=[],j=0;j<256;j++){Z=j;for(var K=0;K<8;K++)Z=1&Z?3988292384^Z>>>1:Z>>>1;M[j]=Z}return M}());Z.exports=function(Z,j,K,b){var g=M,O=b+K;Z^=-1;for(var Q=b;Q<O;Q++)Z=Z>>>8^g[255&(Z^j[Q])];return-1^Z}},38106:function(Z,M,j){"use strict";var K=j(53226),b=K._tr_init,g=K._tr_stored_block,O=K._tr_flush_block,Q=K._tr_tally,Y=K._tr_align,I=j(3040),E=j(36558),s=j(74274),i=j(27572),a=i.Z_NO_FLUSH,z=i.Z_PARTIAL_FLUSH,V=i.Z_FULL_FLUSH,o=i.Z_FINISH,c=i.Z_BLOCK,G=i.Z_OK,f=i.Z_STREAM_END,X=i.Z_STREAM_ERROR,d=i.Z_DATA_ERROR,W=i.Z_BUF_ERROR,A=i.Z_DEFAULT_COMPRESSION,q=i.Z_FILTERED,T=i.Z_HUFFMAN_ONLY,B=i.Z_RLE,N=i.Z_FIXED,U=i.Z_DEFAULT_STRATEGY,n=i.Z_UNKNOWN,k=i.Z_DEFLATED,x=258,R=262,e=103,u=113,F=666,C=function(Z,M){return Z.msg=s[M],M},y=function(Z){return(Z<<1)-(Z>4?9:0)},S=function(Z){for(var M=Z.length;--M>=0;)Z[M]=0},h=function(Z,M,j){return(M<<Z.hash_shift^j)&Z.hash_mask},w=function(Z){var M=Z.state,j=M.pending;j>Z.avail_out&&(j=Z.avail_out),0!==j&&(Z.output.set(M.pending_buf.subarray(M.pending_out,M.pending_out+j),Z.next_out),Z.next_out+=j,M.pending_out+=j,Z.total_out+=j,Z.avail_out-=j,M.pending-=j,0===M.pending&&(M.pending_out=0))},p=function(Z,M){O(Z,Z.block_start>=0?Z.block_start:-1,Z.strstart-Z.block_start,M),Z.block_start=Z.strstart,w(Z.strm)},m=function(Z,M){Z.pending_buf[Z.pending++]=M},J=function(Z,M){Z.pending_buf[Z.pending++]=M>>>8&255,Z.pending_buf[Z.pending++]=255&M},P=function(Z,M,j,K){var b=Z.avail_in;return b>K&&(b=K),0===b?0:(Z.avail_in-=b,M.set(Z.input.subarray(Z.next_in,Z.next_in+b),j),1===Z.state.wrap?Z.adler=I(Z.adler,M,b,j):2===Z.state.wrap&&(Z.adler=E(Z.adler,M,b,j)),Z.next_in+=b,Z.total_in+=b,b)},H=function(Z,M){var j,K,b=Z.max_chain_length,g=Z.strstart,O=Z.prev_length,Q=Z.nice_match,Y=Z.strstart>Z.w_size-R?Z.strstart-(Z.w_size-R):0,I=Z.window,E=Z.w_mask,s=Z.prev,i=Z.strstart+x,a=I[g+O-1],z=I[g+O];Z.prev_length>=Z.good_match&&(b>>=2),Q>Z.lookahead&&(Q=Z.lookahead);do{if(I[(j=M)+O]===z&&I[j+O-1]===a&&I[j]===I[g]&&I[++j]===I[g+1]){g+=2,j++;do{}while(I[++g]===I[++j]&&I[++g]===I[++j]&&I[++g]===I[++j]&&I[++g]===I[++j]&&I[++g]===I[++j]&&I[++g]===I[++j]&&I[++g]===I[++j]&&I[++g]===I[++j]&&g<i);if(K=x-(i-g),g=i-x,K>O){if(Z.match_start=M,O=K,K>=Q)break;a=I[g+O-1],z=I[g+O]}}}while((M=s[M&E])>Y&&0!==--b);return O<=Z.lookahead?O:Z.lookahead},D=function(Z){var M,j,K,b,g,O=Z.w_size;do{if(b=Z.window_size-Z.lookahead-Z.strstart,Z.strstart>=O+(O-R)){Z.window.set(Z.window.subarray(O,O+O),0),Z.match_start-=O,Z.strstart-=O,Z.block_start-=O,M=j=Z.hash_size;do{K=Z.head[--M],Z.head[M]=K>=O?K-O:0}while(--j);M=j=O;do{K=Z.prev[--M],Z.prev[M]=K>=O?K-O:0}while(--j);b+=O}if(0===Z.strm.avail_in)break;if(j=P(Z.strm,Z.window,Z.strstart+Z.lookahead,b),Z.lookahead+=j,Z.lookahead+Z.insert>=3)for(g=Z.strstart-Z.insert,Z.ins_h=Z.window[g],Z.ins_h=h(Z,Z.ins_h,Z.window[g+1]);Z.insert&&(Z.ins_h=h(Z,Z.ins_h,Z.window[g+3-1]),Z.prev[g&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=g,g++,Z.insert--,!(Z.lookahead+Z.insert<3)););}while(Z.lookahead<R&&0!==Z.strm.avail_in)},l=function(Z,M){for(var j,K;;){if(Z.lookahead<R){if(D(Z),Z.lookahead<R&&M===a)return 1;if(0===Z.lookahead)break}if(j=0,Z.lookahead>=3&&(Z.ins_h=h(Z,Z.ins_h,Z.window[Z.strstart+3-1]),j=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),0!==j&&Z.strstart-j<=Z.w_size-R&&(Z.match_length=H(Z,j)),Z.match_length>=3)if(K=Q(Z,Z.strstart-Z.match_start,Z.match_length-3),Z.lookahead-=Z.match_length,Z.match_length<=Z.max_lazy_match&&Z.lookahead>=3){Z.match_length--;do{Z.strstart++,Z.ins_h=h(Z,Z.ins_h,Z.window[Z.strstart+3-1]),j=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart}while(0!==--Z.match_length);Z.strstart++}else Z.strstart+=Z.match_length,Z.match_length=0,Z.ins_h=Z.window[Z.strstart],Z.ins_h=h(Z,Z.ins_h,Z.window[Z.strstart+1]);else K=Q(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++;if(K&&(p(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=Z.strstart<2?Z.strstart:2,M===o?(p(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(p(Z,!1),0===Z.strm.avail_out)?1:2},t=function(Z,M){for(var j,K,b;;){if(Z.lookahead<R){if(D(Z),Z.lookahead<R&&M===a)return 1;if(0===Z.lookahead)break}if(j=0,Z.lookahead>=3&&(Z.ins_h=h(Z,Z.ins_h,Z.window[Z.strstart+3-1]),j=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),Z.prev_length=Z.match_length,Z.prev_match=Z.match_start,Z.match_length=2,0!==j&&Z.prev_length<Z.max_lazy_match&&Z.strstart-j<=Z.w_size-R&&(Z.match_length=H(Z,j),Z.match_length<=5&&(Z.strategy===q||3===Z.match_length&&Z.strstart-Z.match_start>4096)&&(Z.match_length=2)),Z.prev_length>=3&&Z.match_length<=Z.prev_length){b=Z.strstart+Z.lookahead-3,K=Q(Z,Z.strstart-1-Z.prev_match,Z.prev_length-3),Z.lookahead-=Z.prev_length-1,Z.prev_length-=2;do{++Z.strstart<=b&&(Z.ins_h=h(Z,Z.ins_h,Z.window[Z.strstart+3-1]),j=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart)}while(0!==--Z.prev_length);if(Z.match_available=0,Z.match_length=2,Z.strstart++,K&&(p(Z,!1),0===Z.strm.avail_out))return 1}else if(Z.match_available){if((K=Q(Z,0,Z.window[Z.strstart-1]))&&p(Z,!1),Z.strstart++,Z.lookahead--,0===Z.strm.avail_out)return 1}else Z.match_available=1,Z.strstart++,Z.lookahead--}return Z.match_available&&(K=Q(Z,0,Z.window[Z.strstart-1]),Z.match_available=0),Z.insert=Z.strstart<2?Z.strstart:2,M===o?(p(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(p(Z,!1),0===Z.strm.avail_out)?1:2};function v(Z,M,j,K,b){this.good_length=Z,this.max_lazy=M,this.nice_length=j,this.max_chain=K,this.func=b}var r=[new v(0,0,0,0,(function(Z,M){var j=65535;for(j>Z.pending_buf_size-5&&(j=Z.pending_buf_size-5);;){if(Z.lookahead<=1){if(D(Z),0===Z.lookahead&&M===a)return 1;if(0===Z.lookahead)break}Z.strstart+=Z.lookahead,Z.lookahead=0;var K=Z.block_start+j;if((0===Z.strstart||Z.strstart>=K)&&(Z.lookahead=Z.strstart-K,Z.strstart=K,p(Z,!1),0===Z.strm.avail_out))return 1;if(Z.strstart-Z.block_start>=Z.w_size-R&&(p(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,M===o?(p(Z,!0),0===Z.strm.avail_out?3:4):(Z.strstart>Z.block_start&&(p(Z,!1),Z.strm.avail_out),1)})),new v(4,4,8,4,l),new v(4,5,16,8,l),new v(4,6,32,32,l),new v(4,4,16,16,t),new v(8,16,32,32,t),new v(8,16,128,128,t),new v(8,32,128,256,t),new v(32,128,258,1024,t),new v(32,258,258,4096,t)];function L(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),S(this.dyn_ltree),S(this.dyn_dtree),S(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),S(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),S(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var ZZ=function(Z){if(!Z||!Z.state)return C(Z,X);Z.total_in=Z.total_out=0,Z.data_type=n;var M=Z.state;return M.pending=0,M.pending_out=0,M.wrap<0&&(M.wrap=-M.wrap),M.status=M.wrap?42:u,Z.adler=2===M.wrap?0:1,M.last_flush=a,b(M),G},MZ=function(Z){var M,j=ZZ(Z);return j===G&&((M=Z.state).window_size=2*M.w_size,S(M.head),M.max_lazy_match=r[M.level].max_lazy,M.good_match=r[M.level].good_length,M.nice_match=r[M.level].nice_length,M.max_chain_length=r[M.level].max_chain,M.strstart=0,M.block_start=0,M.lookahead=0,M.insert=0,M.match_length=M.prev_length=2,M.match_available=0,M.ins_h=0),j},jZ=function(Z,M,j,K,b,g){if(!Z)return X;var O=1;if(M===A&&(M=6),K<0?(O=0,K=-K):K>15&&(O=2,K-=16),b<1||b>9||j!==k||K<8||K>15||M<0||M>9||g<0||g>N)return C(Z,X);8===K&&(K=9);var Q=new L;return Z.state=Q,Q.strm=Z,Q.wrap=O,Q.gzhead=null,Q.w_bits=K,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=b+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+3-1)/3),Q.window=new Uint8Array(2*Q.w_size),Q.head=new Uint16Array(Q.hash_size),Q.prev=new Uint16Array(Q.w_size),Q.lit_bufsize=1<<b+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new Uint8Array(Q.pending_buf_size),Q.d_buf=1*Q.lit_bufsize,Q.l_buf=3*Q.lit_bufsize,Q.level=M,Q.strategy=g,Q.method=j,MZ(Z)};Z.exports.deflateInit=function(Z,M){return jZ(Z,M,k,15,8,U)},Z.exports.deflateInit2=jZ,Z.exports.deflateReset=MZ,Z.exports.deflateResetKeep=ZZ,Z.exports.deflateSetHeader=function(Z,M){return Z&&Z.state?2!==Z.state.wrap?X:(Z.state.gzhead=M,G):X},Z.exports.deflate=function(Z,M){var j,K;if(!Z||!Z.state||M>c||M<0)return Z?C(Z,X):X;var b=Z.state;if(!Z.output||!Z.input&&0!==Z.avail_in||b.status===F&&M!==o)return C(Z,0===Z.avail_out?W:X);b.strm=Z;var O=b.last_flush;if(b.last_flush=M,42===b.status)if(2===b.wrap)Z.adler=0,m(b,31),m(b,139),m(b,8),b.gzhead?(m(b,(b.gzhead.text?1:0)+(b.gzhead.hcrc?2:0)+(b.gzhead.extra?4:0)+(b.gzhead.name?8:0)+(b.gzhead.comment?16:0)),m(b,255&b.gzhead.time),m(b,b.gzhead.time>>8&255),m(b,b.gzhead.time>>16&255),m(b,b.gzhead.time>>24&255),m(b,9===b.level?2:b.strategy>=T||b.level<2?4:0),m(b,255&b.gzhead.os),b.gzhead.extra&&b.gzhead.extra.length&&(m(b,255&b.gzhead.extra.length),m(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(Z.adler=E(Z.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=69):(m(b,0),m(b,0),m(b,0),m(b,0),m(b,0),m(b,9===b.level?2:b.strategy>=T||b.level<2?4:0),m(b,3),b.status=u);else{var I=k+(b.w_bits-8<<4)<<8;I|=(b.strategy>=T||b.level<2?0:b.level<6?1:6===b.level?2:3)<<6,0!==b.strstart&&(I|=32),I+=31-I%31,b.status=u,J(b,I),0!==b.strstart&&(J(b,Z.adler>>>16),J(b,65535&Z.adler)),Z.adler=1}if(69===b.status)if(b.gzhead.extra){for(j=b.pending;b.gzindex<(65535&b.gzhead.extra.length)&&(b.pending!==b.pending_buf_size||(b.gzhead.hcrc&&b.pending>j&&(Z.adler=E(Z.adler,b.pending_buf,b.pending-j,j)),w(Z),j=b.pending,b.pending!==b.pending_buf_size));)m(b,255&b.gzhead.extra[b.gzindex]),b.gzindex++;b.gzhead.hcrc&&b.pending>j&&(Z.adler=E(Z.adler,b.pending_buf,b.pending-j,j)),b.gzindex===b.gzhead.extra.length&&(b.gzindex=0,b.status=73)}else b.status=73;if(73===b.status)if(b.gzhead.name){j=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>j&&(Z.adler=E(Z.adler,b.pending_buf,b.pending-j,j)),w(Z),j=b.pending,b.pending===b.pending_buf_size)){K=1;break}K=b.gzindex<b.gzhead.name.length?255&b.gzhead.name.charCodeAt(b.gzindex++):0,m(b,K)}while(0!==K);b.gzhead.hcrc&&b.pending>j&&(Z.adler=E(Z.adler,b.pending_buf,b.pending-j,j)),0===K&&(b.gzindex=0,b.status=91)}else b.status=91;if(91===b.status)if(b.gzhead.comment){j=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>j&&(Z.adler=E(Z.adler,b.pending_buf,b.pending-j,j)),w(Z),j=b.pending,b.pending===b.pending_buf_size)){K=1;break}K=b.gzindex<b.gzhead.comment.length?255&b.gzhead.comment.charCodeAt(b.gzindex++):0,m(b,K)}while(0!==K);b.gzhead.hcrc&&b.pending>j&&(Z.adler=E(Z.adler,b.pending_buf,b.pending-j,j)),0===K&&(b.status=e)}else b.status=e;if(b.status===e&&(b.gzhead.hcrc?(b.pending+2>b.pending_buf_size&&w(Z),b.pending+2<=b.pending_buf_size&&(m(b,255&Z.adler),m(b,Z.adler>>8&255),Z.adler=0,b.status=u)):b.status=u),0!==b.pending){if(w(Z),0===Z.avail_out)return b.last_flush=-1,G}else if(0===Z.avail_in&&y(M)<=y(O)&&M!==o)return C(Z,W);if(b.status===F&&0!==Z.avail_in)return C(Z,W);if(0!==Z.avail_in||0!==b.lookahead||M!==a&&b.status!==F){var s=b.strategy===T?function(Z,M){for(var j;;){if(0===Z.lookahead&&(D(Z),0===Z.lookahead)){if(M===a)return 1;break}if(Z.match_length=0,j=Q(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,j&&(p(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,M===o?(p(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(p(Z,!1),0===Z.strm.avail_out)?1:2}(b,M):b.strategy===B?function(Z,M){for(var j,K,b,g,O=Z.window;;){if(Z.lookahead<=x){if(D(Z),Z.lookahead<=x&&M===a)return 1;if(0===Z.lookahead)break}if(Z.match_length=0,Z.lookahead>=3&&Z.strstart>0&&(K=O[b=Z.strstart-1])===O[++b]&&K===O[++b]&&K===O[++b]){g=Z.strstart+x;do{}while(K===O[++b]&&K===O[++b]&&K===O[++b]&&K===O[++b]&&K===O[++b]&&K===O[++b]&&K===O[++b]&&K===O[++b]&&b<g);Z.match_length=x-(g-b),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=3?(j=Q(Z,1,Z.match_length-3),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(j=Q(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),j&&(p(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,M===o?(p(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(p(Z,!1),0===Z.strm.avail_out)?1:2}(b,M):r[b.level].func(b,M);if(3!==s&&4!==s||(b.status=F),1===s||3===s)return 0===Z.avail_out&&(b.last_flush=-1),G;if(2===s&&(M===z?Y(b):M!==c&&(g(b,0,0,!1),M===V&&(S(b.head),0===b.lookahead&&(b.strstart=0,b.block_start=0,b.insert=0))),w(Z),0===Z.avail_out))return b.last_flush=-1,G}return M!==o?G:b.wrap<=0?f:(2===b.wrap?(m(b,255&Z.adler),m(b,Z.adler>>8&255),m(b,Z.adler>>16&255),m(b,Z.adler>>24&255),m(b,255&Z.total_in),m(b,Z.total_in>>8&255),m(b,Z.total_in>>16&255),m(b,Z.total_in>>24&255)):(J(b,Z.adler>>>16),J(b,65535&Z.adler)),w(Z),b.wrap>0&&(b.wrap=-b.wrap),0!==b.pending?G:f)},Z.exports.deflateEnd=function(Z){if(!Z||!Z.state)return X;var M=Z.state.status;return 42!==M&&69!==M&&73!==M&&91!==M&&M!==e&&M!==u&&M!==F?C(Z,X):(Z.state=null,M===u?C(Z,d):G)},Z.exports.deflateSetDictionary=function(Z,M){var j=M.length;if(!Z||!Z.state)return X;var K=Z.state,b=K.wrap;if(2===b||1===b&&42!==K.status||K.lookahead)return X;if(1===b&&(Z.adler=I(Z.adler,M,j,0)),K.wrap=0,j>=K.w_size){0===b&&(S(K.head),K.strstart=0,K.block_start=0,K.insert=0);var g=new Uint8Array(K.w_size);g.set(M.subarray(j-K.w_size,j),0),M=g,j=K.w_size}var O=Z.avail_in,Q=Z.next_in,Y=Z.input;for(Z.avail_in=j,Z.next_in=0,Z.input=M,D(K);K.lookahead>=3;){var E=K.strstart,s=K.lookahead-2;do{K.ins_h=h(K,K.ins_h,K.window[E+3-1]),K.prev[E&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=E,E++}while(--s);K.strstart=E,K.lookahead=2,D(K)}return K.strstart+=K.lookahead,K.block_start=K.strstart,K.insert=K.lookahead,K.lookahead=0,K.match_length=K.prev_length=2,K.match_available=0,Z.next_in=Q,Z.input=Y,Z.avail_in=O,K.wrap=b,G},Z.exports.deflateInfo="pako deflate (from Nodeca project)"},84284:function(Z){"use strict";Z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},36997:function(Z){"use strict";Z.exports=function(Z,M){var j,K,b,g,O,Q,Y,I,E,s,i,a,z,V,o,c,G,f,X,d,W,A,q,T,B=Z.state;j=Z.next_in,q=Z.input,K=j+(Z.avail_in-5),b=Z.next_out,T=Z.output,g=b-(M-Z.avail_out),O=b+(Z.avail_out-257),Q=B.dmax,Y=B.wsize,I=B.whave,E=B.wnext,s=B.window,i=B.hold,a=B.bits,z=B.lencode,V=B.distcode,o=(1<<B.lenbits)-1,c=(1<<B.distbits)-1;Z:do{a<15&&(i+=q[j++]<<a,a+=8,i+=q[j++]<<a,a+=8),G=z[i&o];M:for(;;){if(i>>>=f=G>>>24,a-=f,0===(f=G>>>16&255))T[b++]=65535&G;else{if(!(16&f)){if(0===(64&f)){G=z[(65535&G)+(i&(1<<f)-1)];continue M}if(32&f){B.mode=12;break Z}Z.msg="invalid literal/length code",B.mode=30;break Z}X=65535&G,(f&=15)&&(a<f&&(i+=q[j++]<<a,a+=8),X+=i&(1<<f)-1,i>>>=f,a-=f),a<15&&(i+=q[j++]<<a,a+=8,i+=q[j++]<<a,a+=8),G=V[i&c];j:for(;;){if(i>>>=f=G>>>24,a-=f,!(16&(f=G>>>16&255))){if(0===(64&f)){G=V[(65535&G)+(i&(1<<f)-1)];continue j}Z.msg="invalid distance code",B.mode=30;break Z}if(d=65535&G,a<(f&=15)&&(i+=q[j++]<<a,(a+=8)<f&&(i+=q[j++]<<a,a+=8)),(d+=i&(1<<f)-1)>Q){Z.msg="invalid distance too far back",B.mode=30;break Z}if(i>>>=f,a-=f,d>(f=b-g)){if((f=d-f)>I&&B.sane){Z.msg="invalid distance too far back",B.mode=30;break Z}if(W=0,A=s,0===E){if(W+=Y-f,f<X){X-=f;do{T[b++]=s[W++]}while(--f);W=b-d,A=T}}else if(E<f){if(W+=Y+E-f,(f-=E)<X){X-=f;do{T[b++]=s[W++]}while(--f);if(W=0,E<X){X-=f=E;do{T[b++]=s[W++]}while(--f);W=b-d,A=T}}}else if(W+=E-f,f<X){X-=f;do{T[b++]=s[W++]}while(--f);W=b-d,A=T}for(;X>2;)T[b++]=A[W++],T[b++]=A[W++],T[b++]=A[W++],X-=3;X&&(T[b++]=A[W++],X>1&&(T[b++]=A[W++]))}else{W=b-d;do{T[b++]=T[W++],T[b++]=T[W++],T[b++]=T[W++],X-=3}while(X>2);X&&(T[b++]=T[W++],X>1&&(T[b++]=T[W++]))}break}}break}}while(j<K&&b<O);j-=X=a>>3,i&=(1<<(a-=X<<3))-1,Z.next_in=j,Z.next_out=b,Z.avail_in=j<K?K-j+5:5-(j-K),Z.avail_out=b<O?O-b+257:257-(b-O),B.hold=i,B.bits=a}},31833:function(Z,M,j){"use strict";var K=j(3040),b=j(36558),g=j(36997),O=j(33443),Q=j(27572),Y=Q.Z_FINISH,I=Q.Z_BLOCK,E=Q.Z_TREES,s=Q.Z_OK,i=Q.Z_STREAM_END,a=Q.Z_NEED_DICT,z=Q.Z_STREAM_ERROR,V=Q.Z_DATA_ERROR,o=Q.Z_MEM_ERROR,c=Q.Z_BUF_ERROR,G=Q.Z_DEFLATED,f=12,X=30,d=function(Z){return(Z>>>24&255)+(Z>>>8&65280)+((65280&Z)<<8)+((255&Z)<<24)};function W(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var A,q,T=function(Z){if(!Z||!Z.state)return z;var M=Z.state;return Z.total_in=Z.total_out=M.total=0,Z.msg="",M.wrap&&(Z.adler=1&M.wrap),M.mode=1,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new Int32Array(852),M.distcode=M.distdyn=new Int32Array(592),M.sane=1,M.back=-1,s},B=function(Z){if(!Z||!Z.state)return z;var M=Z.state;return M.wsize=0,M.whave=0,M.wnext=0,T(Z)},N=function(Z,M){var j;if(!Z||!Z.state)return z;var K=Z.state;return M<0?(j=0,M=-M):(j=1+(M>>4),M<48&&(M&=15)),M&&(M<8||M>15)?z:(null!==K.window&&K.wbits!==M&&(K.window=null),K.wrap=j,K.wbits=M,B(Z))},U=function(Z,M){if(!Z)return z;var j=new W;Z.state=j,j.window=null;var K=N(Z,M);return K!==s&&(Z.state=null),K},n=!0,k=function(Z){if(n){A=new Int32Array(512),q=new Int32Array(32);for(var M=0;M<144;)Z.lens[M++]=8;for(;M<256;)Z.lens[M++]=9;for(;M<280;)Z.lens[M++]=7;for(;M<288;)Z.lens[M++]=8;for(O(1,Z.lens,0,288,A,0,Z.work,{bits:9}),M=0;M<32;)Z.lens[M++]=5;O(2,Z.lens,0,32,q,0,Z.work,{bits:5}),n=!1}Z.lencode=A,Z.lenbits=9,Z.distcode=q,Z.distbits=5},x=function(Z,M,j,K){var b,g=Z.state;return null===g.window&&(g.wsize=1<<g.wbits,g.wnext=0,g.whave=0,g.window=new Uint8Array(g.wsize)),K>=g.wsize?(g.window.set(M.subarray(j-g.wsize,j),0),g.wnext=0,g.whave=g.wsize):((b=g.wsize-g.wnext)>K&&(b=K),g.window.set(M.subarray(j-K,j-K+b),g.wnext),(K-=b)?(g.window.set(M.subarray(j-K,j),0),g.wnext=K,g.whave=g.wsize):(g.wnext+=b,g.wnext===g.wsize&&(g.wnext=0),g.whave<g.wsize&&(g.whave+=b))),0};Z.exports.inflateReset=B,Z.exports.inflateReset2=N,Z.exports.inflateResetKeep=T,Z.exports.inflateInit=function(Z){return U(Z,15)},Z.exports.inflateInit2=U,Z.exports.inflate=function(Z,M){var j,Q,W,A,q,T,B,N,U,n,R,e,u,F,C,y,S,h,w,p,m,J,P,H,D=0,l=new Uint8Array(4),t=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!Z||!Z.state||!Z.output||!Z.input&&0!==Z.avail_in)return z;(j=Z.state).mode===f&&(j.mode=13),q=Z.next_out,W=Z.output,B=Z.avail_out,A=Z.next_in,Q=Z.input,T=Z.avail_in,N=j.hold,U=j.bits,n=T,R=B,J=s;Z:for(;;)switch(j.mode){case 1:if(0===j.wrap){j.mode=13;break}for(;U<16;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}if(2&j.wrap&&35615===N){j.check=0,l[0]=255&N,l[1]=N>>>8&255,j.check=b(j.check,l,2,0),N=0,U=0,j.mode=2;break}if(j.flags=0,j.head&&(j.head.done=!1),!(1&j.wrap)||(((255&N)<<8)+(N>>8))%31){Z.msg="incorrect header check",j.mode=X;break}if((15&N)!==G){Z.msg="unknown compression method",j.mode=X;break}if(U-=4,m=8+(15&(N>>>=4)),0===j.wbits)j.wbits=m;else if(m>j.wbits){Z.msg="invalid window size",j.mode=X;break}j.dmax=1<<j.wbits,Z.adler=j.check=1,j.mode=512&N?10:f,N=0,U=0;break;case 2:for(;U<16;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}if(j.flags=N,(255&j.flags)!==G){Z.msg="unknown compression method",j.mode=X;break}if(57344&j.flags){Z.msg="unknown header flags set",j.mode=X;break}j.head&&(j.head.text=N>>8&1),512&j.flags&&(l[0]=255&N,l[1]=N>>>8&255,j.check=b(j.check,l,2,0)),N=0,U=0,j.mode=3;case 3:for(;U<32;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}j.head&&(j.head.time=N),512&j.flags&&(l[0]=255&N,l[1]=N>>>8&255,l[2]=N>>>16&255,l[3]=N>>>24&255,j.check=b(j.check,l,4,0)),N=0,U=0,j.mode=4;case 4:for(;U<16;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}j.head&&(j.head.xflags=255&N,j.head.os=N>>8),512&j.flags&&(l[0]=255&N,l[1]=N>>>8&255,j.check=b(j.check,l,2,0)),N=0,U=0,j.mode=5;case 5:if(1024&j.flags){for(;U<16;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}j.length=N,j.head&&(j.head.extra_len=N),512&j.flags&&(l[0]=255&N,l[1]=N>>>8&255,j.check=b(j.check,l,2,0)),N=0,U=0}else j.head&&(j.head.extra=null);j.mode=6;case 6:if(1024&j.flags&&((e=j.length)>T&&(e=T),e&&(j.head&&(m=j.head.extra_len-j.length,j.head.extra||(j.head.extra=new Uint8Array(j.head.extra_len)),j.head.extra.set(Q.subarray(A,A+e),m)),512&j.flags&&(j.check=b(j.check,Q,e,A)),T-=e,A+=e,j.length-=e),j.length))break Z;j.length=0,j.mode=7;case 7:if(2048&j.flags){if(0===T)break Z;e=0;do{m=Q[A+e++],j.head&&m&&j.length<65536&&(j.head.name+=String.fromCharCode(m))}while(m&&e<T);if(512&j.flags&&(j.check=b(j.check,Q,e,A)),T-=e,A+=e,m)break Z}else j.head&&(j.head.name=null);j.length=0,j.mode=8;case 8:if(4096&j.flags){if(0===T)break Z;e=0;do{m=Q[A+e++],j.head&&m&&j.length<65536&&(j.head.comment+=String.fromCharCode(m))}while(m&&e<T);if(512&j.flags&&(j.check=b(j.check,Q,e,A)),T-=e,A+=e,m)break Z}else j.head&&(j.head.comment=null);j.mode=9;case 9:if(512&j.flags){for(;U<16;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}if(N!==(65535&j.check)){Z.msg="header crc mismatch",j.mode=X;break}N=0,U=0}j.head&&(j.head.hcrc=j.flags>>9&1,j.head.done=!0),Z.adler=j.check=0,j.mode=f;break;case 10:for(;U<32;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}Z.adler=j.check=d(N),N=0,U=0,j.mode=11;case 11:if(0===j.havedict)return Z.next_out=q,Z.avail_out=B,Z.next_in=A,Z.avail_in=T,j.hold=N,j.bits=U,a;Z.adler=j.check=1,j.mode=f;case f:if(M===I||M===E)break Z;case 13:if(j.last){N>>>=7&U,U-=7&U,j.mode=27;break}for(;U<3;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}switch(j.last=1&N,U-=1,3&(N>>>=1)){case 0:j.mode=14;break;case 1:if(k(j),j.mode=20,M===E){N>>>=2,U-=2;break Z}break;case 2:j.mode=17;break;case 3:Z.msg="invalid block type",j.mode=X}N>>>=2,U-=2;break;case 14:for(N>>>=7&U,U-=7&U;U<32;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}if((65535&N)!==(N>>>16^65535)){Z.msg="invalid stored block lengths",j.mode=X;break}if(j.length=65535&N,N=0,U=0,j.mode=15,M===E)break Z;case 15:j.mode=16;case 16:if(e=j.length){if(e>T&&(e=T),e>B&&(e=B),0===e)break Z;W.set(Q.subarray(A,A+e),q),T-=e,A+=e,B-=e,q+=e,j.length-=e;break}j.mode=f;break;case 17:for(;U<14;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}if(j.nlen=257+(31&N),N>>>=5,U-=5,j.ndist=1+(31&N),N>>>=5,U-=5,j.ncode=4+(15&N),N>>>=4,U-=4,j.nlen>286||j.ndist>30){Z.msg="too many length or distance symbols",j.mode=X;break}j.have=0,j.mode=18;case 18:for(;j.have<j.ncode;){for(;U<3;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}j.lens[t[j.have++]]=7&N,N>>>=3,U-=3}for(;j.have<19;)j.lens[t[j.have++]]=0;if(j.lencode=j.lendyn,j.lenbits=7,P={bits:j.lenbits},J=O(0,j.lens,0,19,j.lencode,0,j.work,P),j.lenbits=P.bits,J){Z.msg="invalid code lengths set",j.mode=X;break}j.have=0,j.mode=19;case 19:for(;j.have<j.nlen+j.ndist;){for(;y=(D=j.lencode[N&(1<<j.lenbits)-1])>>>16&255,S=65535&D,!((C=D>>>24)<=U);){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}if(S<16)N>>>=C,U-=C,j.lens[j.have++]=S;else{if(16===S){for(H=C+2;U<H;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}if(N>>>=C,U-=C,0===j.have){Z.msg="invalid bit length repeat",j.mode=X;break}m=j.lens[j.have-1],e=3+(3&N),N>>>=2,U-=2}else if(17===S){for(H=C+3;U<H;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}U-=C,m=0,e=3+(7&(N>>>=C)),N>>>=3,U-=3}else{for(H=C+7;U<H;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}U-=C,m=0,e=11+(127&(N>>>=C)),N>>>=7,U-=7}if(j.have+e>j.nlen+j.ndist){Z.msg="invalid bit length repeat",j.mode=X;break}for(;e--;)j.lens[j.have++]=m}}if(j.mode===X)break;if(0===j.lens[256]){Z.msg="invalid code -- missing end-of-block",j.mode=X;break}if(j.lenbits=9,P={bits:j.lenbits},J=O(1,j.lens,0,j.nlen,j.lencode,0,j.work,P),j.lenbits=P.bits,J){Z.msg="invalid literal/lengths set",j.mode=X;break}if(j.distbits=6,j.distcode=j.distdyn,P={bits:j.distbits},J=O(2,j.lens,j.nlen,j.ndist,j.distcode,0,j.work,P),j.distbits=P.bits,J){Z.msg="invalid distances set",j.mode=X;break}if(j.mode=20,M===E)break Z;case 20:j.mode=21;case 21:if(T>=6&&B>=258){Z.next_out=q,Z.avail_out=B,Z.next_in=A,Z.avail_in=T,j.hold=N,j.bits=U,g(Z,R),q=Z.next_out,W=Z.output,B=Z.avail_out,A=Z.next_in,Q=Z.input,T=Z.avail_in,N=j.hold,U=j.bits,j.mode===f&&(j.back=-1);break}for(j.back=0;y=(D=j.lencode[N&(1<<j.lenbits)-1])>>>16&255,S=65535&D,!((C=D>>>24)<=U);){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}if(y&&0===(240&y)){for(h=C,w=y,p=S;y=(D=j.lencode[p+((N&(1<<h+w)-1)>>h)])>>>16&255,S=65535&D,!(h+(C=D>>>24)<=U);){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}N>>>=h,U-=h,j.back+=h}if(N>>>=C,U-=C,j.back+=C,j.length=S,0===y){j.mode=26;break}if(32&y){j.back=-1,j.mode=f;break}if(64&y){Z.msg="invalid literal/length code",j.mode=X;break}j.extra=15&y,j.mode=22;case 22:if(j.extra){for(H=j.extra;U<H;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}j.length+=N&(1<<j.extra)-1,N>>>=j.extra,U-=j.extra,j.back+=j.extra}j.was=j.length,j.mode=23;case 23:for(;y=(D=j.distcode[N&(1<<j.distbits)-1])>>>16&255,S=65535&D,!((C=D>>>24)<=U);){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}if(0===(240&y)){for(h=C,w=y,p=S;y=(D=j.distcode[p+((N&(1<<h+w)-1)>>h)])>>>16&255,S=65535&D,!(h+(C=D>>>24)<=U);){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}N>>>=h,U-=h,j.back+=h}if(N>>>=C,U-=C,j.back+=C,64&y){Z.msg="invalid distance code",j.mode=X;break}j.offset=S,j.extra=15&y,j.mode=24;case 24:if(j.extra){for(H=j.extra;U<H;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}j.offset+=N&(1<<j.extra)-1,N>>>=j.extra,U-=j.extra,j.back+=j.extra}if(j.offset>j.dmax){Z.msg="invalid distance too far back",j.mode=X;break}j.mode=25;case 25:if(0===B)break Z;if(e=R-B,j.offset>e){if((e=j.offset-e)>j.whave&&j.sane){Z.msg="invalid distance too far back",j.mode=X;break}e>j.wnext?(e-=j.wnext,u=j.wsize-e):u=j.wnext-e,e>j.length&&(e=j.length),F=j.window}else F=W,u=q-j.offset,e=j.length;e>B&&(e=B),B-=e,j.length-=e;do{W[q++]=F[u++]}while(--e);0===j.length&&(j.mode=21);break;case 26:if(0===B)break Z;W[q++]=j.length,B--,j.mode=21;break;case 27:if(j.wrap){for(;U<32;){if(0===T)break Z;T--,N|=Q[A++]<<U,U+=8}if(R-=B,Z.total_out+=R,j.total+=R,R&&(Z.adler=j.check=j.flags?b(j.check,W,R,q-R):K(j.check,W,R,q-R)),R=B,(j.flags?N:d(N))!==j.check){Z.msg="incorrect data check",j.mode=X;break}N=0,U=0}j.mode=28;case 28:if(j.wrap&&j.flags){for(;U<32;){if(0===T)break Z;T--,N+=Q[A++]<<U,U+=8}if(N!==(4294967295&j.total)){Z.msg="incorrect length check",j.mode=X;break}N=0,U=0}j.mode=29;case 29:J=i;break Z;case X:J=V;break Z;case 31:return o;default:return z}return Z.next_out=q,Z.avail_out=B,Z.next_in=A,Z.avail_in=T,j.hold=N,j.bits=U,(j.wsize||R!==Z.avail_out&&j.mode<X&&(j.mode<27||M!==Y))&&x(Z,Z.output,Z.next_out,R-Z.avail_out)?(j.mode=31,o):(n-=Z.avail_in,R-=Z.avail_out,Z.total_in+=n,Z.total_out+=R,j.total+=R,j.wrap&&R&&(Z.adler=j.check=j.flags?b(j.check,W,R,Z.next_out-R):K(j.check,W,R,Z.next_out-R)),Z.data_type=j.bits+(j.last?64:0)+(j.mode===f?128:0)+(20===j.mode||15===j.mode?256:0),(0===n&&0===R||M===Y)&&J===s&&(J=c),J)},Z.exports.inflateEnd=function(Z){if(!Z||!Z.state)return z;var M=Z.state;return M.window&&(M.window=null),Z.state=null,s},Z.exports.inflateGetHeader=function(Z,M){if(!Z||!Z.state)return z;var j=Z.state;return 0===(2&j.wrap)?z:(j.head=M,M.done=!1,s)},Z.exports.inflateSetDictionary=function(Z,M){var j,b=M.length;return Z&&Z.state?0!==(j=Z.state).wrap&&11!==j.mode?z:11===j.mode&&K(1,M,b,0)!==j.check?V:x(Z,M,b,b)?(j.mode=31,o):(j.havedict=1,s):z},Z.exports.inflateInfo="pako inflate (from Nodeca project)"},33443:function(Z){"use strict";var M=15,j=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),K=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),b=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),g=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);Z.exports=function(Z,O,Q,Y,I,E,s,i){var a,z,V,o,c,G,f,X,d,W=i.bits,A=0,q=0,T=0,B=0,N=0,U=0,n=0,k=0,x=0,R=0,e=null,u=0,F=new Uint16Array(16),C=new Uint16Array(16),y=null,S=0;for(A=0;A<=M;A++)F[A]=0;for(q=0;q<Y;q++)F[O[Q+q]]++;for(N=W,B=M;B>=1&&0===F[B];B--);if(N>B&&(N=B),0===B)return I[E++]=20971520,I[E++]=20971520,i.bits=1,0;for(T=1;T<B&&0===F[T];T++);for(N<T&&(N=T),k=1,A=1;A<=M;A++)if(k<<=1,(k-=F[A])<0)return-1;if(k>0&&(0===Z||1!==B))return-1;for(C[1]=0,A=1;A<M;A++)C[A+1]=C[A]+F[A];for(q=0;q<Y;q++)0!==O[Q+q]&&(s[C[O[Q+q]]++]=q);if(0===Z?(e=y=s,G=19):1===Z?(e=j,u-=257,y=K,S-=257,G=256):(e=b,y=g,G=-1),R=0,q=0,A=T,c=E,U=N,n=0,V=-1,o=(x=1<<N)-1,1===Z&&x>852||2===Z&&x>592)return 1;for(;;){f=A-n,s[q]<G?(X=0,d=s[q]):s[q]>G?(X=y[S+s[q]],d=e[u+s[q]]):(X=96,d=0),a=1<<A-n,T=z=1<<U;do{I[c+(R>>n)+(z-=a)]=f<<24|X<<16|d|0}while(0!==z);for(a=1<<A-1;R&a;)a>>=1;if(0!==a?(R&=a-1,R+=a):R=0,q++,0===--F[A]){if(A===B)break;A=O[Q+s[q]]}if(A>N&&(R&o)!==V){for(0===n&&(n=N),c+=T,k=1<<(U=A-n);U+n<B&&!((k-=F[U+n])<=0);)U++,k<<=1;if(x+=1<<U,1===Z&&x>852||2===Z&&x>592)return 1;I[V=R&o]=N<<24|U<<16|c-E|0}}return 0!==R&&(I[c+R]=A-n<<24|64<<16|0),i.bits=N,0}},74274:function(Z){"use strict";Z.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},53226:function(Z){"use strict";function M(Z){for(var M=Z.length;--M>=0;)Z[M]=0}var j=256,K=286,b=30,g=15,O=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Q=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Y=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),E=new Array(576);M(E);var s=new Array(60);M(s);var i=new Array(512);M(i);var a=new Array(256);M(a);var z=new Array(29);M(z);var V,o,c,G=new Array(b);function f(Z,M,j,K,b){this.static_tree=Z,this.extra_bits=M,this.extra_base=j,this.elems=K,this.max_length=b,this.has_stree=Z&&Z.length}function X(Z,M){this.dyn_tree=Z,this.max_code=0,this.stat_desc=M}M(G);var d=function(Z){return Z<256?i[Z]:i[256+(Z>>>7)]},W=function(Z,M){Z.pending_buf[Z.pending++]=255&M,Z.pending_buf[Z.pending++]=M>>>8&255},A=function(Z,M,j){Z.bi_valid>16-j?(Z.bi_buf|=M<<Z.bi_valid&65535,W(Z,Z.bi_buf),Z.bi_buf=M>>16-Z.bi_valid,Z.bi_valid+=j-16):(Z.bi_buf|=M<<Z.bi_valid&65535,Z.bi_valid+=j)},q=function(Z,M,j){A(Z,j[2*M],j[2*M+1])},T=function(Z,M){var j=0;do{j|=1&Z,Z>>>=1,j<<=1}while(--M>0);return j>>>1},B=function(Z,M,j){var K,b,O=new Array(16),Q=0;for(K=1;K<=g;K++)O[K]=Q=Q+j[K-1]<<1;for(b=0;b<=M;b++){var Y=Z[2*b+1];0!==Y&&(Z[2*b]=T(O[Y]++,Y))}},N=function(Z){var M;for(M=0;M<K;M++)Z.dyn_ltree[2*M]=0;for(M=0;M<b;M++)Z.dyn_dtree[2*M]=0;for(M=0;M<19;M++)Z.bl_tree[2*M]=0;Z.dyn_ltree[512]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0},U=function(Z){Z.bi_valid>8?W(Z,Z.bi_buf):Z.bi_valid>0&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0},n=function(Z,M,j,K){var b=2*M,g=2*j;return Z[b]<Z[g]||Z[b]===Z[g]&&K[M]<=K[j]},k=function(Z,M,j){for(var K=Z.heap[j],b=j<<1;b<=Z.heap_len&&(b<Z.heap_len&&n(M,Z.heap[b+1],Z.heap[b],Z.depth)&&b++,!n(M,K,Z.heap[b],Z.depth));)Z.heap[j]=Z.heap[b],j=b,b<<=1;Z.heap[j]=K},x=function(Z,M,K){var b,g,Y,I,E=0;if(0!==Z.last_lit)do{b=Z.pending_buf[Z.d_buf+2*E]<<8|Z.pending_buf[Z.d_buf+2*E+1],g=Z.pending_buf[Z.l_buf+E],E++,0===b?q(Z,g,M):(Y=a[g],q(Z,Y+j+1,M),0!==(I=O[Y])&&(g-=z[Y],A(Z,g,I)),b--,Y=d(b),q(Z,Y,K),0!==(I=Q[Y])&&(b-=G[Y],A(Z,b,I)))}while(E<Z.last_lit);q(Z,256,M)},R=function(Z,M){var j,K,b,O=M.dyn_tree,Q=M.stat_desc.static_tree,Y=M.stat_desc.has_stree,I=M.stat_desc.elems,E=-1;for(Z.heap_len=0,Z.heap_max=573,j=0;j<I;j++)0!==O[2*j]?(Z.heap[++Z.heap_len]=E=j,Z.depth[j]=0):O[2*j+1]=0;for(;Z.heap_len<2;)O[2*(b=Z.heap[++Z.heap_len]=E<2?++E:0)]=1,Z.depth[b]=0,Z.opt_len--,Y&&(Z.static_len-=Q[2*b+1]);for(M.max_code=E,j=Z.heap_len>>1;j>=1;j--)k(Z,O,j);b=I;do{j=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],k(Z,O,1),K=Z.heap[1],Z.heap[--Z.heap_max]=j,Z.heap[--Z.heap_max]=K,O[2*b]=O[2*j]+O[2*K],Z.depth[b]=(Z.depth[j]>=Z.depth[K]?Z.depth[j]:Z.depth[K])+1,O[2*j+1]=O[2*K+1]=b,Z.heap[1]=b++,k(Z,O,1)}while(Z.heap_len>=2);Z.heap[--Z.heap_max]=Z.heap[1],function(Z,M){var j,K,b,O,Q,Y,I=M.dyn_tree,E=M.max_code,s=M.stat_desc.static_tree,i=M.stat_desc.has_stree,a=M.stat_desc.extra_bits,z=M.stat_desc.extra_base,V=M.stat_desc.max_length,o=0;for(O=0;O<=g;O++)Z.bl_count[O]=0;for(I[2*Z.heap[Z.heap_max]+1]=0,j=Z.heap_max+1;j<573;j++)(O=I[2*I[2*(K=Z.heap[j])+1]+1]+1)>V&&(O=V,o++),I[2*K+1]=O,K>E||(Z.bl_count[O]++,Q=0,K>=z&&(Q=a[K-z]),Y=I[2*K],Z.opt_len+=Y*(O+Q),i&&(Z.static_len+=Y*(s[2*K+1]+Q)));if(0!==o){do{for(O=V-1;0===Z.bl_count[O];)O--;Z.bl_count[O]--,Z.bl_count[O+1]+=2,Z.bl_count[V]--,o-=2}while(o>0);for(O=V;0!==O;O--)for(K=Z.bl_count[O];0!==K;)(b=Z.heap[--j])>E||(I[2*b+1]!==O&&(Z.opt_len+=(O-I[2*b+1])*I[2*b],I[2*b+1]=O),K--)}}(Z,M),B(O,E,Z.bl_count)},e=function(Z,M,j){var K,b,g=-1,O=M[1],Q=0,Y=7,I=4;for(0===O&&(Y=138,I=3),M[2*(j+1)+1]=65535,K=0;K<=j;K++)b=O,O=M[2*(K+1)+1],++Q<Y&&b===O||(Q<I?Z.bl_tree[2*b]+=Q:0!==b?(b!==g&&Z.bl_tree[2*b]++,Z.bl_tree[32]++):Q<=10?Z.bl_tree[34]++:Z.bl_tree[36]++,Q=0,g=b,0===O?(Y=138,I=3):b===O?(Y=6,I=3):(Y=7,I=4))},u=function(Z,M,j){var K,b,g=-1,O=M[1],Q=0,Y=7,I=4;for(0===O&&(Y=138,I=3),K=0;K<=j;K++)if(b=O,O=M[2*(K+1)+1],!(++Q<Y&&b===O)){if(Q<I)do{q(Z,b,Z.bl_tree)}while(0!==--Q);else 0!==b?(b!==g&&(q(Z,b,Z.bl_tree),Q--),q(Z,16,Z.bl_tree),A(Z,Q-3,2)):Q<=10?(q(Z,17,Z.bl_tree),A(Z,Q-3,3)):(q(Z,18,Z.bl_tree),A(Z,Q-11,7));Q=0,g=b,0===O?(Y=138,I=3):b===O?(Y=6,I=3):(Y=7,I=4)}},F=!1,C=function(Z,M,j,K){A(Z,0+(K?1:0),3),function(Z,M,j,K){U(Z),K&&(W(Z,j),W(Z,~j)),Z.pending_buf.set(Z.window.subarray(M,M+j),Z.pending),Z.pending+=j}(Z,M,j,!0)};Z.exports._tr_init=function(Z){F||(!function(){var Z,M,j,I,X,d=new Array(16);for(j=0,I=0;I<28;I++)for(z[I]=j,Z=0;Z<1<<O[I];Z++)a[j++]=I;for(a[j-1]=I,X=0,I=0;I<16;I++)for(G[I]=X,Z=0;Z<1<<Q[I];Z++)i[X++]=I;for(X>>=7;I<b;I++)for(G[I]=X<<7,Z=0;Z<1<<Q[I]-7;Z++)i[256+X++]=I;for(M=0;M<=g;M++)d[M]=0;for(Z=0;Z<=143;)E[2*Z+1]=8,Z++,d[8]++;for(;Z<=255;)E[2*Z+1]=9,Z++,d[9]++;for(;Z<=279;)E[2*Z+1]=7,Z++,d[7]++;for(;Z<=287;)E[2*Z+1]=8,Z++,d[8]++;for(B(E,287,d),Z=0;Z<b;Z++)s[2*Z+1]=5,s[2*Z]=T(Z,5);V=new f(E,O,257,K,g),o=new f(s,Q,0,b,g),c=new f(new Array(0),Y,0,19,7)}(),F=!0),Z.l_desc=new X(Z.dyn_ltree,V),Z.d_desc=new X(Z.dyn_dtree,o),Z.bl_desc=new X(Z.bl_tree,c),Z.bi_buf=0,Z.bi_valid=0,N(Z)},Z.exports._tr_stored_block=C,Z.exports._tr_flush_block=function(Z,M,K,b){var g,O,Q=0;Z.level>0?(2===Z.strm.data_type&&(Z.strm.data_type=function(Z){var M,K=4093624447;for(M=0;M<=31;M++,K>>>=1)if(1&K&&0!==Z.dyn_ltree[2*M])return 0;if(0!==Z.dyn_ltree[18]||0!==Z.dyn_ltree[20]||0!==Z.dyn_ltree[26])return 1;for(M=32;M<j;M++)if(0!==Z.dyn_ltree[2*M])return 1;return 0}(Z)),R(Z,Z.l_desc),R(Z,Z.d_desc),Q=function(Z){var M;for(e(Z,Z.dyn_ltree,Z.l_desc.max_code),e(Z,Z.dyn_dtree,Z.d_desc.max_code),R(Z,Z.bl_desc),M=18;M>=3&&0===Z.bl_tree[2*I[M]+1];M--);return Z.opt_len+=3*(M+1)+5+5+4,M}(Z),g=Z.opt_len+3+7>>>3,(O=Z.static_len+3+7>>>3)<=g&&(g=O)):g=O=K+5,K+4<=g&&-1!==M?C(Z,M,K,b):4===Z.strategy||O===g?(A(Z,2+(b?1:0),3),x(Z,E,s)):(A(Z,4+(b?1:0),3),function(Z,M,j,K){var b;for(A(Z,M-257,5),A(Z,j-1,5),A(Z,K-4,4),b=0;b<K;b++)A(Z,Z.bl_tree[2*I[b]+1],3);u(Z,Z.dyn_ltree,M-1),u(Z,Z.dyn_dtree,j-1)}(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,Q+1),x(Z,Z.dyn_ltree,Z.dyn_dtree)),N(Z),b&&U(Z)},Z.exports._tr_tally=function(Z,M,K){return Z.pending_buf[Z.d_buf+2*Z.last_lit]=M>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&M,Z.pending_buf[Z.l_buf+Z.last_lit]=255&K,Z.last_lit++,0===M?Z.dyn_ltree[2*K]++:(Z.matches++,M--,Z.dyn_ltree[2*(a[K]+j+1)]++,Z.dyn_dtree[2*d(M)]++),Z.last_lit===Z.lit_bufsize-1},Z.exports._tr_align=function(Z){A(Z,2,3),q(Z,256,E),function(Z){16===Z.bi_valid?(W(Z,Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0):Z.bi_valid>=8&&(Z.pending_buf[Z.pending++]=255&Z.bi_buf,Z.bi_buf>>=8,Z.bi_valid-=8)}(Z)}},70400:function(Z){"use strict";Z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},53984:function(Z){function M(Z,M,j){for(var K=Z.length,b=-1/0,g=1/0,O=0;O<K;O++){var Q=(j[0][O]-Z[O])/M[O],Y=(j[1][O]-Z[O])/M[O];if(Q>Y){var I=Q;Q=Y,Y=I}if(Y<b||Q>g)return 1/0;Q>b&&(b=Q),Y<g&&(g=Y)}return b>g?1/0:b}Z.exports=function(Z,j,K,b){var g=M(j,K,b);if(g===1/0)Z=null;else{Z=Z||[];for(var O=0;O<j.length;O++)Z[O]=j[O]+K[O]*g}return Z},Z.exports.distance=M},95319:function(Z,M,j){"use strict";j.d(M,{e:function(){return g}});var K=j(47313),b=j(24898),g=function(Z){var M=(0,b.b)(Z);(0,K.useEffect)((function(){var Z=function(Z){var j;if(null!=M.current&&(j=M.current(Z)),Z.defaultPrevented&&(Z.returnValue=""),"string"===typeof j)return Z.returnValue=j,j};return window.addEventListener("beforeunload",Z),function(){window.removeEventListener("beforeunload",Z)}}),[])}},52796:function(Z,M,j){"use strict";var K=j(41065),b=Array.prototype.concat,g=Array.prototype.slice,O=Z.exports=function(Z){for(var M=[],j=0,O=Z.length;j<O;j++){var Q=Z[j];K(Q)?M=b.call(M,g.call(Q)):M.push(Q)}return M};O.wrap=function(Z){return function(){return Z(O(arguments))}}},41065:function(Z){Z.exports=function(Z){return!(!Z||"string"===typeof Z)&&(Z instanceof Array||Array.isArray(Z)||Z.length>=0&&(Z.splice instanceof Function||Object.getOwnPropertyDescriptor(Z,Z.length-1)&&"String"!==Z.constructor.name))}},85882:function(Z,M,j){var K=j(83895);function b(Z){for(var M,j,b=0,g=Z.length,O=0;O<Z.length;){for(M=Z[O],j=0;O<g&&Z[O]===M;)++O,++j;b+=K.log2(j)/7|0,b+=K.log2(M>>>0)/7|0,b+=2}return b}M.size=b,M.encode=function(Z,M){M||(M=new Uint8Array(b(Z)));for(var j,K,g=0,O=M.length,Q=0;Q<Z.length;){for(j=Z[Q],K=0;Q<Z.length&&Z[Q]===j;)++Q,++K;for(;g<O&&K>=128;)M[g++]=128+(127&K),K>>>=7;if(g>=O)throw new Error("RLE buffer overflow");for(M[g++]=K,j>>>=0;g<O&&j>=128;)M[g++]=128+(127&j),j>>>=7;if(g>=O)throw new Error("RLE buffer overflow");M[g++]=j}return M},M.decode=function(Z,M){for(var j,K,b,g,O=M.length,Q=Z.length,Y=0,I=0;I<Q;){for(j=0,K=0;I<Q&&Z[I]>=128;)j+=(127&Z[I++])<<K,K+=7;if(j+=Z[I++]<<K,I>=Q)throw new Error("RLE buffer underrun");if(Y+j>O)throw new Error("Chunk buffer overflow");for(b=0,K=0;I<Q&&Z[I]>=128;)b+=(127&Z[I++])<<K,K+=7;if(I>=Q)throw new Error("RLE buffer underrun");for(b+=Z[I++]<<K,g=0;g<j;++g)M[Y++]=b}return M}},83895:function(Z,M){"use strict";function j(Z){var M=32;return(Z&=-Z)&&M--,65535&Z&&(M-=16),16711935&Z&&(M-=8),252645135&Z&&(M-=4),858993459&Z&&(M-=2),1431655765&Z&&(M-=1),M}M.INT_BITS=32,M.INT_MAX=2147483647,M.INT_MIN=-1<<31,M.sign=function(Z){return(Z>0)-(Z<0)},M.abs=function(Z){var M=Z>>31;return(Z^M)-M},M.min=function(Z,M){return M^(Z^M)&-(Z<M)},M.max=function(Z,M){return Z^(Z^M)&-(Z<M)},M.isPow2=function(Z){return!(Z&Z-1)&&!!Z},M.log2=function(Z){var M,j;return M=(Z>65535)<<4,M|=j=((Z>>>=M)>255)<<3,M|=j=((Z>>>=j)>15)<<2,(M|=j=((Z>>>=j)>3)<<1)|(Z>>>=j)>>1},M.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},M.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},M.countTrailingZeros=j,M.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},M.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},M.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var K=new Array(256);!function(Z){for(var M=0;M<256;++M){var j=M,K=M,b=7;for(j>>>=1;j;j>>>=1)K<<=1,K|=1&j,--b;Z[M]=K<<b&255}}(K),M.reverse=function(Z){return K[255&Z]<<24|K[Z>>>8&255]<<16|K[Z>>>16&255]<<8|K[Z>>>24&255]},M.interleave2=function(Z,M){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))<<1},M.deinterleave2=function(Z,M){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>M&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},M.interleave3=function(Z,M,j){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2))<<1)|(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<2},M.deinterleave3=function(Z,M){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>M&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},M.nextCombination=function(Z){var M=Z|Z-1;return M+1|(~M&-~M)-1>>>j(Z)+1}},20477:function(Z){"use strict";Z.exports=function(Z,M,j,K){var b=self||window;try{try{var g;try{g=new b.Blob([Z])}catch(M){(g=new(b.BlobBuilder||b.WebKitBlobBuilder||b.MozBlobBuilder||b.MSBlobBuilder)).append(Z),g=g.getBlob()}var O=b.URL||b.webkitURL,Q=O.createObjectURL(g),Y=new b[M](Q,j);return O.revokeObjectURL(Q),Y}catch(K){return new b[M]("data:application/javascript,".concat(encodeURIComponent(Z)),j)}}catch(Z){if(!K)throw Error("Inline worker is not supported");return new b[M](K,j)}}},53229:function(Z,M,j){"use strict";function K(Z,M,j,K,b){var g={};return Object.keys(K).forEach((function(Z){g[Z]=K[Z]})),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=j.slice().reverse().reduce((function(j,K){return K(Z,M,j)||j}),g),b&&void 0!==g.initializer&&(g.value=g.initializer?g.initializer.call(b):void 0,g.initializer=void 0),void 0===g.initializer&&(Object.defineProperty(Z,M,g),g=null),g}j.d(M,{e:function(){return K}})},11752:function(Z,M,j){"use strict";j.d(M,{d:function(){return g}});var K=j(61120);function b(Z,M){for(;!Object.prototype.hasOwnProperty.call(Z,M)&&null!==(Z=(0,K.d)(Z)););return Z}function g(){return g="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(Z,M,j){var K=b(Z,M);if(K){var g=Object.getOwnPropertyDescriptor(K,M);return g.get?g.get.call(arguments.length<3?Z:j):g.value}},g.apply(this,arguments)}},43269:function(Z,M,j){"use strict";function K(Z,M,j,K){j&&Object.defineProperty(Z,M,{enumerable:j.enumerable,configurable:j.configurable,writable:j.writable,value:j.initializer?j.initializer.call(K):void 0})}j.d(M,{e:function(){return K}})},21664:function(Z,M,j){"use strict";j.d(M,{c:function(){return a}});var K=j(80105),b=j(9488),g=j(96658),O=j(9892),Q=j(31709),Y=j(25488),I=j(7686),E=j(74134),s=j(2111),i=j(67935),a=function(){function Z(M,j,K,b,g,O){this.name=M,this.targetProperty=j,this.framePerSecond=K,this.dataType=b,this.loopMode=g,this.enableBlending=O,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=j.split("."),this.dataType=b,this.loopMode=void 0===g?Z.ANIMATIONLOOPMODE_CYCLE:g,this.uniqueId=Z._UniqueIdGenerator++}return Z._PrepareAnimation=function(M,j,g,O,Q,Y,I,E){var i=void 0;if(!isNaN(parseFloat(Q))&&isFinite(Q)?i=Z.ANIMATIONTYPE_FLOAT:Q instanceof K.d?i=Z.ANIMATIONTYPE_QUATERNION:Q instanceof K.k?i=Z.ANIMATIONTYPE_VECTOR3:Q instanceof K.h?i=Z.ANIMATIONTYPE_VECTOR2:Q instanceof b.e?i=Z.ANIMATIONTYPE_COLOR3:Q instanceof b.g?i=Z.ANIMATIONTYPE_COLOR4:Q instanceof s.b&&(i=Z.ANIMATIONTYPE_SIZE),void 0==i)return null;var a=new Z(M,j,g,i,I),z=[{frame:0,value:Q},{frame:O,value:Y}];return a.setKeys(z),void 0!==E&&a.setEasingFunction(E),a},Z.CreateAnimation=function(M,j,K,b){var g=new Z(M+"Animation",M,K,j,Z.ANIMATIONLOOPMODE_CONSTANT);return g.setEasingFunction(b),g},Z.CreateAndStartAnimation=function(M,j,K,b,g,O,Q,Y,I,E,s){var i=Z._PrepareAnimation(M,K,b,g,O,Q,Y,I);return i?(j.getScene&&(s=j.getScene()),s?s.beginDirectAnimation(j,[i],0,g,1===i.loopMode,1,E):null):null},Z.CreateAndStartHierarchyAnimation=function(M,j,K,b,g,O,Q,Y,I,E,s){var i=Z._PrepareAnimation(M,b,g,O,Q,Y,I,E);return i?j.getScene().beginDirectHierarchyAnimation(j,K,[i],0,O,1===i.loopMode,1,s):null},Z.CreateMergeAndStartAnimation=function(M,j,K,b,g,O,Q,Y,I,E){var s=Z._PrepareAnimation(M,K,b,g,O,Q,Y,I);return s?(j.animations.push(s),j.getScene().beginAnimation(j,0,g,1===s.loopMode,1,E)):null},Z.MakeAnimationAdditive=function(M,j,b,g,O){void 0===j&&(j=0),void 0===g&&(g=!1);var Q=M;if(g&&((Q=M.clone()).name=O||Q.name),!Q._keys.length)return Q;j=j>=0?j:0;var Y=0,I=Q._keys[0],E=Q._keys.length-1,s=Q._keys[E],i={referenceValue:I.value,referencePosition:K.e.Vector3[0],referenceQuaternion:K.e.Quaternion[0],referenceScaling:K.e.Vector3[1],keyPosition:K.e.Vector3[2],keyQuaternion:K.e.Quaternion[1],keyScaling:K.e.Vector3[3]},a=!1,z=I.frame,V=s.frame;if(b){var o=Q.getRange(b);o&&(z=o.from,V=o.to)}var c=I.frame===z,G=s.frame===V;if(1===Q._keys.length){var f=Q._getKeyValue(Q._keys[0]);i.referenceValue=f.clone?f.clone():f,a=!0}else if(j<=I.frame){f=Q._getKeyValue(I.value);i.referenceValue=f.clone?f.clone():f,a=!0}else if(j>=s.frame){f=Q._getKeyValue(s.value);i.referenceValue=f.clone?f.clone():f,a=!0}for(var X=0;!a||!c||!G&&X<Q._keys.length-1;){var d=Q._keys[X],W=Q._keys[X+1];if(!a&&j>=d.frame&&j<=W.frame){f=void 0;if(j===d.frame)f=Q._getKeyValue(d.value);else if(j===W.frame)f=Q._getKeyValue(W.value);else{var A={key:X,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};f=Q._interpolate(j,A)}i.referenceValue=f.clone?f.clone():f,a=!0}if(!c&&z>=d.frame&&z<=W.frame){if(z===d.frame)Y=X;else if(z===W.frame)Y=X+1;else{A={key:X,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};var q={frame:z,value:(f=Q._interpolate(z,A)).clone?f.clone():f};Q._keys.splice(X+1,0,q),Y=X+1}c=!0}if(!G&&V>=d.frame&&V<=W.frame){if(V===d.frame)E=X;else if(V===W.frame)E=X+1;else{A={key:X,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},q={frame:V,value:(f=Q._interpolate(V,A)).clone?f.clone():f};Q._keys.splice(X+1,0,q),E=X+1}G=!0}X++}for(Q.dataType===Z.ANIMATIONTYPE_QUATERNION?i.referenceValue.normalize().conjugateInPlace():Q.dataType===Z.ANIMATIONTYPE_MATRIX&&(i.referenceValue.decompose(i.referenceScaling,i.referenceQuaternion,i.referencePosition),i.referenceQuaternion.normalize().conjugateInPlace()),X=Y;X<=E;X++){q=Q._keys[X];if(!X||Q.dataType===Z.ANIMATIONTYPE_FLOAT||q.value!==I.value)switch(Q.dataType){case Z.ANIMATIONTYPE_MATRIX:q.value.decompose(i.keyScaling,i.keyQuaternion,i.keyPosition),i.keyPosition.subtractInPlace(i.referencePosition),i.keyScaling.divideInPlace(i.referenceScaling),i.referenceQuaternion.multiplyToRef(i.keyQuaternion,i.keyQuaternion),K.c.ComposeToRef(i.keyScaling,i.keyQuaternion,i.keyPosition,q.value);break;case Z.ANIMATIONTYPE_QUATERNION:i.referenceValue.multiplyToRef(q.value,q.value);break;case Z.ANIMATIONTYPE_VECTOR2:case Z.ANIMATIONTYPE_VECTOR3:case Z.ANIMATIONTYPE_COLOR3:case Z.ANIMATIONTYPE_COLOR4:q.value.subtractToRef(i.referenceValue,q.value);break;case Z.ANIMATIONTYPE_SIZE:q.value.width-=i.referenceValue.width,q.value.height-=i.referenceValue.height;break;default:q.value-=i.referenceValue}}return Q},Z.TransitionTo=function(Z,M,j,K,b,g,O,Q){if(void 0===Q&&(Q=null),O<=0)return j[Z]=M,Q&&Q(),null;var Y=b*(O/1e3);g.setKeys([{frame:0,value:j[Z].clone?j[Z].clone():j[Z]},{frame:Y,value:M}]),j.animations||(j.animations=[]),j.animations.push(g);var I=K.beginAnimation(j,0,Y,!1);return I.onAnimationEnd=Q,I},Object.defineProperty(Z.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var Z=0,M=this._runtimeAnimations;Z<M.length;Z++){if(!M[Z].isStopped())return!0}return!1},enumerable:!1,configurable:!0}),Z.prototype.toString=function(Z){var M="Name: "+this.name+", property: "+this.targetProperty;if(M+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],M+=", nKeys: "+(this._keys?this._keys.length:"none"),M+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),Z){M+=", Ranges: {";var j=!0;for(var K in this._ranges)j&&(M+=", ",j=!1),M+=K;M+="}"}return M},Z.prototype.addEvent=function(Z){this._events.push(Z),this._events.sort((function(Z,M){return Z.frame-M.frame}))},Z.prototype.removeEvents=function(Z){for(var M=0;M<this._events.length;M++)this._events[M].frame===Z&&(this._events.splice(M,1),M--)},Z.prototype.getEvents=function(){return this._events},Z.prototype.createRange=function(Z,M,j){this._ranges[Z]||(this._ranges[Z]=new I.c(Z,M,j))},Z.prototype.deleteRange=function(Z,M){void 0===M&&(M=!0);var j=this._ranges[Z];if(j){if(M)for(var K=j.from,b=j.to,g=this._keys.length-1;g>=0;g--)this._keys[g].frame>=K&&this._keys[g].frame<=b&&this._keys.splice(g,1);this._ranges[Z]=null}},Z.prototype.getRange=function(Z){return this._ranges[Z]},Z.prototype.getKeys=function(){return this._keys},Z.prototype.getHighestFrame=function(){for(var Z=0,M=0,j=this._keys.length;M<j;M++)Z<this._keys[M].frame&&(Z=this._keys[M].frame);return Z},Z.prototype.getEasingFunction=function(){return this._easingFunction},Z.prototype.setEasingFunction=function(Z){this._easingFunction=Z},Z.prototype.floatInterpolateFunction=function(Z,M,j){return g.b.Lerp(Z,M,j)},Z.prototype.floatInterpolateFunctionWithTangents=function(Z,M,j,K,b){return g.b.Hermite(Z,M,j,K,b)},Z.prototype.quaternionInterpolateFunction=function(Z,M,j){return K.d.Slerp(Z,M,j)},Z.prototype.quaternionInterpolateFunctionWithTangents=function(Z,M,j,b,g){return K.d.Hermite(Z,M,j,b,g).normalize()},Z.prototype.vector3InterpolateFunction=function(Z,M,j){return K.k.Lerp(Z,M,j)},Z.prototype.vector3InterpolateFunctionWithTangents=function(Z,M,j,b,g){return K.k.Hermite(Z,M,j,b,g)},Z.prototype.vector2InterpolateFunction=function(Z,M,j){return K.h.Lerp(Z,M,j)},Z.prototype.vector2InterpolateFunctionWithTangents=function(Z,M,j,b,g){return K.h.Hermite(Z,M,j,b,g)},Z.prototype.sizeInterpolateFunction=function(Z,M,j){return s.b.Lerp(Z,M,j)},Z.prototype.color3InterpolateFunction=function(Z,M,j){return b.e.Lerp(Z,M,j)},Z.prototype.color3InterpolateFunctionWithTangents=function(Z,M,j,K,g){return b.e.Hermite(Z,M,j,K,g)},Z.prototype.color4InterpolateFunction=function(Z,M,j){return b.g.Lerp(Z,M,j)},Z.prototype.color4InterpolateFunctionWithTangents=function(Z,M,j,K,g){return b.g.Hermite(Z,M,j,K,g)},Z.prototype._getKeyValue=function(Z){return"function"===typeof Z?Z():Z},Z.prototype.evaluate=function(M){return this._interpolate(M,{key:0,repeatCount:0,loopMode:Z.ANIMATIONLOOPMODE_CONSTANT})},Z.prototype._interpolate=function(M,j){if(j.loopMode===Z.ANIMATIONLOOPMODE_CONSTANT&&j.repeatCount>0)return j.highLimitValue.clone?j.highLimitValue.clone():j.highLimitValue;var K=this._keys;if(1===K.length)return this._getKeyValue(K[0].value);var b=j.key;if(K[b].frame>=M)for(;b-1>=0&&K[b].frame>=M;)b--;for(var g=b;g<K.length-1;g++){var O=K[g+1];if(O.frame>=M){j.key=g;var Q=K[g],I=this._getKeyValue(Q.value),E=this._getKeyValue(O.value);if(Q.interpolation===Y.d.STEP)return O.frame>M?I:E;var s=void 0!==Q.outTangent&&void 0!==O.inTangent,i=O.frame-Q.frame,a=(M-Q.frame)/i,z=this.getEasingFunction();switch(null!==z&&(a=z.ease(a)),this.dataType){case Z.ANIMATIONTYPE_FLOAT:var V=s?this.floatInterpolateFunctionWithTangents(I,Q.outTangent*i,E,O.inTangent*i,a):this.floatInterpolateFunction(I,E,a);switch(j.loopMode){case Z.ANIMATIONLOOPMODE_CYCLE:case Z.ANIMATIONLOOPMODE_CONSTANT:return V;case Z.ANIMATIONLOOPMODE_RELATIVE:return j.offsetValue*j.repeatCount+V}break;case Z.ANIMATIONTYPE_QUATERNION:var o=s?this.quaternionInterpolateFunctionWithTangents(I,Q.outTangent.scale(i),E,O.inTangent.scale(i),a):this.quaternionInterpolateFunction(I,E,a);switch(j.loopMode){case Z.ANIMATIONLOOPMODE_CYCLE:case Z.ANIMATIONLOOPMODE_CONSTANT:return o;case Z.ANIMATIONLOOPMODE_RELATIVE:return o.addInPlace(j.offsetValue.scale(j.repeatCount))}return o;case Z.ANIMATIONTYPE_VECTOR3:var c=s?this.vector3InterpolateFunctionWithTangents(I,Q.outTangent.scale(i),E,O.inTangent.scale(i),a):this.vector3InterpolateFunction(I,E,a);switch(j.loopMode){case Z.ANIMATIONLOOPMODE_CYCLE:case Z.ANIMATIONLOOPMODE_CONSTANT:return c;case Z.ANIMATIONLOOPMODE_RELATIVE:return c.add(j.offsetValue.scale(j.repeatCount))}break;case Z.ANIMATIONTYPE_VECTOR2:var G=s?this.vector2InterpolateFunctionWithTangents(I,Q.outTangent.scale(i),E,O.inTangent.scale(i),a):this.vector2InterpolateFunction(I,E,a);switch(j.loopMode){case Z.ANIMATIONLOOPMODE_CYCLE:case Z.ANIMATIONLOOPMODE_CONSTANT:return G;case Z.ANIMATIONLOOPMODE_RELATIVE:return G.add(j.offsetValue.scale(j.repeatCount))}break;case Z.ANIMATIONTYPE_SIZE:switch(j.loopMode){case Z.ANIMATIONLOOPMODE_CYCLE:case Z.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(I,E,a);case Z.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(I,E,a).add(j.offsetValue.scale(j.repeatCount))}break;case Z.ANIMATIONTYPE_COLOR3:var f=s?this.color3InterpolateFunctionWithTangents(I,Q.outTangent.scale(i),E,O.inTangent.scale(i),a):this.color3InterpolateFunction(I,E,a);switch(j.loopMode){case Z.ANIMATIONLOOPMODE_CYCLE:case Z.ANIMATIONLOOPMODE_CONSTANT:return f;case Z.ANIMATIONLOOPMODE_RELATIVE:return f.add(j.offsetValue.scale(j.repeatCount))}break;case Z.ANIMATIONTYPE_COLOR4:var X=s?this.color4InterpolateFunctionWithTangents(I,Q.outTangent.scale(i),E,O.inTangent.scale(i),a):this.color4InterpolateFunction(I,E,a);switch(j.loopMode){case Z.ANIMATIONLOOPMODE_CYCLE:case Z.ANIMATIONLOOPMODE_CONSTANT:return X;case Z.ANIMATIONLOOPMODE_RELATIVE:return X.add(j.offsetValue.scale(j.repeatCount))}break;case Z.ANIMATIONTYPE_MATRIX:switch(j.loopMode){case Z.ANIMATIONLOOPMODE_CYCLE:case Z.ANIMATIONLOOPMODE_CONSTANT:return Z.AllowMatricesInterpolation?this.matrixInterpolateFunction(I,E,a,j.workValue):I;case Z.ANIMATIONLOOPMODE_RELATIVE:return I}}break}}return this._getKeyValue(K[K.length-1].value)},Z.prototype.matrixInterpolateFunction=function(M,j,b,g){return Z.AllowMatrixDecomposeForInterpolation?g?(K.c.DecomposeLerpToRef(M,j,b,g),g):K.c.DecomposeLerp(M,j,b):g?(K.c.LerpToRef(M,j,b,g),g):K.c.Lerp(M,j,b)},Z.prototype.clone=function(){var M=new Z(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(M.enableBlending=this.enableBlending,M.blendingSpeed=this.blendingSpeed,this._keys&&M.setKeys(this._keys),this._ranges)for(var j in M._ranges={},this._ranges){var K=this._ranges[j];K&&(M._ranges[j]=K.clone())}return M},Z.prototype.setKeys=function(Z){this._keys=Z.slice(0)},Z.prototype.serialize=function(){var M={};M.name=this.name,M.property=this.targetProperty,M.framePerSecond=this.framePerSecond,M.dataType=this.dataType,M.loopBehavior=this.loopMode,M.enableBlending=this.enableBlending,M.blendingSpeed=this.blendingSpeed;var j=this.dataType;M.keys=[];for(var K=this.getKeys(),b=0;b<K.length;b++){var g=K[b],O={};switch(O.frame=g.frame,j){case Z.ANIMATIONTYPE_FLOAT:O.values=[g.value],void 0!==g.inTangent&&O.values.push(g.inTangent),void 0!==g.outTangent&&(void 0===g.inTangent&&O.values.push(void 0),O.values.push(g.outTangent)),void 0!==g.interpolation&&(void 0===g.inTangent&&O.values.push(void 0),void 0===g.outTangent&&O.values.push(void 0),O.values.push(g.interpolation));break;case Z.ANIMATIONTYPE_QUATERNION:case Z.ANIMATIONTYPE_MATRIX:case Z.ANIMATIONTYPE_VECTOR3:case Z.ANIMATIONTYPE_COLOR3:case Z.ANIMATIONTYPE_COLOR4:O.values=g.value.asArray(),void 0!=g.inTangent&&O.values.push(g.inTangent.asArray()),void 0!=g.outTangent&&(void 0===g.inTangent&&O.values.push(void 0),O.values.push(g.outTangent.asArray())),void 0!==g.interpolation&&(void 0===g.inTangent&&O.values.push(void 0),void 0===g.outTangent&&O.values.push(void 0),O.values.push(g.interpolation))}M.keys.push(O)}for(var Q in M.ranges=[],this._ranges){var Y=this._ranges[Q];if(Y){var I={};I.name=Q,I.from=Y.from,I.to=Y.to,M.ranges.push(I)}}return M},Z._UniversalLerp=function(Z,M,j){var K=Z.constructor;return K.Lerp?K.Lerp(Z,M,j):K.Slerp?K.Slerp(Z,M,j):Z.toFixed?Z*(1-j)+j*M:M},Z.Parse=function(M){var j,g,O=new Z(M.name,M.property,M.framePerSecond,M.dataType,M.loopBehavior),Q=M.dataType,Y=[];for(M.enableBlending&&(O.enableBlending=M.enableBlending),M.blendingSpeed&&(O.blendingSpeed=M.blendingSpeed),g=0;g<M.keys.length;g++){var I=M.keys[g],E=void 0,s=void 0,i=void 0;switch(Q){case Z.ANIMATIONTYPE_FLOAT:j=I.values[0],I.values.length>=2&&(E=I.values[1]),I.values.length>=3&&(s=I.values[2]),I.values.length>=4&&(i=I.values[3]);break;case Z.ANIMATIONTYPE_QUATERNION:if(j=K.d.FromArray(I.values),I.values.length>=8){var a=K.d.FromArray(I.values.slice(4,8));a.equals(K.d.Zero())||(E=a)}if(I.values.length>=12){var z=K.d.FromArray(I.values.slice(8,12));z.equals(K.d.Zero())||(s=z)}I.values.length>=13&&(i=I.values[12]);break;case Z.ANIMATIONTYPE_MATRIX:j=K.c.FromArray(I.values),I.values.length>=17&&(i=I.values[16]);break;case Z.ANIMATIONTYPE_COLOR3:j=b.e.FromArray(I.values),I.values[3]&&(E=b.e.FromArray(I.values[3])),I.values[4]&&(s=b.e.FromArray(I.values[4])),I.values[5]&&(i=I.values[5]);break;case Z.ANIMATIONTYPE_COLOR4:j=b.g.FromArray(I.values),I.values[4]&&(E=b.g.FromArray(I.values[4])),I.values[5]&&(s=b.g.FromArray(I.values[5])),I.values[6]&&(i=b.g.FromArray(I.values[6]));break;case Z.ANIMATIONTYPE_VECTOR3:default:j=K.k.FromArray(I.values),I.values[3]&&(E=K.k.FromArray(I.values[3])),I.values[4]&&(s=K.k.FromArray(I.values[4])),I.values[5]&&(i=I.values[5])}var V={};V.frame=I.frame,V.value=j,void 0!=E&&(V.inTangent=E),void 0!=s&&(V.outTangent=s),void 0!=i&&(V.interpolation=i),Y.push(V)}if(O.setKeys(Y),M.ranges)for(g=0;g<M.ranges.length;g++)j=M.ranges[g],O.createRange(j.name,j.from,j.to);return O},Z.AppendSerializedAnimations=function(Z,M){O.b.AppendSerializedAnimations(Z,M)},Z.ParseFromFileAsync=function(Z,M){var j=this;return new Promise((function(K,b){var g=new i.e;g.addEventListener("readystatechange",(function(){if(4==g.readyState)if(200==g.status){var M=JSON.parse(g.responseText);if(M.animations&&(M=M.animations),M.length){for(var O=new Array,Q=0,Y=M;Q<Y.length;Q++){var I=Y[Q];O.push(j.Parse(I))}K(O)}else{O=j.Parse(M);Z&&(O.name=Z),K(O)}}else b("Unable to load the animation")})),g.open("GET",M),g.send()}))},Z.CreateFromSnippetAsync=function(Z){var M=this;return new Promise((function(j,K){var b=new i.e;b.addEventListener("readystatechange",(function(){if(4==b.readyState)if(200==b.status){var g=JSON.parse(JSON.parse(b.responseText).jsonPayload);if(g.animations){for(var O=JSON.parse(g.animations),Q=new Array,Y=0,I=O.animations;Y<I.length;Y++){var E=I[Y];(s=M.Parse(E)).snippetId=Z,Q.push(s)}j(Q)}else{var s;O=JSON.parse(g.animation);(s=M.Parse(O)).snippetId=Z,j(s)}}else K("Unable to load the snippet "+Z)})),b.open("GET",M.SnippetUrl+"/"+Z.replace(/#/g,"/")),b.send()}))},Z._UniqueIdGenerator=0,Z.AllowMatricesInterpolation=!1,Z.AllowMatrixDecomposeForInterpolation=!0,Z.SnippetUrl="https://snippet.babylonjs.com",Z.ANIMATIONTYPE_FLOAT=0,Z.ANIMATIONTYPE_VECTOR3=1,Z.ANIMATIONTYPE_QUATERNION=2,Z.ANIMATIONTYPE_MATRIX=3,Z.ANIMATIONTYPE_COLOR3=4,Z.ANIMATIONTYPE_COLOR4=7,Z.ANIMATIONTYPE_VECTOR2=5,Z.ANIMATIONTYPE_SIZE=6,Z.ANIMATIONLOOPMODE_RELATIVE=0,Z.ANIMATIONLOOPMODE_CYCLE=1,Z.ANIMATIONLOOPMODE_CONSTANT=2,Z}();(0,Q.c)("BABYLON.Animation",a),E.b._AnimationRangeFactory=function(Z,M,j){return new I.c(Z,M,j)}},25488:function(Z,M,j){"use strict";var K;j.d(M,{d:function(){return K}}),function(Z){Z[Z.NONE=0]="NONE",Z[Z.STEP=1]="STEP"}(K||(K={}))},7686:function(Z,M,j){"use strict";j.d(M,{c:function(){return K}});var K=function(){function Z(Z,M,j){this.name=Z,this.from=M,this.to=j}return Z.prototype.clone=function(){return new Z(this.name,this.from,this.to)},Z}()},43251:function(Z,M,j){"use strict";j.d(M,{e:function(){return b},f:function(){return g}});var K=j(82419),b=function(){function Z(Z,M,j,b,g,O,Q,Y){void 0===b&&(b=0),void 0===g&&(g=!1),void 0===O&&(O=!1),void 0===Q&&(Q=!1),this._isAlreadyOwned=!1,Z.getScene?this._engine=Z.getScene().getEngine():this._engine=Z,this._updatable=j,this._instanced=O,this._divisor=Y||1,M instanceof K.e?(this._data=null,this._buffer=M):(this._data=M,this._buffer=null),this.byteStride=Q?b:b*Float32Array.BYTES_PER_ELEMENT,g||this.create()}return Z.prototype.createVertexBuffer=function(Z,M,j,K,b,O,Q){void 0===O&&(O=!1);var Y=O?M:M*Float32Array.BYTES_PER_ELEMENT,I=K?O?K:K*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new g(this._engine,this,Z,this._updatable,!0,I,void 0===b?this._instanced:b,Y,j,void 0,void 0,!0,this._divisor||Q)},Z.prototype.isUpdatable=function(){return this._updatable},Z.prototype.getData=function(){return this._data},Z.prototype.getBuffer=function(){return this._buffer},Z.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},Z.prototype.create=function(Z){void 0===Z&&(Z=null),!Z&&this._buffer||(Z=Z||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Z),this._data=Z):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(Z),this._data=Z):this._buffer=this._engine.createVertexBuffer(Z))},Z.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},Z.prototype.update=function(Z){this.create(Z)},Z.prototype.updateDirectly=function(Z,M,j,K){void 0===K&&(K=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Z,K?M:M*Float32Array.BYTES_PER_ELEMENT,j?j*this.byteStride:void 0),this._data=0===M&&void 0===j?Z:null)},Z.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},Z.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)},Z}(),g=function(){function Z(M,j,K,g,O,Q,Y,I,E,s,i,a,z,V){if(void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===z&&(z=1),void 0===V&&(V=!1),j instanceof b?(this._buffer=j,this._ownsBuffer=V):(this._buffer=new b(M,j,g,Q,O,Y,a),this._ownsBuffer=!0),this.uniqueId=Z._Counter++,this._kind=K,void 0==s){var o=this.getData();this.type=Z.FLOAT,o instanceof Int8Array?this.type=Z.BYTE:o instanceof Uint8Array?this.type=Z.UNSIGNED_BYTE:o instanceof Int16Array?this.type=Z.SHORT:o instanceof Uint16Array?this.type=Z.UNSIGNED_SHORT:o instanceof Int32Array?this.type=Z.INT:o instanceof Uint32Array&&(this.type=Z.UNSIGNED_INT)}else this.type=s;var c=Z.GetTypeByteLength(this.type);a?(this._size=E||(Q?Q/c:Z.DeduceStride(K)),this.byteStride=Q||this._buffer.byteStride||this._size*c,this.byteOffset=I||0):(this._size=E||Q||Z.DeduceStride(K),this.byteStride=Q?Q*c:this._buffer.byteStride||this._size*c,this.byteOffset=(I||0)*c),this.normalized=i,this._instanced=void 0!==Y&&Y,this._instanceDivisor=Y?z:0,this._computeHashCode()}return Object.defineProperty(Z.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(Z){this._instanceDivisor=Z,this._instanced=0!=Z,this._computeHashCode()},enumerable:!1,configurable:!0}),Z.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},Z.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},Z.prototype.getKind=function(){return this._kind},Z.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},Z.prototype.getData=function(){return this._buffer.getData()},Z.prototype.getFloatData=function(M,j){var K=this.getData();if(!K)return null;var b=this.getSize()*Z.GetTypeByteLength(this.type),g=M*this.getSize();if(this.type!==Z.FLOAT||this.byteStride!==b){var O=new Float32Array(g);return this.forEach(g,(function(Z,M){return O[M]=Z})),O}if(!(K instanceof Array||K instanceof Float32Array)||0!==this.byteOffset||K.length!==g){if(K instanceof Array){var Q=this.byteOffset/4;return K.slice(Q,Q+g)}if(K instanceof ArrayBuffer)return new Float32Array(K,this.byteOffset,g);Q=K.byteOffset+this.byteOffset;if(j){var Y=new Float32Array(g),I=new Float32Array(K.buffer,Q,g);return Y.set(I),Y}var E=Q%4;return E&&(Q=Math.max(0,Q-E)),new Float32Array(K.buffer,Q,g)}return j?K.slice():K},Z.prototype.getBuffer=function(){return this._buffer.getBuffer()},Z.prototype.getStrideSize=function(){return this.byteStride/Z.GetTypeByteLength(this.type)},Z.prototype.getOffset=function(){return this.byteOffset/Z.GetTypeByteLength(this.type)},Z.prototype.getSize=function(M){return void 0===M&&(M=!1),M?this._size*Z.GetTypeByteLength(this.type):this._size},Z.prototype.getIsInstanced=function(){return this._instanced},Z.prototype.getInstanceDivisor=function(){return this._instanceDivisor},Z.prototype.create=function(Z){this._buffer.create(Z)},Z.prototype.update=function(Z){this._buffer.update(Z)},Z.prototype.updateDirectly=function(Z,M,j){void 0===j&&(j=!1),this._buffer.updateDirectly(Z,M,void 0,j)},Z.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},Z.prototype.forEach=function(M,j){Z.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,M,this.normalized,j)},Z.DeduceStride=function(M){switch(M){case Z.UVKind:case Z.UV2Kind:case Z.UV3Kind:case Z.UV4Kind:case Z.UV5Kind:case Z.UV6Kind:return 2;case Z.NormalKind:case Z.PositionKind:return 3;case Z.ColorKind:case Z.MatricesIndicesKind:case Z.MatricesIndicesExtraKind:case Z.MatricesWeightsKind:case Z.MatricesWeightsExtraKind:case Z.TangentKind:return 4;default:throw new Error("Invalid kind '"+M+"'")}},Z.GetTypeByteLength=function(M){switch(M){case Z.BYTE:case Z.UNSIGNED_BYTE:return 1;case Z.SHORT:case Z.UNSIGNED_SHORT:return 2;case Z.INT:case Z.UNSIGNED_INT:case Z.FLOAT:return 4;default:throw new Error("Invalid type '".concat(M,"'"))}},Z.ForEach=function(M,j,K,b,g,O,Q,Y){if(M instanceof Array)for(var I=j/4,E=K/4,s=0;s<O;s+=b){for(var i=0;i<b;i++)Y(M[I+i],s+i);I+=E}else{var a=M instanceof ArrayBuffer?new DataView(M):new DataView(M.buffer,M.byteOffset,M.byteLength),z=Z.GetTypeByteLength(g);for(s=0;s<O;s+=b){var V=j;for(i=0;i<b;i++){Y(Z._GetFloatValue(a,g,V,Q),s+i),V+=z}j+=K}}},Z._GetFloatValue=function(M,j,K,b){switch(j){case Z.BYTE:var g=M.getInt8(K);return b&&(g=Math.max(g/127,-1)),g;case Z.UNSIGNED_BYTE:g=M.getUint8(K);return b&&(g/=255),g;case Z.SHORT:g=M.getInt16(K,!0);return b&&(g=Math.max(g/32767,-1)),g;case Z.UNSIGNED_SHORT:g=M.getUint16(K,!0);return b&&(g/=65535),g;case Z.INT:return M.getInt32(K,!0);case Z.UNSIGNED_INT:return M.getUint32(K,!0);case Z.FLOAT:return M.getFloat32(K,!0);default:throw new Error("Invalid component type ".concat(j))}},Z._Counter=0,Z.BYTE=5120,Z.UNSIGNED_BYTE=5121,Z.SHORT=5122,Z.UNSIGNED_SHORT=5123,Z.INT=5124,Z.UNSIGNED_INT=5125,Z.FLOAT=5126,Z.PositionKind="position",Z.NormalKind="normal",Z.TangentKind="tangent",Z.UVKind="uv",Z.UV2Kind="uv2",Z.UV3Kind="uv3",Z.UV4Kind="uv4",Z.UV5Kind="uv5",Z.UV6Kind="uv6",Z.ColorKind="color",Z.ColorInstanceKind="instanceColor",Z.MatricesIndicesKind="matricesIndices",Z.MatricesWeightsKind="matricesWeights",Z.MatricesIndicesExtraKind="matricesIndicesExtra",Z.MatricesWeightsExtraKind="matricesWeightsExtra",Z}()},82419:function(Z,M,j){"use strict";j.d(M,{e:function(){return K}});var K=function(){function Z(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=Z._Counter++}return Object.defineProperty(Z.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),Z._Counter=0,Z}()},4268:function(Z,M,j){"use strict";j.d(M,{d:function(){return e}});var K=j(40061),b=j(9892),g=j(9271),O=j(80105),Q=j(74134),Y=j(65847),I=j(25239),E=j(19500),s=j(61686),i=function(){function Z(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(Z.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(Z){this._zoomStopsAnimation=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(Z){this._idleRotationSpeed=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(Z){this._idleRotationWaitTime=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(Z){this._idleRotationSpinupTime=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!1,configurable:!0}),Z.prototype.init=function(){},Z.prototype.attach=function(Z){var M=this;this._attachedCamera=Z;var j=this._attachedCamera.getScene();this._onPrePointerObservableObserver=j.onPrePointerObservable.add((function(Z){Z.type!==I.d.POINTERDOWN?Z.type===I.d.POINTERUP&&(M._isPointerDown=!1):M._isPointerDown=!0})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((function(){if(!M._reachTargetAlpha()){var Z=E.c.Now,j=0;null!=M._lastFrameTime&&(j=Z-M._lastFrameTime),M._lastFrameTime=Z,M._applyUserInteraction();var K=Z-M._lastInteractionTime-M._idleRotationWaitTime,b=Math.max(Math.min(K/M._idleRotationSpinupTime,1),0);M._cameraRotationSpeed=M._idleRotationSpeed*b,M._attachedCamera&&(M._attachedCamera.alpha-=M._cameraRotationSpeed*(j/1e3))}}))},Z.prototype.detach=function(){if(this._attachedCamera){var Z=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},Z.prototype.resetLastInteractionTime=function(Z){this._lastInteractionTime=null!==Z&&void 0!==Z?Z:E.c.Now},Z.prototype._reachTargetAlpha=function(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<s.e},Z.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},Z.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var Z=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(Z=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?Z:this._userIsZooming()},Z.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=E.c.Now)},Z.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},Z}(),a=j(12476),z=function(){function Z(){this._easingMode=Z.EASINGMODE_EASEIN}return Z.prototype.setEasingMode=function(Z){var M=Math.min(Math.max(Z,0),2);this._easingMode=M},Z.prototype.getEasingMode=function(){return this._easingMode},Z.prototype.easeInCore=function(Z){throw new Error("You must implement this method")},Z.prototype.ease=function(M){switch(this._easingMode){case Z.EASINGMODE_EASEIN:return this.easeInCore(M);case Z.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-M)}return M>=.5?.5*(1-this.easeInCore(2*(1-M)))+.5:.5*this.easeInCore(2*M)},Z.EASINGMODE_EASEIN=0,Z.EASINGMODE_EASEOUT=1,Z.EASINGMODE_EASEINOUT=2,Z}(),V=(function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){return Z=Math.max(0,Math.min(1,Z)),1-Math.sqrt(1-Z*Z)}}(z),function(Z){function M(M){void 0===M&&(M=1);var j=Z.call(this)||this;return j.amplitude=M,j}return(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){var M=Math.max(0,this.amplitude);return Math.pow(Z,3)-Z*M*Math.sin(3.141592653589793*Z)},M}(z)),o=(function(Z){function M(M,j){void 0===M&&(M=3),void 0===j&&(j=2);var K=Z.call(this)||this;return K.bounces=M,K.bounciness=j,K}(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){var M=Math.max(0,this.bounces),j=this.bounciness;j<=1&&(j=1.001);var K=Math.pow(j,M),b=1-j,g=(1-K)/b+.5*K,O=Z*g,Q=Math.log(-O*(1-j)+1)/Math.log(j),Y=Math.floor(Q),I=Y+1,E=(1-Math.pow(j,Y))/(b*g),s=.5*(E+(1-Math.pow(j,I))/(b*g)),i=Z-s,a=s-E;return-Math.pow(1/j,M-Y)/(a*a)*(i-a)*(i+a)}}(z),function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){return Z*Z*Z}}(z),function(Z){function M(M,j){void 0===M&&(M=3),void 0===j&&(j=3);var K=Z.call(this)||this;return K.oscillations=M,K.springiness=j,K}(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){var M=Math.max(0,this.oscillations),j=Math.max(0,this.springiness);return(0==j?Z:(Math.exp(j*Z)-1)/(Math.exp(j)-1))*Math.sin((6.283185307179586*M+1.5707963267948966)*Z)}}(z),function(Z){function M(M){void 0===M&&(M=2);var j=Z.call(this)||this;return j.exponent=M,j}return(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){return this.exponent<=0?Z:(Math.exp(this.exponent*Z)-1)/(Math.exp(this.exponent)-1)},M}(z)),c=(function(Z){function M(M){void 0===M&&(M=2);var j=Z.call(this)||this;return j.power=M,j}(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){var M=Math.max(0,this.power);return Math.pow(Z,M)}}(z),function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){return Z*Z}}(z),function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){return Z*Z*Z*Z}}(z),function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){return Z*Z*Z*Z*Z}}(z),function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){return 1-Math.sin(1.5707963267948966*(1-Z))}}(z),function(Z){function M(M,j,K,b){void 0===M&&(M=0),void 0===j&&(j=0),void 0===K&&(K=1),void 0===b&&(b=1);var g=Z.call(this)||this;return g.x1=M,g.y1=j,g.x2=K,g.y2=b,g}(0,K.m)(M,Z),M.prototype.easeInCore=function(Z){return a.e.Interpolate(Z,this.x1,this.y1,this.x2,this.y2)}}(z),j(21664)),G=function(){function Z(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(Z.prototype,"name",{get:function(){return"Bouncing"},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(Z){var M=this;if(this._autoTransitionRange!==Z){this._autoTransitionRange=Z;var j=this._attachedCamera;j&&(Z?this._onMeshTargetChangedObserver=j.onMeshTargetChangedObservable.add((function(Z){if(Z){Z.computeWorldMatrix(!0);var j=Z.getBoundingInfo().diagonalLength;M.lowerRadiusTransitionRange=.05*j,M.upperRadiusTransitionRange=.05*j}})):this._onMeshTargetChangedObserver&&j.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!1,configurable:!0}),Z.prototype.init=function(){},Z.prototype.attach=function(Z){var M=this;this._attachedCamera=Z,this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((function(){M._attachedCamera&&(M._isRadiusAtLimit(M._attachedCamera.lowerRadiusLimit)&&M._applyBoundRadiusAnimation(M.lowerRadiusTransitionRange),M._isRadiusAtLimit(M._attachedCamera.upperRadiusLimit)&&M._applyBoundRadiusAnimation(M.upperRadiusTransitionRange))}))},Z.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},Z.prototype._isRadiusAtLimit=function(Z){return!!this._attachedCamera&&(this._attachedCamera.radius===Z&&!this._radiusIsAnimating)},Z.prototype._applyBoundRadiusAnimation=function(M){var j=this;if(this._attachedCamera){this._radiusBounceTransition||(Z.EasingFunction.setEasingMode(Z.EasingMode),this._radiusBounceTransition=c.c.CreateAnimation("radius",c.c.ANIMATIONTYPE_FLOAT,60,Z.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var K=c.c.TransitionTo("radius",this._attachedCamera.radius+M,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(function(){return j._clearAnimationLocks()}));K&&this._animatables.push(K)}},Z.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},Z.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},Z.EasingFunction=new V(.3),Z.EasingMode=z.EASINGMODE_EASEOUT,Z}(),f=function(){function Z(){this.onTargetFramingAnimationEndObservable=new g.b,this._mode=Z.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(Z.prototype,"name",{get:function(){return"Framing"},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"mode",{get:function(){return this._mode},set:function(Z){this._mode=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(Z){this._radiusScale=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"positionScale",{get:function(){return this._positionScale},set:function(Z){this._positionScale=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(Z){this._defaultElevation=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(Z){this._elevationReturnTime=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(Z){this._elevationReturnWaitTime=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(Z){this._zoomStopsAnimation=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"framingTime",{get:function(){return this._framingTime},set:function(Z){this._framingTime=Z},enumerable:!1,configurable:!0}),Z.prototype.init=function(){},Z.prototype.attach=function(M){var j=this;this._attachedCamera=M;var K=this._attachedCamera.getScene();Z.EasingFunction.setEasingMode(Z.EasingMode),this._onPrePointerObservableObserver=K.onPrePointerObservable.add((function(Z){Z.type!==I.d.POINTERDOWN?Z.type===I.d.POINTERUP&&(j._isPointerDown=!1):j._isPointerDown=!0})),this._onMeshTargetChangedObserver=M.onMeshTargetChangedObservable.add((function(Z){Z&&j.zoomOnMesh(Z,void 0,(function(){j.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((function(){j._applyUserInteraction(),j._maintainCameraAboveGround()}))},Z.prototype.detach=function(){if(this._attachedCamera){var Z=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},Z.prototype.zoomOnMesh=function(Z,M,j){void 0===M&&(M=!1),void 0===j&&(j=null),Z.computeWorldMatrix(!0);var K=Z.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(K.minimumWorld,K.maximumWorld,M,j)},Z.prototype.zoomOnMeshHierarchy=function(Z,M,j){void 0===M&&(M=!1),void 0===j&&(j=null),Z.computeWorldMatrix(!0);var K=Z.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(K.min,K.max,M,j)},Z.prototype.zoomOnMeshesHierarchy=function(Z,M,j){void 0===M&&(M=!1),void 0===j&&(j=null);for(var K=new O.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b=new O.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),g=0;g<Z.length;g++){var Q=Z[g].getHierarchyBoundingVectors(!0);O.k.CheckExtends(Q.min,K,b),O.k.CheckExtends(Q.max,K,b)}this.zoomOnBoundingInfo(K,b,M,j)},Z.prototype.zoomOnBoundingInfo=function(M,j,K,b){var g,Q=this;if(void 0===K&&(K=!1),void 0===b&&(b=null),this._attachedCamera){var Y=M.y,I=Y+(j.y-Y)*this._positionScale,E=j.subtract(M).scale(.5);if(K)g=new O.k(0,I,0);else{var s=M.add(E);g=new O.k(s.x,I,s.z)}this._vectorTransition||(this._vectorTransition=c.c.CreateAnimation("target",c.c.ANIMATIONTYPE_VECTOR3,60,Z.EasingFunction)),this._betaIsAnimating=!0;var i=c.c.TransitionTo("target",g,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);i&&this._animatables.push(i);var a=0;if(this._mode===Z.FitFrustumSidesMode){var z=this._calculateLowerRadiusFromModelBoundingSphere(M,j);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=E.length()+this._attachedCamera.minZ),a=z}else this._mode===Z.IgnoreBoundsSizeMode&&(a=this._calculateLowerRadiusFromModelBoundingSphere(M,j),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var V=j.subtract(M).length();this._attachedCamera.panningSensibility=5e3/V,this._attachedCamera.wheelPrecision=100/a}this._radiusTransition||(this._radiusTransition=c.c.CreateAnimation("radius",c.c.ANIMATIONTYPE_FLOAT,60,Z.EasingFunction)),(i=c.c.TransitionTo("radius",a,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(function(){Q.stopAllAnimations(),b&&b(),Q._attachedCamera&&Q._attachedCamera.useInputToRestoreState&&Q._attachedCamera.storeState()})))&&this._animatables.push(i)}},Z.prototype._calculateLowerRadiusFromModelBoundingSphere=function(M,j){var K=j.subtract(M).length(),b=this._getFrustumSlope(),g=.5*K*this._radiusScale,O=g*Math.sqrt(1+1/(b.x*b.x)),Q=g*Math.sqrt(1+1/(b.y*b.y)),Y=Math.max(O,Q),I=this._attachedCamera;return I?(I.lowerRadiusLimit&&this._mode===Z.IgnoreBoundsSizeMode&&(Y=Y<I.lowerRadiusLimit?I.lowerRadiusLimit:Y),I.upperRadiusLimit&&(Y=Y>I.upperRadiusLimit?I.upperRadiusLimit:Y),Y):0},Z.prototype._maintainCameraAboveGround=function(){var M=this;if(!(this._elevationReturnTime<0)){var j=E.c.Now-this._lastInteractionTime,K=.5*Math.PI-this._defaultElevation,b=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>b&&j>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=c.c.CreateAnimation("beta",c.c.ANIMATIONTYPE_FLOAT,60,Z.EasingFunction));var g=c.c.TransitionTo("beta",K,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(function(){M._clearAnimationLocks(),M.stopAllAnimations()}));g&&this._animatables.push(g)}}},Z.prototype._getFrustumSlope=function(){var Z=this._attachedCamera;if(!Z)return O.h.Zero();var M=Z.getScene().getEngine().getAspectRatio(Z),j=Math.tan(Z.fov/2),K=j*M;return new O.h(K,j)},Z.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},Z.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=E.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())},Z.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(Z.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!1,configurable:!0}),Z.EasingFunction=new o,Z.EasingMode=z.EASINGMODE_EASEINOUT,Z.IgnoreBoundsSizeMode=0,Z.FitFrustumSidesMode=1,Z}(),X=j(37643),d=j(2517),W=j(49815),A=j(9217),q=function(){function Z(){this._currentActiveButton=-1,this.buttons=[0,1,2]}return Z.prototype.attachControl=function(Z){var M=this;Z=A.d.BackCompatCameraNoPreventDefault(arguments);var j=this.camera.getEngine(),K=j.getInputElement(),b=0,g=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(O){var Q=O.event,Y="touch"===Q.pointerType;if(!j.isInVRExclusivePointerMode&&(O.type===I.d.POINTERMOVE||-1!==M.buttons.indexOf(Q.button))){var E=Q.srcElement||Q.target;if(M._altKey=Q.altKey,M._ctrlKey=Q.ctrlKey,M._metaKey=Q.metaKey,M._shiftKey=Q.shiftKey,M._buttonsPressed=Q.buttons,j.isPointerLock){var s=Q.movementX||Q.mozMovementX||Q.webkitMovementX||Q.msMovementX||0,i=Q.movementY||Q.mozMovementY||Q.webkitMovementY||Q.msMovementY||0;M.onTouch(null,s,i),M._pointA=null,M._pointB=null}else if(O.type!==I.d.POINTERDOWN||-1!==M._currentActiveButton&&!Y)if(O.type===I.d.POINTERDOUBLETAP)M.onDoubleTap(Q.pointerType);else if(O.type!==I.d.POINTERUP||M._currentActiveButton!==Q.button&&!Y){if(O.type===I.d.POINTERMOVE)if(Z||Q.preventDefault(),M._pointA&&null===M._pointB){s=Q.clientX-M._pointA.x,i=Q.clientY-M._pointA.y;M.onTouch(M._pointA,s,i),M._pointA.x=Q.clientX,M._pointA.y=Q.clientY}else if(M._pointA&&M._pointB){var a=M._pointA.pointerId===Q.pointerId?M._pointA:M._pointB;a.x=Q.clientX,a.y=Q.clientY;var z=M._pointA.x-M._pointB.x,V=M._pointA.y-M._pointB.y,o=z*z+V*V,c={x:(M._pointA.x+M._pointB.x)/2,y:(M._pointA.y+M._pointB.y)/2,pointerId:Q.pointerId,type:O.type};M.onMultiTouch(M._pointA,M._pointB,b,o,g,c),g=c,b=o}}else{try{null===E||void 0===E||E.releasePointerCapture(Q.pointerId)}catch(Z){}Y||(M._pointB=null),j._badOS?M._pointA=M._pointB=null:M._pointB&&M._pointA&&M._pointA.pointerId==Q.pointerId?(M._pointA=M._pointB,M._pointB=null):M._pointA&&M._pointB&&M._pointB.pointerId==Q.pointerId?M._pointB=null:M._pointA=M._pointB=null,(0!==b||g)&&(M.onMultiTouch(M._pointA,M._pointB,b,0,g,null),b=0,g=null),M._currentActiveButton=-1,M.onButtonUp(Q),Z||Q.preventDefault()}else{try{null===E||void 0===E||E.setPointerCapture(Q.pointerId)}catch(Z){}null===M._pointA?M._pointA={x:Q.clientX,y:Q.clientY,pointerId:Q.pointerId,type:Q.pointerType}:null===M._pointB&&(M._pointB={x:Q.clientX,y:Q.clientY,pointerId:Q.pointerId,type:Q.pointerType}),-1!==M._currentActiveButton||Y||(M._currentActiveButton=Q.button),M.onButtonDown(Q),Z||(Q.preventDefault(),K&&K.focus())}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,I.d.POINTERDOWN|I.d.POINTERUP|I.d.POINTERMOVE|I.d.POINTERDOUBLETAP),this._onLostFocus=function(){M._pointA=M._pointB=null,b=0,g=null,M.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),K&&K.addEventListener("contextmenu",this._contextMenuBind,!1);var O=this.camera.getScene().getEngine().getHostWindow();O&&A.d.RegisterTopRootEvents(O,[{name:"blur",handler:this._onLostFocus}])},Z.prototype.detachControl=function(){if(this._onLostFocus){var Z=this.camera.getScene().getEngine().getHostWindow();Z&&A.d.UnregisterTopRootEvents(Z,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._contextMenuBind){var M=this.camera.getScene().getEngine().getInputElement();M&&M.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1},Z.prototype.getClassName=function(){return"BaseCameraPointersInput"},Z.prototype.getSimpleName=function(){return"pointers"},Z.prototype.onDoubleTap=function(Z){},Z.prototype.onTouch=function(Z,M,j){},Z.prototype.onMultiTouch=function(Z,M,j,K,b,g){},Z.prototype.onContextMenu=function(Z){Z.preventDefault()},Z.prototype.onButtonDown=function(Z){},Z.prototype.onButtonUp=function(Z){},Z.prototype.onLostFocus=function(){},(0,K.l)([(0,b.z)()],Z.prototype,"buttons",void 0),Z}(),T=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.buttons=[0,1,2],M.angularSensibilityX=1e3,M.angularSensibilityY=1e3,M.pinchPrecision=12,M.pinchDeltaPercentage=0,M.useNaturalPinchZoom=!1,M.pinchZoom=!0,M.panningSensibility=1e3,M.multiTouchPanning=!0,M.multiTouchPanAndZoom=!0,M.pinchInwards=!0,M._isPanClick=!1,M._twoFingerActivityCount=0,M._isPinching=!1,M}return(0,K.m)(M,Z),M.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},M.prototype._computeMultiTouchPanning=function(Z,M){if(0!==this.panningSensibility&&Z&&M){var j=M.x-Z.x,K=M.y-Z.y;this.camera.inertialPanningX+=-j/this.panningSensibility,this.camera.inertialPanningY+=K/this.panningSensibility}},M.prototype._computePinchZoom=function(Z,j){var K=this.camera.radius||M.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=K*Math.sqrt(Z)/Math.sqrt(j):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(j-Z)*K*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(j-Z)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)},M.prototype.onTouch=function(Z,M,j){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-M/this.panningSensibility,this.camera.inertialPanningY+=j/this.panningSensibility):(this.camera.inertialAlphaOffset-=M/this.angularSensibilityX,this.camera.inertialBetaOffset-=j/this.angularSensibilityY)},M.prototype.onDoubleTap=function(){this.camera.useInputToRestoreState&&this.camera.restoreState()},M.prototype.onMultiTouch=function(Z,M,j,K,b,g){0===j&&null===b||0===K&&null===g||(this.multiTouchPanAndZoom?(this._computePinchZoom(j,K),this._computeMultiTouchPanning(b,g)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(K)-Math.sqrt(j))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(j,K),this._isPinching=!0):this._computeMultiTouchPanning(b,g)):this.multiTouchPanning?this._computeMultiTouchPanning(b,g):this.pinchZoom&&this._computePinchZoom(j,K))},M.prototype.onButtonDown=function(Z){this._isPanClick=Z.button===this.camera._panningMouseButton},M.prototype.onButtonUp=function(){this._twoFingerActivityCount=0,this._isPinching=!1},M.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},M.MinimumRadiusForPinch=.001,(0,K.l)([(0,b.z)()],M.prototype,"buttons",void 0),(0,K.l)([(0,b.z)()],M.prototype,"angularSensibilityX",void 0),(0,K.l)([(0,b.z)()],M.prototype,"angularSensibilityY",void 0),(0,K.l)([(0,b.z)()],M.prototype,"pinchPrecision",void 0),(0,K.l)([(0,b.z)()],M.prototype,"pinchDeltaPercentage",void 0),(0,K.l)([(0,b.z)()],M.prototype,"useNaturalPinchZoom",void 0),(0,K.l)([(0,b.z)()],M.prototype,"pinchZoom",void 0),(0,K.l)([(0,b.z)()],M.prototype,"panningSensibility",void 0),(0,K.l)([(0,b.z)()],M.prototype,"multiTouchPanning",void 0),(0,K.l)([(0,b.z)()],M.prototype,"multiTouchPanAndZoom",void 0),M}(q);W.b.ArcRotateCameraPointersInput=T;var B=j(45591),N=function(){function Z(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return Z.prototype.attachControl=function(Z){var M=this;Z=A.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){M._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(j){var K,b=j.event;b.metaKey||(j.type===B.e.KEYDOWN?(M._ctrlPressed=b.ctrlKey,M._altPressed=b.altKey,(-1!==M.keysUp.indexOf(b.keyCode)||-1!==M.keysDown.indexOf(b.keyCode)||-1!==M.keysLeft.indexOf(b.keyCode)||-1!==M.keysRight.indexOf(b.keyCode)||-1!==M.keysReset.indexOf(b.keyCode))&&(-1===(K=M._keys.indexOf(b.keyCode))&&M._keys.push(b.keyCode),b.preventDefault&&(Z||b.preventDefault()))):-1===M.keysUp.indexOf(b.keyCode)&&-1===M.keysDown.indexOf(b.keyCode)&&-1===M.keysLeft.indexOf(b.keyCode)&&-1===M.keysRight.indexOf(b.keyCode)&&-1===M.keysReset.indexOf(b.keyCode)||((K=M._keys.indexOf(b.keyCode))>=0&&M._keys.splice(K,1),b.preventDefault&&(Z||b.preventDefault())))})))},Z.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},Z.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var Z=this.camera,M=0;M<this._keys.length;M++){var j=this._keys[M];-1!==this.keysLeft.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX-=1/this.panningSensibility:Z.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset+=1/this.zoomingSensibility:Z.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX+=1/this.panningSensibility:Z.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset-=1/this.zoomingSensibility:Z.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(j)&&Z.useInputToRestoreState&&Z.restoreState()}},Z.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},Z.prototype.getSimpleName=function(){return"keyboard"},(0,K.l)([(0,b.z)()],Z.prototype,"keysUp",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysDown",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysLeft",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysRight",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysReset",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"panningSensibility",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"zoomingSensibility",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"useAltToZoom",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"angularSpeed",void 0),Z}();W.b.ArcRotateCameraKeyboardMoveInput=N;var U=j(85567),n=j(13316),k=j(96658),x=function(){function Z(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=O.k.Zero()}return Z.prototype._computeDeltaFromMouseWheelLegacyEvent=function(Z,M){var j=.01*Z*this.wheelDeltaPercentage*M;return Z>0?j/(1+this.wheelDeltaPercentage):j*(1+this.wheelDeltaPercentage)},Z.prototype.attachControl=function(Z){var M=this;this._wheel=function(Z){if(Z.type===I.d.POINTERWHEEL){var j=Z.event,K=0,b=j,g=0,O=j.deltaMode===n.e.DOM_DELTA_LINE?40:1;if(g=void 0!==j.deltaY?-j.deltaY*O:void 0!==j.wheelDeltaY?-j.wheelDeltaY*O:b.wheelDelta,M.customComputeDeltaFromMouseWheel)K=M.customComputeDeltaFromMouseWheel(g,M,j);else if(M.wheelDeltaPercentage){if((K=M._computeDeltaFromMouseWheelLegacyEvent(g,M.camera.radius))>0){for(var Q=M.camera.radius,Y=M.camera.inertialRadiusOffset+K,E=0;E<20&&Math.abs(Y)>.001;E++)Q-=Y,Y*=M.camera.inertia;Q=k.b.Clamp(Q,0,Number.MAX_VALUE),K=M._computeDeltaFromMouseWheelLegacyEvent(g,Q)}}else K=g/(40*M.wheelPrecision);K&&(M.zoomToMouseLocation&&M._hitPlane?M._zoomToMouse(K):M.camera.inertialRadiusOffset+=K)}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,I.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)},Z.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},Z.prototype.checkInputs=function(){if(this.zoomToMouseLocation){var Z=this.camera;0+Z.inertialAlphaOffset+Z.inertialBetaOffset+Z.inertialRadiusOffset&&(this._updateHitPlane(),Z.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(Z.inertia),this._zeroIfClose(this._inertialPanning))}},Z.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},Z.prototype.getSimpleName=function(){return"mousewheel"},Z.prototype._updateHitPlane=function(){var Z=this.camera,M=Z.target.subtract(Z.position);this._hitPlane=U.e.FromPositionAndNormal(Z.target,M)},Z.prototype._getPosition=function(){var Z,M=this.camera,j=M.getScene(),K=j.createPickingRay(j.pointerX,j.pointerY,O.c.Identity(),M,!1),b=0;return this._hitPlane&&(b=null!==(Z=K.intersectsPlane(this._hitPlane))&&void 0!==Z?Z:0),K.origin.addInPlace(K.direction.scaleInPlace(b))},Z.prototype._zoomToMouse=function(Z){var M,j,K=this.camera,b=1-K.inertia;if(K.lowerRadiusLimit){var g=null!==(M=K.lowerRadiusLimit)&&void 0!==M?M:0;K.radius-(K.inertialRadiusOffset+Z)/b<g&&(Z=(K.radius-g)*b-K.inertialRadiusOffset)}if(K.upperRadiusLimit){var Q=null!==(j=K.upperRadiusLimit)&&void 0!==j?j:0;K.radius-(K.inertialRadiusOffset+Z)/b>Q&&(Z=(K.radius-Q)*b-K.inertialRadiusOffset)}var Y=Z/b/K.radius,I=this._getPosition(),E=O.e.Vector3[6];I.subtractToRef(K.target,E),E.scaleInPlace(Y),E.scaleInPlace(b),this._inertialPanning.addInPlace(E),K.inertialRadiusOffset+=Z},Z.prototype._zeroIfClose=function(Z){Math.abs(Z.x)<s.e&&(Z.x=0),Math.abs(Z.y)<s.e&&(Z.y=0),Math.abs(Z.z)<s.e&&(Z.z=0)},(0,K.l)([(0,b.z)()],Z.prototype,"wheelPrecision",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"zoomToMouseLocation",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"wheelDeltaPercentage",void 0),Z}();W.b.ArcRotateCameraMouseWheelInput=x;var R=function(Z){function M(M){return Z.call(this,M)||this}return(0,K.m)(M,Z),M.prototype.addMouseWheel=function(){return this.add(new x),this},M.prototype.addPointers=function(){return this.add(new T),this},M.prototype.addKeyboard=function(){return this.add(new N),this},M}(W.f);Q.b.AddNodeConstructor("ArcRotateCamera",(function(Z,M){return function(){return new e(Z,0,0,1,O.k.Zero(),M)}}));var e=function(Z){function M(M,j,K,b,Q,Y,I){void 0===I&&(I=!0);var E=Z.call(this,M,O.k.Zero(),Y,I)||this;return E.inertialAlphaOffset=0,E.inertialBetaOffset=0,E.inertialRadiusOffset=0,E.lowerAlphaLimit=null,E.upperAlphaLimit=null,E.lowerBetaLimit=.01,E.upperBetaLimit=Math.PI-.01,E.lowerRadiusLimit=null,E.upperRadiusLimit=null,E.inertialPanningX=0,E.inertialPanningY=0,E.pinchToPanMaxDistance=20,E.panningDistanceLimit=null,E.panningOriginTarget=O.k.Zero(),E.panningInertia=.9,E.zoomOnFactor=1,E.targetScreenOffset=O.h.Zero(),E.allowUpsideDown=!0,E.useInputToRestoreState=!0,E._viewMatrix=new O.c,E.panningAxis=new O.k(1,1,0),E._transformedDirection=new O.k,E.mapPanning=!1,E.onMeshTargetChangedObservable=new g.b,E.checkCollisions=!1,E.collisionRadius=new O.k(.5,.5,.5),E._previousPosition=O.k.Zero(),E._collisionVelocity=O.k.Zero(),E._newPosition=O.k.Zero(),E._computationVector=O.k.Zero(),E._onCollisionPositionChange=function(Z,M,j){void 0===j&&(j=null),j?(E.setPosition(M),E.onCollide&&E.onCollide(j)):E._previousPosition.copyFrom(E._position);var K=Math.cos(E.alpha),b=Math.sin(E.alpha),g=Math.cos(E.beta),O=Math.sin(E.beta);0===O&&(O=1e-4);var Q=E._getTargetPosition();E._computationVector.copyFromFloats(E.radius*K*O,E.radius*g,E.radius*b*O),Q.addToRef(E._computationVector,E._newPosition),E._position.copyFrom(E._newPosition);var Y=E.upVector;E.allowUpsideDown&&E.beta<0&&(Y=(Y=Y.clone()).negate()),E._computeViewMatrix(E._position,Q,Y),E._viewMatrix.addAtIndex(12,E.targetScreenOffset.x),E._viewMatrix.addAtIndex(13,E.targetScreenOffset.y),E._collisionTriggered=!1},E._target=O.k.Zero(),Q&&E.setTarget(Q),E.alpha=j,E.beta=K,E.radius=b,E.getViewMatrix(),E.inputs=new R(E),E.inputs.addKeyboard().addMouseWheel().addPointers(),E}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"target",{get:function(){return this._target},set:function(Z){this.setTarget(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"targetHost",{get:function(){return this._targetHost},set:function(Z){Z&&this.setTarget(Z)},enumerable:!1,configurable:!0}),M.prototype.getTarget=function(){return this.target},Object.defineProperty(M.prototype,"position",{get:function(){return this._position},set:function(Z){this.setPosition(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"upVector",{get:function(){return this._upVector},set:function(Z){this._upToYMatrix||(this._yToUpMatrix=new O.c,this._upToYMatrix=new O.c,this._upVector=O.k.Zero()),Z.normalize(),this._upVector.copyFrom(Z),this.setMatUp()},enumerable:!1,configurable:!0}),M.prototype.setMatUp=function(){O.c.RotationAlignToRef(O.k.UpReadOnly,this._upVector,this._yToUpMatrix),O.c.RotationAlignToRef(this._upVector,O.k.UpReadOnly,this._upToYMatrix)},Object.defineProperty(M.prototype,"angularSensibilityX",{get:function(){var Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityX:0},set:function(Z){var M=this.inputs.attached.pointers;M&&(M.angularSensibilityX=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"angularSensibilityY",{get:function(){var Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityY:0},set:function(Z){var M=this.inputs.attached.pointers;M&&(M.angularSensibilityY=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"pinchPrecision",{get:function(){var Z=this.inputs.attached.pointers;return Z?Z.pinchPrecision:0},set:function(Z){var M=this.inputs.attached.pointers;M&&(M.pinchPrecision=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"pinchDeltaPercentage",{get:function(){var Z=this.inputs.attached.pointers;return Z?Z.pinchDeltaPercentage:0},set:function(Z){var M=this.inputs.attached.pointers;M&&(M.pinchDeltaPercentage=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"useNaturalPinchZoom",{get:function(){var Z=this.inputs.attached.pointers;return!!Z&&Z.useNaturalPinchZoom},set:function(Z){var M=this.inputs.attached.pointers;M&&(M.useNaturalPinchZoom=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"panningSensibility",{get:function(){var Z=this.inputs.attached.pointers;return Z?Z.panningSensibility:0},set:function(Z){var M=this.inputs.attached.pointers;M&&(M.panningSensibility=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysUp",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysUp=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysDown",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysDown=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysLeft",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysLeft=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysRight",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysRight=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wheelPrecision",{get:function(){var Z=this.inputs.attached.mousewheel;return Z?Z.wheelPrecision:0},set:function(Z){var M=this.inputs.attached.mousewheel;M&&(M.wheelPrecision=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"zoomToMouseLocation",{get:function(){var Z=this.inputs.attached.mousewheel;return!!Z&&Z.zoomToMouseLocation},set:function(Z){var M=this.inputs.attached.mousewheel;M&&(M.zoomToMouseLocation=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wheelDeltaPercentage",{get:function(){var Z=this.inputs.attached.mousewheel;return Z?Z.wheelDeltaPercentage:0},set:function(Z){var M=this.inputs.attached.mousewheel;M&&(M.wheelDeltaPercentage=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(Z){Z!==this.useBouncingBehavior&&(Z?(this._bouncingBehavior=new G,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(Z){Z!==this.useFramingBehavior&&(Z?(this._framingBehavior=new f,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(Z){Z!==this.useAutoRotationBehavior&&(Z?(this._autoRotationBehavior=new i,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),M.prototype._initCache=function(){Z.prototype._initCache.call(this),this._cache._target=new O.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=O.h.Zero()},M.prototype._updateCache=function(M){M||Z.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},M.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var Z=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?Z.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(Z)}var M=this._getLockedTargetPosition();return M||this._target},M.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),Z.prototype.storeState.call(this)},M.prototype._restoreStateValues=function(){return!!Z.prototype._restoreStateValues.call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},M.prototype._isSynchronizedViewMatrix=function(){return!!Z.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},M.prototype.attachControl=function(Z,M,j,K){var b=this;void 0===j&&(j=!0),void 0===K&&(K=2);var g=arguments;M=A.d.BackCompatCameraNoPreventDefault(g),this._useCtrlForPanning=j,this._panningMouseButton=K,"boolean"===typeof g[0]&&(g.length>1&&(this._useCtrlForPanning=g[1]),g.length>2&&(this._panningMouseButton=g[2])),this.inputs.attachElement(M),this._reset=function(){b.inertialAlphaOffset=0,b.inertialBetaOffset=0,b.inertialRadiusOffset=0,b.inertialPanningX=0,b.inertialPanningY=0}},M.prototype.detachControl=function(){this.inputs.detachElement(),this._reset&&this._reset()},M.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var M=this.inertialAlphaOffset;this.beta<=0&&(M*=-1),this.getScene().useRightHandedSystem&&(M*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(M*=-1),this.alpha+=M,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<s.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<s.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*s.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){var j=new O.k(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),j.multiplyInPlace(this.panningAxis),O.k.TransformNormalToRef(j,this._cameraTransformMatrix,this._transformedDirection),!this.mapPanning&&this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),O.k.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*s.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*s.e&&(this.inertialPanningY=0)}this._checkLimits(),Z.prototype._checkInputs.call(this)}},M.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},M.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||O.k.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);var Z=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var M=Math.round((Z-this.alpha)/(2*Math.PI));this.alpha+=2*M*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},M.prototype.setPosition=function(Z){this._position.equals(Z)||(this._position.copyFrom(Z),this.rebuildAnglesAndRadius())},M.prototype.setTarget=function(Z,M,j,K){var b;if(void 0===M&&(M=!1),void 0===j&&(j=!1),void 0===K&&(K=!1),K=null!==(b=this.overrideCloneAlphaBetaRadius)&&void 0!==b?b:K,Z.getBoundingInfo)this._targetBoundingCenter=M?Z.getBoundingInfo().boundingBox.centerWorld.clone():null,Z.computeWorldMatrix(),this._targetHost=Z,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var g=Z,O=this._getTargetPosition();if(O&&!j&&O.equals(g))return;this._targetHost=null,this._target=g,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}K||this.rebuildAnglesAndRadius()},M.prototype._getViewMatrix=function(){var Z=Math.cos(this.alpha),M=Math.sin(this.alpha),j=Math.cos(this.beta),K=Math.sin(this.beta);0===K&&(K=1e-4),0===this.radius&&(this.radius=1e-4);var b=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*Z*K,this.radius*j,this.radius*M*K),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||O.k.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),b.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var g=this.getScene().collisionCoordinator;this._collider||(this._collider=g.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,g.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var Q=this.upVector;this.allowUpsideDown&&K<0&&(Q=Q.negate()),this._computeViewMatrix(this._position,b,Q),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=b,this._viewMatrix},M.prototype.zoomOn=function(Z,M){void 0===M&&(M=!1),Z=Z||this.getScene().meshes;var j=Y.b.MinMax(Z),K=O.k.Distance(j.min,j.max);this.radius=K*this.zoomOnFactor,this.focusOn({min:j.min,max:j.max,distance:K},M)},M.prototype.focusOn=function(Z,M){var j,K;if(void 0===M&&(M=!1),void 0===Z.min){var b=Z||this.getScene().meshes;j=Y.b.MinMax(b),K=O.k.Distance(j.min,j.max)}else{j=Z,K=Z.distance}this._target=Y.b.Center(j),M||(this.maxZ=2*K)},M.prototype.createRigCamera=function(Z,j){var K=0;switch(this.cameraRigMode){case X.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case X.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case X.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case X.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case X.e.RIG_MODE_VR:K=this._cameraRigParams.stereoHalfAngle*(0===j?1:-1);break;case X.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:K=this._cameraRigParams.stereoHalfAngle*(0===j?-1:1)}var b=new M(Z,this.alpha+K,this.beta,this.radius,this._target,this.getScene());return b._cameraRigParams={},b.isRigCamera=!0,b.rigParent=this,b.upVector=this.upVector,b},M.prototype._updateRigCameras=function(){var M=this._rigCameras[0],j=this._rigCameras[1];switch(M.beta=j.beta=this.beta,this.cameraRigMode){case X.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case X.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case X.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case X.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case X.e.RIG_MODE_VR:M.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,j.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case X.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:M.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,j.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}Z.prototype._updateRigCameras.call(this)},M.prototype.dispose=function(){this.inputs.clear(),Z.prototype.dispose.call(this)},M.prototype.getClassName=function(){return"ArcRotateCamera"},(0,K.l)([(0,b.z)()],M.prototype,"alpha",void 0),(0,K.l)([(0,b.z)()],M.prototype,"beta",void 0),(0,K.l)([(0,b.z)()],M.prototype,"radius",void 0),(0,K.l)([(0,b.z)()],M.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,K.l)([(0,b.x)("target")],M.prototype,"_target",void 0),(0,K.l)([(0,b.p)("targetHost")],M.prototype,"_targetHost",void 0),(0,K.l)([(0,b.z)()],M.prototype,"inertialAlphaOffset",void 0),(0,K.l)([(0,b.z)()],M.prototype,"inertialBetaOffset",void 0),(0,K.l)([(0,b.z)()],M.prototype,"inertialRadiusOffset",void 0),(0,K.l)([(0,b.z)()],M.prototype,"lowerAlphaLimit",void 0),(0,K.l)([(0,b.z)()],M.prototype,"upperAlphaLimit",void 0),(0,K.l)([(0,b.z)()],M.prototype,"lowerBetaLimit",void 0),(0,K.l)([(0,b.z)()],M.prototype,"upperBetaLimit",void 0),(0,K.l)([(0,b.z)()],M.prototype,"lowerRadiusLimit",void 0),(0,K.l)([(0,b.z)()],M.prototype,"upperRadiusLimit",void 0),(0,K.l)([(0,b.z)()],M.prototype,"inertialPanningX",void 0),(0,K.l)([(0,b.z)()],M.prototype,"inertialPanningY",void 0),(0,K.l)([(0,b.z)()],M.prototype,"pinchToPanMaxDistance",void 0),(0,K.l)([(0,b.z)()],M.prototype,"panningDistanceLimit",void 0),(0,K.l)([(0,b.x)()],M.prototype,"panningOriginTarget",void 0),(0,K.l)([(0,b.z)()],M.prototype,"panningInertia",void 0),(0,K.l)([(0,b.z)()],M.prototype,"zoomToMouseLocation",null),(0,K.l)([(0,b.z)()],M.prototype,"zoomOnFactor",void 0),(0,K.l)([(0,b.t)()],M.prototype,"targetScreenOffset",void 0),(0,K.l)([(0,b.z)()],M.prototype,"allowUpsideDown",void 0),(0,K.l)([(0,b.z)()],M.prototype,"useInputToRestoreState",void 0),M}(d.e)},37643:function(Z,M,j){"use strict";j.d(M,{e:function(){return V}});var K=j(40061),b=j(9892),g=j(17190),O=j(9217),Q=j(9271),Y=j(80105),I=j(74134),E=j(9127),s=j(31709),i=j(50504),a=j(57278),z=j(46647),V=function(Z){function M(j,K,b,O){void 0===O&&(O=!0);var I=Z.call(this,j,b)||this;return I._position=Y.k.Zero(),I._upVector=Y.k.Up(),I.orthoLeft=null,I.orthoRight=null,I.orthoBottom=null,I.orthoTop=null,I.fov=.8,I.projectionPlaneTilt=0,I.minZ=1,I.maxZ=1e4,I.inertia=.9,I.mode=M.PERSPECTIVE_CAMERA,I.isIntermediate=!1,I.viewport=new a.b(0,0,1,1),I.layerMask=268435455,I.fovMode=M.FOVMODE_VERTICAL_FIXED,I.cameraRigMode=M.RIG_MODE_NONE,I.customRenderTargets=new Array,I.outputRenderTarget=null,I.onViewMatrixChangedObservable=new Q.b,I.onProjectionMatrixChangedObservable=new Q.b,I.onAfterCheckInputsObservable=new Q.b,I.onRestoreStateObservable=new Q.b,I.isRigCamera=!1,I._rigCameras=new Array,I._webvrViewMatrix=Y.c.Identity(),I._skipRendering=!1,I._projectionMatrix=new Y.c,I._postProcesses=new Array,I._activeMeshes=new g.f(256),I._globalPosition=Y.k.Zero(),I._computedViewMatrix=Y.c.Identity(),I._doNotComputeProjectionMatrix=!1,I._transformMatrix=Y.c.Zero(),I._refreshFrustumPlanes=!0,I._absoluteRotation=Y.d.Identity(),I._isCamera=!0,I._isLeftCamera=!1,I._isRightCamera=!1,I.getScene().addCamera(I),O&&!I.getScene().activeCamera&&(I.getScene().activeCamera=I),I.position=K,I.renderPassId=I.getScene().getEngine().createRenderPassId("Camera ".concat(j)),I}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"position",{get:function(){return this._position},set:function(Z){this._position=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"upVector",{get:function(){return this._upVector},set:function(Z){this._upVector=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"screenArea",{get:function(){var Z,j,K,b,g=0,O=0;if(this.mode===M.PERSPECTIVE_CAMERA)this.fovMode===M.FOVMODE_VERTICAL_FIXED?(O=2*this.minZ*Math.tan(this.fov/2),g=this.getEngine().getAspectRatio(this)*O):O=(g=2*this.minZ*Math.tan(this.fov/2))/this.getEngine().getAspectRatio(this);else{var Q=this.getEngine().getRenderWidth()/2,Y=this.getEngine().getRenderHeight()/2;g=(null!==(Z=this.orthoRight)&&void 0!==Z?Z:Q)-(null!==(j=this.orthoLeft)&&void 0!==j?j:-Q),O=(null!==(K=this.orthoTop)&&void 0!==K?K:Y)-(null!==(b=this.orthoBottom)&&void 0!==b?b:-Y)}return g*O},enumerable:!1,configurable:!0}),M.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},M.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},M.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},M.prototype.getClassName=function(){return"Camera"},M.prototype.toString=function(Z){var M="Name: "+this.name;if(M+=", type: "+this.getClassName(),this.animations)for(var j=0;j<this.animations.length;j++)M+=", animation[0]: "+this.animations[j].toString(Z);return M},M.prototype.applyVerticalCorrection=function(){var Z=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-Z.x:Z.x},Object.defineProperty(M.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),M.prototype.getActiveMeshes=function(){return this._activeMeshes},M.prototype.isActiveMesh=function(Z){return-1!==this._activeMeshes.indexOf(Z)},M.prototype.isReady=function(M){if(void 0===M&&(M=!1),M)for(var j=0,K=this._postProcesses;j<K.length;j++){var b=K[j];if(b&&!b.isReady())return!1}return Z.prototype.isReady.call(this,M)},M.prototype._initCache=function(){Z.prototype._initCache.call(this),this._cache.position=new Y.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new Y.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},M.prototype._updateCache=function(M){M||Z.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},M.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},M.prototype._isSynchronizedViewMatrix=function(){return!!Z.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},M.prototype._isSynchronizedProjectionMatrix=function(){var Z=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!Z)return!1;var j=this.getEngine();return Z=this.mode===M.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===j.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===j.getRenderWidth()&&this._cache.renderHeight===j.getRenderHeight()},M.prototype.attachControl=function(Z,M){},M.prototype.detachControl=function(Z){},M.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==M.RIG_MODE_NONE&&this._updateRigCameras()},M.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(M.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),M.prototype._getFirstPostProcess=function(){for(var Z=0;Z<this._postProcesses.length;Z++)if(null!==this._postProcesses[Z])return this._postProcesses[Z];return null},M.prototype._cascadePostProcessesToRigCams=function(){var Z=this._getFirstPostProcess();Z&&Z.markTextureDirty();for(var M=0,j=this._rigCameras.length;M<j;M++){var K=this._rigCameras[M],b=K._rigPostProcess;if(b)"pass"===b.getEffectName()&&(K.isIntermediate=0===this._postProcesses.length),K._postProcesses=this._postProcesses.slice(0).concat(b),b.markTextureDirty();else K._postProcesses=this._postProcesses.slice(0)}},M.prototype.attachPostProcess=function(Z,M){return void 0===M&&(M=null),!Z.isReusable()&&this._postProcesses.indexOf(Z)>-1?(E.c.Error("You're trying to reuse a post process not defined as reusable."),0):(null==M||M<0?this._postProcesses.push(Z):null===this._postProcesses[M]?this._postProcesses[M]=Z:this._postProcesses.splice(M,0,Z),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(Z))},M.prototype.detachPostProcess=function(Z){var M=this._postProcesses.indexOf(Z);-1!==M&&(this._postProcesses[M]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},M.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},M.prototype._getViewMatrix=function(){return Y.c.Identity()},M.prototype.getViewMatrix=function(Z){return!Z&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},M.prototype.freezeProjectionMatrix=function(Z){this._doNotComputeProjectionMatrix=!0,void 0!==Z&&(this._projectionMatrix=Z)},M.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},M.prototype.getProjectionMatrix=function(Z){var j,K,b,g,O,Q,I,E;if(this._doNotComputeProjectionMatrix||!Z&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var s=this.getEngine(),i=this.getScene();if(this.mode===M.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=s.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1);var a=s.useReverseDepthBuffer;(i.useRightHandedSystem?Y.c.PerspectiveFovRHToRef:Y.c.PerspectiveFovLHToRef)(this.fov,s.getAspectRatio(this),a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===M.FOVMODE_VERTICAL_FIXED,s.isNDCHalfZRange,this.projectionPlaneTilt,s.useReverseDepthBuffer)}else{var z=s.getRenderWidth()/2,V=s.getRenderHeight()/2;i.useRightHandedSystem?Y.c.OrthoOffCenterRHToRef(null!==(j=this.orthoLeft)&&void 0!==j?j:-z,null!==(K=this.orthoRight)&&void 0!==K?K:z,null!==(b=this.orthoBottom)&&void 0!==b?b:-V,null!==(g=this.orthoTop)&&void 0!==g?g:V,this.minZ,this.maxZ,this._projectionMatrix,s.isNDCHalfZRange):Y.c.OrthoOffCenterLHToRef(null!==(O=this.orthoLeft)&&void 0!==O?O:-z,null!==(Q=this.orthoRight)&&void 0!==Q?Q:z,null!==(I=this.orthoBottom)&&void 0!==I?I:-V,null!==(E=this.orthoTop)&&void 0!==E?E:V,this.minZ,this.maxZ,this._projectionMatrix,s.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=s.getRenderWidth(),this._cache.renderHeight=s.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},M.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},M.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?z.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=z.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},M.prototype.isInFrustum=function(Z,M){if(void 0===M&&(M=!1),this._updateFrustumPlanes(),M&&this.rigCameras.length>0){var j=!1;return this.rigCameras.forEach((function(M){M._updateFrustumPlanes(),j=j||Z.isInFrustum(M._frustumPlanes)})),j}return Z.isInFrustum(this._frustumPlanes)},M.prototype.isCompletelyInFrustum=function(Z){return this._updateFrustumPlanes(),Z.isCompletelyInFrustum(this._frustumPlanes)},M.prototype.getForwardRay=function(Z,M,j){throw void 0===Z&&(Z=100),(0,i.e)("Ray")},M.prototype.getForwardRayToRef=function(Z,M,j,K){throw void 0===M&&(M=100),(0,i.e)("Ray")},M.prototype.dispose=function(j,K){for(void 0===K&&(K=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var b=this._rigCameras.pop();b&&b.dispose()}if(this._parentContainer){var g=this._parentContainer.cameras.indexOf(this);g>-1&&this._parentContainer.cameras.splice(g,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==M.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var O=this._postProcesses.length;--O>=0;){var Q=this._postProcesses[O];Q&&Q.dispose(this)}for(var Y=this.customRenderTargets.length;--Y>=0;)this.customRenderTargets[Y].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),Z.prototype.dispose.call(this,j,K)},Object.defineProperty(M.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),M.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},M.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},M.prototype.setCameraRigMode=function(Z,j){if(this.cameraRigMode!==Z){for(;this._rigCameras.length>0;){var K=this._rigCameras.pop();K&&K.dispose()}if(this.cameraRigMode=Z,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=j.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=O.d.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==M.RIG_MODE_NONE){var b=this.createRigCamera(this.name+"_L",0);b&&(b._isLeftCamera=!0);var g=this.createRigCamera(this.name+"_R",1);g&&(g._isRightCamera=!0),b&&g&&(this._rigCameras.push(b),this._rigCameras.push(g))}this._setRigMode(j),this._cascadePostProcessesToRigCams(),this.update()}},M.prototype._setRigMode=function(Z){},M.prototype._getVRProjectionMatrix=function(){return Y.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},M.prototype._updateCameraRotationMatrix=function(){},M.prototype._updateWebVRCameraRotationMatrix=function(){},M.prototype._getWebVRProjectionMatrix=function(){return Y.c.Identity()},M.prototype._getWebVRViewMatrix=function(){return Y.c.Identity()},M.prototype.setCameraRigParameter=function(Z,M){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[Z]=M,"interaxialDistance"===Z&&(this._cameraRigParams.stereoHalfAngle=O.d.ToRadians(M/.0637))},M.prototype.createRigCamera=function(Z,M){return null},M.prototype._updateRigCameras=function(){for(var Z=0;Z<this._rigCameras.length;Z++)this._rigCameras[Z].minZ=this.minZ,this._rigCameras[Z].maxZ=this.maxZ,this._rigCameras[Z].fov=this.fov,this._rigCameras[Z].upVector.copyFrom(this.upVector);this.cameraRigMode===M.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},M.prototype._setupInputs=function(){},M.prototype.serialize=function(){var Z=b.b.Serialize(this);return Z.uniqueId=this.uniqueId,Z.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(Z),this.inputs&&this.inputs.serialize(Z),b.b.AppendSerializedAnimations(this,Z),Z.ranges=this.serializeAnimationRanges(),Z.isEnabled=this.isEnabled(),Z},M.prototype.clone=function(Z,j){void 0===j&&(j=null);var K=b.b.Clone(M.GetConstructorFromName(this.getClassName(),Z,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return K.name=Z,K.parent=j,this.onClonedObservable.notifyObservers(K),K},M.prototype.getDirection=function(Z){var M=Y.k.Zero();return this.getDirectionToRef(Z,M),M},Object.defineProperty(M.prototype,"absoluteRotation",{get:function(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation},enumerable:!1,configurable:!0}),M.prototype.getDirectionToRef=function(Z,M){Y.k.TransformNormalToRef(Z,this.getWorldMatrix(),M)},M.GetConstructorFromName=function(Z,j,K,b,g){void 0===b&&(b=0),void 0===g&&(g=!0);var O=I.b.Construct(Z,j,K,{interaxial_distance:b,isStereoscopicSideBySide:g});return O||function(){return M._CreateDefaultParsedCamera(j,K)}},M.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},M.Parse=function(Z,j){var K=Z.type,g=M.GetConstructorFromName(K,Z.name,j,Z.interaxial_distance,Z.isStereoscopicSideBySide),O=b.b.Parse(g,Z,j);if(void 0!==Z.parentId&&(O._waitingParentId=Z.parentId),void 0!==Z.parentInstanceIndex&&(O._waitingParentInstanceIndex=Z.parentInstanceIndex),O.inputs&&(O.inputs.parse(Z),O._setupInputs()),Z.upVector&&(O.upVector=Y.k.FromArray(Z.upVector)),O.setPosition&&(O.position.copyFromFloats(0,0,0),O.setPosition(Y.k.FromArray(Z.position))),Z.target&&O.setTarget&&O.setTarget(Y.k.FromArray(Z.target)),Z.cameraRigMode){var Q=Z.interaxial_distance?{interaxialDistance:Z.interaxial_distance}:{};O.setCameraRigMode(Z.cameraRigMode,Q)}if(Z.animations){for(var E=0;E<Z.animations.length;E++){var i=Z.animations[E],a=(0,s.b)("BABYLON.Animation");a&&O.animations.push(a.Parse(i))}I.b.ParseAnimationRanges(O,Z,j)}return Z.autoAnimate&&j.beginAnimation(O,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),void 0!==Z.isEnabled&&O.setEnabled(Z.isEnabled),O},M._CreateDefaultParsedCamera=function(Z,M){throw(0,i.e)("UniversalCamera")},M.PERSPECTIVE_CAMERA=0,M.ORTHOGRAPHIC_CAMERA=1,M.FOVMODE_VERTICAL_FIXED=0,M.FOVMODE_HORIZONTAL_FIXED=1,M.RIG_MODE_NONE=0,M.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,M.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,M.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,M.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,M.RIG_MODE_STEREOSCOPIC_INTERLACED=14,M.RIG_MODE_VR=20,M.RIG_MODE_WEBVR=21,M.RIG_MODE_CUSTOM=22,M.ForceAttachControlToAlwaysPreventDefault=!1,(0,K.l)([(0,b.x)("position")],M.prototype,"_position",void 0),(0,K.l)([(0,b.x)("upVector")],M.prototype,"_upVector",void 0),(0,K.l)([(0,b.z)()],M.prototype,"orthoLeft",void 0),(0,K.l)([(0,b.z)()],M.prototype,"orthoRight",void 0),(0,K.l)([(0,b.z)()],M.prototype,"orthoBottom",void 0),(0,K.l)([(0,b.z)()],M.prototype,"orthoTop",void 0),(0,K.l)([(0,b.z)()],M.prototype,"fov",void 0),(0,K.l)([(0,b.z)()],M.prototype,"projectionPlaneTilt",void 0),(0,K.l)([(0,b.z)()],M.prototype,"minZ",void 0),(0,K.l)([(0,b.z)()],M.prototype,"maxZ",void 0),(0,K.l)([(0,b.z)()],M.prototype,"inertia",void 0),(0,K.l)([(0,b.z)()],M.prototype,"mode",void 0),(0,K.l)([(0,b.z)()],M.prototype,"layerMask",void 0),(0,K.l)([(0,b.z)()],M.prototype,"fovMode",void 0),(0,K.l)([(0,b.z)()],M.prototype,"cameraRigMode",void 0),(0,K.l)([(0,b.z)()],M.prototype,"interaxialDistance",void 0),(0,K.l)([(0,b.z)()],M.prototype,"isStereoscopicSideBySide",void 0),M}(I.b)},49815:function(Z,M,j){"use strict";j.d(M,{b:function(){return O},f:function(){return Q}});var K=j(9127),b=j(9892),g=j(37643),O={},Q=function(){function Z(Z){this.attachedToElement=!1,this.attached={},this.camera=Z,this.checkInputs=function(){}}return Z.prototype.add=function(Z){var M=Z.getSimpleName();this.attached[M]?K.c.Warn("camera input of type "+M+" already exists on camera"):(this.attached[M]=Z,Z.camera=this.camera,Z.checkInputs&&(this.checkInputs=this._addCheckInputs(Z.checkInputs.bind(Z))),this.attachedToElement&&Z.attachControl())},Z.prototype.remove=function(Z){for(var M in this.attached){var j=this.attached[M];j===Z&&(j.detachControl(),j.camera=null,delete this.attached[M],this.rebuildInputCheck())}},Z.prototype.removeByType=function(Z){for(var M in this.attached){var j=this.attached[M];j.getClassName()===Z&&(j.detachControl(),j.camera=null,delete this.attached[M],this.rebuildInputCheck())}},Z.prototype._addCheckInputs=function(Z){var M=this.checkInputs;return function(){M(),Z()}},Z.prototype.attachInput=function(Z){this.attachedToElement&&Z.attachControl(this.noPreventDefault)},Z.prototype.attachElement=function(Z){if(void 0===Z&&(Z=!1),!this.attachedToElement)for(var M in Z=!g.e.ForceAttachControlToAlwaysPreventDefault&&Z,this.attachedToElement=!0,this.noPreventDefault=Z,this.attached)this.attached[M].attachControl(Z)},Z.prototype.detachElement=function(Z){for(var M in void 0===Z&&(Z=!1),this.attached)this.attached[M].detachControl(),Z&&(this.attached[M].camera=null);this.attachedToElement=!1},Z.prototype.rebuildInputCheck=function(){for(var Z in this.checkInputs=function(){},this.attached){var M=this.attached[Z];M.checkInputs&&(this.checkInputs=this._addCheckInputs(M.checkInputs.bind(M)))}},Z.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},Z.prototype.serialize=function(Z){var M={};for(var j in this.attached){var K=this.attached[j],g=b.b.Serialize(K);M[K.getClassName()]=g}Z.inputsmgr=M},Z.prototype.parse=function(Z){var M=Z.inputsmgr;if(M){this.clear();var j=function(Z){var j=O[Z];if(j){var g=M[Z],Q=b.b.Parse((function(){return new j}),g,null);K.add(Q)}},K=this;for(var g in M)j(g)}else{var Q=function(M){var j=O[Y.attached[M].getClassName()];if(j){var K=b.b.Parse((function(){return new j}),Z,null);Y.remove(Y.attached[M]),Y.add(K)}},Y=this;for(var g in this.attached)Q(g)}},Z}()},35958:function(Z,M,j){"use strict";j.d(M,{d:function(){return W}});var K=j(40061),b=j(9892),g=j(80105),O=j(90690),Q=j(2517),Y=j(49815),I=j(45591),E=j(9217),s=function(){function Z(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this._keys=new Array}return Z.prototype.attachControl=function(Z){var M=this;Z=E.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){M._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(j){var K,b=j.event;b.metaKey||(j.type===I.e.KEYDOWN?-1===M.keysUp.indexOf(b.keyCode)&&-1===M.keysDown.indexOf(b.keyCode)&&-1===M.keysLeft.indexOf(b.keyCode)&&-1===M.keysRight.indexOf(b.keyCode)&&-1===M.keysUpward.indexOf(b.keyCode)&&-1===M.keysDownward.indexOf(b.keyCode)&&-1===M.keysRotateLeft.indexOf(b.keyCode)&&-1===M.keysRotateRight.indexOf(b.keyCode)||(-1===(K=M._keys.indexOf(b.keyCode))&&M._keys.push(b.keyCode),Z||b.preventDefault()):-1===M.keysUp.indexOf(b.keyCode)&&-1===M.keysDown.indexOf(b.keyCode)&&-1===M.keysLeft.indexOf(b.keyCode)&&-1===M.keysRight.indexOf(b.keyCode)&&-1===M.keysUpward.indexOf(b.keyCode)&&-1===M.keysDownward.indexOf(b.keyCode)&&-1===M.keysRotateLeft.indexOf(b.keyCode)&&-1===M.keysRotateRight.indexOf(b.keyCode)||((K=M._keys.indexOf(b.keyCode))>=0&&M._keys.splice(K,1),Z||b.preventDefault()))})))},Z.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},Z.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var Z=this.camera,M=0;M<this._keys.length;M++){var j=this._keys[M],K=Z._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(j)?Z._localDirection.copyFromFloats(-K,0,0):-1!==this.keysUp.indexOf(j)?Z._localDirection.copyFromFloats(0,0,K):-1!==this.keysRight.indexOf(j)?Z._localDirection.copyFromFloats(K,0,0):-1!==this.keysDown.indexOf(j)?Z._localDirection.copyFromFloats(0,0,-K):-1!==this.keysUpward.indexOf(j)?Z._localDirection.copyFromFloats(0,K,0):-1!==this.keysDownward.indexOf(j)?Z._localDirection.copyFromFloats(0,-K,0):-1!==this.keysRotateLeft.indexOf(j)?(Z._localDirection.copyFromFloats(0,0,0),Z.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(j)&&(Z._localDirection.copyFromFloats(0,0,0),Z.cameraRotation.y+=this._getLocalRotation()),Z.getScene().useRightHandedSystem&&(Z._localDirection.z*=-1),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),g.k.TransformNormalToRef(Z._localDirection,Z._cameraTransformMatrix,Z._transformedDirection),Z.cameraDirection.addInPlace(Z._transformedDirection)}},Z.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},Z.prototype._onLostFocus=function(){this._keys=[]},Z.prototype.getSimpleName=function(){return"keyboard"},Z.prototype._getLocalRotation=function(){var Z=this.rotationSpeed*this._engine.getDeltaTime()/1e3;return this.camera.getScene().useRightHandedSystem&&(Z*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(Z*=-1),Z},(0,K.l)([(0,b.z)()],Z.prototype,"keysUp",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysUpward",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysDown",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysDownward",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysLeft",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysRight",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"rotationSpeed",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysRotateLeft",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"keysRotateRight",void 0),Z}();Y.b.FreeCameraKeyboardMoveInput=s;var i=j(9271),a=j(25239),z=function(){function Z(Z){void 0===Z&&(Z=!0),this.touchEnabled=Z,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new i.b,this._allowCameraRotation=!0,this._currentActiveButton=-1}return Z.prototype.attachControl=function(Z){var M=this;Z=E.d.BackCompatCameraNoPreventDefault(arguments);var j=this.camera.getEngine(),K=j.getInputElement();this._pointerInput||(this._pointerInput=function(b){var g=b.event,O="touch"===g.pointerType;if(!j.isInVRExclusivePointerMode&&(M.touchEnabled||!O)&&(b.type===a.d.POINTERMOVE||-1!==M.buttons.indexOf(g.button))){var Q=g.srcElement||g.target;if(b.type!==a.d.POINTERDOWN||-1!==M._currentActiveButton&&!O)if(b.type!==a.d.POINTERUP||M._currentActiveButton!==g.button&&!O){if(b.type===a.d.POINTERMOVE)if(j.isPointerLock&&M._onMouseMove)M._onMouseMove(b.event);else if(M._previousPosition){var Y=g.clientX-M._previousPosition.x,I=g.clientY-M._previousPosition.y;M.camera.getScene().useRightHandedSystem&&(Y*=-1),M.camera.parent&&M.camera.parent._getWorldMatrixDeterminant()<0&&(Y*=-1),M._allowCameraRotation&&(M.camera.cameraRotation.y+=Y/M.angularSensibility,M.camera.cameraRotation.x+=I/M.angularSensibility),M.onPointerMovedObservable.notifyObservers({offsetX:Y,offsetY:I}),M._previousPosition={x:g.clientX,y:g.clientY},Z||g.preventDefault()}}else{try{null===Q||void 0===Q||Q.releasePointerCapture(g.pointerId)}catch(Z){}M._currentActiveButton=-1,M._previousPosition=null,Z||g.preventDefault()}else{try{null===Q||void 0===Q||Q.setPointerCapture(g.pointerId)}catch(Z){}-1===M._currentActiveButton&&(M._currentActiveButton=g.button),M._previousPosition={x:g.clientX,y:g.clientY},Z||(g.preventDefault(),K&&K.focus()),j.isPointerLock&&M._onMouseMove&&M._onMouseMove(b.event)}}}),this._onMouseMove=function(K){if(j.isPointerLock&&!j.isInVRExclusivePointerMode){var b=K.movementX||K.mozMovementX||K.webkitMovementX||K.msMovementX||0;M.camera.getScene().useRightHandedSystem&&(b*=-1),M.camera.parent&&M.camera.parent._getWorldMatrixDeterminant()<0&&(b*=-1),M.camera.cameraRotation.y+=b/M.angularSensibility;var g=K.movementY||K.mozMovementY||K.webkitMovementY||K.msMovementY||0;M.camera.cameraRotation.x+=g/M.angularSensibility,M._previousPosition=null,Z||K.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,a.d.POINTERDOWN|a.d.POINTERUP|a.d.POINTERMOVE),K&&(this._contextMenuBind=this.onContextMenu.bind(this),K.addEventListener("contextmenu",this._contextMenuBind,!1))},Z.prototype.onContextMenu=function(Z){Z.preventDefault()},Z.prototype.detachControl=function(){if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._contextMenuBind){var Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._currentActiveButton=-1},Z.prototype.getClassName=function(){return"FreeCameraMouseInput"},Z.prototype.getSimpleName=function(){return"mouse"},(0,K.l)([(0,b.z)()],Z.prototype,"buttons",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"angularSensibility",void 0),Z}();Y.b.FreeCameraMouseInput=z;var V,o=j(13316),c=function(){function Z(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new i.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}return Z.prototype.attachControl=function(Z){var M=this;this._wheel=function(Z){if(Z.type===a.d.POINTERWHEEL){var j=Z.event,K=j.deltaMode===o.e.DOM_DELTA_LINE?M._ffMultiplier:1;void 0!==j.deltaY?(M._wheelDeltaX+=M.wheelPrecisionX*K*j.deltaX/M._normalize,M._wheelDeltaY-=M.wheelPrecisionY*K*j.deltaY/M._normalize,M._wheelDeltaZ+=M.wheelPrecisionZ*K*j.deltaZ/M._normalize):void 0!==j.wheelDeltaY?(M._wheelDeltaX+=M.wheelPrecisionX*K*j.wheelDeltaX/M._normalize,M._wheelDeltaY-=M.wheelPrecisionY*K*j.wheelDeltaY/M._normalize,M._wheelDeltaZ+=M.wheelPrecisionZ*K*j.wheelDeltaZ/M._normalize):j.wheelDelta&&(M._wheelDeltaY-=M.wheelPrecisionY*j.wheelDelta/M._normalize)}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,a.d.POINTERWHEEL)},Z.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()},Z.prototype.checkInputs=function(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0},Z.prototype.getClassName=function(){return"BaseCameraMouseWheelInput"},Z.prototype.getSimpleName=function(){return"mousewheel"},(0,K.l)([(0,b.z)()],Z.prototype,"wheelPrecisionX",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"wheelPrecisionY",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"wheelPrecisionZ",void 0),Z}(),G=j(54044);!function(Z){Z[Z.MoveRelative=0]="MoveRelative",Z[Z.RotateRelative=1]="RotateRelative",Z[Z.MoveScene=2]="MoveScene"}(V||(V={}));var f=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M._moveRelative=g.k.Zero(),M._rotateRelative=g.k.Zero(),M._moveScene=g.k.Zero(),M._wheelXAction=V.MoveRelative,M._wheelXActionCoordinate=G.c.X,M._wheelYAction=V.MoveRelative,M._wheelYActionCoordinate=G.c.Z,M._wheelZAction=null,M._wheelZActionCoordinate=null,M}return(0,K.m)(M,Z),M.prototype.getClassName=function(){return"FreeCameraMouseWheelInput"},Object.defineProperty(M.prototype,"wheelXMoveRelative",{get:function(){return this._wheelXAction!==V.MoveRelative?null:this._wheelXActionCoordinate},set:function(Z){null===Z&&this._wheelXAction!==V.MoveRelative||(this._wheelXAction=V.MoveRelative,this._wheelXActionCoordinate=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wheelYMoveRelative",{get:function(){return this._wheelYAction!==V.MoveRelative?null:this._wheelYActionCoordinate},set:function(Z){null===Z&&this._wheelYAction!==V.MoveRelative||(this._wheelYAction=V.MoveRelative,this._wheelYActionCoordinate=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wheelZMoveRelative",{get:function(){return this._wheelZAction!==V.MoveRelative?null:this._wheelZActionCoordinate},set:function(Z){null===Z&&this._wheelZAction!==V.MoveRelative||(this._wheelZAction=V.MoveRelative,this._wheelZActionCoordinate=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wheelXRotateRelative",{get:function(){return this._wheelXAction!==V.RotateRelative?null:this._wheelXActionCoordinate},set:function(Z){null===Z&&this._wheelXAction!==V.RotateRelative||(this._wheelXAction=V.RotateRelative,this._wheelXActionCoordinate=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wheelYRotateRelative",{get:function(){return this._wheelYAction!==V.RotateRelative?null:this._wheelYActionCoordinate},set:function(Z){null===Z&&this._wheelYAction!==V.RotateRelative||(this._wheelYAction=V.RotateRelative,this._wheelYActionCoordinate=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wheelZRotateRelative",{get:function(){return this._wheelZAction!==V.RotateRelative?null:this._wheelZActionCoordinate},set:function(Z){null===Z&&this._wheelZAction!==V.RotateRelative||(this._wheelZAction=V.RotateRelative,this._wheelZActionCoordinate=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wheelXMoveScene",{get:function(){return this._wheelXAction!==V.MoveScene?null:this._wheelXActionCoordinate},set:function(Z){null===Z&&this._wheelXAction!==V.MoveScene||(this._wheelXAction=V.MoveScene,this._wheelXActionCoordinate=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wheelYMoveScene",{get:function(){return this._wheelYAction!==V.MoveScene?null:this._wheelYActionCoordinate},set:function(Z){null===Z&&this._wheelYAction!==V.MoveScene||(this._wheelYAction=V.MoveScene,this._wheelYActionCoordinate=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wheelZMoveScene",{get:function(){return this._wheelZAction!==V.MoveScene?null:this._wheelZActionCoordinate},set:function(Z){null===Z&&this._wheelZAction!==V.MoveScene||(this._wheelZAction=V.MoveScene,this._wheelZActionCoordinate=Z)},enumerable:!1,configurable:!0}),M.prototype.checkInputs=function(){if(0!==this._wheelDeltaX||0!==this._wheelDeltaY||0!=this._wheelDeltaZ){this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);var M=g.c.Zero();this.camera.getViewMatrix().invertToRef(M);var j=g.k.Zero();g.k.TransformNormalToRef(this._moveRelative,M,j),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(j),this.camera.cameraDirection.addInPlace(this._moveScene),Z.prototype.checkInputs.call(this)}},M.prototype._updateCamera=function(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)},M.prototype._updateCameraProperty=function(Z,M,j){if(0!==Z&&null!==M&&null!==j){var K=null;switch(M){case V.MoveRelative:K=this._moveRelative;break;case V.RotateRelative:K=this._rotateRelative;break;case V.MoveScene:K=this._moveScene}switch(j){case G.c.X:K.set(Z,0,0);break;case G.c.Y:K.set(0,Z,0);break;case G.c.Z:K.set(0,0,Z)}}},(0,K.l)([(0,b.z)()],M.prototype,"wheelXMoveRelative",null),(0,K.l)([(0,b.z)()],M.prototype,"wheelYMoveRelative",null),(0,K.l)([(0,b.z)()],M.prototype,"wheelZMoveRelative",null),(0,K.l)([(0,b.z)()],M.prototype,"wheelXRotateRelative",null),(0,K.l)([(0,b.z)()],M.prototype,"wheelYRotateRelative",null),(0,K.l)([(0,b.z)()],M.prototype,"wheelZRotateRelative",null),(0,K.l)([(0,b.z)()],M.prototype,"wheelXMoveScene",null),(0,K.l)([(0,b.z)()],M.prototype,"wheelYMoveScene",null),(0,K.l)([(0,b.z)()],M.prototype,"wheelZMoveScene",null),M}(c);Y.b.FreeCameraMouseWheelInput=f;var X=function(){function Z(Z){void 0===Z&&(Z=!1),this.allowMouse=Z,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=E.d.IsSafari()}return Z.prototype.attachControl=function(Z){var M=this;Z=E.d.BackCompatCameraNoPreventDefault(arguments);var j=null;if(void 0===this._pointerInput&&(this._onLostFocus=function(){M._offsetX=null,M._offsetY=null},this._pointerInput=function(K){var b=K.event,g="mouse"===b.pointerType||M._isSafari&&"undefined"===typeof b.pointerType;if(M.allowMouse||!g)if(K.type===a.d.POINTERDOWN){if(Z||b.preventDefault(),M._pointerPressed.push(b.pointerId),1!==M._pointerPressed.length)return;j={x:b.clientX,y:b.clientY}}else if(K.type===a.d.POINTERUP){if(Z||b.preventDefault(),-1===(O=M._pointerPressed.indexOf(b.pointerId)))return;if(M._pointerPressed.splice(O,1),0!=O)return;j=null,M._offsetX=null,M._offsetY=null}else if(K.type===a.d.POINTERMOVE){if(Z||b.preventDefault(),!j)return;var O;if(0!=(O=M._pointerPressed.indexOf(b.pointerId)))return;M._offsetX=b.clientX-j.x,M._offsetY=-(b.clientY-j.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,a.d.POINTERDOWN|a.d.POINTERUP|a.d.POINTERMOVE),this._onLostFocus){var K=this.camera.getEngine(),b=K.getInputElement();b&&b.addEventListener("blur",this._onLostFocus)}},Z.prototype.detachControl=function(){if(this._pointerInput){if(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus){var Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed=[],this._offsetX=null,this._offsetY=null}},Z.prototype.checkInputs=function(){if(null!==this._offsetX&&null!==this._offsetY&&(0!==this._offsetX||0!==this._offsetY)){var Z=this.camera;if(Z.cameraRotation.y=this._offsetX/this.touchAngularSensibility,this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)Z.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{var M=Z._computeLocalCameraSpeed(),j=new g.k(0,0,0!==this.touchMoveSensibility?M*this._offsetY/this.touchMoveSensibility:0);g.c.RotationYawPitchRollToRef(Z.rotation.y,Z.rotation.x,0,Z._cameraRotationMatrix),Z.cameraDirection.addInPlace(g.k.TransformCoordinates(j,Z._cameraRotationMatrix))}}},Z.prototype.getClassName=function(){return"FreeCameraTouchInput"},Z.prototype.getSimpleName=function(){return"touch"},(0,K.l)([(0,b.z)()],Z.prototype,"touchAngularSensibility",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"touchMoveSensibility",void 0),Z}();Y.b.FreeCameraTouchInput=X;var d=function(Z){function M(M){var j=Z.call(this,M)||this;return j._mouseInput=null,j._mouseWheelInput=null,j}return(0,K.m)(M,Z),M.prototype.addKeyboard=function(){return this.add(new s),this},M.prototype.addMouse=function(Z){return void 0===Z&&(Z=!0),this._mouseInput||(this._mouseInput=new z(Z),this.add(this._mouseInput)),this},M.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},M.prototype.addMouseWheel=function(){return this._mouseWheelInput||(this._mouseWheelInput=new f,this.add(this._mouseWheelInput)),this},M.prototype.removeMouseWheel=function(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this},M.prototype.addTouch=function(){return this.add(new X),this},M.prototype.clear=function(){Z.prototype.clear.call(this),this._mouseInput=null},M}(Y.f),W=function(Z){function M(M,j,K,b){void 0===b&&(b=!0);var Q=Z.call(this,M,j,K,b)||this;return Q.ellipsoid=new g.k(.5,1,.5),Q.ellipsoidOffset=new g.k(0,0,0),Q.checkCollisions=!1,Q.applyGravity=!1,Q._needMoveForGravity=!1,Q._oldPosition=g.k.Zero(),Q._diffPosition=g.k.Zero(),Q._newPosition=g.k.Zero(),Q._collisionMask=-1,Q._onCollisionPositionChange=function(Z,M,j){void 0===j&&(j=null);var K;K=M,Q._newPosition.copyFrom(K),Q._newPosition.subtractToRef(Q._oldPosition,Q._diffPosition),Q._diffPosition.length()>O.c.CollisionsEpsilon&&(Q.position.addInPlace(Q._diffPosition),Q.onCollide&&j&&Q.onCollide(j))},Q.inputs=new d(Q),Q.inputs.addKeyboard().addMouse(),Q}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"angularSensibility",{get:function(){var Z=this.inputs.attached.mouse;return Z?Z.angularSensibility:0},set:function(Z){var M=this.inputs.attached.mouse;M&&(M.angularSensibility=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysUp",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysUp=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysUpward",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysUpward:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysUpward=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysDown",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysDown=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysDownward",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysDownward:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysDownward=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysLeft",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysLeft=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysRight",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysRight=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysRotateLeft",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysRotateLeft:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysRotateLeft=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"keysRotateRight",{get:function(){var Z=this.inputs.attached.keyboard;return Z?Z.keysRotateRight:[]},set:function(Z){var M=this.inputs.attached.keyboard;M&&(M.keysRotateRight=Z)},enumerable:!1,configurable:!0}),M.prototype.attachControl=function(Z,M){M=E.d.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(M)},M.prototype.detachControl=function(){this.inputs.detachElement(),this.cameraDirection=new g.k(0,0,0),this.cameraRotation=new g.h(0,0)},Object.defineProperty(M.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(Z){this._collisionMask=isNaN(Z)?-1:Z},enumerable:!1,configurable:!0}),M.prototype._collideWithWorld=function(Z){(this.parent?g.k.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var M=this.getScene().collisionCoordinator;this._collider||(this._collider=M.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var j=Z;this.applyGravity&&(j=Z.add(this.getScene().gravity)),M.getNewPosition(this._oldPosition,j,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},M.prototype._checkInputs=function(){this._localDirection||(this._localDirection=g.k.Zero(),this._transformedDirection=g.k.Zero()),this.inputs.checkInputs(),Z.prototype._checkInputs.call(this)},M.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},M.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):Z.prototype._updatePosition.call(this)},M.prototype.dispose=function(){this.inputs.clear(),Z.prototype.dispose.call(this)},M.prototype.getClassName=function(){return"FreeCamera"},(0,K.l)([(0,b.x)()],M.prototype,"ellipsoid",void 0),(0,K.l)([(0,b.x)()],M.prototype,"ellipsoidOffset",void 0),(0,K.l)([(0,b.z)()],M.prototype,"checkCollisions",void 0),(0,K.l)([(0,b.z)()],M.prototype,"applyGravity",void 0),M}(Q.e)},2517:function(Z,M,j){"use strict";j.d(M,{e:function(){return I}});var K=j(40061),b=j(9892),g=j(37643),O=j(80105),Q=j(61686),Y=j(54044),I=function(Z){function M(M,j,K,b){void 0===b&&(b=!0);var g=Z.call(this,M,j,K,b)||this;return g._tmpUpVector=O.k.Zero(),g._tmpTargetVector=O.k.Zero(),g.cameraDirection=new O.k(0,0,0),g.cameraRotation=new O.h(0,0),g.ignoreParentScaling=!1,g.updateUpVectorFromRotation=!1,g._tmpQuaternion=new O.d,g.rotation=new O.k(0,0,0),g.speed=2,g.noRotationConstraint=!1,g.invertRotation=!1,g.inverseRotationSpeed=.2,g.lockedTarget=null,g._currentTarget=O.k.Zero(),g._initialFocalDistance=1,g._viewMatrix=O.c.Zero(),g._camMatrix=O.c.Zero(),g._cameraTransformMatrix=O.c.Zero(),g._cameraRotationMatrix=O.c.Zero(),g._referencePoint=new O.k(0,0,1),g._transformedReferencePoint=O.k.Zero(),g._defaultUp=O.k.Up(),g._cachedRotationZ=0,g._cachedQuaternionRotationZ=0,g}return(0,K.m)(M,Z),M.prototype.getFrontPosition=function(Z){this.getWorldMatrix();var M=this.getTarget().subtract(this.position);return M.normalize(),M.scaleInPlace(Z),this.globalPosition.add(M)},M.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},M.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),Z.prototype.storeState.call(this)},M.prototype._restoreStateValues=function(){return!!Z.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},M.prototype._initCache=function(){Z.prototype._initCache.call(this),this._cache.lockedTarget=new O.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new O.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new O.d(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},M.prototype._updateCache=function(M){M||Z.prototype._updateCache.call(this);var j=this._getLockedTargetPosition();j?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(j):this._cache.lockedTarget=j.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},M.prototype._isSynchronizedViewMatrix=function(){if(!Z.prototype._isSynchronizedViewMatrix.call(this))return!1;var M=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(M):!M)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},M.prototype._computeLocalCameraSpeed=function(){var Z=this.getEngine();return this.speed*Math.sqrt(Z.getDeltaTime()/(100*Z.getFps()))},M.prototype.setTarget=function(Z){this.upVector.normalize(),this._initialFocalDistance=Z.subtract(this.position).length(),this.position.z===Z.z&&(this.position.z+=Q.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),O.c.LookAtLHToRef(this.position,Z,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var M=Z.subtract(this.position);M.x>=0?this.rotation.y=-Math.atan(M.z/M.x)+Math.PI/2:this.rotation.y=-Math.atan(M.z/M.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&O.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(M.prototype,"target",{get:function(){return this.getTarget()},set:function(Z){this.setTarget(Z)},enumerable:!1,configurable:!0}),M.prototype.getTarget=function(){return this._currentTarget},M.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},M.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(O.e.Matrix[0]),O.k.TransformNormalToRef(this.cameraDirection,O.e.Matrix[0],O.e.Vector3[0]),void this.position.addInPlace(O.e.Vector3[0]);this.position.addInPlace(this.cameraDirection)},M.prototype._checkInputs=function(){var M=this.invertRotation?-this.inverseRotationSpeed:1,j=this._decideIfNeedsToMove(),K=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(j&&this._updatePosition(),K){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*M,this.rotation.y+=this.cameraRotation.y*M,!this.noRotationConstraint){var b=1.570796;this.rotation.x>b&&(this.rotation.x=b),this.rotation.x<-b&&(this.rotation.x=-b)}if(this.rotationQuaternion)this.rotation.lengthSquared()&&O.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}j&&(Math.abs(this.cameraDirection.x)<this.speed*Q.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*Q.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*Q.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),K&&(Math.abs(this.cameraRotation.x)<this.speed*Q.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*Q.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),Z.prototype._checkInputs.call(this)},M.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):O.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},M.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return O.k.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},M.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),O.k.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Y.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(O.d.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Y.b.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},M.prototype._computeViewMatrix=function(Z,M,j){if(this.ignoreParentScaling){if(this.parent){var K=this.parent.getWorldMatrix();O.k.TransformCoordinatesToRef(Z,K,this._globalPosition),O.k.TransformCoordinatesToRef(M,K,this._tmpTargetVector),O.k.TransformNormalToRef(j,K,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(Z),this._tmpTargetVector.copyFrom(M),this._tmpUpVector.copyFrom(j);this.getScene().useRightHandedSystem?O.c.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):O.c.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?O.c.LookAtRHToRef(Z,M,j,this._viewMatrix):O.c.LookAtLHToRef(Z,M,j,this._viewMatrix),this.parent){K=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(K,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(Z)},M.prototype.createRigCamera=function(Z,j){if(this.cameraRigMode!==g.e.RIG_MODE_NONE){var K=new M(Z,this.position.clone(),this.getScene());return K.isRigCamera=!0,K.rigParent=this,this.cameraRigMode!==g.e.RIG_MODE_VR&&this.cameraRigMode!==g.e.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new O.d),K._cameraRigParams={},K.rotationQuaternion=new O.d),K}return null},M.prototype._updateRigCameras=function(){var M=this._rigCameras[0],j=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case g.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case g.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case g.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case g.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case g.e.RIG_MODE_STEREOSCOPIC_INTERLACED:var K=this.cameraRigMode===g.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,b=this.cameraRigMode===g.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*K,M),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*b,j);break;case g.e.RIG_MODE_VR:M.rotationQuaternion?(M.rotationQuaternion.copyFrom(this.rotationQuaternion),j.rotationQuaternion.copyFrom(this.rotationQuaternion)):(M.rotation.copyFrom(this.rotation),j.rotation.copyFrom(this.rotation)),M.position.copyFrom(this.position),j.position.copyFrom(this.position)}Z.prototype._updateRigCameras.call(this)},M.prototype._getRigCamPositionAndTarget=function(Z,j){this.getTarget().subtractToRef(this.position,M._TargetFocalPoint),M._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var K=M._TargetFocalPoint.addInPlace(this.position);O.c.TranslationToRef(-K.x,-K.y,-K.z,M._TargetTransformMatrix),M._TargetTransformMatrix.multiplyToRef(O.c.RotationAxis(j.upVector,Z),M._RigCamTransformMatrix),O.c.TranslationToRef(K.x,K.y,K.z,M._TargetTransformMatrix),M._RigCamTransformMatrix.multiplyToRef(M._TargetTransformMatrix,M._RigCamTransformMatrix),O.k.TransformCoordinatesToRef(this.position,M._RigCamTransformMatrix,j.position),j.setTarget(K)},M.prototype.getClassName=function(){return"TargetCamera"},M._RigCamTransformMatrix=new O.c,M._TargetTransformMatrix=new O.c,M._TargetFocalPoint=new O.k,(0,K.l)([(0,b.x)()],M.prototype,"rotation",void 0),(0,K.l)([(0,b.z)()],M.prototype,"speed",void 0),(0,K.l)([(0,b.p)("lockedTargetId")],M.prototype,"lockedTarget",void 0),M}(g.e)},16035:function(Z,M,j){"use strict";j.d(M,{b:function(){return K}});var K=function(Z,M,j){this.bu=Z,this.bv=M,this.distance=j,this.faceId=0,this.subMeshId=0}},44904:function(Z,M,j){"use strict";j.d(M,{b:function(){return g}});var K=j(80105),b=j(43251),g=function(){function Z(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}return Z.prototype.getNormal=function(Z,M){if(void 0===Z&&(Z=!1),void 0===M&&(M=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(b.f.NormalKind))return null;var j,g=this.pickedMesh.getIndices();if(!g)return null;if(M){var O=this.pickedMesh.getVerticesData(b.f.NormalKind),Q=K.k.FromArray(O,3*g[3*this.faceId]),Y=K.k.FromArray(O,3*g[3*this.faceId+1]),I=K.k.FromArray(O,3*g[3*this.faceId+2]);Q=Q.scale(this.bu),Y=Y.scale(this.bv),I=I.scale(1-this.bu-this.bv),j=new K.k(Q.x+Y.x+I.x,Q.y+Y.y+I.y,Q.z+Y.z+I.z)}else{var E=this.pickedMesh.getVerticesData(b.f.PositionKind),s=K.k.FromArray(E,3*g[3*this.faceId]),i=K.k.FromArray(E,3*g[3*this.faceId+1]),a=K.k.FromArray(E,3*g[3*this.faceId+2]),z=s.subtract(i),V=a.subtract(i);j=K.k.Cross(z,V)}if(Z){var o=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(K.e.Matrix[0].copyFrom(o),(o=K.e.Matrix[0]).setTranslationFromFloats(0,0,0),o.invert(),o.transposeToRef(K.e.Matrix[1]),o=K.e.Matrix[1]),j=K.k.TransformNormal(j,o)}return j.normalize(),j},Z.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(b.f.UVKind))return null;var Z=this.pickedMesh.getIndices();if(!Z)return null;var M=this.pickedMesh.getVerticesData(b.f.UVKind);if(!M)return null;var j=K.h.FromArray(M,2*Z[3*this.faceId]),g=K.h.FromArray(M,2*Z[3*this.faceId+1]),O=K.h.FromArray(M,2*Z[3*this.faceId+2]);return j=j.scale(this.bu),g=g.scale(this.bv),O=O.scale(1-this.bu-this.bv),new K.h(j.x+g.x+O.x,j.y+g.y+O.y)},Z}()},20334:function(Z,M,j){"use strict";j.d(M,{e:function(){return K}});var K=function(){function Z(){}return Z.UseOpenGLOrientationForUV=!1,Z}()},69382:function(Z,M,j){"use strict";j.d(M,{b:function(){return g}});var K=j(17190),b=j(87223),g=function(){function Z(Z,M,j){void 0===j&&(j=2),this.maxDepth=j,this.dynamicContent=new Array,this._maxBlockCapacity=M||64,this._selectionContent=new K.c(1024),this._creationFunc=Z}return Z.prototype.update=function(Z,M,j){b.d._CreateBlocks(Z,M,j,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},Z.prototype.addMesh=function(Z){for(var M=0;M<this.blocks.length;M++){this.blocks[M].addEntry(Z)}},Z.prototype.removeMesh=function(Z){for(var M=0;M<this.blocks.length;M++){this.blocks[M].removeEntry(Z)}},Z.prototype.select=function(Z,M){this._selectionContent.reset();for(var j=0;j<this.blocks.length;j++){this.blocks[j].select(Z,this._selectionContent,M)}return M?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},Z.prototype.intersects=function(Z,M,j){this._selectionContent.reset();for(var K=0;K<this.blocks.length;K++){this.blocks[K].intersects(Z,M,this._selectionContent,j)}return j?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},Z.prototype.intersectsRay=function(Z){this._selectionContent.reset();for(var M=0;M<this.blocks.length;M++){this.blocks[M].intersectsRay(Z,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},Z.CreationFuncForMeshes=function(Z,M){var j=Z.getBoundingInfo();!Z.isBlocked&&j.boundingBox.intersectsMinMax(M.minPoint,M.maxPoint)&&M.entries.push(Z)},Z.CreationFuncForSubMeshes=function(Z,M){Z.getBoundingInfo().boundingBox.intersectsMinMax(M.minPoint,M.maxPoint)&&M.entries.push(Z)},Z}()},87223:function(Z,M,j){"use strict";j.d(M,{d:function(){return g}});var K=j(80105),b=j(86724),g=function(){function Z(Z,M,j,K,b,g){this.entries=new Array,this._boundingVectors=new Array,this._capacity=j,this._depth=K,this._maxDepth=b,this._creationFunc=g,this._minPoint=Z,this._maxPoint=M,this._boundingVectors.push(Z.clone()),this._boundingVectors.push(M.clone()),this._boundingVectors.push(Z.clone()),this._boundingVectors[2].x=M.x,this._boundingVectors.push(Z.clone()),this._boundingVectors[3].y=M.y,this._boundingVectors.push(Z.clone()),this._boundingVectors[4].z=M.z,this._boundingVectors.push(M.clone()),this._boundingVectors[5].z=Z.z,this._boundingVectors.push(M.clone()),this._boundingVectors[6].x=Z.x,this._boundingVectors.push(M.clone()),this._boundingVectors[7].y=Z.y}return Object.defineProperty(Z.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!1,configurable:!0}),Z.prototype.addEntry=function(Z){if(this.blocks)for(var M=0;M<this.blocks.length;M++){this.blocks[M].addEntry(Z)}else this._creationFunc(Z,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},Z.prototype.removeEntry=function(Z){if(this.blocks)for(var M=0;M<this.blocks.length;M++){this.blocks[M].removeEntry(Z)}else{var j=this.entries.indexOf(Z);j>-1&&this.entries.splice(j,1)}},Z.prototype.addEntries=function(Z){for(var M=0;M<Z.length;M++){var j=Z[M];this.addEntry(j)}},Z.prototype.select=function(Z,M,j){if(b.e.IsInFrustum(this._boundingVectors,Z)){if(this.blocks){for(var K=0;K<this.blocks.length;K++){this.blocks[K].select(Z,M,j)}return}j?M.concat(this.entries):M.concatWithNoDuplicate(this.entries)}},Z.prototype.intersects=function(Z,M,j,K){if(b.e.IntersectsSphere(this._minPoint,this._maxPoint,Z,M)){if(this.blocks){for(var g=0;g<this.blocks.length;g++){this.blocks[g].intersects(Z,M,j,K)}return}K?j.concat(this.entries):j.concatWithNoDuplicate(this.entries)}},Z.prototype.intersectsRay=function(Z,M){if(Z.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var j=0;j<this.blocks.length;j++){this.blocks[j].intersectsRay(Z,M)}return}M.concatWithNoDuplicate(this.entries)}},Z.prototype.createInnerBlocks=function(){Z._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},Z._CreateBlocks=function(M,j,b,g,O,Q,Y,I){Y.blocks=new Array;for(var E=new K.k((j.x-M.x)/2,(j.y-M.y)/2,(j.z-M.z)/2),s=0;s<2;s++)for(var i=0;i<2;i++)for(var a=0;a<2;a++){var z=new Z(M.add(E.multiplyByFloats(s,i,a)),M.add(E.multiplyByFloats(s+1,i+1,a+1)),g,O+1,Q,I);z.addEntries(b),Y.blocks.push(z)}},Z}()},36642:function(Z,M,j){"use strict";j.d(M,{b:function(){return E}});var K=j(37105),b=j(80105),g=j(52644),O=j(11126),Q=j(21693),Y=j(69382),I=j(78588);K.c.prototype.createOrUpdateSelectionOctree=function(Z,M){void 0===Z&&(Z=64),void 0===M&&(M=2);var j=this._getComponent(Q.d.NAME_OCTREE);j||(j=new E(this),this._addComponent(j)),this._selectionOctree||(this._selectionOctree=new Y.b(Y.b.CreationFuncForMeshes,Z,M));var K=this.getWorldExtends();return this._selectionOctree.update(K.min,K.max,this.meshes),this._selectionOctree},Object.defineProperty(K.c.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),g.b.prototype.createOrUpdateSubmeshesOctree=function(Z,M){void 0===Z&&(Z=64),void 0===M&&(M=2);var j=this.getScene(),K=j._getComponent(Q.d.NAME_OCTREE);K||(K=new E(j),j._addComponent(K)),this._submeshesOctree||(this._submeshesOctree=new Y.b(Y.b.CreationFuncForSubMeshes,Z,M)),this.computeWorldMatrix(!0);var b=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(b.minimumWorld,b.maximumWorld,this.subMeshes),this._submeshesOctree};var E=function(){function Z(Z){this.name=Q.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new O.b(b.k.Zero(),new b.k(1,1,1)),(Z=Z||I.e.LastCreatedScene)&&(this.scene=Z,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this))}return Z.prototype.register=function(){var Z=this;this.scene.onMeshRemovedObservable.add((function(M){var j=Z.scene.selectionOctree;if(void 0!==j&&null!==j){var K=j.dynamicContent.indexOf(M);-1!==K&&j.dynamicContent.splice(K,1)}})),this.scene.onMeshImportedObservable.add((function(M){var j=Z.scene.selectionOctree;void 0!==j&&null!==j&&j.addMesh(M)}))},Z.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},Z.prototype.getActiveSubMeshCandidates=function(Z){return Z._submeshesOctree&&Z.useOctreeForRenderingSelection?Z._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(Z)},Z.prototype.getIntersectingSubMeshCandidates=function(Z,M){return Z._submeshesOctree&&Z.useOctreeForPicking?(O.b.TransformToRef(M,Z.getWorldMatrix(),this._tempRay),Z._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(Z)},Z.prototype.getCollidingSubMeshCandidates=function(Z,M){if(Z._submeshesOctree&&Z.useOctreeForCollisions){var j=M._velocityWorldLength+Math.max(M._radius.x,M._radius.y,M._radius.z);return Z._submeshesOctree.intersects(M._basePointWorld,j)}return this.scene._getDefaultSubMeshCandidates(Z)},Z.prototype.rebuild=function(){},Z.prototype.dispose=function(){},Z}()},86724:function(Z,M,j){"use strict";j.d(M,{e:function(){return O}});var K=j(89214),b=j(80105),g=j(61686),O=function(){function Z(Z,M,j){this.vectors=K.e.BuildArray(8,b.k.Zero),this.center=b.k.Zero(),this.centerWorld=b.k.Zero(),this.extendSize=b.k.Zero(),this.extendSizeWorld=b.k.Zero(),this.directions=K.e.BuildArray(3,b.k.Zero),this.vectorsWorld=K.e.BuildArray(8,b.k.Zero),this.minimumWorld=b.k.Zero(),this.maximumWorld=b.k.Zero(),this.minimum=b.k.Zero(),this.maximum=b.k.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(Z,M,j)}return Z.prototype.reConstruct=function(Z,M,j){var K=Z.x,g=Z.y,O=Z.z,Q=M.x,Y=M.y,I=M.z,E=this.vectors;this.minimum.copyFromFloats(K,g,O),this.maximum.copyFromFloats(Q,Y,I),E[0].copyFromFloats(K,g,O),E[1].copyFromFloats(Q,Y,I),E[2].copyFromFloats(Q,g,O),E[3].copyFromFloats(K,Y,O),E[4].copyFromFloats(K,g,I),E[5].copyFromFloats(Q,Y,O),E[6].copyFromFloats(K,Y,I),E[7].copyFromFloats(Q,g,I),M.addToRef(Z,this.center).scaleInPlace(.5),M.subtractToRef(Z,this.extendSize).scaleInPlace(.5),this._worldMatrix=j||b.c.IdentityReadOnly,this._update(this._worldMatrix)},Z.prototype.scale=function(M){var j=Z._TmpVector3,K=this.maximum.subtractToRef(this.minimum,j[0]),b=K.length();K.normalizeFromLength(b);var g=b*M,O=K.scaleInPlace(.5*g),Q=this.center.subtractToRef(O,j[1]),Y=this.center.addToRef(O,j[2]);return this.reConstruct(Q,Y,this._worldMatrix),this},Z.prototype.getWorldMatrix=function(){return this._worldMatrix},Z.prototype._update=function(Z){var M=this.minimumWorld,j=this.maximumWorld,K=this.directions,g=this.vectorsWorld,O=this.vectors;if(Z.isIdentity()){M.copyFrom(this.minimum),j.copyFrom(this.maximum);for(Q=0;Q<8;++Q)g[Q].copyFrom(O[Q]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{M.setAll(Number.MAX_VALUE),j.setAll(-Number.MAX_VALUE);for(var Q=0;Q<8;++Q){var Y=g[Q];b.k.TransformCoordinatesToRef(O[Q],Z,Y),M.minimizeInPlace(Y),j.maximizeInPlace(Y)}j.subtractToRef(M,this.extendSizeWorld).scaleInPlace(.5),j.addToRef(M,this.centerWorld).scaleInPlace(.5)}b.k.FromArrayToRef(Z.m,0,K[0]),b.k.FromArrayToRef(Z.m,4,K[1]),b.k.FromArrayToRef(Z.m,8,K[2]),this._worldMatrix=Z},Z.prototype.isInFrustum=function(M){return Z.IsInFrustum(this.vectorsWorld,M)},Z.prototype.isCompletelyInFrustum=function(M){return Z.IsCompletelyInFrustum(this.vectorsWorld,M)},Z.prototype.intersectsPoint=function(Z){var M=this.minimumWorld,j=this.maximumWorld,K=M.x,b=M.y,O=M.z,Q=j.x,Y=j.y,I=j.z,E=Z.x,s=Z.y,i=Z.z,a=-g.e;return!(Q-E<a||a>E-K)&&(!(Y-s<a||a>s-b)&&!(I-i<a||a>i-O))},Z.prototype.intersectsSphere=function(M){return Z.IntersectsSphere(this.minimumWorld,this.maximumWorld,M.centerWorld,M.radiusWorld)},Z.prototype.intersectsMinMax=function(Z,M){var j=this.minimumWorld,K=this.maximumWorld,b=j.x,g=j.y,O=j.z,Q=K.x,Y=K.y,I=K.z,E=Z.x,s=Z.y,i=Z.z,a=M.x,z=M.y,V=M.z;return!(Q<E||b>a)&&(!(Y<s||g>z)&&!(I<i||O>V))},Z.prototype.dispose=function(){var Z,M;null===(Z=this._drawWrapperFront)||void 0===Z||Z.dispose(),null===(M=this._drawWrapperBack)||void 0===M||M.dispose()},Z.Intersects=function(Z,M){return Z.intersectsMinMax(M.minimumWorld,M.maximumWorld)},Z.IntersectsSphere=function(M,j,K,g){var O=Z._TmpVector3[0];return b.k.ClampToRef(K,M,j,O),b.k.DistanceSquared(K,O)<=g*g},Z.IsCompletelyInFrustum=function(Z,M){for(var j=0;j<6;++j)for(var K=M[j],b=0;b<8;++b)if(K.dotCoordinate(Z[b])<0)return!1;return!0},Z.IsInFrustum=function(Z,M){for(var j=0;j<6;++j){for(var K=!0,b=M[j],g=0;g<8;++g)if(b.dotCoordinate(Z[g])>=0){K=!1;break}if(K)return!1}return!0},Z._TmpVector3=K.e.BuildArray(3,b.k.Zero),Z}()},97918:function(Z,M,j){"use strict";j.d(M,{c:function(){return s}});var K=j(89214),b=j(80105),g=j(86724),O=j(70176),Q={min:0,max:0},Y={min:0,max:0},I=function(Z,M,j){var K=b.k.Dot(M.centerWorld,Z),g=Math.abs(b.k.Dot(M.directions[0],Z))*M.extendSize.x+Math.abs(b.k.Dot(M.directions[1],Z))*M.extendSize.y+Math.abs(b.k.Dot(M.directions[2],Z))*M.extendSize.z;j.min=K-g,j.max=K+g},E=function(Z,M,j){return I(Z,M,Q),I(Z,j,Y),!(Q.min>Y.max||Y.min>Q.max)},s=function(){function Z(Z,M,j){this._isLocked=!1,this.boundingBox=new g.e(Z,M,j),this.boundingSphere=new O.c(Z,M,j)}return Z.prototype.reConstruct=function(Z,M,j){this.boundingBox.reConstruct(Z,M,j),this.boundingSphere.reConstruct(Z,M,j)},Object.defineProperty(Z.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isLocked",{get:function(){return this._isLocked},set:function(Z){this._isLocked=Z},enumerable:!1,configurable:!0}),Z.prototype.update=function(Z){this._isLocked||(this.boundingBox._update(Z),this.boundingSphere._update(Z))},Z.prototype.centerOn=function(M,j){var K=Z._TmpVector3[0].copyFrom(M).subtractInPlace(j),b=Z._TmpVector3[1].copyFrom(M).addInPlace(j);return this.boundingBox.reConstruct(K,b,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(K,b,this.boundingBox.getWorldMatrix()),this},Z.prototype.encapsulate=function(Z){var M=b.k.Minimize(this.minimum,Z),j=b.k.Maximize(this.maximum,Z);return this.reConstruct(M,j,this.boundingBox.getWorldMatrix()),this},Z.prototype.encapsulateBoundingInfo=function(Z){return this.encapsulate(Z.boundingBox.centerWorld.subtract(Z.boundingBox.extendSizeWorld)),this.encapsulate(Z.boundingBox.centerWorld.add(Z.boundingBox.extendSizeWorld)),this},Z.prototype.scale=function(Z){return this.boundingBox.scale(Z),this.boundingSphere.scale(Z),this},Z.prototype.isInFrustum=function(Z,M){return void 0===M&&(M=0),!(2!==M&&3!==M||!this.boundingSphere.isCenterInFrustum(Z))||!!this.boundingSphere.isInFrustum(Z)&&(!(1!==M&&3!==M)||this.boundingBox.isInFrustum(Z))},Object.defineProperty(Z.prototype,"diagonalLength",{get:function(){var M=this.boundingBox;return M.maximumWorld.subtractToRef(M.minimumWorld,Z._TmpVector3[0]).length()},enumerable:!1,configurable:!0}),Z.prototype.isCompletelyInFrustum=function(Z){return this.boundingBox.isCompletelyInFrustum(Z)},Z.prototype._checkCollision=function(Z){return Z._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},Z.prototype.intersectsPoint=function(Z){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(Z)&&!!this.boundingBox.intersectsPoint(Z))},Z.prototype.intersects=function(Z,M){if(!O.c.Intersects(this.boundingSphere,Z.boundingSphere))return!1;if(!g.e.Intersects(this.boundingBox,Z.boundingBox))return!1;if(!M)return!0;var j=this.boundingBox,K=Z.boundingBox;return!!E(j.directions[0],j,K)&&(!!E(j.directions[1],j,K)&&(!!E(j.directions[2],j,K)&&(!!E(K.directions[0],j,K)&&(!!E(K.directions[1],j,K)&&(!!E(K.directions[2],j,K)&&(!!E(b.k.Cross(j.directions[0],K.directions[0]),j,K)&&(!!E(b.k.Cross(j.directions[0],K.directions[1]),j,K)&&(!!E(b.k.Cross(j.directions[0],K.directions[2]),j,K)&&(!!E(b.k.Cross(j.directions[1],K.directions[0]),j,K)&&(!!E(b.k.Cross(j.directions[1],K.directions[1]),j,K)&&(!!E(b.k.Cross(j.directions[1],K.directions[2]),j,K)&&(!!E(b.k.Cross(j.directions[2],K.directions[0]),j,K)&&(!!E(b.k.Cross(j.directions[2],K.directions[1]),j,K)&&!!E(b.k.Cross(j.directions[2],K.directions[2]),j,K))))))))))))))},Z._TmpVector3=K.e.BuildArray(2,b.k.Zero),Z}()},70176:function(Z,M,j){"use strict";j.d(M,{c:function(){return g}});var K=j(89214),b=j(80105),g=function(){function Z(Z,M,j){this.center=b.k.Zero(),this.centerWorld=b.k.Zero(),this.minimum=b.k.Zero(),this.maximum=b.k.Zero(),this.reConstruct(Z,M,j)}return Z.prototype.reConstruct=function(Z,M,j){this.minimum.copyFrom(Z),this.maximum.copyFrom(M);var K=b.k.Distance(Z,M);M.addToRef(Z,this.center).scaleInPlace(.5),this.radius=.5*K,this._update(j||b.c.IdentityReadOnly)},Z.prototype.scale=function(M){var j=this.radius*M,K=Z._TmpVector3,b=K[0].setAll(j),g=this.center.subtractToRef(b,K[1]),O=this.center.addToRef(b,K[2]);return this.reConstruct(g,O,this._worldMatrix),this},Z.prototype.getWorldMatrix=function(){return this._worldMatrix},Z.prototype._update=function(M){if(M.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{b.k.TransformCoordinatesToRef(this.center,M,this.centerWorld);var j=Z._TmpVector3[0];b.k.TransformNormalFromFloatsToRef(1,1,1,M,j),this.radiusWorld=Math.max(Math.abs(j.x),Math.abs(j.y),Math.abs(j.z))*this.radius}},Z.prototype.isInFrustum=function(Z){for(var M=this.centerWorld,j=this.radiusWorld,K=0;K<6;K++)if(Z[K].dotCoordinate(M)<=-j)return!1;return!0},Z.prototype.isCenterInFrustum=function(Z){for(var M=this.centerWorld,j=0;j<6;j++)if(Z[j].dotCoordinate(M)<0)return!1;return!0},Z.prototype.intersectsPoint=function(Z){var M=b.k.DistanceSquared(this.centerWorld,Z);return!(this.radiusWorld*this.radiusWorld<M)},Z.Intersects=function(Z,M){var j=b.k.DistanceSquared(Z.centerWorld,M.centerWorld),K=Z.radiusWorld+M.radiusWorld;return!(K*K<j)},Z.CreateFromCenterAndRadius=function(M,j,K){this._TmpVector3[0].copyFrom(M),this._TmpVector3[1].copyFromFloats(0,0,j),this._TmpVector3[2].copyFrom(M),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);var g=new Z(this._TmpVector3[0],this._TmpVector3[2]);return g._worldMatrix=K||b.c.Identity(),g},Z._TmpVector3=K.e.BuildArray(3,b.k.Zero),Z}()},11126:function(Z,M,j){"use strict";j.d(M,{b:function(){return E}});var K=j(89214),b=j(80105),g=j(44904),O=j(16035),Q=j(37105),Y=j(37643),I=j(78588),E=function(){function Z(Z,M,j){void 0===j&&(j=Number.MAX_VALUE),this.origin=Z,this.direction=M,this.length=j}return Z.prototype.clone=function(){return new Z(this.origin.clone(),this.direction.clone(),this.length)},Z.prototype.intersectsBoxMinMax=function(M,j,K){void 0===K&&(K=0);var b,g,O,Q,Y=Z._TmpVector3[0].copyFromFloats(M.x-K,M.y-K,M.z-K),I=Z._TmpVector3[1].copyFromFloats(j.x+K,j.y+K,j.z+K),E=0,s=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<Y.x||this.origin.x>I.x)return!1}else if(b=1/this.direction.x,g=(Y.x-this.origin.x)*b,(O=(I.x-this.origin.x)*b)===-1/0&&(O=1/0),g>O&&(Q=g,g=O,O=Q),(E=Math.max(g,E))>(s=Math.min(O,s)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<Y.y||this.origin.y>I.y)return!1}else if(b=1/this.direction.y,g=(Y.y-this.origin.y)*b,(O=(I.y-this.origin.y)*b)===-1/0&&(O=1/0),g>O&&(Q=g,g=O,O=Q),(E=Math.max(g,E))>(s=Math.min(O,s)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<Y.z||this.origin.z>I.z)return!1}else if(b=1/this.direction.z,g=(Y.z-this.origin.z)*b,(O=(I.z-this.origin.z)*b)===-1/0&&(O=1/0),g>O&&(Q=g,g=O,O=Q),(E=Math.max(g,E))>(s=Math.min(O,s)))return!1;return!0},Z.prototype.intersectsBox=function(Z,M){return void 0===M&&(M=0),this.intersectsBoxMinMax(Z.minimum,Z.maximum,M)},Z.prototype.intersectsSphere=function(Z,M){void 0===M&&(M=0);var j=Z.center.x-this.origin.x,K=Z.center.y-this.origin.y,b=Z.center.z-this.origin.z,g=j*j+K*K+b*b,O=Z.radius+M,Q=O*O;if(g<=Q)return!0;var Y=j*this.direction.x+K*this.direction.y+b*this.direction.z;return!(Y<0)&&g-Y*Y<=Q},Z.prototype.intersectsTriangle=function(M,j,K){var g=Z._TmpVector3[0],Q=Z._TmpVector3[1],Y=Z._TmpVector3[2],I=Z._TmpVector3[3],E=Z._TmpVector3[4];j.subtractToRef(M,g),K.subtractToRef(M,Q),b.k.CrossToRef(this.direction,Q,Y);var s=b.k.Dot(g,Y);if(0===s)return null;var i=1/s;this.origin.subtractToRef(M,I);var a=b.k.Dot(I,Y)*i;if(a<0||a>1)return null;b.k.CrossToRef(I,g,E);var z=b.k.Dot(this.direction,E)*i;if(z<0||a+z>1)return null;var V=b.k.Dot(Q,E)*i;return V>this.length?null:new O.b(1-a-z,a,V)},Z.prototype.intersectsPlane=function(Z){var M,j=b.k.Dot(Z.normal,this.direction);if(Math.abs(j)<9.99999997475243e-7)return null;var K=b.k.Dot(Z.normal,this.origin);return(M=(-Z.d-K)/j)<0?M<-9.99999997475243e-7?null:0:M},Z.prototype.intersectsAxis=function(Z,M){switch(void 0===M&&(M=0),Z){case"y":return(j=(this.origin.y-M)/this.direction.y)>0?null:new b.k(this.origin.x+this.direction.x*-j,M,this.origin.z+this.direction.z*-j);case"x":return(j=(this.origin.x-M)/this.direction.x)>0?null:new b.k(M,this.origin.y+this.direction.y*-j,this.origin.z+this.direction.z*-j);case"z":var j;return(j=(this.origin.z-M)/this.direction.z)>0?null:new b.k(this.origin.x+this.direction.x*-j,this.origin.y+this.direction.y*-j,M);default:return null}},Z.prototype.intersectsMesh=function(M,j){var K=b.e.Matrix[0];return M.getWorldMatrix().invertToRef(K),this._tmpRay?Z.TransformToRef(this,K,this._tmpRay):this._tmpRay=Z.Transform(this,K),M.intersects(this._tmpRay,j)},Z.prototype.intersectsMeshes=function(Z,M,j){j?j.length=0:j=[];for(var K=0;K<Z.length;K++){var b=this.intersectsMesh(Z[K],M);b.hit&&j.push(b)}return j.sort(this._comparePickingInfo),j},Z.prototype._comparePickingInfo=function(Z,M){return Z.distance<M.distance?-1:Z.distance>M.distance?1:0},Z.prototype.intersectionSegment=function(M,j,K){var g=this.origin,O=b.e.Vector3[0],Q=b.e.Vector3[1],Y=b.e.Vector3[2],I=b.e.Vector3[3];j.subtractToRef(M,O),this.direction.scaleToRef(Z._Rayl,Y),g.addToRef(Y,Q),M.subtractToRef(g,I);var E,s,i=b.k.Dot(O,O),a=b.k.Dot(O,Y),z=b.k.Dot(Y,Y),V=b.k.Dot(O,I),o=b.k.Dot(Y,I),c=i*z-a*a,G=c,f=c;c<Z._Smallnum?(E=0,G=1,s=o,f=z):(s=i*o-a*V,(E=a*o-z*V)<0?(E=0,s=o,f=z):E>G&&(E=G,s=o+a,f=z)),s<0?(s=0,-V<0?E=0:-V>i?E=G:(E=-V,G=i)):s>f&&(s=f,-V+a<0?E=0:-V+a>i?E=G:(E=-V+a,G=i));var X=Math.abs(E)<Z._Smallnum?0:E/G,d=Math.abs(s)<Z._Smallnum?0:s/f,W=b.e.Vector3[4];Y.scaleToRef(d,W);var A=b.e.Vector3[5];O.scaleToRef(X,A),A.addInPlace(I);var q=b.e.Vector3[6];return A.subtractToRef(W,q),d>0&&d<=this.length&&q.lengthSquared()<K*K?A.length():-1},Z.prototype.update=function(M,j,K,g,O,Q,Y,I){if(void 0===I&&(I=!1),I){Z._RayDistant||(Z._RayDistant=Z.Zero()),Z._RayDistant.unprojectRayToRef(M,j,K,g,b.c.IdentityReadOnly,Q,Y);var E=b.e.Matrix[0];O.invertToRef(E),Z.TransformToRef(Z._RayDistant,E,this)}else this.unprojectRayToRef(M,j,K,g,O,Q,Y);return this},Z.Zero=function(){return new Z(b.k.Zero(),b.k.Zero())},Z.CreateNew=function(M,j,K,b,g,O,Q){return Z.Zero().update(M,j,K,b,g,O,Q)},Z.CreateNewFromTo=function(M,j,K){void 0===K&&(K=b.c.IdentityReadOnly);var g=j.subtract(M),O=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);return g.normalize(),Z.Transform(new Z(M,g,O),K)},Z.Transform=function(M,j){var K=new Z(new b.k(0,0,0),new b.k(0,0,0));return Z.TransformToRef(M,j,K),K},Z.TransformToRef=function(Z,M,j){b.k.TransformCoordinatesToRef(Z.origin,M,j.origin),b.k.TransformNormalToRef(Z.direction,M,j.direction),j.length=Z.length;var K=j.direction,g=K.length();if(0!==g&&1!==g){var O=1/g;K.x*=O,K.y*=O,K.z*=O,j.length*=g}},Z.prototype.unprojectRayToRef=function(Z,M,j,K,g,O,Q){var Y,E=b.e.Matrix[0];g.multiplyToRef(O,E),E.multiplyToRef(Q,E),E.invert();var s=b.e.Vector3[0];s.x=Z/j*2-1,s.y=-(M/K*2-1),s.z=(null===(Y=I.e.LastCreatedEngine)||void 0===Y?void 0:Y.isNDCHalfZRange)?0:-1;var i=b.e.Vector3[1].copyFromFloats(s.x,s.y,1-1e-8),a=b.e.Vector3[2],z=b.e.Vector3[3];b.k._UnprojectFromInvertedMatrixToRef(s,E,a),b.k._UnprojectFromInvertedMatrixToRef(i,E,z),this.origin.copyFrom(a),z.subtractToRef(a,this.direction),this.direction.normalize()},Z._TmpVector3=K.e.BuildArray(6,b.k.Zero),Z._RayDistant=Z.Zero(),Z._Smallnum=1e-8,Z._Rayl=1e9,Z}();Q.c.prototype.createPickingRay=function(Z,M,j,K,b){void 0===b&&(b=!1);var g=E.Zero();return this.createPickingRayToRef(Z,M,j,g,K,b),g},Q.c.prototype.createPickingRayToRef=function(Z,M,j,K,g,O,Q){void 0===O&&(O=!1),void 0===Q&&(Q=!1);var Y=this.getEngine();if(!g){if(!this.activeCamera)return this;g=this.activeCamera}var I=g.viewport.toGlobal(Y.getRenderWidth(),Y.getRenderHeight());return Z=Z/Y.getHardwareScalingLevel()-I.x,M=M/Y.getHardwareScalingLevel()-(Y.getRenderHeight()-I.y-I.height),K.update(Z,M,I.width,I.height,j||b.c.IdentityReadOnly,O?b.c.IdentityReadOnly:g.getViewMatrix(),g.getProjectionMatrix(),Q),this},Q.c.prototype.createPickingRayInCameraSpace=function(Z,M,j){var K=E.Zero();return this.createPickingRayInCameraSpaceToRef(Z,M,K,j),K},Q.c.prototype.createPickingRayInCameraSpaceToRef=function(Z,M,j,K){if(!g.b)return this;var O=this.getEngine();if(!K){if(!this.activeCamera)throw new Error("Active camera not set");K=this.activeCamera}var Q=K.viewport.toGlobal(O.getRenderWidth(),O.getRenderHeight()),Y=b.c.Identity();return Z=Z/O.getHardwareScalingLevel()-Q.x,M=M/O.getHardwareScalingLevel()-(O.getRenderHeight()-Q.y-Q.height),j.update(Z,M,Q.width,Q.height,Y,Y,K.getProjectionMatrix()),this},Q.c.prototype._internalPickForMesh=function(Z,M,j,K,b,g,O,Q){var Y=M(K,j.enableDistantPicking),I=j.intersects(Y,b,O,g,K,Q);return I&&I.hit?!b&&null!=Z&&I.distance>=Z.distance?null:I:null},Q.c.prototype._internalPick=function(Z,M,j,K,O){if(!g.b)return null;for(var Q=null,Y=0;Y<this.meshes.length;Y++){var I=this.meshes[Y];if(M){if(!M(I))continue}else if(!I.isEnabled()||!I.isVisible||!I.isPickable)continue;var E,s=I.getWorldMatrix();if(I.hasThinInstances&&I.thinInstanceEnablePicking){if(E=this._internalPickForMesh(Q,Z,I,s,!0,!0,O)){if(K)return E;for(var i=b.e.Matrix[1],a=I.thinInstanceGetWorldMatrices(),z=0;z<a.length;z++){a[z].multiplyToRef(s,i);var V=this._internalPickForMesh(Q,Z,I,i,j,K,O,!0);if(V&&((Q=V).thinInstanceIndex=z,j))return Q}}}else if((E=this._internalPickForMesh(Q,Z,I,s,j,K,O))&&(Q=E,j))return Q}return Q||new g.b},Q.c.prototype._internalMultiPick=function(Z,M,j){if(!g.b)return null;for(var K=new Array,O=0;O<this.meshes.length;O++){var Q=this.meshes[O];if(M){if(!M(Q))continue}else if(!Q.isEnabled()||!Q.isVisible||!Q.isPickable)continue;var Y,I=Q.getWorldMatrix();if(Q.hasThinInstances&&Q.thinInstanceEnablePicking){if(Y=this._internalPickForMesh(null,Z,Q,I,!0,!0,j))for(var E=b.e.Matrix[1],s=Q.thinInstanceGetWorldMatrices(),i=0;i<s.length;i++){s[i].multiplyToRef(I,E);var a=this._internalPickForMesh(null,Z,Q,E,!1,!1,j,!0);a&&(a.thinInstanceIndex=i,K.push(a))}}else(Y=this._internalPickForMesh(null,Z,Q,I,!1,!1,j))&&K.push(Y)}return K},Q.c.prototype.pickWithBoundingInfo=function(Z,M,j,K,O){var Q=this;if(!g.b)return null;var Y=this._internalPick((function(j){return Q._tempPickingRay||(Q._tempPickingRay=E.Zero()),Q.createPickingRayToRef(Z,M,j,Q._tempPickingRay,O||null),Q._tempPickingRay}),j,K,!0);return Y&&(Y.ray=this.createPickingRay(Z,M,b.c.Identity(),O||null)),Y},Q.c.prototype.pick=function(Z,M,j,K,O,Q,Y){var I=this;if(void 0===Y&&(Y=!1),!g.b)return null;var s=this._internalPick((function(j,K){return I._tempPickingRay||(I._tempPickingRay=E.Zero()),I.createPickingRayToRef(Z,M,j,I._tempPickingRay,O||null,!1,K),I._tempPickingRay}),j,K,!1,Q);return s&&(s.ray=this.createPickingRay(Z,M,b.c.Identity(),O||null)),s},Q.c.prototype.pickWithRay=function(Z,M,j,K){var g=this,O=this._internalPick((function(M){return g._pickWithRayInverseMatrix||(g._pickWithRayInverseMatrix=b.c.Identity()),M.invertToRef(g._pickWithRayInverseMatrix),g._cachedRayForTransform||(g._cachedRayForTransform=E.Zero()),E.TransformToRef(Z,g._pickWithRayInverseMatrix,g._cachedRayForTransform),g._cachedRayForTransform}),M,j,!1,K);return O&&(O.ray=Z),O},Q.c.prototype.multiPick=function(Z,M,j,K,b){var g=this;return this._internalMultiPick((function(j){return g.createPickingRay(Z,M,j,K||null)}),j,b)},Q.c.prototype.multiPickWithRay=function(Z,M,j){var K=this;return this._internalMultiPick((function(M){return K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=b.c.Identity()),M.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=E.Zero()),E.TransformToRef(Z,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform}),M,j)},Y.e.prototype.getForwardRay=function(Z,M,j){return void 0===Z&&(Z=100),this.getForwardRayToRef(new E(b.k.Zero(),b.k.Zero(),Z),Z,M,j)},Y.e.prototype.getForwardRayToRef=function(Z,M,j,K){return void 0===M&&(M=100),j||(j=this.getWorldMatrix()),Z.length=M,K?Z.origin.copyFrom(K):Z.origin.copyFrom(this.position),b.e.Vector3[2].set(0,0,this._scene.useRightHandedSystem?-1:1),b.k.TransformNormalToRef(b.e.Vector3[2],j,b.e.Vector3[3]),b.k.NormalizeToRef(b.e.Vector3[3],Z.direction),Z}},54980:function(Z,M,j){"use strict";var K=j(72284);K.d.prototype.setAlphaConstants=function(Z,M,j,K){this._alphaState.setAlphaBlendConstants(Z,M,j,K)},K.d.prototype.setAlphaMode=function(Z,M){if(void 0===M&&(M=!1),this._alphaMode!==Z){switch(Z){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}M||(this.depthCullingState.depthMask=0===Z),this._alphaMode=Z}},K.d.prototype.getAlphaMode=function(){return this._alphaMode},K.d.prototype.setAlphaEquation=function(Z){if(this._alphaEquation!==Z){switch(Z){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=Z}},K.d.prototype.getAlphaEquation=function(){return this._alphaEquation}},37855:function(Z,M,j){"use strict";var K=j(72284);K.d.prototype.updateDynamicIndexBuffer=function(Z,M,j){var K;void 0===j&&(j=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(Z),K=Z.is32Bits?M instanceof Uint32Array?M:new Uint32Array(M):M instanceof Uint16Array?M:new Uint16Array(M),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,K,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},K.d.prototype.updateDynamicVertexBuffer=function(Z,M,j,K){this.bindArrayBuffer(Z),void 0===j&&(j=0);var b=M.byteLength||M.length;void 0===K||K>=b&&0===j?M instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,j,new Float32Array(M)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,j,M):M instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(M).subarray(j,j+K)):(M=M instanceof ArrayBuffer?new Uint8Array(M,j,K):new Uint8Array(M.buffer,M.byteOffset+j,K),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,M)),this._resetVertexBufferBinding()}},36125:function(Z,M,j){"use strict";var K=j(60766),b=j(9127),g=j(9217),O=j(72284);function Q(Z,M,j,K){var b,g=1;1===K?b=new Float32Array(M*j*4):2===K?(b=new Uint16Array(M*j*4),g=15360):b=7===K?new Uint32Array(M*j*4):new Uint8Array(M*j*4);for(var O=0;O<M;O++)for(var Q=0;Q<j;Q++){var Y=3*(Q*M+O),I=4*(Q*M+O);b[I+0]=Z[Y+0],b[I+1]=Z[Y+1],b[I+2]=Z[Y+2],b[I+3]=g}return b}function Y(Z){return function(M,j,b,g,O,Q,Y,I,E,s){void 0===E&&(E=null),void 0===s&&(s=0);var i=Z?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,a=Z?K.e.Raw3D:K.e.Raw2DArray,z=new K.h(this,a);z.baseWidth=j,z.baseHeight=b,z.baseDepth=g,z.width=j,z.height=b,z.depth=g,z.format=O,z.type=s,z.generateMipMaps=Q,z.samplingMode=I,Z?z.is3D=!0:z.is2DArray=!0,this._doNotHandleContextLost||(z._bufferView=M),Z?this.updateRawTexture3D(z,M,O,Y,E,s):this.updateRawTexture2DArray(z,M,O,Y,E,s),this._bindTextureDirectly(i,z,!0);var V=this._getSamplingParameters(I,Q);return this._gl.texParameteri(i,this._gl.TEXTURE_MAG_FILTER,V.mag),this._gl.texParameteri(i,this._gl.TEXTURE_MIN_FILTER,V.min),Q&&this._gl.generateMipmap(i),this._bindTextureDirectly(i,null),this._internalTexturesCache.push(z),z}}function I(Z){return function(M,j,K,b,g,O){void 0===g&&(g=null),void 0===O&&(O=0);var Q=Z?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,Y=this._getWebGLTextureType(O),I=this._getInternalFormat(K),E=this._getRGBABufferInternalSizedFormat(O,K);this._bindTextureDirectly(Q,M,!0),this._unpackFlipY(void 0===b||!!b),this._doNotHandleContextLost||(M._bufferView=j,M.format=K,M.invertY=b,M._compression=g),M.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),g&&j?this._gl.compressedTexImage3D(Q,0,this.getCaps().s3tc[g],M.width,M.height,M.depth,0,j):this._gl.texImage3D(Q,0,E,M.width,M.height,M.depth,0,I,Y,j),M.generateMipMaps&&this._gl.generateMipmap(Q),this._bindTextureDirectly(Q,null),M.isReady=!0}}O.d.prototype.updateRawTexture=function(Z,M,j,K,b,g,O){if(void 0===b&&(b=null),void 0===g&&(g=0),void 0===O&&(O=!1),Z){var Q=this._getRGBABufferInternalSizedFormat(g,j,O),Y=this._getInternalFormat(j),I=this._getWebGLTextureType(g);this._bindTextureDirectly(this._gl.TEXTURE_2D,Z,!0),this._unpackFlipY(void 0===K||!!K),this._doNotHandleContextLost||(Z._bufferView=M,Z.format=j,Z.type=g,Z.invertY=K,Z._compression=b),Z.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),b&&M?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[b],Z.width,Z.height,0,M):this._gl.texImage2D(this._gl.TEXTURE_2D,0,Q,Z.width,Z.height,0,Y,I,M),Z.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),Z.isReady=!0}},O.d.prototype.createRawTexture=function(Z,M,j,b,g,O,Q,Y,I,E,s){void 0===Y&&(Y=null),void 0===I&&(I=0),void 0===E&&(E=0),void 0===s&&(s=!1);var i=new K.h(this,K.e.Raw);i.baseWidth=M,i.baseHeight=j,i.width=M,i.height=j,i.format=b,i.generateMipMaps=g,i.samplingMode=Q,i.invertY=O,i._compression=Y,i.type=I,i._useSRGBBuffer=this._getUseSRGBBuffer(s,!g),this._doNotHandleContextLost||(i._bufferView=Z),this.updateRawTexture(i,Z,b,O,Y,I,i._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0);var a=this._getSamplingParameters(Q,g);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,a.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,a.min),g&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(i),i},O.d.prototype.createRawCubeTexture=function(Z,M,j,O,Q,Y,I,E){void 0===E&&(E=null);var s=this._gl,i=new K.h(this,K.e.CubeRaw);i.isCube=!0,i.format=j,i.type=O,this._doNotHandleContextLost||(i._bufferViewArray=Z);var a=this._getWebGLTextureType(O),z=this._getInternalFormat(j);z===s.RGB&&(z=s.RGBA),a!==s.FLOAT||this._caps.textureFloatLinearFiltering?a!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?a!==s.FLOAT||this._caps.textureFloatRender?a!==s.HALF_FLOAT||this._caps.colorBufferFloat||(Q=!1,b.c.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(Q=!1,b.c.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(Q=!1,I=1,b.c.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(Q=!1,I=1,b.c.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var V=M,o=V;i.width=V,i.height=o,!this.needPOTTextures||g.d.IsExponentOfTwo(i.width)&&g.d.IsExponentOfTwo(i.height)||(Q=!1),Z&&this.updateRawCubeTexture(i,Z,j,O,Y,E),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,i,!0),Z&&Q&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var c=this._getSamplingParameters(I,Q);return s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,c.mag),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,c.min),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null),i.generateMipMaps=Q,i.samplingMode=I,i},O.d.prototype.updateRawCubeTexture=function(Z,M,j,K,b,O,Y){void 0===O&&(O=null),void 0===Y&&(Y=0),Z._bufferViewArray=M,Z.format=j,Z.type=K,Z.invertY=b,Z._compression=O;var I=this._gl,E=this._getWebGLTextureType(K),s=this._getInternalFormat(j),i=this._getRGBABufferInternalSizedFormat(K),a=!1;s===I.RGB&&(s=I.RGBA,a=!0),this._bindTextureDirectly(I.TEXTURE_CUBE_MAP,Z,!0),this._unpackFlipY(void 0===b||!!b),Z.width%4!==0&&I.pixelStorei(I.UNPACK_ALIGNMENT,1);for(var z=0;z<6;z++){var V=M[z];O?I.compressedTexImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+z,Y,this.getCaps().s3tc[O],Z.width,Z.height,0,V):(a&&(V=Q(V,Z.width,Z.height,K)),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+z,Y,i,Z.width,Z.height,0,s,E,V))}(!this.needPOTTextures||g.d.IsExponentOfTwo(Z.width)&&g.d.IsExponentOfTwo(Z.height))&&Z.generateMipMaps&&0===Y&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),Z.isReady=!0},O.d.prototype.createRawCubeTextureFromUrl=function(Z,M,j,K,b,g,O,Y,I,E,s,i){var a=this;void 0===I&&(I=null),void 0===E&&(E=null),void 0===s&&(s=3),void 0===i&&(i=!1);var z=this._gl,V=this.createRawCubeTexture(null,j,K,b,!g,i,s,null);null===M||void 0===M||M._addPendingData(V),V.url=Z,this._internalTexturesCache.push(V);return this._loadFile(Z,(function(Z){!function(Z){var j=V.width,g=O(Z);if(g){if(Y){var E=a._getWebGLTextureType(b),s=a._getInternalFormat(K),o=a._getRGBABufferInternalSizedFormat(b),c=!1;s===z.RGB&&(s=z.RGBA,c=!0),a._bindTextureDirectly(z.TEXTURE_CUBE_MAP,V,!0),a._unpackFlipY(!1);for(var G=Y(g),f=0;f<G.length;f++)for(var X=j>>f,d=0;d<6;d++){var W=G[f][d];c&&(W=Q(W,X,X,b)),z.texImage2D(d,f,o,X,X,0,s,E,W)}a._bindTextureDirectly(z.TEXTURE_CUBE_MAP,null)}else a.updateRawCubeTexture(V,g,K,b,i);V.isReady=!0,null===M||void 0===M||M._removePendingData(V),V.onLoadedObservable.notifyObservers(V),V.onLoadedObservable.clear(),I&&I()}}(Z)}),void 0,null===M||void 0===M?void 0:M.offlineProvider,!0,(function(Z,j){null===M||void 0===M||M._removePendingData(V),E&&Z&&E(Z.status+" "+Z.statusText,j)})),V},O.d.prototype.createRawTexture2DArray=Y(!1),O.d.prototype.createRawTexture3D=Y(!0),O.d.prototype.updateRawTexture2DArray=I(!1),O.d.prototype.updateRawTexture3D=I(!0)},91156:function(Z,M,j){"use strict";var K=j(72284);K.d.prototype._readTexturePixelsSync=function(Z,M,j,K,b,g,O,Q,Y,I){var E,s;void 0===K&&(K=-1),void 0===b&&(b=0),void 0===g&&(g=null),void 0===O&&(O=!0),void 0===Q&&(Q=!1),void 0===Y&&(Y=0),void 0===I&&(I=0);var i=this._gl;if(!i)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var a=i.createFramebuffer();if(!a)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=a}i.bindFramebuffer(i.FRAMEBUFFER,this._dummyFramebuffer),K>-1?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+K,null===(E=Z._hardwareTexture)||void 0===E?void 0:E.underlyingResource,b):i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,null===(s=Z._hardwareTexture)||void 0===s?void 0:s.underlyingResource,b);var z=void 0!==Z.type?this._getWebGLTextureType(Z.type):i.UNSIGNED_BYTE;if(Q)g||(g=function(Z,M,j,K){switch(void 0===j&&(j=!1),Z){case 3:var b=(ArrayBuffer,new Int8Array(M));return K&&b.set(new Int8Array(K)),b;case 0:var g=(ArrayBuffer,new Uint8Array(M));return K&&g.set(new Uint8Array(K)),g;case 4:var O=M instanceof ArrayBuffer?new Int16Array(M):new Int16Array(j?M/2:M);return K&&O.set(new Int16Array(K)),O;case 5:case 8:case 9:case 10:case 2:var Q=M instanceof ArrayBuffer?new Uint16Array(M):new Uint16Array(j?M/2:M);return K&&Q.set(new Uint16Array(K)),Q;case 6:var Y=M instanceof ArrayBuffer?new Int32Array(M):new Int32Array(j?M/4:M);return K&&Y.set(new Int32Array(K)),Y;case 7:case 11:case 12:case 13:case 14:case 15:var I=M instanceof ArrayBuffer?new Uint32Array(M):new Uint32Array(j?M/4:M);return K&&I.set(new Uint32Array(K)),I;case 1:var E=M instanceof ArrayBuffer?new Float32Array(M):new Float32Array(j?M/4:M);return K&&E.set(new Float32Array(K)),E}var s=(ArrayBuffer,new Uint8Array(M));return K&&s.set(new Uint8Array(K)),s}(Z.type,4*M*j));else if(z===i.UNSIGNED_BYTE)g||(g=new Uint8Array(4*M*j)),z=i.UNSIGNED_BYTE;else g||(g=new Float32Array(4*M*j)),z=i.FLOAT;return O&&this.flushFramebuffer(),i.readPixels(Y,I,M,j,i.RGBA,z,g),i.bindFramebuffer(i.FRAMEBUFFER,this._currentFramebuffer),g},K.d.prototype._readTexturePixels=function(Z,M,j,K,b,g,O,Q,Y,I){return void 0===K&&(K=-1),void 0===b&&(b=0),void 0===g&&(g=null),void 0===O&&(O=!0),void 0===Q&&(Q=!1),void 0===Y&&(Y=0),void 0===I&&(I=0),Promise.resolve(this._readTexturePixelsSync(Z,M,j,K,b,g,O,Q,Y,I))}},84468:function(Z,M,j){"use strict";var K=j(40061),b=j(60766),g=j(9127),O=j(72284),Q=function(Z){function M(M,j,K,b,g){var O=Z.call(this,M,j,K,b)||this;return O._framebuffer=null,O._depthStencilBuffer=null,O._MSAAFramebuffer=null,O._colorTextureArray=null,O._depthStencilTextureArray=null,O._context=g,O}return(0,K.m)(M,Z),M.prototype._cloneRenderTargetWrapper=function(){var M=null;return this._colorTextureArray&&this._depthStencilTextureArray?(M=this._engine.createMultiviewRenderTargetTexture(this.width,this.height)).texture.isReady=!0:M=Z.prototype._cloneRenderTargetWrapper.call(this),M},M.prototype._swapRenderTargetWrapper=function(M){Z.prototype._swapRenderTargetWrapper.call(this,M),M._framebuffer=this._framebuffer,M._depthStencilBuffer=this._depthStencilBuffer,M._MSAAFramebuffer=this._MSAAFramebuffer,M._colorTextureArray=this._colorTextureArray,M._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null},M.prototype._shareDepth=function(M){Z.prototype._shareDepth.call(this,M);var j=this._context,K=this._depthStencilBuffer,b=M._framebuffer;M._depthStencilBuffer&&j.deleteRenderbuffer(M._depthStencilBuffer),M._depthStencilBuffer=this._depthStencilBuffer,this._engine._bindUnboundFramebuffer(b),j.framebufferRenderbuffer(j.FRAMEBUFFER,j.DEPTH_ATTACHMENT,j.RENDERBUFFER,K),this._engine._bindUnboundFramebuffer(null)},M.prototype._bindTextureRenderTarget=function(Z,M,j,K){if(void 0===M&&(M=0),void 0===j&&(j=-1),void 0===K&&(K=0),Z._hardwareTexture){var b=this._context,g=this._framebuffer,O=this._engine._currentFramebuffer;this._engine._bindUnboundFramebuffer(g);var Q=b[this._engine.webGLVersion>1?"COLOR_ATTACHMENT"+M:"COLOR_ATTACHMENT"+M+"_WEBGL"],Y=-1!==j?b.TEXTURE_CUBE_MAP_POSITIVE_X+j:b.TEXTURE_2D;b.framebufferTexture2D(b.FRAMEBUFFER,Q,Y,Z._hardwareTexture.underlyingResource,K),this._engine._bindUnboundFramebuffer(O)}},M.prototype.setTexture=function(M,j,K){void 0===j&&(j=0),void 0===K&&(K=!0),Z.prototype.setTexture.call(this,M,j,K),this._bindTextureRenderTarget(M,j)},M.prototype.dispose=function(M){void 0===M&&(M=!1);var j=this._context;M||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(j.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(j.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(j.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),Z.prototype.dispose.call(this,M)},M}(j(52311).b);O.d.prototype._createHardwareRenderTargetWrapper=function(Z,M,j){var K=new Q(Z,M,j,this,this._gl);return this._renderTargetWrapperCache.push(K),K},O.d.prototype.createRenderTargetTexture=function(Z,M){var j=this._createHardwareRenderTargetWrapper(!1,!1,Z),K={};void 0!==M&&"object"===typeof M?(K.generateDepthBuffer=!!M.generateDepthBuffer,K.generateStencilBuffer=!!M.generateStencilBuffer,K.noColorTarget=!!M.noColorTarget):(K.generateDepthBuffer=!0,K.generateStencilBuffer=!1,K.noColorTarget=!1);var g=K.noColorTarget?null:this._createInternalTexture(Z,M,!0,b.e.RenderTarget),O=Z.width||Z,Q=Z.height||Z,Y=this._currentFramebuffer,I=this._gl,E=I.createFramebuffer();return this._bindUnboundFramebuffer(E),j._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!K.generateStencilBuffer,K.generateDepthBuffer,O,Q),g&&!g.is2DArray&&I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,g._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(Y),j._framebuffer=E,j._generateDepthBuffer=K.generateDepthBuffer,j._generateStencilBuffer=!!K.generateStencilBuffer,j.setTextures(g),j},O.d.prototype.createDepthStencilTexture=function(Z,M,j){if(M.isCube){var K=Z.width||Z;return this._createDepthStencilCubeTexture(K,M,j)}return this._createDepthStencilTexture(Z,M,j)},O.d.prototype._createDepthStencilTexture=function(Z,M,j){var O=this._gl,Q=Z.layers||0,Y=0!==Q?O.TEXTURE_2D_ARRAY:O.TEXTURE_2D,I=new b.h(this,b.e.DepthStencil);if(!this._caps.depthTextureExtension)return g.c.Error("Depth texture is not supported by your browser or hardware."),I;var E=(0,K.e)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},M);if(this._bindTextureDirectly(Y,I,!0),this._setupDepthStencilTexture(I,Z,E.generateStencil,0!==E.comparisonFunction&&E.bilinearFiltering,E.comparisonFunction),void 0!==E.depthTextureFormat){if(15!==E.depthTextureFormat&&16!==E.depthTextureFormat&&17!==E.depthTextureFormat&&13!==E.depthTextureFormat&&14!==E.depthTextureFormat&&18!==E.depthTextureFormat)return g.c.Error("Depth texture format is not supported."),I;I.format=E.depthTextureFormat}else I.format=E.generateStencil?13:16;var s=17===I.format||13===I.format||18===I.format;j._depthStencilTexture=I,j._depthStencilTextureWithStencil=s;var i=O.UNSIGNED_INT;15===I.format?i=O.UNSIGNED_SHORT:17===I.format||13===I.format?i=O.UNSIGNED_INT_24_8:14===I.format?i=O.FLOAT:18===I.format&&(i=O.FLOAT_32_UNSIGNED_INT_24_8_REV);var a=s?O.DEPTH_STENCIL:O.DEPTH_COMPONENT,z=a;this.webGLVersion>1&&(15===I.format?z=O.DEPTH_COMPONENT16:16===I.format?z=O.DEPTH_COMPONENT24:17===I.format||13===I.format?z=O.DEPTH24_STENCIL8:14===I.format?z=O.DEPTH_COMPONENT32F:18===I.format&&(z=O.DEPTH32F_STENCIL8)),I.is2DArray?O.texImage3D(Y,0,z,I.width,I.height,Q,0,a,i,null):O.texImage2D(Y,0,z,I.width,I.height,0,a,i,null),this._bindTextureDirectly(Y,null),this._internalTexturesCache.push(I);var V=j;if(V._depthStencilBuffer){var o=this._currentFramebuffer;this._bindUnboundFramebuffer(V._framebuffer),O.framebufferRenderbuffer(O.FRAMEBUFFER,O.DEPTH_STENCIL_ATTACHMENT,O.RENDERBUFFER,null),O.framebufferRenderbuffer(O.FRAMEBUFFER,O.DEPTH_ATTACHMENT,O.RENDERBUFFER,null),O.framebufferRenderbuffer(O.FRAMEBUFFER,O.STENCIL_ATTACHMENT,O.RENDERBUFFER,null),this._bindUnboundFramebuffer(o),O.deleteRenderbuffer(V._depthStencilBuffer),V._depthStencilBuffer=null}return I},O.d.prototype.updateRenderTargetTextureSampleCount=function(Z,M){if(this.webGLVersion<2||!Z||!Z.texture)return 1;if(Z.samples===M)return M;var j=this._gl;M=Math.min(M,this.getCaps().maxMSAASamples),Z._depthStencilBuffer&&(j.deleteRenderbuffer(Z._depthStencilBuffer),Z._depthStencilBuffer=null),Z._MSAAFramebuffer&&(j.deleteFramebuffer(Z._MSAAFramebuffer),Z._MSAAFramebuffer=null);var K=Z.texture._hardwareTexture;if(K._MSAARenderBuffer&&(j.deleteRenderbuffer(K._MSAARenderBuffer),K._MSAARenderBuffer=null),M>1&&j.renderbufferStorageMultisample){var b=j.createFramebuffer();if(!b)throw new Error("Unable to create multi sampled framebuffer");Z._MSAAFramebuffer=b,this._bindUnboundFramebuffer(Z._MSAAFramebuffer);var g=this._createRenderBuffer(Z.texture.width,Z.texture.height,M,-1,this._getRGBAMultiSampleBufferFormat(Z.texture.type),j.COLOR_ATTACHMENT0,!1);if(!g)throw new Error("Unable to create multi sampled framebuffer");K._MSAARenderBuffer=g}else this._bindUnboundFramebuffer(Z._framebuffer);return Z.texture.samples=M,Z._depthStencilBuffer=this._setupFramebufferDepthAttachments(Z._generateStencilBuffer,Z._generateDepthBuffer,Z.texture.width,Z.texture.height,M),this._bindUnboundFramebuffer(null),M}},42373:function(Z,M,j){"use strict";var K=j(40061),b=j(60766),g=j(9127);j(72284).d.prototype.createRenderTargetCubeTexture=function(Z,M){var j=this._createHardwareRenderTargetWrapper(!1,!0,Z),O=(0,K.e)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5},M);O.generateStencilBuffer=O.generateDepthBuffer&&O.generateStencilBuffer,(1!==O.type||this._caps.textureFloatLinearFiltering)&&(2!==O.type||this._caps.textureHalfFloatLinearFiltering)||(O.samplingMode=1);var Q=this._gl,Y=new b.h(this,b.e.RenderTarget);this._bindTextureDirectly(Q.TEXTURE_CUBE_MAP,Y,!0);var I=this._getSamplingParameters(O.samplingMode,O.generateMipMaps);1!==O.type||this._caps.textureFloat||(O.type=0,g.c.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,I.mag),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,I.min),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE);for(var E=0;E<6;E++)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+E,0,this._getRGBABufferInternalSizedFormat(O.type,O.format),Z,Z,0,this._getInternalFormat(O.format),this._getWebGLTextureType(O.type),null);var s=Q.createFramebuffer();return this._bindUnboundFramebuffer(s),j._depthStencilBuffer=this._setupFramebufferDepthAttachments(O.generateStencilBuffer,O.generateDepthBuffer,Z,Z),O.generateMipMaps&&Q.generateMipmap(Q.TEXTURE_CUBE_MAP),this._bindTextureDirectly(Q.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),j._framebuffer=s,j._generateDepthBuffer=O.generateDepthBuffer,j._generateStencilBuffer=O.generateStencilBuffer,Y.width=Z,Y.height=Z,Y.isReady=!0,Y.isCube=!0,Y.samples=1,Y.generateMipMaps=O.generateMipMaps,Y.samplingMode=O.samplingMode,Y.type=O.type,Y.format=O.format,this._internalTexturesCache.push(Y),j.setTextures(Y),j}},42647:function(Z,M,j){"use strict";j.d(M,{b:function(){return G}});var K=function(){function Z(){this.children=[]}return Z.prototype.isValid=function(Z){return!0},Z.prototype.process=function(Z,M){var j="";if(this.line){var K=this.line,b=M.processor;if(b){if(b.lineProcessor&&(K=b.lineProcessor(K,M.isFragment,M.processingContext)),b.attributeProcessor&&this.line.startsWith("attribute"))K=b.attributeProcessor(this.line,Z,M.processingContext);else if(b.varyingProcessor&&this.line.startsWith("varying"))K=b.varyingProcessor(this.line,M.isFragment,Z,M.processingContext);else if(b.uniformProcessor&&b.uniformRegexp&&b.uniformRegexp.test(this.line))M.lookForClosingBracketForUniformBuffer||(K=b.uniformProcessor(this.line,M.isFragment,Z,M.processingContext));else if(b.uniformBufferProcessor&&b.uniformBufferRegexp&&b.uniformBufferRegexp.test(this.line))M.lookForClosingBracketForUniformBuffer||(K=b.uniformBufferProcessor(this.line,M.isFragment,M.processingContext),M.lookForClosingBracketForUniformBuffer=!0);else if(b.textureProcessor&&b.textureRegexp&&b.textureRegexp.test(this.line))K=b.textureProcessor(this.line,M.isFragment,Z,M.processingContext);else if((b.uniformProcessor||b.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!M.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?b.uniformProcessor&&(K=b.uniformProcessor(this.line,M.isFragment,Z,M.processingContext)):b.uniformBufferProcessor&&(K=b.uniformBufferProcessor(this.line,M.isFragment,M.processingContext),M.lookForClosingBracketForUniformBuffer=!0)}M.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(M.lookForClosingBracketForUniformBuffer=!1,b.endOfUniformBufferProcessor&&(K=b.endOfUniformBufferProcessor(this.line,M.isFragment,M.processingContext)))}j+=K+"\r\n"}return this.children.forEach((function(K){j+=K.process(Z,M)})),this.additionalDefineKey&&(Z[this.additionalDefineKey]=this.additionalDefineValue||"true"),j},Z}(),b=function(){function Z(){}return Object.defineProperty(Z.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"lines",{set:function(Z){this._lines=[];for(var M=0,j=Z;M<j.length;M++){var K=j[M];if("#"!==K[0])if(K.trim().startsWith("//"))this._lines.push(K);else for(var b=K.split(";"),g=0;g<b.length;g++){var O=b[g];(O=O.trim())&&this._lines.push(O+(g!==b.length-1?";":""))}else this._lines.push(K)}},enumerable:!1,configurable:!0}),Z}(),g=j(40061),O=function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}return(0,g.m)(M,Z),M.prototype.process=function(Z,M){for(var j=0;j<this.children.length;j++){var K=this.children[j];if(K.isValid(Z))return K.process(Z,M)}return""},M}(K),Q=function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}return(0,g.m)(M,Z),M.prototype.isValid=function(Z){return this.testExpression.isTrue(Z)},M}(K),Y=function(){function Z(){}return Z.prototype.isTrue=function(Z){return!0},Z.postfixToInfix=function(M){for(var j=[],K=0,b=M;K<b.length;K++){var g=b[K];if(void 0===Z._OperatorPriority[g])j.push(g);else{var O=j[j.length-1],Q=j[j.length-2];j.length-=2,j.push("(".concat(Q).concat(g).concat(O,")"))}}return j[j.length-1]},Z.infixToPostfix=function(M){for(var j=[],K=-1,b=function(){""!==(I=I.trim())&&(j.push(I),I="")},g=function(M){K<Z._Stack.length-1&&(Z._Stack[++K]=M)},O=function(){return Z._Stack[K]},Q=function(){return-1===K?"!!INVALID EXPRESSION!!":Z._Stack[K--]},Y=0,I="";Y<M.length;){var E=M.charAt(Y),s=Y<M.length-1?M.substr(Y,2):"";if("("===E)I="",g(E);else if(")"===E){for(b();-1!==K&&"("!==O();)j.push(Q());Q()}else if(Z._OperatorPriority[s]>1){for(b();-1!==K&&Z._OperatorPriority[O()]>=Z._OperatorPriority[s];)j.push(Q());g(s),Y++}else I+=E;Y++}for(b();-1!==K;)"("===O()?Q():j.push(Q());return j},Z._OperatorPriority={")":0,"(":1,"||":2,"&&":3},Z._Stack=["","","","","","","","","","","","","","","","","","","",""],Z}(),I=function(Z){function M(M,j){void 0===j&&(j=!1);var K=Z.call(this)||this;return K.define=M,K.not=j,K}return(0,g.m)(M,Z),M.prototype.isTrue=function(Z){var M=void 0!==Z[this.define];return this.not&&(M=!M),M},M}(Y),E=function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}return(0,g.m)(M,Z),M.prototype.isTrue=function(Z){return this.leftOperand.isTrue(Z)||this.rightOperand.isTrue(Z)},M}(Y),s=function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}return(0,g.m)(M,Z),M.prototype.isTrue=function(Z){return this.leftOperand.isTrue(Z)&&this.rightOperand.isTrue(Z)},M}(Y),i=function(Z){function M(M,j,K){var b=Z.call(this)||this;return b.define=M,b.operand=j,b.testValue=K,b}return(0,g.m)(M,Z),M.prototype.isTrue=function(Z){var M=Z[this.define];void 0===M&&(M=this.define);var j=!1,K=parseInt(M),b=parseInt(this.testValue);switch(this.operand){case">":j=K>b;break;case"<":j=K<b;break;case"<=":j=K<=b;break;case">=":j=K>=b;break;case"==":j=K===b}return j},M}(Y),a=j(50504),z=j(56591),V=/defined\s*?\((.+?)\)/g,o=/defined\s*?\[(.+?)\]/g,c=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,G=function(){function Z(){}return Z.Initialize=function(Z){Z.processor&&Z.processor.initializeShaders&&Z.processor.initializeShaders(Z.processingContext)},Z.Process=function(Z,M,j,K){var b,g=this;(null===(b=M.processor)||void 0===b?void 0:b.preProcessShaderCode)&&(Z=M.processor.preProcessShaderCode(Z,M.isFragment)),this._ProcessIncludes(Z,M,(function(Z){M.processCodeAfterIncludes&&(Z=M.processCodeAfterIncludes(M.isFragment?"fragment":"vertex",Z));var b=g._ProcessShaderConversion(Z,M,K);j(b)}))},Z.PreProcess=function(Z,M,j,K){var b,g=this;(null===(b=M.processor)||void 0===b?void 0:b.preProcessShaderCode)&&(Z=M.processor.preProcessShaderCode(Z,M.isFragment)),this._ProcessIncludes(Z,M,(function(Z){M.processCodeAfterIncludes&&(Z=M.processCodeAfterIncludes(M.isFragment?"fragment":"vertex",Z));var b=g._ApplyPreProcessing(Z,M,K);j(b)}))},Z.Finalize=function(Z,M,j){return j.processor&&j.processor.finalizeShaders?j.processor.finalizeShaders(Z,M,j.processingContext):{vertexCode:Z,fragmentCode:M}},Z._ProcessPrecision=function(Z,M){var j;if(null===(j=M.processor)||void 0===j?void 0:j.noPrecision)return Z;var K=M.shouldUseHighPrecisionShader;return-1===Z.indexOf("precision highp float")?Z=K?"precision highp float;\n"+Z:"precision mediump float;\n"+Z:K||(Z=Z.replace("precision highp float","precision mediump float")),Z},Z._ExtractOperation=function(Z){var M=/defined\((.+)\)/.exec(Z);if(M&&M.length)return new I(M[1].trim(),"!"===Z[0]);for(var j="",K=0,b=0,g=["==",">=","<=","<",">"];b<g.length&&(j=g[b],!((K=Z.indexOf(j))>-1));b++);if(-1===K)return new I(Z);var O=Z.substring(0,K).trim(),Q=Z.substring(K+j.length).trim();return new i(O,j,Q)},Z._BuildSubExpression=function(Z){Z=Z.replace(V,"defined[$1]");for(var M=[],j=0,K=Y.infixToPostfix(Z);j<K.length;j++){var b=K[j];if("||"!==b&&"&&"!==b)M.push(b);else if(M.length>=2){var g=M[M.length-1],O=M[M.length-2];M.length-=2;var Q="&&"==b?new s:new E;"string"===typeof g&&(g=g.replace(o,"defined($1)")),"string"===typeof O&&(O=O.replace(o,"defined($1)")),Q.leftOperand="string"===typeof O?this._ExtractOperation(O):O,Q.rightOperand="string"===typeof g?this._ExtractOperation(g):g,M.push(Q)}}var I=M[M.length-1];return"string"===typeof I&&(I=I.replace(o,"defined($1)")),"string"===typeof I?this._ExtractOperation(I):I},Z._BuildExpression=function(Z,M){var j=new Q,K=Z.substring(0,M),b=Z.substring(M);return b=b.substring(0,(b.indexOf("//")+1||b.length+1)-1).trim(),j.testExpression="#ifdef"===K?new I(b):"#ifndef"===K?new I(b,!0):this._BuildSubExpression(b),j},Z._MoveCursorWithinIf=function(Z,M,j){for(var b=Z.currentLine;this._MoveCursor(Z,j);){var g=(b=Z.currentLine).substring(0,5).toLowerCase();if("#else"===g){var O=new K;return M.children.push(O),void this._MoveCursor(Z,O)}if("#elif"===g){var Q=this._BuildExpression(b,5);M.children.push(Q),j=Q}}},Z._MoveCursor=function(Z,M){for(;Z.canRead;){Z.lineIndex++;var j=Z.currentLine,b=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(j);if(b&&b.length){switch(b[0]){case"#ifdef":var g=new O;M.children.push(g);var Q=this._BuildExpression(j,6);g.children.push(Q),this._MoveCursorWithinIf(Z,g,Q);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":g=new O;M.children.push(g);Q=this._BuildExpression(j,7);g.children.push(Q),this._MoveCursorWithinIf(Z,g,Q);break;case"#if":g=new O,Q=this._BuildExpression(j,3);M.children.push(g),g.children.push(Q),this._MoveCursorWithinIf(Z,g,Q)}}else{var Y=new K;if(Y.line=j,M.children.push(Y),"#"===j[0]&&"d"===j[1]){var I=j.replace(";","").split(" ");Y.additionalDefineKey=I[1],3===I.length&&(Y.additionalDefineValue=I[2])}}}return!1},Z._EvaluatePreProcessors=function(Z,M,j){var g=new K,O=new b;return O.lineIndex=-1,O.lines=Z.split("\n"),this._MoveCursor(O,g),g.process(M,j)},Z._PreparePreProcessors=function(Z,M){for(var j,K={},b=0,g=Z.defines;b<g.length;b++){var O=g[b].replace("#define","").replace(";","").trim().split(" ");K[O[0]]=O.length>1?O[1]:""}return(null===(j=Z.processor)||void 0===j?void 0:j.shaderLanguage)===z.b.GLSL&&(K.GL_ES="true"),K.__VERSION__=Z.version,K[Z.platformName]="true",M._getGlobalDefines(K),K},Z._ProcessShaderConversion=function(Z,M,j){var K=this._ProcessPrecision(Z,M);if(!M.processor)return K;if(M.processor.shaderLanguage===z.b.GLSL&&-1!==K.indexOf("#version 3"))return K.replace("#version 300 es","");var b=M.defines,g=this._PreparePreProcessors(M,j);return M.processor.preProcessor&&(K=M.processor.preProcessor(K,b,M.isFragment,M.processingContext)),K=this._EvaluatePreProcessors(K,g,M),M.processor.postProcessor&&(K=M.processor.postProcessor(K,b,M.isFragment,M.processingContext,j)),j._features.needShaderCodeInlining&&(K=j.inlineShaderCode(K)),K},Z._ApplyPreProcessing=function(Z,M,j){var K,b,g=Z,O=M.defines,Q=this._PreparePreProcessors(M,j);return(null===(K=M.processor)||void 0===K?void 0:K.preProcessor)&&(g=M.processor.preProcessor(g,O,M.isFragment,M.processingContext)),g=this._EvaluatePreProcessors(g,Q,M),(null===(b=M.processor)||void 0===b?void 0:b.postProcessor)&&(g=M.processor.postProcessor(g,O,M.isFragment,M.processingContext,j)),j._features.needShaderCodeInlining&&(g=j.inlineShaderCode(g)),g},Z._ProcessIncludes=function(M,j,K){for(var b=this,g=c.exec(M),O=new String(M),Q=!1,Y=function(){var Y=g[1];if(-1!==Y.indexOf("__decl__")&&(Y=Y.replace(/__decl__/,""),j.supportsUniformBuffers&&(Y=(Y=Y.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),Y+="Declaration"),!j.includesShadersStore[Y]){var I=j.shadersRepository+"ShadersInclude/"+Y+".fx";return Z._FileToolsLoadFile(I,(function(Z){j.includesShadersStore[Y]=Z,b._ProcessIncludes(O,j,K)})),{value:void 0}}var E=j.includesShadersStore[Y];if(g[2])for(var s=g[3].split(","),i=0;i<s.length;i+=2){var a=new RegExp(s[i],"g"),z=s[i+1];E=E.replace(a,z)}if(g[4]){var V=g[5];if(-1!==V.indexOf("..")){var o=V.split(".."),G=parseInt(o[0]),f=parseInt(o[1]),X=E.slice(0);E="",isNaN(f)&&(f=j.indexParameters[o[1]]);for(var d=G;d<f;d++)j.supportsUniformBuffers||(X=X.replace(/light\{X\}.(\w*)/g,(function(Z,M){return M+"{X}"}))),E+=X.replace(/\{X\}/g,d.toString())+"\n"}else j.supportsUniformBuffers||(E=E.replace(/light\{X\}.(\w*)/g,(function(Z,M){return M+"{X}"}))),E=E.replace(/\{X\}/g,V)}O=O.replace(g[0],E),Q=Q||E.indexOf("#include<")>=0||E.indexOf("#include <")>=0,g=c.exec(M)};null!=g;){var I=Y();if("object"===typeof I)return I.value}Q?this._ProcessIncludes(O.toString(),j,K):K(O)},Z._FileToolsLoadFile=function(Z,M,j,K,b,g){throw(0,a.e)("FileTools")},Z}()},21867:function(Z,M,j){"use strict";j.d(M,{c:function(){return K}});var K=function(){function Z(Z,M){if(void 0===Z&&(Z=null),this._MSAARenderBuffer=null,this._context=M,!Z&&!(Z=M.createTexture()))throw new Error("Unable to create webGL texture");this.set(Z)}return Object.defineProperty(Z.prototype,"underlyingResource",{get:function(){return this._webGLTexture},enumerable:!1,configurable:!0}),Z.prototype.setUsage=function(){},Z.prototype.set=function(Z){this._webGLTexture=Z},Z.prototype.reset=function(){this._webGLTexture=null,this._MSAARenderBuffer=null},Z.prototype.release=function(){this._MSAARenderBuffer&&(this._context.deleteRenderbuffer(this._MSAARenderBuffer),this._MSAARenderBuffer=null),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()},Z}()},90690:function(Z,M,j){"use strict";j.d(M,{c:function(){return c}});var K=j(40061),b=j(9271),g=j(60766),O=j(60985),Q=j(78588),Y=j(50504),I=j(72284),E=j(19500),s=function(){function Z(Z){void 0===Z&&(Z=30),this._enabled=!0,this._rollingFrameTime=new i(Z)}return Z.prototype.sampleFrame=function(Z){if(void 0===Z&&(Z=E.c.Now),this._enabled){if(null!=this._lastFrameTimeMs){var M=Z-this._lastFrameTimeMs;this._rollingFrameTime.add(M)}this._lastFrameTimeMs=Z}},Object.defineProperty(Z.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"instantaneousFPS",{get:function(){var Z=this._rollingFrameTime.history(0);return 0===Z?0:1e3/Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),Z.prototype.enable=function(){this._enabled=!0},Z.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(Z.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Z.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},Z}(),i=function(){function Z(Z){this._samples=new Array(Z),this.reset()}return Z.prototype.add=function(Z){var M;if(this.isSaturated()){var j=this._samples[this._pos];M=j-this.average,this.average-=M/(this._sampleCount-1),this._m2-=M*(j-this.average)}else this._sampleCount++;M=Z-this.average,this.average+=M/this._sampleCount,this._m2+=M*(Z-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=Z,this._pos++,this._pos%=this._samples.length},Z.prototype.history=function(Z){if(Z>=this._sampleCount||Z>=this._samples.length)return 0;var M=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(M-Z)]},Z.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},Z.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},Z.prototype._wrapPosition=function(Z){var M=this._samples.length;return(Z%M+M)%M},Z}(),a=j(16945),z=j(12753),V=j(9127),o=j(21867),c=(j(54980),j(91156),j(37855),function(Z){function M(j,K,g,Q){void 0===Q&&(Q=!1);var Y=Z.call(this,j,K,g,Q)||this;if(Y.enableOfflineSupport=!1,Y.disableManifestCheck=!1,Y.disableContextMenu=!0,Y.scenes=new Array,Y._virtualScenes=new Array,Y.onNewSceneAddedObservable=new b.b,Y.postProcesses=new Array,Y.isPointerLock=!1,Y.onResizeObservable=new b.b,Y.onCanvasBlurObservable=new b.b,Y.onCanvasFocusObservable=new b.b,Y.onCanvasPointerOutObservable=new b.b,Y.onBeginFrameObservable=new b.b,Y.customAnimationFrameRequester=null,Y.onEndFrameObservable=new b.b,Y.onBeforeShaderCompilationObservable=new b.b,Y.onAfterShaderCompilationObservable=new b.b,Y._deterministicLockstep=!1,Y._lockstepMaxSteps=4,Y._timeStep=1/60,Y._fps=60,Y._deltaTime=0,Y._drawCalls=new a.d,Y.canvasTabIndex=1,Y.disablePerformanceMonitorInBackground=!1,Y._performanceMonitor=new s,Y._compatibilityMode=!0,Y.currentRenderPassId=0,Y._renderPassNames=["main"],M.Instances.push(Y),!j)return Y;if(Y._features.supportRenderPasses=!0,g=Y._creationOptions,j.getContext){var I=j;if(Y._sharedInit(I,!!g.doNotHandleTouchAction,g.audioEngine),(0,O.q)()){var E=document;Y._onFullscreenChange=function(){void 0!==E.fullscreen?Y.isFullscreen=E.fullscreen:void 0!==E.mozFullScreen?Y.isFullscreen=E.mozFullScreen:void 0!==E.webkitIsFullScreen?Y.isFullscreen=E.webkitIsFullScreen:void 0!==E.msIsFullScreen&&(Y.isFullscreen=E.msIsFullScreen),Y.isFullscreen&&Y._pointerLockRequested&&I&&M._RequestPointerlock(I)},document.addEventListener("fullscreenchange",Y._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",Y._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",Y._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",Y._onFullscreenChange,!1),Y._onPointerLockChange=function(){Y.isPointerLock=E.mozPointerLockElement===I||E.webkitPointerLockElement===I||E.msPointerLockElement===I||E.pointerLockElement===I},document.addEventListener("pointerlockchange",Y._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",Y._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",Y._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",Y._onPointerLockChange,!1),!M.audioEngine&&g.audioEngine&&M.AudioEngineFactory&&(M.audioEngine=M.AudioEngineFactory(Y.getRenderingCanvas(),Y.getAudioContext(),Y.getAudioDestination()))}Y._connectVREvents(),Y.enableOfflineSupport=void 0!==M.OfflineProviderFactory,Y._deterministicLockstep=!!g.deterministicLockstep,Y._lockstepMaxSteps=g.lockstepMaxSteps||0,Y._timeStep=g.timeStep||1/60}return Y._prepareVRComponent(),g.autoEnableWebVR&&Y.initWebVR(),Y}return(0,K.m)(M,Z),Object.defineProperty(M,"NpmPackage",{get:function(){return I.d.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(M,"Version",{get:function(){return I.d.Version},enumerable:!1,configurable:!0}),Object.defineProperty(M,"Instances",{get:function(){return Q.e.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(M,"LastCreatedEngine",{get:function(){return Q.e.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(M,"LastCreatedScene",{get:function(){return Q.e.LastCreatedScene},enumerable:!1,configurable:!0}),M.prototype._createImageBitmapFromSource=function(Z,M){var j=this;return new Promise((function(K,b){var g=new Image;g.onload=function(){g.decode().then((function(){j.createImageBitmap(g,M).then((function(Z){K(Z)}))}))},g.onerror=function(){b("Error loading image ".concat(g.src))},g.src=Z}))},M.prototype.createImageBitmap=function(Z,M){return createImageBitmap(Z,M)},M.prototype.resizeImageBitmap=function(Z,M,j){var K=this.createCanvas(M,j).getContext("2d");if(!K)throw new Error("Unable to get 2d context for resizeImageBitmap");return K.drawImage(Z,0,0),K.getImageData(0,0,M,j).data},M.MarkAllMaterialsAsDirty=function(Z,j){for(var K=0;K<M.Instances.length;K++)for(var b=M.Instances[K],g=0;g<b.scenes.length;g++)b.scenes[g].markAllMaterialsAsDirty(Z,j)},M.DefaultLoadingScreenFactory=function(Z){throw(0,Y.e)("LoadingScreen")},Object.defineProperty(M.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!M._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"compatibilityMode",{get:function(){return this._compatibilityMode},set:function(Z){this._compatibilityMode=!0},enumerable:!1,configurable:!0}),M.prototype.getInputElement=function(){return this._renderingCanvas},M.prototype._sharedInit=function(j,K,b){var g=this;if(Z.prototype._sharedInit.call(this,j,K,b),this._onCanvasFocus=function(){g.onCanvasFocusObservable.notifyObservers(g)},this._onCanvasBlur=function(){g.onCanvasBlurObservable.notifyObservers(g)},this._onCanvasContextMenu=function(Z){g.disableContextMenu&&Z.preventDefault()},j.addEventListener("focus",this._onCanvasFocus),j.addEventListener("blur",this._onCanvasBlur),j.addEventListener("contextmenu",this._onCanvasContextMenu),this._onBlur=function(){g.disablePerformanceMonitorInBackground&&g._performanceMonitor.disable(),g._windowIsBackground=!0},this._onFocus=function(){g.disablePerformanceMonitorInBackground&&g._performanceMonitor.enable(),g._windowIsBackground=!1},this._onCanvasPointerOut=function(Z){document.elementFromPoint(Z.clientX,Z.clientY)!==j&&g.onCanvasPointerOutObservable.notifyObservers(Z)},(0,O.q)()){var Q=this.getHostWindow();Q&&(Q.addEventListener("blur",this._onBlur),Q.addEventListener("focus",this._onFocus))}j.addEventListener("pointerout",this._onCanvasPointerOut),K||this._disableTouchAction(),!M.audioEngine&&b&&M.AudioEngineFactory&&(M.audioEngine=M.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()))},M.prototype.getAspectRatio=function(Z,M){void 0===M&&(M=!1);var j=Z.viewport;return this.getRenderWidth(M)*j.width/(this.getRenderHeight(M)*j.height)},M.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},M.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},M.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},M.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},M.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},M.prototype.getTimeStep=function(){return 1e3*this._timeStep},M.prototype.generateMipMapsForCubemap=function(Z,M){if(void 0===M&&(M=!0),Z.generateMipMaps){var j=this._gl;this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,Z,!0),j.generateMipmap(j.TEXTURE_CUBE_MAP),M&&this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null)}},M.prototype.getDepthBuffer=function(){return this._depthCullingState.depthTest},M.prototype.setDepthBuffer=function(Z){this._depthCullingState.depthTest=Z},M.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},M.prototype.setDepthWrite=function(Z){this._depthCullingState.depthMask=Z},M.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},M.prototype.setStencilBuffer=function(Z){this._stencilState.stencilTest=Z},M.prototype.getStencilMask=function(){return this._stencilState.stencilMask},M.prototype.setStencilMask=function(Z){this._stencilState.stencilMask=Z},M.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},M.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},M.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},M.prototype.setStencilFunction=function(Z){this._stencilState.stencilFunc=Z},M.prototype.setStencilFunctionReference=function(Z){this._stencilState.stencilFuncRef=Z},M.prototype.setStencilFunctionMask=function(Z){this._stencilState.stencilFuncMask=Z},M.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},M.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},M.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},M.prototype.setStencilOperationFail=function(Z){this._stencilState.stencilOpStencilFail=Z},M.prototype.setStencilOperationDepthFail=function(Z){this._stencilState.stencilOpDepthFail=Z},M.prototype.setStencilOperationPass=function(Z){this._stencilState.stencilOpStencilDepthPass=Z},M.prototype.setDitheringState=function(Z){Z?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},M.prototype.setRasterizerState=function(Z){Z?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},M.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},M.prototype.setDepthFunction=function(Z){this._depthCullingState.depthFunc=Z},M.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},M.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},M.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},M.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},M.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},M.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},M.prototype.setDirectViewport=function(Z,M,j,K){var b=this._cachedViewport;return this._cachedViewport=null,this._viewport(Z,M,j,K),b},M.prototype.scissorClear=function(Z,M,j,K,b){this.enableScissor(Z,M,j,K),this.clear(b,!0,!0,!0),this.disableScissor()},M.prototype.enableScissor=function(Z,M,j,K){var b=this._gl;b.enable(b.SCISSOR_TEST),b.scissor(Z,M,j,K)},M.prototype.disableScissor=function(){var Z=this._gl;Z.disable(Z.SCISSOR_TEST)},M.prototype._reportDrawCall=function(Z){void 0===Z&&(Z=1),this._drawCalls.addCount(Z,!1)},M.prototype.initWebVR=function(){throw(0,Y.e)("WebVRCamera")},M.prototype._prepareVRComponent=function(){},M.prototype._connectVREvents=function(Z,M){},M.prototype._submitVRFrame=function(){},M.prototype.disableVR=function(){},M.prototype.isVRPresenting=function(){return!1},M.prototype._requestVRFrame=function(){},M.prototype._loadFileAsync=function(Z,M,j){var K=this;return new Promise((function(b,g){K._loadFile(Z,(function(Z){b(Z)}),void 0,M,j,(function(Z,M){g(M)}))}))},M.prototype.getVertexShaderSource=function(Z){var M=this._gl.getAttachedShaders(Z);return M?this._gl.getShaderSource(M[0]):null},M.prototype.getFragmentShaderSource=function(Z){var M=this._gl.getAttachedShaders(Z);return M?this._gl.getShaderSource(M[1]):null},M.prototype.setDepthStencilTexture=function(Z,M,j,K){void 0!==Z&&(M&&(this._boundUniforms[Z]=M),j&&j.depthStencilTexture?this._setTexture(Z,j,!1,!0,K):this._setTexture(Z,null,void 0,void 0,K))},M.prototype.setTextureFromPostProcess=function(Z,M,j){var K,b=null;M&&(M._textures.data[M._currentRenderTextureInd]?b=M._textures.data[M._currentRenderTextureInd]:M._forcedOutputTexture&&(b=M._forcedOutputTexture)),this._bindTexture(Z,null!==(K=null===b||void 0===b?void 0:b.texture)&&void 0!==K?K:null,j)},M.prototype.setTextureFromPostProcessOutput=function(Z,M,j){var K,b;this._bindTexture(Z,null!==(b=null===(K=null===M||void 0===M?void 0:M._outputTexture)||void 0===K?void 0:K.texture)&&void 0!==b?b:null,j)},M.prototype._rebuildBuffers=function(){for(var M=0,j=this.scenes;M<j.length;M++){(g=j[M]).resetCachedMaterial(),g._rebuildGeometries(),g._rebuildTextures()}for(var K=0,b=this._virtualScenes;K<b.length;K++){var g;(g=b[K]).resetCachedMaterial(),g._rebuildGeometries(),g._rebuildTextures()}Z.prototype._rebuildBuffers.call(this)},M.prototype._renderFrame=function(){for(var Z=0;Z<this._activeRenderLoops.length;Z++){(0,this._activeRenderLoops[Z])()}},M.prototype._renderLoop=function(){if(!this._contextWasLost){var Z=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(Z=!1),Z&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},M.prototype._renderViews=function(){return!1},M.prototype.switchFullscreen=function(Z){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(Z)},M.prototype.enterFullscreen=function(Z){this.isFullscreen||(this._pointerLockRequested=Z,this._renderingCanvas&&M._RequestFullscreen(this._renderingCanvas))},M.prototype.exitFullscreen=function(){this.isFullscreen&&M._ExitFullscreen()},M.prototype.enterPointerlock=function(){this._renderingCanvas&&M._RequestPointerlock(this._renderingCanvas)},M.prototype.exitPointerlock=function(){M._ExitPointerlock()},M.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),Z.prototype.beginFrame.call(this)},M.prototype.endFrame=function(){Z.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},M.prototype.resize=function(M){void 0===M&&(M=!1),this.isVRPresenting()||Z.prototype.resize.call(this,M)},M.prototype.setSize=function(M,j,K){if(void 0===K&&(K=!1),!this._renderingCanvas)return!1;if(!Z.prototype.setSize.call(this,M,j,K))return!1;if(this.scenes){for(var b=0;b<this.scenes.length;b++)for(var g=this.scenes[b],O=0;O<g.cameras.length;O++){g.cameras[O]._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},M.prototype._deletePipelineContext=function(M){var j=M;j&&j.program&&j.transformFeedback&&(this.deleteTransformFeedback(j.transformFeedback),j.transformFeedback=null),Z.prototype._deletePipelineContext.call(this,M)},M.prototype.createShaderProgram=function(M,j,K,b,g,O){void 0===O&&(O=null),g=g||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var Q=Z.prototype.createShaderProgram.call(this,M,j,K,b,g,O);return this.onAfterShaderCompilationObservable.notifyObservers(this),Q},M.prototype._createShaderProgram=function(Z,M,j,K,b){void 0===b&&(b=null);var g=K.createProgram();if(Z.program=g,!g)throw new Error("Unable to create program");if(K.attachShader(g,M),K.attachShader(g,j),this.webGLVersion>1&&b){var O=this.createTransformFeedback();this.bindTransformFeedback(O),this.setTranformFeedbackVaryings(g,b),Z.transformFeedback=O}return K.linkProgram(g),this.webGLVersion>1&&b&&this.bindTransformFeedback(null),Z.context=K,Z.vertexShader=M,Z.fragmentShader=j,Z.isParallelCompiled||this._finalizePipelineContext(Z),g},M.prototype._releaseTexture=function(M){Z.prototype._releaseTexture.call(this,M)},M.prototype._releaseRenderTargetWrapper=function(M){Z.prototype._releaseRenderTargetWrapper.call(this,M),this.scenes.forEach((function(Z){Z.postProcesses.forEach((function(Z){Z._outputTexture===M&&(Z._outputTexture=null)})),Z.cameras.forEach((function(Z){Z._postProcesses.forEach((function(Z){Z&&Z._outputTexture===M&&(Z._outputTexture=null)}))}))}))},M.prototype.getRenderPassNames=function(){return this._renderPassNames},M.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},M.prototype.createRenderPassId=function(Z){var j=++M._RenderPassIdCounter;return this._renderPassNames[j]=null!==Z&&void 0!==Z?Z:"NONAME",j},M.prototype.releaseRenderPassId=function(Z){this._renderPassNames[Z]=void 0;for(var M=0;M<this.scenes.length;++M)for(var j=this.scenes[M],K=0;K<j.meshes.length;++K){var b=j.meshes[K];if(b.subMeshes)for(var g=0;g<b.subMeshes.length;++g){b.subMeshes[g]._removeDrawWrapper(Z)}}},M.prototype._rescaleTexture=function(Z,j,K,b,g){var O=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var Q=this.createRenderTargetTexture({width:j.width,height:j.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&M._RescalePostProcessFactory&&(this._rescalePostProcess=M._RescalePostProcessFactory(this)),this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled((function(){O._rescalePostProcess.onApply=function(M){M._bindTexture("textureSampler",Z)};var M=K;M||(M=O.scenes[O.scenes.length-1]),M.postProcessManager.directRender([O._rescalePostProcess],Q,!0),O._bindTextureDirectly(O._gl.TEXTURE_2D,j,!0),O._gl.copyTexImage2D(O._gl.TEXTURE_2D,0,b,0,0,j.width,j.height,0),O.unBindFramebuffer(Q),Q.dispose(),g&&g()}))},M.prototype.getFps=function(){return this._fps},M.prototype.getDeltaTime=function(){return this._deltaTime},M.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},M.prototype.wrapWebGLTexture=function(Z){var M=new o.c(Z,this._gl),j=new g.h(this,g.e.Unknown,!0);return j._hardwareTexture=M,j.isReady=!0,j},M.prototype._uploadImageToTexture=function(Z,M,j,K){void 0===j&&(j=0),void 0===K&&(K=0);var b=this._gl,g=this._getWebGLTextureType(Z.type),O=this._getInternalFormat(Z.format),Q=this._getRGBABufferInternalSizedFormat(Z.type,O),Y=Z.isCube?b.TEXTURE_CUBE_MAP:b.TEXTURE_2D;this._bindTextureDirectly(Y,Z,!0),this._unpackFlipY(Z.invertY);var I=b.TEXTURE_2D;Z.isCube&&(I=b.TEXTURE_CUBE_MAP_POSITIVE_X+j),b.texImage2D(I,K,Q,O,g,M),this._bindTextureDirectly(Y,null,!0)},M.prototype.updateTextureComparisonFunction=function(Z,M){if(1!==this.webGLVersion){var j=this._gl;Z.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,Z,!0),0===M?(j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_COMPARE_FUNC,515),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_COMPARE_MODE,j.NONE)):(j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_COMPARE_FUNC,M),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_COMPARE_MODE,j.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,Z,!0),0===M?(j.texParameteri(j.TEXTURE_2D,j.TEXTURE_COMPARE_FUNC,515),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_COMPARE_MODE,j.NONE)):(j.texParameteri(j.TEXTURE_2D,j.TEXTURE_COMPARE_FUNC,M),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_COMPARE_MODE,j.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),Z._comparisonFunction=M}else V.c.Error("WebGL 1 does not support texture comparison.")},M.prototype.createInstancesBuffer=function(Z){var M=this._gl.createBuffer();if(!M)throw new Error("Unable to create instance buffer");var j=new z.b(M);return j.capacity=Z,this.bindArrayBuffer(j),this._gl.bufferData(this._gl.ARRAY_BUFFER,Z,this._gl.DYNAMIC_DRAW),j.references=1,j},M.prototype.deleteInstancesBuffer=function(Z){this._gl.deleteBuffer(Z)},M.prototype._clientWaitAsync=function(Z,M,j){void 0===M&&(M=0),void 0===j&&(j=10);var K=this._gl;return new Promise((function(b,g){!function O(){var Q=K.clientWaitSync(Z,M,0);Q!=K.WAIT_FAILED?Q!=K.TIMEOUT_EXPIRED?b():setTimeout(O,j):g()}()}))},M.prototype._readPixelsAsync=function(Z,M,j,K,b,g,O){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var Q=this._gl,Y=Q.createBuffer();Q.bindBuffer(Q.PIXEL_PACK_BUFFER,Y),Q.bufferData(Q.PIXEL_PACK_BUFFER,O.byteLength,Q.STREAM_READ),Q.readPixels(Z,M,j,K,b,g,0),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,null);var I=Q.fenceSync(Q.SYNC_GPU_COMMANDS_COMPLETE,0);return I?(Q.flush(),this._clientWaitAsync(I,0,10).then((function(){return Q.deleteSync(I),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,Y),Q.getBufferSubData(Q.PIXEL_PACK_BUFFER,0,O),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,null),Q.deleteBuffer(Y),O}))):null},M.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();1===M.Instances.length&&M.audioEngine&&(M.audioEngine.dispose(),M.audioEngine=null),this.disableVR(),(0,O.q)()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._renderingCanvas.removeEventListener("contextmenu",this._onCanvasContextMenu)),(0,O.k)()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),Z.prototype.dispose.call(this);var j=M.Instances.indexOf(this);j>=0&&M.Instances.splice(j,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},M.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")},M.prototype.displayLoadingUI=function(){if((0,O.q)()){var Z=this.loadingScreen;Z&&Z.displayLoadingUI()}},M.prototype.hideLoadingUI=function(){if((0,O.q)()){var Z=this._loadingScreen;Z&&Z.hideLoadingUI()}},Object.defineProperty(M.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=M.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(Z){this._loadingScreen=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"loadingUIText",{set:function(Z){this.loadingScreen.loadingUIText=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"loadingUIBackgroundColor",{set:function(Z){this.loadingScreen.loadingUIBackgroundColor=Z},enumerable:!1,configurable:!0}),M.prototype.createVideoElement=function(Z){return document.createElement("video")},M._RequestPointerlock=function(Z){Z.requestPointerLock=Z.requestPointerLock||Z.msRequestPointerLock||Z.mozRequestPointerLock||Z.webkitRequestPointerLock,Z.requestPointerLock&&(Z.requestPointerLock(),Z.focus())},M._ExitPointerlock=function(){var Z=document;document.exitPointerLock=document.exitPointerLock||Z.msExitPointerLock||Z.mozExitPointerLock||Z.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},M._RequestFullscreen=function(Z){var M=Z.requestFullscreen||Z.msRequestFullscreen||Z.webkitRequestFullscreen||Z.mozRequestFullScreen;M&&M.call(Z)},M._ExitFullscreen=function(){var Z=document;document.exitFullscreen?document.exitFullscreen():Z.mozCancelFullScreen?Z.mozCancelFullScreen():Z.webkitCancelFullScreen?Z.webkitCancelFullScreen():Z.msCancelFullScreen&&Z.msCancelFullScreen()},M.prototype.getFontOffset=function(Z){var M=document.createElement("span");M.innerHTML="Hg",M.setAttribute("style","font: ".concat(Z," !important"));var j=document.createElement("div");j.style.display="inline-block",j.style.width="1px",j.style.height="0px",j.style.verticalAlign="bottom";var K=document.createElement("div");K.style.whiteSpace="nowrap",K.appendChild(M),K.appendChild(j),document.body.appendChild(K);var b=0,g=0;try{g=j.getBoundingClientRect().top-M.getBoundingClientRect().top,j.style.verticalAlign="baseline",b=j.getBoundingClientRect().top-M.getBoundingClientRect().top}finally{document.body.removeChild(K)}return{ascent:b,height:g,descent:g-b}},M.ALPHA_DISABLE=0,M.ALPHA_ADD=1,M.ALPHA_COMBINE=2,M.ALPHA_SUBTRACT=3,M.ALPHA_MULTIPLY=4,M.ALPHA_MAXIMIZED=5,M.ALPHA_ONEONE=6,M.ALPHA_PREMULTIPLIED=7,M.ALPHA_PREMULTIPLIED_PORTERDUFF=8,M.ALPHA_INTERPOLATE=9,M.ALPHA_SCREENMODE=10,M.DELAYLOADSTATE_NONE=0,M.DELAYLOADSTATE_LOADED=1,M.DELAYLOADSTATE_LOADING=2,M.DELAYLOADSTATE_NOTLOADED=4,M.NEVER=512,M.ALWAYS=519,M.LESS=513,M.EQUAL=514,M.LEQUAL=515,M.GREATER=516,M.GEQUAL=518,M.NOTEQUAL=517,M.KEEP=7680,M.REPLACE=7681,M.INCR=7682,M.DECR=7683,M.INVERT=5386,M.INCR_WRAP=34055,M.DECR_WRAP=34056,M.TEXTURE_CLAMP_ADDRESSMODE=0,M.TEXTURE_WRAP_ADDRESSMODE=1,M.TEXTURE_MIRROR_ADDRESSMODE=2,M.TEXTUREFORMAT_ALPHA=0,M.TEXTUREFORMAT_LUMINANCE=1,M.TEXTUREFORMAT_LUMINANCE_ALPHA=2,M.TEXTUREFORMAT_RGB=4,M.TEXTUREFORMAT_RGBA=5,M.TEXTUREFORMAT_RED=6,M.TEXTUREFORMAT_R=6,M.TEXTUREFORMAT_RG=7,M.TEXTUREFORMAT_RED_INTEGER=8,M.TEXTUREFORMAT_R_INTEGER=8,M.TEXTUREFORMAT_RG_INTEGER=9,M.TEXTUREFORMAT_RGB_INTEGER=10,M.TEXTUREFORMAT_RGBA_INTEGER=11,M.TEXTURETYPE_UNSIGNED_BYTE=0,M.TEXTURETYPE_UNSIGNED_INT=0,M.TEXTURETYPE_FLOAT=1,M.TEXTURETYPE_HALF_FLOAT=2,M.TEXTURETYPE_BYTE=3,M.TEXTURETYPE_SHORT=4,M.TEXTURETYPE_UNSIGNED_SHORT=5,M.TEXTURETYPE_INT=6,M.TEXTURETYPE_UNSIGNED_INTEGER=7,M.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,M.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,M.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,M.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,M.TEXTURETYPE_UNSIGNED_INT_24_8=12,M.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,M.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,M.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,M.TEXTURE_NEAREST_SAMPLINGMODE=1,M.TEXTURE_BILINEAR_SAMPLINGMODE=2,M.TEXTURE_TRILINEAR_SAMPLINGMODE=3,M.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,M.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,M.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,M.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,M.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,M.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,M.TEXTURE_NEAREST_LINEAR=7,M.TEXTURE_NEAREST_NEAREST=1,M.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,M.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,M.TEXTURE_LINEAR_LINEAR=2,M.TEXTURE_LINEAR_NEAREST=12,M.TEXTURE_EXPLICIT_MODE=0,M.TEXTURE_SPHERICAL_MODE=1,M.TEXTURE_PLANAR_MODE=2,M.TEXTURE_CUBIC_MODE=3,M.TEXTURE_PROJECTION_MODE=4,M.TEXTURE_SKYBOX_MODE=5,M.TEXTURE_INVCUBIC_MODE=6,M.TEXTURE_EQUIRECTANGULAR_MODE=7,M.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,M.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,M.SCALEMODE_FLOOR=1,M.SCALEMODE_NEAREST=2,M.SCALEMODE_CEILING=3,M._RescalePostProcessFactory=null,M._RenderPassIdCounter=0,M}(I.d))},78588:function(Z,M,j){"use strict";j.d(M,{e:function(){return K}});var K=function(){function Z(){}return Object.defineProperty(Z,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),Z.Instances=new Array,Z._LastCreatedScene=null,Z.UseFallbackTexture=!0,Z.FallbackTexture="",Z}()},48479:function(Z,M,j){"use strict";var K=j(40061),b=j(9127),g=j(90690),O=j(60766),Q=j(82419),Y=j(30899),I=j(61803),E=j(52311),s=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4};!function(Z){function M(M){void 0===M&&(M=new s);var j=Z.call(this,null)||this;g.c.Instances.push(j),void 0===M.deterministicLockstep&&(M.deterministicLockstep=!1),void 0===M.lockstepMaxSteps&&(M.lockstepMaxSteps=4),j._options=M,Y.d.SetMatrixPrecision(!!M.useHighPrecisionMatrix),j._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!1,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:0,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!1,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!1,instancedArrays:!1,supportOcclusionQuery:!1,canUseTimestampForTimerQuery:!1,maxMSAASamples:1,blendMinMax:!1,canUseGLInstanceID:!1,canUseGLVertexID:!1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:!1,textureMaxLevel:!1,texture2DArrayMaxLayerCount:128},j._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:!1,supportDepthStencilTexture:!1,supportShadowSamplers:!1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:!1,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:!1,basisNeedsPOT:!1,support3DTextures:!1,needTypeSuffixInShaderConstants:!1,supportMSAA:!1,supportSSAO2:!1,supportExtendedTextureFormats:!1,supportSwitchCaseInShader:!1,supportSyncTextureRead:!1,needsInvertingBitmap:!1,useUBOBindingCache:!1,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!0,_collectUbosUpdatedInFrame:!1},b.c.Log("Babylon.js v".concat(g.c.Version," - Null engine"));var K="undefined"!==typeof self?self:"undefined"!==typeof global?global:window;return"undefined"===typeof URL&&(K.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"===typeof Blob&&(K.Blob=function(){}),j}(0,K.m)(M,Z),M.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},M.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},M.prototype.getHardwareScalingLevel=function(){return 1},M.prototype.createVertexBuffer=function(Z){var M=new Q.e;return M.references=1,M},M.prototype.createIndexBuffer=function(Z){var M=new Q.e;return M.references=1,M},M.prototype.clear=function(Z,M,j,K){void 0===K&&(K=!1)},M.prototype.getRenderWidth=function(Z){return void 0===Z&&(Z=!1),!Z&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},M.prototype.getRenderHeight=function(Z){return void 0===Z&&(Z=!1),!Z&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},M.prototype.setViewport=function(Z,M,j){this._cachedViewport=Z},M.prototype.createShaderProgram=function(Z,M,j,K,b){return{__SPECTOR_rebuildProgram:null}},M.prototype.getUniforms=function(Z,M){return[]},M.prototype.getAttributes=function(Z,M){return[]},M.prototype.bindSamplers=function(Z){this._currentEffect=null},M.prototype.enableEffect=function(Z){Z=null!==Z&&I.e.IsWrapper(Z)?Z.effect:Z,this._currentEffect=Z,Z&&(Z.onBind&&Z.onBind(Z),Z._onBindObservable&&Z._onBindObservable.notifyObservers(Z))},M.prototype.setState=function(Z,M,j,K,b,g,O){void 0===M&&(M=0),void 0===K&&(K=!1),void 0===O&&(O=0)},M.prototype.setIntArray=function(Z,M){return!0},M.prototype.setIntArray2=function(Z,M){return!0},M.prototype.setIntArray3=function(Z,M){return!0},M.prototype.setIntArray4=function(Z,M){return!0},M.prototype.setFloatArray=function(Z,M){return!0},M.prototype.setFloatArray2=function(Z,M){return!0},M.prototype.setFloatArray3=function(Z,M){return!0},M.prototype.setFloatArray4=function(Z,M){return!0},M.prototype.setArray=function(Z,M){return!0},M.prototype.setArray2=function(Z,M){return!0},M.prototype.setArray3=function(Z,M){return!0},M.prototype.setArray4=function(Z,M){return!0},M.prototype.setMatrices=function(Z,M){return!0},M.prototype.setMatrix3x3=function(Z,M){return!0},M.prototype.setMatrix2x2=function(Z,M){return!0},M.prototype.setFloat=function(Z,M){return!0},M.prototype.setFloat2=function(Z,M,j){return!0},M.prototype.setFloat3=function(Z,M,j,K){return!0},M.prototype.setBool=function(Z,M){return!0},M.prototype.setFloat4=function(Z,M,j,K,b){return!0},M.prototype.setAlphaMode=function(Z,M){void 0===M&&(M=!1),this._alphaMode!==Z&&(this.alphaState.alphaBlend=0!==Z,M||this.setDepthWrite(0===Z),this._alphaMode=Z)},M.prototype.bindBuffers=function(Z,M,j){},M.prototype.wipeCaches=function(Z){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,Z&&(this._currentProgram=null,this._stencilStateComposer.reset(),this.depthCullingState.reset(),this.alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},M.prototype.draw=function(Z,M,j,K){},M.prototype.drawElementsType=function(Z,M,j,K){},M.prototype.drawArraysType=function(Z,M,j,K){},M.prototype._createTexture=function(){return{}},M.prototype._releaseTexture=function(Z){},M.prototype.createTexture=function(Z,M,j,K,b,g,Q,Y,I,E,s,i){void 0===b&&(b=3),void 0===g&&(g=null),void 0===Q&&(Q=null),void 0===Y&&(Y=null),void 0===I&&(I=null),void 0===E&&(E=null),void 0===s&&(s=null);var a=new O.h(this,O.e.Url),z=String(Z);return a.url=z,a.generateMipMaps=!M,a.samplingMode=b,a.invertY=j,a.baseWidth=this._options.textureSize,a.baseHeight=this._options.textureSize,a.width=this._options.textureSize,a.height=this._options.textureSize,E&&(a.format=E),a.isReady=!0,g&&setTimeout((function(){g(a)})),this._internalTexturesCache.push(a),a},M.prototype._createHardwareRenderTargetWrapper=function(Z,M,j){var K=new E.b(Z,M,j,this);return this._renderTargetWrapperCache.push(K),K},M.prototype.createRenderTargetTexture=function(Z,M){var j=this._createHardwareRenderTargetWrapper(!1,!1,Z),K={};void 0!==M&&"object"===typeof M?(K.generateMipMaps=M.generateMipMaps,K.generateDepthBuffer=void 0===M.generateDepthBuffer||M.generateDepthBuffer,K.generateStencilBuffer=K.generateDepthBuffer&&M.generateStencilBuffer,K.type=void 0===M.type?0:M.type,K.samplingMode=void 0===M.samplingMode?3:M.samplingMode):(K.generateMipMaps=M,K.generateDepthBuffer=!0,K.generateStencilBuffer=!1,K.type=0,K.samplingMode=3);var b=new O.h(this,O.e.RenderTarget),g=Z.width||Z,Q=Z.height||Z;return j._generateDepthBuffer=K.generateDepthBuffer,j._generateStencilBuffer=!!K.generateStencilBuffer,b.baseWidth=g,b.baseHeight=Q,b.width=g,b.height=Q,b.isReady=!0,b.samples=1,b.generateMipMaps=!!K.generateMipMaps,b.samplingMode=K.samplingMode,b.type=K.type,this._internalTexturesCache.push(b),j},M.prototype.updateTextureSamplingMode=function(Z,M){M.samplingMode=Z},M.prototype.createRawTexture=function(Z,M,j,K,b,g,Q,Y,I,E,s){void 0===Y&&(Y=null),void 0===I&&(I=0),void 0===E&&(E=0),void 0===s&&(s=!1);var i=new O.h(this,O.e.Raw);return i.baseWidth=M,i.baseHeight=j,i.width=M,i.height=j,i.format=K,i.generateMipMaps=b,i.samplingMode=Q,i.invertY=g,i._compression=Y,i.type=I,i._useSRGBBuffer=s,this._doNotHandleContextLost||(i._bufferView=Z),i},M.prototype.updateRawTexture=function(Z,M,j,K,b,g,O){void 0===b&&(b=null),void 0===g&&(g=0),void 0===O&&(O=!1),Z&&(Z._bufferView=M,Z.format=j,Z.invertY=K,Z._compression=b,Z.type=g,Z._useSRGBBuffer=O)},M.prototype.bindFramebuffer=function(Z,M,j,K,b){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=Z,this._currentFramebuffer=null,this._cachedViewport&&!b&&this.setViewport(this._cachedViewport,j,K)},M.prototype.unBindFramebuffer=function(Z,M,j){void 0===M&&(M=!1),this._currentRenderTarget=null,j&&j(),this._currentFramebuffer=null},M.prototype.createDynamicVertexBuffer=function(Z){var M=new Q.e;return M.references=1,M.capacity=1,M},M.prototype.updateDynamicTexture=function(Z,M,j,K,b){void 0===K&&(K=!1)},M.prototype.areAllEffectsReady=function(){return!0},M.prototype.getError=function(){return 0},M.prototype._getUnpackAlignement=function(){return 1},M.prototype._unpackFlipY=function(Z){},M.prototype.updateDynamicIndexBuffer=function(Z,M,j){void 0===j&&(j=0)},M.prototype.updateDynamicVertexBuffer=function(Z,M,j,K){},M.prototype._bindTextureDirectly=function(Z,M){return this._boundTexturesCache[this._activeChannel]!==M&&(this._boundTexturesCache[this._activeChannel]=M,!0)},M.prototype._bindTexture=function(Z,M){Z<0||this._bindTextureDirectly(0,M)},M.prototype._deleteBuffer=function(Z){},M.prototype.releaseEffects=function(){},M.prototype.displayLoadingUI=function(){},M.prototype.hideLoadingUI=function(){},Object.defineProperty(M.prototype,"loadingUIText",{set:function(Z){},enumerable:!1,configurable:!0}),M.prototype._uploadCompressedDataToTextureDirectly=function(Z,M,j,K,b,g,O){void 0===g&&(g=0),void 0===O&&(O=0)},M.prototype._uploadDataToTextureDirectly=function(Z,M,j,K){void 0===j&&(j=0),void 0===K&&(K=0)},M.prototype._uploadArrayBufferViewToTexture=function(Z,M,j,K){void 0===j&&(j=0),void 0===K&&(K=0)},M.prototype._uploadImageToTexture=function(Z,M,j,K){void 0===j&&(j=0),void 0===K&&(K=0)}}(g.c)},30899:function(Z,M,j){"use strict";j.d(M,{d:function(){return K}});var K=function(){function Z(){}return Z.SetMatrixPrecision=function(M){if(Z.MatrixTrackPrecisionChange=!1,M&&!Z.MatrixUse64Bits&&Z.MatrixTrackedMatrices)for(var j=0;j<Z.MatrixTrackedMatrices.length;++j){var K=Z.MatrixTrackedMatrices[j],b=K._m;K._m=new Array(16);for(var g=0;g<16;++g)K._m[g]=b[g]}Z.MatrixUse64Bits=M,Z.MatrixCurrentType=Z.MatrixUse64Bits?Array:Float32Array,Z.MatrixTrackedMatrices=null},Z.MatrixUse64Bits=!1,Z.MatrixTrackPrecisionChange=!0,Z.MatrixCurrentType=Float32Array,Z.MatrixTrackedMatrices=[],Z}()},52311:function(Z,M,j){"use strict";j.d(M,{b:function(){return b}});var K=j(60766),b=function(){function Z(Z,M,j,K){this._textures=null,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=Z,this._isCube=M,this._size=j,this._engine=K,this._depthStencilTexture=null}return Object.defineProperty(Z.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"depthStencilTextureWithStencil",{get:function(){return this._depthStencilTextureWithStencil},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isCube",{get:function(){return this._isCube},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isMulti",{get:function(){return this._isMulti},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"is2DArray",{get:function(){return this.layers>0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"size",{get:function(){return this.width},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"width",{get:function(){return this._size.width||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"height",{get:function(){return this._size.height||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"layers",{get:function(){return this._size.layers||0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"texture",{get:function(){var Z,M;return null!==(M=null===(Z=this._textures)||void 0===Z?void 0:Z[0])&&void 0!==M?M:null},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"textures",{get:function(){return this._textures},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"samples",{get:function(){var Z,M;return null!==(M=null===(Z=this.texture)||void 0===Z?void 0:Z.samples)&&void 0!==M?M:1},enumerable:!1,configurable:!0}),Z.prototype.setSamples=function(Z,M,j){return void 0===M&&(M=!0),void 0===j&&(j=!1),this.samples!==Z||j?this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,Z,M):this._engine.updateRenderTargetTextureSampleCount(this,Z):Z},Z.prototype.setTextures=function(Z){Array.isArray(Z)?this._textures=Z:this._textures=Z?[Z]:null},Z.prototype.setTexture=function(Z,M,j){void 0===M&&(M=0),void 0===j&&(j=!0),this._textures||(this._textures=[]),this._textures[M]&&j&&this._textures[M].dispose(),this._textures[M]=Z},Z.prototype.createDepthStencilTexture=function(Z,M,j,K,b){var g;return void 0===Z&&(Z=0),void 0===M&&(M=!0),void 0===j&&(j=!1),void 0===K&&(K=1),void 0===b&&(b=14),null===(g=this._depthStencilTexture)||void 0===g||g.dispose(),this._depthStencilTextureWithStencil=j,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:M,comparisonFunction:Z,generateStencil:j,isCube:this._isCube,samples:K,depthTextureFormat:b},this),this._depthStencilTexture},Z.prototype._shareDepth=function(Z){this._depthStencilTexture&&(Z._depthStencilTexture&&Z._depthStencilTexture.dispose(),Z._depthStencilTexture=this._depthStencilTexture,this._depthStencilTexture.incrementReferences())},Z.prototype._swapAndDie=function(Z){this.texture&&this.texture._swapAndDie(Z),this._textures=null,this.dispose(!0)},Z.prototype._cloneRenderTargetWrapper=function(){var Z,M,j,b,g,O,Q=null;if(this._isMulti){var Y=this.textures;if(Y&&Y.length>0){var I=!1,E=Y.length,s=Y[Y.length-1]._source;s!==K.e.Depth&&s!==K.e.DepthStencil||(I=!0,E--);for(var i=[],a=[],z=0;z<E;++z){var V=Y[z];i.push(V.samplingMode),a.push(V.type)}var o={samplingModes:i,generateMipMaps:Y[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:I,types:a,textureCount:E},c={width:this.width,height:this.height};Q=this._engine.createMultipleRenderTarget(c,o)}}else{var G={};if(G.generateDepthBuffer=this._generateDepthBuffer,G.generateMipMaps=null!==(M=null===(Z=this.texture)||void 0===Z?void 0:Z.generateMipMaps)&&void 0!==M&&M,G.generateStencilBuffer=this._generateStencilBuffer,G.samplingMode=null===(j=this.texture)||void 0===j?void 0:j.samplingMode,G.type=null===(b=this.texture)||void 0===b?void 0:b.type,G.format=null===(g=this.texture)||void 0===g?void 0:g.format,this.isCube)Q=this._engine.createRenderTargetCubeTexture(this.width,G);else{c={width:this.width,height:this.height,layers:this.is2DArray?null===(O=this.texture)||void 0===O?void 0:O.depth:void 0};Q=this._engine.createRenderTargetTexture(c,G)}Q.texture.isReady=!0}return Q},Z.prototype._swapRenderTargetWrapper=function(Z){if(this._textures&&Z._textures)for(var M=0;M<this._textures.length;++M)this._textures[M]._swapAndDie(Z._textures[M],!1),Z._textures[M].isReady=!0;this._depthStencilTexture&&Z._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(Z._depthStencilTexture),Z._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null},Z.prototype._rebuild=function(){var Z=this._cloneRenderTargetWrapper();if(Z){if(this._depthStencilTexture){var M=this._depthStencilTexture.samplingMode,j=2===M||3===M||11===M;Z.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,j,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples)}this.samples>1&&Z.setSamples(this.samples),Z._swapRenderTargetWrapper(this),Z.dispose()}},Z.prototype.releaseTextures=function(){var Z,M;if(this._textures)for(var j=0;null!==(M=j<(null===(Z=this._textures)||void 0===Z?void 0:Z.length))&&void 0!==M&&M;++j)this._textures[j].dispose();this._textures=null},Z.prototype.dispose=function(Z){var M;void 0===Z&&(Z=!1),Z||(null===(M=this._depthStencilTexture)||void 0===M||M.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)},Z}()},16179:function(Z,M,j){"use strict";j.d(M,{d:function(){return b}});var K=j(56591),b=function(){function Z(){}return Z.GetShadersRepository=function(M){return void 0===M&&(M=K.b.GLSL),M===K.b.GLSL?Z.ShadersRepository:Z.ShadersRepositoryWGSL},Z.GetShadersStore=function(M){return void 0===M&&(M=K.b.GLSL),M===K.b.GLSL?Z.ShadersStore:Z.ShadersStoreWGSL},Z.GetIncludesShadersStore=function(M){return void 0===M&&(M=K.b.GLSL),M===K.b.GLSL?Z.IncludesShadersStore:Z.IncludesShadersStoreWGSL},Z.ShadersRepository="src/Shaders/",Z.ShadersStore={},Z.IncludesShadersStore={},Z.ShadersRepositoryWGSL="src/ShadersWGSL/",Z.ShadersStoreWGSL={},Z.IncludesShadersStoreWGSL={},Z}()},72284:function(Z,M,j){"use strict";j.d(M,{d:function(){return q}});var K=j(40061),b=j(78588),g=j(90559),O=j(50504),Q=j(9271),Y=function(){function Z(Z){void 0===Z&&(Z=!0),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,Z&&this.reset()}return Object.defineProperty(Z.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"zOffset",{get:function(){return this._zOffset},set:function(Z){this._zOffset!==Z&&(this._zOffset=Z,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"zOffsetUnits",{get:function(){return this._zOffsetUnits},set:function(Z){this._zOffsetUnits!==Z&&(this._zOffsetUnits=Z,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"cullFace",{get:function(){return this._cullFace},set:function(Z){this._cullFace!==Z&&(this._cullFace=Z,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"cull",{get:function(){return this._cull},set:function(Z){this._cull!==Z&&(this._cull=Z,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(Z){this._depthFunc!==Z&&(this._depthFunc=Z,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"depthMask",{get:function(){return this._depthMask},set:function(Z){this._depthMask!==Z&&(this._depthMask=Z,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"depthTest",{get:function(){return this._depthTest},set:function(Z){this._depthTest!==Z&&(this._depthTest=Z,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"frontFace",{get:function(){return this._frontFace},set:function(Z){this._frontFace!==Z&&(this._frontFace=Z,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),Z.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1},Z.prototype.apply=function(Z){this.isDirty&&(this._isCullDirty&&(this.cull?Z.enable(Z.CULL_FACE):Z.disable(Z.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(Z.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(Z.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?Z.enable(Z.DEPTH_TEST):Z.disable(Z.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(Z.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(Z.enable(Z.POLYGON_OFFSET_FILL),Z.polygonOffset(this.zOffset,this.zOffsetUnits)):Z.disable(Z.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(Z.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},Z}(),I=function(){function Z(){this.reset()}return Z.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=Z.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=Z.KEEP,this.opDepthFail=Z.KEEP,this.opStencilDepthPass=Z.REPLACE},Object.defineProperty(Z.prototype,"stencilFunc",{get:function(){return this.func},set:function(Z){this.func=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"stencilFuncRef",{get:function(){return this.funcRef},set:function(Z){this.funcRef=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"stencilFuncMask",{get:function(){return this.funcMask},set:function(Z){this.funcMask=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"stencilOpStencilFail",{get:function(){return this.opStencilFail},set:function(Z){this.opStencilFail=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"stencilOpDepthFail",{get:function(){return this.opDepthFail},set:function(Z){this.opDepthFail=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"stencilOpStencilDepthPass",{get:function(){return this.opStencilDepthPass},set:function(Z){this.opStencilDepthPass=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"stencilMask",{get:function(){return this.mask},set:function(Z){this.mask=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"stencilTest",{get:function(){return this.enabled},set:function(Z){this.enabled=Z},enumerable:!1,configurable:!0}),Z.ALWAYS=519,Z.KEEP=7680,Z.REPLACE=7681,Z}(),E=function(){function Z(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}return Object.defineProperty(Z.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(Z){this._alphaBlend!==Z&&(this._alphaBlend=Z,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),Z.prototype.setAlphaBlendConstants=function(Z,M,j,K){this._blendConstants[0]===Z&&this._blendConstants[1]===M&&this._blendConstants[2]===j&&this._blendConstants[3]===K||(this._blendConstants[0]=Z,this._blendConstants[1]=M,this._blendConstants[2]=j,this._blendConstants[3]=K,this._isBlendConstantsDirty=!0)},Z.prototype.setAlphaBlendFunctionParameters=function(Z,M,j,K){this._blendFunctionParameters[0]===Z&&this._blendFunctionParameters[1]===M&&this._blendFunctionParameters[2]===j&&this._blendFunctionParameters[3]===K||(this._blendFunctionParameters[0]=Z,this._blendFunctionParameters[1]=M,this._blendFunctionParameters[2]=j,this._blendFunctionParameters[3]=K,this._isBlendFunctionParametersDirty=!0)},Z.prototype.setAlphaEquationParameters=function(Z,M){this._blendEquationParameters[0]===Z&&this._blendEquationParameters[1]===M||(this._blendEquationParameters[0]=Z,this._blendEquationParameters[1]=M,this._isBlendEquationParametersDirty=!0)},Z.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},Z.prototype.apply=function(Z){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?Z.enable(Z.BLEND):Z.disable(Z.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(Z.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(Z.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(Z.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},Z}(),s=j(60766),i=j(9127),a=j(60985),z=j(56591),V=function(){function Z(){this.shaderLanguage=z.b.GLSL}return Z.prototype.postProcessor=function(Z,M,j,K,b){if(!b.getCaps().drawBuffersExtension){Z=Z.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")}return Z},Z}(),o=function(){function Z(){this.shaderLanguage=z.b.GLSL}return Z.prototype.attributeProcessor=function(Z){return Z.replace("attribute","in")},Z.prototype.varyingProcessor=function(Z,M){return Z.replace("varying",M?"in":"out")},Z.prototype.postProcessor=function(Z,M,j){var K=-1!==Z.search(/#extension.+GL_EXT_draw_buffers.+require/);if(Z=(Z=Z.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),j)Z=(Z=(Z=(Z=(Z=(Z=(Z=Z.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(K?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==M.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+Z;return Z},Z}(),c=j(12753),G=function(){function Z(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(Z.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),Z.prototype._handlesSpectorRebuildCallback=function(Z){Z&&this.program&&Z(this.program)},Z.prototype._fillEffectInformation=function(Z,M,j,K,b,g,O,Q){var Y,I=this.engine;if(I.supportsUniformBuffers)for(var E in M)Z.bindUniformBlock(E,M[E]);for(this.engine.getUniforms(this,j).forEach((function(Z,M){K[j[M]]=Z})),this._uniforms=K,Y=0;Y<b.length;Y++){null==Z.getUniform(b[Y])&&(b.splice(Y,1),Y--)}b.forEach((function(Z,M){g[Z]=M}));for(var s=0,i=I.getAttributes(this,O);s<i.length;s++){var a=i[s];Q.push(a)}},Z.prototype.dispose=function(){this._uniforms={}},Z.prototype._cacheMatrix=function(Z,M){var j=this._valueCache[Z],K=M.updateFlag;return(void 0===j||j!==K)&&(this._valueCache[Z]=K,!0)},Z.prototype._cacheFloat2=function(Z,M,j){var K=this._valueCache[Z];if(!K||2!==K.length)return K=[M,j],this._valueCache[Z]=K,!0;var b=!1;return K[0]!==M&&(K[0]=M,b=!0),K[1]!==j&&(K[1]=j,b=!0),b},Z.prototype._cacheFloat3=function(Z,M,j,K){var b=this._valueCache[Z];if(!b||3!==b.length)return b=[M,j,K],this._valueCache[Z]=b,!0;var g=!1;return b[0]!==M&&(b[0]=M,g=!0),b[1]!==j&&(b[1]=j,g=!0),b[2]!==K&&(b[2]=K,g=!0),g},Z.prototype._cacheFloat4=function(Z,M,j,K,b){var g=this._valueCache[Z];if(!g||4!==g.length)return g=[M,j,K,b],this._valueCache[Z]=g,!0;var O=!1;return g[0]!==M&&(g[0]=M,O=!0),g[1]!==j&&(g[1]=j,O=!0),g[2]!==K&&(g[2]=K,O=!0),g[3]!==b&&(g[3]=b,O=!0),O},Z.prototype.setInt=function(Z,M){var j=this._valueCache[Z];void 0!==j&&j===M||this.engine.setInt(this._uniforms[Z],M)&&(this._valueCache[Z]=M)},Z.prototype.setInt2=function(Z,M,j){this._cacheFloat2(Z,M,j)&&(this.engine.setInt2(this._uniforms[Z],M,j)||(this._valueCache[Z]=null))},Z.prototype.setInt3=function(Z,M,j,K){this._cacheFloat3(Z,M,j,K)&&(this.engine.setInt3(this._uniforms[Z],M,j,K)||(this._valueCache[Z]=null))},Z.prototype.setInt4=function(Z,M,j,K,b){this._cacheFloat4(Z,M,j,K,b)&&(this.engine.setInt4(this._uniforms[Z],M,j,K,b)||(this._valueCache[Z]=null))},Z.prototype.setIntArray=function(Z,M){this._valueCache[Z]=null,this.engine.setIntArray(this._uniforms[Z],M)},Z.prototype.setIntArray2=function(Z,M){this._valueCache[Z]=null,this.engine.setIntArray2(this._uniforms[Z],M)},Z.prototype.setIntArray3=function(Z,M){this._valueCache[Z]=null,this.engine.setIntArray3(this._uniforms[Z],M)},Z.prototype.setIntArray4=function(Z,M){this._valueCache[Z]=null,this.engine.setIntArray4(this._uniforms[Z],M)},Z.prototype.setArray=function(Z,M){this._valueCache[Z]=null,this.engine.setArray(this._uniforms[Z],M)},Z.prototype.setArray2=function(Z,M){this._valueCache[Z]=null,this.engine.setArray2(this._uniforms[Z],M)},Z.prototype.setArray3=function(Z,M){this._valueCache[Z]=null,this.engine.setArray3(this._uniforms[Z],M)},Z.prototype.setArray4=function(Z,M){this._valueCache[Z]=null,this.engine.setArray4(this._uniforms[Z],M)},Z.prototype.setMatrices=function(Z,M){M&&(this._valueCache[Z]=null,this.engine.setMatrices(this._uniforms[Z],M))},Z.prototype.setMatrix=function(Z,M){this._cacheMatrix(Z,M)&&(this.engine.setMatrices(this._uniforms[Z],M.toArray())||(this._valueCache[Z]=null))},Z.prototype.setMatrix3x3=function(Z,M){this._valueCache[Z]=null,this.engine.setMatrix3x3(this._uniforms[Z],M)},Z.prototype.setMatrix2x2=function(Z,M){this._valueCache[Z]=null,this.engine.setMatrix2x2(this._uniforms[Z],M)},Z.prototype.setFloat=function(Z,M){var j=this._valueCache[Z];void 0!==j&&j===M||this.engine.setFloat(this._uniforms[Z],M)&&(this._valueCache[Z]=M)},Z.prototype.setVector2=function(Z,M){this._cacheFloat2(Z,M.x,M.y)&&(this.engine.setFloat2(this._uniforms[Z],M.x,M.y)||(this._valueCache[Z]=null))},Z.prototype.setFloat2=function(Z,M,j){this._cacheFloat2(Z,M,j)&&(this.engine.setFloat2(this._uniforms[Z],M,j)||(this._valueCache[Z]=null))},Z.prototype.setVector3=function(Z,M){this._cacheFloat3(Z,M.x,M.y,M.z)&&(this.engine.setFloat3(this._uniforms[Z],M.x,M.y,M.z)||(this._valueCache[Z]=null))},Z.prototype.setFloat3=function(Z,M,j,K){this._cacheFloat3(Z,M,j,K)&&(this.engine.setFloat3(this._uniforms[Z],M,j,K)||(this._valueCache[Z]=null))},Z.prototype.setVector4=function(Z,M){this._cacheFloat4(Z,M.x,M.y,M.z,M.w)&&(this.engine.setFloat4(this._uniforms[Z],M.x,M.y,M.z,M.w)||(this._valueCache[Z]=null))},Z.prototype.setQuaternion=function(Z,M){this._cacheFloat4(Z,M.x,M.y,M.z,M.w)&&(this.engine.setFloat4(this._uniforms[Z],M.x,M.y,M.z,M.w)||(this._valueCache[Z]=null))},Z.prototype.setFloat4=function(Z,M,j,K,b){this._cacheFloat4(Z,M,j,K,b)&&(this.engine.setFloat4(this._uniforms[Z],M,j,K,b)||(this._valueCache[Z]=null))},Z.prototype.setColor3=function(Z,M){this._cacheFloat3(Z,M.r,M.g,M.b)&&(this.engine.setFloat3(this._uniforms[Z],M.r,M.g,M.b)||(this._valueCache[Z]=null))},Z.prototype.setColor4=function(Z,M,j){this._cacheFloat4(Z,M.r,M.g,M.b,j)&&(this.engine.setFloat4(this._uniforms[Z],M.r,M.g,M.b,j)||(this._valueCache[Z]=null))},Z.prototype.setDirectColor4=function(Z,M){this._cacheFloat4(Z,M.r,M.g,M.b,M.a)&&(this.engine.setFloat4(this._uniforms[Z],M.r,M.g,M.b,M.a)||(this._valueCache[Z]=null))},Z.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},Z.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},Z}(),f=j(30899),X=j(21867),d=j(61803),W=function(){function Z(Z){void 0===Z&&(Z=!0),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,Z&&this.reset()}return Object.defineProperty(Z.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"func",{get:function(){return this._func},set:function(Z){this._func!==Z&&(this._func=Z,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"funcRef",{get:function(){return this._funcRef},set:function(Z){this._funcRef!==Z&&(this._funcRef=Z,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"funcMask",{get:function(){return this._funcMask},set:function(Z){this._funcMask!==Z&&(this._funcMask=Z,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(Z){this._opStencilFail!==Z&&(this._opStencilFail=Z,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(Z){this._opDepthFail!==Z&&(this._opDepthFail=Z,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(Z){this._opStencilDepthPass!==Z&&(this._opStencilDepthPass=Z,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"mask",{get:function(){return this._mask},set:function(Z){this._mask!==Z&&(this._mask=Z,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"enabled",{get:function(){return this._enabled},set:function(Z){this._enabled!==Z&&(this._enabled=Z,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),Z.prototype.reset=function(){var Z;this.stencilMaterial=void 0,null===(Z=this.stencilGlobal)||void 0===Z||Z.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},Z.prototype.apply=function(Z){var M;if(Z){var j=!this.useStencilGlobalOnly&&!!(null===(M=this.stencilMaterial)||void 0===M?void 0:M.enabled);this.enabled=j?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=j?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=j?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=j?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=j?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=j?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=j?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=j?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?Z.enable(Z.STENCIL_TEST):Z.disable(Z.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(Z.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(Z.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(Z.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}},Z}(),A=function(){},q=function(){function Z(M,j,K,b){var g=this;this._name="WebGL",this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new Q.b,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new Q.b,this.onContextRestoredObservable=new Q.b,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new Y,this._stencilStateComposer=new W,this._stencilState=new I,this._alphaState=new E,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this._adaptToDeviceRatio=!1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new Q.b,this._isWebGPU=!1,this._snapshotRenderingMode=0,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={};var O=null;if(K=K||{},this._creationOptions=K,this._adaptToDeviceRatio=null!==b&&void 0!==b&&b,this._stencilStateComposer.stencilGlobal=this._stencilState,f.d.SetMatrixPrecision(!!K.useHighPrecisionMatrix),M){if(b=b||K.adaptToDeviceRatio||!1,M.getContext){if(O=M,this._renderingCanvas=O,void 0!==j&&(K.antialias=j),void 0===K.deterministicLockstep&&(K.deterministicLockstep=!1),void 0===K.lockstepMaxSteps&&(K.lockstepMaxSteps=4),void 0===K.timeStep&&(K.timeStep=1/60),void 0===K.preserveDrawingBuffer&&(K.preserveDrawingBuffer=!1),void 0===K.audioEngine&&(K.audioEngine=!0),void 0!==K.audioEngineOptions&&void 0!==K.audioEngineOptions.audioContext&&(this._audioContext=K.audioEngineOptions.audioContext),void 0!==K.audioEngineOptions&&void 0!==K.audioEngineOptions.audioDestination&&(this._audioDestination=K.audioEngineOptions.audioDestination),void 0===K.stencil&&(K.stencil=!0),!1===K.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===K.xrCompatible&&(K.xrCompatible=!0),this._doNotHandleContextLost=!!K.doNotHandleContextLost,navigator&&navigator.userAgent){this._checkForMobile=function(){var Z=navigator.userAgent;g.hostInformation.isMobile=-1!==Z.indexOf("Mobile")||-1!==Z.indexOf("Mac")&&(0,a.k)()&&"ontouchend"in document},this._checkForMobile(),(0,a.q)()&&window.addEventListener("resize",this._checkForMobile);for(var s=navigator.userAgent,z=0,c=Z.ExceptionList;z<c.length;z++){var G=c[z],X=G.key,d=G.targets;if(new RegExp(X).test(s)){if(G.capture&&G.captureConstraint){var q=G.capture,T=G.captureConstraint,B=new RegExp(q).exec(s);if(B&&B.length>0)if(parseInt(B[B.length-1])>=T)continue}for(var N=0,U=d;N<U.length;N++){switch(U[N]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":K.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(Z){Z.preventDefault(),g._contextWasLost=!0,i.c.Warn("WebGL context lost."),g.onContextLostObservable.notifyObservers(g)},this._onContextRestored=function(){g._restoreEngineAfterContextLost(g._initGLContext.bind(g))},O.addEventListener("webglcontextlost",this._onContextLost,!1),O.addEventListener("webglcontextrestored",this._onContextRestored,!1),K.powerPreference="high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(K.xrCompatible=!1),!K.disableWebGL2Support)try{this._gl=O.getContext("webgl2",K)||O.getContext("experimental-webgl2",K),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(Z){}if(!this._gl){if(!O)throw new Error("The provided canvas is null or undefined.");try{this._gl=O.getContext("webgl",K)||O.getContext("experimental-webgl",K)}catch(Z){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=M,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";var n=this._gl.getContextAttributes();n&&(K.stencil=n.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==K.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=K.useHighPrecisionFloats);var k=(0,a.q)()&&window.devicePixelRatio||1,x=K.limitDeviceRatio||k;this._hardwareScalingLevel=b?1/Math.min(x,k):1,this.resize(),this._isStencilEnable=!!K.stencil,this._initGLContext(),this._initFeatures();for(var R=0;R<this._caps.maxVertexAttribs;R++)this._currentBufferPointers[R]=new A;this._shaderProcessor=this.webGLVersion>1?new o:new V,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);var e="Babylon.js v".concat(Z.Version);console.log(e+" - ".concat(this.description)),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",e)}}return Object.defineProperty(Z,"NpmPackage",{get:function(){return"babylonjs@5.14.1"},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"Version",{get:function(){return"5.14.1"},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"description",{get:function(){var Z=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(Z+=" - Parallel shader compilation"),Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"name",{get:function(){return this._name},set:function(Z){this._name=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"ShadersRepository",{get:function(){return g.e.ShadersRepository},set:function(Z){g.e.ShadersRepository=Z},enumerable:!1,configurable:!0}),Z.prototype._getShaderProcessor=function(Z){return this._shaderProcessor},Object.defineProperty(Z.prototype,"useReverseDepthBuffer",{get:function(){return this._useReverseDepthBuffer},set:function(Z){Z!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=Z,this._depthCullingState.depthFunc=Z?518:515)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Z.prototype.getCreationOptions=function(){return this._creationOptions},Object.defineProperty(Z.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(Z){this._doNotHandleContextLost=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"framebufferDimensionsObject",{set:function(Z){this._framebufferDimensionsObject=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var Z=new Uint8Array(4),M=[Z,Z,Z,Z,Z,Z];this._emptyCubeTexture=this.createRawCubeTexture(M,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"snapshotRendering",{get:function(){return!1},set:function(Z){},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRenderingMode},set:function(Z){this._snapshotRenderingMode=Z},enumerable:!1,configurable:!0}),Z.prototype.snapshotRenderingReset=function(){this.snapshotRendering=!1},Z._CreateCanvas=function(Z,M){if("undefined"===typeof document)return new OffscreenCanvas(Z,M);var j=document.createElement("canvas");return j.width=Z,j.height=M,j},Z.prototype.createCanvas=function(M,j){return Z._CreateCanvas(M,j)},Z.prototype.createCanvasImage=function(){return document.createElement("img")},Z.prototype._restoreEngineAfterContextLost=function(Z){var M=this;setTimeout((function(){return(0,K.h)(M,void 0,void 0,(function(){var M,j,b,g,O;return(0,K.n)(this,(function(K){switch(K.label){case 0:return this._dummyFramebuffer=null,M=this._depthCullingState.depthTest,j=this._depthCullingState.depthFunc,b=this._depthCullingState.depthMask,g=this._stencilState.stencilTest,[4,Z()];case 1:return K.sent(),this._rebuildEffects(),null===(O=this._rebuildComputeEffects)||void 0===O||O.call(this),this._rebuildInternalTextures(),this._rebuildRenderTargetWrappers(),this._rebuildBuffers(),this.wipeCaches(!0),this._depthCullingState.depthTest=M,this._depthCullingState.depthFunc=j,this._depthCullingState.depthMask=b,this._stencilState.stencilTest=g,i.c.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1,[2]}}))}))}),0)},Z.prototype._sharedInit=function(Z,M,j){this._renderingCanvas=Z},Z.prototype._getShaderProcessingContext=function(Z){return null},Z.prototype._rebuildInternalTextures=function(){for(var Z=0,M=this._internalTexturesCache.slice();Z<M.length;Z++){M[Z]._rebuild()}},Z.prototype._rebuildRenderTargetWrappers=function(){for(var Z=0,M=this._renderTargetWrapperCache.slice();Z<M.length;Z++){M[Z]._rebuild()}},Z.prototype._rebuildEffects=function(){for(var Z in this._compiledEffects){var M=this._compiledEffects[Z];M._pipelineContext=null,M._wasPreviouslyReady=!1,M._prepareEffect()}g.e.ResetCache()},Z.prototype.areAllEffectsReady=function(){for(var Z in this._compiledEffects){if(!this._compiledEffects[Z].isReady())return!1}return!0},Z.prototype._rebuildBuffers=function(){for(var Z=0,M=this._uniformBuffers;Z<M.length;Z++){M[Z]._rebuild()}for(var j=0,K=this._storageBuffers;j<K.length;j++){K[j]._rebuild()}},Z.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?256:128},this._glVersion=this._gl.getParameter(this._gl.VERSION);var Z=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=Z&&(this._glRenderer=this._gl.getParameter(Z.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(Z.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{var M=this._gl.getExtension("WEBGL_draw_buffers");if(null!==M){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=M.drawBuffersWEBGL.bind(M),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var j=0;j<16;j++)this._gl["COLOR_ATTACHMENT"+j+"_WEBGL"]=M["COLOR_ATTACHMENT"+j+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var K=this._gl.getExtension("WEBGL_depth_texture");null!=K&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=K.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var b=this._gl.getExtension("OES_vertex_array_object");null!=b&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=b.createVertexArrayOES.bind(b),this._gl.bindVertexArray=b.bindVertexArrayOES.bind(b),this._gl.deleteVertexArray=b.deleteVertexArrayOES.bind(b))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var g=this._gl.getExtension("ANGLE_instanced_arrays");null!=g?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=g.drawArraysInstancedANGLE.bind(g),this._gl.drawElementsInstanced=g.drawElementsInstancedANGLE.bind(g),this._gl.vertexAttribDivisor=g.vertexAttribDivisorANGLE.bind(g)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var O=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),Q=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);O&&Q&&(this._caps.highPrecisionShaderSupported=0!==O.precision&&0!==Q.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var Y=this._gl.getExtension("EXT_blend_minmax");null!=Y&&(this._caps.blendMinMax=!0,this._gl.MAX=Y.MAX_EXT,this._gl.MIN=Y.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0;else{var I=this._gl.getExtension("EXT_sRGB");null!=I&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=I.SRGB_EXT,this._gl.SRGB8=I.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=I.SRGB_ALPHA_EXT)}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var E=0;E<this._maxSimultaneousTextures;E++)this._nextFreeTextureSlots.push(E)},Z.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(Z.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Z.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(Z.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),Z.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=this.createCanvas(1,1);var Z=this._workingCanvas.getContext("2d");Z&&(this._workingContext=Z)}},Z.prototype.resetTextureCache=function(){for(var Z in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,Z)&&(this._boundTexturesCache[Z]=null);this._currentTextureChannel=-1},Z.prototype.getInfo=function(){return this.getGlInfo()},Z.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},Z.prototype.setHardwareScalingLevel=function(Z){this._hardwareScalingLevel=Z,this.resize()},Z.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},Z.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},Z.prototype.getCaps=function(){return this._caps},Z.prototype.stopRenderLoop=function(Z){if(Z){var M=this._activeRenderLoops.indexOf(Z);M>=0&&this._activeRenderLoops.splice(M,1)}else this._activeRenderLoops=[]},Z.prototype._renderLoop=function(){if(!this._contextWasLost){var Z=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(Z=!1),Z){this.beginFrame();for(var M=0;M<this._activeRenderLoops.length;M++){(0,this._activeRenderLoops[M])()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},Z.prototype.getRenderingCanvas=function(){return this._renderingCanvas},Z.prototype.getAudioContext=function(){return this._audioContext},Z.prototype.getAudioDestination=function(){return this._audioDestination},Z.prototype.getHostWindow=function(){return(0,a.q)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},Z.prototype.getRenderWidth=function(Z){return void 0===Z&&(Z=!1),!Z&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},Z.prototype.getRenderHeight=function(Z){return void 0===Z&&(Z=!1),!Z&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},Z.prototype._queueNewFrame=function(M,j){return Z.QueueNewFrame(M,j)},Z.prototype.runRenderLoop=function(Z){-1===this._activeRenderLoops.indexOf(Z)&&(this._activeRenderLoops.push(Z),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},Z.prototype.clear=function(Z,M,j,K){void 0===K&&(K=!1);var b=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=b;var g=0;M&&Z&&(this._gl.clearColor(Z.r,Z.g,Z.b,void 0!==Z.a?Z.a:1),g|=this._gl.COLOR_BUFFER_BIT),j&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),g|=this._gl.DEPTH_BUFFER_BIT),K&&(this._gl.clearStencil(0),g|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(g)},Z.prototype._viewport=function(Z,M,j,K){Z===this._viewportCached.x&&M===this._viewportCached.y&&j===this._viewportCached.z&&K===this._viewportCached.w||(this._viewportCached.x=Z,this._viewportCached.y=M,this._viewportCached.z=j,this._viewportCached.w=K,this._gl.viewport(Z,M,j,K))},Z.prototype.setViewport=function(Z,M,j){var K=M||this.getRenderWidth(),b=j||this.getRenderHeight(),g=Z.x||0,O=Z.y||0;this._cachedViewport=Z,this._viewport(g*K,O*b,K*Z.width,b*Z.height)},Z.prototype.beginFrame=function(){},Z.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._frameId++},Z.prototype.resize=function(Z){var M,j;if(void 0===Z&&(Z=!1),this._adaptToDeviceRatio){var K=(0,a.q)()&&window.devicePixelRatio||1,b=this._creationOptions.limitDeviceRatio||K;this._hardwareScalingLevel=this._adaptToDeviceRatio?1/Math.min(b,K):1}(0,a.q)()?(M=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,j=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(M=this._renderingCanvas?this._renderingCanvas.width:100,j=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(M/this._hardwareScalingLevel,j/this._hardwareScalingLevel,Z)},Z.prototype.setSize=function(Z,M,j){return void 0===j&&(j=!1),!!this._renderingCanvas&&(Z|=0,M|=0,!(!j&&this._renderingCanvas.width===Z&&this._renderingCanvas.height===M)&&(this._renderingCanvas.width=Z,this._renderingCanvas.height=M,!0))},Z.prototype.bindFramebuffer=function(Z,M,j,K,b,g,O){var Q,Y,I,E,s;void 0===M&&(M=0),void 0===g&&(g=0),void 0===O&&(O=0);var i=Z;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=Z,this._bindUnboundFramebuffer(i._MSAAFramebuffer?i._MSAAFramebuffer:i._framebuffer);var a=this._gl;Z.is2DArray?a.framebufferTextureLayer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,null===(Q=Z.texture._hardwareTexture)||void 0===Q?void 0:Q.underlyingResource,g,O):Z.isCube&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+M,null===(Y=Z.texture._hardwareTexture)||void 0===Y?void 0:Y.underlyingResource,g);var z=Z._depthStencilTexture;if(z){var V=Z._depthStencilTextureWithStencil?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;Z.is2DArray?a.framebufferTextureLayer(a.FRAMEBUFFER,V,null===(I=z._hardwareTexture)||void 0===I?void 0:I.underlyingResource,g,O):Z.isCube?a.framebufferTexture2D(a.FRAMEBUFFER,V,a.TEXTURE_CUBE_MAP_POSITIVE_X+M,null===(E=z._hardwareTexture)||void 0===E?void 0:E.underlyingResource,g):a.framebufferTexture2D(a.FRAMEBUFFER,V,a.TEXTURE_2D,null===(s=z._hardwareTexture)||void 0===s?void 0:s.underlyingResource,g)}this._cachedViewport&&!b?this.setViewport(this._cachedViewport,j,K):(j||(j=Z.width,g&&(j/=Math.pow(2,g))),K||(K=Z.height,g&&(K/=Math.pow(2,g))),this._viewport(0,0,j,K)),this.wipeCaches()},Z.prototype.setState=function(Z,M,j,K,b,g,O){var Q,Y;void 0===M&&(M=0),void 0===K&&(K=!1),void 0===O&&(O=0),(this._depthCullingState.cull!==Z||j)&&(this._depthCullingState.cull=Z);var I=null===(Y=null!==(Q=this.cullBackFaces)&&void 0!==Q?Q:b)||void 0===Y||Y?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==I||j)&&(this._depthCullingState.cullFace=I),this.setZOffset(M),this.setZOffsetUnits(O);var E=K?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==E||j)&&(this._depthCullingState.frontFace=E),this._stencilStateComposer.stencilMaterial=g},Z.prototype.setZOffset=function(Z){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-Z:Z},Z.prototype.getZOffset=function(){var Z=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-Z:Z},Z.prototype.setZOffsetUnits=function(Z){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-Z:Z},Z.prototype.getZOffsetUnits=function(){var Z=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-Z:Z},Z.prototype._bindUnboundFramebuffer=function(Z){this._currentFramebuffer!==Z&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,Z),this._currentFramebuffer=Z)},Z.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return null===this._currentFramebuffer},Z.prototype.generateMipmaps=function(Z){this._bindTextureDirectly(this._gl.TEXTURE_2D,Z,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)},Z.prototype.unBindFramebuffer=function(Z,M,j){var K;void 0===M&&(M=!1);var b=Z;this._currentRenderTarget=null;var g=this._gl;if(b._MSAAFramebuffer){if(Z.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(Z,M,j);g.bindFramebuffer(g.READ_FRAMEBUFFER,b._MSAAFramebuffer),g.bindFramebuffer(g.DRAW_FRAMEBUFFER,b._framebuffer),g.blitFramebuffer(0,0,Z.width,Z.height,0,0,Z.width,Z.height,g.COLOR_BUFFER_BIT,g.NEAREST)}!(null===(K=Z.texture)||void 0===K?void 0:K.generateMipMaps)||M||Z.isCube||this.generateMipmaps(Z.texture),j&&(b._MSAAFramebuffer&&this._bindUnboundFramebuffer(b._framebuffer),j()),this._bindUnboundFramebuffer(null)},Z.prototype.flushFramebuffer=function(){this._gl.flush()},Z.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},Z.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},Z.prototype.createVertexBuffer=function(Z){return this._createVertexBuffer(Z,this._gl.STATIC_DRAW)},Z.prototype._createVertexBuffer=function(Z,M){var j=this._gl.createBuffer();if(!j)throw new Error("Unable to create vertex buffer");var K=new c.b(j);return this.bindArrayBuffer(K),Z instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(Z),M):this._gl.bufferData(this._gl.ARRAY_BUFFER,Z,M),this._resetVertexBufferBinding(),K.references=1,K},Z.prototype.createDynamicVertexBuffer=function(Z){return this._createVertexBuffer(Z,this._gl.DYNAMIC_DRAW)},Z.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},Z.prototype.createIndexBuffer=function(Z,M){var j=this._gl.createBuffer(),K=new c.b(j);if(!j)throw new Error("Unable to create index buffer");this.bindIndexBuffer(K);var b=this._normalizeIndexData(Z);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,b,M?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),K.references=1,K.is32Bits=4===b.BYTES_PER_ELEMENT,K},Z.prototype._normalizeIndexData=function(Z){if(2===Z.BYTES_PER_ELEMENT)return Z;if(this._caps.uintIndices){if(Z instanceof Uint32Array)return Z;for(var M=0;M<Z.length;M++)if(Z[M]>=65535)return new Uint32Array(Z);return new Uint16Array(Z)}return new Uint16Array(Z)},Z.prototype.bindArrayBuffer=function(Z){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(Z,this._gl.ARRAY_BUFFER)},Z.prototype.bindUniformBlock=function(Z,M,j){var K=Z.program,b=this._gl.getUniformBlockIndex(K,M);this._gl.uniformBlockBinding(K,b,j)},Z.prototype.bindIndexBuffer=function(Z){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(Z,this._gl.ELEMENT_ARRAY_BUFFER)},Z.prototype._bindBuffer=function(Z,M){(this._vaoRecordInProgress||this._currentBoundBuffer[M]!==Z)&&(this._gl.bindBuffer(M,Z?Z.underlyingResource:null),this._currentBoundBuffer[M]=Z)},Z.prototype.updateArrayBuffer=function(Z){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,Z)},Z.prototype._vertexAttribPointer=function(Z,M,j,K,b,g,O){var Q=this._currentBufferPointers[M];if(Q){var Y=!1;Q.active?(Q.buffer!==Z&&(Q.buffer=Z,Y=!0),Q.size!==j&&(Q.size=j,Y=!0),Q.type!==K&&(Q.type=K,Y=!0),Q.normalized!==b&&(Q.normalized=b,Y=!0),Q.stride!==g&&(Q.stride=g,Y=!0),Q.offset!==O&&(Q.offset=O,Y=!0)):(Y=!0,Q.active=!0,Q.index=M,Q.size=j,Q.type=K,Q.normalized=b,Q.stride=g,Q.offset=O,Q.buffer=Z),(Y||this._vaoRecordInProgress)&&(this.bindArrayBuffer(Z),this._gl.vertexAttribPointer(M,j,K,b,g,O))}},Z.prototype._bindIndexBufferWithCache=function(Z){null!=Z&&this._cachedIndexBuffer!==Z&&(this._cachedIndexBuffer=Z,this.bindIndexBuffer(Z),this._uintIndicesCurrentlySet=Z.is32Bits)},Z.prototype._bindVertexBuffersAttributes=function(Z,M,j){var K=M.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var b=0;b<K.length;b++){var g=M.getAttributeLocation(b);if(g>=0){var O=K[b],Q=null;if(j&&(Q=j[O]),Q||(Q=Z[O]),!Q)continue;this._gl.enableVertexAttribArray(g),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[g]=!0);var Y=Q.getBuffer();Y&&(this._vertexAttribPointer(Y,g,Q.getSize(),Q.type,Q.normalized,Q.byteStride,Q.byteOffset),Q.getIsInstanced()&&(this._gl.vertexAttribDivisor(g,Q.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(g),this._currentInstanceBuffers.push(Y))))}}},Z.prototype.recordVertexArrayObject=function(Z,M,j,K){var b=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(b),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(Z,j,K),this.bindIndexBuffer(M),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),b},Z.prototype.bindVertexArrayObject=function(Z,M){this._cachedVertexArrayObject!==Z&&(this._cachedVertexArrayObject=Z,this._gl.bindVertexArray(Z),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=M&&M.is32Bits,this._mustWipeVertexAttributes=!0)},Z.prototype.bindBuffersDirectly=function(Z,M,j,K,b){if(this._cachedVertexBuffers!==Z||this._cachedEffectForVertexBuffers!==b){this._cachedVertexBuffers=Z,this._cachedEffectForVertexBuffers=b;var g=b.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var O=0,Q=0;Q<g;Q++)if(Q<j.length){var Y=b.getAttributeLocation(Q);Y>=0&&(this._gl.enableVertexAttribArray(Y),this._vertexAttribArraysEnabled[Y]=!0,this._vertexAttribPointer(Z,Y,j[Q],this._gl.FLOAT,!1,K,O)),O+=4*j[Q]}}this._bindIndexBufferWithCache(M)},Z.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},Z.prototype.bindBuffers=function(Z,M,j,K){this._cachedVertexBuffers===Z&&this._cachedEffectForVertexBuffers===j||(this._cachedVertexBuffers=Z,this._cachedEffectForVertexBuffers=j,this._bindVertexBuffersAttributes(Z,j,K)),this._bindIndexBufferWithCache(M)},Z.prototype.unbindInstanceAttributes=function(){for(var Z,M=0,j=this._currentInstanceLocations.length;M<j;M++){var K=this._currentInstanceBuffers[M];Z!=K&&K.references&&(Z=K,this.bindArrayBuffer(K));var b=this._currentInstanceLocations[M];this._gl.vertexAttribDivisor(b,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},Z.prototype.releaseVertexArrayObject=function(Z){this._gl.deleteVertexArray(Z)},Z.prototype._releaseBuffer=function(Z){return Z.references--,0===Z.references&&(this._deleteBuffer(Z),!0)},Z.prototype._deleteBuffer=function(Z){this._gl.deleteBuffer(Z.underlyingResource)},Z.prototype.updateAndBindInstancesBuffer=function(Z,M,j){if(this.bindArrayBuffer(Z),M&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,M),void 0!==j[0].index)this.bindInstancesBuffer(Z,j,!0);else for(var K=0;K<4;K++){var b=j[K];this._vertexAttribArraysEnabled[b]||(this._gl.enableVertexAttribArray(b),this._vertexAttribArraysEnabled[b]=!0),this._vertexAttribPointer(Z,b,4,this._gl.FLOAT,!1,64,16*K),this._gl.vertexAttribDivisor(b,1),this._currentInstanceLocations.push(b),this._currentInstanceBuffers.push(Z)}},Z.prototype.bindInstancesBuffer=function(Z,M,j){void 0===j&&(j=!0),this.bindArrayBuffer(Z);var K=0;if(j)for(var b=0;b<M.length;b++){K+=4*(g=M[b]).attributeSize}for(b=0;b<M.length;b++){var g;void 0===(g=M[b]).index&&(g.index=this._currentEffect.getAttributeLocationByName(g.attributeName)),g.index<0||(this._vertexAttribArraysEnabled[g.index]||(this._gl.enableVertexAttribArray(g.index),this._vertexAttribArraysEnabled[g.index]=!0),this._vertexAttribPointer(Z,g.index,g.attributeSize,g.attributeType||this._gl.FLOAT,g.normalized||!1,K,g.offset),this._gl.vertexAttribDivisor(g.index,void 0===g.divisor?1:g.divisor),this._currentInstanceLocations.push(g.index),this._currentInstanceBuffers.push(Z))}},Z.prototype.disableInstanceAttributeByName=function(Z){if(this._currentEffect){var M=this._currentEffect.getAttributeLocationByName(Z);this.disableInstanceAttribute(M)}},Z.prototype.disableInstanceAttribute=function(Z){for(var M,j=!1;-1!==(M=this._currentInstanceLocations.indexOf(Z));)this._currentInstanceLocations.splice(M,1),this._currentInstanceBuffers.splice(M,1),j=!0,M=this._currentInstanceLocations.indexOf(Z);j&&(this._gl.vertexAttribDivisor(Z,0),this.disableAttributeByIndex(Z))},Z.prototype.disableAttributeByIndex=function(Z){this._gl.disableVertexAttribArray(Z),this._vertexAttribArraysEnabled[Z]=!1,this._currentBufferPointers[Z].active=!1},Z.prototype.draw=function(Z,M,j,K){this.drawElementsType(Z?0:1,M,j,K)},Z.prototype.drawPointClouds=function(Z,M,j){this.drawArraysType(2,Z,M,j)},Z.prototype.drawUnIndexed=function(Z,M,j,K){this.drawArraysType(Z?0:1,M,j,K)},Z.prototype.drawElementsType=function(Z,M,j,K){this.applyStates(),this._reportDrawCall();var b=this._drawMode(Z),g=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,O=this._uintIndicesCurrentlySet?4:2;K?this._gl.drawElementsInstanced(b,j,g,M*O,K):this._gl.drawElements(b,j,g,M*O)},Z.prototype.drawArraysType=function(Z,M,j,K){this.applyStates(),this._reportDrawCall();var b=this._drawMode(Z);K?this._gl.drawArraysInstanced(b,M,j,K):this._gl.drawArrays(b,M,j)},Z.prototype._drawMode=function(Z){switch(Z){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}},Z.prototype._reportDrawCall=function(){},Z.prototype._releaseEffect=function(Z){if(this._compiledEffects[Z._key]){delete this._compiledEffects[Z._key];var M=Z.getPipelineContext();M&&this._deletePipelineContext(M)}},Z.prototype._deletePipelineContext=function(Z){var M=Z;M&&M.program&&(M.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(M.program))},Z.prototype._getGlobalDefines=function(Z){if(Z)return this.isNDCHalfZRange?Z.IS_NDC_HALF_ZRANGE="":delete Z.IS_NDC_HALF_ZRANGE,void(this.useReverseDepthBuffer?Z.USE_REVERSE_DEPTHBUFFER="":delete Z.USE_REVERSE_DEPTHBUFFER);var M="";return this.isNDCHalfZRange&&(M+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(M&&(M+="\n"),M+="#define USE_REVERSE_DEPTHBUFFER"),M},Z.prototype.createEffect=function(Z,M,j,K,b,O,Q,Y,I,E){var s;void 0===E&&(E=z.b.GLSL);var i=Z.vertexElement||Z.vertex||Z.vertexToken||Z.vertexSource||Z,a=Z.fragmentElement||Z.fragment||Z.fragmentToken||Z.fragmentSource||Z,V=this._getGlobalDefines(),o=null!==(s=null!==b&&void 0!==b?b:M.defines)&&void 0!==s?s:"";V&&(o+=V);var c=i+"+"+a+"@"+o;if(this._compiledEffects[c]){var G=this._compiledEffects[c];return Q&&G.isReady()&&Q(G),G}var f=new g.e(Z,M,j,K,this,b,O,Q,Y,I,c,E);return this._compiledEffects[c]=f,f},Z._ConcatenateShader=function(Z,M,j){return void 0===j&&(j=""),j+(M?M+"\n":"")+Z},Z.prototype._compileShader=function(M,j,K,b){return this._compileRawShader(Z._ConcatenateShader(M,K,b),j)},Z.prototype._compileRawShader=function(Z,M){var j=this._gl,K=j.createShader("vertex"===M?j.VERTEX_SHADER:j.FRAGMENT_SHADER);if(!K){for(var b=j.NO_ERROR,g=j.NO_ERROR;(g=j.getError())!==j.NO_ERROR;)b=g;throw new Error("Something went wrong while creating a gl ".concat(M," shader object. gl error=").concat(b,", gl isContextLost=").concat(j.isContextLost(),", _contextWasLost=").concat(this._contextWasLost))}return j.shaderSource(K,Z),j.compileShader(K),K},Z.prototype._getShaderSource=function(Z){return this._gl.getShaderSource(Z)},Z.prototype.createRawShaderProgram=function(Z,M,j,K,b){void 0===b&&(b=null),K=K||this._gl;var g=this._compileRawShader(M,"vertex"),O=this._compileRawShader(j,"fragment");return this._createShaderProgram(Z,g,O,K,b)},Z.prototype.createShaderProgram=function(Z,M,j,K,b,g){void 0===g&&(g=null),b=b||this._gl;var O=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",Q=this._compileShader(M,"vertex",K,O),Y=this._compileShader(j,"fragment",K,O);return this._createShaderProgram(Z,Q,Y,b,g)},Z.prototype.inlineShaderCode=function(Z){return Z},Z.prototype.createPipelineContext=function(Z){var M=new G;return M.engine=this,this._caps.parallelShaderCompile&&(M.isParallelCompiled=!0),M},Z.prototype.createMaterialContext=function(){},Z.prototype.createDrawContext=function(){},Z.prototype._createShaderProgram=function(Z,M,j,K,b){void 0===b&&(b=null);var g=K.createProgram();if(Z.program=g,!g)throw new Error("Unable to create program");return K.attachShader(g,M),K.attachShader(g,j),K.linkProgram(g),Z.context=K,Z.vertexShader=M,Z.fragmentShader=j,Z.isParallelCompiled||this._finalizePipelineContext(Z),g},Z.prototype._finalizePipelineContext=function(Z){var M=Z.context,j=Z.vertexShader,K=Z.fragmentShader,b=Z.program;if(!M.getProgramParameter(b,M.LINK_STATUS)){var g,O;if(!this._gl.getShaderParameter(j,this._gl.COMPILE_STATUS))if(g=this._gl.getShaderInfoLog(j))throw Z.vertexCompilationError=g,new Error("VERTEX SHADER "+g);if(!this._gl.getShaderParameter(K,this._gl.COMPILE_STATUS))if(g=this._gl.getShaderInfoLog(K))throw Z.fragmentCompilationError=g,new Error("FRAGMENT SHADER "+g);if(O=M.getProgramInfoLog(b))throw Z.programLinkError=O,new Error(O)}if(this.validateShaderPrograms&&(M.validateProgram(b),!M.getProgramParameter(b,M.VALIDATE_STATUS)&&(O=M.getProgramInfoLog(b))))throw Z.programValidationError=O,new Error(O);M.deleteShader(j),M.deleteShader(K),Z.vertexShader=void 0,Z.fragmentShader=void 0,Z.onCompiled&&(Z.onCompiled(),Z.onCompiled=void 0)},Z.prototype._preparePipelineContext=function(Z,M,j,K,b,g,O,Q,Y,I){var E=Z;E.program=K?this.createRawShaderProgram(E,M,j,void 0,Y):this.createShaderProgram(E,M,j,Q,void 0,Y),E.program.__SPECTOR_rebuildProgram=O},Z.prototype._isRenderingStateCompiled=function(Z){var M=Z;return!!this._gl.getProgramParameter(M.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(M),!0)},Z.prototype._executeWhenRenderingStateIsCompiled=function(Z,M){var j=Z;if(j.isParallelCompiled){var K=j.onCompiled;j.onCompiled=K?function(){K(),M()}:M}else M()},Z.prototype.getUniforms=function(Z,M){for(var j=new Array,K=Z,b=0;b<M.length;b++)j.push(this._gl.getUniformLocation(K.program,M[b]));return j},Z.prototype.getAttributes=function(Z,M){for(var j=[],K=Z,b=0;b<M.length;b++)try{j.push(this._gl.getAttribLocation(K.program,M[b]))}catch(Z){j.push(-1)}return j},Z.prototype.enableEffect=function(Z){(Z=null!==Z&&d.e.IsWrapper(Z)?Z.effect:Z)&&Z!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,Z=Z,this.bindSamplers(Z),this._currentEffect=Z,Z.onBind&&Z.onBind(Z),Z._onBindObservable&&Z._onBindObservable.notifyObservers(Z))},Z.prototype.setInt=function(Z,M){return!!Z&&(this._gl.uniform1i(Z,M),!0)},Z.prototype.setInt2=function(Z,M,j){return!!Z&&(this._gl.uniform2i(Z,M,j),!0)},Z.prototype.setInt3=function(Z,M,j,K){return!!Z&&(this._gl.uniform3i(Z,M,j,K),!0)},Z.prototype.setInt4=function(Z,M,j,K,b){return!!Z&&(this._gl.uniform4i(Z,M,j,K,b),!0)},Z.prototype.setIntArray=function(Z,M){return!!Z&&(this._gl.uniform1iv(Z,M),!0)},Z.prototype.setIntArray2=function(Z,M){return!(!Z||M.length%2!==0)&&(this._gl.uniform2iv(Z,M),!0)},Z.prototype.setIntArray3=function(Z,M){return!(!Z||M.length%3!==0)&&(this._gl.uniform3iv(Z,M),!0)},Z.prototype.setIntArray4=function(Z,M){return!(!Z||M.length%4!==0)&&(this._gl.uniform4iv(Z,M),!0)},Z.prototype.setArray=function(Z,M){return!!Z&&(!(M.length<1)&&(this._gl.uniform1fv(Z,M),!0))},Z.prototype.setArray2=function(Z,M){return!(!Z||M.length%2!==0)&&(this._gl.uniform2fv(Z,M),!0)},Z.prototype.setArray3=function(Z,M){return!(!Z||M.length%3!==0)&&(this._gl.uniform3fv(Z,M),!0)},Z.prototype.setArray4=function(Z,M){return!(!Z||M.length%4!==0)&&(this._gl.uniform4fv(Z,M),!0)},Z.prototype.setMatrices=function(Z,M){return!!Z&&(this._gl.uniformMatrix4fv(Z,!1,M),!0)},Z.prototype.setMatrix3x3=function(Z,M){return!!Z&&(this._gl.uniformMatrix3fv(Z,!1,M),!0)},Z.prototype.setMatrix2x2=function(Z,M){return!!Z&&(this._gl.uniformMatrix2fv(Z,!1,M),!0)},Z.prototype.setFloat=function(Z,M){return!!Z&&(this._gl.uniform1f(Z,M),!0)},Z.prototype.setFloat2=function(Z,M,j){return!!Z&&(this._gl.uniform2f(Z,M,j),!0)},Z.prototype.setFloat3=function(Z,M,j,K){return!!Z&&(this._gl.uniform3f(Z,M,j,K),!0)},Z.prototype.setFloat4=function(Z,M,j,K,b){return!!Z&&(this._gl.uniform4f(Z,M,j,K,b),!0)},Z.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var Z=this._colorWrite;this._gl.colorMask(Z,Z,Z,Z)}},Z.prototype.setColorWrite=function(Z){Z!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=Z)},Z.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(Z.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"stencilStateComposer",{get:function(){return this._stencilStateComposer},enumerable:!1,configurable:!0}),Z.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},Z.prototype.wipeCaches=function(Z){this.preventCacheWipeBetweenFrames&&!Z||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),Z&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},Z.prototype._getSamplingParameters=function(Z,M){var j=this._gl,K=j.NEAREST,b=j.NEAREST;switch(Z){case 11:K=j.LINEAR,b=M?j.LINEAR_MIPMAP_NEAREST:j.LINEAR;break;case 3:K=j.LINEAR,b=M?j.LINEAR_MIPMAP_LINEAR:j.LINEAR;break;case 8:K=j.NEAREST,b=M?j.NEAREST_MIPMAP_LINEAR:j.NEAREST;break;case 4:K=j.NEAREST,b=M?j.NEAREST_MIPMAP_NEAREST:j.NEAREST;break;case 5:K=j.NEAREST,b=M?j.LINEAR_MIPMAP_NEAREST:j.LINEAR;break;case 6:K=j.NEAREST,b=M?j.LINEAR_MIPMAP_LINEAR:j.LINEAR;break;case 7:K=j.NEAREST,b=j.LINEAR;break;case 1:K=j.NEAREST,b=j.NEAREST;break;case 9:K=j.LINEAR,b=M?j.NEAREST_MIPMAP_NEAREST:j.NEAREST;break;case 10:K=j.LINEAR,b=M?j.NEAREST_MIPMAP_LINEAR:j.NEAREST;break;case 2:K=j.LINEAR,b=j.LINEAR;break;case 12:K=j.LINEAR,b=j.NEAREST}return{min:b,mag:K}},Z.prototype._createTexture=function(){var Z=this._gl.createTexture();if(!Z)throw new Error("Unable to create texture");return Z},Z.prototype._createHardwareTexture=function(){return new X.c(this._createTexture(),this._gl)},Z.prototype._createInternalTexture=function(Z,M,j,K){void 0===j&&(j=!0),void 0===K&&(K=s.e.Unknown);var b={};void 0!==M&&"object"===typeof M?(b.generateMipMaps=M.generateMipMaps,b.type=void 0===M.type?0:M.type,b.samplingMode=void 0===M.samplingMode?3:M.samplingMode,b.format=void 0===M.format?5:M.format,b.useSRGBBuffer=void 0!==M.useSRGBBuffer&&M.useSRGBBuffer):(b.generateMipMaps=M,b.type=0,b.samplingMode=3,b.format=5,b.useSRGBBuffer=!1),b.useSRGBBuffer=b.useSRGBBuffer&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU),(1!==b.type||this._caps.textureFloatLinearFiltering)&&(2!==b.type||this._caps.textureHalfFloatLinearFiltering)||(b.samplingMode=1),1!==b.type||this._caps.textureFloat||(b.type=0,i.c.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var g=this._gl,O=new s.h(this,K);O._useSRGBBuffer=!!b.useSRGBBuffer;var Q=Z.width||Z,Y=Z.height||Z,I=Z.layers||0,E=this._getSamplingParameters(b.samplingMode,!!b.generateMipMaps),a=0!==I?g.TEXTURE_2D_ARRAY:g.TEXTURE_2D,z=this._getRGBABufferInternalSizedFormat(b.type,b.format,b.useSRGBBuffer),V=this._getInternalFormat(b.format),o=this._getWebGLTextureType(b.type);return this._bindTextureDirectly(a,O),0!==I?(O.is2DArray=!0,g.texImage3D(a,0,z,Q,Y,I,0,V,o,null)):g.texImage2D(a,0,z,Q,Y,0,V,o,null),g.texParameteri(a,g.TEXTURE_MAG_FILTER,E.mag),g.texParameteri(a,g.TEXTURE_MIN_FILTER,E.min),g.texParameteri(a,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(a,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),b.generateMipMaps&&this._gl.generateMipmap(a),this._bindTextureDirectly(a,null),O.baseWidth=Q,O.baseHeight=Y,O.width=Q,O.height=Y,O.depth=I,O.isReady=!0,O.samples=1,O.generateMipMaps=!!b.generateMipMaps,O.samplingMode=b.samplingMode,O.type=b.type,O.format=b.format,this._internalTexturesCache.push(O),O},Z.prototype._getUseSRGBBuffer=function(Z,M){return Z&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||M)},Z.prototype._createTextureBase=function(M,j,K,g,O,Q,Y,I,E,a,z,V,o,c,G,f){var X=this;void 0===O&&(O=3),void 0===Q&&(Q=null),void 0===Y&&(Y=null),void 0===a&&(a=null),void 0===z&&(z=null),void 0===V&&(V=null),void 0===o&&(o=null);var d="data:"===(M=M||"").substr(0,5),W="blob:"===M.substr(0,5),A=d&&-1!==M.indexOf(";base64,"),q=z||new s.h(this,s.e.Url),T=M;!this._transformTextureUrl||A||z||a||(M=this._transformTextureUrl(M)),T!==M&&(q._originalUrl=T);var B=M.lastIndexOf("."),N=o||(B>-1?M.substring(B).toLowerCase():""),U=null;N.indexOf("?")>-1&&(N=N.split("?")[0]);for(var n=0,k=Z._TextureLoaders;n<k.length;n++){var x=k[n];if(x.canLoad(N,c)){U=x;break}}g&&g._addPendingData(q),q.url=M,q.generateMipMaps=!j,q.samplingMode=O,q.invertY=K,q._useSRGBBuffer=this._getUseSRGBBuffer(!!f,j),this._doNotHandleContextLost||(q._buffer=a);var R=null;Q&&!z&&(R=q.onLoadedObservable.add(Q)),z||this._internalTexturesCache.push(q);var e=function(Z,K){g&&g._removePendingData(q),M===T?(R&&q.onLoadedObservable.remove(R),b.e.UseFallbackTexture&&X._createTextureBase(b.e.FallbackTexture,j,q.invertY,g,O,null,Y,I,E,a,q),Z=(Z||"Unknown error")+(b.e.UseFallbackTexture?" - Fallback texture was used":""),q.onErrorObservable.notifyObservers({message:Z,exception:K}),Y&&Y(Z,K)):(i.c.Warn("Failed to load ".concat(M,", falling back to ").concat(T)),X._createTextureBase(T,j,q.invertY,g,O,Q,Y,I,E,a,q,V,o,c,G,f))};if(U){var u=function(Z){U.loadData(Z,q,(function(Z,M,j,K,b,Q){Q?e("TextureLoader failed to load data"):I(q,N,g,{width:Z,height:M},q.invertY,!j,K,(function(){return b(),!1}),O)}),G)};a?a instanceof ArrayBuffer?u(new Uint8Array(a)):ArrayBuffer.isView(a)?u(a):Y&&Y("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(M,(function(Z){return u(new Uint8Array(Z))}),void 0,g?g.offlineProvider:void 0,!0,(function(Z,M){e("Unable to load "+(Z&&Z.responseURL,M))}))}else{var F=function(Z){W&&!X._doNotHandleContextLost&&(q._buffer=Z),I(q,N,g,Z,q.invertY,j,!1,E,O)};!d||A?a&&("string"===typeof a.decoding||a.close)?F(a):Z._FileToolsLoadImage(M,F,e,g?g.offlineProvider:null,c,q.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof a||a instanceof ArrayBuffer||ArrayBuffer.isView(a)||a instanceof Blob?Z._FileToolsLoadImage(a,F,e,g?g.offlineProvider:null,c,q.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):a&&F(a)}return q},Z.prototype.createTexture=function(Z,M,j,K,b,g,O,Q,Y,I,E,i,a,z,V){var o=this;return void 0===b&&(b=3),void 0===g&&(g=null),void 0===O&&(O=null),void 0===Q&&(Q=null),void 0===Y&&(Y=null),void 0===I&&(I=null),void 0===E&&(E=null),this._createTextureBase(Z,M,j,K,b,g,O,this._prepareWebGLTexture.bind(this),(function(Z,M,j,b,g,O){var Q=o._gl,Y=j.width===Z&&j.height===M,E=I?o._getInternalFormat(I,g._useSRGBBuffer):".jpg"!==b||g._useSRGBBuffer?g._useSRGBBuffer?Q.SRGB8_ALPHA8:Q.RGBA:Q.RGB,i=I?o._getInternalFormat(I):".jpg"!==b||g._useSRGBBuffer?Q.RGBA:Q.RGB;if(g._useSRGBBuffer&&1===o.webGLVersion&&(i=E),Y)return Q.texImage2D(Q.TEXTURE_2D,0,E,i,Q.UNSIGNED_BYTE,j),!1;var a=o._caps.maxTextureSize;if(j.width>a||j.height>a||!o._supportsHardwareTextureRescaling)return o._prepareWorkingCanvas(),!(!o._workingCanvas||!o._workingContext)&&(o._workingCanvas.width=Z,o._workingCanvas.height=M,o._workingContext.drawImage(j,0,0,j.width,j.height,0,0,Z,M),Q.texImage2D(Q.TEXTURE_2D,0,E,i,Q.UNSIGNED_BYTE,o._workingCanvas),g.width=Z,g.height=M,!1);var z=new s.h(o,s.e.Temp);return o._bindTextureDirectly(Q.TEXTURE_2D,z,!0),Q.texImage2D(Q.TEXTURE_2D,0,E,i,Q.UNSIGNED_BYTE,j),o._rescaleTexture(z,g,K,E,(function(){o._releaseTexture(z),o._bindTextureDirectly(Q.TEXTURE_2D,g,!0),O()})),!0}),Q,Y,I,E,i,a,V)},Z._FileToolsLoadImage=function(Z,M,j,K,b,g){throw(0,O.e)("FileTools")},Z.prototype._rescaleTexture=function(Z,M,j,K,b){},Z.prototype.createRawTexture=function(Z,M,j,K,b,g,Q,Y,I,E,s){throw void 0===Y&&(Y=null),void 0===I&&(I=0),void 0===E&&(E=0),void 0===s&&(s=!1),(0,O.e)("Engine.RawTexture")},Z.prototype.createRawCubeTexture=function(Z,M,j,K,b,g,Q,Y){throw void 0===Y&&(Y=null),(0,O.e)("Engine.RawTexture")},Z.prototype.createRawTexture3D=function(Z,M,j,K,b,g,Q,Y,I,E){throw void 0===I&&(I=null),void 0===E&&(E=0),(0,O.e)("Engine.RawTexture")},Z.prototype.createRawTexture2DArray=function(Z,M,j,K,b,g,Q,Y,I,E){throw void 0===I&&(I=null),void 0===E&&(E=0),(0,O.e)("Engine.RawTexture")},Z.prototype._unpackFlipY=function(Z){this._unpackFlipYCached!==Z&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,Z?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=Z))},Z.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},Z.prototype._getTextureTarget=function(Z){return Z.isCube?this._gl.TEXTURE_CUBE_MAP:Z.is3D?this._gl.TEXTURE_3D:Z.is2DArray||Z.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},Z.prototype.updateTextureSamplingMode=function(Z,M,j){void 0===j&&(j=!1);var K=this._getTextureTarget(M),b=this._getSamplingParameters(Z,M.generateMipMaps||j);this._setTextureParameterInteger(K,this._gl.TEXTURE_MAG_FILTER,b.mag,M),this._setTextureParameterInteger(K,this._gl.TEXTURE_MIN_FILTER,b.min),j&&(M.generateMipMaps=!0,this._gl.generateMipmap(K)),this._bindTextureDirectly(K,null),M.samplingMode=Z},Z.prototype.updateTextureDimensions=function(Z,M,j,K){void 0===K&&(K=1)},Z.prototype.updateTextureWrappingMode=function(Z,M,j,K){void 0===j&&(j=null),void 0===K&&(K=null);var b=this._getTextureTarget(Z);null!==M&&(this._setTextureParameterInteger(b,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(M),Z),Z._cachedWrapU=M),null!==j&&(this._setTextureParameterInteger(b,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(j),Z),Z._cachedWrapV=j),(Z.is2DArray||Z.is3D)&&null!==K&&(this._setTextureParameterInteger(b,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(K),Z),Z._cachedWrapR=K),this._bindTextureDirectly(b,null)},Z.prototype._setupDepthStencilTexture=function(Z,M,j,K,b,g){void 0===g&&(g=1);var O=M.width||M,Q=M.height||M,Y=M.layers||0;Z.baseWidth=O,Z.baseHeight=Q,Z.width=O,Z.height=Q,Z.is2DArray=Y>0,Z.depth=Y,Z.isReady=!0,Z.samples=g,Z.generateMipMaps=!1,Z.samplingMode=K?2:1,Z.type=0,Z._comparisonFunction=b;var I=this._gl,E=this._getTextureTarget(Z),s=this._getSamplingParameters(Z.samplingMode,!1);I.texParameteri(E,I.TEXTURE_MAG_FILTER,s.mag),I.texParameteri(E,I.TEXTURE_MIN_FILTER,s.min),I.texParameteri(E,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(E,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===b?(I.texParameteri(E,I.TEXTURE_COMPARE_FUNC,515),I.texParameteri(E,I.TEXTURE_COMPARE_MODE,I.NONE)):(I.texParameteri(E,I.TEXTURE_COMPARE_FUNC,b),I.texParameteri(E,I.TEXTURE_COMPARE_MODE,I.COMPARE_REF_TO_TEXTURE)))},Z.prototype._uploadCompressedDataToTextureDirectly=function(Z,M,j,K,b,g,O){void 0===g&&(g=0),void 0===O&&(O=0);var Q=this._gl,Y=Q.TEXTURE_2D;if(Z.isCube&&(Y=Q.TEXTURE_CUBE_MAP_POSITIVE_X+g),Z._useSRGBBuffer)switch(M){case 37492:case 36196:this._caps.etc2?M=Q.COMPRESSED_SRGB8_ETC2:Z._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?M=Q.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:Z._useSRGBBuffer=!1;break;case 36492:M=Q.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:M=Q.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?M=Q.COMPRESSED_SRGB_S3TC_DXT1_EXT:Z._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?M=Q.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:Z._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?M=Q.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:Z._useSRGBBuffer=!1;break;default:Z._useSRGBBuffer=!1}this._gl.compressedTexImage2D(Y,O,M,j,K,0,b)},Z.prototype._uploadDataToTextureDirectly=function(Z,M,j,K,b,g){void 0===j&&(j=0),void 0===K&&(K=0),void 0===g&&(g=!1);var O=this._gl,Q=this._getWebGLTextureType(Z.type),Y=this._getInternalFormat(Z.format),I=void 0===b?this._getRGBABufferInternalSizedFormat(Z.type,Z.format,Z._useSRGBBuffer):this._getInternalFormat(b,Z._useSRGBBuffer);this._unpackFlipY(Z.invertY);var E=O.TEXTURE_2D;Z.isCube&&(E=O.TEXTURE_CUBE_MAP_POSITIVE_X+j);var s=Math.round(Math.log(Z.width)*Math.LOG2E),i=Math.round(Math.log(Z.height)*Math.LOG2E),a=g?Z.width:Math.pow(2,Math.max(s-K,0)),z=g?Z.height:Math.pow(2,Math.max(i-K,0));O.texImage2D(E,K,I,a,z,0,Y,Q,M)},Z.prototype.updateTextureData=function(Z,M,j,K,b,g,O,Q,Y){void 0===O&&(O=0),void 0===Q&&(Q=0),void 0===Y&&(Y=!1);var I=this._gl,E=this._getWebGLTextureType(Z.type),s=this._getInternalFormat(Z.format);this._unpackFlipY(Z.invertY);var i=I.TEXTURE_2D;Z.isCube&&(i=I.TEXTURE_CUBE_MAP_POSITIVE_X+O),this._bindTextureDirectly(i,Z,!0),I.texSubImage2D(i,Q,j,K,b,g,s,E,M),Y&&this._gl.generateMipmap(i),this._bindTextureDirectly(i,null)},Z.prototype._uploadArrayBufferViewToTexture=function(Z,M,j,K){void 0===j&&(j=0),void 0===K&&(K=0);var b=this._gl,g=Z.isCube?b.TEXTURE_CUBE_MAP:b.TEXTURE_2D;this._bindTextureDirectly(g,Z,!0),this._uploadDataToTextureDirectly(Z,M,j,K),this._bindTextureDirectly(g,null,!0)},Z.prototype._prepareWebGLTextureContinuation=function(Z,M,j,K,b){var g=this._gl;if(g){var O=this._getSamplingParameters(b,!j);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,O.mag),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,O.min),j||K||g.generateMipmap(g.TEXTURE_2D),this._bindTextureDirectly(g.TEXTURE_2D,null),M&&M._removePendingData(Z),Z.onLoadedObservable.notifyObservers(Z),Z.onLoadedObservable.clear()}},Z.prototype._prepareWebGLTexture=function(M,j,K,b,g,O,Q,Y,I){var E=this;void 0===I&&(I=3);var s=this.getCaps().maxTextureSize,i=Math.min(s,this.needPOTTextures?Z.GetExponentOfTwo(b.width,s):b.width),a=Math.min(s,this.needPOTTextures?Z.GetExponentOfTwo(b.height,s):b.height),z=this._gl;z&&(M._hardwareTexture?(this._bindTextureDirectly(z.TEXTURE_2D,M,!0),this._unpackFlipY(void 0===g||!!g),M.baseWidth=b.width,M.baseHeight=b.height,M.width=i,M.height=a,M.isReady=!0,Y(i,a,b,j,M,(function(){E._prepareWebGLTextureContinuation(M,K,O,Q,I)}))||this._prepareWebGLTextureContinuation(M,K,O,Q,I)):K&&K._removePendingData(M))},Z.prototype._setupFramebufferDepthAttachments=function(Z,M,j,K,b){void 0===b&&(b=1);var g=this._gl;if(Z&&M)return this._createRenderBuffer(j,K,b,g.DEPTH_STENCIL,g.DEPTH24_STENCIL8,g.DEPTH_STENCIL_ATTACHMENT);if(M){var O=g.DEPTH_COMPONENT16;return this._webGLVersion>1&&(O=g.DEPTH_COMPONENT32F),this._createRenderBuffer(j,K,b,O,O,g.DEPTH_ATTACHMENT)}return Z?this._createRenderBuffer(j,K,b,g.STENCIL_INDEX8,g.STENCIL_INDEX8,g.STENCIL_ATTACHMENT):null},Z.prototype._createRenderBuffer=function(Z,M,j,K,b,g,O){void 0===O&&(O=!0);var Q=this._gl,Y=Q.createRenderbuffer();return Q.bindRenderbuffer(Q.RENDERBUFFER,Y),j>1&&Q.renderbufferStorageMultisample?Q.renderbufferStorageMultisample(Q.RENDERBUFFER,j,b,Z,M):Q.renderbufferStorage(Q.RENDERBUFFER,K,Z,M),Q.framebufferRenderbuffer(Q.FRAMEBUFFER,g,Q.RENDERBUFFER,Y),O&&Q.bindRenderbuffer(Q.RENDERBUFFER,null),Y},Z.prototype._releaseTexture=function(Z){var M;this._deleteTexture(null===(M=Z._hardwareTexture)||void 0===M?void 0:M.underlyingResource),this.unbindAllTextures();var j=this._internalTexturesCache.indexOf(Z);-1!==j&&this._internalTexturesCache.splice(j,1),Z._lodTextureHigh&&Z._lodTextureHigh.dispose(),Z._lodTextureMid&&Z._lodTextureMid.dispose(),Z._lodTextureLow&&Z._lodTextureLow.dispose(),Z._irradianceTexture&&Z._irradianceTexture.dispose()},Z.prototype._releaseRenderTargetWrapper=function(Z){var M=this._renderTargetWrapperCache.indexOf(Z);-1!==M&&this._renderTargetWrapperCache.splice(M,1)},Z.prototype._deleteTexture=function(Z){Z&&this._gl.deleteTexture(Z)},Z.prototype._setProgram=function(Z){this._currentProgram!==Z&&(this._gl.useProgram(Z),this._currentProgram=Z)},Z.prototype.bindSamplers=function(Z){var M=Z.getPipelineContext();this._setProgram(M.program);for(var j=Z.getSamplers(),K=0;K<j.length;K++){var b=Z.getUniform(j[K]);b&&(this._boundUniforms[K]=b)}this._currentEffect=null},Z.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},Z.prototype._bindTextureDirectly=function(Z,M,j,K){var b,g;void 0===j&&(j=!1),void 0===K&&(K=!1);var O=!1,Q=M&&M._associatedChannel>-1;if(j&&Q&&(this._activeChannel=M._associatedChannel),this._boundTexturesCache[this._activeChannel]!==M||K){if(this._activateCurrentTexture(),M&&M.isMultiview)throw console.error(Z,M),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(Z,null!==(g=null===(b=null===M||void 0===M?void 0:M._hardwareTexture)||void 0===b?void 0:b.underlyingResource)&&void 0!==g?g:null),this._boundTexturesCache[this._activeChannel]=M,M&&(M._associatedChannel=this._activeChannel)}else j&&(O=!0,this._activateCurrentTexture());return Q&&!j&&this._bindSamplerUniformToChannel(M._associatedChannel,this._activeChannel),O},Z.prototype._bindTexture=function(Z,M,j){if(void 0!==Z){M&&(M._associatedChannel=Z),this._activeChannel=Z;var K=M?this._getTextureTarget(M):this._gl.TEXTURE_2D;this._bindTextureDirectly(K,M)}},Z.prototype.unbindAllTextures=function(){for(var Z=0;Z<this._maxSimultaneousTextures;Z++)this._activeChannel=Z,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},Z.prototype.setTexture=function(Z,M,j,K){void 0!==Z&&(M&&(this._boundUniforms[Z]=M),this._setTexture(Z,j))},Z.prototype._bindSamplerUniformToChannel=function(Z,M){var j=this._boundUniforms[Z];j&&j._currentState!==M&&(this._gl.uniform1i(j,M),j._currentState=M)},Z.prototype._getTextureWrapMode=function(Z){switch(Z){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},Z.prototype._setTexture=function(Z,M,j,K,b){if(void 0===j&&(j=!1),void 0===K&&(K=!1),void 0===b&&(b=""),!M)return null!=this._boundTexturesCache[Z]&&(this._activeChannel=Z,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(M.video)this._activeChannel=Z,M.update();else if(4===M.delayLoadState)return M.delayLoad(),!1;var g;g=K?M.depthStencilTexture:M.isReady()?M.getInternalTexture():M.isCube?this.emptyCubeTexture:M.is3D?this.emptyTexture3D:M.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!j&&g&&(g._associatedChannel=Z);var O=!0;this._boundTexturesCache[Z]===g&&(j||this._bindSamplerUniformToChannel(g._associatedChannel,Z),O=!1),this._activeChannel=Z;var Q=this._getTextureTarget(g);if(O&&this._bindTextureDirectly(Q,g,j),g&&!g.isMultiview){if(g.isCube&&g._cachedCoordinatesMode!==M.coordinatesMode){g._cachedCoordinatesMode=M.coordinatesMode;var Y=3!==M.coordinatesMode&&5!==M.coordinatesMode?1:0;M.wrapU=Y,M.wrapV=Y}g._cachedWrapU!==M.wrapU&&(g._cachedWrapU=M.wrapU,this._setTextureParameterInteger(Q,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(M.wrapU),g)),g._cachedWrapV!==M.wrapV&&(g._cachedWrapV=M.wrapV,this._setTextureParameterInteger(Q,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(M.wrapV),g)),g.is3D&&g._cachedWrapR!==M.wrapR&&(g._cachedWrapR=M.wrapR,this._setTextureParameterInteger(Q,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(M.wrapR),g)),this._setAnisotropicLevel(Q,g,M.anisotropicFilteringLevel)}return!0},Z.prototype.setTextureArray=function(Z,M,j,K){if(void 0!==Z&&M){this._textureUnits&&this._textureUnits.length===j.length||(this._textureUnits=new Int32Array(j.length));for(var b=0;b<j.length;b++){var g=j[b].getInternalTexture();g?(this._textureUnits[b]=Z+b,g._associatedChannel=Z+b):this._textureUnits[b]=-1}this._gl.uniform1iv(M,this._textureUnits);for(var O=0;O<j.length;O++)this._setTexture(this._textureUnits[O],j[O],!0)}},Z.prototype._setAnisotropicLevel=function(Z,M,j){var K=this._caps.textureAnisotropicFilterExtension;11!==M.samplingMode&&3!==M.samplingMode&&2!==M.samplingMode&&(j=1),K&&M._cachedAnisotropicFilteringLevel!==j&&(this._setTextureParameterFloat(Z,K.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(j,this._caps.maxAnisotropy),M),M._cachedAnisotropicFilteringLevel=j)},Z.prototype._setTextureParameterFloat=function(Z,M,j,K){this._bindTextureDirectly(Z,K,!0,!0),this._gl.texParameterf(Z,M,j)},Z.prototype._setTextureParameterInteger=function(Z,M,j,K){K&&this._bindTextureDirectly(Z,K,!0,!0),this._gl.texParameteri(Z,M,j)},Z.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var Z=0;Z<this._caps.maxVertexAttribs;Z++)this.disableAttributeByIndex(Z)}else{Z=0;for(var M=this._vertexAttribArraysEnabled.length;Z<M;Z++)Z>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[Z]||this.disableAttributeByIndex(Z)}},Z.prototype.releaseEffects=function(){for(var Z in this._compiledEffects){var M=this._compiledEffects[Z].getPipelineContext();this._deletePipelineContext(M)}this._compiledEffects={}},Z.prototype.dispose=function(){var Z;this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),null===(Z=this.releaseComputeEffects)||void 0===Z||Z.call(this),this.unbindAllAttributes(),this._boundUniforms=[],(0,a.q)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,g.e.ResetCache();for(var M=0,j=this._activeRequests;M<j.length;M++){j[M].abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},Z.prototype.attachContextLostEvent=function(Z){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",Z,!1)},Z.prototype.attachContextRestoredEvent=function(Z){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",Z,!1)},Z.prototype.getError=function(){return this._gl.getError()},Z.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},Z.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},Z.prototype._canRenderToFramebuffer=function(Z){for(var M=this._gl;M.getError()!==M.NO_ERROR;);var j=!0,K=M.createTexture();M.bindTexture(M.TEXTURE_2D,K),M.texImage2D(M.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(Z),1,1,0,M.RGBA,this._getWebGLTextureType(Z),null),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.NEAREST),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.NEAREST);var b=M.createFramebuffer();M.bindFramebuffer(M.FRAMEBUFFER,b),M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_2D,K,0);var g=M.checkFramebufferStatus(M.FRAMEBUFFER);if((j=(j=j&&g===M.FRAMEBUFFER_COMPLETE)&&M.getError()===M.NO_ERROR)&&(M.clear(M.COLOR_BUFFER_BIT),j=j&&M.getError()===M.NO_ERROR),j){M.bindFramebuffer(M.FRAMEBUFFER,null);var O=M.RGBA,Q=M.UNSIGNED_BYTE,Y=new Uint8Array(4);M.readPixels(0,0,1,1,O,Q,Y),j=j&&M.getError()===M.NO_ERROR}for(M.deleteTexture(K),M.deleteFramebuffer(b),M.bindFramebuffer(M.FRAMEBUFFER,null);!j&&M.getError()!==M.NO_ERROR;);return j},Z.prototype._getWebGLTextureType=function(Z){if(1===this._webGLVersion){switch(Z){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(Z){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},Z.prototype._getInternalFormat=function(Z,M){void 0===M&&(M=!1);var j=M?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(Z){case 0:j=this._gl.ALPHA;break;case 1:j=this._gl.LUMINANCE;break;case 2:j=this._gl.LUMINANCE_ALPHA;break;case 6:j=this._gl.RED;break;case 7:j=this._gl.RG;break;case 4:j=M?this._gl.SRGB:this._gl.RGB;break;case 5:j=M?this._gl.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(Z){case 8:j=this._gl.RED_INTEGER;break;case 9:j=this._gl.RG_INTEGER;break;case 10:j=this._gl.RGB_INTEGER;break;case 11:j=this._gl.RGBA_INTEGER}return j},Z.prototype._getRGBABufferInternalSizedFormat=function(Z,M,j){if(void 0===j&&(j=!1),1===this._webGLVersion){if(void 0!==M)switch(M){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return j?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(Z){case 3:switch(M){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(M){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return j?this._gl.SRGB8:this._gl.RGB8;case 5:return j?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(M){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(M){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(M){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(M){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(M){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(M){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(M){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return j?this._gl.SRGB8_ALPHA8:this._gl.RGBA8},Z.prototype._getRGBAMultiSampleBufferFormat=function(Z){return 1===Z?this._gl.RGBA32F:2===Z?this._gl.RGBA16F:this._gl.RGBA8},Z.prototype._loadFile=function(M,j,K,b,g,O){var Q=this,Y=Z._FileToolsLoadFile(M,j,K,b,g,O);return this._activeRequests.push(Y),Y.onCompleteObservable.add((function(Z){Q._activeRequests.splice(Q._activeRequests.indexOf(Z),1)})),Y},Z._FileToolsLoadFile=function(Z,M,j,K,b,g){throw(0,O.e)("FileTools")},Z.prototype.readPixels=function(Z,M,j,K,b,g){void 0===b&&(b=!0),void 0===g&&(g=!0);var O=b?4:3,Q=b?this._gl.RGBA:this._gl.RGB,Y=new Uint8Array(K*j*O);return g&&this.flushFramebuffer(),this._gl.readPixels(Z,M,j,K,Q,this._gl.UNSIGNED_BYTE,Y),Promise.resolve(Y)},Object.defineProperty(Z,"IsSupportedAsync",{get:function(){return Promise.resolve(this.isSupported())},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),Z.isSupported=function(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{var Z=this._CreateCanvas(1,1),M=Z.getContext("webgl")||Z.getContext("experimental-webgl");this._IsSupported=null!=M&&!!window.WebGLRenderingContext}catch(Z){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(Z,"HasMajorPerformanceCaveat",{get:function(){if(null===this._HasMajorPerformanceCaveat)try{var Z=this._CreateCanvas(1,1),M=Z.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||Z.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!M}catch(Z){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),Z.CeilingPOT=function(Z){return Z--,Z|=Z>>1,Z|=Z>>2,Z|=Z>>4,Z|=Z>>8,Z|=Z>>16,++Z},Z.FloorPOT=function(Z){return Z|=Z>>1,Z|=Z>>2,Z|=Z>>4,Z|=Z>>8,(Z|=Z>>16)-(Z>>1)},Z.NearestPOT=function(M){var j=Z.CeilingPOT(M),K=Z.FloorPOT(M);return j-M>M-K?K:j},Z.GetExponentOfTwo=function(M,j,K){var b;switch(void 0===K&&(K=2),K){case 1:b=Z.FloorPOT(M);break;case 2:b=Z.NearestPOT(M);break;default:b=Z.CeilingPOT(M)}return Math.min(b,j)},Z.QueueNewFrame=function(Z,M){return(0,a.q)()?(M||(M=window),M.requestPostAnimationFrame?M.requestPostAnimationFrame(Z):M.requestAnimationFrame?M.requestAnimationFrame(Z):M.msRequestAnimationFrame?M.msRequestAnimationFrame(Z):M.webkitRequestAnimationFrame?M.webkitRequestAnimationFrame(Z):M.mozRequestAnimationFrame?M.mozRequestAnimationFrame(Z):M.oRequestAnimationFrame?M.oRequestAnimationFrame(Z):window.setTimeout(Z,16)):"undefined"!==typeof requestAnimationFrame?requestAnimationFrame(Z):setTimeout(Z,16)},Z.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,a.k)()?document:null},Z.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],Z._TextureLoaders=[],Z.CollisionsEpsilon=.001,Z._IsSupported=null,Z._HasMajorPerformanceCaveat=null,Z}()},13316:function(Z,M,j){"use strict";var K;j.d(M,{e:function(){return b}}),function(Z){Z[Z.PointerMove=0]="PointerMove",Z[Z.PointerDown=1]="PointerDown",Z[Z.PointerUp=2]="PointerUp"}(K||(K={}));var b=function(){function Z(){}return Z.DOM_DELTA_PIXEL=0,Z.DOM_DELTA_LINE=1,Z.DOM_DELTA_PAGE=2,Z}()},45591:function(Z,M,j){"use strict";j.d(M,{e:function(){return b},h:function(){return O},j:function(){return g}});var K=j(40061),b=function(){function Z(){}return Z.KEYDOWN=1,Z.KEYUP=2,Z}(),g=function(Z,M){this.type=Z,this.event=M},O=function(Z){function M(M,j){var K=Z.call(this,M,j)||this;return K.type=M,K.event=j,K.skipOnKeyboardObservable=!1,K}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"skipOnPointerObservable",{get:function(){return this.skipOnKeyboardObservable},set:function(Z){this.skipOnKeyboardObservable=Z},enumerable:!1,configurable:!0}),M}(g)},25239:function(Z,M,j){"use strict";j.d(M,{d:function(){return g},h:function(){return Q},j:function(){return Y}});var K=j(40061),b=j(80105),g=function(){function Z(){}return Z.POINTERDOWN=1,Z.POINTERUP=2,Z.POINTERMOVE=4,Z.POINTERWHEEL=8,Z.POINTERPICK=16,Z.POINTERTAP=32,Z.POINTERDOUBLETAP=64,Z}(),O=function(Z,M){this.type=Z,this.event=M},Q=function(Z){function M(M,j,K,g){var O=Z.call(this,M,j)||this;return O.ray=null,O.skipOnPointerObservable=!1,O.localPosition=new b.h(K,g),O}return(0,K.m)(M,Z),M}(O),Y=function(Z){function M(M,j,K){var b=Z.call(this,M,j)||this;return b.pickInfo=K,b}return(0,K.m)(M,Z),M}(O)},23257:function(Z,M,j){"use strict";j.r(M),j.d(M,{SceneInstrumentation:function(){return g}});var K=j(9217),b=j(16945),g=function(){function Z(Z){var M=this;this.scene=Z,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new b.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new b.d,this._captureFrameTime=!1,this._frameTime=new b.d,this._captureRenderTime=!1,this._renderTime=new b.d,this._captureInterFrameTime=!1,this._interFrameTime=new b.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new b.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new b.d,this._capturePhysicsTime=!1,this._physicsTime=new b.d,this._captureAnimationsTime=!1,this._animationsTime=new b.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new b.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=Z.onBeforeAnimationsObservable.add((function(){M._captureActiveMeshesEvaluationTime&&M._activeMeshesEvaluationTime.fetchNewFrame(),M._captureRenderTargetsRenderTime&&M._renderTargetsRenderTime.fetchNewFrame(),M._captureFrameTime&&(K.d.StartPerformanceCounter("Scene rendering"),M._frameTime.beginMonitoring()),M._captureInterFrameTime&&M._interFrameTime.endMonitoring(),M._captureParticlesRenderTime&&M._particlesRenderTime.fetchNewFrame(),M._captureSpritesRenderTime&&M._spritesRenderTime.fetchNewFrame(),M._captureAnimationsTime&&M._animationsTime.beginMonitoring(),M.scene.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=Z.onAfterRenderObservable.add((function(){M._captureFrameTime&&(K.d.EndPerformanceCounter("Scene rendering"),M._frameTime.endMonitoring()),M._captureRenderTime&&M._renderTime.endMonitoring(!1),M._captureInterFrameTime&&M._interFrameTime.beginMonitoring()}))}return Object.defineProperty(Z.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(Z){var M=this;Z!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=Z,Z?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add((function(){K.d.StartPerformanceCounter("Active meshes evaluation"),M._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add((function(){K.d.EndPerformanceCounter("Active meshes evaluation"),M._activeMeshesEvaluationTime.endMonitoring()}))):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(Z){var M=this;Z!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=Z,Z?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add((function(){K.d.StartPerformanceCounter("Render targets rendering"),M._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add((function(){K.d.EndPerformanceCounter("Render targets rendering"),M._renderTargetsRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(Z){var M=this;Z!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=Z,Z?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add((function(){K.d.StartPerformanceCounter("Particles"),M._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add((function(){K.d.EndPerformanceCounter("Particles"),M._particlesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(Z){var M=this;Z!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=Z,this.scene.spriteManagers&&(Z?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add((function(){K.d.StartPerformanceCounter("Sprites"),M._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add((function(){K.d.EndPerformanceCounter("Sprites"),M._spritesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(Z){var M=this;Z!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=Z,Z?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add((function(){K.d.StartPerformanceCounter("Physics"),M._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add((function(){K.d.EndPerformanceCounter("Physics"),M._physicsTime.endMonitoring()}))):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(Z){var M=this;Z!==this._captureAnimationsTime&&(this._captureAnimationsTime=Z,Z?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add((function(){M._animationsTime.endMonitoring()})):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(Z){this._captureFrameTime=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(Z){this._captureInterFrameTime=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(Z){var M=this;Z!==this._captureRenderTime&&(this._captureRenderTime=Z,Z?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add((function(){M._renderTime.beginMonitoring(),K.d.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add((function(){M._renderTime.endMonitoring(!1),K.d.EndPerformanceCounter("Main render")}))):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(Z){var M=this;Z!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=Z,Z?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add((function(Z){M._cameraRenderTime.beginMonitoring(),K.d.StartPerformanceCounter("Rendering camera ".concat(Z.name))})),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add((function(Z){M._cameraRenderTime.endMonitoring(!1),K.d.EndPerformanceCounter("Rendering camera ".concat(Z.name))}))):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!1,configurable:!0}),Z.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},Z}()},15706:function(Z,M,j){"use strict";j.d(M,{c:function(){return I}});var K=j(40061),b=j(9892),g=j(80105),O=j(74134),Q=j(315),Y=j(13680);O.b.AddNodeConstructor("Light_Type_1",(function(Z,M){return function(){return new I(Z,g.k.Zero(),M)}}));var I=function(Z){function M(M,j,K){var b=Z.call(this,M,K)||this;return b._shadowFrustumSize=0,b._shadowOrthoScale=.1,b.autoUpdateExtends=!0,b.autoCalcShadowZBounds=!1,b._orthoLeft=Number.MAX_VALUE,b._orthoRight=Number.MIN_VALUE,b._orthoTop=Number.MIN_VALUE,b._orthoBottom=Number.MAX_VALUE,b.position=j.scale(-1),b.direction=j,b}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(Z){this._shadowFrustumSize=Z,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(Z){this._shadowOrthoScale=Z,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"orthoLeft",{get:function(){return this._orthoLeft},set:function(Z){this._orthoLeft=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"orthoRight",{get:function(){return this._orthoRight},set:function(Z){this._orthoRight=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"orthoTop",{get:function(){return this._orthoTop},set:function(Z){this._orthoTop=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"orthoBottom",{get:function(){return this._orthoBottom},set:function(Z){this._orthoBottom=Z},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"DirectionalLight"},M.prototype.getTypeID=function(){return Q.e.LIGHTTYPEID_DIRECTIONALLIGHT},M.prototype._setDefaultShadowProjectionMatrix=function(Z,M,j){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(Z):this._setDefaultAutoExtendShadowProjectionMatrix(Z,M,j)},M.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(Z){var M=this.getScene().activeCamera;M&&g.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:M.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:M.maxZ,Z,this.getScene().getEngine().isNDCHalfZRange)},M.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(Z,M,j){var K=this.getScene().activeCamera;if(K){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var b=g.k.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var O=Number.MAX_VALUE,Q=Number.MIN_VALUE,Y=0;Y<j.length;Y++){var I=j[Y];if(I)for(var E=I.getBoundingInfo().boundingBox,s=0;s<E.vectorsWorld.length;s++)g.k.TransformCoordinatesToRef(E.vectorsWorld[s],M,b),b.x<this._orthoLeft&&(this._orthoLeft=b.x),b.y<this._orthoBottom&&(this._orthoBottom=b.y),b.x>this._orthoRight&&(this._orthoRight=b.x),b.y>this._orthoTop&&(this._orthoTop=b.y),this.autoCalcShadowZBounds&&(b.z<O&&(O=b.z),b.z>Q&&(Q=b.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=O,this._shadowMaxZ=Q)}var i=this._orthoRight-this._orthoLeft,a=this._orthoTop-this._orthoBottom,z=void 0!==this.shadowMinZ?this.shadowMinZ:K.minZ,V=void 0!==this.shadowMaxZ?this.shadowMaxZ:K.maxZ,o=this.getScene().getEngine().useReverseDepthBuffer;g.c.OrthoOffCenterLHToRef(this._orthoLeft-i*this.shadowOrthoScale,this._orthoRight+i*this.shadowOrthoScale,this._orthoBottom-a*this.shadowOrthoScale,this._orthoTop+a*this.shadowOrthoScale,o?V:z,o?z:V,Z,this.getScene().getEngine().isNDCHalfZRange)}},M.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},M.prototype.transferToEffect=function(Z,M){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,M),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,M),this)},M.prototype.transferToNodeMaterialEffect=function(Z,M){return this.computeTransformedInformation()?(Z.setFloat3(M,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(Z.setFloat3(M,this.direction.x,this.direction.y,this.direction.z),this)},M.prototype.getDepthMinZ=function(Z){var M=this._scene.getEngine();return!M.useReverseDepthBuffer&&M.isNDCHalfZRange?0:1},M.prototype.getDepthMaxZ=function(Z){var M=this._scene.getEngine();return M.useReverseDepthBuffer&&M.isNDCHalfZRange?0:1},M.prototype.prepareLightSpecificDefines=function(Z,M){Z["DIRLIGHT"+M]=!0},(0,K.l)([(0,b.z)()],M.prototype,"shadowFrustumSize",null),(0,K.l)([(0,b.z)()],M.prototype,"shadowOrthoScale",null),(0,K.l)([(0,b.z)()],M.prototype,"autoUpdateExtends",void 0),(0,K.l)([(0,b.z)()],M.prototype,"autoCalcShadowZBounds",void 0),(0,K.l)([(0,b.z)("orthoLeft")],M.prototype,"_orthoLeft",void 0),(0,K.l)([(0,b.z)("orthoRight")],M.prototype,"_orthoRight",void 0),(0,K.l)([(0,b.z)("orthoTop")],M.prototype,"_orthoTop",void 0),(0,K.l)([(0,b.z)("orthoBottom")],M.prototype,"_orthoBottom",void 0),M}(Y.e)},23056:function(Z,M,j){"use strict";j.d(M,{c:function(){return I}});var K=j(40061),b=j(9892),g=j(80105),O=j(9488),Q=j(74134),Y=j(315);Q.b.AddNodeConstructor("Light_Type_3",(function(Z,M){return function(){return new I(Z,g.k.Zero(),M)}}));var I=function(Z){function M(M,j,K){var b=Z.call(this,M,K)||this;return b.groundColor=new O.e(0,0,0),b.direction=j||g.k.Up(),b}return(0,K.m)(M,Z),M.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},M.prototype.getClassName=function(){return"HemisphericLight"},M.prototype.setDirectionToTarget=function(Z){return this.direction=g.k.Normalize(Z.subtract(g.k.Zero())),this.direction},M.prototype.getShadowGenerator=function(){return null},M.prototype.transferToEffect=function(Z,M){var j=g.k.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",j.x,j.y,j.z,0,M),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),M),this},M.prototype.transferToNodeMaterialEffect=function(Z,M){var j=g.k.Normalize(this.direction);return Z.setFloat3(M,j.x,j.y,j.z),this},M.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=g.c.Identity()),this._worldMatrix},M.prototype.getTypeID=function(){return Y.e.LIGHTTYPEID_HEMISPHERICLIGHT},M.prototype.prepareLightSpecificDefines=function(Z,M){Z["HEMILIGHT"+M]=!0},(0,K.l)([(0,b.i)()],M.prototype,"groundColor",void 0),(0,K.l)([(0,b.x)()],M.prototype,"direction",void 0),M}(Y.e)},315:function(Z,M,j){"use strict";j.d(M,{e:function(){return s}});var K=j(40061),b=j(9892),g=j(80105),O=j(9488),Q=j(74134),Y=j(90534),I=j(31709),E=j(21876),s=function(Z){function M(j,K){var b=Z.call(this,j,K)||this;return b.diffuse=new O.e(1,1,1),b.specular=new O.e(1,1,1),b.falloffType=M.FALLOFF_DEFAULT,b.intensity=1,b._range=Number.MAX_VALUE,b._inverseSquaredRange=0,b._photometricScale=1,b._intensityMode=M.INTENSITYMODE_AUTOMATIC,b._radius=1e-5,b.renderPriority=0,b._shadowEnabled=!0,b._excludeWithLayerMask=0,b._includeOnlyWithLayerMask=0,b._lightmapMode=0,b._excludedMeshesIds=new Array,b._includedOnlyMeshesIds=new Array,b._isLight=!0,b.getScene().addLight(b),b._uniformBuffer=new Y.d(b.getScene().getEngine(),void 0,void 0,j),b._buildUniformLayout(),b.includedOnlyMeshes=new Array,b.excludedMeshes=new Array,b._resyncMeshes(),b}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"range",{get:function(){return this._range},set:function(Z){this._range=Z,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(Z){this._intensityMode=Z,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"radius",{get:function(){return this._radius},set:function(Z){this._radius=Z,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(Z){this._shadowEnabled!==Z&&(this._shadowEnabled=Z,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(Z){this._includedOnlyMeshes=Z,this._hookArrayForIncludedOnly(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(Z){this._excludedMeshes=Z,this._hookArrayForExcluded(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(Z){this._excludeWithLayerMask=Z,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(Z){this._includeOnlyWithLayerMask=Z,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(Z){this._lightmapMode!==Z&&(this._lightmapMode=Z,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),M.prototype.transferTexturesToEffect=function(Z,M){return this},M.prototype._bindLight=function(Z,M,j,K,b){void 0===b&&(b=!0);var g=Z.toString(),Q=!1;if(this._uniformBuffer.bindToEffect(j,"Light"+g),this._renderId!==M.getRenderId()||this._lastUseSpecular!==K||!this._uniformBuffer.useUbo){this._renderId=M.getRenderId(),this._lastUseSpecular=K;var Y=this.getScaledIntensity();this.transferToEffect(j,g),this.diffuse.scaleToRef(Y,O.h.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",O.h.Color3[0],this.range,g),K&&(this.specular.scaleToRef(Y,O.h.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",O.h.Color3[1],this.radius,g)),Q=!0}if(this.transferTexturesToEffect(j,g),M.shadowsEnabled&&this.shadowEnabled&&b){var I=this.getShadowGenerator();I&&(I.bindShadowLight(g,j),Q=!0)}Q?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()},M.prototype.getClassName=function(){return"Light"},M.prototype.toString=function(Z){var M="Name: "+this.name;if(M+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var j=0;j<this.animations.length;j++)M+=", animation[0]: "+this.animations[j].toString(Z);return M},M.prototype._syncParentEnabledState=function(){Z.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},M.prototype.setEnabled=function(M){Z.prototype.setEnabled.call(this,M),this._resyncMeshes()},M.prototype.getShadowGenerator=function(){return this._shadowGenerator},M.prototype.getAbsolutePosition=function(){return g.k.Zero()},M.prototype.canAffectMesh=function(Z){return!Z||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(Z))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(Z))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&Z.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&Z.layerMask)))},M.prototype.dispose=function(M,j){if(void 0===j&&(j=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this),this._parentContainer){var K=this._parentContainer.lights.indexOf(this);K>-1&&this._parentContainer.lights.splice(K,1),this._parentContainer=null}for(var b=0,g=this.getScene().meshes;b<g.length;b++){g[b]._removeLightSource(this,!0)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),Z.prototype.dispose.call(this,M,j)},M.prototype.getTypeID=function(){return 0},M.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},M.prototype.clone=function(Z,j){void 0===j&&(j=null);var K=M.GetConstructorFromName(this.getTypeID(),Z,this.getScene());if(!K)return null;var g=b.b.Clone(K,this);return Z&&(g.name=Z),j&&(g.parent=j),g.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(g),g},M.prototype.serialize=function(){var Z=b.b.Serialize(this);return Z.uniqueId=this.uniqueId,Z.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(Z),this.excludedMeshes.length>0&&(Z.excludedMeshesIds=[],this.excludedMeshes.forEach((function(M){Z.excludedMeshesIds.push(M.id)}))),this.includedOnlyMeshes.length>0&&(Z.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((function(M){Z.includedOnlyMeshesIds.push(M.id)}))),b.b.AppendSerializedAnimations(this,Z),Z.ranges=this.serializeAnimationRanges(),Z.isEnabled=this.isEnabled(),Z},M.GetConstructorFromName=function(Z,M,j){var K=Q.b.Construct("Light_Type_"+Z,M,j);return K||null},M.Parse=function(Z,j){var K=M.GetConstructorFromName(Z.type,Z.name,j);if(!K)return null;var g=b.b.Parse(K,Z,j);if(Z.excludedMeshesIds&&(g._excludedMeshesIds=Z.excludedMeshesIds),Z.includedOnlyMeshesIds&&(g._includedOnlyMeshesIds=Z.includedOnlyMeshesIds),void 0!==Z.parentId&&(g._waitingParentId=Z.parentId),void 0!==Z.parentInstanceIndex&&(g._waitingParentInstanceIndex=Z.parentInstanceIndex),void 0!==Z.falloffType&&(g.falloffType=Z.falloffType),void 0!==Z.lightmapMode&&(g.lightmapMode=Z.lightmapMode),Z.animations){for(var O=0;O<Z.animations.length;O++){var Y=Z.animations[O],E=(0,I.b)("BABYLON.Animation");E&&g.animations.push(E.Parse(Y))}Q.b.ParseAnimationRanges(g,Z,j)}return Z.autoAnimate&&j.beginAnimation(g,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),void 0!==Z.isEnabled&&g.setEnabled(Z.isEnabled),g},M.prototype._hookArrayForExcluded=function(Z){var M=this,j=Z.push;Z.push=function(){for(var K=[],b=0;b<arguments.length;b++)K[b]=arguments[b];for(var g=j.apply(Z,K),O=0,Q=K;O<Q.length;O++){var Y=Q[O];Y._resyncLightSource(M)}return g};var K=Z.splice;Z.splice=function(j,b){for(var g=K.apply(Z,[j,b]),O=0,Q=g;O<Q.length;O++){Q[O]._resyncLightSource(M)}return g};for(var b=0,g=Z;b<g.length;b++){g[b]._resyncLightSource(this)}},M.prototype._hookArrayForIncludedOnly=function(Z){var M=this,j=Z.push;Z.push=function(){for(var K=[],b=0;b<arguments.length;b++)K[b]=arguments[b];var g=j.apply(Z,K);return M._resyncMeshes(),g};var K=Z.splice;Z.splice=function(j,b){var g=K.apply(Z,[j,b]);return M._resyncMeshes(),g},this._resyncMeshes()},M.prototype._resyncMeshes=function(){for(var Z=0,M=this.getScene().meshes;Z<M.length;Z++){M[Z]._resyncLightSource(this)}},M.prototype._markMeshesAsLightDirty=function(){for(var Z=0,M=this.getScene().meshes;Z<M.length;Z++){var j=M[Z];-1!==j.lightSources.indexOf(this)&&j._markSubMeshesAsLightDirty()}},M.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},M.prototype._getPhotometricScale=function(){var Z=0,j=this.getTypeID(),K=this.intensityMode;switch(K===M.INTENSITYMODE_AUTOMATIC&&(K=j===M.LIGHTTYPEID_DIRECTIONALLIGHT?M.INTENSITYMODE_ILLUMINANCE:M.INTENSITYMODE_LUMINOUSINTENSITY),j){case M.LIGHTTYPEID_POINTLIGHT:case M.LIGHTTYPEID_SPOTLIGHT:switch(K){case M.INTENSITYMODE_LUMINOUSPOWER:Z=1/(4*Math.PI);break;case M.INTENSITYMODE_LUMINOUSINTENSITY:Z=1;break;case M.INTENSITYMODE_LUMINANCE:Z=this.radius*this.radius}break;case M.LIGHTTYPEID_DIRECTIONALLIGHT:switch(K){case M.INTENSITYMODE_ILLUMINANCE:Z=1;break;case M.INTENSITYMODE_LUMINANCE:var b=this.radius;b=Math.max(b,.001),Z=2*Math.PI*(1-Math.cos(b))}break;case M.LIGHTTYPEID_HEMISPHERICLIGHT:Z=1}return Z},M.prototype._reorderLightsInScene=function(){var Z=this.getScene();0!=this._renderPriority&&(Z.requireLightSorting=!0),this.getScene().sortLightsByPriority()},M.FALLOFF_DEFAULT=E.b.FALLOFF_DEFAULT,M.FALLOFF_PHYSICAL=E.b.FALLOFF_PHYSICAL,M.FALLOFF_GLTF=E.b.FALLOFF_GLTF,M.FALLOFF_STANDARD=E.b.FALLOFF_STANDARD,M.LIGHTMAP_DEFAULT=E.b.LIGHTMAP_DEFAULT,M.LIGHTMAP_SPECULAR=E.b.LIGHTMAP_SPECULAR,M.LIGHTMAP_SHADOWSONLY=E.b.LIGHTMAP_SHADOWSONLY,M.INTENSITYMODE_AUTOMATIC=E.b.INTENSITYMODE_AUTOMATIC,M.INTENSITYMODE_LUMINOUSPOWER=E.b.INTENSITYMODE_LUMINOUSPOWER,M.INTENSITYMODE_LUMINOUSINTENSITY=E.b.INTENSITYMODE_LUMINOUSINTENSITY,M.INTENSITYMODE_ILLUMINANCE=E.b.INTENSITYMODE_ILLUMINANCE,M.INTENSITYMODE_LUMINANCE=E.b.INTENSITYMODE_LUMINANCE,M.LIGHTTYPEID_POINTLIGHT=E.b.LIGHTTYPEID_POINTLIGHT,M.LIGHTTYPEID_DIRECTIONALLIGHT=E.b.LIGHTTYPEID_DIRECTIONALLIGHT,M.LIGHTTYPEID_SPOTLIGHT=E.b.LIGHTTYPEID_SPOTLIGHT,M.LIGHTTYPEID_HEMISPHERICLIGHT=E.b.LIGHTTYPEID_HEMISPHERICLIGHT,(0,K.l)([(0,b.i)()],M.prototype,"diffuse",void 0),(0,K.l)([(0,b.i)()],M.prototype,"specular",void 0),(0,K.l)([(0,b.z)()],M.prototype,"falloffType",void 0),(0,K.l)([(0,b.z)()],M.prototype,"intensity",void 0),(0,K.l)([(0,b.z)()],M.prototype,"range",null),(0,K.l)([(0,b.z)()],M.prototype,"intensityMode",null),(0,K.l)([(0,b.z)()],M.prototype,"radius",null),(0,K.l)([(0,b.z)()],M.prototype,"_renderPriority",void 0),(0,K.l)([(0,b.c)("_reorderLightsInScene")],M.prototype,"renderPriority",void 0),(0,K.l)([(0,b.z)("shadowEnabled")],M.prototype,"_shadowEnabled",void 0),(0,K.l)([(0,b.z)("excludeWithLayerMask")],M.prototype,"_excludeWithLayerMask",void 0),(0,K.l)([(0,b.z)("includeOnlyWithLayerMask")],M.prototype,"_includeOnlyWithLayerMask",void 0),(0,K.l)([(0,b.z)("lightmapMode")],M.prototype,"_lightmapMode",void 0),M}(Q.b)},21876:function(Z,M,j){"use strict";j.d(M,{b:function(){return K}});var K=function(){function Z(){}return Z.CompareLightsPriority=function(Z,M){return Z.shadowEnabled!==M.shadowEnabled?(M.shadowEnabled?1:0)-(Z.shadowEnabled?1:0):M.renderPriority-Z.renderPriority},Z.FALLOFF_DEFAULT=0,Z.FALLOFF_PHYSICAL=1,Z.FALLOFF_GLTF=2,Z.FALLOFF_STANDARD=3,Z.LIGHTMAP_DEFAULT=0,Z.LIGHTMAP_SPECULAR=1,Z.LIGHTMAP_SHADOWSONLY=2,Z.INTENSITYMODE_AUTOMATIC=0,Z.INTENSITYMODE_LUMINOUSPOWER=1,Z.INTENSITYMODE_LUMINOUSINTENSITY=2,Z.INTENSITYMODE_ILLUMINANCE=3,Z.INTENSITYMODE_LUMINANCE=4,Z.LIGHTTYPEID_POINTLIGHT=0,Z.LIGHTTYPEID_DIRECTIONALLIGHT=1,Z.LIGHTTYPEID_SPOTLIGHT=2,Z.LIGHTTYPEID_HEMISPHERICLIGHT=3,Z}()},13680:function(Z,M,j){"use strict";j.d(M,{e:function(){return Y}});var K=j(40061),b=j(9892),g=j(80105),O=j(315),Q=j(54044),Y=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M._needProjectionMatrixCompute=!0,M}return(0,K.m)(M,Z),M.prototype._setPosition=function(Z){this._position=Z},Object.defineProperty(M.prototype,"position",{get:function(){return this._position},set:function(Z){this._setPosition(Z)},enumerable:!1,configurable:!0}),M.prototype._setDirection=function(Z){this._direction=Z},Object.defineProperty(M.prototype,"direction",{get:function(){return this._direction},set:function(Z){this._setDirection(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(Z){this._shadowMinZ=Z,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(Z){this._shadowMaxZ=Z,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),M.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=g.k.Zero()),g.k.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=g.k.Zero()),g.k.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},M.prototype.getDepthScale=function(){return 50},M.prototype.getShadowDirection=function(Z){return this.transformedDirection?this.transformedDirection:this.direction},M.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},M.prototype.setDirectionToTarget=function(Z){return this.direction=g.k.Normalize(Z.subtract(this.position)),this.direction},M.prototype.getRotation=function(){this.direction.normalize();var Z=g.k.Cross(this.direction,Q.b.Y),M=g.k.Cross(Z,this.direction);return g.k.RotationFromAxis(Z,M,this.direction)},M.prototype.needCube=function(){return!1},M.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},M.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},M.prototype._initCache=function(){Z.prototype._initCache.call(this),this._cache.position=g.k.Zero()},M.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},M.prototype.computeWorldMatrix=function(Z){return!Z&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=g.c.Identity()),g.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},M.prototype.getDepthMinZ=function(Z){return void 0!==this.shadowMinZ?this.shadowMinZ:Z.minZ},M.prototype.getDepthMaxZ=function(Z){return void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ},M.prototype.setShadowProjectionMatrix=function(Z,M,j){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(M,j,Z):this._setDefaultShadowProjectionMatrix(Z,M,j),this},M.prototype._syncParentEnabledState=function(){Z.prototype._syncParentEnabledState.call(this),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)},(0,K.l)([(0,b.x)()],M.prototype,"position",null),(0,K.l)([(0,b.x)()],M.prototype,"direction",null),(0,K.l)([(0,b.z)()],M.prototype,"shadowMinZ",null),(0,K.l)([(0,b.z)()],M.prototype,"shadowMaxZ",null),M}(O.e)},67269:function(Z,M,j){"use strict";j.d(M,{d:function(){return a}});var K,b=j(9217),g=j(9271),O=j(37105),Q=j(90690),Y=j(78588),I=j(9127),E=j(97964),s=j(82790),i=j(33224);!function(Z){Z[Z.Clean=0]="Clean",Z[Z.Stop=1]="Stop",Z[Z.Sync=2]="Sync",Z[Z.NoSync=3]="NoSync"}(K||(K={}));var a=function(){function Z(){}return Object.defineProperty(Z,"ForceFullSceneLoadingForIncremental",{get:function(){return E.e.ForceFullSceneLoadingForIncremental},set:function(Z){E.e.ForceFullSceneLoadingForIncremental=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"ShowLoadingScreen",{get:function(){return E.e.ShowLoadingScreen},set:function(Z){E.e.ShowLoadingScreen=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"loggingLevel",{get:function(){return E.e.loggingLevel},set:function(Z){E.e.loggingLevel=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"CleanBoneMatrixWeights",{get:function(){return E.e.CleanBoneMatrixWeights},set:function(Z){E.e.CleanBoneMatrixWeights=Z},enumerable:!1,configurable:!0}),Z.GetDefaultPlugin=function(){return Z._RegisteredPlugins[".babylon"]},Z._GetPluginForExtension=function(M){var j=Z._RegisteredPlugins[M];return j||(I.c.Warn("Unable to find a plugin to load "+M+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/how_to/load_from_any_file_type"),Z.GetDefaultPlugin())},Z._GetPluginForDirectLoad=function(M){for(var j in Z._RegisteredPlugins){var K=Z._RegisteredPlugins[j].plugin;if(K.canDirectLoad&&K.canDirectLoad(M))return Z._RegisteredPlugins[j]}return Z.GetDefaultPlugin()},Z._GetPluginForFilename=function(M){var j=M.indexOf("?");-1!==j&&(M=M.substring(0,j));var K=M.lastIndexOf("."),b=M.substring(K,M.length).toLowerCase();return Z._GetPluginForExtension(b)},Z._GetDirectLoad=function(Z){return"data:"===Z.substr(0,5)?Z.substr(5):null},Z._FormatErrorMessage=function(Z,M,j){var K="Unable to load from "+Z.url;return M?K+=": ".concat(M):j&&(K+=": ".concat(j)),K},Z._LoadData=function(M,j,K,b,g,O,Y){var I,E=Z._GetDirectLoad(M.url),i=Y?Z._GetPluginForExtension(Y):E?Z._GetPluginForDirectLoad(M.url):Z._GetPluginForFilename(M.url);if(!(I=void 0!==i.plugin.createPlugin?i.plugin.createPlugin():i.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(Z.OnPluginActivatedObservable.notifyObservers(I),E&&(I.canDirectLoad&&I.canDirectLoad(M.url)||!(0,s.e)(M.url))){if(I.directLoad){var a=I.directLoad(j,E);a.then?a.then((function(Z){K(I,Z)})).catch((function(Z){g("Error in directLoad of _loadData: "+Z,Z)})):K(I,a)}else K(I,E);return I}var z=i.isBinary,V=function(Z,M){j.isDisposed?g("Scene has been disposed"):K(I,Z,M)},o=null,c=!1,G=I.onDisposeObservable;G&&G.add((function(){c=!0,o&&(o.abort(),o=null),O()}));var f=function(){if(!c){var Z=function(Z,M){g(null===Z||void 0===Z?void 0:Z.statusText,M)},K=M.file||M.url;o=I.loadFile?I.loadFile(j,K,V,b,z,Z):j._loadFile(K,V,b,!0,z,Z)}},X=j.getEngine(),d=X.enableOfflineSupport;if(d){for(var W=!1,A=0,q=j.disableOfflineSupportExceptionRules;A<q.length;A++){if(q[A].test(M.url)){W=!0;break}}d=!W}return d&&Q.c.OfflineProviderFactory?j.offlineProvider=Q.c.OfflineProviderFactory(M.url,f,X.disableManifestCheck):f(),I},Z._GetFileInfo=function(Z,M){var j,K,g=null;if(M)if(M.name){var O=M;j="file:".concat(O.name),K=O.name,g=O}else if("string"===typeof M&&M.startsWith("data:"))j=M,K="";else{var Q=M;if("/"===Q.substr(0,1))return b.d.Error("Wrong sceneFilename parameter"),null;j=Z+Q,K=Q}else j=Z,K=b.d.GetFilename(Z),Z=b.d.GetFolderPath(Z);return{url:j,rootUrl:Z,name:K,file:g}},Z.GetPluginForExtension=function(M){return Z._GetPluginForExtension(M).plugin},Z.IsPluginForExtensionAvailable=function(M){return!!Z._RegisteredPlugins[M]},Z.RegisterPlugin=function(M){if("string"===typeof M.extensions){var j=M.extensions;Z._RegisteredPlugins[j.toLowerCase()]={plugin:M,isBinary:!1}}else{var K=M.extensions;Object.keys(K).forEach((function(j){Z._RegisteredPlugins[j.toLowerCase()]={plugin:M,isBinary:K[j].isBinary}}))}},Z.ImportMesh=function(M,j,K,b,g,O,Q,E){if(void 0===K&&(K=""),void 0===b&&(b=Y.e.LastCreatedScene),void 0===g&&(g=null),void 0===O&&(O=null),void 0===Q&&(Q=null),void 0===E&&(E=null),!b)return I.c.Error("No scene available to import mesh to"),null;var s=Z._GetFileInfo(j,K);if(!s)return null;var a={};b._addPendingData(a);var z=function(){b._removePendingData(a)},V=function(M,j){var K=Z._FormatErrorMessage(s,M,j);Q?Q(b,K,new i.i(K,i.g.SceneLoaderError,j)):I.c.Error(K),z()},o=O?function(Z){try{O(Z)}catch(Z){V("Error in onProgress callback: "+Z,Z)}}:void 0,c=function(Z,M,j,K,O,Q,Y){if(b.importedMeshesFiles.push(s.url),g)try{g(Z,M,j,K,O,Q,Y)}catch(Z){V("Error in onSuccess callback: "+Z,Z)}b._removePendingData(a)};return Z._LoadData(s,b,(function(Z,j,K){if(Z.rewriteRootURL&&(s.rootUrl=Z.rewriteRootURL(s.rootUrl,K)),Z.importMesh){var g=Z,O=new Array,Q=new Array,Y=new Array;if(!g.importMesh(M,b,j,s.rootUrl,O,Q,Y,V))return;b.loadingPluginName=Z.name,c(O,Q,Y,[],[],[],[])}else{Z.importMeshAsync(M,b,j,s.rootUrl,o,s.name).then((function(M){b.loadingPluginName=Z.name,c(M.meshes,M.particleSystems,M.skeletons,M.animationGroups,M.transformNodes,M.geometries,M.lights)})).catch((function(Z){V(Z.message,Z)}))}}),o,V,z,E)},Z.ImportMeshAsync=function(M,j,K,b,g,O){return void 0===K&&(K=""),void 0===b&&(b=Y.e.LastCreatedScene),void 0===g&&(g=null),void 0===O&&(O=null),new Promise((function(Q,Y){Z.ImportMesh(M,j,K,b,(function(Z,M,j,K,b,g,O){Q({meshes:Z,particleSystems:M,skeletons:j,animationGroups:K,transformNodes:b,geometries:g,lights:O})}),g,(function(Z,M,j){Y(j||new Error(M))}),O)}))},Z.Load=function(M,j,K,g,Q,I,E){return void 0===j&&(j=""),void 0===K&&(K=Y.e.LastCreatedEngine),void 0===g&&(g=null),void 0===Q&&(Q=null),void 0===I&&(I=null),void 0===E&&(E=null),K?Z.Append(M,j,new O.c(K),g,Q,I,E):(b.d.Error("No engine available"),null)},Z.LoadAsync=function(M,j,K,b,g){return void 0===j&&(j=""),void 0===K&&(K=Y.e.LastCreatedEngine),void 0===b&&(b=null),void 0===g&&(g=null),new Promise((function(O,Q){Z.Load(M,j,K,(function(Z){O(Z)}),b,(function(Z,M,j){Q(j||new Error(M))}),g)}))},Z.Append=function(M,j,K,b,g,O,Q){var E=this;if(void 0===j&&(j=""),void 0===K&&(K=Y.e.LastCreatedScene),void 0===b&&(b=null),void 0===g&&(g=null),void 0===O&&(O=null),void 0===Q&&(Q=null),!K)return I.c.Error("No scene available to append to"),null;var s=Z._GetFileInfo(M,j);if(!s)return null;Z.ShowLoadingScreen&&!this._ShowingLoadingScreen&&(this._ShowingLoadingScreen=!0,K.getEngine().displayLoadingUI(),K.executeWhenReady((function(){K.getEngine().hideLoadingUI(),E._ShowingLoadingScreen=!1})));var a={};K._addPendingData(a);var z=function(){K._removePendingData(a)},V=function(M,j){var b=Z._FormatErrorMessage(s,M,j);O?O(K,b,new i.i(b,i.g.SceneLoaderError,j)):I.c.Error(b),z()},o=g?function(Z){try{g(Z)}catch(Z){V("Error in onProgress callback",Z)}}:void 0,c=function(){if(b)try{b(K)}catch(Z){V("Error in onSuccess callback",Z)}K._removePendingData(a)};return Z._LoadData(s,K,(function(Z,M){if(Z.load){if(!Z.load(K,M,s.rootUrl,V))return;K.loadingPluginName=Z.name,c()}else{Z.loadAsync(K,M,s.rootUrl,o,s.name).then((function(){K.loadingPluginName=Z.name,c()})).catch((function(Z){V(Z.message,Z)}))}}),o,V,z,Q)},Z.AppendAsync=function(M,j,K,b,g){return void 0===j&&(j=""),void 0===K&&(K=Y.e.LastCreatedScene),void 0===b&&(b=null),void 0===g&&(g=null),new Promise((function(O,Q){Z.Append(M,j,K,(function(Z){O(Z)}),b,(function(Z,M,j){Q(j||new Error(M))}),g)}))},Z.LoadAssetContainer=function(M,j,K,b,g,O,Q){if(void 0===j&&(j=""),void 0===K&&(K=Y.e.LastCreatedScene),void 0===b&&(b=null),void 0===g&&(g=null),void 0===O&&(O=null),void 0===Q&&(Q=null),!K)return I.c.Error("No scene available to load asset container to"),null;var E=Z._GetFileInfo(M,j);if(!E)return null;var s={};K._addPendingData(s);var a=function(){K._removePendingData(s)},z=function(M,j){var b=Z._FormatErrorMessage(E,M,j);O?O(K,b,new i.i(b,i.g.SceneLoaderError,j)):I.c.Error(b),a()},V=g?function(Z){try{g(Z)}catch(Z){z("Error in onProgress callback",Z)}}:void 0,o=function(Z){if(b)try{b(Z)}catch(Z){z("Error in onSuccess callback",Z)}K._removePendingData(s)};return Z._LoadData(E,K,(function(Z,M){if(Z.loadAssetContainer){var j=Z.loadAssetContainer(K,M,E.rootUrl,z);if(!j)return;K.loadingPluginName=Z.name,o(j)}else if(Z.loadAssetContainerAsync){Z.loadAssetContainerAsync(K,M,E.rootUrl,V,E.name).then((function(M){K.loadingPluginName=Z.name,o(M)})).catch((function(Z){z(Z.message,Z)}))}else z("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),V,z,a,Q)},Z.LoadAssetContainerAsync=function(M,j,K,b,g){return void 0===j&&(j=""),void 0===K&&(K=Y.e.LastCreatedScene),void 0===b&&(b=null),void 0===g&&(g=null),new Promise((function(O,Q){Z.LoadAssetContainer(M,j,K,(function(Z){O(Z)}),b,(function(Z,M,j){Q(j||new Error(M))}),g)}))},Z.ImportAnimations=function(Z,M,j,b,g,O,Q,E,s,i){if(void 0===M&&(M=""),void 0===j&&(j=Y.e.LastCreatedScene),void 0===b&&(b=!0),void 0===g&&(g=K.Clean),void 0===O&&(O=null),void 0===Q&&(Q=null),void 0===E&&(E=null),void 0===s&&(s=null),void 0===i&&(i=null),j){if(b){for(var a=0,z=j.animatables;a<z.length;a++){z[a].reset()}j.stopAllAnimations(),j.animationGroups.slice().forEach((function(Z){Z.dispose()})),j.getNodes().forEach((function(Z){Z.animations&&(Z.animations=[])}))}else switch(g){case K.Clean:j.animationGroups.slice().forEach((function(Z){Z.dispose()}));break;case K.Stop:j.animationGroups.forEach((function(Z){Z.stop()}));break;case K.Sync:j.animationGroups.forEach((function(Z){Z.reset(),Z.restart()}));break;case K.NoSync:break;default:return void I.c.Error("Unknown animation group loading mode value '"+g+"'")}var V=j.animatables.length;this.LoadAssetContainer(Z,M,j,(function(Z){Z.mergeAnimationsTo(j,j.animatables.slice(V),O),Z.dispose(),j.onAnimationFileImportedObservable.notifyObservers(j),Q&&Q(j)}),E,s,i)}else I.c.Error("No scene available to load animations to")},Z.ImportAnimationsAsync=function(M,j,b,g,O,Q,I,E,s,i){return void 0===j&&(j=""),void 0===b&&(b=Y.e.LastCreatedScene),void 0===g&&(g=!0),void 0===O&&(O=K.Clean),void 0===Q&&(Q=null),void 0===I&&(I=null),void 0===E&&(E=null),void 0===s&&(s=null),void 0===i&&(i=null),new Promise((function(K,Y){Z.ImportAnimations(M,j,b,g,O,Q,(function(Z){K(Z)}),E,(function(Z,M,j){Y(j||new Error(M))}),i)}))},Z.NO_LOGGING=0,Z.MINIMAL_LOGGING=1,Z.SUMMARY_LOGGING=2,Z.DETAILED_LOGGING=3,Z.OnPluginActivatedObservable=new g.b,Z._RegisteredPlugins={},Z._ShowingLoadingScreen=!1,Z}()},97964:function(Z,M,j){"use strict";j.d(M,{e:function(){return K}});var K=function(){function Z(){}return Object.defineProperty(Z,"ForceFullSceneLoadingForIncremental",{get:function(){return Z._ForceFullSceneLoadingForIncremental},set:function(M){Z._ForceFullSceneLoadingForIncremental=M},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"ShowLoadingScreen",{get:function(){return Z._ShowLoadingScreen},set:function(M){Z._ShowLoadingScreen=M},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"loggingLevel",{get:function(){return Z._LoggingLevel},set:function(M){Z._LoggingLevel=M},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"CleanBoneMatrixWeights",{get:function(){return Z._CleanBoneMatrixWeights},set:function(M){Z._CleanBoneMatrixWeights=M},enumerable:!1,configurable:!0}),Z._ForceFullSceneLoadingForIncremental=!1,Z._ShowLoadingScreen=!0,Z._CleanBoneMatrixWeights=!1,Z._LoggingLevel=0,Z}()},82325:function(Z,M,j){"use strict";j.d(M,{b:function(){return UZ}});var K=j(40061),b=j(9892),g=j(9127),O=j(17190),Q=j(5344),Y=j(37105),I=j(80105),E=j(43251),s=j(4241),i=j(96558),a=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.BRDF_V_HEIGHT_CORRELATED=!1,M.MS_BRDF_ENERGY_CONSERVATION=!1,M.SPHERICAL_HARMONICS=!1,M.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,M}return(0,K.m)(M,Z),M}(s.c),z=function(Z){function M(j,K){void 0===K&&(K=!0);var b=Z.call(this,j,"PBRBRDF",90,new a,K)||this;return b._useEnergyConservation=M.DEFAULT_USE_ENERGY_CONSERVATION,b.useEnergyConservation=M.DEFAULT_USE_ENERGY_CONSERVATION,b._useSmithVisibilityHeightCorrelated=M.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,b.useSmithVisibilityHeightCorrelated=M.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,b._useSphericalHarmonics=M.DEFAULT_USE_SPHERICAL_HARMONICS,b.useSphericalHarmonics=M.DEFAULT_USE_SPHERICAL_HARMONICS,b._useSpecularGlossinessInputEnergyConservation=M.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,b.useSpecularGlossinessInputEnergyConservation=M.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,b._internalMarkAllSubMeshesAsMiscDirty=j._dirtyCallbacks[16],b._enable(!0),b}return(0,K.m)(M,Z),M.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},M.prototype.prepareDefines=function(Z){Z.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,Z.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,Z.SPHERICAL_HARMONICS=this._useSphericalHarmonics,Z.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation},M.prototype.getClassName=function(){return"PBRBRDFConfiguration"},M.DEFAULT_USE_ENERGY_CONSERVATION=!0,M.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,M.DEFAULT_USE_SPHERICAL_HARMONICS=!0,M.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsMiscDirty")],M.prototype,"useEnergyConservation",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsMiscDirty")],M.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsMiscDirty")],M.prototype,"useSphericalHarmonics",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsMiscDirty")],M.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),M}(i.c),V=j(90888),o=j(9488),c=j(96658),G=j(23016),f=j(46907),X=j(38956),d=j(29553),W=j(33048),A=j(70937),q=j(37001),T=(j(28689),j(16179)),B=(j(74422),j(44184),"uniform vec4 vEyePosition;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec4 vMetallicReflectanceFactors;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\nuniform vec3 vAmbientColor;\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REALTIME_FILTERING\nuniform vec2 vReflectionFilteringInfo;\n#endif\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#if defined(SS_REFRACTION) && defined(SS_USE_LOCAL_REFRACTIONMAP_CUBIC)\nuniform vec3 vRefractionPosition;\nuniform vec3 vRefractionSize; \n#endif\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n#ifdef IRIDESCENCE\nuniform vec4 vIridescenceParams;\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_ROUGHNESS\nuniform float vSheenRoughness;\n#endif\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#ifdef REALTIME_FILTERING\nuniform vec2 vRefractionFilteringInfo;\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;\nuniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;\nuniform mat4 translucencyIntensityMatrix;\n#endif\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n#endif\n#ifdef PREPASS\n#ifdef SS_SCATTERING\nuniform float scatteringDiffusionProfile;\n#endif\n#endif\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n#endif\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n");T.d.IncludesShadersStore.pbrFragmentDeclaration=B;j(88987),j(61496);var N="layout(std140,column_major) uniform;\nuniform Material {\nvec2 vAlbedoInfos;\nvec4 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec3 vReflectivityInfos;\nvec2 vMicroSurfaceSamplerInfos;\nvec2 vReflectionInfos;\nvec2 vReflectionFilteringInfo;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec3 vBumpInfos;\nmat4 albedoMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 reflectivityMatrix;\nmat4 microSurfaceSamplerMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nmat4 reflectionMatrix;\nvec3 vReflectionColor;\nvec4 vAlbedoColor;\nvec4 vLightingIntensity;\nvec3 vReflectionMicrosurfaceInfos;\nfloat pointSize;\nvec4 vReflectivityColor;\nvec3 vEmissiveColor;\nvec3 vAmbientColor;\nvec2 vDebugMode;\nvec4 vMetallicReflectanceFactors;\nvec2 vMetallicReflectanceInfos;\nmat4 metallicReflectanceMatrix;\nvec2 vReflectanceInfos;\nmat4 reflectanceMatrix;\nvec3 vSphericalL00;\nvec3 vSphericalL1_1;\nvec3 vSphericalL10;\nvec3 vSphericalL11;\nvec3 vSphericalL2_2;\nvec3 vSphericalL2_1;\nvec3 vSphericalL20;\nvec3 vSphericalL21;\nvec3 vSphericalL22;\nvec3 vSphericalX;\nvec3 vSphericalY;\nvec3 vSphericalZ;\nvec3 vSphericalXX_ZZ;\nvec3 vSphericalYY_ZZ;\nvec3 vSphericalZZ;\nvec3 vSphericalXY;\nvec3 vSphericalYZ;\nvec3 vSphericalZX;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n";T.d.IncludesShadersStore.pbrUboDeclaration=N;j(87321);var U="varying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n";T.d.IncludesShadersStore.pbrFragmentExtraDeclaration=U;j(65084),j(45928),j(54587);var n="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n#endif\n";T.d.IncludesShadersStore.samplerFragmentAlternateDeclaration=n;var k="#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)\n#ifdef CLEARCOAT\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL)\nuniform sampler2D clearCoatRoughnessSampler;\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL)\nuniform sampler2D sheenRoughnessSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)\n#endif\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform samplerCube irradianceSampler;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D reflectionSamplerLow;\nuniform sampler2D reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform sampler2D irradianceSampler;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D refractionSamplerLow;\nuniform sampler2D refractionSamplerHigh;\n#endif\n#endif\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)\n#endif\n";T.d.IncludesShadersStore.pbrFragmentSamplersDeclaration=k;j(23598),j(76578),j(96919),j(35850),j(83874);var x="bool testLightingForSSS(float diffusionProfile)\n{\nreturn diffusionProfile<1.;\n}";T.d.IncludesShadersStore.subSurfaceScatteringFunctions=x;var R="vec3 hemisphereCosSample(vec2 u) {\nfloat phi=2.*PI*u.x;\nfloat cosTheta2=1.-u.y;\nfloat cosTheta=sqrt(cosTheta2);\nfloat sinTheta=sqrt(1.-cosTheta2);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}\nvec3 hemisphereImportanceSampleDggx(vec2 u,float a) {\nfloat phi=2.*PI*u.x;\nfloat cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));\nfloat cosTheta=sqrt(cosTheta2);\nfloat sinTheta=sqrt(1.-cosTheta2);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}\nvec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) { \nfloat phi=2.*PI*u.x;\nfloat sinTheta=pow(u.y,a/(2.*a+1.));\nfloat cosTheta=sqrt(1.-sinTheta*sinTheta);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}";T.d.IncludesShadersStore.importanceSampling=R;var e="#define RECIPROCAL_PI2 0.15915494\n#define RECIPROCAL_PI 0.31830988618\n#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{\nreturn square(roughness)+MINIMUMVARIANCE;\n}\nfloat fresnelGrazingReflectance(float reflectance0) {\nfloat reflectance90=saturate(reflectance0*25.0);\nreturn reflectance90;\n}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);\nvec3 nDfdy=dFdy(normalVector.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\nfloat geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\ngeometricAlphaGFactor*=0.75;\nreturn vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {\nfloat alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);\nfloat alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);\nreturn vec2(alphaT,alphaB);\n}\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {\nvec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;\nvec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);\nvec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);\nvec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));\nreturn anisotropicNormal;\n}\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\nvec3 cocaLambert(vec3 alpha,float distance) {\nreturn exp(-alpha*distance);\n}\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {\nreturn cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));\n}\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {\nreturn -log(color)/distance;\n}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);\nreturn clearCoatAbsorption;\n}\n#endif\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n#endif\n";T.d.IncludesShadersStore.pbrHelperFunctions=e;j(68923),j(35765);var u="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nreturn vSphericalL00\n+ vSphericalL1_1*(normal.y)\n+ vSphericalL10*(normal.z)\n+ vSphericalL11*(normal.x)\n+ vSphericalL2_2*(normal.y*normal.x)\n+ vSphericalL2_1*(normal.y*normal.z)\n+ vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+ vSphericalL21*(normal.z*normal.x)\n+ vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));\n}\n#else\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz *Nz+C1;\nvec3 t2=a2 *Ny+t1;\nvec3 t3=b3 *Nx+t2;\nreturn t3;\n}\n#endif\n#endif\n";T.d.IncludesShadersStore.harmonicsFunctions=u;var F="struct preLightingInfo\n{\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat lightDistance;\nfloat attenuation;\nvec3 L;\nvec3 H;\nfloat NdotV;\nfloat NdotLUnclamped;\nfloat NdotL;\nfloat VdotH;\nfloat roughness;\n#ifdef IRIDESCENCE\nfloat iridescenceIntensity;\n#endif\n};\npreLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\nresult.lightDistance=sqrt(result.lightDistanceSquared);\nresult.L=normalize(result.lightOffset);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.lightDistance=length(-lightData.xyz);\nresult.L=normalize(-lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.NdotL=dot(N,lightData.xyz)*0.5+0.5;\nresult.NdotL=saturateEps(result.NdotL);\nresult.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;\n}";T.d.IncludesShadersStore.pbrDirectLightingSetupFunctions=F;var C="float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/maxEps(lightDistanceSquared);\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nfloat lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=saturate(1.0-factor*factor);\nattenuation*=attenuation;\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=saturate(cd*lightAngleScale+lightAngleOffset);\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}";T.d.IncludesShadersStore.pbrDirectLightingFalloffFunctions=C;var y="#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\nreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\n}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {\nvec2 UV=vec2(NdotV,perceptualRoughness);\nvec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;\n}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\n{\nfloat c=1.0-NdotV;\nfloat c3=c*c*c;\nreturn 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));\n}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\nvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\nreturn sheenEnvironmentReflectance;\n}\n#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\n#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);\nvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\nreturn square(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst mat3 XYZ_TO_REC709=mat3(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);\nvec3 getIORTfromAirToSurfaceR0(vec3 f0) {\nvec3 sqrtF0=sqrt(f0);\nreturn (1.+sqrtF0)/(1.-sqrtF0);\n}\nvec3 getR0fromIORs(vec3 iorT,float iorI) {\nreturn square((iorT-vec3(iorI))/(iorT+vec3(iorI)));\n}\nfloat getR0fromIORs(float iorT,float iorI) {\nreturn square((iorT-iorI)/(iorT+iorI));\n}\nvec3 evalSensitivity(float opd,vec3 shift) {\nfloat phase=2.0*PI*opd*1.0e-9;\nconst vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);\nconst vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);\nconst vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);\nvec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);\nxyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));\nxyz/=1.0685e-7;\nvec3 srgb=XYZ_TO_REC709*xyz;\nreturn srgb;\n}\nvec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {\nvec3 I=vec3(1.0);\nfloat iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));\nfloat sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));\nfloat cosTheta2Sq=1.0-sinTheta2Sq;\nif (cosTheta2Sq<0.0) {\nreturn I;\n}\nfloat cosTheta2=sqrt(cosTheta2Sq);\nfloat R0=getR0fromIORs(iridescenceIOR,outsideIOR);\nfloat R12=fresnelSchlickGGX(cosTheta1,R0,1.);\nfloat R21=R12;\nfloat T121=1.0-R12;\nfloat phi12=0.0;\nif (iridescenceIOR<outsideIOR) phi12=PI;\nfloat phi21=PI-phi12;\nvec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); \nvec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);\nvec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));\nvec3 phi23=vec3(0.0);\nif (baseIOR[0]<iridescenceIOR) phi23[0]=PI;\nif (baseIOR[1]<iridescenceIOR) phi23[1]=PI;\nif (baseIOR[2]<iridescenceIOR) phi23[2]=PI;\nfloat opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;\nvec3 phi=vec3(phi21)+phi23;\nvec3 R123=clamp(R12*R23,1e-5,0.9999);\nvec3 r123=sqrt(R123);\nvec3 Rs=square(T121)*R23/(vec3(1.0)-R123);\nvec3 C0=R12+Rs;\nI=C0;\nvec3 Cm=Rs-T121;\nfor (int m=1; m<=2; ++m)\n{\nCm*=r123;\nvec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);\nI+=Cm*Sm;\n}\nreturn max(I,vec3(0.0));\n}\n#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\n#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{\nfloat invR=1./alphaG;\nfloat cos2h=NdotH*NdotH;\nfloat sin2h=1.-cos2h;\nreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\n}\n#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\nfloat a2=alphaTB.x*alphaTB.y;\nvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);\nfloat v2=dot(v,v);\nfloat w2=a2/v2;\nreturn a2*w2*w2*RECIPROCAL_PI;\n}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\nfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\nreturn 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;\nfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\nfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\nreturn 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;\nreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{\nfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\nreturn visibility;\n}\n#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\nfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\nfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\nfloat v=0.5/(lambdaV+lambdaL);\nreturn v;\n}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\nreturn 0.25/(VdotH*VdotH); \n}\n#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{\nreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\n}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\n{\nfloat oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);\nfloat a=mix(21.5473,25.3245,oneMinusAlphaSq);\nfloat b=mix(3.82987,3.32435,oneMinusAlphaSq);\nfloat c=mix(0.19823,0.16801,oneMinusAlphaSq);\nfloat d=mix(-1.97760,-1.27393,oneMinusAlphaSq);\nfloat e=mix(-4.32054,-4.85967,oneMinusAlphaSq);\nreturn a/(1.0+b*pow(x,c))+d*x+e;\n}\nfloat lambdaSheen(float cosTheta,float alphaG)\n{\nreturn abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));\n}\nfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\n{\nfloat G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));\nreturn G/(4.0*NdotV*NdotL);\n}\n#endif\n*/\n#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\nfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\nfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel/PI;\n}\n#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\nvec3 S=1./maxEps(diffusionDistance);\nvec3 temp=exp((-0.333333333*thickness)*S);\nreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\n}\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\nfloat t=1.0+w;\nfloat invt2=1.0/square(t);\nreturn saturate((NdotL+w)*invt2);\n}\n#endif\n";T.d.IncludesShadersStore.pbrBRDFFunctions=y;var S="#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\n#if defined(WEBGL2) || defined(WEBGPU)\nfloat radicalInverse_VdC(uint bits) \n{\nbits=(bits<<16u) | (bits>>16u);\nbits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);\nbits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);\nbits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);\nbits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);\nreturn float(bits)*2.3283064365386963e-10; \n}\nvec2 hammersley(uint i,uint N)\n{\nreturn vec2(float(i)/float(N),radicalInverse_VdC(i));\n}\n#else\nfloat vanDerCorpus(int n,int base)\n{\nfloat invBase=1.0/float(base);\nfloat denom =1.0;\nfloat result =0.0;\nfor(int i=0; i<32; ++i)\n{\nif(n>0)\n{\ndenom =mod(float(n),2.0);\nresult+=denom*invBase;\ninvBase=invBase/2.0;\nn =int(float(n)/2.0);\n}\n}\nreturn result;\n}\nvec2 hammersley(int i,int N)\n{\nreturn vec2(float(i)/float(N),vanDerCorpus(i,2));\n}\n#endif\nfloat log4(float x) {\nreturn log2(x)/2.;\n}\nconst float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);\nconst float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;\nconst float K=4.;\n#define inline\nvec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{\nvec3 n=normalize(inputN);\nvec3 result=vec3(0.0);\nvec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);\ntangent=normalize(cross(tangent,n));\nvec3 bitangent=cross(n,tangent);\nmat3 tbn=mat3(tangent,bitangent,n);\nfloat maxLevel=filteringInfo.y;\nfloat dim0=filteringInfo.x;\nfloat omegaP=(4.*PI)/(6.*dim0*dim0);\n#if defined(WEBGL2) || defined(WEBGPU)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{\nvec2 Xi=hammersley(i,NUM_SAMPLES);\nvec3 Ls=hemisphereCosSample(Xi);\nLs=normalize(Ls);\nvec3 Ns=vec3(0.,0.,1.);\nfloat NoL=dot(Ns,Ls);\nif (NoL>0.) {\nfloat pdf_inversed=PI/NoL;\nfloat omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;\nfloat l=log4(omegaS)-log4(omegaP)+log4(K);\nfloat mipLevel=clamp(l,0.0,maxLevel);\nvec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c;\n}\n}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;\nreturn result;\n}\n#define inline\nvec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{\nvec3 n=normalize(inputN);\nif (alphaG==0.) {\nvec3 c=textureCube(inputTexture,n).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;\n} else {\nvec3 result=vec3(0.);\nvec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);\ntangent=normalize(cross(tangent,n));\nvec3 bitangent=cross(n,tangent);\nmat3 tbn=mat3(tangent,bitangent,n);\nfloat maxLevel=filteringInfo.y;\nfloat dim0=filteringInfo.x;\nfloat omegaP=(4.*PI)/(6.*dim0*dim0);\nfloat weight=0.;\n#if defined(WEBGL2) || defined(WEBGPU)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{\nvec2 Xi=hammersley(i,NUM_SAMPLES);\nvec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);\nfloat NoV=1.;\nfloat NoH=H.z;\nfloat NoH2=H.z*H.z;\nfloat NoL=2.*NoH2-1.;\nvec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);\nL=normalize(L);\nif (NoL>0.) {\nfloat pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);\nfloat omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;\nfloat l=log4(omegaS)-log4(omegaP)+log4(K);\nfloat mipLevel=clamp(float(l),0.0,maxLevel);\nweight+=NoL;\nvec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;\n}\n}\nresult=result/weight;\nreturn result;\n}\n}\n#endif\n#endif\n";T.d.IncludesShadersStore.hdrFilteringFunctions=S;var h="#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nfloat lightRoughness=lightRadius/lightDistance;\nfloat totalRoughness=saturate(lightRoughness+roughness);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {\nreturn mix(groundColor,lightColor,info.NdotL);\n}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {\nfloat diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*info.attenuation*info.NdotL*lightColor;\n}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {\nfloat NdotL=absEps(info.NdotLUnclamped);\nfloat wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);\nfloat trAdapt=step(0.,info.NdotLUnclamped);\nvec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);\nfloat diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;\n}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat TdotH=dot(T,info.H);\nfloat BdotH=dot(B,info.H);\nfloat TdotV=dot(T,V);\nfloat BdotV=dot(B,V);\nfloat TdotL=dot(T,info.L);\nfloat BdotL=dot(B,info.L);\nfloat alphaG=convertRoughnessToAverageSlope(info.roughness);\nvec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);\nalphaTB=max(alphaTB,square(geometricRoughnessFactor));\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);\nfloat smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {\nfloat NccdotL=saturateEps(dot(Ncc,info.L));\nfloat NccdotH=saturateEps(dot(Ncc,info.H));\nfloat clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\nfloat fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnel*=clearCoatIntensity;\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);\nfloat kelemenVisibility=visibility_Kelemen(info.VdotH);\nfloat clearCoatTerm=fresnel*distribution*kelemenVisibility;\nreturn vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);\n}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);\nfloat NdotLRefract=saturateEps(dot(Ncc,LRefract));\nvec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\nreturn absorption;\n}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat fresnel=1.;\nfloat distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);\n/*#ifdef SHEEN_SOFTER\nfloat visibility=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\n#else */\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);\n/* #endif */\nfloat sheenTerm=fresnel*distribution*visibility;\nreturn sheenTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n";T.d.IncludesShadersStore.pbrDirectLightingFunctions=h;var w="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {\nfloat microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {\nfloat lod=log2(cubeMapDimensionPixels)*roughness;\nreturn lod;\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn saturate(square(temp)-1.0+ambientOcclusion);\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {\nvec3 reflection=reflect(view,normal);\nfloat temp=saturate(1.0+1.1*dot(reflection,geometricNormal));\nreturn square(temp);\n}\n#endif\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nreturn getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);\n}\n#endif\n";T.d.IncludesShadersStore.pbrIBLFunctions=w;j(72994),j(49904),j(31814);var p="struct albedoOpacityOutParams\n{\nvec3 surfaceAlbedo;\nfloat alpha;\n};\n#define pbr_inline\nvoid albedoOpacityBlock(\nin vec4 vAlbedoColor,\n#ifdef ALBEDO\nin vec4 albedoTexture,\nin vec2 albedoInfos,\n#endif\n#ifdef OPACITY\nin vec4 opacityMap,\nin vec2 vOpacityInfos,\n#endif\n#ifdef DETAIL\nin vec4 detailColor,\nin vec4 vDetailInfos,\n#endif\nout albedoOpacityOutParams outParams\n)\n{\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#ifdef DETAIL\nfloat detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);\nsurfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; \n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;\noutParams.alpha=alpha;\n}\n";T.d.IncludesShadersStore.pbrBlockAlbedoOpacity=p;var m="struct reflectivityOutParams\n{\nfloat microSurface;\nfloat roughness;\nvec3 surfaceReflectivityColor;\n#ifdef METALLICWORKFLOW\nvec3 surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nvec3 ambientOcclusionColor;\n#endif\n#if DEBUGMODE>0\nvec4 surfaceMetallicColorMap;\nvec4 surfaceReflectivityColorMap;\nvec2 metallicRoughness;\nvec3 metallicF0;\n#endif\n};\n#define pbr_inline\nvoid reflectivityBlock(\nin vec4 vReflectivityColor,\n#ifdef METALLICWORKFLOW\nin vec3 surfaceAlbedo,\nin vec4 metallicReflectanceFactors,\n#endif\n#ifdef REFLECTIVITY\nin vec3 reflectivityInfos,\nin vec4 surfaceMetallicOrReflectivityColorMap,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nin vec3 ambientOcclusionColorIn,\n#endif\n#ifdef MICROSURFACEMAP\nin vec4 microSurfaceTexel,\n#endif\n#ifdef DETAIL\nin vec4 detailColor,\nin vec4 vDetailInfos,\n#endif\nout reflectivityOutParams outParams\n)\n{\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);\noutParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nfloat detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);\nfloat loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);\nfloat hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);\nmetallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\nmicroSurface=1.0-metallicRoughness.g;\nvec3 baseColor=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);\nsurfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvec3 metallicF0=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);\nsurfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;\nmicroSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\nmicroSurface=saturate(microSurface);\nfloat roughness=1.-microSurface;\noutParams.microSurface=microSurface;\noutParams.roughness=roughness;\noutParams.surfaceReflectivityColor=surfaceReflectivityColor;\n}\n";T.d.IncludesShadersStore.pbrBlockReflectivity=m;var J="struct ambientOcclusionOutParams\n{\nvec3 ambientOcclusionColor;\n#if DEBUGMODE>0\nvec3 ambientOcclusionColorMap;\n#endif\n};\n#define pbr_inline\nvoid ambientOcclusionBlock(\n#ifdef AMBIENT\nin vec3 ambientOcclusionColorMap_,\nin vec4 vAmbientInfos,\n#endif\nout ambientOcclusionOutParams outParams\n)\n{\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;\n}\n";T.d.IncludesShadersStore.pbrBlockAmbientOcclusion=J;var P="#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{\nfloat alpha;\n};\n#define pbr_inline\nvoid alphaFresnelBlock(\nin vec3 normalW,\nin vec3 viewDirectionW,\nin float alpha,\nin float microSurface,\nout alphaFresnelOutParams outParams\n)\n{\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\noutParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\noutParams.alpha=1.0;\n#endif\n#endif\n}\n#endif\n#endif\n";T.d.IncludesShadersStore.pbrBlockAlphaFresnel=P;var H="#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{\nfloat anisotropy;\nvec3 anisotropicTangent;\nvec3 anisotropicBitangent;\nvec3 anisotropicNormal;\n#if DEBUGMODE>0\nvec3 anisotropyMapData;\n#endif\n};\n#define pbr_inline\nvoid anisotropicBlock(\nin vec3 vAnisotropy,\n#ifdef ANISOTROPIC_TEXTURE\nin vec3 anisotropyMapData,\n#endif\nin mat3 TBN,\nin vec3 normalW,\nin vec3 viewDirectionW,\nout anisotropicOutParams outParams\n)\n{\nfloat anisotropy=vAnisotropy.b;\nvec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nanisotropy*=anisotropyMapData.b;\nanisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));\nvec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);\nvec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));\noutParams.anisotropy=anisotropy;\noutParams.anisotropicTangent=anisotropicTangent;\noutParams.anisotropicBitangent=anisotropicBitangent;\noutParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);\n}\n#endif\n";T.d.IncludesShadersStore.pbrBlockAnisotropic=H;var D="#ifdef REFLECTION\nstruct reflectionOutParams\n{\nvec4 environmentRadiance;\nvec3 environmentIrradiance;\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords;\n#else\nvec2 reflectionCoords;\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nvec3 irradianceVector;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nvoid createReflectionCoords(\nin vec3 vPositionW,\nin vec3 normalW,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REFLECTIONMAP_3D\nout vec3 reflectionCoords\n#else\nout vec2 reflectionCoords\n#endif\n)\n{\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n}\n#define pbr_inline\n#define inline\nvoid sampleReflectionTexture(\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nconst vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nconst vec2 reflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout vec4 environmentRadiance\n)\n{\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);\nif (lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nenvironmentRadiance=mix(\nenvironmentMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\n}\n#define pbr_inline\n#define inline\nvoid reflectionBlock(\nin vec3 vPositionW,\nin vec3 normalW,\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\n#else\nin sampler2D reflectionSampler,\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nin vec3 vEnvironmentIrradiance,\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nin mat4 reflectionMatrix,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\nin samplerCube irradianceSampler,\n#else\nin sampler2D irradianceSampler,\n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout reflectionOutParams outParams\n)\n{\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=vec3(0.);\n#else\nvec2 reflectionCoords=vec2(0.);\n#endif\ncreateReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\nreflectionCoords\n);\nsampleReflectionTexture(\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionSampler,\nreflectionCoords,\n#else\nreflectionSampler,\nreflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentRadiance\n);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);\nenvironmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance.rgb=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;\noutParams.environmentRadiance=environmentRadiance;\noutParams.environmentIrradiance=environmentIrradiance;\noutParams.reflectionCoords=reflectionCoords;\n}\n#endif\n";T.d.IncludesShadersStore.pbrBlockReflection=D;var l="#ifdef SHEEN\nstruct sheenOutParams\n{\nfloat sheenIntensity;\nvec3 sheenColor;\nfloat sheenRoughness;\n#ifdef SHEEN_LINKWITHALBEDO\nvec3 surfaceAlbedo;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfloat sheenAlbedoScaling;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 finalSheenRadianceScaled;\n#endif\n#if DEBUGMODE>0\nvec4 sheenMapData;\nvec3 sheenEnvironmentReflectance;\n#endif\n};\n#define pbr_inline\n#define inline\nvoid sheenBlock(\nin vec4 vSheenColor,\n#ifdef SHEEN_ROUGHNESS\nin float vSheenRoughness,\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nin vec4 sheenMapRoughnessData,\n#endif\n#endif\nin float roughness,\n#ifdef SHEEN_TEXTURE\nin vec4 sheenMapData,\nin float sheenMapLevel,\n#endif\nin float reflectance,\n#ifdef SHEEN_LINKWITHALBEDO\nin vec3 baseColor,\nin vec3 surfaceAlbedo,\n#endif\n#ifdef ENVIRONMENTBRDF\nin float NdotV,\nin vec3 environmentBrdf,\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nin vec2 AARoughnessFactors,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\nin vec4 vLightingIntensity,\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nin vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nin vec2 reflectionCoords,\n#endif\nin float NdotVUnclamped,\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nin float seo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nin float eho,\n#endif\n#endif\nout sheenOutParams outParams\n)\n{\nfloat sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);\nvec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);\nfloat sheenRoughness=sheenIntensity;\noutParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\n#ifdef SHEEN_GAMMATEXTURE\nsheenColor.rgb*=toLinearSpace(sheenMapData.rgb);\n#else\nsheenColor.rgb*=sheenMapData.rgb;\n#endif\nsheenColor.rgb*=sheenMapLevel;\n#endif\n#ifdef SHEEN_ROUGHNESS\nfloat sheenRoughness=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\n#ifdef SHEEN_TEXTURE_ROUGHNESS_IDENTICAL\nsheenRoughness*=sheenMapData.a;\n#else\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#endif\n#else\nfloat sheenRoughness=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\nsheenColor*=sheenIntensity;\n#endif\n#ifdef ENVIRONMENTBRDF\n/*#ifdef SHEEN_SOFTER\nvec3 environmentSheenBrdf=vec3(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));\n#else*/\n#ifdef SHEEN_ROUGHNESS\nvec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvec3 environmentSheenBrdf=environmentBrdf;\n#endif\n/*#endif*/\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);\nsampleReflectionTexture(\nsheenAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nsheenRoughness,\n#endif\nreflectionSampler,\nreflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentSheenRadiance\n);\nvec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\noutParams.sheenIntensity=sheenIntensity;\noutParams.sheenColor=sheenColor;\noutParams.sheenRoughness=sheenRoughness;\n}\n#endif\n";T.d.IncludesShadersStore.pbrBlockSheen=l;var t="struct clearcoatOutParams\n{\nvec3 specularEnvironmentR0;\nfloat conservationFactor;\nvec3 clearCoatNormalW;\nvec2 clearCoatAARoughnessFactors;\nfloat clearCoatIntensity;\nfloat clearCoatRoughness;\n#ifdef REFLECTION\nvec3 finalClearCoatRadianceScaled;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 absorption;\nfloat clearCoatNdotVRefract;\nvec3 clearCoatColor;\nfloat clearCoatThickness;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nvec3 energyConservationFactorClearCoat;\n#endif\n#if DEBUGMODE>0\nmat3 TBNClearCoat;\nvec2 clearCoatMapData;\nvec4 clearCoatTintMapData;\nvec4 environmentClearCoatRadiance;\nfloat clearCoatNdotV;\nvec3 clearCoatEnvironmentReflectance;\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\n#define inline\nvoid clearcoatBlock(\nin vec3 vPositionW,\nin vec3 geometricNormalW,\nin vec3 viewDirectionW,\nin vec2 vClearCoatParams,\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nin vec4 clearCoatMapRoughnessData,\n#endif\nin vec3 specularEnvironmentR0,\n#ifdef CLEARCOAT_TEXTURE\nin vec2 clearCoatMapData,\n#endif\n#ifdef CLEARCOAT_TINT\nin vec4 vClearCoatTintParams,\nin float clearCoatColorAtDistance,\nin vec4 vClearCoatRefractionParams,\n#ifdef CLEARCOAT_TINT_TEXTURE\nin vec4 clearCoatTintMapData,\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\nin vec2 vClearCoatBumpInfos,\nin vec4 clearCoatBumpMapData,\nin vec2 vClearCoatBumpUV,\n#if defined(TANGENT) && defined(NORMAL)\nin mat3 vTBN,\n#else\nin vec2 vClearCoatTangentSpaceParams,\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nin mat4 normalMatrix,\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nin vec3 faceNormal,\n#endif\n#ifdef REFLECTION\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\nin vec4 vLightingIntensity,\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\n#else\nin sampler2D reflectionSampler,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\nin float ambientMonochrome,\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\nin float frontFacingMultiplier,\n#endif\nout clearcoatOutParams outParams\n)\n{\nfloat clearCoatIntensity=vClearCoatParams.x;\nfloat clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL\nclearCoatRoughness*=clearCoatMapData.y;\n#else\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;\noutParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;\nfloat clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\n#ifdef CLEARCOAT_TINT_GAMMATEXTURE\nclearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);\n#else\nclearCoatColor*=clearCoatTintMapData.rgb;\n#endif\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);\noutParams.clearCoatThickness=clearCoatThickness;\n#endif\n#ifdef CLEARCOAT_REMAP_F0\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvec3 specularEnvironmentR0Updated=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);\nvec3 clearCoatNormalW=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nvec2 TBNClearCoatUV=vClearCoatBumpUV*frontFacingMultiplier;\nmat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);\nclearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;\noutParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);\nfloat clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);\nfloat clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatVRefract=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);\noutParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);\nvec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nsampleReflectionTexture(\nclearCoatAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nclearCoatNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nclearCoatRoughness,\n#endif\nreflectionSampler,\nclearCoatReflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentClearCoatRadiance\n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef RADIANCEOCCLUSION\nfloat clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);\nclearCoatEnvironmentReflectance*=clearCoatSeo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);\nclearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnelIBLClearCoat*=clearCoatIntensity;\noutParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\n}\n#endif\n";T.d.IncludesShadersStore.pbrBlockClearcoat=t;var v="struct iridescenceOutParams\n{\nfloat iridescenceIntensity;\nfloat iridescenceIOR;\nfloat iridescenceThickness;\nvec3 specularEnvironmentR0;\n};\n#ifdef IRIDESCENCE\n#define pbr_inline\n#define inline\nvoid iridescenceBlock(\nin vec4 vIridescenceParams,\nin float viewAngle,\nin vec3 specularEnvironmentR0,\n#ifdef IRIDESCENCE_TEXTURE\nin vec2 iridescenceMapData,\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nin vec2 iridescenceThicknessMapData,\n#endif\n#ifdef CLEARCOAT\nin float NdotVUnclamped,\n#ifdef CLEARCOAT_TEXTURE\nin vec2 clearCoatMapData,\n#endif\n#endif\nout iridescenceOutParams outParams\n)\n{\nfloat iridescenceIntensity=vIridescenceParams.x;\nfloat iridescenceIOR=vIridescenceParams.y;\nfloat iridescenceThicknessMin=vIridescenceParams.z;\nfloat iridescenceThicknessMax=vIridescenceParams.w;\nfloat iridescenceThicknessWeight=1.;\n#ifdef IRIDESCENCE_TEXTURE\niridescenceIntensity*=iridescenceMapData.x;\n#ifdef IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE\niridescenceThicknessWeight=iridescenceMapData.g;\n#endif\n#endif\n#if defined(IRIDESCENCE_THICKNESS_TEXTURE)\niridescenceThicknessWeight=iridescenceThicknessMapData.g;\n#endif\nfloat iridescenceThickness=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);\nfloat topIor=1.; \n#ifdef CLEARCOAT\nfloat clearCoatIntensity=vClearCoatParams.x;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#endif\ntopIor=mix(1.0,vClearCoatRefractionParams.w-1.,clearCoatIntensity);\nviewAngle=sqrt(1.0+square(1.0/topIor)*(square(NdotVUnclamped)-1.0));\n#endif\nvec3 iridescenceFresnel=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);\noutParams.iridescenceIntensity=iridescenceIntensity;\noutParams.iridescenceThickness=iridescenceThickness;\noutParams.iridescenceIOR=iridescenceIOR;\n}\n#endif\n";T.d.IncludesShadersStore.pbrBlockIridescence=v;var r="struct subSurfaceOutParams\n{\nvec3 specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvec3 finalRefraction;\nvec3 surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nfloat alpha;\n#endif\n#ifdef REFLECTION\nfloat refractionFactorForIrradiance;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvec3 transmittance;\nfloat translucencyIntensity;\n#ifdef REFLECTION\nvec3 refractionIrradiance;\n#endif\n#endif\n#if DEBUGMODE>0\nvec4 thicknessMap;\nvec4 environmentRefraction;\nvec3 refractionTransmittance;\n#endif\n};\n#ifdef SUBSURFACE\n#define pbr_inline\n#define inline\nvoid subSurfaceBlock(\nin vec3 vSubSurfaceIntensity,\nin vec2 vThicknessParam,\nin vec4 vTintColor,\nin vec3 normalW,\nin vec3 specularEnvironmentReflectance,\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nin vec4 thicknessMap,\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nin vec4 refractionIntensityMap,\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nin vec4 translucencyIntensityMap,\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\nin mat4 reflectionMatrix,\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nin vec3 irradianceVector_,\n#endif\n#if defined(REALTIME_FILTERING)\nin samplerCube reflectionSampler,\nin vec2 vReflectionFilteringInfo,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\nin samplerCube irradianceSampler,\n#else\nin sampler2D irradianceSampler,\n#endif\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\nin vec3 surfaceAlbedo,\n#endif\n#ifdef SS_REFRACTION\nin vec3 vPositionW,\nin vec3 viewDirectionW,\nin mat4 view,\nin vec4 vRefractionInfos,\nin mat4 refractionMatrix,\nin vec4 vRefractionMicrosurfaceInfos,\nin vec4 vLightingIntensity,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nin float alpha,\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nin float NdotVUnclamped,\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\nin float roughness,\n#endif\nin float alphaG,\n#ifdef SS_REFRACTIONMAP_3D\nin samplerCube refractionSampler,\n#ifndef LODBASEDMICROSFURACE\nin samplerCube refractionSamplerLow,\nin samplerCube refractionSamplerHigh,\n#endif\n#else\nin sampler2D refractionSampler,\n#ifndef LODBASEDMICROSFURACE\nin sampler2D refractionSamplerLow,\nin sampler2D refractionSamplerHigh,\n#endif\n#endif\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vRefractionFilteringInfo,\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nin vec3 refractionPosition,\nin vec3 refractionSize,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nin vec3 vDiffusionDistance,\n#endif\nout subSurfaceOutParams outParams\n)\n{\noutParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);\noutParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#if defined(SS_USE_GLTF_TEXTURES)\nfloat thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#else\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#endif\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#ifdef SS_MASK_FROM_THICKNESS_TEXTURE\n#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE)\n#if defined(SS_USE_GLTF_TEXTURES)\nrefractionIntensity*=thicknessMap.r;\n#else\nrefractionIntensity*=thicknessMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE)\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=refractionIntensityMap.r;\n#else\nrefractionIntensity*=refractionIntensityMap.g;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\ntranslucencyIntensity*=translucencyIntensityMap.b;\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);\nvec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);\ntransmittance*=translucencyIntensity;\noutParams.transmittance=transmittance;\noutParams.translucencyIntensity=translucencyIntensity;\n#endif\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,vRefractionInfos.y);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n#ifdef SS_REFRACTIONMAP_3D\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\n#ifdef SS_USE_THICKNESS_AS_DEPTH\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*thickness,1.0)));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\n#endif\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef SS_HAS_THICKNESS\nfloat ior=vRefractionInfos.y;\n#else\nfloat ior=vRefractionMicrosurfaceInfos.w;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionAlphaG=alphaG;\nrefractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nfloat refractionRoughness=alphaG;\nrefractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);\n#else\nfloat refractionAlphaG=alphaG;\nrefractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif (lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n} else {\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);\nvec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);\nenvironmentRefraction.rgb*=volumeAlbedo;\n#else\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\nenvironmentRefraction.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n#endif\n#ifdef UNUSED_MULTIPLEBOUNCES\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\noutParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n#endif\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvec3 irradianceVector=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvec3 irradianceCoords=irradianceVector;\n#else\nvec2 irradianceCoords=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);\n#ifdef RGBDREFLECTION\nrefractionIrradiance.rgb=fromRGBD(refractionIrradiance);\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);\n#endif\n#else\nvec4 refractionIrradiance=vec4(0.);\n#endif\nrefractionIrradiance.rgb*=transmittance;\n#ifdef SS_ALBEDOFORTRANSLUCENCYTINT\nrefractionIrradiance.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.refractionIrradiance=refractionIrradiance.rgb;\n#endif\n}\n#endif\n";T.d.IncludesShadersStore.pbrBlockSubSurface=r;j(69991),j(84098);var L="vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\nvec3 geometricNormalW=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;\n#endif\n";T.d.IncludesShadersStore.pbrBlockNormalGeometric=L;j(78767);var ZZ="#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n";T.d.IncludesShadersStore.pbrBlockNormalFinal=ZZ;j(75060);var MZ="#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor.rgb=toLinearSpace(lightmapColor.rgb);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n";T.d.IncludesShadersStore.pbrBlockLightmapInit=MZ;var jZ="float NdotVUnclamped=dot(normalW,viewDirectionW);\nfloat NdotV=absEps(NdotVUnclamped);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=aoOut.ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n";T.d.IncludesShadersStore.pbrBlockGeometryInfo=jZ;var KZ="float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);\nvec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);\n#else \nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\n#endif\n#ifdef ALPHAFRESNEL\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nspecularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n";T.d.IncludesShadersStore.pbrBlockReflectance0=KZ;var bZ="#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n";T.d.IncludesShadersStore.pbrBlockReflectance=bZ;var gZ="vec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\npreLightingInfo preInfo;\nlightingInfo info;\nfloat shadow=1.; \n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvec3 absorption=vec3(0.);\n#endif\n";T.d.IncludesShadersStore.pbrBlockDirectLighting=gZ;j(57932);var OZ="#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n#ifdef REFLECTION\nvec3 finalIrradiance=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);\nfinalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;\nfinalIrradiance*=vLightingIntensity.z;\nfinalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef REFLECTION\nvec3 finalRadiance=reflectionOut.environmentRadiance.rgb;\nfinalRadiance*=subSurfaceOut.specularEnvironmentReflectance;\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenOut.sheenColor;\nfinalSheen=max(finalSheen,0.0);\nvec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;\nfinalClearCoat=max(finalClearCoat,0.0);\nvec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n";T.d.IncludesShadersStore.pbrBlockFinalLitComponents=OZ;var QZ="vec3 finalDiffuse=diffuseBase;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\nfinalDiffuse*=vLightingIntensity.x;\nvec3 finalAmbient=vAmbientColor;\nfinalAmbient*=surfaceAlbedo.rgb;\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\n#ifdef GAMMAEMISSIVE\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\n#else\nfinalEmissive*=emissiveColorTex.rgb;\n#endif\nfinalEmissive*= vEmissiveInfos.y;\n#endif\nfinalEmissive*=vLightingIntensity.y;\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;\nfinalDiffuse*=ambientOcclusionForDirectDiffuse;\n";T.d.IncludesShadersStore.pbrBlockFinalUnlitComponents=QZ;var YZ="vec4 finalColor=vec4(\nfinalAmbient +\nfinalDiffuse +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalEmissive,\nalpha);\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor.rgb;\n#else\nfinalColor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\nfinalColor=max(finalColor,0.0);\n";T.d.IncludesShadersStore.pbrBlockFinalColorComposition=YZ;j(84981),j(80345);var IZ="#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)\n#if !defined(SKIPFINALCOLORCLAMP)\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#endif\n#else\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\nfinalColor.rgb*=finalColor.a;\n#endif\n";T.d.IncludesShadersStore.pbrBlockImageProcessing=IZ;var EZ="#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {\n#if DEBUGMODE==1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==5\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE==7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==10 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#elif DEBUGMODE==21 && defined(AMBIENT)\ngl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE==22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE==23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;\n#elif DEBUGMODE==40 && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==41 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==54 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==61\ngl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.metallicF0;\n#elif DEBUGMODE==63\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE==64\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE==65\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE==68 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=subSurfaceOut.transmittance;\n#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.refractionTransmittance;\n#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==86 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE==87\ngl_FragColor.rgb=vec3(alpha);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#ifdef PREPASS\ngl_FragData[0]=toLinearSpace(gl_FragColor); \ngl_FragData[1]=vec4(0.,0.,0.,0.); \n#endif\nreturn;\n}\n#endif\n";T.d.IncludesShadersStore.pbrDebug=EZ;var sZ="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\nprecision highp float;\n#include<oitDeclaration>\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE\n#endif\n#include<__decl__pbrFragment>\n#include<pbrFragmentExtraDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#include<helperFunctions>\n#include<subSurfaceScatteringFunctions>\n#include<importanceSampling>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#include<pbrBlockAlbedoOpacity>\n#include<pbrBlockReflectivity>\n#include<pbrBlockAmbientOcclusion>\n#include<pbrBlockAlphaFresnel>\n#include<pbrBlockAnisotropic>\n#include<pbrBlockReflection>\n#include<pbrBlockSheen>\n#include<pbrBlockClearcoat>\n#include<pbrBlockIridescence>\n#include<pbrBlockSubSurface>\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<oitFragment>\n#include<clipPlaneFragment>\n#include<pbrBlockNormalGeometric>\n#include<bumpFragment>\n#include<pbrBlockNormalFinal>\nalbedoOpacityOutParams albedoOpacityOut;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#endif\nalbedoOpacityBlock(\nvAlbedoColor,\n#ifdef ALBEDO\nalbedoTexture,\nvAlbedoInfos,\n#endif\n#ifdef OPACITY\nopacityMap,\nvOpacityInfos,\n#endif\n#ifdef DETAIL\ndetailColor,\nvDetailInfos,\n#endif\nalbedoOpacityOut\n);\nvec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;\nfloat alpha=albedoOpacityOut.alpha;\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\nambientOcclusionOutParams aoOut;\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;\n#endif\nambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap,\nvAmbientInfos,\n#endif\naoOut\n);\n#include<pbrBlockLightmapInit>\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\nvec3 baseColor=surfaceAlbedo;\nreflectivityOutParams reflectivityOut;\n#if defined(REFLECTIVITY)\nvec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nvec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;\n#ifndef METALLICWORKFLOW\n#ifdef REFLECTIVITY_GAMMA\nsurfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);\n#endif\nsurfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;\n#endif\n#endif\n#if defined(MICROSURFACEMAP)\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\n#endif\n#ifdef METALLICWORKFLOW\nvec4 metallicReflectanceFactors=vMetallicReflectanceFactors;\n#ifdef REFLECTANCE\nvec4 reflectanceFactorsMap=texture2D(reflectanceSampler,vReflectanceUV+uvOffset);\n#ifdef REFLECTANCE_GAMMA\nreflectanceFactorsMap=toLinearSpace(reflectanceFactorsMap);\n#endif\nmetallicReflectanceFactors.rgb*=reflectanceFactorsMap.rgb;\n#endif\n#ifdef METALLIC_REFLECTANCE\nvec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);\n#ifdef METALLIC_REFLECTANCE_GAMMA\nmetallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);\n#endif\n#ifndef METALLIC_REFLECTANCE_USE_ALPHA_ONLY\nmetallicReflectanceFactors.rgb*=metallicReflectanceFactorsMap.rgb;\n#endif\nmetallicReflectanceFactors*=metallicReflectanceFactorsMap.a;\n#endif\n#endif\nreflectivityBlock(\nvReflectivityColor,\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo,\nmetallicReflectanceFactors,\n#endif\n#ifdef REFLECTIVITY\nvReflectivityInfos,\nsurfaceMetallicOrReflectivityColorMap,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor,\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurfaceTexel,\n#endif\n#ifdef DETAIL\ndetailColor,\nvDetailInfos,\n#endif\nreflectivityOut\n);\nfloat microSurface=reflectivityOut.microSurface;\nfloat roughness=reflectivityOut.roughness;\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo=reflectivityOut.surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;\n#endif\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nalphaFresnelOutParams alphaFresnelOut;\nalphaFresnelBlock(\nnormalW,\nviewDirectionW,\nalpha,\nmicroSurface,\nalphaFresnelOut\n);\nalpha=alphaFresnelOut.alpha;\n#endif\n#endif\n#include<pbrBlockGeometryInfo>\n#ifdef ANISOTROPIC\nanisotropicOutParams anisotropicOut;\n#ifdef ANISOTROPIC_TEXTURE\nvec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;\n#endif\nanisotropicBlock(\nvAnisotropy,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData,\n#endif\nTBN,\nnormalW,\nviewDirectionW,\nanisotropicOut\n);\n#endif\n#ifdef REFLECTION\nreflectionOutParams reflectionOut;\n#ifndef USE_CUSTOM_REFLECTION\nreflectionBlock(\nvPositionW,\nnormalW,\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\nreflectionSampler,\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nvEnvironmentIrradiance,\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nreflectionMatrix,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\nirradianceSampler,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nreflectionOut\n);\n#else\n#define CUSTOM_REFLECTION\n#endif\n#endif\n#include<pbrBlockReflectance0>\n#ifdef SHEEN\nsheenOutParams sheenOut;\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset);\n#endif\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;\n#endif\nsheenBlock(\nvSheenColor,\n#ifdef SHEEN_ROUGHNESS\nvSheenRoughness,\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nsheenMapRoughnessData,\n#endif\n#endif\nroughness,\n#ifdef SHEEN_TEXTURE\nsheenMapData,\nvSheenInfos.y,\n#endif\nreflectance,\n#ifdef SHEEN_LINKWITHALBEDO\nbaseColor,\nsurfaceAlbedo,\n#endif\n#ifdef ENVIRONMENTBRDF\nNdotV,\nenvironmentBrdf,\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nAARoughnessFactors,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\nvLightingIntensity,\nreflectionSampler,\nreflectionOut.reflectionCoords,\nNdotVUnclamped,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nseo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\neho,\n#endif\n#endif\nsheenOut\n);\n#ifdef SHEEN_LINKWITHALBEDO\nsurfaceAlbedo=sheenOut.surfaceAlbedo;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;\n#endif\n#endif\n#ifdef IRIDESCENCE\niridescenceOutParams iridescenceOut;\n#ifdef IRIDESCENCE_TEXTURE\nvec2 iridescenceMapData=texture2D(iridescenceSampler,vIridescenceUV+uvOffset).rg*vIridescenceInfos.y;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nvec2 iridescenceThicknessMapData=texture2D(iridescenceThicknessSampler,vIridescenceThicknessUV+uvOffset).rg*vIridescenceInfos.w;\n#endif\niridescenceBlock(\nvIridescenceParams,\nNdotV,\nspecularEnvironmentR0,\n#ifdef IRIDESCENCE_TEXTURE\niridescenceMapData,\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\niridescenceThicknessMapData,\n#endif\n#ifdef CLEARCOAT\nNdotVUnclamped,\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData,\n#endif\n#endif\niridescenceOut\n);\nfloat iridescenceIntensity=iridescenceOut.iridescenceIntensity;\nspecularEnvironmentR0=iridescenceOut.specularEnvironmentR0;\n#endif\nclearcoatOutParams clearcoatOut;\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);\n#endif\n#ifdef CLEARCOAT_BUMP\nvec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);\n#endif\nclearcoatBlock(\nvPositionW,\ngeometricNormalW,\nviewDirectionW,\nvClearCoatParams,\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatMapRoughnessData,\n#endif\nspecularEnvironmentR0,\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData,\n#endif\n#ifdef CLEARCOAT_TINT\nvClearCoatTintParams,\nclearCoatColorAtDistance,\nvClearCoatRefractionParams,\n#ifdef CLEARCOAT_TINT_TEXTURE\nclearCoatTintMapData,\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\nvClearCoatBumpInfos,\nclearCoatBumpMapData,\nvClearCoatBumpUV,\n#if defined(TANGENT) && defined(NORMAL)\nvTBN,\n#else\nvClearCoatTangentSpaceParams,\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nnormalMatrix,\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nfaceNormal,\n#endif\n#ifdef REFLECTION\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\nvLightingIntensity,\nreflectionSampler,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\nambientMonochrome,\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n(gl_FrontFacing ? 1. : -1.),\n#endif\nclearcoatOut\n);\n#else\nclearcoatOut.specularEnvironmentR0=specularEnvironmentR0;\n#endif\n#include<pbrBlockReflectance>\nsubSurfaceOutParams subSurfaceOut;\n#ifdef SUBSURFACE\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nvec4 refractionIntensityMap=texture2D(refractionIntensitySampler,vRefractionIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nvec4 translucencyIntensityMap=texture2D(translucencyIntensitySampler,vTranslucencyIntensityUV+uvOffset);\n#endif\nsubSurfaceBlock(\nvSubSurfaceIntensity,\nvThicknessParam,\nvTintColor,\nnormalW,\nspecularEnvironmentReflectance,\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nthicknessMap,\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nrefractionIntensityMap,\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\ntranslucencyIntensityMap,\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\nreflectionMatrix,\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nreflectionOut.irradianceVector,\n#endif\n#if defined(REALTIME_FILTERING)\nreflectionSampler,\nvReflectionFilteringInfo,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\nirradianceSampler,\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\nsurfaceAlbedo,\n#endif\n#ifdef SS_REFRACTION\nvPositionW,\nviewDirectionW,\nview,\nvRefractionInfos,\nrefractionMatrix,\nvRefractionMicrosurfaceInfos,\nvLightingIntensity,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha,\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nNdotVUnclamped,\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\nroughness,\n#endif\nalphaG,\nrefractionSampler,\n#ifndef LODBASEDMICROSFURACE\nrefractionSamplerLow,\nrefractionSamplerHigh,\n#endif\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\n#ifdef REALTIME_FILTERING\nvRefractionFilteringInfo,\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nvRefractionPosition,\nvRefractionSize,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvDiffusionDistance,\n#endif\nsubSurfaceOut\n);\n#ifdef SS_REFRACTION\nsurfaceAlbedo=subSurfaceOut.surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha=subSurfaceOut.alpha;\n#endif\n#endif\n#else\nsubSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#endif\n#include<pbrBlockDirectLighting>\n#include<lightFragment>[0..maxSimultaneousLights]\n#include<pbrBlockFinalLitComponents>\n#endif \n#include<pbrBlockFinalUnlitComponents>\n#define CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION\n#include<pbrBlockFinalColorComposition>\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#include<pbrBlockImageProcessing>\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=finalColor.a>0.4 ? 1.0 : 0.0;\n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nvec3 sqAlbedo=sqrt(surfaceAlbedo); \n#endif\n#ifdef PREPASS_IRRADIANCE\nvec3 irradiance=finalDiffuse;\n#ifndef UNLIT\n#ifdef REFLECTION\nirradiance+=finalIrradiance;\n#endif\n#endif\n#ifdef SS_SCATTERING\ngl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a); \nirradiance/=sqAlbedo;\n#else\ngl_FragData[0]=finalColor; \nfloat scatteringDiffusionProfile=255.;\n#endif\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(clamp(irradiance,vec3(0.),vec3(1.)),writeGeometryInfo*scatteringDiffusionProfile/255.); \n#else\ngl_FragData[0]=vec4(finalColor.rgb,finalColor.a);\n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4((view*vec4(normalW,0.0)).rgb,writeGeometryInfo); \n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(sqAlbedo,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toGammaSpace(specularEnvironmentR0),microSurface)*writeGeometryInfo;\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=finalColor;\n#endif\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {\nfrontColor.rgb+=finalColor.rgb*finalColor.a*alphaMultiplier;\nfrontColor.a=1.0-alphaMultiplier*(1.0-finalColor.a);\n} else {\nbackColor+=finalColor;\n}\n#endif\n#include<pbrDebug>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";T.d.ShadersStore.pbrPixelShader=sZ;var iZ="uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef METALLIC_REFLECTANCE\nuniform vec2 vMetallicReflectanceInfos;\nuniform mat4 metallicReflectanceMatrix;\n#endif\n#ifdef REFLECTANCE\nuniform vec2 vReflectanceInfos;\nuniform mat4 reflectanceMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#ifdef IRIDESCENCE\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;\nuniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;\nuniform mat4 translucencyIntensityMatrix;\n#endif\n#endif\n#ifdef NORMAL\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n#endif\n#endif\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\nuniform mat4 detailMatrix;\n#endif\n#define ADDITIONAL_VERTEX_DECLARATION\n";T.d.IncludesShadersStore.pbrVertexDeclaration=iZ;j(94040),j(31377),j(54001),j(16554),j(63201),j(138),j(20142),j(49329),j(23654),j(65359),j(58003),j(36062),j(83700),j(63886),j(48767),j(50511),j(97202),j(48623),j(32875),j(3970),j(58878),j(70179),j(61906),j(32560),j(70323),j(35738),j(30242);var aZ="precision highp float;\n#include<__decl__pbrVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<samplerVertexDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler)\n#include<samplerVertexDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#ifdef CLEARCOAT\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence)\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity)\n#endif\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#if DEBUGMODE>0\nvClipSpacePosition=gl_Position;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_MATRIXNAME_,albedo,_INFONAME_,AlbedoInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_MATRIXNAME_,reflectivity,_INFONAME_,ReflectivityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_MATRIXNAME_,microSurfaceSampler,_INFONAME_,MicroSurfaceSamplerInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_MATRIXNAME_,metallicReflectance,_INFONAME_,MetallicReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_MATRIXNAME_,reflectance,_INFONAME_,ReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#ifdef CLEARCOAT\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_MATRIXNAME_,clearCoat,_INFONAME_,ClearCoatInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness,_MATRIXNAME_,clearCoatRoughness,_INFONAME_,ClearCoatInfos.z)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_MATRIXNAME_,clearCoatBump,_INFONAME_,ClearCoatBumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_MATRIXNAME_,clearCoatTint,_INFONAME_,ClearCoatTintInfos.x)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_MATRIXNAME_,iridescence,_INFONAME_,IridescenceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_MATRIXNAME_,iridescenceThickness,_INFONAME_,IridescenceInfos.z)\n#endif\n#ifdef SHEEN\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.z)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexImplementation>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_MATRIXNAME_,anisotropy,_INFONAME_,AnisotropyInfos.x)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_MATRIXNAME_,thickness,_INFONAME_,ThicknessInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_MATRIXNAME_,refractionIntensity,_INFONAME_,RefractionIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_MATRIXNAME_,translucencyIntensity,_INFONAME_,TranslucencyIntensityInfos.x)\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";T.d.ShadersStore.pbrVertexShader=aZ;var zZ=j(54497),VZ=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.CLEARCOAT=!1,M.CLEARCOAT_DEFAULTIOR=!1,M.CLEARCOAT_TEXTURE=!1,M.CLEARCOAT_TEXTURE_ROUGHNESS=!1,M.CLEARCOAT_TEXTUREDIRECTUV=0,M.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,M.CLEARCOAT_BUMP=!1,M.CLEARCOAT_BUMPDIRECTUV=0,M.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,M.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1,M.CLEARCOAT_REMAP_F0=!1,M.CLEARCOAT_TINT=!1,M.CLEARCOAT_TINT_TEXTURE=!1,M.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,M.CLEARCOAT_TINT_GAMMATEXTURE=!1,M}return(0,K.m)(M,Z),M}(s.c),oZ=function(Z){function M(j,K){void 0===K&&(K=!0);var b=Z.call(this,j,"PBRClearCoat",100,new VZ,K)||this;return b._isEnabled=!1,b.isEnabled=!1,b.intensity=1,b.roughness=0,b._indexOfRefraction=M._DefaultIndexOfRefraction,b.indexOfRefraction=M._DefaultIndexOfRefraction,b._texture=null,b.texture=null,b._useRoughnessFromMainTexture=!0,b.useRoughnessFromMainTexture=!0,b._textureRoughness=null,b.textureRoughness=null,b._remapF0OnInterfaceChange=!0,b.remapF0OnInterfaceChange=!0,b._bumpTexture=null,b.bumpTexture=null,b._isTintEnabled=!1,b.isTintEnabled=!1,b.tintColor=o.e.White(),b.tintColorAtDistance=1,b.tintThickness=1,b._tintTexture=null,b.tintTexture=null,b._internalMarkAllSubMeshesAsTexturesDirty=j._dirtyCallbacks[1],b}return(0,K.m)(M,Z),M.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},M.prototype.isReadyForSubMesh=function(Z,M,j){if(!this._isEnabled)return!0;var K=this._material._disableBumpMap;if(Z._areTexturesDirty&&M.texturesEnabled){if(this._texture&&q.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&q.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(j.getCaps().standardDerivatives&&this._bumpTexture&&q.d.ClearCoatBumpTextureEnabled&&!K&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&q.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0},M.prototype.prepareDefines=function(Z,j){var K;this._isEnabled?(Z.CLEARCOAT=!0,Z.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,Z.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=null!==this._texture&&this._texture._texture===(null===(K=this._textureRoughness)||void 0===K?void 0:K._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),Z.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,Z._areTexturesDirty&&j.texturesEnabled&&(this._texture&&q.d.ClearCoatTextureEnabled?W.b.PrepareDefinesForMergedUV(this._texture,Z,"CLEARCOAT_TEXTURE"):Z.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&q.d.ClearCoatTextureEnabled?W.b.PrepareDefinesForMergedUV(this._textureRoughness,Z,"CLEARCOAT_TEXTURE_ROUGHNESS"):Z.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&q.d.ClearCoatBumpTextureEnabled?W.b.PrepareDefinesForMergedUV(this._bumpTexture,Z,"CLEARCOAT_BUMP"):Z.CLEARCOAT_BUMP=!1,Z.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===M._DefaultIndexOfRefraction,this._isTintEnabled?(Z.CLEARCOAT_TINT=!0,this._tintTexture&&q.d.ClearCoatTintTextureEnabled?(W.b.PrepareDefinesForMergedUV(this._tintTexture,Z,"CLEARCOAT_TINT_TEXTURE"),Z.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):Z.CLEARCOAT_TINT_TEXTURE=!1):(Z.CLEARCOAT_TINT=!1,Z.CLEARCOAT_TINT_TEXTURE=!1))):(Z.CLEARCOAT=!1,Z.CLEARCOAT_TEXTURE=!1,Z.CLEARCOAT_TEXTURE_ROUGHNESS=!1,Z.CLEARCOAT_BUMP=!1,Z.CLEARCOAT_TINT=!1,Z.CLEARCOAT_TINT_TEXTURE=!1,Z.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,Z.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1)},M.prototype.bindForSubMesh=function(Z,M,j,K){var b,g,O,Q,Y,I,E,s;if(this._isEnabled){var i=K.materialDefines,a=this._material.isFrozen,z=this._material._disableBumpMap,V=this._material._invertNormalMapX,o=this._material._invertNormalMapY,c=i.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL;if(!Z.useUbo||!a||!Z.isSync){c&&q.d.ClearCoatTextureEnabled?(Z.updateFloat4("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),W.b.BindTextureMatrix(this._texture,Z,"clearCoat")):(this._texture||this._textureRoughness)&&q.d.ClearCoatTextureEnabled&&(Z.updateFloat4("vClearCoatInfos",null!==(g=null===(b=this._texture)||void 0===b?void 0:b.coordinatesIndex)&&void 0!==g?g:0,null!==(Q=null===(O=this._texture)||void 0===O?void 0:O.level)&&void 0!==Q?Q:0,null!==(I=null===(Y=this._textureRoughness)||void 0===Y?void 0:Y.coordinatesIndex)&&void 0!==I?I:0,null!==(s=null===(E=this._textureRoughness)||void 0===E?void 0:E.level)&&void 0!==s?s:0),this._texture&&W.b.BindTextureMatrix(this._texture,Z,"clearCoat"),!this._textureRoughness||c||i.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE||W.b.BindTextureMatrix(this._textureRoughness,Z,"clearCoatRoughness")),this._bumpTexture&&j.getCaps().standardDerivatives&&q.d.ClearCoatTextureEnabled&&!z&&(Z.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),W.b.BindTextureMatrix(this._bumpTexture,Z,"clearCoatBump"),M._mirroredCameraPosition?Z.updateFloat2("vClearCoatTangentSpaceParams",V?1:-1,o?1:-1):Z.updateFloat2("vClearCoatTangentSpaceParams",V?-1:1,o?-1:1)),this._tintTexture&&q.d.ClearCoatTintTextureEnabled&&(Z.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),W.b.BindTextureMatrix(this._tintTexture,Z,"clearCoatTint")),Z.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var G=1-this._indexOfRefraction,f=1+this._indexOfRefraction,X=Math.pow(-G/f,2),d=1/this._indexOfRefraction;Z.updateFloat4("vClearCoatRefractionParams",X,d,G,f),this._isTintEnabled&&(Z.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),Z.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}M.texturesEnabled&&(this._texture&&q.d.ClearCoatTextureEnabled&&Z.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!c&&!i.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&q.d.ClearCoatTextureEnabled&&Z.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&j.getCaps().standardDerivatives&&q.d.ClearCoatBumpTextureEnabled&&!z&&Z.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&q.d.ClearCoatTintTextureEnabled&&Z.setTexture("clearCoatTintSampler",this._tintTexture))}},M.prototype.hasTexture=function(Z){return this._texture===Z||(this._textureRoughness===Z||(this._bumpTexture===Z||this._tintTexture===Z))},M.prototype.getActiveTextures=function(Z){this._texture&&Z.push(this._texture),this._textureRoughness&&Z.push(this._textureRoughness),this._bumpTexture&&Z.push(this._bumpTexture),this._tintTexture&&Z.push(this._tintTexture)},M.prototype.getAnimatables=function(Z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&Z.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&Z.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&Z.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&Z.push(this._tintTexture)},M.prototype.dispose=function(Z){var M,j,K,b;Z&&(null===(M=this._texture)||void 0===M||M.dispose(),null===(j=this._textureRoughness)||void 0===j||j.dispose(),null===(K=this._bumpTexture)||void 0===K||K.dispose(),null===(b=this._tintTexture)||void 0===b||b.dispose())},M.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},M.prototype.addFallbacks=function(Z,M,j){return Z.CLEARCOAT_BUMP&&M.addFallback(j++,"CLEARCOAT_BUMP"),Z.CLEARCOAT_TINT&&M.addFallback(j++,"CLEARCOAT_TINT"),Z.CLEARCOAT&&M.addFallback(j++,"CLEARCOAT"),j},M.prototype.getSamplers=function(Z){Z.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")},M.prototype.getUniforms=function(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}},M._DefaultIndexOfRefraction=1.5,(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isEnabled",void 0),(0,K.l)([(0,b.z)()],M.prototype,"intensity",void 0),(0,K.l)([(0,b.z)()],M.prototype,"roughness",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"indexOfRefraction",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"texture",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRoughnessFromMainTexture",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"textureRoughness",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"remapF0OnInterfaceChange",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"bumpTexture",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isTintEnabled",void 0),(0,K.l)([(0,b.i)()],M.prototype,"tintColor",void 0),(0,K.l)([(0,b.z)()],M.prototype,"tintColorAtDistance",void 0),(0,K.l)([(0,b.z)()],M.prototype,"tintThickness",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"tintTexture",void 0),M}(i.c),cZ=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.IRIDESCENCE=!1,M.IRIDESCENCE_TEXTURE=!1,M.IRIDESCENCE_TEXTUREDIRECTUV=0,M.IRIDESCENCE_THICKNESS_TEXTURE=!1,M.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0,M.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=!1,M}return(0,K.m)(M,Z),M}(s.c),GZ=function(Z){function M(j,K){void 0===K&&(K=!0);var b=Z.call(this,j,"PBRIridescence",110,new cZ,K)||this;return b._isEnabled=!1,b.isEnabled=!1,b.intensity=1,b.minimumThickness=M._DefaultMinimumThickness,b.maximumThickness=M._DefaultMaximumThickness,b.indexOfRefraction=M._DefaultIndexOfRefraction,b._texture=null,b.texture=null,b._thicknessTexture=null,b.thicknessTexture=null,b._internalMarkAllSubMeshesAsTexturesDirty=j._dirtyCallbacks[1],b}return(0,K.m)(M,Z),M.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},M.prototype.isReadyForSubMesh=function(Z,M){if(!this._isEnabled)return!0;if(Z._areTexturesDirty&&M.texturesEnabled){if(this._texture&&q.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&q.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0},M.prototype.prepareDefines=function(Z,M){var j;this._isEnabled?(Z.IRIDESCENCE=!0,Z.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=null!==this._texture&&this._texture._texture===(null===(j=this._thicknessTexture)||void 0===j?void 0:j._texture)&&this._texture.checkTransformsAreIdentical(this._thicknessTexture),Z._areTexturesDirty&&M.texturesEnabled&&(this._texture&&q.d.IridescenceTextureEnabled?W.b.PrepareDefinesForMergedUV(this._texture,Z,"IRIDESCENCE_TEXTURE"):Z.IRIDESCENCE_TEXTURE=!1,!Z.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&this._thicknessTexture&&q.d.IridescenceTextureEnabled?W.b.PrepareDefinesForMergedUV(this._thicknessTexture,Z,"IRIDESCENCE_THICKNESS_TEXTURE"):Z.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(Z.IRIDESCENCE=!1,Z.IRIDESCENCE_TEXTURE=!1,Z.IRIDESCENCE_THICKNESS_TEXTURE=!1,Z.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=!1)},M.prototype.bindForSubMesh=function(Z,M,j,K){var b,g,O,Q,Y,I,E,s;if(this._isEnabled){var i=K.materialDefines,a=this._material.isFrozen,z=i.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE;Z.useUbo&&a&&Z.isSync||(z&&q.d.IridescenceTextureEnabled?(Z.updateFloat4("vIridescenceInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),W.b.BindTextureMatrix(this._texture,Z,"iridescence")):(this._texture||this._thicknessTexture)&&q.d.IridescenceTextureEnabled&&(Z.updateFloat4("vIridescenceInfos",null!==(g=null===(b=this._texture)||void 0===b?void 0:b.coordinatesIndex)&&void 0!==g?g:0,null!==(Q=null===(O=this._texture)||void 0===O?void 0:O.level)&&void 0!==Q?Q:0,null!==(I=null===(Y=this._thicknessTexture)||void 0===Y?void 0:Y.coordinatesIndex)&&void 0!==I?I:0,null!==(s=null===(E=this._thicknessTexture)||void 0===E?void 0:E.level)&&void 0!==s?s:0),this._texture&&W.b.BindTextureMatrix(this._texture,Z,"iridescence"),!this._thicknessTexture||z||i.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE||W.b.BindTextureMatrix(this._thicknessTexture,Z,"iridescenceThickness")),Z.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),M.texturesEnabled&&(this._texture&&q.d.IridescenceTextureEnabled&&Z.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&!z&&!i.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&q.d.IridescenceTextureEnabled&&Z.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}},M.prototype.hasTexture=function(Z){return this._texture===Z||this._thicknessTexture===Z},M.prototype.getActiveTextures=function(Z){this._texture&&Z.push(this._texture),this._thicknessTexture&&Z.push(this._thicknessTexture)},M.prototype.getAnimatables=function(Z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&Z.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&Z.push(this._thicknessTexture)},M.prototype.dispose=function(Z){var M,j;Z&&(null===(M=this._texture)||void 0===M||M.dispose(),null===(j=this._thicknessTexture)||void 0===j||j.dispose())},M.prototype.getClassName=function(){return"PBRIridescenceConfiguration"},M.prototype.addFallbacks=function(Z,M,j){return Z.IRIDESCENCE&&M.addFallback(j++,"IRIDESCENCE"),j},M.prototype.getSamplers=function(Z){Z.push("iridescenceSampler","iridescenceThicknessSampler")},M.prototype.getUniforms=function(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}},M._DefaultMinimumThickness=100,M._DefaultMaximumThickness=400,M._DefaultIndexOfRefraction=1.3,(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isEnabled",void 0),(0,K.l)([(0,b.z)()],M.prototype,"intensity",void 0),(0,K.l)([(0,b.z)()],M.prototype,"minimumThickness",void 0),(0,K.l)([(0,b.z)()],M.prototype,"maximumThickness",void 0),(0,K.l)([(0,b.z)()],M.prototype,"indexOfRefraction",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"texture",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"thicknessTexture",void 0),M}(i.c),fZ=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.ANISOTROPIC=!1,M.ANISOTROPIC_TEXTURE=!1,M.ANISOTROPIC_TEXTUREDIRECTUV=0,M.MAINUV1=!1,M}return(0,K.m)(M,Z),M}(s.c),XZ=function(Z){function M(M,j){void 0===j&&(j=!0);var K=Z.call(this,M,"PBRAnisotropic",110,new fZ,j)||this;return K._isEnabled=!1,K.isEnabled=!1,K.intensity=1,K.direction=new I.h(1,0),K._texture=null,K.texture=null,K._internalMarkAllSubMeshesAsTexturesDirty=M._dirtyCallbacks[1],K}return(0,K.m)(M,Z),M.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},M.prototype.isReadyForSubMesh=function(Z,M){return!this._isEnabled||!(Z._areTexturesDirty&&M.texturesEnabled&&this._texture&&q.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},M.prototype.prepareDefinesBeforeAttributes=function(Z,M,j){this._isEnabled?(Z.ANISOTROPIC=this._isEnabled,this._isEnabled&&!j.isVerticesDataPresent(E.f.TangentKind)&&(Z._needUVs=!0,Z.MAINUV1=!0),Z._areTexturesDirty&&M.texturesEnabled&&(this._texture&&q.d.AnisotropicTextureEnabled?W.b.PrepareDefinesForMergedUV(this._texture,Z,"ANISOTROPIC_TEXTURE"):Z.ANISOTROPIC_TEXTURE=!1)):(Z.ANISOTROPIC=!1,Z.ANISOTROPIC_TEXTURE=!1)},M.prototype.bindForSubMesh=function(Z,M){if(this._isEnabled){var j=this._material.isFrozen;Z.useUbo&&j&&Z.isSync||(this._texture&&q.d.AnisotropicTextureEnabled&&(Z.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),W.b.BindTextureMatrix(this._texture,Z,"anisotropy")),Z.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),M.texturesEnabled&&this._texture&&q.d.AnisotropicTextureEnabled&&Z.setTexture("anisotropySampler",this._texture)}},M.prototype.hasTexture=function(Z){return this._texture===Z},M.prototype.getActiveTextures=function(Z){this._texture&&Z.push(this._texture)},M.prototype.getAnimatables=function(Z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&Z.push(this._texture)},M.prototype.dispose=function(Z){Z&&this._texture&&this._texture.dispose()},M.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},M.prototype.addFallbacks=function(Z,M,j){return Z.ANISOTROPIC&&M.addFallback(j++,"ANISOTROPIC"),j},M.prototype.getSamplers=function(Z){Z.push("anisotropySampler")},M.prototype.getUniforms=function(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}},(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isEnabled",void 0),(0,K.l)([(0,b.z)()],M.prototype,"intensity",void 0),(0,K.l)([(0,b.t)()],M.prototype,"direction",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"texture",void 0),M}(i.c),dZ=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.SHEEN=!1,M.SHEEN_TEXTURE=!1,M.SHEEN_GAMMATEXTURE=!1,M.SHEEN_TEXTURE_ROUGHNESS=!1,M.SHEEN_TEXTUREDIRECTUV=0,M.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,M.SHEEN_LINKWITHALBEDO=!1,M.SHEEN_ROUGHNESS=!1,M.SHEEN_ALBEDOSCALING=!1,M.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,M.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1,M}return(0,K.m)(M,Z),M}(s.c),WZ=function(Z){function M(M,j){void 0===j&&(j=!0);var K=Z.call(this,M,"Sheen",120,new dZ,j)||this;return K._isEnabled=!1,K.isEnabled=!1,K._linkSheenWithAlbedo=!1,K.linkSheenWithAlbedo=!1,K.intensity=1,K.color=o.e.White(),K._texture=null,K.texture=null,K._useRoughnessFromMainTexture=!0,K.useRoughnessFromMainTexture=!0,K._roughness=null,K.roughness=null,K._textureRoughness=null,K.textureRoughness=null,K._albedoScaling=!1,K.albedoScaling=!1,K._internalMarkAllSubMeshesAsTexturesDirty=M._dirtyCallbacks[1],K}return(0,K.m)(M,Z),M.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},M.prototype.isReadyForSubMesh=function(Z,M){if(!this._isEnabled)return!0;if(Z._areTexturesDirty&&M.texturesEnabled){if(this._texture&&q.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&q.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0},M.prototype.prepareDefines=function(Z,M){var j;this._isEnabled?(Z.SHEEN=!0,Z.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,Z.SHEEN_ROUGHNESS=null!==this._roughness,Z.SHEEN_ALBEDOSCALING=this._albedoScaling,Z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,Z.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=null!==this._texture&&this._texture._texture===(null===(j=this._textureRoughness)||void 0===j?void 0:j._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),Z._areTexturesDirty&&M.texturesEnabled&&(this._texture&&q.d.SheenTextureEnabled?(W.b.PrepareDefinesForMergedUV(this._texture,Z,"SHEEN_TEXTURE"),Z.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):Z.SHEEN_TEXTURE=!1,this._textureRoughness&&q.d.SheenTextureEnabled?W.b.PrepareDefinesForMergedUV(this._textureRoughness,Z,"SHEEN_TEXTURE_ROUGHNESS"):Z.SHEEN_TEXTURE_ROUGHNESS=!1)):(Z.SHEEN=!1,Z.SHEEN_TEXTURE=!1,Z.SHEEN_TEXTURE_ROUGHNESS=!1,Z.SHEEN_LINKWITHALBEDO=!1,Z.SHEEN_ROUGHNESS=!1,Z.SHEEN_ALBEDOSCALING=!1,Z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,Z.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1)},M.prototype.bindForSubMesh=function(Z,M,j,K){var b,g,O,Q,Y,I,E,s;if(this._isEnabled){var i=K.materialDefines,a=this._material.isFrozen,z=i.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL;Z.useUbo&&a&&Z.isSync||(z&&q.d.SheenTextureEnabled?(Z.updateFloat4("vSheenInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),W.b.BindTextureMatrix(this._texture,Z,"sheen")):(this._texture||this._textureRoughness)&&q.d.SheenTextureEnabled&&(Z.updateFloat4("vSheenInfos",null!==(g=null===(b=this._texture)||void 0===b?void 0:b.coordinatesIndex)&&void 0!==g?g:0,null!==(Q=null===(O=this._texture)||void 0===O?void 0:O.level)&&void 0!==Q?Q:0,null!==(I=null===(Y=this._textureRoughness)||void 0===Y?void 0:Y.coordinatesIndex)&&void 0!==I?I:0,null!==(s=null===(E=this._textureRoughness)||void 0===E?void 0:E.level)&&void 0!==s?s:0),this._texture&&W.b.BindTextureMatrix(this._texture,Z,"sheen"),!this._textureRoughness||z||i.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE||W.b.BindTextureMatrix(this._textureRoughness,Z,"sheenRoughness")),Z.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),null!==this._roughness&&Z.updateFloat("vSheenRoughness",this._roughness)),M.texturesEnabled&&(this._texture&&q.d.SheenTextureEnabled&&Z.setTexture("sheenSampler",this._texture),this._textureRoughness&&!z&&!i.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&q.d.SheenTextureEnabled&&Z.setTexture("sheenRoughnessSampler",this._textureRoughness))}},M.prototype.hasTexture=function(Z){return this._texture===Z||this._textureRoughness===Z},M.prototype.getActiveTextures=function(Z){this._texture&&Z.push(this._texture),this._textureRoughness&&Z.push(this._textureRoughness)},M.prototype.getAnimatables=function(Z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&Z.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&Z.push(this._textureRoughness)},M.prototype.dispose=function(Z){var M,j;Z&&(null===(M=this._texture)||void 0===M||M.dispose(),null===(j=this._textureRoughness)||void 0===j||j.dispose())},M.prototype.getClassName=function(){return"PBRSheenConfiguration"},M.prototype.addFallbacks=function(Z,M,j){return Z.SHEEN&&M.addFallback(j++,"SHEEN"),j},M.prototype.getSamplers=function(Z){Z.push("sheenSampler","sheenRoughnessSampler")},M.prototype.getUniforms=function(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}},(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isEnabled",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"linkSheenWithAlbedo",void 0),(0,K.l)([(0,b.z)()],M.prototype,"intensity",void 0),(0,K.l)([(0,b.i)()],M.prototype,"color",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"texture",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRoughnessFromMainTexture",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"roughness",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"textureRoughness",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"albedoScaling",void 0),M}(i.c),AZ=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.SUBSURFACE=!1,M.SS_REFRACTION=!1,M.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,M.SS_TRANSLUCENCY=!1,M.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,M.SS_SCATTERING=!1,M.SS_THICKNESSANDMASK_TEXTURE=!1,M.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,M.SS_HAS_THICKNESS=!1,M.SS_REFRACTIONINTENSITY_TEXTURE=!1,M.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,M.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,M.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,M.SS_REFRACTIONMAP_3D=!1,M.SS_REFRACTIONMAP_OPPOSITEZ=!1,M.SS_LODINREFRACTIONALPHA=!1,M.SS_GAMMAREFRACTION=!1,M.SS_RGBDREFRACTION=!1,M.SS_LINEARSPECULARREFRACTION=!1,M.SS_LINKREFRACTIONTOTRANSPARENCY=!1,M.SS_ALBEDOFORREFRACTIONTINT=!1,M.SS_ALBEDOFORTRANSLUCENCYTINT=!1,M.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,M.SS_USE_THICKNESS_AS_DEPTH=!1,M.SS_MASK_FROM_THICKNESS_TEXTURE=!1,M.SS_USE_GLTF_TEXTURES=!1,M}return(0,K.m)(M,Z),M}(s.c),qZ=function(Z){function M(M,j){void 0===j&&(j=!0);var K=Z.call(this,M,"PBRSubSurface",130,new AZ,j)||this;return K._isRefractionEnabled=!1,K.isRefractionEnabled=!1,K._isTranslucencyEnabled=!1,K.isTranslucencyEnabled=!1,K._isScatteringEnabled=!1,K.isScatteringEnabled=!1,K._scatteringDiffusionProfileIndex=0,K.refractionIntensity=1,K.translucencyIntensity=1,K.useAlbedoToTintRefraction=!1,K.useAlbedoToTintTranslucency=!1,K._thicknessTexture=null,K.thicknessTexture=null,K._refractionTexture=null,K.refractionTexture=null,K._indexOfRefraction=1.5,K.indexOfRefraction=1.5,K._volumeIndexOfRefraction=-1,K._invertRefractionY=!1,K.invertRefractionY=!1,K._linkRefractionWithTransparency=!1,K.linkRefractionWithTransparency=!1,K.minimumThickness=0,K.maximumThickness=1,K.useThicknessAsDepth=!1,K.tintColor=o.e.White(),K.tintColorAtDistance=1,K.diffusionDistance=o.e.White(),K._useMaskFromThicknessTexture=!1,K.useMaskFromThicknessTexture=!1,K._refractionIntensityTexture=null,K.refractionIntensityTexture=null,K._translucencyIntensityTexture=null,K.translucencyIntensityTexture=null,K._useGltfStyleTextures=!1,K.useGltfStyleTextures=!1,K._scene=M.getScene(),K.registerForExtraEvents=!0,K._internalMarkAllSubMeshesAsTexturesDirty=M._dirtyCallbacks[1],K._internalMarkScenePrePassDirty=M._dirtyCallbacks[32],K}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"scatteringDiffusionProfile",{get:function(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null},set:function(Z){this._scene.enableSubSurfaceForPrePass()&&Z&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(Z))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"volumeIndexOfRefraction",{get:function(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction},set:function(Z){this._volumeIndexOfRefraction=Z>=1?Z:-1},enumerable:!1,configurable:!0}),M.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},M.prototype._markScenePrePassDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()},M.prototype.isReadyForSubMesh=function(Z,M){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(Z._areTexturesDirty&&M.texturesEnabled){if(this._thicknessTexture&&q.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var j=this._getRefractionTexture(M);if(j&&q.d.RefractionTextureEnabled&&!j.isReadyOrNotBlocking())return!1}return!0},M.prototype.prepareDefines=function(Z,M){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return Z.SUBSURFACE=!1,Z.SS_TRANSLUCENCY=!1,Z.SS_SCATTERING=!1,void(Z.SS_REFRACTION=!1);if(Z._areTexturesDirty){Z.SUBSURFACE=!0,Z.SS_TRANSLUCENCY=this._isTranslucencyEnabled,Z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,Z.SS_SCATTERING=this._isScatteringEnabled,Z.SS_THICKNESSANDMASK_TEXTURE=!1,Z.SS_REFRACTIONINTENSITY_TEXTURE=!1,Z.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,Z.SS_HAS_THICKNESS=!1,Z.SS_MASK_FROM_THICKNESS_TEXTURE=!1,Z.SS_USE_GLTF_TEXTURES=!1,Z.SS_REFRACTION=!1,Z.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,Z.SS_REFRACTIONMAP_3D=!1,Z.SS_GAMMAREFRACTION=!1,Z.SS_RGBDREFRACTION=!1,Z.SS_LINEARSPECULARREFRACTION=!1,Z.SS_REFRACTIONMAP_OPPOSITEZ=!1,Z.SS_LODINREFRACTIONALPHA=!1,Z.SS_LINKREFRACTIONTOTRANSPARENCY=!1,Z.SS_ALBEDOFORREFRACTIONTINT=!1,Z.SS_ALBEDOFORTRANSLUCENCYTINT=!1,Z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,Z.SS_USE_THICKNESS_AS_DEPTH=!1;var j=!!this._thicknessTexture&&!!this._refractionIntensityTexture&&this._refractionIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._refractionIntensityTexture._texture===this._thicknessTexture._texture,K=!!this._thicknessTexture&&!!this._translucencyIntensityTexture&&this._translucencyIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._translucencyIntensityTexture._texture===this._thicknessTexture._texture,b=(j||!this._refractionIntensityTexture)&&(K||!this._translucencyIntensityTexture);if(Z._areTexturesDirty&&M.texturesEnabled&&(this._thicknessTexture&&q.d.ThicknessTextureEnabled&&W.b.PrepareDefinesForMergedUV(this._thicknessTexture,Z,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&q.d.RefractionIntensityTextureEnabled&&!b&&W.b.PrepareDefinesForMergedUV(this._refractionIntensityTexture,Z,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&q.d.TranslucencyIntensityTextureEnabled&&!b&&W.b.PrepareDefinesForMergedUV(this._translucencyIntensityTexture,Z,"SS_TRANSLUCENCYINTENSITY_TEXTURE")),Z.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,Z.SS_MASK_FROM_THICKNESS_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture||!!this._translucencyIntensityTexture)&&b,Z.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,Z.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture)&&b,Z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._translucencyIntensityTexture)&&b,this._isRefractionEnabled&&M.texturesEnabled){var g=this._getRefractionTexture(M);g&&q.d.RefractionTextureEnabled&&(Z.SS_REFRACTION=!0,Z.SS_REFRACTIONMAP_3D=g.isCube,Z.SS_GAMMAREFRACTION=g.gammaSpace,Z.SS_RGBDREFRACTION=g.isRGBD,Z.SS_LINEARSPECULARREFRACTION=g.linearSpecularLOD,Z.SS_REFRACTIONMAP_OPPOSITEZ=g.invertZ,Z.SS_LODINREFRACTIONALPHA=g.lodLevelInAlpha,Z.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,Z.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,Z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=g.isCube&&g.boundingBoxSize,Z.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(Z.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}},M.prototype.hardBindForSubMesh=function(Z,M,j,K){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled){K.getRenderingMesh().getWorldMatrix().decompose(I.e.Vector3[0]);var b=Math.max(Math.abs(I.e.Vector3[0].x),Math.abs(I.e.Vector3[0].y),Math.abs(I.e.Vector3[0].z));Z.updateFloat2("vThicknessParam",this.minimumThickness*b,(this.maximumThickness-this.minimumThickness)*b)}},M.prototype.bindForSubMesh=function(Z,M,j,K){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled){var b=K.materialDefines,g=this._material.isFrozen,O=this._material.realTimeFiltering,Q=b.LODBASEDMICROSFURACE,Y=this._getRefractionTexture(M);if(!Z.useUbo||!g||!Z.isSync){if(this._thicknessTexture&&q.d.ThicknessTextureEnabled&&(Z.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),W.b.BindTextureMatrix(this._thicknessTexture,Z,"thickness")),this._refractionIntensityTexture&&q.d.RefractionIntensityTextureEnabled&&b.SS_REFRACTIONINTENSITY_TEXTURE&&(Z.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),W.b.BindTextureMatrix(this._refractionIntensityTexture,Z,"refractionIntensity")),this._translucencyIntensityTexture&&q.d.TranslucencyIntensityTextureEnabled&&b.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(Z.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),W.b.BindTextureMatrix(this._translucencyIntensityTexture,Z,"translucencyIntensity")),Y&&q.d.RefractionTextureEnabled){Z.updateMatrix("refractionMatrix",Y.getReflectionTextureMatrix());var I=1;Y.isCube||Y.depth&&(I=Y.depth);var E=Y.getSize().width,s=this.volumeIndexOfRefraction;if(Z.updateFloat4("vRefractionInfos",Y.level,1/s,I,this._invertRefractionY?-1:1),Z.updateFloat4("vRefractionMicrosurfaceInfos",E,Y.lodGenerationScale,Y.lodGenerationOffset,1/this.indexOfRefraction),O&&Z.updateFloat2("vRefractionFilteringInfo",E,c.b.Log2(E)),Y.boundingBoxSize){var i=Y;Z.updateVector3("vRefractionPosition",i.boundingBoxPosition),Z.updateVector3("vRefractionSize",i.boundingBoxSize)}}this._isScatteringEnabled&&Z.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),Z.updateColor3("vDiffusionDistance",this.diffusionDistance),Z.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),Z.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0)}M.texturesEnabled&&(this._thicknessTexture&&q.d.ThicknessTextureEnabled&&Z.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&q.d.RefractionIntensityTextureEnabled&&b.SS_REFRACTIONINTENSITY_TEXTURE&&Z.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&q.d.TranslucencyIntensityTextureEnabled&&b.SS_TRANSLUCENCYINTENSITY_TEXTURE&&Z.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),Y&&q.d.RefractionTextureEnabled&&(Q?Z.setTexture("refractionSampler",Y):(Z.setTexture("refractionSampler",Y._lodTextureMid||Y),Z.setTexture("refractionSamplerLow",Y._lodTextureLow||Y),Z.setTexture("refractionSamplerHigh",Y._lodTextureHigh||Y))))}},M.prototype._getRefractionTexture=function(Z){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?Z.environmentTexture:null},Object.defineProperty(M.prototype,"disableAlphaBlending",{get:function(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!1,configurable:!0}),M.prototype.fillRenderTargetTextures=function(Z){q.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&Z.push(this._refractionTexture)},M.prototype.hasTexture=function(Z){return this._thicknessTexture===Z||this._refractionTexture===Z},M.prototype.hasRenderTargetTextures=function(){return!!(q.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},M.prototype.getActiveTextures=function(Z){this._thicknessTexture&&Z.push(this._thicknessTexture),this._refractionTexture&&Z.push(this._refractionTexture)},M.prototype.getAnimatables=function(Z){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&Z.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&Z.push(this._refractionTexture)},M.prototype.dispose=function(Z){Z&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},M.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},M.prototype.addFallbacks=function(Z,M,j){return Z.SS_SCATTERING&&M.addFallback(j++,"SS_SCATTERING"),Z.SS_TRANSLUCENCY&&M.addFallback(j++,"SS_TRANSLUCENCY"),j},M.prototype.getSamplers=function(Z){Z.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},M.prototype.getUniforms=function(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"}]}},(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isRefractionEnabled",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isTranslucencyEnabled",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markScenePrePassDirty")],M.prototype,"isScatteringEnabled",void 0),(0,K.l)([(0,b.z)()],M.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,K.l)([(0,b.z)()],M.prototype,"refractionIntensity",void 0),(0,K.l)([(0,b.z)()],M.prototype,"translucencyIntensity",void 0),(0,K.l)([(0,b.z)()],M.prototype,"useAlbedoToTintRefraction",void 0),(0,K.l)([(0,b.z)()],M.prototype,"useAlbedoToTintTranslucency",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"thicknessTexture",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionTexture",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"indexOfRefraction",void 0),(0,K.l)([(0,b.z)()],M.prototype,"_volumeIndexOfRefraction",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"volumeIndexOfRefraction",null),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertRefractionY",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"linkRefractionWithTransparency",void 0),(0,K.l)([(0,b.z)()],M.prototype,"minimumThickness",void 0),(0,K.l)([(0,b.z)()],M.prototype,"maximumThickness",void 0),(0,K.l)([(0,b.z)()],M.prototype,"useThicknessAsDepth",void 0),(0,K.l)([(0,b.i)()],M.prototype,"tintColor",void 0),(0,K.l)([(0,b.z)()],M.prototype,"tintColorAtDistance",void 0),(0,K.l)([(0,b.i)()],M.prototype,"diffusionDistance",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useMaskFromThicknessTexture",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionIntensityTexture",void 0),(0,K.l)([(0,b.s)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"translucencyIntensityTexture",void 0),(0,K.l)([(0,b.z)(),(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useGltfStyleTextures",void 0),M}(i.c),TZ=j(56513),BZ={effect:null,subMesh:null},NZ=function(Z){function M(M){var j=Z.call(this,M)||this;return j.PBR=!0,j.NUM_SAMPLES="0",j.REALTIME_FILTERING=!1,j.MAINUV1=!1,j.MAINUV2=!1,j.MAINUV3=!1,j.MAINUV4=!1,j.MAINUV5=!1,j.MAINUV6=!1,j.UV1=!1,j.UV2=!1,j.UV3=!1,j.UV4=!1,j.UV5=!1,j.UV6=!1,j.ALBEDO=!1,j.GAMMAALBEDO=!1,j.ALBEDODIRECTUV=0,j.VERTEXCOLOR=!1,j.BAKED_VERTEX_ANIMATION_TEXTURE=!1,j.AMBIENT=!1,j.AMBIENTDIRECTUV=0,j.AMBIENTINGRAYSCALE=!1,j.OPACITY=!1,j.VERTEXALPHA=!1,j.OPACITYDIRECTUV=0,j.OPACITYRGB=!1,j.ALPHATEST=!1,j.DEPTHPREPASS=!1,j.ALPHABLEND=!1,j.ALPHAFROMALBEDO=!1,j.ALPHATESTVALUE="0.5",j.SPECULAROVERALPHA=!1,j.RADIANCEOVERALPHA=!1,j.ALPHAFRESNEL=!1,j.LINEARALPHAFRESNEL=!1,j.PREMULTIPLYALPHA=!1,j.EMISSIVE=!1,j.EMISSIVEDIRECTUV=0,j.GAMMAEMISSIVE=!1,j.REFLECTIVITY=!1,j.REFLECTIVITY_GAMMA=!1,j.REFLECTIVITYDIRECTUV=0,j.SPECULARTERM=!1,j.MICROSURFACEFROMREFLECTIVITYMAP=!1,j.MICROSURFACEAUTOMATIC=!1,j.LODBASEDMICROSFURACE=!1,j.MICROSURFACEMAP=!1,j.MICROSURFACEMAPDIRECTUV=0,j.METALLICWORKFLOW=!1,j.ROUGHNESSSTOREINMETALMAPALPHA=!1,j.ROUGHNESSSTOREINMETALMAPGREEN=!1,j.METALLNESSSTOREINMETALMAPBLUE=!1,j.AOSTOREINMETALMAPRED=!1,j.METALLIC_REFLECTANCE=!1,j.METALLIC_REFLECTANCE_GAMMA=!1,j.METALLIC_REFLECTANCEDIRECTUV=0,j.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,j.REFLECTANCE=!1,j.REFLECTANCE_GAMMA=!1,j.REFLECTANCEDIRECTUV=0,j.ENVIRONMENTBRDF=!1,j.ENVIRONMENTBRDF_RGBD=!1,j.NORMAL=!1,j.TANGENT=!1,j.BUMP=!1,j.BUMPDIRECTUV=0,j.OBJECTSPACE_NORMALMAP=!1,j.PARALLAX=!1,j.PARALLAXOCCLUSION=!1,j.NORMALXYSCALE=!0,j.LIGHTMAP=!1,j.LIGHTMAPDIRECTUV=0,j.USELIGHTMAPASSHADOWMAP=!1,j.GAMMALIGHTMAP=!1,j.RGBDLIGHTMAP=!1,j.REFLECTION=!1,j.REFLECTIONMAP_3D=!1,j.REFLECTIONMAP_SPHERICAL=!1,j.REFLECTIONMAP_PLANAR=!1,j.REFLECTIONMAP_CUBIC=!1,j.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,j.REFLECTIONMAP_PROJECTION=!1,j.REFLECTIONMAP_SKYBOX=!1,j.REFLECTIONMAP_EXPLICIT=!1,j.REFLECTIONMAP_EQUIRECTANGULAR=!1,j.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,j.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,j.INVERTCUBICMAP=!1,j.USESPHERICALFROMREFLECTIONMAP=!1,j.USEIRRADIANCEMAP=!1,j.USESPHERICALINVERTEX=!1,j.REFLECTIONMAP_OPPOSITEZ=!1,j.LODINREFLECTIONALPHA=!1,j.GAMMAREFLECTION=!1,j.RGBDREFLECTION=!1,j.LINEARSPECULARREFLECTION=!1,j.RADIANCEOCCLUSION=!1,j.HORIZONOCCLUSION=!1,j.INSTANCES=!1,j.THIN_INSTANCES=!1,j.INSTANCESCOLOR=!1,j.PREPASS=!1,j.PREPASS_IRRADIANCE=!1,j.PREPASS_IRRADIANCE_INDEX=-1,j.PREPASS_ALBEDO_SQRT=!1,j.PREPASS_ALBEDO_SQRT_INDEX=-1,j.PREPASS_DEPTH=!1,j.PREPASS_DEPTH_INDEX=-1,j.PREPASS_NORMAL=!1,j.PREPASS_NORMAL_INDEX=-1,j.PREPASS_POSITION=!1,j.PREPASS_POSITION_INDEX=-1,j.PREPASS_VELOCITY=!1,j.PREPASS_VELOCITY_INDEX=-1,j.PREPASS_REFLECTIVITY=!1,j.PREPASS_REFLECTIVITY_INDEX=-1,j.SCENE_MRT_COUNT=0,j.NUM_BONE_INFLUENCERS=0,j.BonesPerMesh=0,j.BONETEXTURE=!1,j.BONES_VELOCITY_ENABLED=!1,j.NONUNIFORMSCALING=!1,j.MORPHTARGETS=!1,j.MORPHTARGETS_NORMAL=!1,j.MORPHTARGETS_TANGENT=!1,j.MORPHTARGETS_UV=!1,j.NUM_MORPH_INFLUENCERS=0,j.MORPHTARGETS_TEXTURE=!1,j.IMAGEPROCESSING=!1,j.VIGNETTE=!1,j.VIGNETTEBLENDMODEMULTIPLY=!1,j.VIGNETTEBLENDMODEOPAQUE=!1,j.TONEMAPPING=!1,j.TONEMAPPING_ACES=!1,j.CONTRAST=!1,j.COLORCURVES=!1,j.COLORGRADING=!1,j.COLORGRADING3D=!1,j.SAMPLER3DGREENDEPTH=!1,j.SAMPLER3DBGRMAP=!1,j.IMAGEPROCESSINGPOSTPROCESS=!1,j.SKIPFINALCOLORCLAMP=!1,j.EXPOSURE=!1,j.MULTIVIEW=!1,j.ORDER_INDEPENDENT_TRANSPARENCY=!1,j.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,j.USEPHYSICALLIGHTFALLOFF=!1,j.USEGLTFLIGHTFALLOFF=!1,j.TWOSIDEDLIGHTING=!1,j.SHADOWFLOAT=!1,j.CLIPPLANE=!1,j.CLIPPLANE2=!1,j.CLIPPLANE3=!1,j.CLIPPLANE4=!1,j.CLIPPLANE5=!1,j.CLIPPLANE6=!1,j.POINTSIZE=!1,j.FOG=!1,j.LOGARITHMICDEPTH=!1,j.FORCENORMALFORWARD=!1,j.SPECULARAA=!1,j.UNLIT=!1,j.DEBUGMODE=0,j.rebuild(),j}return(0,K.m)(M,Z),M.prototype.reset=function(){Z.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0},M}(s.c),UZ=function(Z){function M(j,K){var b=Z.call(this,j,K)||this;return b._directIntensity=1,b._emissiveIntensity=1,b._environmentIntensity=1,b._specularIntensity=1,b._lightingInfos=new I.l(b._directIntensity,b._emissiveIntensity,b._environmentIntensity,b._specularIntensity),b._disableBumpMap=!1,b._albedoTexture=null,b._ambientTexture=null,b._ambientTextureStrength=1,b._ambientTextureImpactOnAnalyticalLights=M.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,b._opacityTexture=null,b._reflectionTexture=null,b._emissiveTexture=null,b._reflectivityTexture=null,b._metallicTexture=null,b._metallic=null,b._roughness=null,b._metallicF0Factor=1,b._metallicReflectanceColor=o.e.White(),b._useOnlyMetallicFromMetallicReflectanceTexture=!1,b._metallicReflectanceTexture=null,b._reflectanceTexture=null,b._microSurfaceTexture=null,b._bumpTexture=null,b._lightmapTexture=null,b._ambientColor=new o.e(0,0,0),b._albedoColor=new o.e(1,1,1),b._reflectivityColor=new o.e(1,1,1),b._reflectionColor=new o.e(1,1,1),b._emissiveColor=new o.e(0,0,0),b._microSurface=.9,b._useLightmapAsShadowmap=!1,b._useHorizonOcclusion=!0,b._useRadianceOcclusion=!0,b._useAlphaFromAlbedoTexture=!1,b._useSpecularOverAlpha=!0,b._useMicroSurfaceFromReflectivityMapAlpha=!1,b._useRoughnessFromMetallicTextureAlpha=!0,b._useRoughnessFromMetallicTextureGreen=!1,b._useMetallnessFromMetallicTextureBlue=!1,b._useAmbientOcclusionFromMetallicTextureRed=!1,b._useAmbientInGrayScale=!1,b._useAutoMicroSurfaceFromReflectivityMap=!1,b._lightFalloff=M.LIGHTFALLOFF_PHYSICAL,b._useRadianceOverAlpha=!0,b._useObjectSpaceNormalMap=!1,b._useParallax=!1,b._useParallaxOcclusion=!1,b._parallaxScaleBias=.05,b._disableLighting=!1,b._maxSimultaneousLights=4,b._invertNormalMapX=!1,b._invertNormalMapY=!1,b._twoSidedLighting=!1,b._alphaCutOff=.4,b._forceAlphaTest=!1,b._useAlphaFresnel=!1,b._useLinearAlphaFresnel=!1,b._environmentBRDFTexture=null,b._forceIrradianceInFragment=!1,b._realTimeFiltering=!1,b._realTimeFilteringQuality=8,b._forceNormalForward=!1,b._enableSpecularAntiAliasing=!1,b._imageProcessingObserver=null,b._renderTargets=new O.f(16),b._globalAmbientColor=new o.e(0,0,0),b._useLogarithmicDepth=!1,b._unlit=!1,b._debugMode=0,b.debugMode=0,b._debugLimit=-1,b._debugFactor=1,b._cacheHasRenderTargetTextures=!1,b.brdf=new z(b),b.clearCoat=new oZ(b),b.iridescence=new GZ(b),b.anisotropy=new XZ(b),b.sheen=new WZ(b),b.subSurface=new qZ(b),b.detailMap=new TZ.d(b),b._attachImageProcessingConfiguration(null),b.getRenderTargetTextures=function(){return b._renderTargets.reset(),q.d.ReflectionTextureEnabled&&b._reflectionTexture&&b._reflectionTexture.isRenderTarget&&b._renderTargets.push(b._reflectionTexture),b._eventInfo.renderTargets=b._renderTargets,b._callbackPluginEventFillRenderTargetTextures(b._eventInfo),b._renderTargets},b._environmentBRDFTexture=(0,Q.b)(b.getScene()),b.prePassConfiguration=new V.d,b}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"realTimeFiltering",{get:function(){return this._realTimeFiltering},set:function(Z){this._realTimeFiltering=Z,this.markAsDirty(1)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"realTimeFilteringQuality",{get:function(){return this._realTimeFilteringQuality},set:function(Z){this._realTimeFilteringQuality=Z,this.markAsDirty(1)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),M.prototype._attachImageProcessingConfiguration=function(Z){var M=this;Z!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=Z||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){M._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(M.prototype,"hasRenderTargetTextures",{get:function(){return!!(q.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isPrePassCapable",{get:function(){return!this.disableDepthWrite},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(M.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(Z){this._useLogarithmicDepth=Z&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"_disableAlphaBlending",{get:function(){var Z;return this._transparencyMode===M.PBRMATERIAL_OPAQUE||this._transparencyMode===M.PBRMATERIAL_ALPHATEST||(null===(Z=this.subSurface)||void 0===Z?void 0:Z.disableAlphaBlending)},enumerable:!1,configurable:!0}),M.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},M.prototype.needAlphaTesting=function(){var Z;return!!this._forceAlphaTest||!(null===(Z=this.subSurface)||void 0===Z?void 0:Z.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===M.PBRMATERIAL_ALPHATEST))},M.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==M.PBRMATERIAL_OPAQUE},M.prototype._hasAlphaChannel=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha||null!=this._opacityTexture},M.prototype.getAlphaTestTexture=function(){return this._albedoTexture},M.prototype.isReadyForSubMesh=function(Z,M,j){if(this._uniformBufferLayoutBuilt||this.buildUniformLayout(),M.effect&&this.isFrozen&&M.effect._wasPreviouslyReady&&M.effect._wasPreviouslyUsingInstances===j)return!0;M.materialDefines||(this._callbackPluginEventGeneric(X.e.GetDefineNames,this._eventInfo),M.materialDefines=new NZ(this._eventInfo.defineNames));var K=M.materialDefines;if(this._isReadyForSubMesh(M))return!0;var b=this.getScene(),O=b.getEngine();if(K._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,b.texturesEnabled)){if(this._albedoTexture&&q.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&q.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&q.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var Q=this._getReflectionTexture();if(Q&&q.d.ReflectionTextureEnabled){if(!Q.isReadyOrNotBlocking())return!1;if(Q.irradianceTexture&&!Q.irradianceTexture.isReadyOrNotBlocking())return!1}if(this._lightmapTexture&&q.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&q.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(q.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(O.getCaps().standardDerivatives&&this._bumpTexture&&q.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&q.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=K,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(K._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;O.getCaps().standardDerivatives||Z.isVerticesDataPresent(E.f.NormalKind)||(Z.createNormals(!0),g.c.Warn("PBRMaterial: Normals have been created for the mesh: "+Z.name));var Y=M.effect,I=K._areLightsDisposed,s=this._prepareEffect(Z,K,this.onCompiled,this.onError,j,null,M.getRenderingMesh().hasThinInstances);if(s)if(this._onEffectCreatedObservable&&(BZ.effect=s,BZ.subMesh=M,this._onEffectCreatedObservable.notifyObservers(BZ)),this.allowShaderHotSwapping&&Y&&!s.isReady()){if(s=Y,K.markAsUnprocessed(),I)return K._areLightsDisposed=!0,!1}else b.resetCachedMaterial(),M.setEffect(s,K,this._materialContext);return!(!M.effect||!M.effect.isReady())&&(K._renderId=b.getRenderId(),M.effect._wasPreviouslyReady=!0,M.effect._wasPreviouslyUsingInstances=!!j,!0)},M.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},M.prototype._prepareEffect=function(Z,M,j,K,b,g,O){if(void 0===j&&(j=null),void 0===K&&(K=null),void 0===b&&(b=null),void 0===g&&(g=null),this._prepareDefines(Z,M,b,g,O),!M.isDirty)return null;M.markAsProcessed();var Q=this.getScene().getEngine(),Y=new zZ.b,I=0;M.USESPHERICALINVERTEX&&Y.addFallback(I++,"USESPHERICALINVERTEX"),M.FOG&&Y.addFallback(I,"FOG"),M.SPECULARAA&&Y.addFallback(I,"SPECULARAA"),M.POINTSIZE&&Y.addFallback(I,"POINTSIZE"),M.LOGARITHMICDEPTH&&Y.addFallback(I,"LOGARITHMICDEPTH"),M.PARALLAX&&Y.addFallback(I,"PARALLAX"),M.PARALLAXOCCLUSION&&Y.addFallback(I++,"PARALLAXOCCLUSION"),M.ENVIRONMENTBRDF&&Y.addFallback(I++,"ENVIRONMENTBRDF"),M.TANGENT&&Y.addFallback(I++,"TANGENT"),M.BUMP&&Y.addFallback(I++,"BUMP"),I=W.b.HandleFallbacksForShadows(M,Y,this._maxSimultaneousLights,I++),M.SPECULARTERM&&Y.addFallback(I++,"SPECULARTERM"),M.USESPHERICALFROMREFLECTIONMAP&&Y.addFallback(I++,"USESPHERICALFROMREFLECTIONMAP"),M.USEIRRADIANCEMAP&&Y.addFallback(I++,"USEIRRADIANCEMAP"),M.LIGHTMAP&&Y.addFallback(I++,"LIGHTMAP"),M.NORMAL&&Y.addFallback(I++,"NORMAL"),M.AMBIENT&&Y.addFallback(I++,"AMBIENT"),M.EMISSIVE&&Y.addFallback(I++,"EMISSIVE"),M.VERTEXCOLOR&&Y.addFallback(I++,"VERTEXCOLOR"),M.MORPHTARGETS&&Y.addFallback(I++,"MORPHTARGETS"),M.MULTIVIEW&&Y.addFallback(0,"MULTIVIEW");var s=[E.f.PositionKind];M.NORMAL&&s.push(E.f.NormalKind),M.TANGENT&&s.push(E.f.TangentKind);for(var i=1;i<=6;++i)M["UV"+i]&&s.push("uv".concat(1===i?"":i));M.VERTEXCOLOR&&s.push(E.f.ColorKind),M.INSTANCESCOLOR&&s.push(E.f.ColorInstanceKind),W.b.PrepareAttributesForBones(s,Z,M,Y),W.b.PrepareAttributesForInstances(s,M),W.b.PrepareAttributesForMorphTargets(s,Z,M),W.b.PrepareAttributesForBakedVertexAnimation(s,Z,M);var a="pbr",z=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],o=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],c=["Material","Scene","Mesh"];this._eventInfo.fallbacks=Y,this._eventInfo.fallbackRank=I,this._eventInfo.defines=M,this._eventInfo.uniforms=z,this._eventInfo.attributes=s,this._eventInfo.samplers=o,this._eventInfo.uniformBuffersNames=c,this._eventInfo.customCode=void 0,this._eventInfo.mesh=Z,this._callbackPluginEventGeneric(X.e.PrepareEffect,this._eventInfo),V.d.AddUniforms(z),V.d.AddSamplers(o),G.e&&(G.e.PrepareUniforms(z,M),G.e.PrepareSamplers(o,M)),W.b.PrepareUniformsAndSamplersList({uniformsNames:z,uniformBuffersNames:c,samplers:o,defines:M,maxSimultaneousLights:this._maxSimultaneousLights});var f={};this.customShaderNameResolve&&(a=this.customShaderNameResolve(a,z,c,o,M,s,f));var d=M.toString();return Q.createEffect(a,{attributes:s,uniformsNames:z,uniformBuffersNames:c,samplers:o,defines:d,fallbacks:Y,onCompiled:j,onError:K,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:M.NUM_MORPH_INFLUENCERS},processFinalCode:f.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:M.PREPASS},Q)},M.prototype._prepareDefines=function(Z,j,K,b,g){var O;void 0===K&&(K=null),void 0===b&&(b=null),void 0===g&&(g=!1);var Q=this.getScene(),Y=Q.getEngine();W.b.PrepareDefinesForLights(Q,Z,j,!0,this._maxSimultaneousLights,this._disableLighting),j._needNormals=!0,W.b.PrepareDefinesForMultiview(Q,j);var I=this.needAlphaBlendingForMesh(Z)&&this.getScene().useOrderIndependentTransparency;if(W.b.PrepareDefinesForPrePass(Q,j,this.canRenderToMRT&&!I),W.b.PrepareDefinesForOIT(Q,j,I),j.METALLICWORKFLOW=this.isMetallicWorkflow(),j._areTexturesDirty){if(j._needUVs=!1,Q.texturesEnabled){Q.getEngine().getCaps().textureLOD&&(j.LODBASEDMICROSFURACE=!0),this._albedoTexture&&q.d.DiffuseTextureEnabled?(W.b.PrepareDefinesForMergedUV(this._albedoTexture,j,"ALBEDO"),j.GAMMAALBEDO=this._albedoTexture.gammaSpace):j.ALBEDO=!1,this._ambientTexture&&q.d.AmbientTextureEnabled?(W.b.PrepareDefinesForMergedUV(this._ambientTexture,j,"AMBIENT"),j.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):j.AMBIENT=!1,this._opacityTexture&&q.d.OpacityTextureEnabled?(W.b.PrepareDefinesForMergedUV(this._opacityTexture,j,"OPACITY"),j.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):j.OPACITY=!1;var s=this._getReflectionTexture();if(s&&q.d.ReflectionTextureEnabled){switch(j.REFLECTION=!0,j.GAMMAREFLECTION=s.gammaSpace,j.RGBDREFLECTION=s.isRGBD,j.LODINREFLECTIONALPHA=s.lodLevelInAlpha,j.LINEARSPECULARREFLECTION=s.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(j.NUM_SAMPLES=""+this.realTimeFilteringQuality,Y._features.needTypeSuffixInShaderConstants&&(j.NUM_SAMPLES=j.NUM_SAMPLES+"u"),j.REALTIME_FILTERING=!0):j.REALTIME_FILTERING=!1,s.coordinatesMode===A.b.INVCUBIC_MODE&&(j.INVERTCUBICMAP=!0),j.REFLECTIONMAP_3D=s.isCube,j.REFLECTIONMAP_OPPOSITEZ=j.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!s.invertZ:s.invertZ,j.REFLECTIONMAP_CUBIC=!1,j.REFLECTIONMAP_EXPLICIT=!1,j.REFLECTIONMAP_PLANAR=!1,j.REFLECTIONMAP_PROJECTION=!1,j.REFLECTIONMAP_SKYBOX=!1,j.REFLECTIONMAP_SPHERICAL=!1,j.REFLECTIONMAP_EQUIRECTANGULAR=!1,j.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,j.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,s.coordinatesMode){case A.b.EXPLICIT_MODE:j.REFLECTIONMAP_EXPLICIT=!0;break;case A.b.PLANAR_MODE:j.REFLECTIONMAP_PLANAR=!0;break;case A.b.PROJECTION_MODE:j.REFLECTIONMAP_PROJECTION=!0;break;case A.b.SKYBOX_MODE:j.REFLECTIONMAP_SKYBOX=!0;break;case A.b.SPHERICAL_MODE:j.REFLECTIONMAP_SPHERICAL=!0;break;case A.b.EQUIRECTANGULAR_MODE:j.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case A.b.FIXED_EQUIRECTANGULAR_MODE:j.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case A.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:j.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case A.b.CUBIC_MODE:case A.b.INVCUBIC_MODE:default:j.REFLECTIONMAP_CUBIC=!0,j.USE_LOCAL_REFLECTIONMAP_CUBIC=!!s.boundingBoxSize}s.coordinatesMode!==A.b.SKYBOX_MODE&&(s.irradianceTexture?(j.USEIRRADIANCEMAP=!0,j.USESPHERICALFROMREFLECTIONMAP=!1):s.isCube&&(j.USESPHERICALFROMREFLECTIONMAP=!0,j.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||Q.getEngine().getCaps().maxVaryingVectors<=8?j.USESPHERICALINVERTEX=!1:j.USESPHERICALINVERTEX=!0))}else j.REFLECTION=!1,j.REFLECTIONMAP_3D=!1,j.REFLECTIONMAP_SPHERICAL=!1,j.REFLECTIONMAP_PLANAR=!1,j.REFLECTIONMAP_CUBIC=!1,j.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,j.REFLECTIONMAP_PROJECTION=!1,j.REFLECTIONMAP_SKYBOX=!1,j.REFLECTIONMAP_EXPLICIT=!1,j.REFLECTIONMAP_EQUIRECTANGULAR=!1,j.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,j.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,j.INVERTCUBICMAP=!1,j.USESPHERICALFROMREFLECTIONMAP=!1,j.USEIRRADIANCEMAP=!1,j.USESPHERICALINVERTEX=!1,j.REFLECTIONMAP_OPPOSITEZ=!1,j.LODINREFLECTIONALPHA=!1,j.GAMMAREFLECTION=!1,j.RGBDREFLECTION=!1,j.LINEARSPECULARREFLECTION=!1;if(this._lightmapTexture&&q.d.LightmapTextureEnabled?(W.b.PrepareDefinesForMergedUV(this._lightmapTexture,j,"LIGHTMAP"),j.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,j.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,j.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):j.LIGHTMAP=!1,this._emissiveTexture&&q.d.EmissiveTextureEnabled?(W.b.PrepareDefinesForMergedUV(this._emissiveTexture,j,"EMISSIVE"),j.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):j.EMISSIVE=!1,q.d.SpecularTextureEnabled){if(this._metallicTexture?(W.b.PrepareDefinesForMergedUV(this._metallicTexture,j,"REFLECTIVITY"),j.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,j.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,j.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,j.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,j.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?(W.b.PrepareDefinesForMergedUV(this._reflectivityTexture,j,"REFLECTIVITY"),j.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,j.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,j.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):j.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture){var i=null!==this._metallicReflectanceTexture&&this._metallicReflectanceTexture._texture===(null===(O=this._reflectanceTexture)||void 0===O?void 0:O._texture)&&this._metallicReflectanceTexture.checkTransformsAreIdentical(this._reflectanceTexture);j.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture&&!i,this._metallicReflectanceTexture?(W.b.PrepareDefinesForMergedUV(this._metallicReflectanceTexture,j,"METALLIC_REFLECTANCE"),j.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):j.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&!i&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?(W.b.PrepareDefinesForMergedUV(this._reflectanceTexture,j,"REFLECTANCE"),j.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):j.REFLECTANCE=!1}else j.METALLIC_REFLECTANCE=!1,j.REFLECTANCE=!1;this._microSurfaceTexture?W.b.PrepareDefinesForMergedUV(this._microSurfaceTexture,j,"MICROSURFACEMAP"):j.MICROSURFACEMAP=!1}else j.REFLECTIVITY=!1,j.MICROSURFACEMAP=!1;Q.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&q.d.BumpTextureEnabled&&!this._disableBumpMap?(W.b.PrepareDefinesForMergedUV(this._bumpTexture,j,"BUMP"),this._useParallax&&this._albedoTexture&&q.d.DiffuseTextureEnabled?(j.PARALLAX=!0,j.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):j.PARALLAX=!1,j.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(j.BUMP=!1,j.PARALLAX=!1,j.PARALLAXOCCLUSION=!1,j.PARALLAOBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&q.d.ReflectionTextureEnabled?(j.ENVIRONMENTBRDF=!0,j.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(j.ENVIRONMENTBRDF=!1,j.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?j.ALPHAFROMALBEDO=!0:j.ALPHAFROMALBEDO=!1}j.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===M.LIGHTFALLOFF_STANDARD?(j.USEPHYSICALLIGHTFALLOFF=!1,j.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===M.LIGHTFALLOFF_GLTF?(j.USEPHYSICALLIGHTFALLOFF=!1,j.USEGLTFLIGHTFALLOFF=!0):(j.USEPHYSICALLIGHTFALLOFF=!0,j.USEGLTFLIGHTFALLOFF=!1),j.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?j.TWOSIDEDLIGHTING=!0:j.TWOSIDEDLIGHTING=!1,j.SPECULARAA=Q.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(j._areTexturesDirty||j._areMiscDirty)&&(j.ALPHATESTVALUE="".concat(this._alphaCutOff).concat(this._alphaCutOff%1===0?".":""),j.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,j.ALPHABLEND=this.needAlphaBlendingForMesh(Z),j.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,j.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),j._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(j),j.FORCENORMALFORWARD=this._forceNormalForward,j.RADIANCEOCCLUSION=this._useRadianceOcclusion,j.HORIZONOCCLUSION=this._useHorizonOcclusion,j._areMiscDirty&&(W.b.PrepareDefinesForMisc(Z,Q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(Z)||this._forceAlphaTest,j),j.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!Z.isVerticesDataPresent(E.f.NormalKind),j.DEBUGMODE=this._debugMode),W.b.PrepareDefinesForFrameBoundValues(Q,Y,j,!!K,b,g),this._eventInfo.defines=j,this._eventInfo.mesh=Z,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),W.b.PrepareDefinesForAttributes(Z,j,!0,!0,!0,this._transparencyMode!==M.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)},M.prototype.forceCompilation=function(Z,M,j){var b=this,g=(0,K.e)({clipPlane:!1,useInstances:!1},j);this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(X.e.GetDefineNames,this._eventInfo);var O=new NZ(this._eventInfo.defineNames),Q=this._prepareEffect(Z,O,void 0,void 0,g.useInstances,g.clipPlane,Z.hasThinInstances);this._onEffectCreatedObservable&&(BZ.effect=Q,BZ.subMesh=null,this._onEffectCreatedObservable.notifyObservers(BZ)),Q.isReady()?M&&M(this):Q.onCompileObservable.add((function(){M&&M(b)}))},M.prototype.buildUniformLayout=function(){var M=this._uniformBuffer;M.addUniform("vAlbedoInfos",2),M.addUniform("vAmbientInfos",4),M.addUniform("vOpacityInfos",2),M.addUniform("vEmissiveInfos",2),M.addUniform("vLightmapInfos",2),M.addUniform("vReflectivityInfos",3),M.addUniform("vMicroSurfaceSamplerInfos",2),M.addUniform("vReflectionInfos",2),M.addUniform("vReflectionFilteringInfo",2),M.addUniform("vReflectionPosition",3),M.addUniform("vReflectionSize",3),M.addUniform("vBumpInfos",3),M.addUniform("albedoMatrix",16),M.addUniform("ambientMatrix",16),M.addUniform("opacityMatrix",16),M.addUniform("emissiveMatrix",16),M.addUniform("lightmapMatrix",16),M.addUniform("reflectivityMatrix",16),M.addUniform("microSurfaceSamplerMatrix",16),M.addUniform("bumpMatrix",16),M.addUniform("vTangentSpaceParams",2),M.addUniform("reflectionMatrix",16),M.addUniform("vReflectionColor",3),M.addUniform("vAlbedoColor",4),M.addUniform("vLightingIntensity",4),M.addUniform("vReflectionMicrosurfaceInfos",3),M.addUniform("pointSize",1),M.addUniform("vReflectivityColor",4),M.addUniform("vEmissiveColor",3),M.addUniform("vAmbientColor",3),M.addUniform("vDebugMode",2),M.addUniform("vMetallicReflectanceFactors",4),M.addUniform("vMetallicReflectanceInfos",2),M.addUniform("metallicReflectanceMatrix",16),M.addUniform("vReflectanceInfos",2),M.addUniform("reflectanceMatrix",16),M.addUniform("vSphericalL00",3),M.addUniform("vSphericalL1_1",3),M.addUniform("vSphericalL10",3),M.addUniform("vSphericalL11",3),M.addUniform("vSphericalL2_2",3),M.addUniform("vSphericalL2_1",3),M.addUniform("vSphericalL20",3),M.addUniform("vSphericalL21",3),M.addUniform("vSphericalL22",3),M.addUniform("vSphericalX",3),M.addUniform("vSphericalY",3),M.addUniform("vSphericalZ",3),M.addUniform("vSphericalXX_ZZ",3),M.addUniform("vSphericalYY_ZZ",3),M.addUniform("vSphericalZZ",3),M.addUniform("vSphericalXY",3),M.addUniform("vSphericalYZ",3),M.addUniform("vSphericalZX",3),Z.prototype.buildUniformLayout.call(this)},M.prototype.bindForSubMesh=function(Z,M,j){var K,b,g,O,Q=this.getScene(),I=j.materialDefines;if(I){var E=j.effect;if(E){this._activeEffect=E,M.getMeshUniformBuffer().bindToEffect(E,"Mesh"),M.transferToEffect(Z);var s=Q.getEngine();this._uniformBuffer.bindToEffect(E,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,Q,M,Z,this.isFrozen),this._eventInfo.subMesh=j,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),I.OBJECTSPACE_NORMALMAP&&(Z.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var i=this._mustRebind(Q,E,M.visibility);W.b.BindBonesParameters(M,this._activeEffect,this.prePassConfiguration);var a=null,z=this._uniformBuffer;if(i){if(this.bindViewProjection(E),a=this._getReflectionTexture(),!z.useUbo||!this.isFrozen||!z.isSync){if(Q.texturesEnabled){if(this._albedoTexture&&q.d.DiffuseTextureEnabled&&(z.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),W.b.BindTextureMatrix(this._albedoTexture,z,"albedo")),this._ambientTexture&&q.d.AmbientTextureEnabled&&(z.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),W.b.BindTextureMatrix(this._ambientTexture,z,"ambient")),this._opacityTexture&&q.d.OpacityTextureEnabled&&(z.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),W.b.BindTextureMatrix(this._opacityTexture,z,"opacity")),a&&q.d.ReflectionTextureEnabled){if(z.updateMatrix("reflectionMatrix",a.getReflectionTextureMatrix()),z.updateFloat2("vReflectionInfos",a.level,0),a.boundingBoxSize){var V=a;z.updateVector3("vReflectionPosition",V.boundingBoxPosition),z.updateVector3("vReflectionSize",V.boundingBoxSize)}if(this.realTimeFiltering){var G=a.getSize().width;z.updateFloat2("vReflectionFilteringInfo",G,c.b.Log2(G))}if(!I.USEIRRADIANCEMAP){var f=a.sphericalPolynomial;if(I.USESPHERICALFROMREFLECTIONMAP&&f)if(I.SPHERICAL_HARMONICS){var X=f.preScaledHarmonics;z.updateVector3("vSphericalL00",X.l00),z.updateVector3("vSphericalL1_1",X.l1_1),z.updateVector3("vSphericalL10",X.l10),z.updateVector3("vSphericalL11",X.l11),z.updateVector3("vSphericalL2_2",X.l2_2),z.updateVector3("vSphericalL2_1",X.l2_1),z.updateVector3("vSphericalL20",X.l20),z.updateVector3("vSphericalL21",X.l21),z.updateVector3("vSphericalL22",X.l22)}else z.updateFloat3("vSphericalX",f.x.x,f.x.y,f.x.z),z.updateFloat3("vSphericalY",f.y.x,f.y.y,f.y.z),z.updateFloat3("vSphericalZ",f.z.x,f.z.y,f.z.z),z.updateFloat3("vSphericalXX_ZZ",f.xx.x-f.zz.x,f.xx.y-f.zz.y,f.xx.z-f.zz.z),z.updateFloat3("vSphericalYY_ZZ",f.yy.x-f.zz.x,f.yy.y-f.zz.y,f.yy.z-f.zz.z),z.updateFloat3("vSphericalZZ",f.zz.x,f.zz.y,f.zz.z),z.updateFloat3("vSphericalXY",f.xy.x,f.xy.y,f.xy.z),z.updateFloat3("vSphericalYZ",f.yz.x,f.yz.y,f.yz.z),z.updateFloat3("vSphericalZX",f.zx.x,f.zx.y,f.zx.z)}z.updateFloat3("vReflectionMicrosurfaceInfos",a.getSize().width,a.lodGenerationScale,a.lodGenerationOffset)}this._emissiveTexture&&q.d.EmissiveTextureEnabled&&(z.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),W.b.BindTextureMatrix(this._emissiveTexture,z,"emissive")),this._lightmapTexture&&q.d.LightmapTextureEnabled&&(z.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),W.b.BindTextureMatrix(this._lightmapTexture,z,"lightmap")),q.d.SpecularTextureEnabled&&(this._metallicTexture?(z.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),W.b.BindTextureMatrix(this._metallicTexture,z,"reflectivity")):this._reflectivityTexture&&(z.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),W.b.BindTextureMatrix(this._reflectivityTexture,z,"reflectivity")),this._metallicReflectanceTexture&&(z.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),W.b.BindTextureMatrix(this._metallicReflectanceTexture,z,"metallicReflectance")),this._reflectanceTexture&&I.REFLECTANCE&&(z.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),W.b.BindTextureMatrix(this._reflectanceTexture,z,"reflectance")),this._microSurfaceTexture&&(z.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),W.b.BindTextureMatrix(this._microSurfaceTexture,z,"microSurfaceSampler"))),this._bumpTexture&&s.getCaps().standardDerivatives&&q.d.BumpTextureEnabled&&!this._disableBumpMap&&(z.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),W.b.BindTextureMatrix(this._bumpTexture,z,"bump"),Q._mirroredCameraPosition?z.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):z.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&z.updateFloat("pointSize",this.pointSize),I.METALLICWORKFLOW){o.h.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,o.h.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,z.updateColor4("vReflectivityColor",o.h.Color3[0],1);var d=null!==(b=null===(K=this.subSurface)||void 0===K?void 0:K._indexOfRefraction)&&void 0!==b?b:1.5,A=Math.pow((d-1)/(d+1),2);this._metallicReflectanceColor.scaleToRef(A*this._metallicF0Factor,o.h.Color3[0]);var T=this._metallicF0Factor;z.updateColor4("vMetallicReflectanceFactors",o.h.Color3[0],T)}else z.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);z.updateColor3("vEmissiveColor",q.d.EmissiveTextureEnabled?this._emissiveColor:o.e.BlackReadOnly),z.updateColor3("vReflectionColor",this._reflectionColor),!I.SS_REFRACTION&&(null===(g=this.subSurface)||void 0===g?void 0:g._linkRefractionWithTransparency)?z.updateColor4("vAlbedoColor",this._albedoColor,1):z.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*Q.environmentIntensity,this._lightingInfos.w=this._specularIntensity,z.updateVector4("vLightingIntensity",this._lightingInfos),Q.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),z.updateColor3("vAmbientColor",this._globalAmbientColor),z.updateFloat2("vDebugMode",this._debugLimit,this._debugFactor)}Q.texturesEnabled&&(this._albedoTexture&&q.d.DiffuseTextureEnabled&&z.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&q.d.AmbientTextureEnabled&&z.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&q.d.OpacityTextureEnabled&&z.setTexture("opacitySampler",this._opacityTexture),a&&q.d.ReflectionTextureEnabled&&(I.LODBASEDMICROSFURACE?z.setTexture("reflectionSampler",a):(z.setTexture("reflectionSampler",a._lodTextureMid||a),z.setTexture("reflectionSamplerLow",a._lodTextureLow||a),z.setTexture("reflectionSamplerHigh",a._lodTextureHigh||a)),I.USEIRRADIANCEMAP&&z.setTexture("irradianceSampler",a.irradianceTexture)),I.ENVIRONMENTBRDF&&z.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&q.d.EmissiveTextureEnabled&&z.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&q.d.LightmapTextureEnabled&&z.setTexture("lightmapSampler",this._lightmapTexture),q.d.SpecularTextureEnabled&&(this._metallicTexture?z.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&z.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&z.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&I.REFLECTANCE&&z.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&z.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&s.getCaps().standardDerivatives&&q.d.BumpTextureEnabled&&!this._disableBumpMap&&z.setTexture("bumpSampler",this._bumpTexture)),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(M)&&this.getScene().depthPeelingRenderer.bind(E),this._eventInfo.subMesh=j,this._callbackPluginEventBindForSubMesh(this._eventInfo),W.b.BindClipPlane(this._activeEffect,Q),this.bindEyePosition(E)}else Q.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!i&&this.isFrozen||(Q.lightsEnabled&&!this._disableLighting&&W.b.BindLights(Q,M,this._activeEffect,I,this._maxSimultaneousLights),(Q.fogEnabled&&M.applyFog&&Q.fogMode!==Y.c.FOGMODE_NONE||a||M.receiveShadows||I.PREPASS)&&this.bindView(E),W.b.BindFogParameters(Q,M,this._activeEffect,!0),I.NUM_MORPH_INFLUENCERS&&W.b.BindMorphTargetParameters(M,this._activeEffect),I.BAKED_VERTEX_ANIMATION_TEXTURE&&(null===(O=M.bakedVertexAnimationManager)||void 0===O||O.bind(E,I.INSTANCES)),this._imageProcessingConfiguration.bind(this._activeEffect),W.b.BindLogDepth(I,this._activeEffect,Q)),this._afterBind(M,this._activeEffect),z.update()}}},M.prototype.getAnimatables=function(){var M=Z.prototype.getAnimatables.call(this);return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&M.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&M.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&M.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&M.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&M.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?M.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&M.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&M.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&M.push(this._lightmapTexture),M},M.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},M.prototype.getActiveTextures=function(){var M=Z.prototype.getActiveTextures.call(this);return this._albedoTexture&&M.push(this._albedoTexture),this._ambientTexture&&M.push(this._ambientTexture),this._opacityTexture&&M.push(this._opacityTexture),this._reflectionTexture&&M.push(this._reflectionTexture),this._emissiveTexture&&M.push(this._emissiveTexture),this._reflectivityTexture&&M.push(this._reflectivityTexture),this._metallicTexture&&M.push(this._metallicTexture),this._metallicReflectanceTexture&&M.push(this._metallicReflectanceTexture),this._reflectanceTexture&&M.push(this._reflectanceTexture),this._microSurfaceTexture&&M.push(this._microSurfaceTexture),this._bumpTexture&&M.push(this._bumpTexture),this._lightmapTexture&&M.push(this._lightmapTexture),M},M.prototype.hasTexture=function(M){return!!Z.prototype.hasTexture.call(this,M)||(this._albedoTexture===M||(this._ambientTexture===M||(this._opacityTexture===M||(this._reflectionTexture===M||(this._reflectivityTexture===M||(this._metallicTexture===M||(this._metallicReflectanceTexture===M||(this._reflectanceTexture===M||(this._microSurfaceTexture===M||(this._bumpTexture===M||this._lightmapTexture===M))))))))))},M.prototype.setPrePassRenderer=function(){var Z;if(null===(Z=this.subSurface)||void 0===Z?void 0:Z.isScatteringEnabled){var M=this.getScene().enableSubSurfaceForPrePass();return M&&(M.enabled=!0),!0}return!1},M.prototype.dispose=function(M,j){var K,b,g,O,Q,Y,I,E,s,i,a,z;j&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(K=this._albedoTexture)||void 0===K||K.dispose(),null===(b=this._ambientTexture)||void 0===b||b.dispose(),null===(g=this._opacityTexture)||void 0===g||g.dispose(),null===(O=this._reflectionTexture)||void 0===O||O.dispose(),null===(Q=this._emissiveTexture)||void 0===Q||Q.dispose(),null===(Y=this._metallicTexture)||void 0===Y||Y.dispose(),null===(I=this._reflectivityTexture)||void 0===I||I.dispose(),null===(E=this._bumpTexture)||void 0===E||E.dispose(),null===(s=this._lightmapTexture)||void 0===s||s.dispose(),null===(i=this._metallicReflectanceTexture)||void 0===i||i.dispose(),null===(a=this._reflectanceTexture)||void 0===a||a.dispose(),null===(z=this._microSurfaceTexture)||void 0===z||z.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),Z.prototype.dispose.call(this,M,j)},M.PBRMATERIAL_OPAQUE=f.d.MATERIAL_OPAQUE,M.PBRMATERIAL_ALPHATEST=f.d.MATERIAL_ALPHATEST,M.PBRMATERIAL_ALPHABLEND=f.d.MATERIAL_ALPHABLEND,M.PBRMATERIAL_ALPHATESTANDBLEND=f.d.MATERIAL_ALPHATESTANDBLEND,M.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,M.LIGHTFALLOFF_PHYSICAL=0,M.LIGHTFALLOFF_GLTF=1,M.LIGHTFALLOFF_STANDARD=2,(0,K.l)([(0,b.m)()],M.prototype,"_imageProcessingConfiguration",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsMiscDirty")],M.prototype,"debugMode",void 0),(0,K.l)([(0,b.z)()],M.prototype,"useLogarithmicDepth",null),M}(d.e)},76384:function(Z,M,j){"use strict";j.d(M,{e:function(){return E}});var K=j(40061),b=j(9892),g=j(9271),O=j(80105),Q=j(78588),Y=j(28372),I=(j(82790),j(2111)),E=function(Z){function M(j){var K=Z.call(this,null)||this;return K.metadata=null,K.reservedDataStore=null,K._hasAlpha=!1,K._getAlphaFromRGB=!1,K.level=1,K._coordinatesIndex=0,K._coordinatesMode=0,K.wrapR=1,K.anisotropicFilteringLevel=M.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,K._isCube=!1,K._gammaSpace=!0,K.invertZ=!1,K.lodLevelInAlpha=!1,K.isRenderTarget=!1,K._prefiltered=!1,K._forceSerialize=!1,K.animations=new Array,K.onDisposeObservable=new g.b,K._onDisposeObserver=null,K._scene=null,K._uid=null,K._parentContainer=null,K._loadingError=!1,j?M._IsScene(j)?K._scene=j:K._engine=j:K._scene=Q.e.LastCreatedScene,K._scene&&(K.uniqueId=K._scene.getUniqueId(),K._scene.addTexture(K),K._engine=K._scene.getEngine()),K._uid=null,K}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(Z){var M=this;this._hasAlpha!==Z&&(this._hasAlpha=Z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(Z){return Z.hasTexture(M)})))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"getAlphaFromRGB",{get:function(){return this._getAlphaFromRGB},set:function(Z){var M=this;this._getAlphaFromRGB!==Z&&(this._getAlphaFromRGB=Z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(Z){return Z.hasTexture(M)})))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"coordinatesIndex",{get:function(){return this._coordinatesIndex},set:function(Z){var M=this;this._coordinatesIndex!==Z&&(this._coordinatesIndex=Z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(Z){return Z.hasTexture(M)})))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(Z){var M=this;this._coordinatesMode!==Z&&(this._coordinatesMode=Z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(Z){return Z.hasTexture(M)})))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wrapU",{get:function(){return this._wrapU},set:function(Z){this._wrapU=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"wrapV",{get:function(){return this._wrapV},set:function(Z){this._wrapV=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(Z){this._texture?this._texture.isCube=Z:this._isCube=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(Z){this._texture&&(this._texture.is3D=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(Z){this._texture&&(this._texture.is2DArray=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"gammaSpace",{get:function(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace},set:function(Z){if(this._texture){if(this._texture._gammaSpace===Z)return;this._texture._gammaSpace=Z}else{if(this._gammaSpace===Z)return;this._gammaSpace=Z}this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(Z){this._texture&&(this._texture._isRGBD=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(Z){this._texture&&(this._texture._lodGenerationOffset=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(Z){this._texture&&(this._texture._lodGenerationScale=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(Z){this._texture&&(this._texture._linearSpecularLOD=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(Z){this._texture&&(this._texture._irradianceTexture=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"uid",{get:function(){return this._uid||(this._uid=(0,Y.d)()),this._uid},enumerable:!1,configurable:!0}),M.prototype.toString=function(){return this.name},M.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(M.prototype,"onDispose",{set:function(Z){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"loadingError",{get:function(){return this._loadingError},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!1,configurable:!0}),M.prototype.getScene=function(){return this._scene},M.prototype._getEngine=function(){return this._engine},M.prototype.checkTransformsAreIdentical=function(Z){return null!==Z},M.prototype.getTextureMatrix=function(){return O.c.IdentityReadOnly},M.prototype.getReflectionTextureMatrix=function(){return O.c.IdentityReadOnly},M.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()||this.loadingError},M.prototype.scale=function(Z){},Object.defineProperty(M.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),M.prototype._getFromCache=function(Z,M,j,K,b,g){var O=this._getEngine();if(!O)return null;for(var Q=O._getUseSRGBBuffer(!!b,M),Y=O.getLoadedTexturesCache(),I=0;I<Y.length;I++){var E=Y[I];if((void 0===b||Q===E._useSRGBBuffer)&&(void 0===K||K===E.invertY)&&E.url===Z&&E.generateMipMaps===!M&&(!j||j===E.samplingMode)&&(void 0===g||g===E.isCube))return E.incrementReferences(),E}return null},M.prototype._rebuild=function(){},M.prototype.clone=function(){return null},Object.defineProperty(M.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:5},enumerable:!1,configurable:!0}),M.prototype._markAllSubMeshesAsTexturesDirty=function(){var Z=this.getScene();Z&&Z.markAllMaterialsAsDirty(1)},M.prototype.readPixels=function(Z,M,j,K,b,g,O,Q,Y){if(void 0===Z&&(Z=0),void 0===M&&(M=0),void 0===j&&(j=null),void 0===K&&(K=!0),void 0===b&&(b=!1),void 0===g&&(g=0),void 0===O&&(O=0),void 0===Q&&(Q=Number.MAX_VALUE),void 0===Y&&(Y=Number.MAX_VALUE),!this._texture)return null;var I=this._getEngine();if(!I)return null;var E=this.getSize(),s=E.width,i=E.height;0!==M&&(s/=Math.pow(2,M),i/=Math.pow(2,M),s=Math.round(s),i=Math.round(i)),Q=Math.min(s,Q),Y=Math.min(i,Y);try{return this._texture.isCube?I._readTexturePixels(this._texture,Q,Y,Z,M,j,K,b,g,O):I._readTexturePixels(this._texture,Q,Y,-1,M,j,K,b,g,O)}catch(Z){return null}},M.prototype._readPixelsSync=function(Z,M,j,K,b){if(void 0===Z&&(Z=0),void 0===M&&(M=0),void 0===j&&(j=null),void 0===K&&(K=!0),void 0===b&&(b=!1),!this._texture)return null;var g=this.getSize(),O=g.width,Q=g.height,Y=this._getEngine();if(!Y)return null;0!=M&&(O/=Math.pow(2,M),Q/=Math.pow(2,M),O=Math.round(O),Q=Math.round(Q));try{return this._texture.isCube?Y._readTexturePixelsSync(this._texture,O,Q,Z,M,j,K,b):Y._readTexturePixelsSync(this._texture,O,Q,-1,M,j,K,b)}catch(Z){return null}},Object.defineProperty(M.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),M.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var M=this._scene.textures.indexOf(this);if(M>=0&&this._scene.textures.splice(M,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){var j=this._parentContainer.textures.indexOf(this);j>-1&&this._parentContainer.textures.splice(j,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,Z.prototype.dispose.call(this)},M.prototype.serialize=function(){if(!this.name)return null;var Z=b.b.Serialize(this);return b.b.AppendSerializedAnimations(this,Z),Z},M.WhenAllReady=function(Z,M){var j=Z.length;if(0!==j)for(var K=0;K<Z.length;K++){var b=Z[K];if(b.isReady())0===--j&&M();else{var g=b.onLoadObservable;g?g.addOnce((function(){0===--j&&M()})):0===--j&&M()}}else M()},M._IsScene=function(Z){return"Scene"===Z.getClassName()},M.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,K.l)([(0,b.z)()],M.prototype,"uniqueId",void 0),(0,K.l)([(0,b.z)()],M.prototype,"name",void 0),(0,K.l)([(0,b.z)()],M.prototype,"metadata",void 0),(0,K.l)([(0,b.z)("hasAlpha")],M.prototype,"_hasAlpha",void 0),(0,K.l)([(0,b.z)("getAlphaFromRGB")],M.prototype,"_getAlphaFromRGB",void 0),(0,K.l)([(0,b.z)()],M.prototype,"level",void 0),(0,K.l)([(0,b.z)("coordinatesIndex")],M.prototype,"_coordinatesIndex",void 0),(0,K.l)([(0,b.z)("coordinatesMode")],M.prototype,"_coordinatesMode",void 0),(0,K.l)([(0,b.z)()],M.prototype,"wrapU",null),(0,K.l)([(0,b.z)()],M.prototype,"wrapV",null),(0,K.l)([(0,b.z)()],M.prototype,"wrapR",void 0),(0,K.l)([(0,b.z)()],M.prototype,"anisotropicFilteringLevel",void 0),(0,K.l)([(0,b.z)()],M.prototype,"isCube",null),(0,K.l)([(0,b.z)()],M.prototype,"is3D",null),(0,K.l)([(0,b.z)()],M.prototype,"is2DArray",null),(0,K.l)([(0,b.z)()],M.prototype,"gammaSpace",null),(0,K.l)([(0,b.z)()],M.prototype,"invertZ",void 0),(0,K.l)([(0,b.z)()],M.prototype,"lodLevelInAlpha",void 0),(0,K.l)([(0,b.z)()],M.prototype,"lodGenerationOffset",null),(0,K.l)([(0,b.z)()],M.prototype,"lodGenerationScale",null),(0,K.l)([(0,b.z)()],M.prototype,"linearSpecularLOD",null),(0,K.l)([(0,b.s)()],M.prototype,"irradianceTexture",null),(0,K.l)([(0,b.z)()],M.prototype,"isRenderTarget",void 0),M}(function(){function Z(Z){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=I.b.Zero(),this._cachedBaseSize=I.b.Zero(),this._initialSamplingMode=2,this._texture=Z,this._texture&&(this._engine=this._texture.getEngine())}return Object.defineProperty(Z.prototype,"wrapU",{get:function(){return this._wrapU},set:function(Z){this._wrapU=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"wrapV",{get:function(){return this._wrapV},set:function(Z){this._wrapV=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(Z){this._texture&&(this._texture.isCube=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(Z){this._texture&&(this._texture.is3D=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(Z){this._texture&&(this._texture.is2DArray=Z)},enumerable:!1,configurable:!0}),Z.prototype.getClassName=function(){return"ThinTexture"},Z.prototype.isReady=function(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},Z.prototype.delayLoad=function(){},Z.prototype.getInternalTexture=function(){return this._texture},Z.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},Z.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)},Object.defineProperty(Z.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),Z.prototype.updateSamplingMode=function(Z){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(Z,this._texture)},Z.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Z.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},Z}())},28689:function(Z,M,j){"use strict";var K=j(80105),b=j(96658),g=j(37094),O=j(61686),Q=j(9488),Y=function(Z,M,j,K){this.name=Z,this.worldAxisForNormal=M,this.worldAxisForFileX=j,this.worldAxisForFileY=K},I=function(){function Z(){}return Z.ConvertCubeMapTextureToSphericalPolynomial=function(Z){var M,j=this;if(!Z.isCube)return null;null===(M=Z.getScene())||void 0===M||M.getEngine().flushFramebuffer();var K,b,g=Z.getSize().width,O=Z.readPixels(0,void 0,void 0,!1),Q=Z.readPixels(1,void 0,void 0,!1);Z.isRenderTarget?(K=Z.readPixels(3,void 0,void 0,!1),b=Z.readPixels(2,void 0,void 0,!1)):(K=Z.readPixels(2,void 0,void 0,!1),b=Z.readPixels(3,void 0,void 0,!1));var Y=Z.readPixels(4,void 0,void 0,!1),I=Z.readPixels(5,void 0,void 0,!1),E=Z.gammaSpace,s=0;return 1!=Z.textureType&&2!=Z.textureType||(s=1),new Promise((function(Z){Promise.all([Q,O,K,b,Y,I]).then((function(M){var K=M[0],b=M[1],O=M[2],Q=M[3],Y=M[4],I=M[5],i={size:g,right:b,left:K,up:O,down:Q,front:Y,back:I,format:5,type:s,gammaSpace:E};Z(j.ConvertCubeMapToSphericalPolynomial(i))}))}))},Z._AreaElement=function(Z,M){return Math.atan2(Z*M,Math.sqrt(Z*Z+M*M+1))},Z.ConvertCubeMapToSphericalPolynomial=function(Z){for(var M=new g.c,j=0,K=2/Z.size,Y=K,I=.5*K,E=I-1,s=0;s<6;s++)for(var i=this._FileFaces[s],a=Z[i.name],z=E,V=5===Z.format?4:3,o=0;o<Z.size;o++){for(var c=E,G=0;G<Z.size;G++){var f=i.worldAxisForFileX.scale(c).add(i.worldAxisForFileY.scale(z)).add(i.worldAxisForNormal);f.normalize();var X=this._AreaElement(c-I,z-I)-this._AreaElement(c-I,z+I)-this._AreaElement(c+I,z-I)+this._AreaElement(c+I,z+I),d=a[o*Z.size*V+G*V+0],W=a[o*Z.size*V+G*V+1],A=a[o*Z.size*V+G*V+2];isNaN(d)&&(d=0),isNaN(W)&&(W=0),isNaN(A)&&(A=0),0===Z.type&&(d/=255,W/=255,A/=255),Z.gammaSpace&&(d=Math.pow(b.b.Clamp(d),O.i),W=Math.pow(b.b.Clamp(W),O.i),A=Math.pow(b.b.Clamp(A),O.i));var q=4096;d=b.b.Clamp(d,0,q),W=b.b.Clamp(W,0,q),A=b.b.Clamp(A,0,q);var T=new Q.e(d,W,A);M.addLight(f,T,X),j+=X,c+=K}z+=Y}var B=6*(4*Math.PI)/6/j;return M.scaleInPlace(B),M.convertIncidentRadianceToIrradiance(),M.convertIrradianceToLambertianRadiance(),g.f.FromHarmonics(M)},Z._FileFaces=[new Y("right",new K.k(1,0,0),new K.k(0,0,-1),new K.k(0,-1,0)),new Y("left",new K.k(-1,0,0),new K.k(0,0,1),new K.k(0,-1,0)),new Y("up",new K.k(0,1,0),new K.k(1,0,0),new K.k(0,0,1)),new Y("down",new K.k(0,-1,0),new K.k(1,0,0),new K.k(0,0,-1)),new Y("front",new K.k(0,0,1),new K.k(1,0,0),new K.k(0,-1,0)),new Y("back",new K.k(0,0,-1),new K.k(-1,0,0),new K.k(0,-1,0))],Z}(),E=j(76384);E.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(E.e.prototype,"sphericalPolynomial",{get:function(){var Z=this;if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=I.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((function(M){Z._texture._sphericalPolynomial=M,Z._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(Z){this._texture&&(this._texture._sphericalPolynomial=Z)},enumerable:!0,configurable:!0})},16708:function(Z,M,j){"use strict";j.d(M,{c:function(){return o}});var K=j(40061),b=j(9892),g=j(9217),O=j(80105),Q=j(76384),Y=j(70937),I=j(31709),E=j(72284),s=j(60766),i=j(9127),a=j(82790),z=j(28372);E.d.prototype._createDepthStencilCubeTexture=function(Z,M,j){var b=new s.h(this,s.e.DepthStencil);if(b.isCube=!0,1===this.webGLVersion)return i.c.Error("Depth cube texture is not supported by WebGL 1."),b;var g=(0,K.e)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},M),O=this._gl;this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,b,!0),this._setupDepthStencilTexture(b,Z,g.generateStencil,g.bilinearFiltering,g.comparisonFunction),j._depthStencilTexture=b,j._depthStencilTextureWithStencil=g.generateStencil;for(var Q=0;Q<6;Q++)g.generateStencil?O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,O.DEPTH24_STENCIL8,Z,Z,0,O.DEPTH_STENCIL,O.UNSIGNED_INT_24_8,null):O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,O.DEPTH_COMPONENT24,Z,Z,0,O.DEPTH_COMPONENT,O.UNSIGNED_INT,null);return this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(b),b},E.d.prototype._partialLoadFile=function(Z,M,j,K,b){void 0===b&&(b=null);this._loadFile(Z,(function(Z){j[M]=Z,j._internalCount++,6===j._internalCount&&K(j)}),void 0,void 0,!0,(function(Z,M){b&&Z&&b(Z.status+" "+Z.statusText,M)}))},E.d.prototype._cascadeLoadFiles=function(Z,M,j,K){void 0===K&&(K=null);var b=[];b._internalCount=0;for(var g=0;g<6;g++)this._partialLoadFile(j[g],g,b,M,K)},E.d.prototype._cascadeLoadImgs=function(Z,M,j,K,b,g){void 0===b&&(b=null);var O=[];O._internalCount=0;for(var Q=0;Q<6;Q++)this._partialLoadImg(K[Q],Q,O,Z,M,j,b,g)},E.d.prototype._partialLoadImg=function(Z,M,j,K,b,g,O,Q){void 0===O&&(O=null);var Y=(0,z.d)();(0,a.i)(Z,(function(Z){j[M]=Z,j._internalCount++,K&&K._removePendingData(Y),6===j._internalCount&&g&&g(b,j)}),(function(Z,M){K&&K._removePendingData(Y),O&&O(Z,M)}),K?K.offlineProvider:null,Q),K&&K._addPendingData(Y)},E.d.prototype._setCubeMapTextureParams=function(Z,M,j){var K=this._gl;K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,M?K.LINEAR_MIPMAP_LINEAR:K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),Z.samplingMode=M?3:2,M&&this.getCaps().textureMaxLevel&&void 0!==j&&j>0&&(K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAX_LEVEL,j),Z._maxLodLevel=j),this._bindTextureDirectly(K.TEXTURE_CUBE_MAP,null)},E.d.prototype.createCubeTextureBase=function(Z,M,j,K,b,g,O,Q,Y,I,a,z,V,o,c){var G=this;void 0===b&&(b=null),void 0===g&&(g=null),void 0===Q&&(Q=null),void 0===Y&&(Y=!1),void 0===I&&(I=0),void 0===a&&(a=0),void 0===z&&(z=null),void 0===V&&(V=null),void 0===o&&(o=null),void 0===c&&(c=!1);var f=z||new s.h(this,s.e.Cube);f.isCube=!0,f.url=Z,f.generateMipMaps=!K,f._lodGenerationScale=I,f._lodGenerationOffset=a,f._useSRGBBuffer=!!c&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||!!K),this._doNotHandleContextLost||(f._extension=Q,f._files=j);var X=Z;this._transformTextureUrl&&!z&&(Z=this._transformTextureUrl(Z));for(var d=Z.lastIndexOf("."),W=Q||(d>-1?Z.substring(d).toLowerCase():""),A=null,q=0,T=E.d._TextureLoaders;q<T.length;q++){var B=T[q];if(B.canLoad(W)){A=B;break}}if(A){var N=function(Z){V&&V(f,Z),A.loadCubeData(Z,f,Y,b,g)};j&&6===j.length?A.supportCascades?this._cascadeLoadFiles(M,(function(Z){return N(Z.map((function(Z){return new Uint8Array(Z)})))}),j,g):g?g("Textures type does not support cascades."):i.c.Warn("Texture loader does not support cascades."):this._loadFile(Z,(function(Z){return N(new Uint8Array(Z))}),void 0,void 0,!0,(function(E,s){Z===X?g&&E&&g(E.status+" "+E.statusText,s):(i.c.Warn("Failed to load ".concat(Z,", falling back to the ").concat(X)),G.createCubeTextureBase(X,M,j,!!K,b,g,O,Q,Y,I,a,f,V,o,c))}))}else{if(!j)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(M,f,(function(Z,M){o&&o(Z,M)}),j,g)}return this._internalTexturesCache.push(f),f},E.d.prototype.createCubeTexture=function(Z,M,j,K,b,g,O,Q,Y,I,s,a,z,V){var o=this;void 0===b&&(b=null),void 0===g&&(g=null),void 0===Q&&(Q=null),void 0===Y&&(Y=!1),void 0===I&&(I=0),void 0===s&&(s=0),void 0===a&&(a=null),void 0===V&&(V=!1);var c=this._gl;return this.createCubeTextureBase(Z,M,j,!!K,b,g,O,Q,Y,I,s,a,(function(Z){return o._bindTextureDirectly(c.TEXTURE_CUBE_MAP,Z,!0)}),(function(Z,M){var j=o.needPOTTextures?E.d.GetExponentOfTwo(M[0].width,o._caps.maxCubemapTextureSize):M[0].width,g=j,Q=[c.TEXTURE_CUBE_MAP_POSITIVE_X,c.TEXTURE_CUBE_MAP_POSITIVE_Y,c.TEXTURE_CUBE_MAP_POSITIVE_Z,c.TEXTURE_CUBE_MAP_NEGATIVE_X,c.TEXTURE_CUBE_MAP_NEGATIVE_Y,c.TEXTURE_CUBE_MAP_NEGATIVE_Z];o._bindTextureDirectly(c.TEXTURE_CUBE_MAP,Z,!0),o._unpackFlipY(!1);var Y=O?o._getInternalFormat(O,Z._useSRGBBuffer):Z._useSRGBBuffer?c.SRGB8_ALPHA8:c.RGBA,I=O?o._getInternalFormat(O):c.RGBA;Z._useSRGBBuffer&&1===o.webGLVersion&&(I=Y);for(var s=0;s<Q.length;s++)if(M[s].width!==j||M[s].height!==g){if(o._prepareWorkingCanvas(),!o._workingCanvas||!o._workingContext)return void i.c.Warn("Cannot create canvas to resize texture.");o._workingCanvas.width=j,o._workingCanvas.height=g,o._workingContext.drawImage(M[s],0,0,M[s].width,M[s].height,0,0,j,g),c.texImage2D(Q[s],0,Y,I,c.UNSIGNED_BYTE,o._workingCanvas)}else c.texImage2D(Q[s],0,Y,I,c.UNSIGNED_BYTE,M[s]);K||c.generateMipmap(c.TEXTURE_CUBE_MAP),o._setCubeMapTextureParams(Z,!K),Z.width=j,Z.height=g,Z.isReady=!0,O&&(Z.format=O),Z.onLoadedObservable.notifyObservers(Z),Z.onLoadedObservable.clear(),b&&b()}),!!V)};var V=j(9271),o=function(Z){function M(M,j,K,b,g,Q,I,E,s,i,a,z,o,c,G){void 0===K&&(K=null),void 0===b&&(b=!1),void 0===g&&(g=null),void 0===Q&&(Q=null),void 0===I&&(I=null),void 0===E&&(E=5),void 0===s&&(s=!1),void 0===i&&(i=null),void 0===a&&(a=!1),void 0===z&&(z=.8),void 0===o&&(o=0);var f,X=this;return(X=Z.call(this,j)||this)._lodScale=.8,X._lodOffset=0,X.onLoadObservable=new V.b,X.boundingBoxPosition=O.k.Zero(),X._rotationY=0,X._files=null,X._forcedExtension=null,X._extensions=null,X.name=M,X.url=M,X._noMipmap=b,X.hasAlpha=!1,X._format=E,X.isCube=!0,X._textureMatrix=O.c.Identity(),X._createPolynomials=a,X.coordinatesMode=Y.b.CUBIC_MODE,X._extensions=K,X._files=g,X._forcedExtension=i,X._loaderOptions=c,X._useSRGBBuffer=G,X._lodScale=z,X._lodOffset=o,M||g?(X.updateURL(M,i,Q,s,I,K,null===(f=X.getScene())||void 0===f?void 0:f.useDelayedTextureLoading,g),X):X}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(Z){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(Z)){this._boundingBoxSize=Z;var M=this.getScene();M&&M.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"rotationY",{get:function(){return this._rotationY},set:function(Z){this._rotationY=Z,this.setReflectionTextureMatrix(O.c.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"forcedExtension",{get:function(){return this._forcedExtension},enumerable:!1,configurable:!0}),M.CreateFromImages=function(Z,j,K){var b="";return Z.forEach((function(Z){return b+=Z})),new M(b,j,null,K,Z)},M.CreateFromPrefilteredData=function(Z,j,K,b){void 0===K&&(K=null),void 0===b&&(b=!0);var g=j.useDelayedTextureLoading;j.useDelayedTextureLoading=!1;var O=new M(Z,j,null,!1,null,null,null,void 0,!0,K,b);return j.useDelayedTextureLoading=g,O},M.prototype.getClassName=function(){return"CubeTexture"},M.prototype.updateURL=function(Z,M,j,K,b,g,O,Q){void 0===j&&(j=null),void 0===K&&(K=!1),void 0===b&&(b=null),void 0===g&&(g=null),void 0===O&&(O=!1),void 0===Q&&(Q=null),this.name&&!this.name.startsWith("data:")||(this.name=Z),this.url=Z,M&&(this._forcedExtension=M);var Y=Z.lastIndexOf("."),I=M||(Y>-1?Z.substring(Y).toLowerCase():""),E=0===I.indexOf(".dds"),s=0===I.indexOf(".env");if(s?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=K,K&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),Q)this._files=Q;else if(s||E||g||(g=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,g){for(var i=0;i<g.length;i++)this._files.push(Z+g[i]);this._extensions=g}O?(this.delayLoadState=4,this._delayedOnLoad=j,this._delayedOnError=b):this._loadTexture(j,b)},M.prototype.delayLoad=function(Z){4===this.delayLoadState&&(Z&&(this._forcedExtension=Z),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))},M.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},M.prototype.setReflectionTextureMatrix=function(Z){var M,j=this;Z.updateFlag!==this._textureMatrix.updateFlag&&(Z.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(M=this.getScene())||void 0===M||M.markAllMaterialsAsDirty(1,(function(Z){return-1!==Z.getActiveTextures().indexOf(j)}))),this._textureMatrix=Z)},M.prototype._loadTexture=function(Z,M){var j,K=this;void 0===Z&&(Z=null),void 0===M&&(M=null);var b=this.getScene(),O=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);var Q=function(){var M;K.onLoadObservable.notifyObservers(K),O&&(O.dispose(),null===(M=K.getScene())||void 0===M||M.markAllMaterialsAsDirty(1)),Z&&Z()},I=function(Z,j){K._loadingError=!0,K._errorObject={message:Z,exception:j},M&&M(Z,j),Y.b.OnTextureLoadErrorObservable.notifyObservers(K)};this._texture?this._texture.isReady?g.d.SetImmediate((function(){return Q()})):this._texture.onLoadedObservable.add((function(){return Q()})):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,b,this._lodScale,this._lodOffset,Z,I,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,b,this._files,this._noMipmap,Z,I,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer),null===(j=this._texture)||void 0===j||j.onLoadedObservable.add((function(){return K.onLoadObservable.notifyObservers(K)})))},M.Parse=function(Z,j,K){var g=b.b.Parse((function(){var b=!1;return Z.prefiltered&&(b=Z.prefiltered),new M(K+Z.name,j,Z.extensions,!1,Z.files||null,null,null,void 0,b,Z.forcedExtension)}),Z,j);if(Z.boundingBoxPosition&&(g.boundingBoxPosition=O.k.FromArray(Z.boundingBoxPosition)),Z.boundingBoxSize&&(g.boundingBoxSize=O.k.FromArray(Z.boundingBoxSize)),Z.animations)for(var Q=0;Q<Z.animations.length;Q++){var Y=Z.animations[Q],E=(0,I.b)("BABYLON.Animation");E&&g.animations.push(E.Parse(Y))}return g},M.prototype.clone=function(){var Z=this,j=0,K=b.b.Clone((function(){var K=new M(Z.url,Z.getScene()||Z._getEngine(),Z._extensions,Z._noMipmap,Z._files);return j=K.uniqueId,K}),this);return K.uniqueId=j,K},(0,K.l)([(0,b.z)()],M.prototype,"url",void 0),(0,K.l)([(0,b.z)("rotationY")],M.prototype,"rotationY",null),(0,K.l)([(0,b.z)("files")],M.prototype,"_files",void 0),(0,K.l)([(0,b.z)("forcedExtension")],M.prototype,"_forcedExtension",void 0),(0,K.l)([(0,b.z)("extensions")],M.prototype,"_extensions",void 0),(0,K.l)([(0,b.n)("textureMatrix")],M.prototype,"_textureMatrix",void 0),M}(Q.e);Y.b._CubeTextureParser=o.Parse,(0,I.c)("BABYLON.CubeTexture",o)},90673:function(Z,M,j){"use strict";j.d(M,{d:function(){return Y}});var K=j(40061),b=j(9127),g=j(70937),O=j(72284),Q=j(60766);O.d.prototype.createDynamicTexture=function(Z,M,j,K){var b=new Q.h(this,Q.e.Dynamic);return b.baseWidth=Z,b.baseHeight=M,j&&(Z=this.needPOTTextures?O.d.GetExponentOfTwo(Z,this._caps.maxTextureSize):Z,M=this.needPOTTextures?O.d.GetExponentOfTwo(M,this._caps.maxTextureSize):M),b.width=Z,b.height=M,b.isReady=!1,b.generateMipMaps=j,b.samplingMode=K,this.updateTextureSamplingMode(K,b),this._internalTexturesCache.push(b),b},O.d.prototype.updateDynamicTexture=function(Z,M,j,K,b,g,O){if(void 0===K&&(K=!1),void 0===g&&(g=!1),void 0===O&&(O=!1),Z){var Q=this._gl,Y=Q.TEXTURE_2D,I=this._bindTextureDirectly(Y,Z,!0,g);this._unpackFlipY(void 0===j?Z.invertY:j),K&&Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var E=this._getWebGLTextureType(Z.type),s=this._getInternalFormat(b||Z.format),i=this._getRGBABufferInternalSizedFormat(Z.type,s);Q.texImage2D(Y,0,i,s,E,M),Z.generateMipMaps&&Q.generateMipmap(Y),I||this._bindTextureDirectly(Y,null),K&&Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Z.isReady=!0}};var Y=function(Z){function M(M,j,K,b,O,Q,Y){void 0===K&&(K=null),void 0===b&&(b=!1),void 0===O&&(O=3),void 0===Q&&(Q=5);var I=Z.call(this,null,K,!b,Y,O,void 0,void 0,void 0,void 0,Q)||this;I.name=M,I.wrapU=g.b.CLAMP_ADDRESSMODE,I.wrapV=g.b.CLAMP_ADDRESSMODE,I._generateMipMaps=b;var E=I._getEngine();if(!E)return I;j.getContext?(I._canvas=j,I._texture=E.createDynamicTexture(j.width,j.height,b,O)):(I._canvas=E.createCanvas(1,1),j.width||0===j.width?I._texture=E.createDynamicTexture(j.width,j.height,b,O):I._texture=E.createDynamicTexture(j,j,b,O));var s=I.getSize();return I._canvas.width!==s.width&&(I._canvas.width=s.width),I._canvas.height!==s.height&&(I._canvas.height=s.height),I._context=I._canvas.getContext("2d"),I}return(0,K.m)(M,Z),M.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(M.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),M.prototype._recreate=function(Z){this._canvas.width=Z.width,this._canvas.height=Z.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(Z.width,Z.height,this._generateMipMaps,this.samplingMode)},M.prototype.scale=function(Z){var M=this.getSize();M.width*=Z,M.height*=Z,this._recreate(M)},M.prototype.scaleTo=function(Z,M){var j=this.getSize();j.width=Z,j.height=M,this._recreate(j)},M.prototype.getContext=function(){return this._context},M.prototype.clear=function(){var Z=this.getSize();this._context.fillRect(0,0,Z.width,Z.height)},M.prototype.update=function(Z,M,j){void 0===M&&(M=!1),void 0===j&&(j=!1),this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===Z||Z,M,this._format||void 0,void 0,j)},M.prototype.drawText=function(Z,M,j,K,b,g,O,Q){void 0===Q&&(Q=!0);var Y=this.getSize();if(g&&(this._context.fillStyle=g,this._context.fillRect(0,0,Y.width,Y.height)),this._context.font=K,null===M||void 0===M){var I=this._context.measureText(Z);M=(Y.width-I.width)/2}if(null===j||void 0===j){var E=parseInt(K.replace(/\D/g,""));j=Y.height/2+E/3.65}this._context.fillStyle=b||"",this._context.fillText(Z,M,j),Q&&this.update(O)},M.prototype.clone=function(){var Z=this.getScene();if(!Z)return this;var j=this.getSize(),K=new M(this.name,j,Z,this._generateMipMaps);return K.hasAlpha=this.hasAlpha,K.level=this.level,K.wrapU=this.wrapU,K.wrapV=this.wrapV,K},M.prototype.serialize=function(){var j=this.getScene();j&&!j.isReady()&&b.c.Warn("The scene must be ready before serializing the dynamic texture");var K=Z.prototype.serialize.call(this);return M._IsCanvasElement(this._canvas)&&(K.base64String=this._canvas.toDataURL()),K.invertY=this._invertY,K.samplingMode=this.samplingMode,K},M._IsCanvasElement=function(Z){return void 0!==Z.toDataURL},M.prototype._rebuild=function(){this.update()},M}(g.b)},60766:function(Z,M,j){"use strict";j.d(M,{e:function(){return K},h:function(){return Q}});var K,b=j(40061),g=j(9271),O=j(80150);!function(Z){Z[Z.Unknown=0]="Unknown",Z[Z.Url=1]="Url",Z[Z.Temp=2]="Temp",Z[Z.Raw=3]="Raw",Z[Z.Dynamic=4]="Dynamic",Z[Z.RenderTarget=5]="RenderTarget",Z[Z.MultiRenderTarget=6]="MultiRenderTarget",Z[Z.Cube=7]="Cube",Z[Z.CubeRaw=8]="CubeRaw",Z[Z.CubePrefiltered=9]="CubePrefiltered",Z[Z.Raw3D=10]="Raw3D",Z[Z.Raw2DArray=11]="Raw2DArray",Z[Z.DepthStencil=12]="DepthStencil",Z[Z.CubeRawRGBD=13]="CubeRawRGBD",Z[Z.Depth=14]="Depth"}(K||(K={}));var Q=function(Z){function M(j,b,O){void 0===O&&(O=!1);var Q=Z.call(this)||this;return Q.isReady=!1,Q.isCube=!1,Q.is3D=!1,Q.is2DArray=!1,Q.isMultiview=!1,Q.url="",Q.generateMipMaps=!1,Q.samples=0,Q.type=-1,Q.format=-1,Q.onLoadedObservable=new g.b,Q.onErrorObservable=new g.b,Q.onRebuildCallback=null,Q.width=0,Q.height=0,Q.depth=0,Q.baseWidth=0,Q.baseHeight=0,Q.baseDepth=0,Q.invertY=!1,Q._invertVScale=!1,Q._associatedChannel=-1,Q._source=K.Unknown,Q._buffer=null,Q._bufferView=null,Q._bufferViewArray=null,Q._bufferViewArrayArray=null,Q._size=0,Q._extension="",Q._files=null,Q._workingCanvas=null,Q._workingContext=null,Q._cachedCoordinatesMode=null,Q._isDisabled=!1,Q._compression=null,Q._sphericalPolynomial=null,Q._sphericalPolynomialPromise=null,Q._sphericalPolynomialComputed=!1,Q._lodGenerationScale=0,Q._lodGenerationOffset=0,Q._useSRGBBuffer=!1,Q._lodTextureHigh=null,Q._lodTextureMid=null,Q._lodTextureLow=null,Q._isRGBD=!1,Q._linearSpecularLOD=!1,Q._irradianceTexture=null,Q._hardwareTexture=null,Q._maxLodLevel=null,Q._references=1,Q._gammaSpace=null,Q._engine=j,Q._source=b,Q._uniqueId=M._Counter++,O||(Q._hardwareTexture=j._createHardwareTexture()),Q}return(0,b.m)(M,Z),Object.defineProperty(M.prototype,"useMipMaps",{get:function(){return this.generateMipMaps},set:function(Z){this.generateMipMaps=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),M.prototype.getEngine=function(){return this._engine},Object.defineProperty(M.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),M.prototype.incrementReferences=function(){this._references++},M.prototype.updateSize=function(Z,M,j){void 0===j&&(j=1),this._engine.updateTextureDimensions(this,Z,M,j),this.width=Z,this.height=M,this.depth=j,this.baseWidth=Z,this.baseHeight=M,this.baseDepth=j,this._size=Z*M*j},M.prototype._rebuild=function(){var Z,M=this;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){var j=this.onRebuildCallback(this),b=function(Z){Z._swapAndDie(M,!1),M.isReady=j.isReady};j.isAsync?j.proxy.then(b):b(j.proxy)}else{var g;switch(this.source){case K.Temp:break;case K.Url:return void(g=this._engine.createTexture(null!==(Z=this._originalUrl)&&void 0!==Z?Z:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){g._swapAndDie(M,!1),M.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case K.Raw:(g=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer))._swapAndDie(this,!1),this.isReady=!0;break;case K.Raw3D:(g=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case K.Raw2DArray:(g=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case K.Dynamic:(g=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case K.Cube:return void(g=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){g._swapAndDie(M,!1),M.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer));case K.CubeRaw:(g=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case K.CubeRawRGBD:return;case K.CubePrefiltered:return void((g=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(Z){Z&&Z._swapAndDie(M,!1),M.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}}},M.prototype._swapAndDie=function(Z,M){var j;void 0===M&&(M=!0),null===(j=this._hardwareTexture)||void 0===j||j.setUsage(Z._source,this.generateMipMaps,this.isCube,this.width,this.height),Z._hardwareTexture=this._hardwareTexture,M&&(Z._isRGBD=this._isRGBD),this._lodTextureHigh&&(Z._lodTextureHigh&&Z._lodTextureHigh.dispose(),Z._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(Z._lodTextureMid&&Z._lodTextureMid.dispose(),Z._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(Z._lodTextureLow&&Z._lodTextureLow.dispose(),Z._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(Z._irradianceTexture&&Z._irradianceTexture.dispose(),Z._irradianceTexture=this._irradianceTexture);var K=this._engine.getLoadedTexturesCache(),b=K.indexOf(this);-1!==b&&K.splice(b,1),-1===(b=K.indexOf(Z))&&K.push(Z)},M.prototype.dispose=function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null)},M._Counter=0,M}(O.b)},15099:function(Z,M,j){"use strict";j.d(M,{d:function(){return g}});var K=j(40061),b=j(70937),g=(j(36125),function(Z){function M(M,j,K,g,O,Q,Y,I,E,s,i){void 0===Q&&(Q=!0),void 0===Y&&(Y=!1),void 0===I&&(I=3),void 0===E&&(E=0);var a=Z.call(this,null,O,!Q,Y,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,s)||this;return a.format=g,a._engine?(a._engine._caps.textureFloatLinearFiltering||1!==E||(I=1),a._engine._caps.textureHalfFloatLinearFiltering||2!==E||(I=1),a._texture=a._engine.createRawTexture(M,j,K,g,Q,Y,I,null,E,null!==s&&void 0!==s?s:0,null!==i&&void 0!==i&&i),a.wrapU=b.b.CLAMP_ADDRESSMODE,a.wrapV=b.b.CLAMP_ADDRESSMODE,a):a}return(0,K.m)(M,Z),M.prototype.update=function(Z){this._getEngine().updateRawTexture(this._texture,Z,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)},M.CreateLuminanceTexture=function(Z,j,K,b,g,O,Q){return void 0===g&&(g=!0),void 0===O&&(O=!1),void 0===Q&&(Q=3),new M(Z,j,K,1,b,g,O,Q)},M.CreateLuminanceAlphaTexture=function(Z,j,K,b,g,O,Q){return void 0===g&&(g=!0),void 0===O&&(O=!1),void 0===Q&&(Q=3),new M(Z,j,K,2,b,g,O,Q)},M.CreateAlphaTexture=function(Z,j,K,b,g,O,Q){return void 0===g&&(g=!0),void 0===O&&(O=!1),void 0===Q&&(Q=3),new M(Z,j,K,0,b,g,O,Q)},M.CreateRGBTexture=function(Z,j,K,b,g,O,Q,Y,I,E){return void 0===g&&(g=!0),void 0===O&&(O=!1),void 0===Q&&(Q=3),void 0===Y&&(Y=0),void 0===I&&(I=0),void 0===E&&(E=!1),new M(Z,j,K,4,b,g,O,Q,Y,I,E)},M.CreateRGBATexture=function(Z,j,K,b,g,O,Q,Y,I,E){return void 0===g&&(g=!0),void 0===O&&(O=!1),void 0===Q&&(Q=3),void 0===Y&&(Y=0),void 0===I&&(I=0),void 0===E&&(E=!1),new M(Z,j,K,5,b,g,O,Q,Y,I,E)},M.CreateRGBAStorageTexture=function(Z,j,K,b,g,O,Q,Y,I){return void 0===g&&(g=!0),void 0===O&&(O=!1),void 0===Q&&(Q=3),void 0===Y&&(Y=0),void 0===I&&(I=!1),new M(Z,j,K,5,b,g,O,Q,Y,1,I)},M.CreateRTexture=function(Z,j,K,g,O,Q,Y,I){return void 0===O&&(O=!0),void 0===Q&&(Q=!1),void 0===Y&&(Y=b.b.TRILINEAR_SAMPLINGMODE),void 0===I&&(I=1),new M(Z,j,K,6,g,O,Q,Y,I)},M.CreateRStorageTexture=function(Z,j,K,g,O,Q,Y,I){return void 0===O&&(O=!0),void 0===Q&&(Q=!1),void 0===Y&&(Y=b.b.TRILINEAR_SAMPLINGMODE),void 0===I&&(I=1),new M(Z,j,K,6,g,O,Q,Y,I,1)},M}(b.b))},57194:function(Z,M,j){"use strict";j.d(M,{e:function(){return g}});var K=j(40061),b=j(70937),g=(j(36125),function(Z){function M(M,j,K,g,O,Q,Y,I,E,s){void 0===Y&&(Y=!0),void 0===I&&(I=!1),void 0===E&&(E=b.b.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=0);var i=Z.call(this,null,Q,!Y,I)||this;return i.format=O,i._texture=Q.getEngine().createRawTexture2DArray(M,j,K,g,O,Y,I,E,null,s),i._depth=g,i.is2DArray=!0,i}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"depth",{get:function(){return this._depth},enumerable:!1,configurable:!0}),M.prototype.update=function(Z){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,Z,this._texture.format,this._texture.invertY,null,this._texture.type)},M.CreateRGBATexture=function(Z,j,K,b,g,O,Q,Y,I){return void 0===O&&(O=!0),void 0===Q&&(Q=!1),void 0===Y&&(Y=3),void 0===I&&(I=0),new M(Z,j,K,b,5,g,O,Q,Y,I)},M}(b.b))},52128:function(Z,M,j){"use strict";j.d(M,{d:function(){return s}});var K=j(40061),b=j(9271),g=j(9217),O=j(80105),Q=j(70937),Y=j(64833),I=j(16369),E=(j(84468),j(42373),j(90690)),s=function(Z){function M(M,j,K,g,Y,E,s,i,a,z,V,o,c,G,f,X,d){void 0===Y&&(Y=!0),void 0===E&&(E=0),void 0===s&&(s=!1),void 0===i&&(i=Q.b.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=!0),void 0===z&&(z=!1),void 0===V&&(V=!1),void 0===o&&(o=5),void 0===c&&(c=!1),void 0===X&&(X=!1),void 0===d&&(d=!1);var W,A=this;if((A=Z.call(this,null,K,!g,void 0,i,void 0,void 0,void 0,void 0,o)||this).renderParticles=!0,A.renderSprites=!1,A.ignoreCameraViewport=!1,A.onBeforeBindObservable=new b.b,A.onAfterUnbindObservable=new b.b,A.onBeforeRenderObservable=new b.b,A.onAfterRenderObservable=new b.b,A.onClearObservable=new b.b,A.onResizeObservable=new b.b,A._cleared=!1,A.skipInitialClear=!1,A._currentRefreshId=-1,A._refreshRate=1,A._samples=1,A._canRescale=!0,A._renderTarget=null,A.boundingBoxPosition=O.k.Zero(),!(K=A.getScene()))return A;var q=A.getScene().getEngine();return A._coordinatesMode=Q.b.PROJECTION_MODE,A.renderList=new Array,A.name=M,A.isRenderTarget=!0,A._initialSizeParameter=j,A._renderPassIds=[],A._isCubeData=s,A._processSizeParameter(j),A.renderPassId=A._renderPassIds[0],A._resizeObserver=q.onResizeObservable.add((function(){})),A._generateMipMaps=!!g,A._doNotChangeAspectRatio=Y,A._renderingManager=new I.e(K),A._renderingManager._useSceneAutoClearSetup=!0,V||(A._renderTargetOptions={generateMipMaps:g,type:E,format:null!==(W=A._format)&&void 0!==W?W:void 0,samplingMode:A.samplingMode,generateDepthBuffer:a,generateStencilBuffer:z,samples:G,creationFlags:f,noColorTarget:X,useSRGBBuffer:d},A.samplingMode===Q.b.NEAREST_SAMPLINGMODE&&(A.wrapU=Q.b.CLAMP_ADDRESSMODE,A.wrapV=Q.b.CLAMP_ADDRESSMODE),c||(s?(A._renderTarget=K.getEngine().createRenderTargetCubeTexture(A.getRenderSize(),A._renderTargetOptions),A.coordinatesMode=Q.b.INVCUBIC_MODE,A._textureMatrix=O.c.Identity()):A._renderTarget=K.getEngine().createRenderTargetTexture(A._size,A._renderTargetOptions),A._texture=A._renderTarget.texture,void 0!==G&&(A.samples=G))),A}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"renderList",{get:function(){return this._renderList},set:function(Z){this._renderList=Z,this._renderList&&this._hookArray(this._renderList)},enumerable:!1,configurable:!0}),M.prototype._hookArray=function(Z){var M=this,j=Z.push;Z.push=function(){for(var K,b=[],g=0;g<arguments.length;g++)b[g]=arguments[g];var O=0===Z.length,Q=j.apply(Z,b);return O&&(null===(K=M.getScene())||void 0===K||K.meshes.forEach((function(Z){Z._markSubMeshesAsLightDirty()}))),Q};var K=Z.splice;Z.splice=function(j,b){var g,O=K.apply(Z,[j,b]);return 0===Z.length&&(null===(g=M.getScene())||void 0===g||g.meshes.forEach((function(Z){Z._markSubMeshesAsLightDirty()}))),O}},Object.defineProperty(M.prototype,"postProcesses",{get:function(){return this._postProcesses},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"_prePassEnabled",{get:function(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onAfterUnbind",{set:function(Z){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onBeforeRender",{set:function(Z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onAfterRender",{set:function(Z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onClear",{set:function(Z){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"renderPassIds",{get:function(){return this._renderPassIds},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"currentRefreshId",{get:function(){return this._currentRefreshId},enumerable:!1,configurable:!0}),M.prototype.setMaterialForRendering=function(Z,M){var j;j=Array.isArray(Z)?Z:[Z];for(var K=0;K<j.length;++K)for(var b=0;b<this._renderPassIds.length;++b)j[K].setMaterialForRenderPass(this._renderPassIds[b],void 0!==M?Array.isArray(M)?M[b]:M:void 0)},Object.defineProperty(M.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),M.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(M.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(Z){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(Z)){this._boundingBoxSize=Z;var M=this.getScene();M&&M.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"depthStencilTexture",{get:function(){var Z,M;return null!==(M=null===(Z=this._renderTarget)||void 0===Z?void 0:Z._depthStencilTexture)&&void 0!==M?M:null},enumerable:!1,configurable:!0}),M.prototype.createDepthStencilTexture=function(Z,M,j,K,b){var g;void 0===Z&&(Z=0),void 0===M&&(M=!0),void 0===j&&(j=!1),void 0===K&&(K=1),void 0===b&&(b=14),null===(g=this._renderTarget)||void 0===g||g.createDepthStencilTexture(Z,M,j,K,b)},M.prototype._releaseRenderPassId=function(){if(this._scene)for(var Z=this._scene.getEngine(),M=0;M<this._renderPassIds.length;++M)Z.releaseRenderPassId(this._renderPassIds[M]);this._renderPassIds=[]},M.prototype._createRenderPassId=function(){this._releaseRenderPassId();for(var Z=this._scene.getEngine(),M=this._isCubeData?6:this.getRenderLayers()||1,j=0;j<M;++j)this._renderPassIds[j]=Z.createRenderPassId("RenderTargetTexture - ".concat(this.name,"#").concat(j))},M.prototype._processSizeParameter=function(Z){if(Z.ratio){this._sizeRatio=Z.ratio;var M=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(M.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(M.getRenderHeight(),this._sizeRatio)}}else this._size=Z;this._createRenderPassId()},Object.defineProperty(M.prototype,"samples",{get:function(){var Z,M;return null!==(M=null===(Z=this._renderTarget)||void 0===Z?void 0:Z.samples)&&void 0!==M?M:this._samples},set:function(Z){this._renderTarget&&(this._samples=this._renderTarget.setSamples(Z))},enumerable:!1,configurable:!0}),M.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(M.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(Z){this._refreshRate=Z,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),M.prototype.addPostProcess=function(Z){if(!this._postProcessManager){var M=this.getScene();if(!M)return;this._postProcessManager=new Y.c(M),this._postProcesses=new Array}this._postProcesses.push(Z),this._postProcesses[0].autoClear=!1},M.prototype.clearPostProcesses=function(Z){if(void 0===Z&&(Z=!1),this._postProcesses){if(Z)for(var M=0,j=this._postProcesses;M<j.length;M++){j[M].dispose()}this._postProcesses=[]}},M.prototype.removePostProcess=function(Z){if(this._postProcesses){var M=this._postProcesses.indexOf(Z);-1!==M&&(this._postProcesses.splice(M,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},M.prototype._shouldRender=function(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},M.prototype.getRenderSize=function(){return this.getRenderWidth()},M.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},M.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},M.prototype.getRenderLayers=function(){var Z=this._size.layers;return Z||0},M.prototype.disableRescaling=function(){this._canRescale=!1},Object.defineProperty(M.prototype,"canRescale",{get:function(){return this._canRescale},enumerable:!1,configurable:!0}),M.prototype.scale=function(Z){var M=Math.max(1,this.getRenderSize()*Z);this.resize(M)},M.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:Z.prototype.getReflectionTextureMatrix.call(this)},M.prototype.resize=function(Z){var M,j=this.isCube;null===(M=this._renderTarget)||void 0===M||M.dispose(),this._renderTarget=null;var K=this.getScene();K&&(this._processSizeParameter(Z),this._renderTarget=j?K.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):K.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},M.prototype.render=function(Z,M){void 0===Z&&(Z=!1),void 0===M&&(M=!1),this._render(Z,M)},M.prototype.isReadyForRendering=function(){return this._render(!1,!1,!0)},M.prototype._render=function(Z,M,j){var K;void 0===Z&&(Z=!1),void 0===M&&(M=!1),void 0===j&&(j=!1);var b=this.getScene();if(!b)return j;var g=b.getEngine();if(void 0!==this.useCameraPostProcesses&&(Z=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var O=0;O<this._waitingRenderList.length;O++){var Q=this._waitingRenderList[O];(E=b.getMeshById(Q))&&this.renderList.push(E)}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];var Y=this.getScene();if(!Y)return j;var I=Y.meshes;for(O=0;O<I.length;O++){var E=I[O];this.renderListPredicate(E)&&this.renderList.push(E)}}var s=g.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);var i=null!==(K=this.activeCamera)&&void 0!==K?K:b.activeCamera;i&&(i!==b.activeCamera&&b.setTransformMatrix(i.getViewMatrix(),i.getProjectionMatrix(!0)),g.setViewport(i.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;var a=j;if(j){b.getViewMatrix()||b.updateTransformMatrix();var z=this.is2DArray?this.getRenderLayers():this.isCube?6:1;for(f=0;f<z&&a;f++){var V=null,o=this.renderList?this.renderList:b.getActiveMeshes().data,c=this.renderList?this.renderList.length:b.getActiveMeshes().length;g.currentRenderPassId=this._renderPassIds[f],this.onBeforeRenderObservable.notifyObservers(f),this.getCustomRenderList&&(V=this.getCustomRenderList(f,o,c)),V||(V=o),this._doNotChangeAspectRatio||b.updateTransformMatrix(!0);for(var G=0;G<V.length&&a;++G){if((E=V[G]).isEnabled()&&!E.isBlocked&&E.isVisible&&E.subMeshes)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(E,this.refreshRate)){a=!1;break}}else if(!E.isReady(!0)){a=!1;break}}this.onAfterRenderObservable.notifyObservers(f)}}else if(this.is2DArray)for(var f=0;f<this.getRenderLayers();f++)this._renderToTarget(0,Z,M,f,i),b.incrementRenderId(),b.resetCachedMaterial();else if(this.isCube)for(var X=0;X<6;X++)this._renderToTarget(X,Z,M,void 0,i),b.incrementRenderId(),b.resetCachedMaterial();else this._renderToTarget(0,Z,M,void 0,i);return this.onAfterUnbindObservable.notifyObservers(this),g.currentRenderPassId=s,b.activeCamera&&((b.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==b.activeCamera)&&b.setTransformMatrix(b.activeCamera.getViewMatrix(),b.activeCamera.getProjectionMatrix(!0)),g.setViewport(b.activeCamera.viewport)),b.resetCachedMaterial(),a},M.prototype._bestReflectionRenderTargetDimension=function(Z,M){var j=Z*M,K=E.c.NearestPOT(j+16384/(128+j));return Math.min(E.c.FloorPOT(Z),K)},M.prototype._prepareRenderingManager=function(Z,M,j,K){var b=this.getScene();if(b){this._renderingManager.reset();for(var g=b.getRenderId(),O=0;O<M;O++){var Q=Z[O];if(Q&&!Q.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(Q,this.refreshRate)){this.resetRefreshCounter();continue}}else if(!Q.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!Q._internalAbstractMeshDataInfo._currentLODIsUpToDate&&b.activeCamera&&(Q._internalAbstractMeshDataInfo._currentLOD=b.customLODSelector?b.customLODSelector(Q,this.activeCamera||b.activeCamera):Q.getLOD(this.activeCamera||b.activeCamera),Q._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!Q._internalAbstractMeshDataInfo._currentLOD)continue;var Y=Q._internalAbstractMeshDataInfo._currentLOD;Y._preActivateForIntermediateRendering(g);var I=void 0;if(I=!(!K||!j)&&0===(Q.layerMask&j.layerMask),Q.isEnabled()&&Q.isVisible&&Q.subMeshes&&!I&&(Y!==Q&&Y._activate(g,!0),Q._activate(g,!0)&&Q.subMeshes.length)){Q.isAnInstance?Q._internalAbstractMeshDataInfo._actAsRegularMesh&&(Y=Q):Y._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,Y._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var E=0;E<Y.subMeshes.length;E++){var s=Y.subMeshes[E];this._renderingManager.dispatch(s,Y)}}}}for(var i=0;i<b.particleSystems.length;i++){var a=b.particleSystems[i],z=a.emitter;a.isStarted()&&z&&z.position&&z.isEnabled()&&(Z.indexOf(z)>=0&&this._renderingManager.dispatchParticles(a))}}},M.prototype._bindFrameBuffer=function(Z,M){void 0===Z&&(Z=0),void 0===M&&(M=0);var j=this.getScene();if(j){var K=j.getEngine();this._renderTarget&&K.bindFramebuffer(this._renderTarget,this.isCube?Z:void 0,void 0,void 0,this.ignoreCameraViewport,0,M)}},M.prototype._unbindFrameBuffer=function(Z,M){var j=this;this._renderTarget&&Z.unBindFramebuffer(this._renderTarget,this.isCube,(function(){j.onAfterRenderObservable.notifyObservers(M)}))},M.prototype._prepareFrame=function(Z,M,j,K){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):K&&Z.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(M,j)},M.prototype._renderToTarget=function(Z,M,j,K,b){var O,Q,Y,I,E,s;void 0===K&&(K=0),void 0===b&&(b=null);var i=this.getScene();if(i){var a=i.getEngine();if(null===(O=a._debugPushGroup)||void 0===O||O.call(a,"render to face #".concat(Z," layer #").concat(K),1),this._prepareFrame(i,Z,K,M),this.is2DArray?(a.currentRenderPassId=this._renderPassIds[K],this.onBeforeRenderObservable.notifyObservers(K)):(a.currentRenderPassId=this._renderPassIds[Z],this.onBeforeRenderObservable.notifyObservers(Z)),a.snapshotRendering&&1===a.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(a):this.skipInitialClear||a.clear(this.clearColor||i.clearColor,!0,!0,!0);else{var z=null,V=this.renderList?this.renderList:i.getActiveMeshes().data,o=this.renderList?this.renderList.length:i.getActiveMeshes().length;this.getCustomRenderList&&(z=this.getCustomRenderList(this.is2DArray?K:Z,V,o)),z?this._prepareRenderingManager(z,z.length,b,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(V,o,b,!this.renderList),this._defaultRenderListPrepared=!0),z=V);for(var c=0,G=i._beforeRenderTargetClearStage;c<G.length;c++){G[c].action(this,Z,K)}this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(a):this.skipInitialClear||a.clear(this.clearColor||i.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||i.updateTransformMatrix(!0);for(var f=0,X=i._beforeRenderTargetDrawStage;f<X.length;f++){X[f].action(this,Z,K)}this._renderingManager.render(this.customRenderFunction,z,this.renderParticles,this.renderSprites);for(var d=0,W=i._afterRenderTargetDrawStage;d<W.length;d++){W[d].action(this,Z,K)}var A=null!==(Y=null===(Q=this._texture)||void 0===Q?void 0:Q.generateMipMaps)&&void 0!==Y&&Y;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,null!==(I=this._renderTarget)&&void 0!==I?I:void 0,Z,this._postProcesses,this.ignoreCameraViewport):M&&i.postProcessManager._finalizeFrame(!1,null!==(E=this._renderTarget)&&void 0!==E?E:void 0,Z),this._texture&&(this._texture.generateMipMaps=A),this._doNotChangeAspectRatio||i.updateTransformMatrix(!0),j&&g.d.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),a)}this._unbindFrameBuffer(a,Z),this._texture&&this.isCube&&5===Z&&a.generateMipMapsForCubemap(this._texture),null===(s=a._debugPopGroup)||void 0===s||s.call(a,1)}},M.prototype.setRenderingOrder=function(Z,M,j,K){void 0===M&&(M=null),void 0===j&&(j=null),void 0===K&&(K=null),this._renderingManager.setRenderingOrder(Z,M,j,K)},M.prototype.setRenderingAutoClearDepthStencil=function(Z,M){this._renderingManager.setRenderingAutoClearDepthStencil(Z,M),this._renderingManager._useSceneAutoClearSetup=!1},M.prototype.clone=function(){var Z=this.getSize(),j=new M(this.name,Z,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return j.hasAlpha=this.hasAlpha,j.level=this.level,j.coordinatesMode=this.coordinatesMode,this.renderList&&(j.renderList=this.renderList.slice(0)),j},M.prototype.serialize=function(){if(!this.name)return null;var M=Z.prototype.serialize.call(this);if(M.renderTargetSize=this.getRenderSize(),M.renderList=[],this.renderList)for(var j=0;j<this.renderList.length;j++)M.renderList.push(this.renderList[j].id);return M},M.prototype.disposeFramebufferObjects=function(){var Z;null===(Z=this._renderTarget)||void 0===Z||Z.dispose(!0)},M.prototype.releaseInternalTexture=function(){var Z;null===(Z=this._renderTarget)||void 0===Z||Z.releaseTextures(),this._texture=null},M.prototype.dispose=function(){var M;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var j=this.getScene();if(j){var K=j.customRenderTargets.indexOf(this);K>=0&&j.customRenderTargets.splice(K,1);for(var b=0,g=j.cameras;b<g.length;b++){var O=g[b];(K=O.customRenderTargets.indexOf(this))>=0&&O.customRenderTargets.splice(K,1)}null===(M=this._renderTarget)||void 0===M||M.dispose(),this._renderTarget=null,this._texture=null,Z.prototype.dispose.call(this)}},M.prototype._rebuild=function(){this.refreshRate===M.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=M.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},M.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},M.prototype.getViewCount=function(){return 1},M.REFRESHRATE_RENDER_ONCE=0,M.REFRESHRATE_RENDER_ONEVERYFRAME=1,M.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,M}(Q.b);Q.b._CreateRenderTargetTexture=function(Z,M,j,K,b){return new s(Z,M,j,K)}},70937:function(Z,M,j){"use strict";j.d(M,{b:function(){return G}});var K=j(40061),b=j(9892),g=j(9271),O=j(80105),Q=j(76384),Y=j(31709),I=j(50504),E=j(1116),s=j(90526),i=j(85567),a=j(50459);function z(Z,M,j){void 0===j&&(j=!1);var K=M.width,b=M.height;if(Z instanceof Float32Array){for(var g=Z.byteLength/Z.BYTES_PER_ELEMENT,O=new Uint8Array(g);--g>=0;){var Q=Z[g];Q<0?Q=0:Q>1&&(Q=1),O[g]=255*Q}Z=O}var Y=document.createElement("canvas");Y.width=K,Y.height=b;var I=Y.getContext("2d");if(!I)return null;var E=I.createImageData(K,b);if(E.data.set(Z),I.putImageData(E,0,0),j){var s=document.createElement("canvas");s.width=K,s.height=b;var i=s.getContext("2d");return i?(i.translate(0,b),i.scale(1,-1),i.drawImage(Y,0,0),s.toDataURL("image/png")):null}return Y.toDataURL("image/png")}function V(Z,M,j){void 0===M&&(M=0),void 0===j&&(j=0);var K=Z.getInternalTexture();if(!K)return null;var b=Z._readPixelsSync(M,j);return b?z(b,Z.getSize(),K.invertY):null}function o(Z,M,j){return void 0===M&&(M=0),void 0===j&&(j=0),(0,K.h)(this,void 0,void 0,(function(){var b,g;return(0,K.n)(this,(function(K){switch(K.label){case 0:return(b=Z.getInternalTexture())?[4,Z.readPixels(M,j)]:[2,null];case 1:return(g=K.sent())?[2,z(g,Z.getSize(),b.invertY)]:[2,null]}}))}))}var c=j(20334),G=function(Z){function M(j,K,b,O,Q,Y,I,s,i,a,z,V,o,G){void 0===Q&&(Q=M.TRILINEAR_SAMPLINGMODE),void 0===Y&&(Y=null),void 0===I&&(I=null),void 0===s&&(s=null),void 0===i&&(i=!1);var f,X,d,W,A,q,T,B,N,U,n=this;(n=Z.call(this,K)||this).url=null,n.uOffset=0,n.vOffset=0,n.uScale=1,n.vScale=1,n.uAng=0,n.vAng=0,n.wAng=0,n.uRotationCenter=.5,n.vRotationCenter=.5,n.wRotationCenter=.5,n.homogeneousRotationInUVTransform=!1,n.inspectableCustomProperties=null,n._noMipmap=!1,n._invertY=!1,n._rowGenerationMatrix=null,n._cachedTextureMatrix=null,n._projectionModeMatrix=null,n._t0=null,n._t1=null,n._t2=null,n._cachedUOffset=-1,n._cachedVOffset=-1,n._cachedUScale=0,n._cachedVScale=0,n._cachedUAng=-1,n._cachedVAng=-1,n._cachedWAng=-1,n._cachedProjectionMatrixId=-1,n._cachedURotationCenter=-1,n._cachedVRotationCenter=-1,n._cachedWRotationCenter=-1,n._cachedHomogeneousRotationInUVTransform=!1,n._cachedCoordinatesMode=-1,n._buffer=null,n._deleteBuffer=!1,n._format=null,n._delayedOnLoad=null,n._delayedOnError=null,n.onLoadObservable=new g.b,n._isBlocking=!0,n.name=j||"",n.url=j;var k=!1,x=null;"object"===typeof b&&null!==b?(U=null!==(f=b.noMipmap)&&void 0!==f&&f,O=null!==(X=b.invertY)&&void 0!==X?X:!c.e.UseOpenGLOrientationForUV,Q=null!==(d=b.samplingMode)&&void 0!==d?d:M.TRILINEAR_SAMPLINGMODE,Y=null!==(W=b.onLoad)&&void 0!==W?W:null,I=null!==(A=b.onError)&&void 0!==A?A:null,s=null!==(q=b.buffer)&&void 0!==q?q:null,i=null!==(T=b.deleteBuffer)&&void 0!==T&&T,a=b.format,z=b.mimeType,V=b.loaderOptions,o=b.creationFlags,k=null!==(B=b.useSRGBBuffer)&&void 0!==B&&B,x=null!==(N=b.internalTexture)&&void 0!==N?N:null):U=!!b,n._noMipmap=U,n._invertY=void 0===O?!c.e.UseOpenGLOrientationForUV:O,n._initialSamplingMode=Q,n._buffer=s,n._deleteBuffer=i,n._mimeType=z,n._loaderOptions=V,n._creationFlags=o,n._useSRGBBuffer=k,n._forcedExtension=G,a&&(n._format=a);var R=n.getScene(),e=n._getEngine();if(!e)return n;e.onBeforeTextureInitObservable.notifyObservers(n);var u=function(){n._texture&&(n._texture._invertVScale&&(n.vScale*=-1,n.vOffset+=1),null!==n._texture._cachedWrapU&&(n.wrapU=n._texture._cachedWrapU,n._texture._cachedWrapU=null),null!==n._texture._cachedWrapV&&(n.wrapV=n._texture._cachedWrapV,n._texture._cachedWrapV=null),null!==n._texture._cachedWrapR&&(n.wrapR=n._texture._cachedWrapR,n._texture._cachedWrapR=null)),n.onLoadObservable.hasObservers()&&n.onLoadObservable.notifyObservers(n),Y&&Y(),!n.isBlocking&&R&&R.resetCachedMaterial()},F=function(Z,j){n._loadingError=!0,n._errorObject={message:Z,exception:j},I&&I(Z,j),M.OnTextureLoadErrorObservable.notifyObservers(n)};if(!n.url)return n._delayedOnLoad=u,n._delayedOnError=F,n;if(n._texture=null!==x&&void 0!==x?x:n._getFromCache(n.url,U,Q,n._invertY,k),n._texture)if(n._texture.isReady)E.c.SetImmediate((function(){return u()}));else{var C=n._texture.onLoadedObservable.add(u);n._texture.onErrorObservable.add((function(Z){var M;F(Z.message,Z.exception),null===(M=n._texture)||void 0===M||M.onLoadedObservable.remove(C)}))}else if(R&&R.useDelayedTextureLoading)n.delayLoadState=4,n._delayedOnLoad=u,n._delayedOnError=F;else{try{n._texture=e.createTexture(n.url,U,n._invertY,R,Q,u,F,n._buffer,void 0,n._format,n._forcedExtension,z,V,o,k)}catch(Z){throw F("error loading",Z),Z}i&&(n._buffer=null)}return n}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(Z){this._isBlocking=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),M.prototype.updateURL=function(Z,M,j,K){void 0===M&&(M=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!this.name.startsWith("data:")||(this.name=Z),this.url=Z,this._buffer=M,this._forcedExtension=K,this.delayLoadState=4,j&&(this._delayedOnLoad=j),this.delayLoad()},M.prototype.delayLoad=function(){if(4===this.delayLoadState){var Z=this.getScene();Z&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer),this._texture?this._delayedOnLoad&&(this._texture.isReady?E.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=Z.getEngine().createTexture(this.url,this._noMipmap,this._invertY,Z,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},M.prototype._prepareRowForTextureGeneration=function(Z,M,j,K){Z*=this._cachedUScale,M*=this._cachedVScale,Z-=this.uRotationCenter*this._cachedUScale,M-=this.vRotationCenter*this._cachedVScale,j-=this.wRotationCenter,O.k.TransformCoordinatesFromFloatsToRef(Z,M,j,this._rowGenerationMatrix,K),K.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,K.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,K.z+=this.wRotationCenter},M.prototype.checkTransformsAreIdentical=function(Z){return null!==Z&&this.uOffset===Z.uOffset&&this.vOffset===Z.vOffset&&this.uScale===Z.uScale&&this.vScale===Z.vScale&&this.uAng===Z.uAng&&this.vAng===Z.vAng&&this.wAng===Z.wAng},M.prototype.getTextureMatrix=function(Z){var M=this;if(void 0===Z&&(Z=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*Z===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*Z,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=O.c.Zero(),this._rowGenerationMatrix=new O.c,this._t0=O.k.Zero(),this._t1=O.k.Zero(),this._t2=O.k.Zero()),O.c.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(O.c.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,O.e.Matrix[0]),O.c.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,O.e.Matrix[1]),O.c.ScalingToRef(this._cachedUScale,this._cachedVScale,0,O.e.Matrix[2]),O.c.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,O.e.Matrix[3]),O.e.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(O.e.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(O.e.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(O.e.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),O.c.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var j=this.getScene();return j?(j.markAllMaterialsAsDirty(1,(function(Z){return Z.hasTexture(M)})),this._cachedTextureMatrix):this._cachedTextureMatrix},M.prototype.getReflectionTextureMatrix=function(){var Z=this,j=this.getScene();if(!j)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==M.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===j.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}this._cachedTextureMatrix||(this._cachedTextureMatrix=O.c.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=O.c.Zero());var K=this._cachedCoordinatesMode!==this.coordinatesMode;switch(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case M.PLANAR_MODE:O.c.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case M.PROJECTION_MODE:O.c.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var b=j.getProjectionMatrix();this._cachedProjectionMatrixId=b.updateFlag,b.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:O.c.IdentityToRef(this._cachedTextureMatrix)}return K&&j.markAllMaterialsAsDirty(1,(function(M){return-1!==M.getActiveTextures().indexOf(Z)})),this._cachedTextureMatrix},M.prototype.clone=function(){var Z=this,j={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return b.b.Clone((function(){return new M(Z._texture?Z._texture.url:null,Z.getScene(),j)}),this)},M.prototype.serialize=function(){var j=this.name;M.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");var K=Z.prototype.serialize.call(this);return K?((M.SerializeBuffers||M.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(K.base64String=this._buffer,K.name=K.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?K.base64String="data:image/png;base64,"+(0,a.j)(this._buffer):(M.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(K.base64String=!this._engine||this._engine._features.supportSyncTextureRead?V(this):o(this))),K.invertY=this._invertY,K.samplingMode=this.samplingMode,K._creationFlags=this._creationFlags,K._useSRGBBuffer=this._useSRGBBuffer,this.name=j,K):null},M.prototype.getClassName=function(){return"Texture"},M.prototype.dispose=function(){Z.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},M.Parse=function(Z,j,K){if(Z.customType){var g=s.e.Instantiate(Z.customType).Parse(Z,j,K);return Z.samplingMode&&g.updateSamplingMode&&g._samplingMode&&g._samplingMode!==Z.samplingMode&&g.updateSamplingMode(Z.samplingMode),g}if(Z.isCube&&!Z.isRenderTarget)return M._CubeTextureParser(Z,j,K);if(!Z.name&&!Z.isRenderTarget)return null;var O=function(){if(Q&&Q._texture&&(Q._texture._cachedWrapU=null,Q._texture._cachedWrapV=null,Q._texture._cachedWrapR=null),Z.samplingMode){var M=Z.samplingMode;Q&&Q.samplingMode!==M&&Q.updateSamplingMode(M)}if(Q&&Z.animations)for(var j=0;j<Z.animations.length;j++){var K=Z.animations[j],b=(0,Y.b)("BABYLON.Animation");b&&Q.animations.push(b.Parse(K))}},Q=b.b.Parse((function(){var b,g,Q,Y,I=!0;if(Z.noMipmap&&(I=!1),Z.mirrorPlane){var E=M._CreateMirror(Z.name,Z.renderTargetSize,j,I);return E._waitingRenderList=Z.renderList,E.mirrorPlane=i.e.FromArray(Z.mirrorPlane),O(),E}if(Z.isRenderTarget){var s=null;if(Z.isCube){if(j.reflectionProbes)for(var a=0;a<j.reflectionProbes.length;a++){var z=j.reflectionProbes[a];if(z.name===Z.name)return z.cubeTexture}}else(s=M._CreateRenderTargetTexture(Z.name,Z.renderTargetSize,j,I,null!==(b=Z._creationFlags)&&void 0!==b?b:0))._waitingRenderList=Z.renderList;return O(),s}if(Z.base64String)Y=M.CreateFromBase64String(Z.base64String,Z.name,j,!I,Z.invertY,Z.samplingMode,O,null!==(g=Z._creationFlags)&&void 0!==g?g:0,null!==(Q=Z._useSRGBBuffer)&&void 0!==Q&&Q);else{var V=void 0;V=Z.name&&Z.name.indexOf("://")>0?Z.name:K+Z.name,Z.url&&(Z.url.startsWith("data:")||M.UseSerializedUrlIfAny)&&(V=Z.url),Y=new M(V,j,!I,Z.invertY,Z.samplingMode,O)}return Y}),Z,j);return Q},M.CreateFromBase64String=function(Z,j,K,b,g,O,Q,Y,I,E){return void 0===O&&(O=M.TRILINEAR_SAMPLINGMODE),void 0===Q&&(Q=null),void 0===Y&&(Y=null),void 0===I&&(I=5),new M("data:"+j,K,b,g,O,Q,Y,Z,!1,I,void 0,void 0,E)},M.LoadFromDataString=function(Z,j,K,b,g,O,Q,Y,I,E,s){return void 0===b&&(b=!1),void 0===O&&(O=!0),void 0===Q&&(Q=M.TRILINEAR_SAMPLINGMODE),void 0===Y&&(Y=null),void 0===I&&(I=null),void 0===E&&(E=5),"data:"!==Z.substr(0,5)&&(Z="data:"+Z),new M(Z,K,g,O,Q,Y,I,j,b,E,void 0,void 0,s)},M.SerializeBuffers=!0,M.ForceSerializeBuffers=!1,M.OnTextureLoadErrorObservable=new g.b,M._CubeTextureParser=function(Z,M,j){throw(0,I.e)("CubeTexture")},M._CreateMirror=function(Z,M,j,K){throw(0,I.e)("MirrorTexture")},M._CreateRenderTargetTexture=function(Z,M,j,K,b){throw(0,I.e)("RenderTargetTexture")},M.NEAREST_SAMPLINGMODE=1,M.NEAREST_NEAREST_MIPLINEAR=8,M.BILINEAR_SAMPLINGMODE=2,M.LINEAR_LINEAR_MIPNEAREST=11,M.TRILINEAR_SAMPLINGMODE=3,M.LINEAR_LINEAR_MIPLINEAR=3,M.NEAREST_NEAREST_MIPNEAREST=4,M.NEAREST_LINEAR_MIPNEAREST=5,M.NEAREST_LINEAR_MIPLINEAR=6,M.NEAREST_LINEAR=7,M.NEAREST_NEAREST=1,M.LINEAR_NEAREST_MIPNEAREST=9,M.LINEAR_NEAREST_MIPLINEAR=10,M.LINEAR_LINEAR=2,M.LINEAR_NEAREST=12,M.EXPLICIT_MODE=0,M.SPHERICAL_MODE=1,M.PLANAR_MODE=2,M.CUBIC_MODE=3,M.PROJECTION_MODE=4,M.SKYBOX_MODE=5,M.INVCUBIC_MODE=6,M.EQUIRECTANGULAR_MODE=7,M.FIXED_EQUIRECTANGULAR_MODE=8,M.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,M.CLAMP_ADDRESSMODE=0,M.WRAP_ADDRESSMODE=1,M.MIRROR_ADDRESSMODE=2,M.UseSerializedUrlIfAny=!1,(0,K.l)([(0,b.z)()],M.prototype,"url",void 0),(0,K.l)([(0,b.z)()],M.prototype,"uOffset",void 0),(0,K.l)([(0,b.z)()],M.prototype,"vOffset",void 0),(0,K.l)([(0,b.z)()],M.prototype,"uScale",void 0),(0,K.l)([(0,b.z)()],M.prototype,"vScale",void 0),(0,K.l)([(0,b.z)()],M.prototype,"uAng",void 0),(0,K.l)([(0,b.z)()],M.prototype,"vAng",void 0),(0,K.l)([(0,b.z)()],M.prototype,"wAng",void 0),(0,K.l)([(0,b.z)()],M.prototype,"uRotationCenter",void 0),(0,K.l)([(0,b.z)()],M.prototype,"vRotationCenter",void 0),(0,K.l)([(0,b.z)()],M.prototype,"wRotationCenter",void 0),(0,K.l)([(0,b.z)()],M.prototype,"homogeneousRotationInUVTransform",void 0),(0,K.l)([(0,b.z)()],M.prototype,"isBlocking",null),M}(Q.e);(0,Y.c)("BABYLON.Texture",G),b.b._TextureParser=G.Parse},80150:function(Z,M,j){"use strict";j.d(M,{b:function(){return K}});var K=function(){function Z(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}return Object.defineProperty(Z.prototype,"wrapU",{get:function(){return this._cachedWrapU},set:function(Z){this._cachedWrapU=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"wrapV",{get:function(){return this._cachedWrapV},set:function(Z){this._cachedWrapV=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"wrapR",{get:function(){return this._cachedWrapR},set:function(Z){this._cachedWrapR=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"anisotropicFilteringLevel",{get:function(){return this._cachedAnisotropicFilteringLevel},set:function(Z){this._cachedAnisotropicFilteringLevel=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"comparisonFunction",{get:function(){return this._comparisonFunction},set:function(Z){this._comparisonFunction=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"useMipMaps",{get:function(){return this._useMipMaps},set:function(Z){this._useMipMaps=Z},enumerable:!1,configurable:!0}),Z.prototype.setParameters=function(Z,M,j,K,b,g){return void 0===Z&&(Z=1),void 0===M&&(M=1),void 0===j&&(j=1),void 0===K&&(K=1),void 0===b&&(b=2),void 0===g&&(g=0),this._cachedWrapU=Z,this._cachedWrapV=M,this._cachedWrapR=j,this._cachedAnisotropicFilteringLevel=K,this.samplingMode=b,this._comparisonFunction=g,this},Z.prototype.compareSampler=function(Z){return this._cachedWrapU===Z._cachedWrapU&&this._cachedWrapV===Z._cachedWrapV&&this._cachedWrapR===Z._cachedWrapR&&this._cachedAnisotropicFilteringLevel===Z._cachedAnisotropicFilteringLevel&&this.samplingMode===Z.samplingMode&&this._comparisonFunction===Z._comparisonFunction&&this._useMipMaps===Z._useMipMaps},Z}()},61803:function(Z,M,j){"use strict";j.d(M,{e:function(){return K}});var K=function(){function Z(Z,M){void 0===M&&(M=!0),this.effect=null,this.defines=null,this.drawContext=Z.createDrawContext(),M&&(this.materialContext=Z.createMaterialContext())}return Z.IsWrapper=function(Z){return void 0===Z.getPipelineContext},Z.GetEffect=function(Z){return void 0===Z.getPipelineContext?Z.effect:Z},Z.prototype.setEffect=function(Z,M,j){var K;void 0===j&&(j=!0),this.effect=Z,void 0!==M&&(this.defines=M),j&&(null===(K=this.drawContext)||void 0===K||K.reset())},Z.prototype.dispose=function(){var Z;null===(Z=this.drawContext)||void 0===Z||Z.dispose()},Z}()},90559:function(Z,M,j){"use strict";j.d(M,{e:function(){return I}});var K=j(9271),b=j(60985),g=j(9127),O=j(42647),Q=j(16179),Y=j(56591),I=function(){function Z(M,j,g,I,E,s,i,a,z,V,o,c){void 0===I&&(I=null),void 0===s&&(s=null),void 0===i&&(i=null),void 0===a&&(a=null),void 0===z&&(z=null),void 0===o&&(o=""),void 0===c&&(c=Y.b.GLSL);var G,f,X,d=this;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new K.b,this.onErrorObservable=new K.b,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._wasPreviouslyUsingInstances=null,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=M,this._key=o;var W,A,q=void 0,T=null;if(j.attributes){var B=j;if(this._engine=g,this._attributesNames=B.attributes,this._uniformsNames=B.uniformsNames.concat(B.samplers),this._samplerList=B.samplers.slice(),this.defines=B.defines,this.onError=B.onError,this.onCompiled=B.onCompiled,this._fallbacks=B.fallbacks,this._indexParameters=B.indexParameters,this._transformFeedbackVaryings=B.transformFeedbackVaryings||null,this._multiTarget=!!B.multiTarget,this._shaderLanguage=null!==(G=B.shaderLanguage)&&void 0!==G?G:Y.b.GLSL,B.uniformBuffersNames){this._uniformBuffersNamesList=B.uniformBuffersNames.slice();for(var N=0;N<B.uniformBuffersNames.length;N++)this._uniformBuffersNames[B.uniformBuffersNames[N]]=N}T=null!==(f=B.processFinalCode)&&void 0!==f?f:null,q=null!==(X=B.processCodeAfterIncludes)&&void 0!==X?X:void 0}else this._engine=E,this.defines=null==s?"":s,this._uniformsNames=g.concat(I),this._samplerList=I?I.slice():[],this._attributesNames=j,this._uniformBuffersNamesList=[],this._shaderLanguage=c,this.onError=z,this.onCompiled=a,this._indexParameters=V,this._fallbacks=i;this._attributeLocationByName={},this.uniqueId=Z._UniqueIdSeed++;var U=(0,b.q)()?this._engine.getHostDocument():null;M.vertexSource?W="source:"+M.vertexSource:M.vertexElement?(W=U?U.getElementById(M.vertexElement):null)||(W=M.vertexElement):W=M.vertex||M,M.fragmentSource?A="source:"+M.fragmentSource:M.fragmentElement?(A=U?U.getElementById(M.fragmentElement):null)||(A=M.fragmentElement):A=M.fragment||M,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);var n={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Q.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:Q.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:q},k=[void 0,void 0],x=function(){if(k[0]&&k[1]){n.isFragment=!0;var Z=k[0],j=k[1];O.b.Process(j,n,(function(j){T&&(j=T("fragment",j));var K=O.b.Finalize(Z,j,n);d._useFinalCode(K.vertexCode,K.fragmentCode,M)}),d._engine)}};this._loadShader(W,"Vertex","",(function(Z){O.b.Initialize(n),O.b.Process(Z,n,(function(M){d._rawVertexSourceCode=Z,T&&(M=T("vertex",M)),k[0]=M,x()}),d._engine)})),this._loadShader(A,"Fragment","Pixel",(function(Z){d._rawFragmentSourceCode=Z,k[1]=Z,x()}))}return Object.defineProperty(Z,"ShadersRepository",{get:function(){return Q.d.ShadersRepository},set:function(Z){Q.d.ShadersRepository=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new K.b),this._onBindObservable},enumerable:!1,configurable:!0}),Z.prototype._useFinalCode=function(Z,M,j){if(j){var K=j.vertexElement||j.vertex||j.spectorName||j,b=j.fragmentElement||j.fragment||j.spectorName||j;this._vertexSourceCode=(this._shaderLanguage===Y.b.WGSL?"//":"")+"#define SHADER_NAME vertex:"+K+"\n"+Z,this._fragmentSourceCode=(this._shaderLanguage===Y.b.WGSL?"//":"")+"#define SHADER_NAME fragment:"+b+"\n"+M}else this._vertexSourceCode=Z,this._fragmentSourceCode=M;this._prepareEffect()},Object.defineProperty(Z.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),Z.prototype.isReady=function(){try{return this._isReadyInternal()}catch(Z){return!1}},Z.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},Z.prototype.getEngine=function(){return this._engine},Z.prototype.getPipelineContext=function(){return this._pipelineContext},Z.prototype.getAttributesNames=function(){return this._attributesNames},Z.prototype.getAttributeLocation=function(Z){return this._attributes[Z]},Z.prototype.getAttributeLocationByName=function(Z){return this._attributeLocationByName[Z]},Z.prototype.getAttributesCount=function(){return this._attributes.length},Z.prototype.getUniformIndex=function(Z){return this._uniformsNames.indexOf(Z)},Z.prototype.getUniform=function(Z){return this._uniforms[Z]},Z.prototype.getSamplers=function(){return this._samplerList},Z.prototype.getUniformNames=function(){return this._uniformsNames},Z.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},Z.prototype.getIndexParameters=function(){return this._indexParameters},Z.prototype.getCompilationError=function(){return this._compilationError},Z.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},Z.prototype.executeWhenCompiled=function(Z){var M=this;this.isReady()?Z(this):(this.onCompileObservable.add((function(M){Z(M)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){M._checkIsReady(null)}),16))},Z.prototype._checkIsReady=function(Z){var M=this;try{if(this._isReadyInternal())return}catch(M){return void this._processCompilationErrors(M,Z)}this._isDisposed||setTimeout((function(){M._checkIsReady(Z)}),16)},Z.prototype._loadShader=function(Z,M,j,K){if("undefined"!==typeof HTMLElement&&Z instanceof HTMLElement)return void K((0,b.g)(Z));if("source:"!==Z.substr(0,7))if("base64:"!==Z.substr(0,7)){var g,O=Q.d.GetShadersStore(this._shaderLanguage);if(O[Z+M+"Shader"])K(O[Z+M+"Shader"]);else if(j&&O[Z+j+"Shader"])K(O[Z+j+"Shader"]);else g="."===Z[0]||"/"===Z[0]||Z.indexOf("http")>-1?Z:Q.d.GetShadersRepository(this._shaderLanguage)+Z,this._engine._loadFile(g+"."+M.toLowerCase()+".fx",K)}else{K(window.atob(Z.substr(7)))}else K(Z.substr(7))},Object.defineProperty(Z.prototype,"vertexSourceCode",{get:function(){var Z,M;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(M=null===(Z=this._pipelineContext)||void 0===Z?void 0:Z._getVertexShaderCode())&&void 0!==M?M:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"fragmentSourceCode",{get:function(){var Z,M;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(M=null===(Z=this._pipelineContext)||void 0===Z?void 0:Z._getFragmentShaderCode())&&void 0!==M?M:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),Z.prototype._rebuildProgram=function(Z,M,j,K){var b=this;this._isReady=!1,this._vertexSourceCodeOverride=Z,this._fragmentSourceCodeOverride=M,this.onError=function(Z,M){K&&K(M)},this.onCompiled=function(){var Z=b.getEngine().scenes;if(Z)for(var M=0;M<Z.length;M++)Z[M].markAllMaterialsAsDirty(63);b._pipelineContext._handlesSpectorRebuildCallback(j)},this._fallbacks=null,this._prepareEffect()},Z.prototype._prepareEffect=function(){var Z=this,M=this._attributesNames,j=this.defines,K=this._pipelineContext;this._isReady=!1;try{var b=this._engine;this._pipelineContext=b.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var g=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?b._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,g,null,this._transformFeedbackVaryings,this._key):b._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,g,j,this._transformFeedbackVaryings,this._key),b._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(Z._attributes=[],Z._pipelineContext._fillEffectInformation(Z,Z._uniformBuffersNames,Z._uniformsNames,Z._uniforms,Z._samplerList,Z._samplers,M,Z._attributes),M)for(var j=0;j<M.length;j++){var g=M[j];Z._attributeLocationByName[g]=Z._attributes[j]}b.bindSamplers(Z),Z._compilationError="",Z._isReady=!0,Z.onCompiled&&Z.onCompiled(Z),Z.onCompileObservable.notifyObservers(Z),Z.onCompileObservable.clear(),Z._fallbacks&&Z._fallbacks.unBindMesh(),K&&Z.getEngine()._deletePipelineContext(K)})),this._pipelineContext.isAsync&&this._checkIsReady(K)}catch(Z){this._processCompilationErrors(Z,K)}},Z.prototype._getShaderCodeAndErrorLine=function(Z,M,j){var K=j?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,b=null;if(M&&Z){var g=M.match(K);if(g&&2===g.length){var O=parseInt(g[1]),Q=Z.split("\n",-1);Q.length>=O&&(b="Offending line [".concat(O,"] in ").concat(j?"fragment":"vertex"," code: ").concat(Q[O-1]))}}return[Z,b]},Z.prototype._processCompilationErrors=function(M,j){var K,b,O,Q,Y;void 0===j&&(j=null),this._compilationError=M.message;var I=this._attributesNames,E=this._fallbacks;if(g.c.Error("Unable to compile effect:"),g.c.Error("Uniforms: "+this._uniformsNames.map((function(Z){return" "+Z}))),g.c.Error("Attributes: "+I.map((function(Z){return" "+Z}))),g.c.Error("Defines:\r\n"+this.defines),Z.LogShaderCodeOnCompilationError){var s=null,i=null,a=null;(null===(O=this._pipelineContext)||void 0===O?void 0:O._getVertexShaderCode())&&(a=(K=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],s=K[1],a&&(g.c.Error("Vertex code:"),g.c.Error(a))),(null===(Q=this._pipelineContext)||void 0===Q?void 0:Q._getFragmentShaderCode())&&(a=(b=this._getShaderCodeAndErrorLine(null===(Y=this._pipelineContext)||void 0===Y?void 0:Y._getFragmentShaderCode(),this._compilationError,!0))[0],i=b[1],a&&(g.c.Error("Fragment code:"),g.c.Error(a))),s&&g.c.Error(s),i&&g.c.Error(i)}g.c.Error("Error: "+this._compilationError),j&&(this._pipelineContext=j,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),E?(this._pipelineContext=null,E.hasMoreFallbacks?(this._allFallbacksProcessed=!1,g.c.Error("Trying next fallback."),this.defines=E.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(Z.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!1,configurable:!0}),Z.prototype._bindTexture=function(Z,M){this._engine._bindTexture(this._samplers[Z],M,Z)},Z.prototype.setTexture=function(Z,M){this._engine.setTexture(this._samplers[Z],this._uniforms[Z],M,Z)},Z.prototype.setDepthStencilTexture=function(Z,M){this._engine.setDepthStencilTexture(this._samplers[Z],this._uniforms[Z],M,Z)},Z.prototype.setTextureArray=function(Z,M){var j=Z+"Ex";if(-1===this._samplerList.indexOf(j+"0")){for(var K=this._samplerList.indexOf(Z),b=1;b<M.length;b++){var g=j+(b-1).toString();this._samplerList.splice(K+b,0,g)}for(var O=0,Q=0,Y=this._samplerList;Q<Y.length;Q++){var I=Y[Q];this._samplers[I]=O,O+=1}}this._engine.setTextureArray(this._samplers[Z],this._uniforms[Z],M,Z)},Z.prototype.setTextureFromPostProcess=function(Z,M){this._engine.setTextureFromPostProcess(this._samplers[Z],M,Z)},Z.prototype.setTextureFromPostProcessOutput=function(Z,M){this._engine.setTextureFromPostProcessOutput(this._samplers[Z],M,Z)},Z.prototype.bindUniformBuffer=function(M,j){var K=this._uniformBuffersNames[j];void 0===K||Z._BaseCache[K]===M&&this._engine._features.useUBOBindingCache||(Z._BaseCache[K]=M,this._engine.bindUniformBufferBase(M,K,j))},Z.prototype.bindUniformBlock=function(Z,M){this._engine.bindUniformBlock(this._pipelineContext,Z,M)},Z.prototype.setInt=function(Z,M){return this._pipelineContext.setInt(Z,M),this},Z.prototype.setInt2=function(Z,M,j){return this._pipelineContext.setInt2(Z,M,j),this},Z.prototype.setInt3=function(Z,M,j,K){return this._pipelineContext.setInt3(Z,M,j,K),this},Z.prototype.setInt4=function(Z,M,j,K,b){return this._pipelineContext.setInt4(Z,M,j,K,b),this},Z.prototype.setIntArray=function(Z,M){return this._pipelineContext.setIntArray(Z,M),this},Z.prototype.setIntArray2=function(Z,M){return this._pipelineContext.setIntArray2(Z,M),this},Z.prototype.setIntArray3=function(Z,M){return this._pipelineContext.setIntArray3(Z,M),this},Z.prototype.setIntArray4=function(Z,M){return this._pipelineContext.setIntArray4(Z,M),this},Z.prototype.setFloatArray=function(Z,M){return this._pipelineContext.setArray(Z,M),this},Z.prototype.setFloatArray2=function(Z,M){return this._pipelineContext.setArray2(Z,M),this},Z.prototype.setFloatArray3=function(Z,M){return this._pipelineContext.setArray3(Z,M),this},Z.prototype.setFloatArray4=function(Z,M){return this._pipelineContext.setArray4(Z,M),this},Z.prototype.setArray=function(Z,M){return this._pipelineContext.setArray(Z,M),this},Z.prototype.setArray2=function(Z,M){return this._pipelineContext.setArray2(Z,M),this},Z.prototype.setArray3=function(Z,M){return this._pipelineContext.setArray3(Z,M),this},Z.prototype.setArray4=function(Z,M){return this._pipelineContext.setArray4(Z,M),this},Z.prototype.setMatrices=function(Z,M){return this._pipelineContext.setMatrices(Z,M),this},Z.prototype.setMatrix=function(Z,M){return this._pipelineContext.setMatrix(Z,M),this},Z.prototype.setMatrix3x3=function(Z,M){return this._pipelineContext.setMatrix3x3(Z,M),this},Z.prototype.setMatrix2x2=function(Z,M){return this._pipelineContext.setMatrix2x2(Z,M),this},Z.prototype.setFloat=function(Z,M){return this._pipelineContext.setFloat(Z,M),this},Z.prototype.setBool=function(Z,M){return this._pipelineContext.setInt(Z,M?1:0),this},Z.prototype.setVector2=function(Z,M){return this._pipelineContext.setVector2(Z,M),this},Z.prototype.setFloat2=function(Z,M,j){return this._pipelineContext.setFloat2(Z,M,j),this},Z.prototype.setVector3=function(Z,M){return this._pipelineContext.setVector3(Z,M),this},Z.prototype.setFloat3=function(Z,M,j,K){return this._pipelineContext.setFloat3(Z,M,j,K),this},Z.prototype.setVector4=function(Z,M){return this._pipelineContext.setVector4(Z,M),this},Z.prototype.setQuaternion=function(Z,M){return this._pipelineContext.setQuaternion(Z,M),this},Z.prototype.setFloat4=function(Z,M,j,K,b){return this._pipelineContext.setFloat4(Z,M,j,K,b),this},Z.prototype.setColor3=function(Z,M){return this._pipelineContext.setColor3(Z,M),this},Z.prototype.setColor4=function(Z,M,j){return this._pipelineContext.setColor4(Z,M,j),this},Z.prototype.setDirectColor4=function(Z,M){return this._pipelineContext.setDirectColor4(Z,M),this},Z.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0},Z.RegisterShader=function(Z,M,j,K){void 0===K&&(K=Y.b.GLSL),M&&(Q.d.GetShadersStore(K)["".concat(Z,"PixelShader")]=M),j&&(Q.d.GetShadersStore(K)["".concat(Z,"VertexShader")]=j)},Z.ResetCache=function(){Z._BaseCache={}},Z.LogShaderCodeOnCompilationError=!0,Z._UniqueIdSeed=0,Z._BaseCache={},Z.ShadersStore=Q.d.ShadersStore,Z.IncludesShadersStore=Q.d.IncludesShadersStore,Z}()},54497:function(Z,M,j){"use strict";j.d(M,{b:function(){return K}});var K=function(){function Z(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return Z.prototype.unBindMesh=function(){this._mesh=null},Z.prototype.addFallback=function(Z,M){this._defines[Z]||(Z<this._currentRank&&(this._currentRank=Z),Z>this._maxRank&&(this._maxRank=Z),this._defines[Z]=new Array),this._defines[Z].push(M)},Z.prototype.addCPUSkinningFallback=function(Z,M){this._mesh=M,Z<this._currentRank&&(this._currentRank=Z),Z>this._maxRank&&(this._maxRank=Z)},Object.defineProperty(Z.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!1,configurable:!0}),Z.prototype.reduce=function(Z,M){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,Z=Z.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),M._bonesComputationForcedToCPU=!0;for(var j=this._mesh.getScene(),K=0;K<j.meshes.length;K++){var b=j.meshes[K];if(b.material){if(b.computeBonesUsingShaders&&0!==b.numBoneInfluencers)if(b.material.getEffect()===M)b.computeBonesUsingShaders=!1;else if(b.subMeshes)for(var g=0,O=b.subMeshes;g<O.length;g++){if(O[g].effect===M){b.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&b.computeBonesUsingShaders&&b.numBoneInfluencers>0&&(b.computeBonesUsingShaders=!1)}}else{var Q=this._defines[this._currentRank];if(Q)for(K=0;K<Q.length;K++)Z=Z.replace("#define "+Q[K],"");this._currentRank++}return Z},Z}()},23016:function(Z,M,j){"use strict";j.d(M,{e:function(){return s},b:function(){return E}});var K=j(40061),b=j(9892),g=j(9271),O=j(9217),Q=j(9488),Y=j(4241),I=function(){function Z(){this._dirty=!0,this._tempColor=new Q.g(0,0,0,0),this._globalCurve=new Q.g(0,0,0,0),this._highlightsCurve=new Q.g(0,0,0,0),this._midtonesCurve=new Q.g(0,0,0,0),this._shadowsCurve=new Q.g(0,0,0,0),this._positiveCurve=new Q.g(0,0,0,0),this._negativeCurve=new Q.g(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(Z.prototype,"globalHue",{get:function(){return this._globalHue},set:function(Z){this._globalHue=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(Z){this._globalDensity=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(Z){this._globalSaturation=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(Z){this._globalExposure=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(Z){this._highlightsHue=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(Z){this._highlightsDensity=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(Z){this._highlightsSaturation=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(Z){this._highlightsExposure=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(Z){this._midtonesHue=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(Z){this._midtonesDensity=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(Z){this._midtonesSaturation=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(Z){this._midtonesExposure=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(Z){this._shadowsHue=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(Z){this._shadowsDensity=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(Z){this._shadowsSaturation=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(Z){this._shadowsExposure=Z,this._dirty=!0},enumerable:!1,configurable:!0}),Z.prototype.getClassName=function(){return"ColorCurves"},Z.Bind=function(Z,M,j,K,b){void 0===j&&(j="vCameraColorCurvePositive"),void 0===K&&(K="vCameraColorCurveNeutral"),void 0===b&&(b="vCameraColorCurveNegative"),Z._dirty&&(Z._dirty=!1,Z._getColorGradingDataToRef(Z._globalHue,Z._globalDensity,Z._globalSaturation,Z._globalExposure,Z._globalCurve),Z._getColorGradingDataToRef(Z._highlightsHue,Z._highlightsDensity,Z._highlightsSaturation,Z._highlightsExposure,Z._tempColor),Z._tempColor.multiplyToRef(Z._globalCurve,Z._highlightsCurve),Z._getColorGradingDataToRef(Z._midtonesHue,Z._midtonesDensity,Z._midtonesSaturation,Z._midtonesExposure,Z._tempColor),Z._tempColor.multiplyToRef(Z._globalCurve,Z._midtonesCurve),Z._getColorGradingDataToRef(Z._shadowsHue,Z._shadowsDensity,Z._shadowsSaturation,Z._shadowsExposure,Z._tempColor),Z._tempColor.multiplyToRef(Z._globalCurve,Z._shadowsCurve),Z._highlightsCurve.subtractToRef(Z._midtonesCurve,Z._positiveCurve),Z._midtonesCurve.subtractToRef(Z._shadowsCurve,Z._negativeCurve)),M&&(M.setFloat4(j,Z._positiveCurve.r,Z._positiveCurve.g,Z._positiveCurve.b,Z._positiveCurve.a),M.setFloat4(K,Z._midtonesCurve.r,Z._midtonesCurve.g,Z._midtonesCurve.b,Z._midtonesCurve.a),M.setFloat4(b,Z._negativeCurve.r,Z._negativeCurve.g,Z._negativeCurve.b,Z._negativeCurve.a))},Z.PrepareUniforms=function(Z){Z.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},Z.prototype._getColorGradingDataToRef=function(M,j,K,b,g){null!=M&&(M=Z._Clamp(M,0,360),j=Z._Clamp(j,-100,100),K=Z._Clamp(K,-100,100),b=Z._Clamp(b,-100,100),j=Z._ApplyColorGradingSliderNonlinear(j),j*=.5,b=Z._ApplyColorGradingSliderNonlinear(b),j<0&&(j*=-1,M=(M+180)%360),Z._FromHSBToRef(M,j,50+.25*b,g),g.scaleToRef(2,g),g.a=1+.01*K)},Z._ApplyColorGradingSliderNonlinear=function(Z){Z/=100;var M=Math.abs(Z);return M=Math.pow(M,2),Z<0&&(M*=-1),M*=100},Z._FromHSBToRef=function(M,j,K,b){var g=Z._Clamp(M,0,360),O=Z._Clamp(j/100,0,1),Q=Z._Clamp(K/100,0,1);if(0===O)b.r=Q,b.g=Q,b.b=Q;else{g/=60;var Y=Math.floor(g),I=g-Y,E=Q*(1-O),s=Q*(1-O*I),i=Q*(1-O*(1-I));switch(Y){case 0:b.r=Q,b.g=i,b.b=E;break;case 1:b.r=s,b.g=Q,b.b=E;break;case 2:b.r=E,b.g=Q,b.b=i;break;case 3:b.r=E,b.g=s,b.b=Q;break;case 4:b.r=i,b.g=E,b.b=Q;break;default:b.r=Q,b.g=E,b.b=s}}b.a=1},Z._Clamp=function(Z,M,j){return Math.min(Math.max(Z,M),j)},Z.prototype.clone=function(){return b.b.Clone((function(){return new Z}),this)},Z.prototype.serialize=function(){return b.b.Serialize(this)},Z.Parse=function(M){return b.b.Parse((function(){return new Z}),M,null,null)},(0,K.l)([(0,b.z)()],Z.prototype,"_globalHue",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_globalDensity",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_globalSaturation",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_globalExposure",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_highlightsHue",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_highlightsDensity",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_highlightsSaturation",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_highlightsExposure",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_midtonesHue",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_midtonesDensity",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_midtonesSaturation",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_midtonesExposure",void 0),Z}();b.b._ColorCurvesParser=I.Parse;var E=function(Z){function M(){var M=Z.call(this)||this;return M.IMAGEPROCESSING=!1,M.VIGNETTE=!1,M.VIGNETTEBLENDMODEMULTIPLY=!1,M.VIGNETTEBLENDMODEOPAQUE=!1,M.TONEMAPPING=!1,M.TONEMAPPING_ACES=!1,M.CONTRAST=!1,M.COLORCURVES=!1,M.COLORGRADING=!1,M.COLORGRADING3D=!1,M.SAMPLER3DGREENDEPTH=!1,M.SAMPLER3DBGRMAP=!1,M.IMAGEPROCESSINGPOSTPROCESS=!1,M.EXPOSURE=!1,M.SKIPFINALCOLORCLAMP=!1,M.rebuild(),M}return(0,K.m)(M,Z),M}(Y.c),s=function(){function Z(){this.colorCurves=new I,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=Z.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new Q.g(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=Z.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new g.b}return Object.defineProperty(Z.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(Z){this._colorCurvesEnabled!==Z&&(this._colorCurvesEnabled=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(Z){this._colorGradingTexture!==Z&&(this._colorGradingTexture=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(Z){this._colorGradingEnabled!==Z&&(this._colorGradingEnabled=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(Z){this._colorGradingWithGreenDepth!==Z&&(this._colorGradingWithGreenDepth=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(Z){this._colorGradingBGR!==Z&&(this._colorGradingBGR=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"exposure",{get:function(){return this._exposure},set:function(Z){this._exposure!==Z&&(this._exposure=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(Z){this._toneMappingEnabled!==Z&&(this._toneMappingEnabled=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(Z){this._toneMappingType!==Z&&(this._toneMappingType=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"contrast",{get:function(){return this._contrast},set:function(Z){this._contrast!==Z&&(this._contrast=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(Z){this._vignetteBlendMode!==Z&&(this._vignetteBlendMode=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(Z){this._vignetteEnabled!==Z&&(this._vignetteEnabled=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"skipFinalColorClamp",{get:function(){return this._skipFinalColorClamp},set:function(Z){this._skipFinalColorClamp!==Z&&(this._skipFinalColorClamp=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(Z){this._applyByPostProcess!==Z&&(this._applyByPostProcess=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(Z){this._isEnabled!==Z&&(this._isEnabled=Z,this._updateParameters())},enumerable:!1,configurable:!0}),Z.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},Z.prototype.getClassName=function(){return"ImageProcessingConfiguration"},Z.PrepareUniforms=function(Z,M){M.EXPOSURE&&Z.push("exposureLinear"),M.CONTRAST&&Z.push("contrast"),M.COLORGRADING&&Z.push("colorTransformSettings"),M.VIGNETTE&&(Z.push("vInverseScreenSize"),Z.push("vignetteSettings1"),Z.push("vignetteSettings2")),M.COLORCURVES&&I.PrepareUniforms(Z)},Z.PrepareSamplers=function(Z,M){M.COLORGRADING&&Z.push("txColorTransform")},Z.prototype.prepareDefines=function(M,j){if(void 0===j&&(j=!1),j!==this.applyByPostProcess||!this._isEnabled)return M.VIGNETTE=!1,M.TONEMAPPING=!1,M.TONEMAPPING_ACES=!1,M.CONTRAST=!1,M.EXPOSURE=!1,M.COLORCURVES=!1,M.COLORGRADING=!1,M.COLORGRADING3D=!1,M.IMAGEPROCESSING=!1,M.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(M.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(M.VIGNETTE=this.vignetteEnabled,M.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===Z._VIGNETTEMODE_MULTIPLY,M.VIGNETTEBLENDMODEOPAQUE=!M.VIGNETTEBLENDMODEMULTIPLY,M.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType===Z.TONEMAPPING_ACES)M.TONEMAPPING_ACES=!0;else M.TONEMAPPING_ACES=!1;M.CONTRAST=1!==this.contrast,M.EXPOSURE=1!==this.exposure,M.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,M.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,M.COLORGRADING?M.COLORGRADING3D=this.colorGradingTexture.is3D:M.COLORGRADING3D=!1,M.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,M.SAMPLER3DBGRMAP=this.colorGradingBGR,M.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,M.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,M.IMAGEPROCESSING=M.VIGNETTE||M.TONEMAPPING||M.CONTRAST||M.EXPOSURE||M.COLORCURVES||M.COLORGRADING},Z.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},Z.prototype.bind=function(Z,M){if(this._colorCurvesEnabled&&this.colorCurves&&I.Bind(this.colorCurves,Z),this._vignetteEnabled){var j=1/Z.getEngine().getRenderWidth(),K=1/Z.getEngine().getRenderHeight();Z.setFloat2("vInverseScreenSize",j,K);var b=null!=M?M:K/j,g=Math.tan(.5*this.vignetteCameraFov),Q=g*b,Y=Math.sqrt(Q*g);Q=O.d.Mix(Q,Y,this.vignetteStretch),g=O.d.Mix(g,Y,this.vignetteStretch),Z.setFloat4("vignetteSettings1",Q,g,-Q*this.vignetteCentreX,-g*this.vignetteCentreY);var E=-2*this.vignetteWeight;Z.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,E)}if(Z.setFloat("exposureLinear",this.exposure),Z.setFloat("contrast",this.contrast),this.colorGradingTexture){Z.setTexture("txColorTransform",this.colorGradingTexture);var s=this.colorGradingTexture.getSize().height;Z.setFloat4("colorTransformSettings",(s-1)/s,.5/s,s,this.colorGradingTexture.level)}},Z.prototype.clone=function(){return b.b.Clone((function(){return new Z}),this)},Z.prototype.serialize=function(){return b.b.Serialize(this)},Z.Parse=function(M){return b.b.Parse((function(){return new Z}),M,null,null)},Object.defineProperty(Z,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),Z.TONEMAPPING_STANDARD=0,Z.TONEMAPPING_ACES=1,Z._VIGNETTEMODE_MULTIPLY=0,Z._VIGNETTEMODE_OPAQUE=1,(0,K.l)([(0,b.h)()],Z.prototype,"colorCurves",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_colorCurvesEnabled",void 0),(0,K.l)([(0,b.s)("colorGradingTexture")],Z.prototype,"_colorGradingTexture",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_colorGradingEnabled",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_colorGradingWithGreenDepth",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_colorGradingBGR",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_exposure",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_toneMappingEnabled",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_toneMappingType",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_contrast",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"vignetteStretch",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"vignetteCentreX",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"vignetteCentreY",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"vignetteWeight",void 0),(0,K.l)([(0,b.j)()],Z.prototype,"vignetteColor",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"vignetteCameraFov",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_vignetteBlendMode",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_vignetteEnabled",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_skipFinalColorClamp",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_applyByPostProcess",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_isEnabled",void 0),Z}();b.b._ImageProcessingConfigurationParser=s.Parse},56513:function(Z,M,j){"use strict";j.d(M,{d:function(){return s}});var K=j(40061),b=j(46907),g=j(9892),O=j(37001),Q=j(33048),Y=j(4241),I=j(96558),E=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.DETAIL=!1,M.DETAILDIRECTUV=0,M.DETAIL_NORMALBLENDMETHOD=0,M}return(0,K.m)(M,Z),M}(Y.c),s=function(Z){function M(M,j){void 0===j&&(j=!0);var K=Z.call(this,M,"DetailMap",140,new E,j)||this;return K._texture=null,K.diffuseBlendLevel=1,K.roughnessBlendLevel=1,K.bumpLevel=1,K._normalBlendMethod=b.d.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,K._isEnabled=!1,K.isEnabled=!1,K._internalMarkAllSubMeshesAsTexturesDirty=M._dirtyCallbacks[1],K}return(0,K.m)(M,Z),M.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},M.prototype.isReadyForSubMesh=function(Z,M,j){return!this._isEnabled||!(Z._areTexturesDirty&&M.texturesEnabled&&j.getCaps().standardDerivatives&&this._texture&&O.d.DetailTextureEnabled&&!this._texture.isReady())},M.prototype.prepareDefines=function(Z,M){if(this._isEnabled){Z.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var j=M.getEngine();Z._areTexturesDirty&&(j.getCaps().standardDerivatives&&this._texture&&O.d.DetailTextureEnabled&&this._isEnabled?(Q.b.PrepareDefinesForMergedUV(this._texture,Z,"DETAIL"),Z.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):Z.DETAIL=!1)}else Z.DETAIL=!1},M.prototype.bindForSubMesh=function(Z,M){if(this._isEnabled){var j=this._material.isFrozen;Z.useUbo&&j&&Z.isSync||this._texture&&O.d.DetailTextureEnabled&&(Z.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),Q.b.BindTextureMatrix(this._texture,Z,"detail")),M.texturesEnabled&&this._texture&&O.d.DetailTextureEnabled&&Z.setTexture("detailSampler",this._texture)}},M.prototype.hasTexture=function(Z){return this._texture===Z},M.prototype.getActiveTextures=function(Z){this._texture&&Z.push(this._texture)},M.prototype.getAnimatables=function(Z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&Z.push(this._texture)},M.prototype.dispose=function(Z){var M;Z&&(null===(M=this._texture)||void 0===M||M.dispose())},M.prototype.getClassName=function(){return"DetailMapConfiguration"},M.prototype.getSamplers=function(Z){Z.push("detailSampler")},M.prototype.getUniforms=function(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}},(0,K.l)([(0,g.s)("detailTexture"),(0,g.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"texture",void 0),(0,K.l)([(0,g.z)()],M.prototype,"diffuseBlendLevel",void 0),(0,K.l)([(0,g.z)()],M.prototype,"roughnessBlendLevel",void 0),(0,K.l)([(0,g.z)()],M.prototype,"bumpLevel",void 0),(0,K.l)([(0,g.z)(),(0,g.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"normalBlendMethod",void 0),(0,K.l)([(0,g.z)(),(0,g.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isEnabled",void 0),M}(I.c)},46907:function(Z,M,j){"use strict";j.d(M,{d:function(){return o}});var K=j(40061),b=j(9892),g=j(9217),O=j(9271),Q=j(78588),Y=j(50384),I=j(90534),E=j(9127),s=j(85567),i=j(33048),a=j(61803),z=function(){function Z(){this.reset()}return Z.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681},Object.defineProperty(Z.prototype,"func",{get:function(){return this._func},set:function(Z){this._func=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"funcRef",{get:function(){return this._funcRef},set:function(Z){this._funcRef=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"funcMask",{get:function(){return this._funcMask},set:function(Z){this._funcMask=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(Z){this._opStencilFail=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(Z){this._opDepthFail=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(Z){this._opStencilDepthPass=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"mask",{get:function(){return this._mask},set:function(Z){this._mask=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"enabled",{get:function(){return this._enabled},set:function(Z){this._enabled=Z},enumerable:!1,configurable:!0}),Z.prototype.getClassName=function(){return"MaterialStencilState"},Z.prototype.copyTo=function(Z){b.b.Clone((function(){return Z}),this)},Z.prototype.serialize=function(){return b.b.Serialize(this)},Z.prototype.parse=function(Z,M,j){var K=this;b.b.Parse((function(){return K}),Z,M,j)},(0,K.l)([(0,b.z)()],Z.prototype,"func",null),(0,K.l)([(0,b.z)()],Z.prototype,"funcRef",null),(0,K.l)([(0,b.z)()],Z.prototype,"funcMask",null),(0,K.l)([(0,b.z)()],Z.prototype,"opStencilFail",null),(0,K.l)([(0,b.z)()],Z.prototype,"opDepthFail",null),(0,K.l)([(0,b.z)()],Z.prototype,"opStencilDepthPass",null),(0,K.l)([(0,b.z)()],Z.prototype,"mask",null),(0,K.l)([(0,b.z)()],Z.prototype,"enabled",null),Z}(),V=j(38956),o=function(){function Z(M,j,K){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new O.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new z,this._useUBO=!1,this._fillMode=Z.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=function(){},this._callbackPluginEventIsReadyForSubMesh=function(){},this._callbackPluginEventPrepareDefines=function(){},this._callbackPluginEventPrepareDefinesBeforeAttributes=function(){},this._callbackPluginEventHardBindForSubMesh=function(){},this._callbackPluginEventBindForSubMesh=function(){},this._callbackPluginEventHasRenderTargetTextures=function(){},this._callbackPluginEventFillRenderTargetTextures=function(){},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=M;var b=j||Q.e.LastCreatedScene;b&&(this._scene=b,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=M||g.d.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new a.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._scene.useRightHandedSystem?this.sideOrientation=Z.ClockWiseSideOrientation:this.sideOrientation=Z.CounterClockWiseSideOrientation,this._uniformBuffer=new I.d(this._scene.getEngine(),void 0,void 0,M),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,K||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),Z.OnEventObservable.notifyObservers(this,V.e.Created))}return Object.defineProperty(Z.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"alpha",{get:function(){return this._alpha},set:function(M){if(this._alpha!==M){var j=this._alpha;this._alpha=M,1!==j&&1!==M||this.markAsDirty(Z.MiscDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(M){this._backFaceCulling!==M&&(this._backFaceCulling=M,this.markAsDirty(Z.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"cullBackFaces",{get:function(){return this._cullBackFaces},set:function(M){this._cullBackFaces!==M&&(this._cullBackFaces=M,this.markAsDirty(Z.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"hasRenderTargetTextures",{get:function(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onDispose",{set:function(Z){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new O.b),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onBind",{set:function(Z){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new O.b),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new O.b),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(M){this._alphaMode!==M&&(this._alphaMode=M,this.markAsDirty(Z.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(Z){this._needDepthPrePass!==Z&&(this._needDepthPrePass=Z,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isPrePassCapable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(M){this._fogEnabled!==M&&(this._fogEnabled=M,this.markAsDirty(Z.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"wireframe",{get:function(){switch(this._fillMode){case Z.WireFrameFillMode:case Z.LineListDrawMode:case Z.LineLoopDrawMode:case Z.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(M){this.fillMode=M?Z.WireFrameFillMode:Z.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case Z.PointFillMode:case Z.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(M){this.fillMode=M?Z.PointFillMode:Z.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"fillMode",{get:function(){return this._fillMode},set:function(M){this._fillMode!==M&&(this._fillMode=M,this.markAsDirty(Z.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Z.prototype._getDrawWrapper=function(){return this._drawWrapper},Z.prototype._setDrawWrapper=function(Z){this._drawWrapper=Z},Z.prototype.toString=function(Z){return"Name: "+this.name},Z.prototype.getClassName=function(){return"Material"},Object.defineProperty(Z.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),Z.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},Z.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},Z.prototype.isReady=function(Z,M){return!0},Z.prototype.isReadyForSubMesh=function(Z,M,j){var K=M.materialDefines;return!!K&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=K,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)},Z.prototype.getEffect=function(){return this._drawWrapper.effect},Z.prototype.getScene=function(){return this._scene},Object.defineProperty(Z.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(M){this._transparencyMode!==M&&(this._transparencyMode=M,this._forceAlphaTest=M===Z.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===Z.MATERIAL_OPAQUE||this._transparencyMode===Z.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),Z.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&this.alpha<1},Z.prototype.needAlphaBlendingForMesh=function(Z){return!(this._disableAlphaBlending&&Z.visibility>=1)&&(this.needAlphaBlending()||Z.visibility<1||Z.hasVertexAlpha)},Z.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},Z.prototype._shouldTurnAlphaTestOn=function(Z){return!this.needAlphaBlendingForMesh(Z)&&this.needAlphaTesting()},Z.prototype.getAlphaTestTexture=function(){return null},Z.prototype.markDirty=function(){for(var Z=0,M=this.getScene().meshes;Z<M.length;Z++){var j=M[Z];if(j.subMeshes)for(var K=0,b=j.subMeshes;K<b.length;K++){var g=b[K];g.getMaterial()===this&&(g.effect&&(g.effect._wasPreviouslyReady=!1,g.effect._wasPreviouslyUsingInstances=null))}}},Z.prototype._preBind=function(M,j){void 0===j&&(j=null);var K=this._scene.getEngine(),b=(null==j?this.sideOrientation:j)===Z.ClockWiseSideOrientation;return K.enableEffect(M||this._getDrawWrapper()),K.setState(this.backFaceCulling,this.zOffset,!1,b,this.cullBackFaces,this.stencil,this.zOffsetUnits),b},Z.prototype.bind=function(Z,M){},Z.prototype.buildUniformLayout=function(){var Z=this._uniformBuffer;this._eventInfo.ubo=Z,this._callbackPluginEventGeneric(V.e.PrepareUniformBuffer,this._eventInfo),Z.create(),this._uniformBufferLayoutBuilt=!0},Z.prototype.bindForSubMesh=function(Z,M,j){j.effect&&(this._eventInfo.subMesh=j,this._callbackPluginEventBindForSubMesh(this._eventInfo))},Z.prototype.bindOnlyWorldMatrix=function(Z){},Z.prototype.bindView=function(Z){this._useUBO?this._needToBindSceneUbo=!0:Z.setMatrix("view",this.getScene().getViewMatrix())},Z.prototype.bindViewProjection=function(Z){this._useUBO?this._needToBindSceneUbo=!0:(Z.setMatrix("viewProjection",this.getScene().getTransformMatrix()),Z.setMatrix("projection",this.getScene().getProjectionMatrix()))},Z.prototype.bindEyePosition=function(Z,M){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(Z,M)},Z.prototype._afterBind=function(Z,M){if(void 0===M&&(M=null),this._scene._cachedMaterial=this,this._needToBindSceneUbo&&M&&(this._needToBindSceneUbo=!1,i.b.BindSceneUniformBuffer(M,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=Z?Z.visibility:1,this._onBindObservable&&Z&&this._onBindObservable.notifyObservers(Z),this.disableDepthWrite){var j=this._scene.getEngine();this._cachedDepthWriteState=j.getDepthWrite(),j.setDepthWrite(!1)}if(this.disableColorWrite){j=this._scene.getEngine();this._cachedColorWriteState=j.getColorWrite(),j.setColorWrite(!1)}if(0!==this.depthFunction){j=this._scene.getEngine();this._cachedDepthFunctionState=j.getDepthFunction()||0,j.setDepthFunction(this.depthFunction)}},Z.prototype.unbind=function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction)&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState);this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState);this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)},Z.prototype.getAnimatables=function(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(V.e.GetAnimatables,this._eventInfo),this._eventInfo.animatables},Z.prototype.getActiveTextures=function(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(V.e.GetActiveTextures,this._eventInfo),this._eventInfo.activeTextures},Z.prototype.hasTexture=function(Z){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=Z,this._callbackPluginEventGeneric(V.e.HasTexture,this._eventInfo),this._eventInfo.hasTexture},Z.prototype.clone=function(Z){return null},Z.prototype.getBindedMeshes=function(){var Z=this;if(this.meshMap){var M=new Array;for(var j in this.meshMap){var K=this.meshMap[j];K&&M.push(K)}return M}return this._scene.meshes.filter((function(M){return M.material===Z}))},Z.prototype.forceCompilation=function(Z,M,j,b){var g=this,O=(0,K.e)({clipPlane:!1,useInstances:!1},j),Q=this.getScene(),I=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;!function j(){if(g._scene&&g._scene.getEngine()){var K=Q.clipPlane;if(O.clipPlane&&(Q.clipPlane=new s.e(0,0,0,1)),g._storeEffectOnSubMeshes){var E=!0,i=null;if(Z.subMeshes){var a=new Y.b(0,0,0,0,0,Z,void 0,!1,!1);a.materialDefines&&(a.materialDefines._renderId=-1),g.isReadyForSubMesh(Z,a,O.useInstances)||(a.effect&&a.effect.getCompilationError()&&a.effect.allFallbacksProcessed()?i=a.effect.getCompilationError():(E=!1,setTimeout(j,16)))}E&&(g.allowShaderHotSwapping=I,i&&b&&b(i),M&&M(g))}else g.isReady()?(g.allowShaderHotSwapping=I,M&&M(g)):setTimeout(j,16);O.clipPlane&&(Q.clipPlane=K)}}()},Z.prototype.forceCompilationAsync=function(Z,M){var j=this;return new Promise((function(K,b){j.forceCompilation(Z,(function(){K()}),M,(function(Z){b(Z)}))}))},Z.prototype.markAsDirty=function(M){this.getScene().blockMaterialDirtyMechanism||(Z._DirtyCallbackArray.length=0,M&Z.TextureDirtyFlag&&Z._DirtyCallbackArray.push(Z._TextureDirtyCallBack),M&Z.LightDirtyFlag&&Z._DirtyCallbackArray.push(Z._LightsDirtyCallBack),M&Z.FresnelDirtyFlag&&Z._DirtyCallbackArray.push(Z._FresnelDirtyCallBack),M&Z.AttributesDirtyFlag&&Z._DirtyCallbackArray.push(Z._AttributeDirtyCallBack),M&Z.MiscDirtyFlag&&Z._DirtyCallbackArray.push(Z._MiscDirtyCallBack),M&Z.PrePassDirtyFlag&&Z._DirtyCallbackArray.push(Z._PrePassDirtyCallBack),Z._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(Z._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},Z.prototype.resetDrawCache=function(){for(var Z=0,M=this.getScene().meshes;Z<M.length;Z++){var j=M[Z];if(j.subMeshes)for(var K=0,b=j.subMeshes;K<b.length;K++){var g=b[K];g.getMaterial()===this&&g.resetDrawCache()}}},Z.prototype._markAllSubMeshesAsDirty=function(Z){if(!this.getScene().blockMaterialDirtyMechanism)for(var M=0,j=this.getScene().meshes;M<j.length;M++){var K=j[M];if(K.subMeshes)for(var b=0,g=K.subMeshes;b<g.length;b++){var O=g[b];if(O.getMaterial(!1)===this)for(var Q=0,Y=O._drawWrappers;Q<Y.length;Q++){var I=Y[Q];I&&I.defines&&I.defines.markAllAsDirty&&(this._materialContext===I.materialContext&&Z(I.defines))}}}},Z.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var Z=this.getScene().enablePrePassRenderer();Z&&Z.markAsDirty()}},Z.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(Z._AllDirtyCallBack)},Z.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(Z._ImageProcessingDirtyCallBack)},Z.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(Z._TextureDirtyCallBack)},Z.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(Z._FresnelDirtyCallBack)},Z.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(Z._FresnelAndMiscDirtyCallBack)},Z.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(Z._LightsDirtyCallBack)},Z.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(Z._AttributeDirtyCallBack)},Z.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(Z._MiscDirtyCallBack)},Z.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(Z._MiscDirtyCallBack)},Z.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(Z._TextureAndMiscDirtyCallBack)},Z.prototype.setPrePassRenderer=function(Z){return!1},Z.prototype.dispose=function(Z,M,j){var K=this.getScene();if(K.stopAnimation(this),K.freeProcessedMaterials(),K.removeMaterial(this),this._eventInfo.forceDisposeTextures=M,this._callbackPluginEventGeneric(V.e.Disposed,this._eventInfo),this._parentContainer){var b=this._parentContainer.materials.indexOf(this);b>-1&&this._parentContainer.materials.splice(b,1),this._parentContainer=null}if(!0!==j)if(this.meshMap)for(var g in this.meshMap){(Y=this.meshMap[g])&&(Y.material=null,this.releaseVertexArrayObject(Y,Z))}else for(var O=0,Q=K.meshes;O<Q.length;O++){var Y;(Y=Q[O]).material!==this||Y.sourceMesh||(Y.material=null,this.releaseVertexArrayObject(Y,Z))}this._uniformBuffer.dispose(),Z&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},Z.prototype.releaseVertexArrayObject=function(Z,M){if(Z.geometry){var j=Z.geometry;if(this._storeEffectOnSubMeshes)for(var K=0,b=Z.subMeshes;K<b.length;K++){var g=b[K];j._releaseVertexArrayObject(g.effect),M&&g.effect&&g.effect.dispose()}else j._releaseVertexArrayObject(this._drawWrapper.effect)}},Z.prototype.serialize=function(){var Z=b.b.Serialize(this);return Z.stencil=this.stencil.serialize(),Z.uniqueId=this.uniqueId,Z},Z.Parse=function(Z,M,j){if(Z.customType){if("BABYLON.PBRMaterial"===Z.customType&&Z.overloadedAlbedo&&(Z.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return E.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else Z.customType="BABYLON.StandardMaterial";var K=g.d.Instantiate(Z.customType).Parse(Z,M,j);return K._loadedUniqueId=Z.uniqueId,K},Z.TriangleFillMode=0,Z.WireFrameFillMode=1,Z.PointFillMode=2,Z.PointListDrawMode=3,Z.LineListDrawMode=4,Z.LineLoopDrawMode=5,Z.LineStripDrawMode=6,Z.TriangleStripDrawMode=7,Z.TriangleFanDrawMode=8,Z.ClockWiseSideOrientation=0,Z.CounterClockWiseSideOrientation=1,Z.TextureDirtyFlag=1,Z.LightDirtyFlag=2,Z.FresnelDirtyFlag=4,Z.AttributesDirtyFlag=8,Z.MiscDirtyFlag=16,Z.PrePassDirtyFlag=32,Z.AllDirtyFlag=63,Z.MATERIAL_OPAQUE=0,Z.MATERIAL_ALPHATEST=1,Z.MATERIAL_ALPHABLEND=2,Z.MATERIAL_ALPHATESTANDBLEND=3,Z.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,Z.MATERIAL_NORMALBLENDMETHOD_RNM=1,Z.OnEventObservable=new O.b,Z._AllDirtyCallBack=function(Z){return Z.markAllAsDirty()},Z._ImageProcessingDirtyCallBack=function(Z){return Z.markAsImageProcessingDirty()},Z._TextureDirtyCallBack=function(Z){return Z.markAsTexturesDirty()},Z._FresnelDirtyCallBack=function(Z){return Z.markAsFresnelDirty()},Z._MiscDirtyCallBack=function(Z){return Z.markAsMiscDirty()},Z._PrePassDirtyCallBack=function(Z){return Z.markAsPrePassDirty()},Z._LightsDirtyCallBack=function(Z){return Z.markAsLightDirty()},Z._AttributeDirtyCallBack=function(Z){return Z.markAsAttributesDirty()},Z._FresnelAndMiscDirtyCallBack=function(M){Z._FresnelDirtyCallBack(M),Z._MiscDirtyCallBack(M)},Z._TextureAndMiscDirtyCallBack=function(M){Z._TextureDirtyCallBack(M),Z._MiscDirtyCallBack(M)},Z._DirtyCallbackArray=[],Z._RunDirtyCallBacks=function(M){for(var j=0,K=Z._DirtyCallbackArray;j<K.length;j++){(0,K[j])(M)}},(0,K.l)([(0,b.z)()],Z.prototype,"id",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"uniqueId",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"name",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"metadata",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"checkReadyOnEveryCall",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"checkReadyOnlyOnce",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"state",void 0),(0,K.l)([(0,b.z)("alpha")],Z.prototype,"_alpha",void 0),(0,K.l)([(0,b.z)("backFaceCulling")],Z.prototype,"_backFaceCulling",void 0),(0,K.l)([(0,b.z)("cullBackFaces")],Z.prototype,"_cullBackFaces",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"sideOrientation",void 0),(0,K.l)([(0,b.z)("alphaMode")],Z.prototype,"_alphaMode",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"_needDepthPrePass",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"disableDepthWrite",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"disableColorWrite",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"forceDepthWrite",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"depthFunction",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"separateCullingPass",void 0),(0,K.l)([(0,b.z)("fogEnabled")],Z.prototype,"_fogEnabled",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"pointSize",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"zOffset",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"zOffsetUnits",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"pointsCloud",null),(0,K.l)([(0,b.z)()],Z.prototype,"fillMode",null),(0,K.l)([(0,b.z)()],Z.prototype,"transparencyMode",null),Z}()},4241:function(Z,M,j){"use strict";j.d(M,{c:function(){return K}});var K=function(){function Z(Z){if(this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=Z,Z)for(var M in Z)Object.prototype.hasOwnProperty.call(Z,M)&&this._setDefaultValue(M)}return Object.defineProperty(Z.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),Z.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},Z.prototype.markAsUnprocessed=function(){this._isDirty=!0},Z.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},Z.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},Z.prototype.markAsLightDirty=function(Z){void 0===Z&&(Z=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||Z,this._isDirty=!0},Z.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},Z.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},Z.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},Z.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},Z.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},Z.prototype.rebuild=function(){this._keys=[];for(var Z=0,M=Object.keys(this);Z<M.length;Z++){var j=M[Z];"_"!==j[0]&&this._keys.push(j)}if(this._externalProperties)for(var K in this._externalProperties)-1===this._keys.indexOf(K)&&this._keys.push(K)},Z.prototype.isEqual=function(Z){if(this._keys.length!==Z._keys.length)return!1;for(var M=0;M<this._keys.length;M++){var j=this._keys[M];if(this[j]!==Z[j])return!1}return!0},Z.prototype.cloneTo=function(Z){this._keys.length!==Z._keys.length&&(Z._keys=this._keys.slice(0));for(var M=0;M<this._keys.length;M++){var j=this._keys[M];Z[j]=this[j]}},Z.prototype.reset=function(){var Z=this;this._keys.forEach((function(M){return Z._setDefaultValue(M)}))},Z.prototype._setDefaultValue=function(Z){var M,j,K,b,g,O=null!==(K=null===(j=null===(M=this._externalProperties)||void 0===M?void 0:M[Z])||void 0===j?void 0:j.type)&&void 0!==K?K:typeof this[Z],Q=null===(g=null===(b=this._externalProperties)||void 0===b?void 0:b[Z])||void 0===g?void 0:g.default;switch(O){case"number":this[Z]=null!==Q&&void 0!==Q?Q:0;break;case"string":this[Z]=null!==Q&&void 0!==Q?Q:"";break;default:this[Z]=null!==Q&&void 0!==Q&&Q}},Z.prototype.toString=function(){for(var Z="",M=0;M<this._keys.length;M++){var j=this._keys[M],K=this[j];switch(typeof K){case"number":case"string":Z+="#define "+j+" "+K+"\n";break;default:K&&(Z+="#define "+j+"\n")}}return Z},Z}()},37001:function(Z,M,j){"use strict";j.d(M,{d:function(){return b}});var K=j(90690),b=function(){function Z(){}return Object.defineProperty(Z,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(Z){this._DiffuseTextureEnabled!==Z&&(this._DiffuseTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"DetailTextureEnabled",{get:function(){return this._DetailTextureEnabled},set:function(Z){this._DetailTextureEnabled!==Z&&(this._DetailTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(Z){this._AmbientTextureEnabled!==Z&&(this._AmbientTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(Z){this._OpacityTextureEnabled!==Z&&(this._OpacityTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(Z){this._ReflectionTextureEnabled!==Z&&(this._ReflectionTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(Z){this._EmissiveTextureEnabled!==Z&&(this._EmissiveTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(Z){this._SpecularTextureEnabled!==Z&&(this._SpecularTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(Z){this._BumpTextureEnabled!==Z&&(this._BumpTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(Z){this._LightmapTextureEnabled!==Z&&(this._LightmapTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(Z){this._RefractionTextureEnabled!==Z&&(this._RefractionTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(Z){this._ColorGradingTextureEnabled!==Z&&(this._ColorGradingTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(Z){this._FresnelEnabled!==Z&&(this._FresnelEnabled=Z,K.c.MarkAllMaterialsAsDirty(4))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(Z){this._ClearCoatTextureEnabled!==Z&&(this._ClearCoatTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(Z){this._ClearCoatBumpTextureEnabled!==Z&&(this._ClearCoatBumpTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(Z){this._ClearCoatTintTextureEnabled!==Z&&(this._ClearCoatTintTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(Z){this._SheenTextureEnabled!==Z&&(this._SheenTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(Z){this._AnisotropicTextureEnabled!==Z&&(this._AnisotropicTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(Z){this._ThicknessTextureEnabled!==Z&&(this._ThicknessTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"RefractionIntensityTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(Z){this._RefractionIntensityTextureEnabled!==Z&&(this._RefractionIntensityTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"TranslucencyIntensityTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(Z){this._TranslucencyIntensityTextureEnabled!==Z&&(this._TranslucencyIntensityTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"IridescenceTextureEnabled",{get:function(){return this._IridescenceTextureEnabled},set:function(Z){this._IridescenceTextureEnabled!==Z&&(this._IridescenceTextureEnabled=Z,K.c.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Z._DiffuseTextureEnabled=!0,Z._DetailTextureEnabled=!0,Z._AmbientTextureEnabled=!0,Z._OpacityTextureEnabled=!0,Z._ReflectionTextureEnabled=!0,Z._EmissiveTextureEnabled=!0,Z._SpecularTextureEnabled=!0,Z._BumpTextureEnabled=!0,Z._LightmapTextureEnabled=!0,Z._RefractionTextureEnabled=!0,Z._ColorGradingTextureEnabled=!0,Z._FresnelEnabled=!0,Z._ClearCoatTextureEnabled=!0,Z._ClearCoatBumpTextureEnabled=!0,Z._ClearCoatTintTextureEnabled=!0,Z._SheenTextureEnabled=!0,Z._AnisotropicTextureEnabled=!0,Z._ThicknessTextureEnabled=!0,Z._RefractionIntensityTextureEnabled=!0,Z._TranslucencyIntensityTextureEnabled=!0,Z._IridescenceTextureEnabled=!0,Z}()},33048:function(Z,M,j){"use strict";j.d(M,{b:function(){return s}});var K=j(9127),b=j(37643),g=j(37105),O=j(78588),Q=j(43251),Y=j(315),I=j(9488),E=j(86018),s=function(){function Z(){}return Z.BindSceneUniformBuffer=function(Z,M){M.bindToEffect(Z,"Scene")},Z.PrepareDefinesForMergedUV=function(Z,M,j){M._needUVs=!0,M[j]=!0,Z.getTextureMatrix().isIdentityAs3x2()?(M[j+"DIRECTUV"]=Z.coordinatesIndex+1,M["MAINUV"+(Z.coordinatesIndex+1)]=!0):M[j+"DIRECTUV"]=0},Z.BindTextureMatrix=function(Z,M,j){var K=Z.getTextureMatrix();M.updateMatrix(j+"Matrix",K)},Z.GetFogState=function(Z,M){return M.fogEnabled&&Z.applyFog&&M.fogMode!==g.c.FOGMODE_NONE},Z.PrepareDefinesForMisc=function(Z,M,j,K,b,g,O){O._areMiscDirty&&(O.LOGARITHMICDEPTH=j,O.POINTSIZE=K,O.FOG=b&&this.GetFogState(Z,M),O.NONUNIFORMSCALING=Z.nonUniformScaling,O.ALPHATEST=g)},Z.PrepareDefinesForFrameBoundValues=function(Z,M,j,K,b,g){void 0===b&&(b=null),void 0===g&&(g=!1);var O,Q,Y,I,E,s,i=!1;O=null==b?void 0!==Z.clipPlane&&null!==Z.clipPlane:b,Q=null==b?void 0!==Z.clipPlane2&&null!==Z.clipPlane2:b,Y=null==b?void 0!==Z.clipPlane3&&null!==Z.clipPlane3:b,I=null==b?void 0!==Z.clipPlane4&&null!==Z.clipPlane4:b,E=null==b?void 0!==Z.clipPlane5&&null!==Z.clipPlane5:b,s=null==b?void 0!==Z.clipPlane6&&null!==Z.clipPlane6:b,j.CLIPPLANE!==O&&(j.CLIPPLANE=O,i=!0),j.CLIPPLANE2!==Q&&(j.CLIPPLANE2=Q,i=!0),j.CLIPPLANE3!==Y&&(j.CLIPPLANE3=Y,i=!0),j.CLIPPLANE4!==I&&(j.CLIPPLANE4=I,i=!0),j.CLIPPLANE5!==E&&(j.CLIPPLANE5=E,i=!0),j.CLIPPLANE6!==s&&(j.CLIPPLANE6=s,i=!0),j.DEPTHPREPASS!==!M.getColorWrite()&&(j.DEPTHPREPASS=!j.DEPTHPREPASS,i=!0),j.INSTANCES!==K&&(j.INSTANCES=K,i=!0),j.INSTANCESCOLOR&&!j.INSTANCES&&(j.INSTANCESCOLOR=!1,i=!0),j.THIN_INSTANCES!==g&&(j.THIN_INSTANCES=g,i=!0),i&&j.markAsUnprocessed()},Z.PrepareDefinesForBones=function(Z,M){if(Z.useBones&&Z.computeBonesUsingShaders&&Z.skeleton){M.NUM_BONE_INFLUENCERS=Z.numBoneInfluencers;var j=void 0!==M.BONETEXTURE;if(Z.skeleton.isUsingTextureForMatrices&&j)M.BONETEXTURE=!0;else{M.BonesPerMesh=Z.skeleton.bones.length+1,M.BONETEXTURE=!j&&void 0;var K=Z.getScene().prePassRenderer;if(K&&K.enabled){var b=-1===K.excludedSkinnedMesh.indexOf(Z);M.BONES_VELOCITY_ENABLED=b}}}else M.NUM_BONE_INFLUENCERS=0,M.BonesPerMesh=0},Z.PrepareDefinesForMorphTargets=function(Z,M){var j=Z.morphTargetManager;j?(M.MORPHTARGETS_UV=j.supportsUVs&&M.UV1,M.MORPHTARGETS_TANGENT=j.supportsTangents&&M.TANGENT,M.MORPHTARGETS_NORMAL=j.supportsNormals&&M.NORMAL,M.MORPHTARGETS=j.numInfluencers>0,M.NUM_MORPH_INFLUENCERS=j.numInfluencers,M.MORPHTARGETS_TEXTURE=j.isUsingTextureForTargets):(M.MORPHTARGETS_UV=!1,M.MORPHTARGETS_TANGENT=!1,M.MORPHTARGETS_NORMAL=!1,M.MORPHTARGETS=!1,M.NUM_MORPH_INFLUENCERS=0)},Z.PrepareDefinesForBakedVertexAnimation=function(Z,M){var j=Z.bakedVertexAnimationManager;M.BAKED_VERTEX_ANIMATION_TEXTURE=!(!j||!j.isEnabled)},Z.PrepareDefinesForAttributes=function(Z,M,j,K,b,g,O){if(void 0===b&&(b=!1),void 0===g&&(g=!0),void 0===O&&(O=!0),!M._areAttributesDirty&&M._needNormals===M._normals&&M._needUVs===M._uvs)return!1;M._normals=M._needNormals,M._uvs=M._needUVs,M.NORMAL=M._needNormals&&Z.isVerticesDataPresent(Q.f.NormalKind),M._needNormals&&Z.isVerticesDataPresent(Q.f.TangentKind)&&(M.TANGENT=!0);for(var Y=1;Y<=6;++Y)M["UV"+Y]=!!M._needUVs&&Z.isVerticesDataPresent("uv".concat(1===Y?"":Y));if(j){var I=Z.useVertexColors&&Z.isVerticesDataPresent(Q.f.ColorKind);M.VERTEXCOLOR=I,M.VERTEXALPHA=Z.hasVertexAlpha&&I&&g}return Z.isVerticesDataPresent(Q.f.ColorInstanceKind)&&(Z.hasInstances||Z.hasThinInstances)&&(M.INSTANCESCOLOR=!0),K&&this.PrepareDefinesForBones(Z,M),b&&this.PrepareDefinesForMorphTargets(Z,M),O&&this.PrepareDefinesForBakedVertexAnimation(Z,M),!0},Z.PrepareDefinesForMultiview=function(Z,M){if(Z.activeCamera){var j=M.MULTIVIEW;M.MULTIVIEW=null!==Z.activeCamera.outputRenderTarget&&Z.activeCamera.outputRenderTarget.getViewCount()>1,M.MULTIVIEW!=j&&M.markAsUnprocessed()}},Z.PrepareDefinesForOIT=function(Z,M,j){var K=M.ORDER_INDEPENDENT_TRANSPARENCY,b=M.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;M.ORDER_INDEPENDENT_TRANSPARENCY=Z.useOrderIndependentTransparency&&j,M.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!Z.getEngine().getCaps().textureFloatLinearFiltering,K===M.ORDER_INDEPENDENT_TRANSPARENCY&&b===M.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||M.markAsUnprocessed()},Z.PrepareDefinesForPrePass=function(Z,M,j){var K=M.PREPASS;if(M._arePrePassDirty){var b=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(Z.prePassRenderer&&Z.prePassRenderer.enabled&&j){M.PREPASS=!0,M.SCENE_MRT_COUNT=Z.prePassRenderer.mrtCount;for(var g=0;g<b.length;g++){var O=Z.prePassRenderer.getIndex(b[g].type);-1!==O?(M[b[g].define]=!0,M[b[g].index]=O):M[b[g].define]=!1}}else{M.PREPASS=!1;for(g=0;g<b.length;g++)M[b[g].define]=!1}M.PREPASS!=K&&(M.markAsUnprocessed(),M.markAsImageProcessingDirty())}},Z.PrepareDefinesForLight=function(Z,M,j,K,b,g,O){switch(O.needNormals=!0,void 0===b["LIGHT"+K]&&(O.needRebuild=!0),b["LIGHT"+K]=!0,b["SPOTLIGHT"+K]=!1,b["HEMILIGHT"+K]=!1,b["POINTLIGHT"+K]=!1,b["DIRLIGHT"+K]=!1,j.prepareLightSpecificDefines(b,K),b["LIGHT_FALLOFF_PHYSICAL"+K]=!1,b["LIGHT_FALLOFF_GLTF"+K]=!1,b["LIGHT_FALLOFF_STANDARD"+K]=!1,j.falloffType){case Y.e.FALLOFF_GLTF:b["LIGHT_FALLOFF_GLTF"+K]=!0;break;case Y.e.FALLOFF_PHYSICAL:b["LIGHT_FALLOFF_PHYSICAL"+K]=!0;break;case Y.e.FALLOFF_STANDARD:b["LIGHT_FALLOFF_STANDARD"+K]=!0}if(g&&!j.specular.equalsFloats(0,0,0)&&(O.specularEnabled=!0),b["SHADOW"+K]=!1,b["SHADOWCSM"+K]=!1,b["SHADOWCSMDEBUG"+K]=!1,b["SHADOWCSMNUM_CASCADES"+K]=!1,b["SHADOWCSMUSESHADOWMAXZ"+K]=!1,b["SHADOWCSMNOBLEND"+K]=!1,b["SHADOWCSM_RIGHTHANDED"+K]=!1,b["SHADOWPCF"+K]=!1,b["SHADOWPCSS"+K]=!1,b["SHADOWPOISSON"+K]=!1,b["SHADOWESM"+K]=!1,b["SHADOWCLOSEESM"+K]=!1,b["SHADOWCUBE"+K]=!1,b["SHADOWLOWQUALITY"+K]=!1,b["SHADOWMEDIUMQUALITY"+K]=!1,M&&M.receiveShadows&&Z.shadowsEnabled&&j.shadowEnabled){var Q=j.getShadowGenerator();if(Q){var I=Q.getShadowMap();I&&I.renderList&&I.renderList.length>0&&(O.shadowEnabled=!0,Q.prepareDefines(b,K))}}j.lightmapMode!=Y.e.LIGHTMAP_DEFAULT?(O.lightmapMode=!0,b["LIGHTMAPEXCLUDED"+K]=!0,b["LIGHTMAPNOSPECULAR"+K]=j.lightmapMode==Y.e.LIGHTMAP_SHADOWSONLY):(b["LIGHTMAPEXCLUDED"+K]=!1,b["LIGHTMAPNOSPECULAR"+K]=!1)},Z.PrepareDefinesForLights=function(Z,M,j,K,b,g){if(void 0===b&&(b=4),void 0===g&&(g=!1),!j._areLightsDirty)return j._needNormals;var O=0,Q={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(Z.lightsEnabled&&!g)for(var Y=0,I=M.lightSources;Y<I.length;Y++){var E=I[Y];if(this.PrepareDefinesForLight(Z,M,E,O,j,K,Q),++O===b)break}j.SPECULARTERM=Q.specularEnabled,j.SHADOWS=Q.shadowEnabled;for(var s=O;s<b;s++)void 0!==j["LIGHT"+s]&&(j["LIGHT"+s]=!1,j["HEMILIGHT"+s]=!1,j["POINTLIGHT"+s]=!1,j["DIRLIGHT"+s]=!1,j["SPOTLIGHT"+s]=!1,j["SHADOW"+s]=!1,j["SHADOWCSM"+s]=!1,j["SHADOWCSMDEBUG"+s]=!1,j["SHADOWCSMNUM_CASCADES"+s]=!1,j["SHADOWCSMUSESHADOWMAXZ"+s]=!1,j["SHADOWCSMNOBLEND"+s]=!1,j["SHADOWCSM_RIGHTHANDED"+s]=!1,j["SHADOWPCF"+s]=!1,j["SHADOWPCSS"+s]=!1,j["SHADOWPOISSON"+s]=!1,j["SHADOWESM"+s]=!1,j["SHADOWCLOSEESM"+s]=!1,j["SHADOWCUBE"+s]=!1,j["SHADOWLOWQUALITY"+s]=!1,j["SHADOWMEDIUMQUALITY"+s]=!1);var i=Z.getEngine().getCaps();return void 0===j.SHADOWFLOAT&&(Q.needRebuild=!0),j.SHADOWFLOAT=Q.shadowEnabled&&(i.textureFloatRender&&i.textureFloatLinearFiltering||i.textureHalfFloatRender&&i.textureHalfFloatLinearFiltering),j.LIGHTMAPEXCLUDED=Q.lightmapMode,Q.needRebuild&&j.rebuild(),Q.needNormals},Z.PrepareUniformsAndSamplersForLight=function(Z,M,j,K,b,g){void 0===b&&(b=null),void 0===g&&(g=!1),b&&b.push("Light"+Z),g||(M.push("vLightData"+Z,"vLightDiffuse"+Z,"vLightSpecular"+Z,"vLightDirection"+Z,"vLightFalloff"+Z,"vLightGround"+Z,"lightMatrix"+Z,"shadowsInfo"+Z,"depthValues"+Z),j.push("shadowSampler"+Z),j.push("depthSampler"+Z),M.push("viewFrustumZ"+Z,"cascadeBlendFactor"+Z,"lightSizeUVCorrection"+Z,"depthCorrection"+Z,"penumbraDarkness"+Z,"frustumLengths"+Z),K&&(j.push("projectionLightSampler"+Z),M.push("textureProjectionMatrix"+Z)))},Z.PrepareUniformsAndSamplersList=function(Z,M,j,K){var b;void 0===K&&(K=4);var g=null;if(Z.uniformsNames){var O=Z;b=O.uniformsNames,g=O.uniformBuffersNames,M=O.samplers,j=O.defines,K=O.maxSimultaneousLights||0}else b=Z,M||(M=[]);for(var Q=0;Q<K&&j["LIGHT"+Q];Q++)this.PrepareUniformsAndSamplersForLight(Q,b,M,j["PROJECTEDLIGHTTEXTURE"+Q],g);j.NUM_MORPH_INFLUENCERS&&b.push("morphTargetInfluences"),j.BAKED_VERTEX_ANIMATION_TEXTURE&&(b.push("bakedVertexAnimationSettings"),b.push("bakedVertexAnimationTextureSizeInverted"),b.push("bakedVertexAnimationTime"),M.push("bakedVertexAnimationTexture"))},Z.HandleFallbacksForShadows=function(Z,M,j,K){void 0===j&&(j=4),void 0===K&&(K=0);for(var b=0,g=0;g<j&&Z["LIGHT"+g];g++)g>0&&(b=K+g,M.addFallback(b,"LIGHT"+g)),Z.SHADOWS||(Z["SHADOW"+g]&&M.addFallback(K,"SHADOW"+g),Z["SHADOWPCF"+g]&&M.addFallback(K,"SHADOWPCF"+g),Z["SHADOWPCSS"+g]&&M.addFallback(K,"SHADOWPCSS"+g),Z["SHADOWPOISSON"+g]&&M.addFallback(K,"SHADOWPOISSON"+g),Z["SHADOWESM"+g]&&M.addFallback(K,"SHADOWESM"+g),Z["SHADOWCLOSEESM"+g]&&M.addFallback(K,"SHADOWCLOSEESM"+g));return b++},Z.PrepareAttributesForMorphTargetsInfluencers=function(Z,M,j){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=j,this.PrepareAttributesForMorphTargets(Z,M,this._TmpMorphInfluencers)},Z.PrepareAttributesForMorphTargets=function(Z,M,j){var b=j.NUM_MORPH_INFLUENCERS;if(b>0&&O.e.LastCreatedEngine){var g=O.e.LastCreatedEngine.getCaps().maxVertexAttribs,Y=M.morphTargetManager;if(null===Y||void 0===Y?void 0:Y.isUsingTextureForTargets)return;for(var I=Y&&Y.supportsNormals&&j.NORMAL,E=Y&&Y.supportsTangents&&j.TANGENT,s=Y&&Y.supportsUVs&&j.UV1,i=0;i<b;i++)Z.push(Q.f.PositionKind+i),I&&Z.push(Q.f.NormalKind+i),E&&Z.push(Q.f.TangentKind+i),s&&Z.push(Q.f.UVKind+"_"+i),Z.length>g&&K.c.Error("Cannot add more vertex attributes for mesh "+M.name)}},Z.PrepareAttributesForBakedVertexAnimation=function(Z,M,j){j.BAKED_VERTEX_ANIMATION_TEXTURE&&j.INSTANCES&&Z.push("bakedVertexAnimationSettingsInstanced")},Z.PrepareAttributesForBones=function(Z,M,j,K){j.NUM_BONE_INFLUENCERS>0&&(K.addCPUSkinningFallback(0,M),Z.push(Q.f.MatricesIndicesKind),Z.push(Q.f.MatricesWeightsKind),j.NUM_BONE_INFLUENCERS>4&&(Z.push(Q.f.MatricesIndicesExtraKind),Z.push(Q.f.MatricesWeightsExtraKind)))},Z.PrepareAttributesForInstances=function(Z,M){(M.INSTANCES||M.THIN_INSTANCES)&&this.PushAttributesForInstances(Z,!!M.PREPASS_VELOCITY),M.INSTANCESCOLOR&&Z.push(Q.f.ColorInstanceKind)},Z.PushAttributesForInstances=function(Z,M){void 0===M&&(M=!1),Z.push("world0"),Z.push("world1"),Z.push("world2"),Z.push("world3"),M&&(Z.push("previousWorld0"),Z.push("previousWorld1"),Z.push("previousWorld2"),Z.push("previousWorld3"))},Z.BindLightProperties=function(Z,M,j){Z.transferToEffect(M,j+"")},Z.BindLight=function(Z,M,j,K,b,g){void 0===g&&(g=!0),Z._bindLight(M,j,K,b,g)},Z.BindLights=function(Z,M,j,K,b){void 0===b&&(b=4);for(var g=Math.min(M.lightSources.length,b),O=0;O<g;O++){var Q=M.lightSources[O];this.BindLight(Q,O,Z,j,"boolean"===typeof K?K:K.SPECULARTERM,M.receiveShadows)}},Z.BindFogParameters=function(Z,M,j,K){void 0===K&&(K=!1),Z.fogEnabled&&M.applyFog&&Z.fogMode!==g.c.FOGMODE_NONE&&(j.setFloat4("vFogInfos",Z.fogMode,Z.fogStart,Z.fogEnd,Z.fogDensity),K?(Z.fogColor.toLinearSpaceToRef(this._TempFogColor),j.setColor3("vFogColor",this._TempFogColor)):j.setColor3("vFogColor",Z.fogColor))},Z.BindBonesParameters=function(M,j,K){if(j&&M&&(M.computeBonesUsingShaders&&j._bonesComputationForcedToCPU&&(M.computeBonesUsingShaders=!1),M.useBones&&M.computeBonesUsingShaders&&M.skeleton)){var b=M.skeleton;if(b.isUsingTextureForMatrices&&j.getUniformIndex("boneTextureWidth")>-1){var g=b.getTransformMatrixTexture(M);j.setTexture("boneSampler",g),j.setFloat("boneTextureWidth",4*(b.bones.length+1))}else{var O=b.getTransformMatrices(M);O&&(j.setMatrices("mBones",O),K&&M.getScene().prePassRenderer&&M.getScene().prePassRenderer.getIndex(2)&&(K.previousBones[M.uniqueId]||(K.previousBones[M.uniqueId]=O.slice()),j.setMatrices("mPreviousBones",K.previousBones[M.uniqueId]),Z._CopyBonesTransformationMatrices(O,K.previousBones[M.uniqueId])))}}},Z._CopyBonesTransformationMatrices=function(Z,M){return M.set(Z),M},Z.BindMorphTargetParameters=function(Z,M){var j=Z.morphTargetManager;Z&&j&&M.setFloatArray("morphTargetInfluences",j.influences)},Z.BindLogDepth=function(Z,M,j){if(!Z||Z.LOGARITHMICDEPTH){var g=j.activeCamera;g.mode===b.e.ORTHOGRAPHIC_CAMERA&&K.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),M.setFloat("logarithmicDepthConstant",2/(Math.log(g.maxZ+1)/Math.LN2))}},Z.BindClipPlane=function(Z,M){E.b.BindClipPlane(Z,M)},Z._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},Z._TempFogColor=I.e.Black(),Z}()},96558:function(Z,M,j){"use strict";j.d(M,{c:function(){return Q}});var K=j(40061),b=j(9892),g=(j(46907),j(38956)),O=function(){function Z(Z){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=Z,this._scene=Z.getScene(),this._engine=this._scene.getEngine()}return Z.prototype._addPlugin=function(M){for(var j=0;j<this._plugins.length;++j)if(this._plugins[j].name===M.name)throw'Plugin "'.concat(M.name,'" already added to the material "').concat(this._material.name,'"!');if(this._material._uniformBufferLayoutBuilt)throw'The plugin "'.concat(M.name,'" can\'t be added to the material "').concat(this._material.name,'" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.');var K=M.getClassName();Z._MaterialPluginClassToMainDefine[K]||(Z._MaterialPluginClassToMainDefine[K]="MATERIALPLUGIN_"+ ++Z._MaterialPluginCounter),this._material._callbackPluginEventGeneric=this._handlePluginEvent.bind(this),this._plugins.push(M),this._plugins.sort((function(Z,M){return Z.priority-M.priority})),this._codeInjectionPoints={};var b={};b[Z._MaterialPluginClassToMainDefine[K]]={type:"boolean",default:!0};for(var g=0,O=this._plugins;g<O.length;g++){var Q=O[g];Q.collectDefines(b),this._collectPointNames("vertex",Q.getCustomCode("vertex")),this._collectPointNames("fragment",Q.getCustomCode("fragment"))}this._defineNamesFromPlugins=b},Z.prototype._activatePlugin=function(Z){-1===this._activePlugins.indexOf(Z)&&(this._activePlugins.push(Z),this._activePlugins.sort((function(Z,M){return Z.priority-M.priority})),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),Z.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(Z),this._activePluginsForExtraEvents.sort((function(Z,M){return Z.priority-M.priority})),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))},Z.prototype.getPlugin=function(Z){for(var M=0;M<this._plugins.length;++M)if(this._plugins[M].name===Z)return this._plugins[M];return null},Z.prototype._handlePluginEventIsReadyForSubMesh=function(Z){for(var M=!0,j=0,K=this._activePlugins;j<K.length;j++){var b=K[j];M=M&&b.isReadyForSubMesh(Z.defines,this._scene,this._engine,Z.subMesh)}Z.isReadyForSubMesh=M},Z.prototype._handlePluginEventPrepareDefinesBeforeAttributes=function(Z){for(var M=0,j=this._activePlugins;M<j.length;M++){j[M].prepareDefinesBeforeAttributes(Z.defines,this._scene,Z.mesh)}},Z.prototype._handlePluginEventPrepareDefines=function(Z){for(var M=0,j=this._activePlugins;M<j.length;M++){j[M].prepareDefines(Z.defines,this._scene,Z.mesh)}},Z.prototype._handlePluginEventHardBindForSubMesh=function(Z){for(var M=0,j=this._activePluginsForExtraEvents;M<j.length;M++){j[M].hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,Z.subMesh)}},Z.prototype._handlePluginEventBindForSubMesh=function(Z){for(var M=0,j=this._activePlugins;M<j.length;M++){j[M].bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,Z.subMesh)}},Z.prototype._handlePluginEventHasRenderTargetTextures=function(Z){for(var M=!1,j=0,K=this._activePluginsForExtraEvents;j<K.length;j++){if(M=K[j].hasRenderTargetTextures())break}Z.hasRenderTargetTextures=M},Z.prototype._handlePluginEventFillRenderTargetTextures=function(Z){for(var M=0,j=this._activePluginsForExtraEvents;M<j.length;M++){j[M].fillRenderTargetTextures(Z.renderTargets)}},Z.prototype._handlePluginEvent=function(Z,M){var j,K,b;switch(Z){case g.e.GetActiveTextures:for(var O=M,Q=0,Y=this._activePlugins;Q<Y.length;Q++){(G=Y[Q]).getActiveTextures(O.activeTextures)}break;case g.e.GetAnimatables:O=M;for(var I=0,E=this._activePlugins;I<E.length;I++){(G=E[I]).getAnimatables(O.animatables)}break;case g.e.HasTexture:O=M;for(var s=!1,i=0,a=this._activePlugins;i<a.length;i++){if(s=(G=a[i]).hasTexture(O.texture))break}O.hasTexture=s;break;case g.e.Disposed:O=M;for(var z=0,V=this._plugins;z<V.length;z++){(G=V[z]).dispose(O.forceDisposeTextures)}break;case g.e.GetDefineNames:(O=M).defineNames=this._defineNamesFromPlugins;break;case g.e.PrepareEffect:O=M;for(var o=0,c=this._activePlugins;o<c.length;o++){var G=c[o];O.fallbackRank=G.addFallbacks(O.defines,O.fallbacks,O.fallbackRank),G.getAttributes(O.attributes,this._scene,O.mesh)}this._uniformList.length>0&&(j=O.uniforms).push.apply(j,this._uniformList),this._samplerList.length>0&&(K=O.samplers).push.apply(K,this._samplerList),this._uboList.length>0&&(b=O.uniformBuffersNames).push.apply(b,this._uboList),O.customCode=this._injectCustomCode(O.customCode);break;case g.e.PrepareUniformBuffer:O=M;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];for(var f=0,X=this._plugins;f<X.length;f++){var d=(G=X[f]).getUniforms();if(d){if(d.ubo)for(var W=0,A=d.ubo;W<A.length;W++){var q=A[W];O.ubo.addUniform(q.name,q.size),this._uboDeclaration+="".concat(q.type," ").concat(q.name,";\r\n"),this._uniformList.push(q.name)}d.vertex&&(this._vertexDeclaration+=d.vertex+"\r\n"),d.fragment&&(this._fragmentDeclaration+=d.fragment+"\r\n")}G.getSamplers(this._samplerList),G.getUniformBuffersNames(this._uboList)}}},Z.prototype._collectPointNames=function(Z,M){if(M)for(var j in M)this._codeInjectionPoints[Z]||(this._codeInjectionPoints[Z]={}),this._codeInjectionPoints[Z][j]=!0},Z.prototype._injectCustomCode=function(Z){var M=this;return function(j,K){var b;Z&&(K=Z(j,K)),M._uboDeclaration&&(K=K.replace("#define ADDITIONAL_UBO_DECLARATION",M._uboDeclaration)),M._vertexDeclaration&&(K=K.replace("#define ADDITIONAL_VERTEX_DECLARATION",M._vertexDeclaration)),M._fragmentDeclaration&&(K=K.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",M._fragmentDeclaration));var g=null===(b=M._codeInjectionPoints)||void 0===b?void 0:b[j];if(!g)return K;for(var O in g){for(var Q="",Y=0,I=M._activePlugins;Y<I.length;Y++){var E=I[Y].getCustomCode(j);(null===E||void 0===E?void 0:E[O])&&(Q+=E[O]+"\r\n")}if(Q.length>0)if("!"===O.charAt(0))for(var s=new RegExp(O.substring(1),"g"),i=s.exec(K);null!==i;){for(var a=Q,z=0;z<i.length;++z)a=a.replace("$"+z,i[z]);K=K.replace(i[0],a),i=s.exec(K)}else{var V="#define "+O;K=K.replace(V,"\r\n"+Q+"\r\n"+V)}}return K}},Z._MaterialPluginClassToMainDefine={},Z._MaterialPluginCounter=0,Z}();var Q=function(){function Z(Z,M,j,K,b,g){void 0===b&&(b=!0),void 0===g&&(g=!1),this.priority=500,this.registerForExtraEvents=!1,this._material=Z,this.name=M,this.priority=j,Z.pluginManager||(Z.pluginManager=new O(Z)),this._pluginDefineNames=K,this._pluginManager=Z.pluginManager,b&&this._pluginManager._addPlugin(this),g&&this._enable(!0),this.markAllDefinesAsDirty=Z._dirtyCallbacks[63]}return Z.prototype._enable=function(Z){Z&&this._pluginManager._activatePlugin(this)},Z.prototype.getClassName=function(){return"MaterialPluginBase"},Z.prototype.isReadyForSubMesh=function(Z,M,j,K){return!0},Z.prototype.hardBindForSubMesh=function(Z,M,j,K){},Z.prototype.bindForSubMesh=function(Z,M,j,K){},Z.prototype.dispose=function(Z){},Z.prototype.getCustomCode=function(Z){return null},Z.prototype.collectDefines=function(Z){if(this._pluginDefineNames)for(var M=0,j=Object.keys(this._pluginDefineNames);M<j.length;M++){var K=j[M];if("_"!==K[0]){var b=typeof this._pluginDefineNames[K];Z[K]={type:"number"===b?"number":"string"===b?"string":"boolean"===b?"boolean":"object",default:this._pluginDefineNames[K]}}}},Z.prototype.prepareDefinesBeforeAttributes=function(Z,M,j){},Z.prototype.prepareDefines=function(Z,M,j){},Z.prototype.hasTexture=function(Z){return!1},Z.prototype.hasRenderTargetTextures=function(){return!1},Z.prototype.fillRenderTargetTextures=function(Z){},Z.prototype.getActiveTextures=function(Z){},Z.prototype.getAnimatables=function(Z){},Z.prototype.addFallbacks=function(Z,M,j){return j},Z.prototype.getSamplers=function(Z){},Z.prototype.getAttributes=function(Z,M,j){},Z.prototype.getUniformBuffersNames=function(Z){},Z.prototype.getUniforms=function(){return{}},Z.prototype.copyTo=function(Z){b.b.Clone((function(){return Z}),this)},Z.prototype.serialize=function(){return b.b.Serialize(this)},Z.prototype.parse=function(Z,M,j){var K=this;b.b.Parse((function(){return K}),Z,M,j)},(0,K.l)([(0,b.z)()],Z.prototype,"name",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"priority",void 0),(0,K.l)([(0,b.z)()],Z.prototype,"registerForExtraEvents",void 0),Z}()},38956:function(Z,M,j){"use strict";var K;j.d(M,{e:function(){return K}}),function(Z){Z[Z.Created=1]="Created",Z[Z.Disposed=2]="Disposed",Z[Z.GetDefineNames=4]="GetDefineNames",Z[Z.PrepareUniformBuffer=8]="PrepareUniformBuffer",Z[Z.IsReadyForSubMesh=16]="IsReadyForSubMesh",Z[Z.PrepareDefines=32]="PrepareDefines",Z[Z.BindForSubMesh=64]="BindForSubMesh",Z[Z.PrepareEffect=128]="PrepareEffect",Z[Z.GetAnimatables=256]="GetAnimatables",Z[Z.GetActiveTextures=512]="GetActiveTextures",Z[Z.HasTexture=1024]="HasTexture",Z[Z.FillRenderTargetTextures=2048]="FillRenderTargetTextures",Z[Z.HasRenderTargetTextures=4096]="HasRenderTargetTextures",Z[Z.HardBindForSubMesh=8192]="HardBindForSubMesh"}(K||(K={}))},49443:function(Z,M,j){"use strict";j.d(M,{e:function(){return Q}});var K=j(40061),b=j(46907),g=j(45883),O=j(31709),Q=function(Z){function M(M,j){var K=Z.call(this,M,j,!0)||this;return K._waitingSubMaterialsUniqueIds=[],K.getScene().multiMaterials.push(K),K.subMaterials=new Array,K._storeEffectOnSubMeshes=!0,K}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(Z){this._subMaterials=Z,this._hookArray(Z)},enumerable:!1,configurable:!0}),M.prototype.getChildren=function(){return this.subMaterials},M.prototype._hookArray=function(Z){var M=this,j=Z.push;Z.push=function(){for(var K=[],b=0;b<arguments.length;b++)K[b]=arguments[b];var g=j.apply(Z,K);return M._markAllSubMeshesAsTexturesDirty(),g};var K=Z.splice;Z.splice=function(j,b){var g=K.apply(Z,[j,b]);return M._markAllSubMeshesAsTexturesDirty(),g}},M.prototype.getSubMaterial=function(Z){return Z<0||Z>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[Z]},M.prototype.getActiveTextures=function(){var M;return(M=Z.prototype.getActiveTextures.call(this)).concat.apply(M,this.subMaterials.map((function(Z){return Z?Z.getActiveTextures():[]})))},M.prototype.hasTexture=function(M){var j;if(Z.prototype.hasTexture.call(this,M))return!0;for(var K=0;K<this.subMaterials.length;K++)if(null===(j=this.subMaterials[K])||void 0===j?void 0:j.hasTexture(M))return!0;return!1},M.prototype.getClassName=function(){return"MultiMaterial"},M.prototype.isReadyForSubMesh=function(Z,M,j){for(var K=0;K<this.subMaterials.length;K++){var b=this.subMaterials[K];if(b){if(b._storeEffectOnSubMeshes){if(!b.isReadyForSubMesh(Z,M,j))return!1;continue}if(!b.isReady(Z))return!1}}return!0},M.prototype.clone=function(Z,j){for(var K=new M(Z,this.getScene()),b=0;b<this.subMaterials.length;b++){var g=null,O=this.subMaterials[b];g=j&&O?O.clone(Z+"-"+O.name):this.subMaterials[b],K.subMaterials.push(g)}return K},M.prototype.serialize=function(){var Z={};Z.name=this.name,Z.id=this.id,Z.uniqueId=this.uniqueId,g.d&&(Z.tags=g.d.GetTags(this)),Z.materialsUniqueIds=[],Z.materials=[];for(var M=0;M<this.subMaterials.length;M++){var j=this.subMaterials[M];j?(Z.materialsUniqueIds.push(j.uniqueId),Z.materials.push(j.id)):(Z.materialsUniqueIds.push(null),Z.materials.push(null))}return Z},M.prototype.dispose=function(M,j,K){var b=this.getScene();if(b){if(K)for(var g=0;g<this.subMaterials.length;g++){var O=this.subMaterials[g];O&&O.dispose(M,j)}var Q=b.multiMaterials.indexOf(this);Q>=0&&b.multiMaterials.splice(Q,1),Z.prototype.dispose.call(this,M,j)}},M.ParseMultiMaterial=function(Z,j){var K=new M(Z.name,j);return K.id=Z.id,K._loadedUniqueId=Z.uniqueId,g.d&&g.d.AddTagsTo(K,Z.tags),Z.materialsUniqueIds?K._waitingSubMaterialsUniqueIds=Z.materialsUniqueIds:Z.materials.forEach((function(Z){return K.subMaterials.push(j.getLastMaterialById(Z))})),K},M}(b.d);(0,O.c)("BABYLON.MultiMaterial",Q)},90888:function(Z,M,j){"use strict";j.d(M,{d:function(){return K}});var K=function(){function Z(){this.previousWorldMatrices={},this.previousBones={}}return Z.AddUniforms=function(Z){Z.push("previousWorld","previousViewProjection","mPreviousBones")},Z.AddSamplers=function(Z){},Z.prototype.bindForSubMesh=function(Z,M,j,K,b){if(M.prePassRenderer&&M.prePassRenderer.enabled&&M.prePassRenderer.currentRTisSceneRT&&-1!==M.prePassRenderer.getIndex(2)){this.previousWorldMatrices[j.uniqueId]||(this.previousWorldMatrices[j.uniqueId]=K.clone()),this.previousViewProjection||(this.previousViewProjection=M.getTransformMatrix().clone(),this.currentViewProjection=M.getTransformMatrix().clone());var g=M.getEngine();this.currentViewProjection.updateFlag!==M.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=g.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(M.getTransformMatrix())):this._lastUpdateFrameId!==g.frameId&&(this._lastUpdateFrameId=g.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),Z.setMatrix("previousWorld",this.previousWorldMatrices[j.uniqueId]),Z.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[j.uniqueId]=K.clone()}},Z}()},29553:function(Z,M,j){"use strict";j.d(M,{e:function(){return g}});var K=j(40061),b=j(80105),g=function(Z){function M(M,j,K){void 0===K&&(K=!0);var g=Z.call(this,M,j)||this;return g._normalMatrix=new b.c,g._storeEffectOnSubMeshes=K,g}return(0,K.m)(M,Z),M.prototype.getEffect=function(){return this._storeEffectOnSubMeshes?this._activeEffect:Z.prototype.getEffect.call(this)},M.prototype.isReady=function(Z,M){return!!Z&&(!this._storeEffectOnSubMeshes||(!Z.subMeshes||0===Z.subMeshes.length||this.isReadyForSubMesh(Z,Z.subMeshes[0],M)))},M.prototype._isReadyForSubMesh=function(Z){var M=Z.materialDefines;return!(this.checkReadyOnEveryCall||!Z.effect||!M||M._renderId!==this.getScene().getRenderId())},M.prototype.bindOnlyWorldMatrix=function(Z){this._activeEffect.setMatrix("world",Z)},M.prototype.bindOnlyNormalMatrix=function(Z){this._activeEffect.setMatrix("normalMatrix",Z)},M.prototype.bind=function(Z,M){M&&this.bindForSubMesh(Z,M,M.subMeshes[0])},M.prototype._afterBind=function(M,j){void 0===j&&(j=null),Z.prototype._afterBind.call(this,M,j),this.getScene()._cachedEffect=j},M.prototype._mustRebind=function(Z,M,j){return void 0===j&&(j=1),Z.isCachedMaterialInvalid(this,M,j)},M}(j(46907).d)},56591:function(Z,M,j){"use strict";var K;j.d(M,{b:function(){return K}}),function(Z){Z[Z.GLSL=0]="GLSL",Z[Z.WGSL=1]="WGSL"}(K||(K={}))},87683:function(Z,M,j){"use strict";j.d(M,{c:function(){return e}});var K=j(40061),b=j(9892),g=j(17190),O=j(37105),Q=j(80105),Y=j(9488),I=j(43251),E=j(90888),s=j(23016),i=j(46907),a=j(38956),z=j(4241),V=j(29553),o=j(33048),c=j(70937),G=j(31709),f=j(37001),X=j(16179),d="uniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform vec3 vAmbientColor;\nuniform float visibility;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#if defined(USE_LOCAL_REFRACTIONMAP_CUBIC) && defined(REFRACTIONMAP_3D)\nuniform vec3 vRefractionPosition;\nuniform vec3 vRefractionSize; \n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n";X.d.IncludesShadersStore.defaultFragmentDeclaration=d;j(88987),j(61496);var W="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nfloat alphaCutOff;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec3 vRefractionPosition;\nvec3 vRefractionSize;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nvec4 vDiffuseColor;\nvec3 vAmbientColor;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n";X.d.IncludesShadersStore.defaultUboDeclaration=W;j(74422),j(44184),j(87321),j(83874),j(65084),j(45928);var A="struct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w==0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}";X.d.IncludesShadersStore.lightsFragmentFunctions=A;j(35765),j(54587);var q="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif\n";X.d.IncludesShadersStore.fresnelFunction=q;j(31814),j(23598),j(68923),j(72994),j(49904),j(76578),j(96919),j(35850),j(69991),j(84098),j(78767),j(75060),j(57932),j(84981),j(80345);var T="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#define RECIPROCAL_PI2 0.15915494\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_SAMPLERNAME_,diffuse)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULARTERM)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_SAMPLERNAME_,specular)\n#endif\n#include<fresnelFunction>\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<oitFragment>\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef DETAIL\nbaseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec4 refractionColor=vec4(0.,0.,0.,1.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\n#ifdef USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,vRefractionSize,vRefractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector);\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords);\n#endif\n#ifdef RGBDREFRACTION\nrefractionColor.rgb=fromRGBD(refractionColor);\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor.rgb=toGammaSpace(refractionColor.rgb);\n#endif\nrefractionColor.rgb*=vRefractionInfos.x;\n#endif\nvec4 reflectionColor=vec4(0.,0.,0.,1.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nvReflectionUVW.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords);\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor.rgb=toGammaSpace(reflectionColor.rgb);\n#endif\nreflectionColor.rgb*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n#ifdef ALPHATEST\n#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS\nif (alpha<alphaCutOff)\ndiscard;\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor.rgb;\n#else\ncolor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=color.a>0.4 ? 1.0 : 0.0;\ngl_FragData[0]=color; \n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_IRRADIANCE\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4((view*vec4(normalW,0.0)).rgb,writeGeometryInfo); \n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#if defined(SPECULARTERM)\n#if defined(SPECULAR)\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularMapColor)*writeGeometryInfo; \n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularColor,1.0)*writeGeometryInfo;\n#endif\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0)*writeGeometryInfo;\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=color;\n#endif\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {\nfrontColor.rgb+=color.rgb*color.a*alphaMultiplier;\nfrontColor.a=1.0-alphaMultiplier*(1.0-color.a);\n} else {\nbackColor+=color;\n}\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";X.d.ShadersStore.defaultPixelShader=T;var B="uniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\nuniform mat4 detailMatrix;\n#endif\n#define ADDITIONAL_VERTEX_DECLARATION\n";X.d.IncludesShadersStore.defaultVertexDeclaration=B;j(94040),j(31377),j(54001),j(16554),j(63201),j(138),j(20142),j(49329),j(23654),j(65359),j(58003),j(36062),j(83700),j(63886),j(48767),j(50511),j(97202),j(48623),j(32875),j(3970),j(58878),j(70179),j(61906),j(32560),j(70323),j(35738);var N="#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n";X.d.IncludesShadersStore.pointCloudVertex=N;j(30242);var U="#include<__decl__defaultVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<mainUVVaryingDeclaration>[1..7]\n#include<samplerVertexDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#if defined(SPECULARTERM)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular)\n#endif\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_MATRIXNAME_,diffuse,_INFONAME_,DiffuseInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#if defined(SPECULARTERM)\n#include<samplerVertexImplementation>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_MATRIXNAME_,specular,_INFONAME_,SpecularInfos.x)\n#endif\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";X.d.ShadersStore.defaultVertexShader=U;var n=j(54497),k=j(56513),x={effect:null,subMesh:null},R=function(Z){function M(M){var j=Z.call(this,M)||this;return j.MAINUV1=!1,j.MAINUV2=!1,j.MAINUV3=!1,j.MAINUV4=!1,j.MAINUV5=!1,j.MAINUV6=!1,j.DIFFUSE=!1,j.DIFFUSEDIRECTUV=0,j.BAKED_VERTEX_ANIMATION_TEXTURE=!1,j.AMBIENT=!1,j.AMBIENTDIRECTUV=0,j.OPACITY=!1,j.OPACITYDIRECTUV=0,j.OPACITYRGB=!1,j.REFLECTION=!1,j.EMISSIVE=!1,j.EMISSIVEDIRECTUV=0,j.SPECULAR=!1,j.SPECULARDIRECTUV=0,j.BUMP=!1,j.BUMPDIRECTUV=0,j.PARALLAX=!1,j.PARALLAXOCCLUSION=!1,j.SPECULAROVERALPHA=!1,j.CLIPPLANE=!1,j.CLIPPLANE2=!1,j.CLIPPLANE3=!1,j.CLIPPLANE4=!1,j.CLIPPLANE5=!1,j.CLIPPLANE6=!1,j.ALPHATEST=!1,j.DEPTHPREPASS=!1,j.ALPHAFROMDIFFUSE=!1,j.POINTSIZE=!1,j.FOG=!1,j.SPECULARTERM=!1,j.DIFFUSEFRESNEL=!1,j.OPACITYFRESNEL=!1,j.REFLECTIONFRESNEL=!1,j.REFRACTIONFRESNEL=!1,j.EMISSIVEFRESNEL=!1,j.FRESNEL=!1,j.NORMAL=!1,j.TANGENT=!1,j.UV1=!1,j.UV2=!1,j.UV3=!1,j.UV4=!1,j.UV5=!1,j.UV6=!1,j.VERTEXCOLOR=!1,j.VERTEXALPHA=!1,j.NUM_BONE_INFLUENCERS=0,j.BonesPerMesh=0,j.BONETEXTURE=!1,j.BONES_VELOCITY_ENABLED=!1,j.INSTANCES=!1,j.THIN_INSTANCES=!1,j.INSTANCESCOLOR=!1,j.GLOSSINESS=!1,j.ROUGHNESS=!1,j.EMISSIVEASILLUMINATION=!1,j.LINKEMISSIVEWITHDIFFUSE=!1,j.REFLECTIONFRESNELFROMSPECULAR=!1,j.LIGHTMAP=!1,j.LIGHTMAPDIRECTUV=0,j.OBJECTSPACE_NORMALMAP=!1,j.USELIGHTMAPASSHADOWMAP=!1,j.REFLECTIONMAP_3D=!1,j.REFLECTIONMAP_SPHERICAL=!1,j.REFLECTIONMAP_PLANAR=!1,j.REFLECTIONMAP_CUBIC=!1,j.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,j.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,j.REFLECTIONMAP_PROJECTION=!1,j.REFLECTIONMAP_SKYBOX=!1,j.REFLECTIONMAP_EXPLICIT=!1,j.REFLECTIONMAP_EQUIRECTANGULAR=!1,j.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,j.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,j.REFLECTIONMAP_OPPOSITEZ=!1,j.INVERTCUBICMAP=!1,j.LOGARITHMICDEPTH=!1,j.REFRACTION=!1,j.REFRACTIONMAP_3D=!1,j.REFLECTIONOVERALPHA=!1,j.TWOSIDEDLIGHTING=!1,j.SHADOWFLOAT=!1,j.MORPHTARGETS=!1,j.MORPHTARGETS_NORMAL=!1,j.MORPHTARGETS_TANGENT=!1,j.MORPHTARGETS_UV=!1,j.NUM_MORPH_INFLUENCERS=0,j.MORPHTARGETS_TEXTURE=!1,j.NONUNIFORMSCALING=!1,j.PREMULTIPLYALPHA=!1,j.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,j.ALPHABLEND=!0,j.PREPASS=!1,j.PREPASS_IRRADIANCE=!1,j.PREPASS_IRRADIANCE_INDEX=-1,j.PREPASS_ALBEDO_SQRT=!1,j.PREPASS_ALBEDO_SQRT_INDEX=-1,j.PREPASS_DEPTH=!1,j.PREPASS_DEPTH_INDEX=-1,j.PREPASS_NORMAL=!1,j.PREPASS_NORMAL_INDEX=-1,j.PREPASS_POSITION=!1,j.PREPASS_POSITION_INDEX=-1,j.PREPASS_VELOCITY=!1,j.PREPASS_VELOCITY_INDEX=-1,j.PREPASS_REFLECTIVITY=!1,j.PREPASS_REFLECTIVITY_INDEX=-1,j.SCENE_MRT_COUNT=0,j.RGBDLIGHTMAP=!1,j.RGBDREFLECTION=!1,j.RGBDREFRACTION=!1,j.IMAGEPROCESSING=!1,j.VIGNETTE=!1,j.VIGNETTEBLENDMODEMULTIPLY=!1,j.VIGNETTEBLENDMODEOPAQUE=!1,j.TONEMAPPING=!1,j.TONEMAPPING_ACES=!1,j.CONTRAST=!1,j.COLORCURVES=!1,j.COLORGRADING=!1,j.COLORGRADING3D=!1,j.SAMPLER3DGREENDEPTH=!1,j.SAMPLER3DBGRMAP=!1,j.IMAGEPROCESSINGPOSTPROCESS=!1,j.SKIPFINALCOLORCLAMP=!1,j.MULTIVIEW=!1,j.ORDER_INDEPENDENT_TRANSPARENCY=!1,j.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,j.IS_REFLECTION_LINEAR=!1,j.IS_REFRACTION_LINEAR=!1,j.EXPOSURE=!1,j.rebuild(),j}return(0,K.m)(M,Z),M.prototype.setReflectionMode=function(Z){for(var M=0,j=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];M<j.length;M++){var K=j[M];this[K]=K===Z}},M}(z.c),e=function(Z){function M(j,K){var b=Z.call(this,j,K)||this;return b._diffuseTexture=null,b._ambientTexture=null,b._opacityTexture=null,b._reflectionTexture=null,b._emissiveTexture=null,b._specularTexture=null,b._bumpTexture=null,b._lightmapTexture=null,b._refractionTexture=null,b.ambientColor=new Y.e(0,0,0),b.diffuseColor=new Y.e(1,1,1),b.specularColor=new Y.e(1,1,1),b.emissiveColor=new Y.e(0,0,0),b.specularPower=64,b._useAlphaFromDiffuseTexture=!1,b._useEmissiveAsIllumination=!1,b._linkEmissiveWithDiffuse=!1,b._useSpecularOverAlpha=!1,b._useReflectionOverAlpha=!1,b._disableLighting=!1,b._useObjectSpaceNormalMap=!1,b._useParallax=!1,b._useParallaxOcclusion=!1,b.parallaxScaleBias=.05,b._roughness=0,b.indexOfRefraction=.98,b.invertRefractionY=!0,b.alphaCutOff=.4,b._useLightmapAsShadowmap=!1,b._useReflectionFresnelFromSpecular=!1,b._useGlossinessFromSpecularMapAlpha=!1,b._maxSimultaneousLights=4,b._invertNormalMapX=!1,b._invertNormalMapY=!1,b._twoSidedLighting=!1,b._renderTargets=new g.f(16),b._worldViewProjectionMatrix=Q.c.Zero(),b._globalAmbientColor=new Y.e(0,0,0),b._cacheHasRenderTargetTextures=!1,b.detailMap=new k.d(b),b._attachImageProcessingConfiguration(null),b.prePassConfiguration=new E.d,b.getRenderTargetTextures=function(){return b._renderTargets.reset(),M.ReflectionTextureEnabled&&b._reflectionTexture&&b._reflectionTexture.isRenderTarget&&b._renderTargets.push(b._reflectionTexture),M.RefractionTextureEnabled&&b._refractionTexture&&b._refractionTexture.isRenderTarget&&b._renderTargets.push(b._refractionTexture),b._eventInfo.renderTargets=b._renderTargets,b._callbackPluginEventFillRenderTargetTextures(b._eventInfo),b._renderTargets},b}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(Z){this._attachImageProcessingConfiguration(Z),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),M.prototype._attachImageProcessingConfiguration=function(Z){var M=this;Z!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=Z||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){M._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(M.prototype,"isPrePassCapable",{get:function(){return!this.disableDepthWrite},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(Z){this.imageProcessingConfiguration.colorCurvesEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(Z){this.imageProcessingConfiguration.colorGradingEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(Z){this._imageProcessingConfiguration.toneMappingEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(Z){this._imageProcessingConfiguration.exposure=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(Z){this._imageProcessingConfiguration.contrast=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(Z){this._imageProcessingConfiguration.colorGradingTexture=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(Z){this._imageProcessingConfiguration.colorCurves=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"hasRenderTargetTextures",{get:function(){return!!(M.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(M.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(M.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(Z){this._useLogarithmicDepth=Z&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),M.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)},M.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===i.d.MATERIAL_ALPHATEST)},M.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==i.d.MATERIAL_OPAQUE},M.prototype._hasAlphaChannel=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture},M.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},M.prototype.isReadyForSubMesh=function(Z,j,K){if(void 0===K&&(K=!1),this._uniformBufferLayoutBuilt||this.buildUniformLayout(),j.effect&&this.isFrozen&&j.effect._wasPreviouslyReady&&j.effect._wasPreviouslyUsingInstances===K)return!0;j.materialDefines||(this._callbackPluginEventGeneric(a.e.GetDefineNames,this._eventInfo),j.materialDefines=new R(this._eventInfo.defineNames));var b=this.getScene(),g=j.materialDefines;if(this._isReadyForSubMesh(j))return!0;var O=b.getEngine();g._needNormals=o.b.PrepareDefinesForLights(b,Z,g,!0,this._maxSimultaneousLights,this._disableLighting),o.b.PrepareDefinesForMultiview(b,g);var Q=this.needAlphaBlendingForMesh(Z)&&this.getScene().useOrderIndependentTransparency;if(o.b.PrepareDefinesForPrePass(b,g,this.canRenderToMRT&&!Q),o.b.PrepareDefinesForOIT(b,g,Q),g._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,g._needUVs=!1;for(var Y=1;Y<=6;++Y)g["MAINUV"+Y]=!1;if(b.texturesEnabled){if(this._diffuseTexture&&M.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;o.b.PrepareDefinesForMergedUV(this._diffuseTexture,g,"DIFFUSE")}else g.DIFFUSE=!1;if(this._ambientTexture&&M.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;o.b.PrepareDefinesForMergedUV(this._ambientTexture,g,"AMBIENT")}else g.AMBIENT=!1;if(this._opacityTexture&&M.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;o.b.PrepareDefinesForMergedUV(this._opacityTexture,g,"OPACITY"),g.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else g.OPACITY=!1;if(this._reflectionTexture&&M.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(g._needNormals=!0,g.REFLECTION=!0,g.ROUGHNESS=this._roughness>0,g.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,g.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===c.b.INVCUBIC_MODE,g.REFLECTIONMAP_3D=this._reflectionTexture.isCube,g.REFLECTIONMAP_OPPOSITEZ=g.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,g.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case c.b.EXPLICIT_MODE:g.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case c.b.PLANAR_MODE:g.setReflectionMode("REFLECTIONMAP_PLANAR");break;case c.b.PROJECTION_MODE:g.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case c.b.SKYBOX_MODE:g.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case c.b.SPHERICAL_MODE:g.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case c.b.EQUIRECTANGULAR_MODE:g.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case c.b.FIXED_EQUIRECTANGULAR_MODE:g.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case c.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:g.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case c.b.CUBIC_MODE:case c.b.INVCUBIC_MODE:default:g.setReflectionMode("REFLECTIONMAP_CUBIC")}g.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else g.REFLECTION=!1,g.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&M.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;o.b.PrepareDefinesForMergedUV(this._emissiveTexture,g,"EMISSIVE")}else g.EMISSIVE=!1;if(this._lightmapTexture&&M.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;o.b.PrepareDefinesForMergedUV(this._lightmapTexture,g,"LIGHTMAP"),g.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,g.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else g.LIGHTMAP=!1;if(this._specularTexture&&M.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;o.b.PrepareDefinesForMergedUV(this._specularTexture,g,"SPECULAR"),g.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else g.SPECULAR=!1;if(b.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&M.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;o.b.PrepareDefinesForMergedUV(this._bumpTexture,g,"BUMP"),g.PARALLAX=this._useParallax,g.PARALLAXOCCLUSION=this._useParallaxOcclusion,g.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else g.BUMP=!1,g.PARALLAX=!1,g.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&M.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;g._needUVs=!0,g.REFRACTION=!0,g.REFRACTIONMAP_3D=this._refractionTexture.isCube,g.RGBDREFRACTION=this._refractionTexture.isRGBD,g.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else g.REFRACTION=!1;g.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else g.DIFFUSE=!1,g.AMBIENT=!1,g.OPACITY=!1,g.REFLECTION=!1,g.EMISSIVE=!1,g.LIGHTMAP=!1,g.BUMP=!1,g.REFRACTION=!1;g.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),g.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,g.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,g.SPECULAROVERALPHA=this._useSpecularOverAlpha,g.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,g.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,g.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(Z)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=g,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(g._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(g),g.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,g.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(g._areFresnelDirty&&(M.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(g.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,g.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,g.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,g.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,g.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,g.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,g._needNormals=!0,g.FRESNEL=!0):g.FRESNEL=!1),o.b.PrepareDefinesForMisc(Z,b,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(Z)||this._forceAlphaTest,g),o.b.PrepareDefinesForFrameBoundValues(b,O,g,K,null,j.getRenderingMesh().hasThinInstances),this._eventInfo.defines=g,this._eventInfo.mesh=Z,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),o.b.PrepareDefinesForAttributes(Z,g,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo),g.isDirty){var i=g._areLightsDisposed;g.markAsProcessed();var z=new n.b;g.REFLECTION&&z.addFallback(0,"REFLECTION"),g.SPECULAR&&z.addFallback(0,"SPECULAR"),g.BUMP&&z.addFallback(0,"BUMP"),g.PARALLAX&&z.addFallback(1,"PARALLAX"),g.PARALLAXOCCLUSION&&z.addFallback(0,"PARALLAXOCCLUSION"),g.SPECULAROVERALPHA&&z.addFallback(0,"SPECULAROVERALPHA"),g.FOG&&z.addFallback(1,"FOG"),g.POINTSIZE&&z.addFallback(0,"POINTSIZE"),g.LOGARITHMICDEPTH&&z.addFallback(0,"LOGARITHMICDEPTH"),o.b.HandleFallbacksForShadows(g,z,this._maxSimultaneousLights),g.SPECULARTERM&&z.addFallback(0,"SPECULARTERM"),g.DIFFUSEFRESNEL&&z.addFallback(1,"DIFFUSEFRESNEL"),g.OPACITYFRESNEL&&z.addFallback(2,"OPACITYFRESNEL"),g.REFLECTIONFRESNEL&&z.addFallback(3,"REFLECTIONFRESNEL"),g.EMISSIVEFRESNEL&&z.addFallback(4,"EMISSIVEFRESNEL"),g.FRESNEL&&z.addFallback(4,"FRESNEL"),g.MULTIVIEW&&z.addFallback(0,"MULTIVIEW");var V=[I.f.PositionKind];g.NORMAL&&V.push(I.f.NormalKind),g.TANGENT&&V.push(I.f.TangentKind);for(Y=1;Y<=6;++Y)g["UV"+Y]&&V.push("uv".concat(1===Y?"":Y));g.VERTEXCOLOR&&V.push(I.f.ColorKind),o.b.PrepareAttributesForBones(V,Z,g,z),o.b.PrepareAttributesForInstances(V,g),o.b.PrepareAttributesForMorphTargets(V,Z,g),o.b.PrepareAttributesForBakedVertexAnimation(V,Z,g);var G="default",f=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],X=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],d=["Material","Scene","Mesh"];this._eventInfo.fallbacks=z,this._eventInfo.fallbackRank=0,this._eventInfo.defines=g,this._eventInfo.uniforms=f,this._eventInfo.attributes=V,this._eventInfo.samplers=X,this._eventInfo.uniformBuffersNames=d,this._eventInfo.customCode=void 0,this._eventInfo.mesh=Z,this._callbackPluginEventGeneric(a.e.PrepareEffect,this._eventInfo),E.d.AddUniforms(f),E.d.AddSamplers(X),s.e&&(s.e.PrepareUniforms(f,g),s.e.PrepareSamplers(X,g)),o.b.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:d,samplers:X,defines:g,maxSimultaneousLights:this._maxSimultaneousLights});var W={};this.customShaderNameResolve&&(G=this.customShaderNameResolve(G,f,d,X,g,V,W));var A=g.toString(),q=j.effect,T=b.getEngine().createEffect(G,{attributes:V,uniformsNames:f,uniformBuffersNames:d,samplers:X,defines:A,fallbacks:z,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:g.NUM_MORPH_INFLUENCERS},processFinalCode:W.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:g.PREPASS},O);if(T)if(this._onEffectCreatedObservable&&(x.effect=T,x.subMesh=j,this._onEffectCreatedObservable.notifyObservers(x)),this.allowShaderHotSwapping&&q&&!T.isReady()){if(T=q,g.markAsUnprocessed(),i)return g._areLightsDisposed=!0,!1}else b.resetCachedMaterial(),j.setEffect(T,g,this._materialContext)}return!(!j.effect||!j.effect.isReady())&&(g._renderId=b.getRenderId(),j.effect._wasPreviouslyReady=!0,j.effect._wasPreviouslyUsingInstances=K,!0)},M.prototype.buildUniformLayout=function(){var M=this._uniformBuffer;M.addUniform("diffuseLeftColor",4),M.addUniform("diffuseRightColor",4),M.addUniform("opacityParts",4),M.addUniform("reflectionLeftColor",4),M.addUniform("reflectionRightColor",4),M.addUniform("refractionLeftColor",4),M.addUniform("refractionRightColor",4),M.addUniform("emissiveLeftColor",4),M.addUniform("emissiveRightColor",4),M.addUniform("vDiffuseInfos",2),M.addUniform("vAmbientInfos",2),M.addUniform("vOpacityInfos",2),M.addUniform("vReflectionInfos",2),M.addUniform("vReflectionPosition",3),M.addUniform("vReflectionSize",3),M.addUniform("vEmissiveInfos",2),M.addUniform("vLightmapInfos",2),M.addUniform("vSpecularInfos",2),M.addUniform("vBumpInfos",3),M.addUniform("diffuseMatrix",16),M.addUniform("ambientMatrix",16),M.addUniform("opacityMatrix",16),M.addUniform("reflectionMatrix",16),M.addUniform("emissiveMatrix",16),M.addUniform("lightmapMatrix",16),M.addUniform("specularMatrix",16),M.addUniform("bumpMatrix",16),M.addUniform("vTangentSpaceParams",2),M.addUniform("pointSize",1),M.addUniform("alphaCutOff",1),M.addUniform("refractionMatrix",16),M.addUniform("vRefractionInfos",4),M.addUniform("vRefractionPosition",3),M.addUniform("vRefractionSize",3),M.addUniform("vSpecularColor",4),M.addUniform("vEmissiveColor",3),M.addUniform("vDiffuseColor",4),M.addUniform("vAmbientColor",3),Z.prototype.buildUniformLayout.call(this)},M.prototype.bindForSubMesh=function(Z,j,K){var b,g=this.getScene(),Q=K.materialDefines;if(Q){var I=K.effect;if(I){this._activeEffect=I,j.getMeshUniformBuffer().bindToEffect(I,"Mesh"),j.transferToEffect(Z),this._uniformBuffer.bindToEffect(I,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,g,j,Z,this.isFrozen),this._eventInfo.subMesh=K,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),Q.OBJECTSPACE_NORMALMAP&&(Z.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var E=this._mustRebind(g,I,j.visibility);o.b.BindBonesParameters(j,I);var s=this._uniformBuffer;if(E){if(this.bindViewProjection(I),!s.useUbo||!this.isFrozen||!s.isSync){if(M.FresnelEnabled&&Q.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(s.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),s.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&s.updateColor4("opacityParts",new Y.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(s.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),s.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(s.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),s.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(s.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),s.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),g.texturesEnabled){if(this._diffuseTexture&&M.DiffuseTextureEnabled&&(s.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),o.b.BindTextureMatrix(this._diffuseTexture,s,"diffuse")),this._ambientTexture&&M.AmbientTextureEnabled&&(s.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),o.b.BindTextureMatrix(this._ambientTexture,s,"ambient")),this._opacityTexture&&M.OpacityTextureEnabled&&(s.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),o.b.BindTextureMatrix(this._opacityTexture,s,"opacity")),this._hasAlphaChannel()&&s.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&M.ReflectionTextureEnabled&&(s.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),s.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var i=this._reflectionTexture;s.updateVector3("vReflectionPosition",i.boundingBoxPosition),s.updateVector3("vReflectionSize",i.boundingBoxSize)}if(this._emissiveTexture&&M.EmissiveTextureEnabled&&(s.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),o.b.BindTextureMatrix(this._emissiveTexture,s,"emissive")),this._lightmapTexture&&M.LightmapTextureEnabled&&(s.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),o.b.BindTextureMatrix(this._lightmapTexture,s,"lightmap")),this._specularTexture&&M.SpecularTextureEnabled&&(s.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),o.b.BindTextureMatrix(this._specularTexture,s,"specular")),this._bumpTexture&&g.getEngine().getCaps().standardDerivatives&&M.BumpTextureEnabled&&(s.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),o.b.BindTextureMatrix(this._bumpTexture,s,"bump"),g._mirroredCameraPosition?s.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):s.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&M.RefractionTextureEnabled){var a=1;if(this._refractionTexture.isCube||(s.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(a=this._refractionTexture.depth)),s.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,a,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){i=this._refractionTexture;s.updateVector3("vRefractionPosition",i.boundingBoxPosition),s.updateVector3("vRefractionSize",i.boundingBoxSize)}}}this.pointsCloud&&s.updateFloat("pointSize",this.pointSize),Q.SPECULARTERM&&s.updateColor4("vSpecularColor",this.specularColor,this.specularPower),s.updateColor3("vEmissiveColor",M.EmissiveTextureEnabled?this.emissiveColor:Y.e.BlackReadOnly),s.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),g.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),s.updateColor3("vAmbientColor",this._globalAmbientColor)}g.texturesEnabled&&(this._diffuseTexture&&M.DiffuseTextureEnabled&&I.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&M.AmbientTextureEnabled&&I.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&M.OpacityTextureEnabled&&I.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&M.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?I.setTexture("reflectionCubeSampler",this._reflectionTexture):I.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&M.EmissiveTextureEnabled&&I.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&M.LightmapTextureEnabled&&I.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&M.SpecularTextureEnabled&&I.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&g.getEngine().getCaps().standardDerivatives&&M.BumpTextureEnabled&&I.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&M.RefractionTextureEnabled&&(this._refractionTexture.isCube?I.setTexture("refractionCubeSampler",this._refractionTexture):I.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(j)&&this.getScene().depthPeelingRenderer.bind(I),this._eventInfo.subMesh=K,this._callbackPluginEventBindForSubMesh(this._eventInfo),o.b.BindClipPlane(I,g),this.bindEyePosition(I)}else g.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!E&&this.isFrozen||(g.lightsEnabled&&!this._disableLighting&&o.b.BindLights(g,j,I,Q,this._maxSimultaneousLights),(g.fogEnabled&&j.applyFog&&g.fogMode!==O.c.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||j.receiveShadows||Q.PREPASS)&&this.bindView(I),o.b.BindFogParameters(g,j,I),Q.NUM_MORPH_INFLUENCERS&&o.b.BindMorphTargetParameters(j,I),Q.BAKED_VERTEX_ANIMATION_TEXTURE&&(null===(b=j.bakedVertexAnimationManager)||void 0===b||b.bind(I,Q.INSTANCES)),this.useLogarithmicDepth&&o.b.BindLogDepth(Q,I,g),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(j,this._activeEffect),s.update()}}},M.prototype.getAnimatables=function(){var M=Z.prototype.getAnimatables.call(this);return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&M.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&M.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&M.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&M.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&M.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&M.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&M.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&M.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&M.push(this._refractionTexture),M},M.prototype.getActiveTextures=function(){var M=Z.prototype.getActiveTextures.call(this);return this._diffuseTexture&&M.push(this._diffuseTexture),this._ambientTexture&&M.push(this._ambientTexture),this._opacityTexture&&M.push(this._opacityTexture),this._reflectionTexture&&M.push(this._reflectionTexture),this._emissiveTexture&&M.push(this._emissiveTexture),this._specularTexture&&M.push(this._specularTexture),this._bumpTexture&&M.push(this._bumpTexture),this._lightmapTexture&&M.push(this._lightmapTexture),this._refractionTexture&&M.push(this._refractionTexture),M},M.prototype.hasTexture=function(M){return!!Z.prototype.hasTexture.call(this,M)||(this._diffuseTexture===M||(this._ambientTexture===M||(this._opacityTexture===M||(this._reflectionTexture===M||(this._emissiveTexture===M||(this._specularTexture===M||(this._bumpTexture===M||(this._lightmapTexture===M||this._refractionTexture===M))))))))},M.prototype.dispose=function(M,j){var K,b,g,O,Q,Y,I,E,s;j&&(null===(K=this._diffuseTexture)||void 0===K||K.dispose(),null===(b=this._ambientTexture)||void 0===b||b.dispose(),null===(g=this._opacityTexture)||void 0===g||g.dispose(),null===(O=this._reflectionTexture)||void 0===O||O.dispose(),null===(Q=this._emissiveTexture)||void 0===Q||Q.dispose(),null===(Y=this._specularTexture)||void 0===Y||Y.dispose(),null===(I=this._bumpTexture)||void 0===I||I.dispose(),null===(E=this._lightmapTexture)||void 0===E||E.dispose(),null===(s=this._refractionTexture)||void 0===s||s.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),Z.prototype.dispose.call(this,M,j)},M.prototype.clone=function(Z){var j=this,K=b.b.Clone((function(){return new M(Z,j.getScene())}),this);return K.name=Z,K.id=Z,this.stencil.copyTo(K.stencil),K},M.Parse=function(Z,j,K){var g=b.b.Parse((function(){return new M(Z.name,j)}),Z,j,K);return Z.stencil&&g.stencil.parse(Z.stencil,j,K),g},Object.defineProperty(M,"DiffuseTextureEnabled",{get:function(){return f.d.DiffuseTextureEnabled},set:function(Z){f.d.DiffuseTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"DetailTextureEnabled",{get:function(){return f.d.DetailTextureEnabled},set:function(Z){f.d.DetailTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"AmbientTextureEnabled",{get:function(){return f.d.AmbientTextureEnabled},set:function(Z){f.d.AmbientTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"OpacityTextureEnabled",{get:function(){return f.d.OpacityTextureEnabled},set:function(Z){f.d.OpacityTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"ReflectionTextureEnabled",{get:function(){return f.d.ReflectionTextureEnabled},set:function(Z){f.d.ReflectionTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"EmissiveTextureEnabled",{get:function(){return f.d.EmissiveTextureEnabled},set:function(Z){f.d.EmissiveTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"SpecularTextureEnabled",{get:function(){return f.d.SpecularTextureEnabled},set:function(Z){f.d.SpecularTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"BumpTextureEnabled",{get:function(){return f.d.BumpTextureEnabled},set:function(Z){f.d.BumpTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"LightmapTextureEnabled",{get:function(){return f.d.LightmapTextureEnabled},set:function(Z){f.d.LightmapTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"RefractionTextureEnabled",{get:function(){return f.d.RefractionTextureEnabled},set:function(Z){f.d.RefractionTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"ColorGradingTextureEnabled",{get:function(){return f.d.ColorGradingTextureEnabled},set:function(Z){f.d.ColorGradingTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"FresnelEnabled",{get:function(){return f.d.FresnelEnabled},set:function(Z){f.d.FresnelEnabled=Z},enumerable:!1,configurable:!0}),(0,K.l)([(0,b.s)("diffuseTexture")],M.prototype,"_diffuseTexture",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"diffuseTexture",void 0),(0,K.l)([(0,b.s)("ambientTexture")],M.prototype,"_ambientTexture",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientTexture",void 0),(0,K.l)([(0,b.s)("opacityTexture")],M.prototype,"_opacityTexture",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"opacityTexture",void 0),(0,K.l)([(0,b.s)("reflectionTexture")],M.prototype,"_reflectionTexture",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectionTexture",void 0),(0,K.l)([(0,b.s)("emissiveTexture")],M.prototype,"_emissiveTexture",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"emissiveTexture",void 0),(0,K.l)([(0,b.s)("specularTexture")],M.prototype,"_specularTexture",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"specularTexture",void 0),(0,K.l)([(0,b.s)("bumpTexture")],M.prototype,"_bumpTexture",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"bumpTexture",void 0),(0,K.l)([(0,b.s)("lightmapTexture")],M.prototype,"_lightmapTexture",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"lightmapTexture",void 0),(0,K.l)([(0,b.s)("refractionTexture")],M.prototype,"_refractionTexture",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionTexture",void 0),(0,K.l)([(0,b.i)("ambient")],M.prototype,"ambientColor",void 0),(0,K.l)([(0,b.i)("diffuse")],M.prototype,"diffuseColor",void 0),(0,K.l)([(0,b.i)("specular")],M.prototype,"specularColor",void 0),(0,K.l)([(0,b.i)("emissive")],M.prototype,"emissiveColor",void 0),(0,K.l)([(0,b.z)()],M.prototype,"specularPower",void 0),(0,K.l)([(0,b.z)("useAlphaFromDiffuseTexture")],M.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"useAlphaFromDiffuseTexture",void 0),(0,K.l)([(0,b.z)("useEmissiveAsIllumination")],M.prototype,"_useEmissiveAsIllumination",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useEmissiveAsIllumination",void 0),(0,K.l)([(0,b.z)("linkEmissiveWithDiffuse")],M.prototype,"_linkEmissiveWithDiffuse",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"linkEmissiveWithDiffuse",void 0),(0,K.l)([(0,b.z)("useSpecularOverAlpha")],M.prototype,"_useSpecularOverAlpha",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useSpecularOverAlpha",void 0),(0,K.l)([(0,b.z)("useReflectionOverAlpha")],M.prototype,"_useReflectionOverAlpha",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useReflectionOverAlpha",void 0),(0,K.l)([(0,b.z)("disableLighting")],M.prototype,"_disableLighting",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsLightsDirty")],M.prototype,"disableLighting",void 0),(0,K.l)([(0,b.z)("useObjectSpaceNormalMap")],M.prototype,"_useObjectSpaceNormalMap",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useObjectSpaceNormalMap",void 0),(0,K.l)([(0,b.z)("useParallax")],M.prototype,"_useParallax",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useParallax",void 0),(0,K.l)([(0,b.z)("useParallaxOcclusion")],M.prototype,"_useParallaxOcclusion",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useParallaxOcclusion",void 0),(0,K.l)([(0,b.z)()],M.prototype,"parallaxScaleBias",void 0),(0,K.l)([(0,b.z)("roughness")],M.prototype,"_roughness",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"roughness",void 0),(0,K.l)([(0,b.z)()],M.prototype,"indexOfRefraction",void 0),(0,K.l)([(0,b.z)()],M.prototype,"invertRefractionY",void 0),(0,K.l)([(0,b.z)()],M.prototype,"alphaCutOff",void 0),(0,K.l)([(0,b.z)("useLightmapAsShadowmap")],M.prototype,"_useLightmapAsShadowmap",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useLightmapAsShadowmap",void 0),(0,K.l)([(0,b.k)("diffuseFresnelParameters")],M.prototype,"_diffuseFresnelParameters",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"diffuseFresnelParameters",void 0),(0,K.l)([(0,b.k)("opacityFresnelParameters")],M.prototype,"_opacityFresnelParameters",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsFresnelAndMiscDirty")],M.prototype,"opacityFresnelParameters",void 0),(0,K.l)([(0,b.k)("reflectionFresnelParameters")],M.prototype,"_reflectionFresnelParameters",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"reflectionFresnelParameters",void 0),(0,K.l)([(0,b.k)("refractionFresnelParameters")],M.prototype,"_refractionFresnelParameters",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"refractionFresnelParameters",void 0),(0,K.l)([(0,b.k)("emissiveFresnelParameters")],M.prototype,"_emissiveFresnelParameters",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"emissiveFresnelParameters",void 0),(0,K.l)([(0,b.z)("useReflectionFresnelFromSpecular")],M.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"useReflectionFresnelFromSpecular",void 0),(0,K.l)([(0,b.z)("useGlossinessFromSpecularMapAlpha")],M.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,K.l)([(0,b.z)("maxSimultaneousLights")],M.prototype,"_maxSimultaneousLights",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsLightsDirty")],M.prototype,"maxSimultaneousLights",void 0),(0,K.l)([(0,b.z)("invertNormalMapX")],M.prototype,"_invertNormalMapX",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertNormalMapX",void 0),(0,K.l)([(0,b.z)("invertNormalMapY")],M.prototype,"_invertNormalMapY",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertNormalMapY",void 0),(0,K.l)([(0,b.z)("twoSidedLighting")],M.prototype,"_twoSidedLighting",void 0),(0,K.l)([(0,b.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"twoSidedLighting",void 0),(0,K.l)([(0,b.z)()],M.prototype,"useLogarithmicDepth",null),M}(V.e);(0,G.c)("BABYLON.StandardMaterial",e),O.c.DefaultMaterialFactory=function(Z){return new e("default material",Z)}},86018:function(Z,M,j){"use strict";j.d(M,{b:function(){return K}});var K=function(){function Z(){}return Z.BindClipPlane=function(Z,M){if(M.clipPlane){var j=M.clipPlane;Z.setFloat4("vClipPlane",j.normal.x,j.normal.y,j.normal.z,j.d)}if(M.clipPlane2){j=M.clipPlane2;Z.setFloat4("vClipPlane2",j.normal.x,j.normal.y,j.normal.z,j.d)}if(M.clipPlane3){j=M.clipPlane3;Z.setFloat4("vClipPlane3",j.normal.x,j.normal.y,j.normal.z,j.d)}if(M.clipPlane4){j=M.clipPlane4;Z.setFloat4("vClipPlane4",j.normal.x,j.normal.y,j.normal.z,j.d)}if(M.clipPlane5){j=M.clipPlane5;Z.setFloat4("vClipPlane5",j.normal.x,j.normal.y,j.normal.z,j.d)}if(M.clipPlane6){j=M.clipPlane6;Z.setFloat4("vClipPlane6",j.normal.x,j.normal.y,j.normal.z,j.d)}},Z}()},90534:function(Z,M,j){"use strict";j.d(M,{d:function(){return Q}});var K=j(9127),b=j(9217),g=j(72284),O=j(12753);g.d.prototype.createUniformBuffer=function(Z){var M=this._gl.createBuffer();if(!M)throw new Error("Unable to create uniform buffer");var j=new O.b(M);return this.bindUniformBuffer(j),Z instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,Z,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(Z),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),j.references=1,j},g.d.prototype.createDynamicUniformBuffer=function(Z){var M=this._gl.createBuffer();if(!M)throw new Error("Unable to create dynamic uniform buffer");var j=new O.b(M);return this.bindUniformBuffer(j),Z instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,Z,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(Z),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),j.references=1,j},g.d.prototype.updateUniformBuffer=function(Z,M,j,K){this.bindUniformBuffer(Z),void 0===j&&(j=0),void 0===K?M instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,j,M):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,j,new Float32Array(M)):M instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,M.subarray(j,j+K)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(M).subarray(j,j+K)),this.bindUniformBuffer(null)},g.d.prototype.bindUniformBuffer=function(Z){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,Z?Z.underlyingResource:null)},g.d.prototype.bindUniformBufferBase=function(Z,M,j){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,M,Z?Z.underlyingResource:null)},g.d.prototype.bindUniformBlock=function(Z,M,j){var K=Z.program,b=this._gl.getUniformBlockIndex(K,M);4294967295!==b&&this._gl.uniformBlockBinding(K,b,j)};var Q=function(){function Z(Z,M,j,K,b){void 0===b&&(b=!1),this._valueCache={},this._engine=Z,this._noUBO=!Z.supportsUniformBuffers||b,this._dynamic=j,this._name=null!==K&&void 0!==K?K:"no-name",this._data=M||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}return Object.defineProperty(Z.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),Z.prototype.isDynamic=function(){return void 0!==this._dynamic},Z.prototype.getData=function(){return this._bufferData},Z.prototype.getBuffer=function(){return this._buffer},Z.prototype._fillAlignment=function(Z){var M;if(M=Z<=2?Z:4,this._uniformLocationPointer%M!==0){var j=this._uniformLocationPointer;this._uniformLocationPointer+=M-this._uniformLocationPointer%M;for(var K=this._uniformLocationPointer-j,b=0;b<K;b++)this._data.push(0)}},Z.prototype.addUniform=function(Z,M,j){if(void 0===j&&(j=0),!this._noUBO&&void 0===this._uniformLocations[Z]){var K;if(j>0){if(M instanceof Array)throw"addUniform should not be use with Array in UBO: "+Z;if(this._fillAlignment(4),this._uniformArraySizes[Z]={strideSize:M,arraySize:j},16==M)M*=j;else M=M*j+(4-M)*j;K=[];for(var b=0;b<M;b++)K.push(0)}else{if(M instanceof Array)M=(K=M).length;else{M=M,K=[];for(b=0;b<M;b++)K.push(0)}this._fillAlignment(M)}this._uniformSizes[Z]=M,this._uniformLocations[Z]=this._uniformLocationPointer,this._uniformLocationPointer+=M;for(b=0;b<M;b++)this._data.push(K[b]);this._needSync=!0}},Z.prototype.addMatrix=function(Z,M){this.addUniform(Z,Array.prototype.slice.call(M.toArray()))},Z.prototype.addFloat2=function(Z,M,j){var K=[M,j];this.addUniform(Z,K)},Z.prototype.addFloat3=function(Z,M,j,K){var b=[M,j,K];this.addUniform(Z,b)},Z.prototype.addColor3=function(Z,M){var j=[M.r,M.g,M.b];this.addUniform(Z,j)},Z.prototype.addColor4=function(Z,M,j){var K=[M.r,M.g,M.b,j];this.addUniform(Z,K)},Z.prototype.addVector3=function(Z,M){var j=[M.x,M.y,M.z];this.addUniform(Z,j)},Z.prototype.addMatrix3x3=function(Z){this.addUniform(Z,12)},Z.prototype.addMatrix2x2=function(Z){this.addUniform(Z,8)},Z.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},Z.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))},Object.defineProperty(Z.prototype,"_numBuffers",{get:function(){return this._buffers.length},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"_indexBuffer",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Z.prototype._buffersEqual=function(Z,M){for(var j=0;j<Z.length;++j)if(Z[j]!==M[j])return!1;return!0},Z.prototype._copyBuffer=function(Z,M){for(var j=0;j<Z.length;++j)M[j]=Z[j]},Z.prototype.update=function(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(Z._UpdatedUbosInFrame[this._name]||(Z._UpdatedUbosInFrame[this._name]=0),Z._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()},Z.prototype._createNewBuffer=function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()},Z.prototype._checkNewFrame=function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)},Z.prototype.updateUniform=function(Z,M,j){this._checkNewFrame();var g=this._uniformLocations[Z];if(void 0===g){if(this._buffer)return void K.c.Error("Cannot add an uniform after UBO has been created.");this.addUniform(Z,j),g=this._uniformLocations[Z]}if(this._buffer||this.create(),this._dynamic)for(Q=0;Q<j;Q++)this._bufferData[g+Q]=M[Q];else{for(var O=!1,Q=0;Q<j;Q++)(16===j&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[g+Q]!==b.d.FloatRound(M[Q]))&&(O=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[g+Q]=M[Q]);this._needSync=this._needSync||O}},Z.prototype.updateUniformArray=function(Z,M,j){this._checkNewFrame();var g=this._uniformLocations[Z];if(void 0!==g){this._buffer||this.create();var O=this._uniformArraySizes[Z];if(this._dynamic)for(E=0;E<j;E++)this._bufferData[g+E]=M[E];else{for(var Q=!1,Y=0,I=0,E=0;E<j;E++)if(this._bufferData[g+4*I+Y]!==b.d.FloatRound(M[E])&&(Q=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[g+4*I+Y]=M[E]),++Y===O.strideSize){for(;Y<4;Y++)this._bufferData[g+4*I+Y]=0;Y=0,I++}this._needSync=this._needSync||Q}}else K.c.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.")},Z.prototype._cacheMatrix=function(Z,M){this._checkNewFrame();var j=this._valueCache[Z],K=M.updateFlag;return(void 0===j||j!==K)&&(this._valueCache[Z]=K,!0)},Z.prototype._updateMatrix3x3ForUniform=function(M,j){for(var K=0;K<3;K++)Z._TempBuffer[4*K]=j[3*K],Z._TempBuffer[4*K+1]=j[3*K+1],Z._TempBuffer[4*K+2]=j[3*K+2],Z._TempBuffer[4*K+3]=0;this.updateUniform(M,Z._TempBuffer,12)},Z.prototype._updateMatrix3x3ForEffect=function(Z,M){this._currentEffect.setMatrix3x3(Z,M)},Z.prototype._updateMatrix2x2ForEffect=function(Z,M){this._currentEffect.setMatrix2x2(Z,M)},Z.prototype._updateMatrix2x2ForUniform=function(M,j){for(var K=0;K<2;K++)Z._TempBuffer[4*K]=j[2*K],Z._TempBuffer[4*K+1]=j[2*K+1],Z._TempBuffer[4*K+2]=0,Z._TempBuffer[4*K+3]=0;this.updateUniform(M,Z._TempBuffer,8)},Z.prototype._updateFloatForEffect=function(Z,M){this._currentEffect.setFloat(Z,M)},Z.prototype._updateFloatForUniform=function(M,j){Z._TempBuffer[0]=j,this.updateUniform(M,Z._TempBuffer,1)},Z.prototype._updateFloat2ForEffect=function(Z,M,j,K){void 0===K&&(K=""),this._currentEffect.setFloat2(Z+K,M,j)},Z.prototype._updateFloat2ForUniform=function(M,j,K){Z._TempBuffer[0]=j,Z._TempBuffer[1]=K,this.updateUniform(M,Z._TempBuffer,2)},Z.prototype._updateFloat3ForEffect=function(Z,M,j,K,b){void 0===b&&(b=""),this._currentEffect.setFloat3(Z+b,M,j,K)},Z.prototype._updateFloat3ForUniform=function(M,j,K,b){Z._TempBuffer[0]=j,Z._TempBuffer[1]=K,Z._TempBuffer[2]=b,this.updateUniform(M,Z._TempBuffer,3)},Z.prototype._updateFloat4ForEffect=function(Z,M,j,K,b,g){void 0===g&&(g=""),this._currentEffect.setFloat4(Z+g,M,j,K,b)},Z.prototype._updateFloat4ForUniform=function(M,j,K,b,g){Z._TempBuffer[0]=j,Z._TempBuffer[1]=K,Z._TempBuffer[2]=b,Z._TempBuffer[3]=g,this.updateUniform(M,Z._TempBuffer,4)},Z.prototype._updateFloatArrayForEffect=function(Z,M){this._currentEffect.setFloatArray(Z,M)},Z.prototype._updateFloatArrayForUniform=function(Z,M){this.updateUniformArray(Z,M,M.length)},Z.prototype._updateArrayForEffect=function(Z,M){this._currentEffect.setArray(Z,M)},Z.prototype._updateArrayForUniform=function(Z,M){this.updateUniformArray(Z,M,M.length)},Z.prototype._updateIntArrayForEffect=function(Z,M){this._currentEffect.setIntArray(Z,M)},Z.prototype._updateIntArrayForUniform=function(M,j){Z._TempBufferInt32View.set(j),this.updateUniformArray(M,Z._TempBuffer,j.length)},Z.prototype._updateMatrixForEffect=function(Z,M){this._currentEffect.setMatrix(Z,M)},Z.prototype._updateMatrixForUniform=function(Z,M){this._cacheMatrix(Z,M)&&this.updateUniform(Z,M.toArray(),16)},Z.prototype._updateMatricesForEffect=function(Z,M){this._currentEffect.setMatrices(Z,M)},Z.prototype._updateMatricesForUniform=function(Z,M){this.updateUniform(Z,M,M.length)},Z.prototype._updateVector3ForEffect=function(Z,M){this._currentEffect.setVector3(Z,M)},Z.prototype._updateVector3ForUniform=function(M,j){Z._TempBuffer[0]=j.x,Z._TempBuffer[1]=j.y,Z._TempBuffer[2]=j.z,this.updateUniform(M,Z._TempBuffer,3)},Z.prototype._updateVector4ForEffect=function(Z,M){this._currentEffect.setVector4(Z,M)},Z.prototype._updateVector4ForUniform=function(M,j){Z._TempBuffer[0]=j.x,Z._TempBuffer[1]=j.y,Z._TempBuffer[2]=j.z,Z._TempBuffer[3]=j.w,this.updateUniform(M,Z._TempBuffer,4)},Z.prototype._updateColor3ForEffect=function(Z,M,j){void 0===j&&(j=""),this._currentEffect.setColor3(Z+j,M)},Z.prototype._updateColor3ForUniform=function(M,j){Z._TempBuffer[0]=j.r,Z._TempBuffer[1]=j.g,Z._TempBuffer[2]=j.b,this.updateUniform(M,Z._TempBuffer,3)},Z.prototype._updateColor4ForEffect=function(Z,M,j,K){void 0===K&&(K=""),this._currentEffect.setColor4(Z+K,M,j)},Z.prototype._updateDirectColor4ForEffect=function(Z,M,j){void 0===j&&(j=""),this._currentEffect.setDirectColor4(Z+j,M)},Z.prototype._updateColor4ForUniform=function(M,j,K){Z._TempBuffer[0]=j.r,Z._TempBuffer[1]=j.g,Z._TempBuffer[2]=j.b,Z._TempBuffer[3]=K,this.updateUniform(M,Z._TempBuffer,4)},Z.prototype._updateDirectColor4ForUniform=function(M,j){Z._TempBuffer[0]=j.r,Z._TempBuffer[1]=j.g,Z._TempBuffer[2]=j.b,Z._TempBuffer[3]=j.a,this.updateUniform(M,Z._TempBuffer,4)},Z.prototype._updateIntForEffect=function(Z,M,j){void 0===j&&(j=""),this._currentEffect.setInt(Z+j,M)},Z.prototype._updateIntForUniform=function(M,j){Z._TempBufferInt32View[0]=j,this.updateUniform(M,Z._TempBuffer,1)},Z.prototype._updateInt2ForEffect=function(Z,M,j,K){void 0===K&&(K=""),this._currentEffect.setInt2(Z+K,M,j)},Z.prototype._updateInt2ForUniform=function(M,j,K){Z._TempBufferInt32View[0]=j,Z._TempBufferInt32View[1]=K,this.updateUniform(M,Z._TempBuffer,2)},Z.prototype._updateInt3ForEffect=function(Z,M,j,K,b){void 0===b&&(b=""),this._currentEffect.setInt3(Z+b,M,j,K)},Z.prototype._updateInt3ForUniform=function(M,j,K,b){Z._TempBufferInt32View[0]=j,Z._TempBufferInt32View[1]=K,Z._TempBufferInt32View[2]=b,this.updateUniform(M,Z._TempBuffer,3)},Z.prototype._updateInt4ForEffect=function(Z,M,j,K,b,g){void 0===g&&(g=""),this._currentEffect.setInt4(Z+g,M,j,K,b)},Z.prototype._updateInt4ForUniform=function(M,j,K,b,g){Z._TempBufferInt32View[0]=j,Z._TempBufferInt32View[1]=K,Z._TempBufferInt32View[2]=b,Z._TempBufferInt32View[3]=g,this.updateUniform(M,Z._TempBuffer,4)},Z.prototype.setTexture=function(Z,M){this._currentEffect.setTexture(Z,M)},Z.prototype.updateUniformDirectly=function(Z,M){this.updateUniform(Z,M,M.length),this.update()},Z.prototype.bindToEffect=function(Z,M){this._currentEffect=Z,this._currentEffectName=M},Z.prototype.bindUniformBuffer=function(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)},Z.prototype.unbindEffect=function(){this._currentEffect=void 0,this._currentEffectName=void 0},Z.prototype.setDataBuffer=function(Z){if(!this._buffers)return this._buffer===Z;for(var M=0;M<this._buffers.length;++M){if(this._buffers[M][0]===Z)return this._bufferIndex=M,this._buffer=Z,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1},Z.prototype.dispose=function(){if(!this._noUBO){var Z=this._engine._uniformBuffers,M=Z.indexOf(this);if(-1!==M&&(Z[M]=Z[Z.length-1],Z.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var j=0;j<this._buffers.length;++j){var K=this._buffers[j][0];this._engine._releaseBuffer(K)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},Z._UpdatedUbosInFrame={},Z._MAX_UNIFORM_SIZE=256,Z._TempBuffer=new Float32Array(Z._MAX_UNIFORM_SIZE),Z._TempBufferInt32View=new Uint32Array(Z._TempBuffer.buffer),Z}()},54044:function(Z,M,j){"use strict";j.d(M,{b:function(){return O},c:function(){return g},f:function(){return K}});var K,b=j(80105);!function(Z){Z[Z.LOCAL=0]="LOCAL",Z[Z.WORLD=1]="WORLD",Z[Z.BONE=2]="BONE"}(K||(K={}));var g,O=function(){function Z(){}return Z.X=new b.k(1,0,0),Z.Y=new b.k(0,1,0),Z.Z=new b.k(0,0,1),Z}();!function(Z){Z[Z.X=0]="X",Z[Z.Y=1]="Y",Z[Z.Z=2]="Z"}(g||(g={}))},9488:function(Z,M,j){"use strict";j.d(M,{e:function(){return Q},g:function(){return Y},h:function(){return I}});var K=j(96658),b=j(61686),g=j(89214),O=j(31709),Q=function(){function Z(Z,M,j){void 0===Z&&(Z=0),void 0===M&&(M=0),void 0===j&&(j=0),this.r=Z,this.g=M,this.b=j}return Z.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},Z.prototype.getClassName=function(){return"Color3"},Z.prototype.getHashCode=function(){var Z=255*this.r|0;return Z=397*(Z=397*Z^(255*this.g|0))^(255*this.b|0)},Z.prototype.toArray=function(Z,M){return void 0===M&&(M=0),Z[M]=this.r,Z[M+1]=this.g,Z[M+2]=this.b,this},Z.prototype.fromArray=function(M,j){return void 0===j&&(j=0),Z.FromArrayToRef(M,j,this),this},Z.prototype.toColor4=function(Z){return void 0===Z&&(Z=1),new Y(this.r,this.g,this.b,Z)},Z.prototype.asArray=function(){return[this.r,this.g,this.b]},Z.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},Z.prototype.multiply=function(M){return new Z(this.r*M.r,this.g*M.g,this.b*M.b)},Z.prototype.multiplyToRef=function(Z,M){return M.r=this.r*Z.r,M.g=this.g*Z.g,M.b=this.b*Z.b,this},Z.prototype.equals=function(Z){return Z&&this.r===Z.r&&this.g===Z.g&&this.b===Z.b},Z.prototype.equalsFloats=function(Z,M,j){return this.r===Z&&this.g===M&&this.b===j},Z.prototype.scale=function(M){return new Z(this.r*M,this.g*M,this.b*M)},Z.prototype.scaleToRef=function(Z,M){return M.r=this.r*Z,M.g=this.g*Z,M.b=this.b*Z,this},Z.prototype.scaleAndAddToRef=function(Z,M){return M.r+=this.r*Z,M.g+=this.g*Z,M.b+=this.b*Z,this},Z.prototype.clampToRef=function(Z,M,j){return void 0===Z&&(Z=0),void 0===M&&(M=1),j.r=K.b.Clamp(this.r,Z,M),j.g=K.b.Clamp(this.g,Z,M),j.b=K.b.Clamp(this.b,Z,M),this},Z.prototype.add=function(M){return new Z(this.r+M.r,this.g+M.g,this.b+M.b)},Z.prototype.addToRef=function(Z,M){return M.r=this.r+Z.r,M.g=this.g+Z.g,M.b=this.b+Z.b,this},Z.prototype.subtract=function(M){return new Z(this.r-M.r,this.g-M.g,this.b-M.b)},Z.prototype.subtractToRef=function(Z,M){return M.r=this.r-Z.r,M.g=this.g-Z.g,M.b=this.b-Z.b,this},Z.prototype.clone=function(){return new Z(this.r,this.g,this.b)},Z.prototype.copyFrom=function(Z){return this.r=Z.r,this.g=Z.g,this.b=Z.b,this},Z.prototype.copyFromFloats=function(Z,M,j){return this.r=Z,this.g=M,this.b=j,this},Z.prototype.set=function(Z,M,j){return this.copyFromFloats(Z,M,j)},Z.prototype.toHexString=function(){var Z=Math.round(255*this.r),M=Math.round(255*this.g),j=Math.round(255*this.b);return"#"+K.b.ToHex(Z)+K.b.ToHex(M)+K.b.ToHex(j)},Z.prototype.toLinearSpace=function(){var M=new Z;return this.toLinearSpaceToRef(M),M},Z.prototype.toHSV=function(){var M=new Z;return this.toHSVToRef(M),M},Z.prototype.toHSVToRef=function(Z){var M=this.r,j=this.g,K=this.b,b=Math.max(M,j,K),g=Math.min(M,j,K),O=0,Q=0,Y=b,I=b-g;0!==b&&(Q=I/b),b!=g&&(b==M?(O=(j-K)/I,j<K&&(O+=6)):b==j?O=(K-M)/I+2:b==K&&(O=(M-j)/I+4),O*=60),Z.r=O,Z.g=Q,Z.b=Y},Z.prototype.toLinearSpaceToRef=function(Z){return Z.r=Math.pow(this.r,b.i),Z.g=Math.pow(this.g,b.i),Z.b=Math.pow(this.b,b.i),this},Z.prototype.toGammaSpace=function(){var M=new Z;return this.toGammaSpaceToRef(M),M},Z.prototype.toGammaSpaceToRef=function(Z){return Z.r=Math.pow(this.r,b.h),Z.g=Math.pow(this.g,b.h),Z.b=Math.pow(this.b,b.h),this},Z.HSVtoRGBToRef=function(Z,M,j,K){var b=j*M,g=Z/60,O=b*(1-Math.abs(g%2-1)),Q=0,Y=0,I=0;g>=0&&g<=1?(Q=b,Y=O):g>=1&&g<=2?(Q=O,Y=b):g>=2&&g<=3?(Y=b,I=O):g>=3&&g<=4?(Y=O,I=b):g>=4&&g<=5?(Q=O,I=b):g>=5&&g<=6&&(Q=b,I=O);var E=j-b;K.set(Q+E,Y+E,I+E)},Z.FromHexString=function(M){if("#"!==M.substring(0,1)||7!==M.length)return new Z(0,0,0);var j=parseInt(M.substring(1,3),16),K=parseInt(M.substring(3,5),16),b=parseInt(M.substring(5,7),16);return Z.FromInts(j,K,b)},Z.FromArray=function(M,j){return void 0===j&&(j=0),new Z(M[j],M[j+1],M[j+2])},Z.FromArrayToRef=function(Z,M,j){void 0===M&&(M=0),j.r=Z[M],j.g=Z[M+1],j.b=Z[M+2]},Z.FromInts=function(M,j,K){return new Z(M/255,j/255,K/255)},Z.Lerp=function(M,j,K){var b=new Z(0,0,0);return Z.LerpToRef(M,j,K,b),b},Z.LerpToRef=function(Z,M,j,K){K.r=Z.r+(M.r-Z.r)*j,K.g=Z.g+(M.g-Z.g)*j,K.b=Z.b+(M.b-Z.b)*j},Z.Hermite=function(M,j,K,b,g){var O=g*g,Q=g*O,Y=2*Q-3*O+1,I=-2*Q+3*O,E=Q-2*O+g,s=Q-O;return new Z(M.r*Y+K.r*I+j.r*E+b.r*s,M.g*Y+K.g*I+j.g*E+b.g*s,M.b*Y+K.b*I+j.b*E+b.b*s)},Z.Hermite1stDerivative=function(M,j,K,b,g){var O=Z.Black();return this.Hermite1stDerivativeToRef(M,j,K,b,g,O),O},Z.Hermite1stDerivativeToRef=function(Z,M,j,K,b,g){var O=b*b;g.r=6*(O-b)*Z.r+(3*O-4*b+1)*M.r+6*(-O+b)*j.r+(3*O-2*b)*K.r,g.g=6*(O-b)*Z.g+(3*O-4*b+1)*M.g+6*(-O+b)*j.g+(3*O-2*b)*K.g,g.b=6*(O-b)*Z.b+(3*O-4*b+1)*M.b+6*(-O+b)*j.b+(3*O-2*b)*K.b},Z.Red=function(){return new Z(1,0,0)},Z.Green=function(){return new Z(0,1,0)},Z.Blue=function(){return new Z(0,0,1)},Z.Black=function(){return new Z(0,0,0)},Object.defineProperty(Z,"BlackReadOnly",{get:function(){return Z._BlackReadOnly},enumerable:!1,configurable:!0}),Z.White=function(){return new Z(1,1,1)},Z.Purple=function(){return new Z(.5,0,.5)},Z.Magenta=function(){return new Z(1,0,1)},Z.Yellow=function(){return new Z(1,1,0)},Z.Gray=function(){return new Z(.5,.5,.5)},Z.Teal=function(){return new Z(0,1,1)},Z.Random=function(){return new Z(Math.random(),Math.random(),Math.random())},Z._BlackReadOnly=Z.Black(),Z}(),Y=function(){function Z(Z,M,j,K){void 0===Z&&(Z=0),void 0===M&&(M=0),void 0===j&&(j=0),void 0===K&&(K=1),this.r=Z,this.g=M,this.b=j,this.a=K}return Z.prototype.addInPlace=function(Z){return this.r+=Z.r,this.g+=Z.g,this.b+=Z.b,this.a+=Z.a,this},Z.prototype.asArray=function(){return[this.r,this.g,this.b,this.a]},Z.prototype.toArray=function(Z,M){return void 0===M&&(M=0),Z[M]=this.r,Z[M+1]=this.g,Z[M+2]=this.b,Z[M+3]=this.a,this},Z.prototype.fromArray=function(M,j){return void 0===j&&(j=0),Z.FromArrayToRef(M,j,this),this},Z.prototype.equals=function(Z){return Z&&this.r===Z.r&&this.g===Z.g&&this.b===Z.b&&this.a===Z.a},Z.prototype.add=function(M){return new Z(this.r+M.r,this.g+M.g,this.b+M.b,this.a+M.a)},Z.prototype.subtract=function(M){return new Z(this.r-M.r,this.g-M.g,this.b-M.b,this.a-M.a)},Z.prototype.subtractToRef=function(Z,M){return M.r=this.r-Z.r,M.g=this.g-Z.g,M.b=this.b-Z.b,M.a=this.a-Z.a,this},Z.prototype.scale=function(M){return new Z(this.r*M,this.g*M,this.b*M,this.a*M)},Z.prototype.scaleToRef=function(Z,M){return M.r=this.r*Z,M.g=this.g*Z,M.b=this.b*Z,M.a=this.a*Z,this},Z.prototype.scaleAndAddToRef=function(Z,M){return M.r+=this.r*Z,M.g+=this.g*Z,M.b+=this.b*Z,M.a+=this.a*Z,this},Z.prototype.clampToRef=function(Z,M,j){return void 0===Z&&(Z=0),void 0===M&&(M=1),j.r=K.b.Clamp(this.r,Z,M),j.g=K.b.Clamp(this.g,Z,M),j.b=K.b.Clamp(this.b,Z,M),j.a=K.b.Clamp(this.a,Z,M),this},Z.prototype.multiply=function(M){return new Z(this.r*M.r,this.g*M.g,this.b*M.b,this.a*M.a)},Z.prototype.multiplyToRef=function(Z,M){return M.r=this.r*Z.r,M.g=this.g*Z.g,M.b=this.b*Z.b,M.a=this.a*Z.a,M},Z.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},Z.prototype.getClassName=function(){return"Color4"},Z.prototype.getHashCode=function(){var Z=255*this.r|0;return Z=397*(Z=397*(Z=397*Z^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},Z.prototype.clone=function(){return new Z(this.r,this.g,this.b,this.a)},Z.prototype.copyFrom=function(Z){return this.r=Z.r,this.g=Z.g,this.b=Z.b,this.a=Z.a,this},Z.prototype.copyFromFloats=function(Z,M,j,K){return this.r=Z,this.g=M,this.b=j,this.a=K,this},Z.prototype.set=function(Z,M,j,K){return this.copyFromFloats(Z,M,j,K)},Z.prototype.toHexString=function(Z){void 0===Z&&(Z=!1);var M=Math.round(255*this.r),j=Math.round(255*this.g),b=Math.round(255*this.b);if(Z)return"#"+K.b.ToHex(M)+K.b.ToHex(j)+K.b.ToHex(b);var g=Math.round(255*this.a);return"#"+K.b.ToHex(M)+K.b.ToHex(j)+K.b.ToHex(b)+K.b.ToHex(g)},Z.prototype.toLinearSpace=function(){var M=new Z;return this.toLinearSpaceToRef(M),M},Z.prototype.toLinearSpaceToRef=function(Z){return Z.r=Math.pow(this.r,b.i),Z.g=Math.pow(this.g,b.i),Z.b=Math.pow(this.b,b.i),Z.a=this.a,this},Z.prototype.toGammaSpace=function(){var M=new Z;return this.toGammaSpaceToRef(M),M},Z.prototype.toGammaSpaceToRef=function(Z){return Z.r=Math.pow(this.r,b.h),Z.g=Math.pow(this.g,b.h),Z.b=Math.pow(this.b,b.h),Z.a=this.a,this},Z.FromHexString=function(M){if("#"!==M.substring(0,1)||9!==M.length&&7!==M.length)return new Z(0,0,0,0);var j=parseInt(M.substring(1,3),16),K=parseInt(M.substring(3,5),16),b=parseInt(M.substring(5,7),16),g=9===M.length?parseInt(M.substring(7,9),16):255;return Z.FromInts(j,K,b,g)},Z.Lerp=function(M,j,K){var b=new Z(0,0,0,0);return Z.LerpToRef(M,j,K,b),b},Z.LerpToRef=function(Z,M,j,K){K.r=Z.r+(M.r-Z.r)*j,K.g=Z.g+(M.g-Z.g)*j,K.b=Z.b+(M.b-Z.b)*j,K.a=Z.a+(M.a-Z.a)*j},Z.Hermite=function(M,j,K,b,g){var O=g*g,Q=g*O,Y=2*Q-3*O+1,I=-2*Q+3*O,E=Q-2*O+g,s=Q-O;return new Z(M.r*Y+K.r*I+j.r*E+b.r*s,M.g*Y+K.g*I+j.g*E+b.g*s,M.b*Y+K.b*I+j.b*E+b.b*s,M.a*Y+K.a*I+j.a*E+b.a*s)},Z.Hermite1stDerivative=function(M,j,K,b,g){var O=new Z;return this.Hermite1stDerivativeToRef(M,j,K,b,g,O),O},Z.Hermite1stDerivativeToRef=function(Z,M,j,K,b,g){var O=b*b;g.r=6*(O-b)*Z.r+(3*O-4*b+1)*M.r+6*(-O+b)*j.r+(3*O-2*b)*K.r,g.g=6*(O-b)*Z.g+(3*O-4*b+1)*M.g+6*(-O+b)*j.g+(3*O-2*b)*K.g,g.b=6*(O-b)*Z.b+(3*O-4*b+1)*M.b+6*(-O+b)*j.b+(3*O-2*b)*K.b,g.a=6*(O-b)*Z.a+(3*O-4*b+1)*M.a+6*(-O+b)*j.a+(3*O-2*b)*K.a},Z.FromColor3=function(M,j){return void 0===j&&(j=1),new Z(M.r,M.g,M.b,j)},Z.FromArray=function(M,j){return void 0===j&&(j=0),new Z(M[j],M[j+1],M[j+2],M[j+3])},Z.FromArrayToRef=function(Z,M,j){void 0===M&&(M=0),j.r=Z[M],j.g=Z[M+1],j.b=Z[M+2],j.a=Z[M+3]},Z.FromInts=function(M,j,K,b){return new Z(M/255,j/255,K/255,b/255)},Z.CheckColors4=function(Z,M){if(Z.length===3*M){for(var j=[],K=0;K<Z.length;K+=3){var b=K/3*4;j[b]=Z[K],j[b+1]=Z[K+1],j[b+2]=Z[K+2],j[b+3]=1}return j}return Z},Z}(),I=function(){function Z(){}return Z.Color3=g.e.BuildArray(3,Q.Black),Z.Color4=g.e.BuildArray(3,(function(){return new Y(0,0,0,0)})),Z}();(0,O.c)("BABYLON.Color3",Q),(0,O.c)("BABYLON.Color4",Y)},61686:function(Z,M,j){"use strict";j.d(M,{e:function(){return O},g:function(){return g},h:function(){return K},i:function(){return b}});var K=1/2.2,b=2.2,g=(1+Math.sqrt(5))/2,O=.001},46647:function(Z,M,j){"use strict";j.d(M,{e:function(){return b}});var K=j(85567),b=function(){function Z(){}return Z.GetPlanes=function(M){for(var j=[],b=0;b<6;b++)j.push(new K.e(0,0,0,0));return Z.GetPlanesToRef(M,j),j},Z.GetNearPlaneToRef=function(Z,M){var j=Z.m;M.normal.x=j[3]+j[2],M.normal.y=j[7]+j[6],M.normal.z=j[11]+j[10],M.d=j[15]+j[14],M.normalize()},Z.GetFarPlaneToRef=function(Z,M){var j=Z.m;M.normal.x=j[3]-j[2],M.normal.y=j[7]-j[6],M.normal.z=j[11]-j[10],M.d=j[15]-j[14],M.normalize()},Z.GetLeftPlaneToRef=function(Z,M){var j=Z.m;M.normal.x=j[3]+j[0],M.normal.y=j[7]+j[4],M.normal.z=j[11]+j[8],M.d=j[15]+j[12],M.normalize()},Z.GetRightPlaneToRef=function(Z,M){var j=Z.m;M.normal.x=j[3]-j[0],M.normal.y=j[7]-j[4],M.normal.z=j[11]-j[8],M.d=j[15]-j[12],M.normalize()},Z.GetTopPlaneToRef=function(Z,M){var j=Z.m;M.normal.x=j[3]-j[1],M.normal.y=j[7]-j[5],M.normal.z=j[11]-j[9],M.d=j[15]-j[13],M.normalize()},Z.GetBottomPlaneToRef=function(Z,M){var j=Z.m;M.normal.x=j[3]+j[1],M.normal.y=j[7]+j[5],M.normal.z=j[11]+j[9],M.d=j[15]+j[13],M.normalize()},Z.GetPlanesToRef=function(M,j){Z.GetNearPlaneToRef(M,j[0]),Z.GetFarPlaneToRef(M,j[1]),Z.GetLeftPlaneToRef(M,j[2]),Z.GetRightPlaneToRef(M,j[3]),Z.GetTopPlaneToRef(M,j[4]),Z.GetBottomPlaneToRef(M,j[5])},Z}()},18445:function(Z,M,j){"use strict";j.d(M,{c:function(){return Q},d:function(){return Y}});var K=j(40061),b=j(80105),g=j(9892),O=function(){function Z(){}return Z.extractMinAndMaxIndexed=function(Z,M,j,K,b,g){for(var O=j;O<j+K;O++){var Q=3*M[O],Y=Z[Q],I=Z[Q+1],E=Z[Q+2];b.minimizeInPlaceFromFloats(Y,I,E),g.maximizeInPlaceFromFloats(Y,I,E)}},Z.extractMinAndMax=function(Z,M,j,K,b,g){for(var O=M,Q=M*K;O<M+j;O++,Q+=K){var Y=Z[Q],I=Z[Q+1],E=Z[Q+2];b.minimizeInPlaceFromFloats(Y,I,E),g.maximizeInPlaceFromFloats(Y,I,E)}},(0,K.l)([g.d.filter((function(){for(var Z=[],M=0;M<arguments.length;M++)Z[M]=arguments[M];var j=Z[0],K=Z[1];return!Array.isArray(j)&&!Array.isArray(K)}))],Z,"extractMinAndMaxIndexed",null),(0,K.l)([g.d.filter((function(){for(var Z=[],M=0;M<arguments.length;M++)Z[M]=arguments[M];var j=Z[0];return!Array.isArray(j)}))],Z,"extractMinAndMax",null),Z}();function Q(Z,M,j,K,g){void 0===g&&(g=null);var Q=new b.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Y=new b.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return O.extractMinAndMaxIndexed(Z,M,j,K,Q,Y),g&&(Q.x-=Q.x*g.x+g.y,Q.y-=Q.y*g.x+g.y,Q.z-=Q.z*g.x+g.y,Y.x+=Y.x*g.x+g.y,Y.y+=Y.y*g.x+g.y,Y.z+=Y.z*g.x+g.y),{minimum:Q,maximum:Y}}function Y(Z,M,j,K,g){void 0===K&&(K=null);var Q=new b.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Y=new b.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return g||(g=3),O.extractMinAndMax(Z,M,j,g,Q,Y),K&&(Q.x-=Q.x*K.x+K.y,Q.y-=Q.y*K.x+K.y,Q.z-=Q.z*K.x+K.y,Y.x+=Y.x*K.x+K.y,Y.y+=Y.y*K.x+K.y,Y.z+=Y.z*K.x+K.y),{minimum:Q,maximum:Y}}},39578:function(Z,M,j){"use strict";j.d(M,{e:function(){return K.e},i:function(){return K.g},l:function(){return b.d},o:function(){return b.e},s:function(){return b.h},w:function(){return b.k}});j(54044);var K=j(9488),b=(j(61686),j(46647),j(12476),j(85567),j(2111),j(80105));j(91135),j(57278)},12476:function(Z,M,j){"use strict";j.d(M,{e:function(){return Q},i:function(){return E},k:function(){return s}});var K,b=j(96658),g=j(80105),O=j(61686);!function(Z){Z[Z.CW=0]="CW",Z[Z.CCW=1]="CCW"}(K||(K={}));var Q=function(){function Z(){}return Z.Interpolate=function(Z,M,j,K,b){for(var g=1-3*K+3*M,O=3*K-6*M,Q=3*M,Y=Z,I=0;I<5;I++){var E=Y*Y;Y-=(g*(E*Y)+O*E+Q*Y-Z)*(1/(3*g*E+2*O*Y+Q)),Y=Math.min(1,Math.max(0,Y))}return 3*Math.pow(1-Y,2)*Y*j+3*(1-Y)*Math.pow(Y,2)*b+Math.pow(Y,3)},Z}(),Y=function(){function Z(Z){this._radians=Z,this._radians<0&&(this._radians+=2*Math.PI)}return Z.prototype.degrees=function(){return 180*this._radians/Math.PI},Z.prototype.radians=function(){return this._radians},Z.BetweenTwoPoints=function(M,j){var K=j.subtract(M);return new Z(Math.atan2(K.y,K.x))},Z.FromRadians=function(M){return new Z(M)},Z.FromDegrees=function(M){return new Z(M*Math.PI/180)},Z}(),I=function(Z,M,j){this.startPoint=Z,this.midPoint=M,this.endPoint=j;var b=Math.pow(M.x,2)+Math.pow(M.y,2),O=(Math.pow(Z.x,2)+Math.pow(Z.y,2)-b)/2,Q=(b-Math.pow(j.x,2)-Math.pow(j.y,2))/2,I=(Z.x-M.x)*(M.y-j.y)-(M.x-j.x)*(Z.y-M.y);this.centerPoint=new g.h((O*(M.y-j.y)-Q*(Z.y-M.y))/I,((Z.x-M.x)*Q-(M.x-j.x)*O)/I),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=Y.BetweenTwoPoints(this.centerPoint,this.startPoint);var E=this.startAngle.degrees(),s=Y.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),i=Y.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();s-E>180&&(s-=360),s-E<-180&&(s+=360),i-s>180&&(i-=360),i-s<-180&&(i+=360),this.orientation=s-E<0?K.CW:K.CCW,this.angle=Y.FromDegrees(this.orientation===K.CW?E-i:i-E)},E=function(){function Z(Z,M){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new g.h(Z,M))}return Z.prototype.addLineTo=function(Z,M){if(this.closed)return this;var j=new g.h(Z,M),K=this._points[this._points.length-1];return this._points.push(j),this._length+=j.subtract(K).length(),this},Z.prototype.addArcTo=function(Z,M,j,b,O){if(void 0===O&&(O=36),this.closed)return this;var Q=this._points[this._points.length-1],Y=new g.h(Z,M),E=new g.h(j,b),s=new I(Q,Y,E),i=s.angle.radians()/O;s.orientation===K.CW&&(i*=-1);for(var a=s.startAngle.radians()+i,z=0;z<O;z++){var V=Math.cos(a)*s.radius+s.centerPoint.x,o=Math.sin(a)*s.radius+s.centerPoint.y;this.addLineTo(V,o),a+=i}return this},Z.prototype.close=function(){return this.closed=!0,this},Z.prototype.length=function(){var Z=this._length;if(this.closed){var M=this._points[this._points.length-1];Z+=this._points[0].subtract(M).length()}return Z},Z.prototype.getPoints=function(){return this._points},Z.prototype.getPointAtLengthPosition=function(Z){if(Z<0||Z>1)return g.h.Zero();for(var M=Z*this.length(),j=0,K=0;K<this._points.length;K++){var b=(K+1)%this._points.length,O=this._points[K],Q=this._points[b].subtract(O),Y=Q.length()+j;if(M>=j&&M<=Y){var I=Q.normalize(),E=M-j;return new g.h(O.x+I.x*E,O.y+I.y*E)}j=Y}return g.h.Zero()},Z.StartingAt=function(M,j){return new Z(M,j)},Z}(),s=function(){function Z(Z,M,j,K){void 0===M&&(M=null),void 0===K&&(K=!1),this.path=Z,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:g.k.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:g.c.Identity()};for(var b=0;b<Z.length;b++)this._curve[b]=Z[b].clone();this._raw=j||!1,this._alignTangentsWithPath=K,this._compute(M,K)}return Z.prototype.getCurve=function(){return this._curve},Z.prototype.getPoints=function(){return this._curve},Z.prototype.length=function(){return this._distances[this._distances.length-1]},Z.prototype.getTangents=function(){return this._tangents},Z.prototype.getNormals=function(){return this._normals},Z.prototype.getBinormals=function(){return this._binormals},Z.prototype.getDistances=function(){return this._distances},Z.prototype.getPointAt=function(Z){return this._updatePointAtData(Z).point},Z.prototype.getTangentAt=function(Z,M){return void 0===M&&(M=!1),this._updatePointAtData(Z,M),M?g.k.TransformCoordinates(g.k.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},Z.prototype.getNormalAt=function(Z,M){return void 0===M&&(M=!1),this._updatePointAtData(Z,M),M?g.k.TransformCoordinates(g.k.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},Z.prototype.getBinormalAt=function(Z,M){return void 0===M&&(M=!1),this._updatePointAtData(Z,M),M?g.k.TransformCoordinates(g.k.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},Z.prototype.getDistanceAt=function(Z){return this.length()*Z},Z.prototype.getPreviousPointIndexAt=function(Z){return this._updatePointAtData(Z),this._pointAtData.previousPointArrayIndex},Z.prototype.getSubPositionAt=function(Z){return this._updatePointAtData(Z),this._pointAtData.subPosition},Z.prototype.getClosestPositionTo=function(Z){for(var M=Number.MAX_VALUE,j=0,K=0;K<this._curve.length-1;K++){var b=this._curve[K+0],O=this._curve[K+1].subtract(b).normalize(),Q=this._distances[K+1]-this._distances[K+0],Y=Math.min(Math.max(g.k.Dot(O,Z.subtract(b).normalize()),0)*g.k.Distance(b,Z)/Q,1),I=g.k.Distance(b.add(O.scale(Y*Q)),Z);I<M&&(M=I,j=(this._distances[K+0]+Q*Y)/this.length())}return j},Z.prototype.slice=function(M,j){if(void 0===M&&(M=0),void 0===j&&(j=1),M<0&&(M=1- -1*M%1),j<0&&(j=1- -1*j%1),M>j){var K=M;M=j,j=K}var b=this.getCurve(),g=this.getPointAt(M),O=this.getPreviousPointIndexAt(M),Q=this.getPointAt(j),Y=this.getPreviousPointIndexAt(j)+1,I=[];return 0!==M&&(O++,I.push(g)),I.push.apply(I,b.slice(O,Y)),1===j&&1!==M||I.push(Q),new Z(I,this.getNormalAt(M),this._raw,this._alignTangentsWithPath)},Z.prototype.update=function(Z,M,j){void 0===M&&(M=null),void 0===j&&(j=!1);for(var K=0;K<Z.length;K++)this._curve[K].x=Z[K].x,this._curve[K].y=Z[K].y,this._curve[K].z=Z[K].z;return this._compute(M,j),this},Z.prototype._compute=function(Z,M){void 0===M&&(M=!1);var j=this._curve.length;if(!(j<2)){this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[j-1]=this._curve[j-1].subtract(this._curve[j-2]),this._raw||this._tangents[j-1].normalize();var K,b,O,Q,Y,I=this._tangents[0],E=this._normalVector(I,Z);this._normals[0]=E,this._raw||this._normals[0].normalize(),this._binormals[0]=g.k.Cross(I,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var s=1;s<j;s++)K=this._getLastNonNullVector(s),s<j-1&&(b=this._getFirstNonNullVector(s),this._tangents[s]=M?b:K.add(b),this._tangents[s].normalize()),this._distances[s]=this._distances[s-1]+this._curve[s].subtract(this._curve[s-1]).length(),O=this._tangents[s],Y=this._binormals[s-1],this._normals[s]=g.k.Cross(Y,O),this._raw||(0===this._normals[s].length()?(Q=this._normals[s-1],this._normals[s]=Q.clone()):this._normals[s].normalize()),this._binormals[s]=g.k.Cross(O,this._normals[s]),this._raw||this._binormals[s].normalize();this._pointAtData.id=NaN}},Z.prototype._getFirstNonNullVector=function(Z){for(var M=1,j=this._curve[Z+M].subtract(this._curve[Z]);0===j.length()&&Z+M+1<this._curve.length;)M++,j=this._curve[Z+M].subtract(this._curve[Z]);return j},Z.prototype._getLastNonNullVector=function(Z){for(var M=1,j=this._curve[Z].subtract(this._curve[Z-M]);0===j.length()&&Z>M+1;)M++,j=this._curve[Z].subtract(this._curve[Z-M]);return j},Z.prototype._normalVector=function(Z,M){var j,K=Z.length();if(0===K&&(K=1),void 0===M||null===M){var Q=void 0;Q=b.b.WithinEpsilon(Math.abs(Z.y)/K,1,O.e)?b.b.WithinEpsilon(Math.abs(Z.x)/K,1,O.e)?b.b.WithinEpsilon(Math.abs(Z.z)/K,1,O.e)?g.k.Zero():new g.k(0,0,1):new g.k(1,0,0):new g.k(0,-1,0),j=g.k.Cross(Z,Q)}else j=g.k.Cross(Z,M),g.k.CrossToRef(j,Z,j);return j.normalize(),j},Z.prototype._updatePointAtData=function(Z,M){if(void 0===M&&(M=!1),this._pointAtData.id===Z)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=Z;var j=this.getPoints();if(Z<=0)return this._setPointAtData(0,0,j[0],0,M);if(Z>=1)return this._setPointAtData(1,1,j[j.length-1],j.length-1,M);for(var K,b=j[0],O=0,Q=Z*this.length(),Y=1;Y<j.length;Y++){K=j[Y];var I=g.k.Distance(b,K);if((O+=I)===Q)return this._setPointAtData(Z,1,K,Y,M);if(O>Q){var E=(O-Q)/I,s=b.subtract(K),i=K.add(s.scaleInPlace(E));return this._setPointAtData(Z,1-E,i,Y-1,M)}b=K}return this._pointAtData},Z.prototype._setPointAtData=function(Z,M,j,K,b){return this._pointAtData.point=j,this._pointAtData.position=Z,this._pointAtData.subPosition=M,this._pointAtData.previousPointArrayIndex=K,this._pointAtData.interpolateReady=b,b&&this._updateInterpolationMatrix(),this._pointAtData},Z.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=g.c.Identity();var Z=this._pointAtData.previousPointArrayIndex;if(Z!==this._tangents.length-1){var M=Z+1,j=this._tangents[Z].clone(),K=this._normals[Z].clone(),b=this._binormals[Z].clone(),O=this._tangents[M].clone(),Q=this._normals[M].clone(),Y=this._binormals[M].clone(),I=g.d.RotationQuaternionFromAxis(K,b,j),E=g.d.RotationQuaternionFromAxis(Q,Y,O);g.d.Slerp(I,E,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},Z}();!function(){function Z(Z){this._length=0,this._points=Z,this._length=this._computeLength(Z)}Z.CreateQuadraticBezier=function(M,j,K,b){b=b>2?b:3;for(var O=new Array,Q=function(Z,M,j,K){return(1-Z)*(1-Z)*M+2*Z*(1-Z)*j+Z*Z*K},Y=0;Y<=b;Y++)O.push(new g.k(Q(Y/b,M.x,j.x,K.x),Q(Y/b,M.y,j.y,K.y),Q(Y/b,M.z,j.z,K.z)));return new Z(O)},Z.CreateCubicBezier=function(M,j,K,b,O){O=O>3?O:4;for(var Q=new Array,Y=function(Z,M,j,K,b){return(1-Z)*(1-Z)*(1-Z)*M+3*Z*(1-Z)*(1-Z)*j+3*Z*Z*(1-Z)*K+Z*Z*Z*b},I=0;I<=O;I++)Q.push(new g.k(Y(I/O,M.x,j.x,K.x,b.x),Y(I/O,M.y,j.y,K.y,b.y),Y(I/O,M.z,j.z,K.z,b.z)));return new Z(Q)},Z.CreateHermiteSpline=function(M,j,K,b,O){for(var Q=new Array,Y=1/O,I=0;I<=O;I++)Q.push(g.k.Hermite(M,j,K,b,I*Y));return new Z(Q)},Z.CreateCatmullRomSpline=function(M,j,K){var b=new Array,O=1/j,Q=0;if(K){for(var Y=M.length,I=0;I<Y;I++){Q=0;for(var E=0;E<j;E++)b.push(g.k.CatmullRom(M[I%Y],M[(I+1)%Y],M[(I+2)%Y],M[(I+3)%Y],Q)),Q+=O}b.push(b[0])}else{var s=new Array;s.push(M[0].clone()),Array.prototype.push.apply(s,M),s.push(M[M.length-1].clone());for(I=0;I<s.length-3;I++){Q=0;for(E=0;E<j;E++)b.push(g.k.CatmullRom(s[I],s[I+1],s[I+2],s[I+3],Q)),Q+=O}I--,b.push(g.k.CatmullRom(s[I],s[I+1],s[I+2],s[I+3],Q))}return new Z(b)},Z.ArcThru3Points=function(M,j,K,b,O,Q){void 0===b&&(b=32),void 0===O&&(O=!1),void 0===Q&&(Q=!1);var Y=new Array,I=j.subtract(M),E=K.subtract(j),s=M.subtract(K),i=g.k.Cross(I,E),a=i.length();if(a<Math.pow(10,-8))return new Z(Y);var z=I.lengthSquared(),V=E.lengthSquared(),o=s.lengthSquared(),c=i.lengthSquared(),G=.5*I.length()*E.length()*s.length()/a,f=-.5*V*g.k.Dot(I,s)/c,X=-.5*o*g.k.Dot(I,E)/c,d=-.5*z*g.k.Dot(E,s)/c,W=M.scale(f).add(j.scale(X)).add(K.scale(d)),A=M.subtract(W).normalize(),q=g.k.Cross(i,A).normalize();if(Q){for(var T=2*Math.PI/b,B=0;B<=2*Math.PI;B+=T)Y.push(W.add(A.scale(G*Math.cos(B)).add(q.scale(G*Math.sin(B)))));Y.push(M)}else{T=1/b,B=0;var N=g.k.Zero();do{N=W.add(A.scale(G*Math.cos(B)).add(q.scale(G*Math.sin(B)))),Y.push(N),B+=T}while(!N.equalsWithEpsilon(K,G*T*1.1));Y.push(K),O&&Y.push(M)}return new Z(Y)},Z.prototype.getPoints=function(){return this._points},Z.prototype.length=function(){return this._length},Z.prototype.continue=function(M){for(var j=this._points[this._points.length-1],K=this._points.slice(),b=M.getPoints(),g=1;g<b.length;g++)K.push(b[g].subtract(b[0]).add(j));return new Z(K)},Z.prototype._computeLength=function(Z){for(var M=0,j=1;j<Z.length;j++)M+=Z[j].subtract(Z[j-1]).length();return M}}()},85567:function(Z,M,j){"use strict";j.d(M,{e:function(){return b}});var K=j(80105),b=function(){function Z(Z,M,j,b){this.normal=new K.k(Z,M,j),this.d=b}return Z.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},Z.prototype.clone=function(){return new Z(this.normal.x,this.normal.y,this.normal.z,this.d)},Z.prototype.getClassName=function(){return"Plane"},Z.prototype.getHashCode=function(){var Z=this.normal.getHashCode();return Z=397*Z^(0|this.d)},Z.prototype.normalize=function(){var Z=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),M=0;return 0!==Z&&(M=1/Z),this.normal.x*=M,this.normal.y*=M,this.normal.z*=M,this.d*=M,this},Z.prototype.transform=function(M){var j=Z._TmpMatrix;M.invertToRef(j);var K=j.m,b=this.normal.x,g=this.normal.y,O=this.normal.z,Q=this.d;return new Z(b*K[0]+g*K[1]+O*K[2]+Q*K[3],b*K[4]+g*K[5]+O*K[6]+Q*K[7],b*K[8]+g*K[9]+O*K[10]+Q*K[11],b*K[12]+g*K[13]+O*K[14]+Q*K[15])},Z.prototype.dotCoordinate=function(Z){return this.normal.x*Z.x+this.normal.y*Z.y+this.normal.z*Z.z+this.d},Z.prototype.copyFromPoints=function(Z,M,j){var K,b=M.x-Z.x,g=M.y-Z.y,O=M.z-Z.z,Q=j.x-Z.x,Y=j.y-Z.y,I=j.z-Z.z,E=g*I-O*Y,s=O*Q-b*I,i=b*Y-g*Q,a=Math.sqrt(E*E+s*s+i*i);return K=0!==a?1/a:0,this.normal.x=E*K,this.normal.y=s*K,this.normal.z=i*K,this.d=-(this.normal.x*Z.x+this.normal.y*Z.y+this.normal.z*Z.z),this},Z.prototype.isFrontFacingTo=function(Z,M){return K.k.Dot(this.normal,Z)<=M},Z.prototype.signedDistanceTo=function(Z){return K.k.Dot(Z,this.normal)+this.d},Z.FromArray=function(M){return new Z(M[0],M[1],M[2],M[3])},Z.FromPoints=function(M,j,K){var b=new Z(0,0,0,0);return b.copyFromPoints(M,j,K),b},Z.FromPositionAndNormal=function(M,j){var K=new Z(0,0,0,0);return j.normalize(),K.normal=j,K.d=-(j.x*M.x+j.y*M.y+j.z*M.z),K},Z.SignedDistanceToPlaneFromPositionAndNormal=function(Z,M,j){var b=-(M.x*Z.x+M.y*Z.y+M.z*Z.z);return K.k.Dot(j,M)+b},Z._TmpMatrix=K.c.Identity(),Z}()},96658:function(Z,M,j){"use strict";j.d(M,{b:function(){return K}});var K=function(){function Z(){}return Z.WithinEpsilon=function(Z,M,j){return void 0===j&&(j=1401298e-51),Math.abs(Z-M)<=j},Z.ToHex=function(Z){var M=Z.toString(16);return Z<=15?("0"+M).toUpperCase():M.toUpperCase()},Z.Sign=function(Z){return 0===(Z=+Z)||isNaN(Z)?Z:Z>0?1:-1},Z.Clamp=function(Z,M,j){return void 0===M&&(M=0),void 0===j&&(j=1),Math.min(j,Math.max(M,Z))},Z.Log2=function(Z){return Math.log(Z)*Math.LOG2E},Z.ILog2=function(Z){if(Math.log2)return Math.floor(Math.log2(Z));if(Z<0)return NaN;if(0===Z)return-1/0;var M=0;if(Z<1){for(;Z<1;)M++,Z*=2;M=-M}else if(Z>1)for(;Z>1;)M++,Z=Math.floor(Z/2);return M},Z.Repeat=function(Z,M){return Z-Math.floor(Z/M)*M},Z.Normalize=function(Z,M,j){return(Z-M)/(j-M)},Z.Denormalize=function(Z,M,j){return Z*(j-M)+M},Z.DeltaAngle=function(M,j){var K=Z.Repeat(j-M,360);return K>180&&(K-=360),K},Z.PingPong=function(M,j){var K=Z.Repeat(M,2*j);return j-Math.abs(K-j)},Z.SmoothStep=function(M,j,K){var b=Z.Clamp(K);return j*(b=-2*b*b*b+3*b*b)+M*(1-b)},Z.MoveTowards=function(M,j,K){return Math.abs(j-M)<=K?j:M+Z.Sign(j-M)*K},Z.MoveTowardsAngle=function(M,j,K){var b=Z.DeltaAngle(M,j),g=0;return-K<b&&b<K?g=j:(j=M+b,g=Z.MoveTowards(M,j,K)),g},Z.Lerp=function(Z,M,j){return Z+(M-Z)*j},Z.LerpAngle=function(M,j,K){var b=Z.Repeat(j-M,360);return b>180&&(b-=360),M+b*Z.Clamp(K)},Z.InverseLerp=function(M,j,K){return M!=j?Z.Clamp((K-M)/(j-M)):0},Z.Hermite=function(Z,M,j,K,b){var g=b*b,O=b*g;return Z*(2*O-3*g+1)+j*(-2*O+3*g)+M*(O-2*g+b)+K*(O-g)},Z.Hermite1stDerivative=function(Z,M,j,K,b){var g=b*b;return 6*(g-b)*Z+(3*g-4*b+1)*M+6*(-g+b)*j+(3*g-2*b)*K},Z.RandomRange=function(Z,M){return Z===M?Z:Math.random()*(M-Z)+Z},Z.RangeToPercent=function(Z,M,j){return(Z-M)/(j-M)},Z.PercentToRange=function(Z,M,j){return(j-M)*Z+M},Z.NormalizeRadians=function(M){return M-=Z.TwoPi*Math.floor((M+Math.PI)/Z.TwoPi)},Z.HCF=function(M,j){var K=M%j;return 0===K?j:Z.HCF(j,K)},Z.TwoPi=2*Math.PI,Z}()},2111:function(Z,M,j){"use strict";j.d(M,{b:function(){return K}});var K=function(){function Z(Z,M){this.width=Z,this.height=M}return Z.prototype.toString=function(){return"{W: ".concat(this.width,", H: ").concat(this.height,"}")},Z.prototype.getClassName=function(){return"Size"},Z.prototype.getHashCode=function(){var Z=0|this.width;return Z=397*Z^(0|this.height)},Z.prototype.copyFrom=function(Z){this.width=Z.width,this.height=Z.height},Z.prototype.copyFromFloats=function(Z,M){return this.width=Z,this.height=M,this},Z.prototype.set=function(Z,M){return this.copyFromFloats(Z,M)},Z.prototype.multiplyByFloats=function(M,j){return new Z(this.width*M,this.height*j)},Z.prototype.clone=function(){return new Z(this.width,this.height)},Z.prototype.equals=function(Z){return!!Z&&(this.width===Z.width&&this.height===Z.height)},Object.defineProperty(Z.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),Z.Zero=function(){return new Z(0,0)},Z.prototype.add=function(M){return new Z(this.width+M.width,this.height+M.height)},Z.prototype.subtract=function(M){return new Z(this.width-M.width,this.height-M.height)},Z.Lerp=function(M,j,K){return new Z(M.width+(j.width-M.width)*K,M.height+(j.height-M.height)*K)},Z}()},80105:function(Z,M,j){"use strict";j.d(M,{c:function(){return z},d:function(){return a},e:function(){return o},h:function(){return E},k:function(){return s},l:function(){return i}});var K=j(96658),b=j(61686),g=j(89214),O=j(31709),Q=j(30899),Y=j(78588),I=function(Z){return parseInt(Z.toString().replace(/\W/g,""))},E=function(){function Z(Z,M){void 0===Z&&(Z=0),void 0===M&&(M=0),this.x=Z,this.y=M}return Z.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y,"}")},Z.prototype.getClassName=function(){return"Vector2"},Z.prototype.getHashCode=function(){var Z=I(this.x);return Z=397*Z^I(this.y)},Z.prototype.toArray=function(Z,M){return void 0===M&&(M=0),Z[M]=this.x,Z[M+1]=this.y,this},Z.prototype.fromArray=function(M,j){return void 0===j&&(j=0),Z.FromArrayToRef(M,j,this),this},Z.prototype.asArray=function(){var Z=new Array;return this.toArray(Z,0),Z},Z.prototype.copyFrom=function(Z){return this.x=Z.x,this.y=Z.y,this},Z.prototype.copyFromFloats=function(Z,M){return this.x=Z,this.y=M,this},Z.prototype.set=function(Z,M){return this.copyFromFloats(Z,M)},Z.prototype.add=function(M){return new Z(this.x+M.x,this.y+M.y)},Z.prototype.addToRef=function(Z,M){return M.x=this.x+Z.x,M.y=this.y+Z.y,this},Z.prototype.addInPlace=function(Z){return this.x+=Z.x,this.y+=Z.y,this},Z.prototype.addVector3=function(M){return new Z(this.x+M.x,this.y+M.y)},Z.prototype.subtract=function(M){return new Z(this.x-M.x,this.y-M.y)},Z.prototype.subtractToRef=function(Z,M){return M.x=this.x-Z.x,M.y=this.y-Z.y,this},Z.prototype.subtractInPlace=function(Z){return this.x-=Z.x,this.y-=Z.y,this},Z.prototype.multiplyInPlace=function(Z){return this.x*=Z.x,this.y*=Z.y,this},Z.prototype.multiply=function(M){return new Z(this.x*M.x,this.y*M.y)},Z.prototype.multiplyToRef=function(Z,M){return M.x=this.x*Z.x,M.y=this.y*Z.y,this},Z.prototype.multiplyByFloats=function(M,j){return new Z(this.x*M,this.y*j)},Z.prototype.divide=function(M){return new Z(this.x/M.x,this.y/M.y)},Z.prototype.divideToRef=function(Z,M){return M.x=this.x/Z.x,M.y=this.y/Z.y,this},Z.prototype.divideInPlace=function(Z){return this.divideToRef(Z,this)},Z.prototype.negate=function(){return new Z(-this.x,-this.y)},Z.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},Z.prototype.negateToRef=function(Z){return Z.copyFromFloats(-1*this.x,-1*this.y)},Z.prototype.scaleInPlace=function(Z){return this.x*=Z,this.y*=Z,this},Z.prototype.scale=function(M){var j=new Z(0,0);return this.scaleToRef(M,j),j},Z.prototype.scaleToRef=function(Z,M){return M.x=this.x*Z,M.y=this.y*Z,this},Z.prototype.scaleAndAddToRef=function(Z,M){return M.x+=this.x*Z,M.y+=this.y*Z,this},Z.prototype.equals=function(Z){return Z&&this.x===Z.x&&this.y===Z.y},Z.prototype.equalsWithEpsilon=function(Z,M){return void 0===M&&(M=b.e),Z&&K.b.WithinEpsilon(this.x,Z.x,M)&&K.b.WithinEpsilon(this.y,Z.y,M)},Z.prototype.floor=function(){return new Z(Math.floor(this.x),Math.floor(this.y))},Z.prototype.fract=function(){return new Z(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},Z.prototype.rotateToRef=function(Z,M){var j=Math.cos(Z),K=Math.sin(Z);return M.x=j*this.x-K*this.y,M.y=K*this.x+j*this.y,this},Z.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Z.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},Z.prototype.normalize=function(){return Z.NormalizeToRef(this,this),this},Z.prototype.clone=function(){return new Z(this.x,this.y)},Z.Zero=function(){return new Z(0,0)},Z.One=function(){return new Z(1,1)},Z.FromArray=function(M,j){return void 0===j&&(j=0),new Z(M[j],M[j+1])},Z.FromArrayToRef=function(Z,M,j){j.x=Z[M],j.y=Z[M+1]},Z.CatmullRom=function(M,j,K,b,g){var O=g*g,Q=g*O;return new Z(.5*(2*j.x+(-M.x+K.x)*g+(2*M.x-5*j.x+4*K.x-b.x)*O+(-M.x+3*j.x-3*K.x+b.x)*Q),.5*(2*j.y+(-M.y+K.y)*g+(2*M.y-5*j.y+4*K.y-b.y)*O+(-M.y+3*j.y-3*K.y+b.y)*Q))},Z.Clamp=function(M,j,K){var b=M.x;b=(b=b>K.x?K.x:b)<j.x?j.x:b;var g=M.y;return new Z(b,g=(g=g>K.y?K.y:g)<j.y?j.y:g)},Z.Hermite=function(M,j,K,b,g){var O=g*g,Q=g*O,Y=2*Q-3*O+1,I=-2*Q+3*O,E=Q-2*O+g,s=Q-O;return new Z(M.x*Y+K.x*I+j.x*E+b.x*s,M.y*Y+K.y*I+j.y*E+b.y*s)},Z.Hermite1stDerivative=function(M,j,K,b,g){var O=Z.Zero();return this.Hermite1stDerivativeToRef(M,j,K,b,g,O),O},Z.Hermite1stDerivativeToRef=function(Z,M,j,K,b,g){var O=b*b;g.x=6*(O-b)*Z.x+(3*O-4*b+1)*M.x+6*(-O+b)*j.x+(3*O-2*b)*K.x,g.y=6*(O-b)*Z.y+(3*O-4*b+1)*M.y+6*(-O+b)*j.y+(3*O-2*b)*K.y},Z.Lerp=function(M,j,K){return new Z(M.x+(j.x-M.x)*K,M.y+(j.y-M.y)*K)},Z.Dot=function(Z,M){return Z.x*M.x+Z.y*M.y},Z.Normalize=function(M){var j=Z.Zero();return this.NormalizeToRef(M,j),j},Z.NormalizeToRef=function(Z,M){var j=Z.length();0!==j&&(M.x=Z.x/j,M.y=Z.y/j)},Z.Minimize=function(M,j){return new Z(M.x<j.x?M.x:j.x,M.y<j.y?M.y:j.y)},Z.Maximize=function(M,j){return new Z(M.x>j.x?M.x:j.x,M.y>j.y?M.y:j.y)},Z.Transform=function(M,j){var K=Z.Zero();return Z.TransformToRef(M,j,K),K},Z.TransformToRef=function(Z,M,j){var K=M.m,b=Z.x*K[0]+Z.y*K[4]+K[12],g=Z.x*K[1]+Z.y*K[5]+K[13];j.x=b,j.y=g},Z.PointInTriangle=function(Z,M,j,K){var b=.5*(-j.y*K.x+M.y*(-j.x+K.x)+M.x*(j.y-K.y)+j.x*K.y),g=b<0?-1:1,O=(M.y*K.x-M.x*K.y+(K.y-M.y)*Z.x+(M.x-K.x)*Z.y)*g,Q=(M.x*j.y-M.y*j.x+(M.y-j.y)*Z.x+(j.x-M.x)*Z.y)*g;return O>0&&Q>0&&O+Q<2*b*g},Z.Distance=function(M,j){return Math.sqrt(Z.DistanceSquared(M,j))},Z.DistanceSquared=function(Z,M){var j=Z.x-M.x,K=Z.y-M.y;return j*j+K*K},Z.Center=function(M,j){return Z.CenterToRef(M,j,Z.Zero())},Z.CenterToRef=function(Z,M,j){return j.copyFromFloats((Z.x+M.x)/2,(Z.y+M.y)/2)},Z.DistanceOfPointFromSegment=function(M,j,K){var b=Z.DistanceSquared(j,K);if(0===b)return Z.Distance(M,j);var g=K.subtract(j),O=Math.max(0,Math.min(1,Z.Dot(M.subtract(j),g)/b)),Q=j.add(g.multiplyByFloats(O,O));return Z.Distance(M,Q)},Z}(),s=function(){function Z(Z,M,j){void 0===Z&&(Z=0),void 0===M&&(M=0),void 0===j&&(j=0),this._isDirty=!0,this._x=Z,this._y=M,this._z=j}return Object.defineProperty(Z.prototype,"x",{get:function(){return this._x},set:function(Z){this._x=Z,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"y",{get:function(){return this._y},set:function(Z){this._y=Z,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"z",{get:function(){return this._z},set:function(Z){this._z=Z,this._isDirty=!0},enumerable:!1,configurable:!0}),Z.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z,"}")},Z.prototype.getClassName=function(){return"Vector3"},Z.prototype.getHashCode=function(){var Z=I(this._x);return Z=397*(Z=397*Z^I(this._y))^I(this._z)},Z.prototype.asArray=function(){var Z=[];return this.toArray(Z,0),Z},Z.prototype.toArray=function(Z,M){return void 0===M&&(M=0),Z[M]=this._x,Z[M+1]=this._y,Z[M+2]=this._z,this},Z.prototype.fromArray=function(M,j){return void 0===j&&(j=0),Z.FromArrayToRef(M,j,this),this},Z.prototype.toQuaternion=function(){return a.RotationYawPitchRoll(this._y,this._x,this._z)},Z.prototype.addInPlace=function(Z){return this.addInPlaceFromFloats(Z._x,Z._y,Z._z)},Z.prototype.addInPlaceFromFloats=function(Z,M,j){return this.x+=Z,this.y+=M,this.z+=j,this},Z.prototype.add=function(M){return new Z(this._x+M._x,this._y+M._y,this._z+M._z)},Z.prototype.addToRef=function(Z,M){return M.copyFromFloats(this._x+Z._x,this._y+Z._y,this._z+Z._z)},Z.prototype.subtractInPlace=function(Z){return this.x-=Z._x,this.y-=Z._y,this.z-=Z._z,this},Z.prototype.subtract=function(M){return new Z(this._x-M._x,this._y-M._y,this._z-M._z)},Z.prototype.subtractToRef=function(Z,M){return this.subtractFromFloatsToRef(Z._x,Z._y,Z._z,M)},Z.prototype.subtractFromFloats=function(M,j,K){return new Z(this._x-M,this._y-j,this._z-K)},Z.prototype.subtractFromFloatsToRef=function(Z,M,j,K){return K.copyFromFloats(this._x-Z,this._y-M,this._z-j)},Z.prototype.negate=function(){return new Z(-this._x,-this._y,-this._z)},Z.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},Z.prototype.negateToRef=function(Z){return Z.copyFromFloats(-1*this._x,-1*this._y,-1*this._z)},Z.prototype.scaleInPlace=function(Z){return this.x*=Z,this.y*=Z,this.z*=Z,this},Z.prototype.scale=function(M){return new Z(this._x*M,this._y*M,this._z*M)},Z.prototype.scaleToRef=function(Z,M){return M.copyFromFloats(this._x*Z,this._y*Z,this._z*Z)},Z.prototype.applyRotationQuaternionToRef=function(Z,M){var j=Z.w*this.x+Z.y*this.z-Z.z*this.y,K=Z.w*this.y+Z.z*this.x-Z.x*this.z,b=Z.w*this.z+Z.x*this.y-Z.y*this.x,g=-Z.x*this.x-Z.y*this.y-Z.z*this.z;return M.x=j*Z.w+g*-Z.x+K*-Z.z-b*-Z.y,M.y=K*Z.w+g*-Z.y+b*-Z.x-j*-Z.z,M.z=b*Z.w+g*-Z.z+j*-Z.y-K*-Z.x,M},Z.prototype.applyRotationQuaternionInPlace=function(Z){return this.applyRotationQuaternionToRef(Z,this)},Z.prototype.applyRotationQuaternion=function(M){return this.applyRotationQuaternionToRef(M,Z.Zero())},Z.prototype.scaleAndAddToRef=function(Z,M){return M.addInPlaceFromFloats(this._x*Z,this._y*Z,this._z*Z)},Z.prototype.projectOnPlane=function(M,j){var K=Z.Zero();return this.projectOnPlaneToRef(M,j,K),K},Z.prototype.projectOnPlaneToRef=function(M,j,K){var g=V.Vector3[0];M.normal.scaleToRef(-M.d,g);var O=V.Vector3[1];M.normal.negateToRef(O);var Q=this,Y=Q.x,I=Q.y,E=Q.z,s=Z.Dot(O,this);if(s<=b.e*b.e)K.copyFrom(j);else{var i=V.Vector3[2];g.subtractToRef(j,i);var a=Z.Dot(i,O)/s;K.set(j.x+Y*a,j.y+I*a,j.z+E*a)}},Z.prototype.equals=function(Z){return Z&&this._x===Z._x&&this._y===Z._y&&this._z===Z._z},Z.prototype.equalsWithEpsilon=function(Z,M){return void 0===M&&(M=b.e),Z&&K.b.WithinEpsilon(this._x,Z._x,M)&&K.b.WithinEpsilon(this._y,Z._y,M)&&K.b.WithinEpsilon(this._z,Z._z,M)},Z.prototype.equalsToFloats=function(Z,M,j){return this._x===Z&&this._y===M&&this._z===j},Z.prototype.multiplyInPlace=function(Z){return this.x*=Z._x,this.y*=Z._y,this.z*=Z._z,this},Z.prototype.multiply=function(Z){return this.multiplyByFloats(Z._x,Z._y,Z._z)},Z.prototype.multiplyToRef=function(Z,M){return M.copyFromFloats(this._x*Z._x,this._y*Z._y,this._z*Z._z)},Z.prototype.multiplyByFloats=function(M,j,K){return new Z(this._x*M,this._y*j,this._z*K)},Z.prototype.divide=function(M){return new Z(this._x/M._x,this._y/M._y,this._z/M._z)},Z.prototype.divideToRef=function(Z,M){return M.copyFromFloats(this._x/Z._x,this._y/Z._y,this._z/Z._z)},Z.prototype.divideInPlace=function(Z){return this.divideToRef(Z,this)},Z.prototype.minimizeInPlace=function(Z){return this.minimizeInPlaceFromFloats(Z._x,Z._y,Z._z)},Z.prototype.maximizeInPlace=function(Z){return this.maximizeInPlaceFromFloats(Z._x,Z._y,Z._z)},Z.prototype.minimizeInPlaceFromFloats=function(Z,M,j){return Z<this._x&&(this.x=Z),M<this._y&&(this.y=M),j<this._z&&(this.z=j),this},Z.prototype.maximizeInPlaceFromFloats=function(Z,M,j){return Z>this._x&&(this.x=Z),M>this._y&&(this.y=M),j>this._z&&(this.z=j),this},Z.prototype.isNonUniformWithinEpsilon=function(Z){var M=Math.abs(this._x),j=Math.abs(this._y);if(!K.b.WithinEpsilon(M,j,Z))return!0;var b=Math.abs(this._z);return!K.b.WithinEpsilon(M,b,Z)||!K.b.WithinEpsilon(j,b,Z)},Object.defineProperty(Z.prototype,"isNonUniform",{get:function(){var Z=Math.abs(this._x);return Z!==Math.abs(this._y)||Z!==Math.abs(this._z)},enumerable:!1,configurable:!0}),Z.prototype.floor=function(){return new Z(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},Z.prototype.fract=function(){return new Z(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},Z.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},Z.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},Object.defineProperty(Z.prototype,"hasAZeroComponent",{get:function(){return this._x*this._y*this._z===0},enumerable:!1,configurable:!0}),Z.prototype.normalize=function(){return this.normalizeFromLength(this.length())},Z.prototype.reorderInPlace=function(Z){var M=this;return"xyz"===(Z=Z.toLowerCase())||(V.Vector3[0].copyFrom(this),["x","y","z"].forEach((function(j,K){M[j]=V.Vector3[0][Z[K]]}))),this},Z.prototype.rotateByQuaternionToRef=function(M,j){return M.toRotationMatrix(V.Matrix[0]),Z.TransformCoordinatesToRef(this,V.Matrix[0],j),j},Z.prototype.rotateByQuaternionAroundPointToRef=function(Z,M,j){return this.subtractToRef(M,V.Vector3[0]),V.Vector3[0].rotateByQuaternionToRef(Z,V.Vector3[0]),M.addToRef(V.Vector3[0],j),j},Z.prototype.cross=function(M){return Z.Cross(this,M)},Z.prototype.normalizeFromLength=function(Z){return 0===Z||1===Z?this:this.scaleInPlace(1/Z)},Z.prototype.normalizeToNew=function(){var M=new Z(0,0,0);return this.normalizeToRef(M),M},Z.prototype.normalizeToRef=function(Z){var M=this.length();return 0===M||1===M?Z.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/M,Z)},Z.prototype.clone=function(){return new Z(this._x,this._y,this._z)},Z.prototype.copyFrom=function(Z){return this.copyFromFloats(Z._x,Z._y,Z._z)},Z.prototype.copyFromFloats=function(Z,M,j){return this.x=Z,this.y=M,this.z=j,this},Z.prototype.set=function(Z,M,j){return this.copyFromFloats(Z,M,j)},Z.prototype.setAll=function(Z){return this.x=this.y=this.z=Z,this},Z.GetClipFactor=function(M,j,K,b){var g=Z.Dot(M,K)-b;return g/(g-(Z.Dot(j,K)-b))},Z.GetAngleBetweenVectors=function(M,j,b){var g=M.normalizeToRef(V.Vector3[1]),O=j.normalizeToRef(V.Vector3[2]),Q=Z.Dot(g,O);Q=K.b.Clamp(Q,-1,1);var Y=Math.acos(Q),I=V.Vector3[3];return Z.CrossToRef(g,O,I),Z.Dot(I,b)>0?isNaN(Y)?0:Y:isNaN(Y)?-Math.PI:-Math.acos(Q)},Z.GetAngleBetweenVectorsOnPlane=function(M,j,b){V.Vector3[0].copyFrom(M);var g=V.Vector3[0];V.Vector3[1].copyFrom(j);var O=V.Vector3[1];V.Vector3[2].copyFrom(b);var Q=V.Vector3[2],Y=V.Vector3[3],I=V.Vector3[4];g.normalize(),O.normalize(),Q.normalize(),Z.CrossToRef(Q,g,Y),Z.CrossToRef(Y,Q,I);var E=Math.atan2(Z.Dot(O,Y),Z.Dot(O,I));return K.b.NormalizeRadians(E)},Z.SlerpToRef=function(M,j,g,O){g=K.b.Clamp(g,0,1);var Q=V.Vector3[0],Y=V.Vector3[1];Q.copyFrom(M);var I=Q.length();Q.normalizeFromLength(I),Y.copyFrom(j);var E=Y.length();Y.normalizeFromLength(E);var s,i,a=Z.Dot(Q,Y);if(a<1-b.e){var z=Math.acos(a),o=1/Math.sin(z);s=Math.sin((1-g)*z)*o,i=Math.sin(g*z)*o}else s=1-g,i=g;Q.scaleInPlace(s),Y.scaleInPlace(i),O.copyFrom(Q).addInPlace(Y),O.scaleInPlace(K.b.Lerp(I,E,g))},Z.SmoothToRef=function(M,j,K,b,g){Z.SlerpToRef(M,j,0===b?1:K/b,g)},Z.FromArray=function(M,j){return void 0===j&&(j=0),new Z(M[j],M[j+1],M[j+2])},Z.FromFloatArray=function(M,j){return Z.FromArray(M,j)},Z.FromArrayToRef=function(Z,M,j){j.x=Z[M],j.y=Z[M+1],j.z=Z[M+2]},Z.FromFloatArrayToRef=function(M,j,K){return Z.FromArrayToRef(M,j,K)},Z.FromFloatsToRef=function(Z,M,j,K){K.copyFromFloats(Z,M,j)},Z.Zero=function(){return new Z(0,0,0)},Z.One=function(){return new Z(1,1,1)},Z.Up=function(){return new Z(0,1,0)},Object.defineProperty(Z,"UpReadOnly",{get:function(){return Z._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"RightReadOnly",{get:function(){return Z._RightReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"LeftReadOnly",{get:function(){return Z._LeftReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"LeftHandedForwardReadOnly",{get:function(){return Z._LeftHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"RightHandedForwardReadOnly",{get:function(){return Z._RightHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"ZeroReadOnly",{get:function(){return Z._ZeroReadOnly},enumerable:!1,configurable:!0}),Z.Down=function(){return new Z(0,-1,0)},Z.Forward=function(M){return void 0===M&&(M=!1),new Z(0,0,M?-1:1)},Z.Backward=function(M){return void 0===M&&(M=!1),new Z(0,0,M?1:-1)},Z.Right=function(){return new Z(1,0,0)},Z.Left=function(){return new Z(-1,0,0)},Z.TransformCoordinates=function(M,j){var K=Z.Zero();return Z.TransformCoordinatesToRef(M,j,K),K},Z.TransformCoordinatesToRef=function(M,j,K){Z.TransformCoordinatesFromFloatsToRef(M._x,M._y,M._z,j,K)},Z.TransformCoordinatesFromFloatsToRef=function(Z,M,j,K,b){var g=K.m,O=Z*g[0]+M*g[4]+j*g[8]+g[12],Q=Z*g[1]+M*g[5]+j*g[9]+g[13],Y=Z*g[2]+M*g[6]+j*g[10]+g[14],I=1/(Z*g[3]+M*g[7]+j*g[11]+g[15]);b.x=O*I,b.y=Q*I,b.z=Y*I},Z.TransformNormal=function(M,j){var K=Z.Zero();return Z.TransformNormalToRef(M,j,K),K},Z.TransformNormalToRef=function(Z,M,j){this.TransformNormalFromFloatsToRef(Z._x,Z._y,Z._z,M,j)},Z.TransformNormalFromFloatsToRef=function(Z,M,j,K,b){var g=K.m;b.x=Z*g[0]+M*g[4]+j*g[8],b.y=Z*g[1]+M*g[5]+j*g[9],b.z=Z*g[2]+M*g[6]+j*g[10]},Z.CatmullRom=function(M,j,K,b,g){var O=g*g,Q=g*O;return new Z(.5*(2*j._x+(-M._x+K._x)*g+(2*M._x-5*j._x+4*K._x-b._x)*O+(-M._x+3*j._x-3*K._x+b._x)*Q),.5*(2*j._y+(-M._y+K._y)*g+(2*M._y-5*j._y+4*K._y-b._y)*O+(-M._y+3*j._y-3*K._y+b._y)*Q),.5*(2*j._z+(-M._z+K._z)*g+(2*M._z-5*j._z+4*K._z-b._z)*O+(-M._z+3*j._z-3*K._z+b._z)*Q))},Z.Clamp=function(M,j,K){var b=new Z;return Z.ClampToRef(M,j,K,b),b},Z.ClampToRef=function(Z,M,j,K){var b=Z._x;b=(b=b>j._x?j._x:b)<M._x?M._x:b;var g=Z._y;g=(g=g>j._y?j._y:g)<M._y?M._y:g;var O=Z._z;O=(O=O>j._z?j._z:O)<M._z?M._z:O,K.copyFromFloats(b,g,O)},Z.CheckExtends=function(Z,M,j){M.minimizeInPlace(Z),j.maximizeInPlace(Z)},Z.Hermite=function(M,j,K,b,g){var O=g*g,Q=g*O,Y=2*Q-3*O+1,I=-2*Q+3*O,E=Q-2*O+g,s=Q-O;return new Z(M._x*Y+K._x*I+j._x*E+b._x*s,M._y*Y+K._y*I+j._y*E+b._y*s,M._z*Y+K._z*I+j._z*E+b._z*s)},Z.Hermite1stDerivative=function(M,j,K,b,g){var O=Z.Zero();return this.Hermite1stDerivativeToRef(M,j,K,b,g,O),O},Z.Hermite1stDerivativeToRef=function(Z,M,j,K,b,g){var O=b*b;g.x=6*(O-b)*Z.x+(3*O-4*b+1)*M.x+6*(-O+b)*j.x+(3*O-2*b)*K.x,g.y=6*(O-b)*Z.y+(3*O-4*b+1)*M.y+6*(-O+b)*j.y+(3*O-2*b)*K.y,g.z=6*(O-b)*Z.z+(3*O-4*b+1)*M.z+6*(-O+b)*j.z+(3*O-2*b)*K.z},Z.Lerp=function(M,j,K){var b=new Z(0,0,0);return Z.LerpToRef(M,j,K,b),b},Z.LerpToRef=function(Z,M,j,K){K.x=Z._x+(M._x-Z._x)*j,K.y=Z._y+(M._y-Z._y)*j,K.z=Z._z+(M._z-Z._z)*j},Z.Dot=function(Z,M){return Z._x*M._x+Z._y*M._y+Z._z*M._z},Z.Cross=function(M,j){var K=Z.Zero();return Z.CrossToRef(M,j,K),K},Z.CrossToRef=function(Z,M,j){var K=Z._y*M._z-Z._z*M._y,b=Z._z*M._x-Z._x*M._z,g=Z._x*M._y-Z._y*M._x;j.copyFromFloats(K,b,g)},Z.Normalize=function(M){var j=Z.Zero();return Z.NormalizeToRef(M,j),j},Z.NormalizeToRef=function(Z,M){Z.normalizeToRef(M)},Z.Project=function(M,j,K,b){var g=new Z;return Z.ProjectToRef(M,j,K,b,g),g},Z.ProjectToRef=function(M,j,K,b,g){var O=b.width,Q=b.height,Y=b.x,I=b.y,E=V.Matrix[1];z.FromValuesToRef(O/2,0,0,0,0,-Q/2,0,0,0,0,.5,0,Y+O/2,Q/2+I,.5,1,E);var s=V.Matrix[0];return j.multiplyToRef(K,s),s.multiplyToRef(E,s),Z.TransformCoordinatesToRef(M,s,g),g},Z._UnprojectFromInvertedMatrixToRef=function(M,j,b){Z.TransformCoordinatesToRef(M,j,b);var g=j.m,O=M._x*g[3]+M._y*g[7]+M._z*g[11]+g[15];K.b.WithinEpsilon(O,1)&&b.scaleInPlace(1/O)},Z.UnprojectFromTransform=function(Z,M,j,K,b){return this.Unproject(Z,M,j,K,b,z.IdentityReadOnly)},Z.Unproject=function(M,j,K,b,g,O){var Q=Z.Zero();return Z.UnprojectToRef(M,j,K,b,g,O,Q),Q},Z.UnprojectToRef=function(M,j,K,b,g,O,Q){Z.UnprojectFloatsToRef(M._x,M._y,M._z,j,K,b,g,O,Q)},Z.UnprojectFloatsToRef=function(M,j,K,b,g,O,Q,I,E){var s,i=V.Matrix[0];O.multiplyToRef(Q,i),i.multiplyToRef(I,i),i.invert();var a=V.Vector3[0];a.x=M/b*2-1,a.y=-(j/g*2-1),(null===(s=Y.e.LastCreatedEngine)||void 0===s?void 0:s.isNDCHalfZRange)?a.z=K:a.z=2*K-1,Z._UnprojectFromInvertedMatrixToRef(a,i,E)},Z.Minimize=function(Z,M){var j=Z.clone();return j.minimizeInPlace(M),j},Z.Maximize=function(Z,M){var j=Z.clone();return j.maximizeInPlace(M),j},Z.Distance=function(M,j){return Math.sqrt(Z.DistanceSquared(M,j))},Z.DistanceSquared=function(Z,M){var j=Z._x-M._x,K=Z._y-M._y,b=Z._z-M._z;return j*j+K*K+b*b},Z.ProjectOnTriangleToRef=function(M,j,g,O,Q){var Y=V.Vector3[0],I=V.Vector3[1],E=V.Vector3[2],s=V.Vector3[3],i=V.Vector3[4];g.subtractToRef(j,Y),O.subtractToRef(j,I),O.subtractToRef(g,E);var a=Y.length(),z=I.length(),o=E.length();if(a<b.e||z<b.e||o<b.e)return Q.copyFrom(j),Z.Distance(M,j);M.subtractToRef(j,i),Z.CrossToRef(Y,I,s);var c=s.length();if(c<b.e)return Q.copyFrom(j),Z.Distance(M,j);s.normalizeFromLength(c);var G=i.length();if(G<b.e)return Q.copyFrom(j),0;i.normalizeFromLength(G);var f=Z.Dot(s,i),X=V.Vector3[5],d=V.Vector3[6];X.copyFrom(s).scaleInPlace(-G*f),d.copyFrom(M).addInPlace(X);var W=V.Vector3[4],A=V.Vector3[5],q=V.Vector3[7],T=V.Vector3[8];W.copyFrom(Y).scaleInPlace(1/a),T.copyFrom(I).scaleInPlace(1/z),W.addInPlace(T).scaleInPlace(-1),A.copyFrom(Y).scaleInPlace(-1/a),T.copyFrom(E).scaleInPlace(1/o),A.addInPlace(T).scaleInPlace(-1),q.copyFrom(E).scaleInPlace(-1/o),T.copyFrom(I).scaleInPlace(-1/z),q.addInPlace(T).scaleInPlace(-1);var B=V.Vector3[9];B.copyFrom(d).subtractInPlace(j),Z.CrossToRef(W,B,T);var N=Z.Dot(T,s);B.copyFrom(d).subtractInPlace(g),Z.CrossToRef(A,B,T);var U=Z.Dot(T,s);B.copyFrom(d).subtractInPlace(O),Z.CrossToRef(q,B,T);var n,k,x=Z.Dot(T,s),R=V.Vector3[10];N>0&&U<0?(R.copyFrom(Y),n=j,k=g):U>0&&x<0?(R.copyFrom(E),n=g,k=O):(R.copyFrom(I).scaleInPlace(-1),n=O,k=j);var e=V.Vector3[9],u=V.Vector3[4];if(n.subtractToRef(d,T),k.subtractToRef(d,e),Z.CrossToRef(T,e,u),!(Z.Dot(u,s)<0))return Q.copyFrom(d),Math.abs(G*f);var F=V.Vector3[5];Z.CrossToRef(R,u,F),F.normalize();var C=V.Vector3[9];C.copyFrom(n).subtractInPlace(d);var y=C.length();if(y<b.e)return Q.copyFrom(n),Z.Distance(M,n);C.normalizeFromLength(y);var S=Z.Dot(F,C),h=V.Vector3[7];h.copyFrom(d).addInPlace(F.scaleInPlace(y*S)),T.copyFrom(h).subtractInPlace(n),G=R.length(),R.normalizeFromLength(G);var w=Z.Dot(T,R)/Math.max(G,b.e);return w=K.b.Clamp(w,0,1),h.copyFrom(n).addInPlace(R.scaleInPlace(w*G)),Q.copyFrom(h),Z.Distance(M,h)},Z.Center=function(M,j){return Z.CenterToRef(M,j,Z.Zero())},Z.CenterToRef=function(Z,M,j){return j.copyFromFloats((Z._x+M._x)/2,(Z._y+M._y)/2,(Z._z+M._z)/2)},Z.RotationFromAxis=function(M,j,K){var b=Z.Zero();return Z.RotationFromAxisToRef(M,j,K,b),b},Z.RotationFromAxisToRef=function(Z,M,j,K){var b=V.Quaternion[0];a.RotationQuaternionFromAxisToRef(Z,M,j,b),b.toEulerAnglesToRef(K)},Z._UpReadOnly=Z.Up(),Z._LeftHandedForwardReadOnly=Z.Forward(!1),Z._RightHandedForwardReadOnly=Z.Forward(!0),Z._RightReadOnly=Z.Right(),Z._LeftReadOnly=Z.Left(),Z._ZeroReadOnly=Z.Zero(),Z}(),i=function(){function Z(Z,M,j,K){this.x=Z,this.y=M,this.z=j,this.w=K}return Z.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y," Z: ").concat(this.z," W: ").concat(this.w,"}")},Z.prototype.getClassName=function(){return"Vector4"},Z.prototype.getHashCode=function(){var Z=I(this.x);return Z=397*(Z=397*(Z=397*Z^I(this.y))^I(this.z))^I(this.w)},Z.prototype.asArray=function(){var Z=new Array;return this.toArray(Z,0),Z},Z.prototype.toArray=function(Z,M){return void 0===M&&(M=0),Z[M]=this.x,Z[M+1]=this.y,Z[M+2]=this.z,Z[M+3]=this.w,this},Z.prototype.fromArray=function(M,j){return void 0===j&&(j=0),Z.FromArrayToRef(M,j,this),this},Z.prototype.addInPlace=function(Z){return this.x+=Z.x,this.y+=Z.y,this.z+=Z.z,this.w+=Z.w,this},Z.prototype.add=function(M){return new Z(this.x+M.x,this.y+M.y,this.z+M.z,this.w+M.w)},Z.prototype.addToRef=function(Z,M){return M.x=this.x+Z.x,M.y=this.y+Z.y,M.z=this.z+Z.z,M.w=this.w+Z.w,this},Z.prototype.subtractInPlace=function(Z){return this.x-=Z.x,this.y-=Z.y,this.z-=Z.z,this.w-=Z.w,this},Z.prototype.subtract=function(M){return new Z(this.x-M.x,this.y-M.y,this.z-M.z,this.w-M.w)},Z.prototype.subtractToRef=function(Z,M){return M.x=this.x-Z.x,M.y=this.y-Z.y,M.z=this.z-Z.z,M.w=this.w-Z.w,this},Z.prototype.subtractFromFloats=function(M,j,K,b){return new Z(this.x-M,this.y-j,this.z-K,this.w-b)},Z.prototype.subtractFromFloatsToRef=function(Z,M,j,K,b){return b.x=this.x-Z,b.y=this.y-M,b.z=this.z-j,b.w=this.w-K,this},Z.prototype.negate=function(){return new Z(-this.x,-this.y,-this.z,-this.w)},Z.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},Z.prototype.negateToRef=function(Z){return Z.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},Z.prototype.scaleInPlace=function(Z){return this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z,this},Z.prototype.scale=function(M){return new Z(this.x*M,this.y*M,this.z*M,this.w*M)},Z.prototype.scaleToRef=function(Z,M){return M.x=this.x*Z,M.y=this.y*Z,M.z=this.z*Z,M.w=this.w*Z,this},Z.prototype.scaleAndAddToRef=function(Z,M){return M.x+=this.x*Z,M.y+=this.y*Z,M.z+=this.z*Z,M.w+=this.w*Z,this},Z.prototype.equals=function(Z){return Z&&this.x===Z.x&&this.y===Z.y&&this.z===Z.z&&this.w===Z.w},Z.prototype.equalsWithEpsilon=function(Z,M){return void 0===M&&(M=b.e),Z&&K.b.WithinEpsilon(this.x,Z.x,M)&&K.b.WithinEpsilon(this.y,Z.y,M)&&K.b.WithinEpsilon(this.z,Z.z,M)&&K.b.WithinEpsilon(this.w,Z.w,M)},Z.prototype.equalsToFloats=function(Z,M,j,K){return this.x===Z&&this.y===M&&this.z===j&&this.w===K},Z.prototype.multiplyInPlace=function(Z){return this.x*=Z.x,this.y*=Z.y,this.z*=Z.z,this.w*=Z.w,this},Z.prototype.multiply=function(M){return new Z(this.x*M.x,this.y*M.y,this.z*M.z,this.w*M.w)},Z.prototype.multiplyToRef=function(Z,M){return M.x=this.x*Z.x,M.y=this.y*Z.y,M.z=this.z*Z.z,M.w=this.w*Z.w,this},Z.prototype.multiplyByFloats=function(M,j,K,b){return new Z(this.x*M,this.y*j,this.z*K,this.w*b)},Z.prototype.divide=function(M){return new Z(this.x/M.x,this.y/M.y,this.z/M.z,this.w/M.w)},Z.prototype.divideToRef=function(Z,M){return M.x=this.x/Z.x,M.y=this.y/Z.y,M.z=this.z/Z.z,M.w=this.w/Z.w,this},Z.prototype.divideInPlace=function(Z){return this.divideToRef(Z,this)},Z.prototype.minimizeInPlace=function(Z){return Z.x<this.x&&(this.x=Z.x),Z.y<this.y&&(this.y=Z.y),Z.z<this.z&&(this.z=Z.z),Z.w<this.w&&(this.w=Z.w),this},Z.prototype.maximizeInPlace=function(Z){return Z.x>this.x&&(this.x=Z.x),Z.y>this.y&&(this.y=Z.y),Z.z>this.z&&(this.z=Z.z),Z.w>this.w&&(this.w=Z.w),this},Z.prototype.floor=function(){return new Z(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},Z.prototype.fract=function(){return new Z(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},Z.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},Z.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},Z.prototype.normalize=function(){var Z=this.length();return 0===Z?this:this.scaleInPlace(1/Z)},Z.prototype.toVector3=function(){return new s(this.x,this.y,this.z)},Z.prototype.clone=function(){return new Z(this.x,this.y,this.z,this.w)},Z.prototype.copyFrom=function(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this.w=Z.w,this},Z.prototype.copyFromFloats=function(Z,M,j,K){return this.x=Z,this.y=M,this.z=j,this.w=K,this},Z.prototype.set=function(Z,M,j,K){return this.copyFromFloats(Z,M,j,K)},Z.prototype.setAll=function(Z){return this.x=this.y=this.z=this.w=Z,this},Z.FromArray=function(M,j){return j||(j=0),new Z(M[j],M[j+1],M[j+2],M[j+3])},Z.FromArrayToRef=function(Z,M,j){j.x=Z[M],j.y=Z[M+1],j.z=Z[M+2],j.w=Z[M+3]},Z.FromFloatArrayToRef=function(M,j,K){Z.FromArrayToRef(M,j,K)},Z.FromFloatsToRef=function(Z,M,j,K,b){b.x=Z,b.y=M,b.z=j,b.w=K},Z.Zero=function(){return new Z(0,0,0,0)},Z.One=function(){return new Z(1,1,1,1)},Z.Normalize=function(M){var j=Z.Zero();return Z.NormalizeToRef(M,j),j},Z.NormalizeToRef=function(Z,M){M.copyFrom(Z),M.normalize()},Z.Minimize=function(Z,M){var j=Z.clone();return j.minimizeInPlace(M),j},Z.Maximize=function(Z,M){var j=Z.clone();return j.maximizeInPlace(M),j},Z.Distance=function(M,j){return Math.sqrt(Z.DistanceSquared(M,j))},Z.DistanceSquared=function(Z,M){var j=Z.x-M.x,K=Z.y-M.y,b=Z.z-M.z,g=Z.w-M.w;return j*j+K*K+b*b+g*g},Z.Center=function(M,j){return Z.CenterToRef(M,j,Z.Zero())},Z.CenterToRef=function(Z,M,j){return j.copyFromFloats((Z.x+M.x)/2,(Z.y+M.y)/2,(Z.z+M.z)/2,(Z.w+M.w)/2)},Z.TransformCoordinates=function(M,j){var K=Z.Zero();return Z.TransformCoordinatesToRef(M,j,K),K},Z.TransformCoordinatesToRef=function(M,j,K){Z.TransformCoordinatesFromFloatsToRef(M._x,M._y,M._z,j,K)},Z.TransformCoordinatesFromFloatsToRef=function(Z,M,j,K,b){var g=K.m,O=Z*g[0]+M*g[4]+j*g[8]+g[12],Q=Z*g[1]+M*g[5]+j*g[9]+g[13],Y=Z*g[2]+M*g[6]+j*g[10]+g[14],I=Z*g[3]+M*g[7]+j*g[11]+g[15];b.x=O,b.y=Q,b.z=Y,b.w=I},Z.TransformNormal=function(M,j){var K=Z.Zero();return Z.TransformNormalToRef(M,j,K),K},Z.TransformNormalToRef=function(Z,M,j){var K=M.m,b=Z.x*K[0]+Z.y*K[4]+Z.z*K[8],g=Z.x*K[1]+Z.y*K[5]+Z.z*K[9],O=Z.x*K[2]+Z.y*K[6]+Z.z*K[10];j.x=b,j.y=g,j.z=O,j.w=Z.w},Z.TransformNormalFromFloatsToRef=function(Z,M,j,K,b,g){var O=b.m;g.x=Z*O[0]+M*O[4]+j*O[8],g.y=Z*O[1]+M*O[5]+j*O[9],g.z=Z*O[2]+M*O[6]+j*O[10],g.w=K},Z.FromVector3=function(M,j){return void 0===j&&(j=0),new Z(M._x,M._y,M._z,j)},Z}(),a=function(){function Z(Z,M,j,K){void 0===Z&&(Z=0),void 0===M&&(M=0),void 0===j&&(j=0),void 0===K&&(K=1),this._isDirty=!0,this._x=Z,this._y=M,this._z=j,this._w=K}return Object.defineProperty(Z.prototype,"x",{get:function(){return this._x},set:function(Z){this._x=Z,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"y",{get:function(){return this._y},set:function(Z){this._y=Z,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"z",{get:function(){return this._z},set:function(Z){this._z=Z,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"w",{get:function(){return this._w},set:function(Z){this._w=Z,this._isDirty=!0},enumerable:!1,configurable:!0}),Z.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z," W: ").concat(this._w,"}")},Z.prototype.getClassName=function(){return"Quaternion"},Z.prototype.getHashCode=function(){var Z=I(this._x);return Z=397*(Z=397*(Z=397*Z^I(this._y))^I(this._z))^I(this._w)},Z.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},Z.prototype.toArray=function(Z,M){return void 0===M&&(M=0),Z[M]=this.x,Z[M+1]=this.y,Z[M+2]=this.z,Z[M+3]=this.w,this},Z.prototype.equals=function(Z){return Z&&this._x===Z._x&&this._y===Z._y&&this._z===Z._z&&this._w===Z._w},Z.prototype.equalsWithEpsilon=function(Z,M){return void 0===M&&(M=b.e),Z&&K.b.WithinEpsilon(this._x,Z._x,M)&&K.b.WithinEpsilon(this._y,Z._y,M)&&K.b.WithinEpsilon(this._z,Z._z,M)&&K.b.WithinEpsilon(this._w,Z._w,M)},Z.prototype.clone=function(){return new Z(this._x,this._y,this._z,this._w)},Z.prototype.copyFrom=function(Z){return this.x=Z._x,this.y=Z._y,this.z=Z._z,this.w=Z._w,this},Z.prototype.copyFromFloats=function(Z,M,j,K){return this.x=Z,this.y=M,this.z=j,this.w=K,this},Z.prototype.set=function(Z,M,j,K){return this.copyFromFloats(Z,M,j,K)},Z.prototype.add=function(M){return new Z(this._x+M._x,this._y+M._y,this._z+M._z,this._w+M._w)},Z.prototype.addInPlace=function(Z){return this._x+=Z._x,this._y+=Z._y,this._z+=Z._z,this._w+=Z._w,this},Z.prototype.subtract=function(M){return new Z(this._x-M._x,this._y-M._y,this._z-M._z,this._w-M._w)},Z.prototype.subtractInPlace=function(Z){return this._x-=Z._x,this._y-=Z._y,this._z-=Z._z,this._w-=Z._w,this},Z.prototype.scale=function(M){return new Z(this._x*M,this._y*M,this._z*M,this._w*M)},Z.prototype.scaleToRef=function(Z,M){return M.x=this._x*Z,M.y=this._y*Z,M.z=this._z*Z,M.w=this._w*Z,this},Z.prototype.scaleInPlace=function(Z){return this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z,this},Z.prototype.scaleAndAddToRef=function(Z,M){return M.x+=this._x*Z,M.y+=this._y*Z,M.z+=this._z*Z,M.w+=this._w*Z,this},Z.prototype.multiply=function(M){var j=new Z(0,0,0,1);return this.multiplyToRef(M,j),j},Z.prototype.multiplyToRef=function(Z,M){var j=this._x*Z._w+this._y*Z._z-this._z*Z._y+this._w*Z._x,K=-this._x*Z._z+this._y*Z._w+this._z*Z._x+this._w*Z._y,b=this._x*Z._y-this._y*Z._x+this._z*Z._w+this._w*Z._z,g=-this._x*Z._x-this._y*Z._y-this._z*Z._z+this._w*Z._w;return M.copyFromFloats(j,K,b,g),this},Z.prototype.multiplyInPlace=function(Z){return this.multiplyToRef(Z,this),this},Z.prototype.conjugateToRef=function(Z){return Z.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},Z.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},Z.prototype.conjugate=function(){return new Z(-this._x,-this._y,-this._z,this._w)},Z.prototype.invert=function(){var Z=this.conjugate(),M=this.lengthSquared();return 0==M||1==M||Z.scaleInPlace(1/M),Z},Z.prototype.invertInPlace=function(){this.conjugateInPlace();var Z=this.lengthSquared();return 0==Z||1==Z||this.scaleInPlace(1/Z),this},Z.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},Z.prototype.length=function(){return Math.sqrt(this.lengthSquared())},Z.prototype.normalize=function(){var Z=this.length();if(0===Z)return this;var M=1/Z;return this.scaleInPlace(M),this},Z.prototype.normalizeToNew=function(){var Z=this.length();if(0===Z)return this.clone();var M=1/Z;return this.scale(M)},Z.prototype.toEulerAngles=function(){var Z=s.Zero();return this.toEulerAnglesToRef(Z),Z},Z.prototype.toEulerAnglesToRef=function(Z){var M=this._z,j=this._x,K=this._y,b=this._w,g=K*M-j*b,O=.4999999;if(g<-O)Z.y=2*Math.atan2(K,b),Z.x=Math.PI/2,Z.z=0;else if(g>O)Z.y=2*Math.atan2(K,b),Z.x=-Math.PI/2,Z.z=0;else{var Q=b*b,Y=M*M,I=j*j,E=K*K;Z.z=Math.atan2(2*(j*K+M*b),-Y-I+E+Q),Z.x=Math.asin(-2*g),Z.y=Math.atan2(2*(M*j+K*b),Y-I-E+Q)}return this},Z.prototype.toRotationMatrix=function(Z){return z.FromQuaternionToRef(this,Z),this},Z.prototype.fromRotationMatrix=function(M){return Z.FromRotationMatrixToRef(M,this),this},Z.FromRotationMatrix=function(M){var j=new Z;return Z.FromRotationMatrixToRef(M,j),j},Z.FromRotationMatrixToRef=function(Z,M){var j,K=Z.m,b=K[0],g=K[4],O=K[8],Q=K[1],Y=K[5],I=K[9],E=K[2],s=K[6],i=K[10],a=b+Y+i;a>0?(j=.5/Math.sqrt(a+1),M.w=.25/j,M.x=(s-I)*j,M.y=(O-E)*j,M.z=(Q-g)*j):b>Y&&b>i?(j=2*Math.sqrt(1+b-Y-i),M.w=(s-I)/j,M.x=.25*j,M.y=(g+Q)/j,M.z=(O+E)/j):Y>i?(j=2*Math.sqrt(1+Y-b-i),M.w=(O-E)/j,M.x=(g+Q)/j,M.y=.25*j,M.z=(I+s)/j):(j=2*Math.sqrt(1+i-b-Y),M.w=(Q-g)/j,M.x=(O+E)/j,M.y=(I+s)/j,M.z=.25*j)},Z.Dot=function(Z,M){return Z._x*M._x+Z._y*M._y+Z._z*M._z+Z._w*M._w},Z.AreClose=function(M,j){return Z.Dot(M,j)>=0},Z.SmoothToRef=function(M,j,b,g,O){var Q=0===g?1:b/g;Q=K.b.Clamp(Q,0,1),Z.SlerpToRef(M,j,Q,O)},Z.Zero=function(){return new Z(0,0,0,0)},Z.Inverse=function(M){return new Z(-M._x,-M._y,-M._z,M._w)},Z.InverseToRef=function(Z,M){return M.set(-Z._x,-Z._y,-Z._z,Z._w),M},Z.Identity=function(){return new Z(0,0,0,1)},Z.IsIdentity=function(Z){return Z&&0===Z._x&&0===Z._y&&0===Z._z&&1===Z._w},Z.RotationAxis=function(M,j){return Z.RotationAxisToRef(M,j,new Z)},Z.RotationAxisToRef=function(Z,M,j){var K=Math.sin(M/2);return Z.normalize(),j.w=Math.cos(M/2),j.x=Z._x*K,j.y=Z._y*K,j.z=Z._z*K,j},Z.FromArray=function(M,j){return j||(j=0),new Z(M[j],M[j+1],M[j+2],M[j+3])},Z.FromArrayToRef=function(Z,M,j){j.x=Z[M],j.y=Z[M+1],j.z=Z[M+2],j.w=Z[M+3]},Z.FromEulerAngles=function(M,j,K){var b=new Z;return Z.RotationYawPitchRollToRef(j,M,K,b),b},Z.FromEulerAnglesToRef=function(M,j,K,b){return Z.RotationYawPitchRollToRef(j,M,K,b),b},Z.FromEulerVector=function(M){var j=new Z;return Z.RotationYawPitchRollToRef(M._y,M._x,M._z,j),j},Z.FromEulerVectorToRef=function(M,j){return Z.RotationYawPitchRollToRef(M._y,M._x,M._z,j),j},Z.FromUnitVectorsToRef=function(Z,M,j){var K=s.Dot(Z,M)+1;return K<b.e?Math.abs(Z.x)>Math.abs(Z.z)?j.set(-Z.y,Z.x,0,0):j.set(0,-Z.z,Z.y,0):(s.CrossToRef(Z,M,o.Vector3[0]),j.set(o.Vector3[0].x,o.Vector3[0].y,o.Vector3[0].z,K)),j.normalize()},Z.RotationYawPitchRoll=function(M,j,K){var b=new Z;return Z.RotationYawPitchRollToRef(M,j,K,b),b},Z.RotationYawPitchRollToRef=function(Z,M,j,K){var b=.5*j,g=.5*M,O=.5*Z,Q=Math.sin(b),Y=Math.cos(b),I=Math.sin(g),E=Math.cos(g),s=Math.sin(O),i=Math.cos(O);K.x=i*I*Y+s*E*Q,K.y=s*E*Y-i*I*Q,K.z=i*E*Q-s*I*Y,K.w=i*E*Y+s*I*Q},Z.RotationAlphaBetaGamma=function(M,j,K){var b=new Z;return Z.RotationAlphaBetaGammaToRef(M,j,K,b),b},Z.RotationAlphaBetaGammaToRef=function(Z,M,j,K){var b=.5*(j+Z),g=.5*(j-Z),O=.5*M;K.x=Math.cos(g)*Math.sin(O),K.y=Math.sin(g)*Math.sin(O),K.z=Math.sin(b)*Math.cos(O),K.w=Math.cos(b)*Math.cos(O)},Z.RotationQuaternionFromAxis=function(M,j,K){var b=new Z(0,0,0,0);return Z.RotationQuaternionFromAxisToRef(M,j,K,b),b},Z.RotationQuaternionFromAxisToRef=function(M,j,K,b){var g=V.Matrix[0];z.FromXYZAxesToRef(M.normalize(),j.normalize(),K.normalize(),g),Z.FromRotationMatrixToRef(g,b)},Z.FromLookDirectionLH=function(M,j){var K=new Z;return Z.FromLookDirectionLHToRef(M,j,K),K},Z.FromLookDirectionLHToRef=function(M,j,K){var b=V.Matrix[0];z.LookDirectionLHToRef(M,j,b),Z.FromRotationMatrixToRef(b,K)},Z.FromLookDirectionRH=function(M,j){var K=new Z;return Z.FromLookDirectionRHToRef(M,j,K),K},Z.FromLookDirectionRHToRef=function(M,j,K){var b=V.Matrix[0];return z.LookDirectionRHToRef(M,j,b),Z.FromRotationMatrixToRef(b,K)},Z.Slerp=function(M,j,K){var b=Z.Identity();return Z.SlerpToRef(M,j,K,b),b},Z.SlerpToRef=function(Z,M,j,K){var b,g,O=Z._x*M._x+Z._y*M._y+Z._z*M._z+Z._w*M._w,Q=!1;if(O<0&&(Q=!0,O=-O),O>.999999)g=1-j,b=Q?-j:j;else{var Y=Math.acos(O),I=1/Math.sin(Y);g=Math.sin((1-j)*Y)*I,b=Q?-Math.sin(j*Y)*I:Math.sin(j*Y)*I}K.x=g*Z._x+b*M._x,K.y=g*Z._y+b*M._y,K.z=g*Z._z+b*M._z,K.w=g*Z._w+b*M._w},Z.Hermite=function(M,j,K,b,g){var O=g*g,Q=g*O,Y=2*Q-3*O+1,I=-2*Q+3*O,E=Q-2*O+g,s=Q-O;return new Z(M._x*Y+K._x*I+j._x*E+b._x*s,M._y*Y+K._y*I+j._y*E+b._y*s,M._z*Y+K._z*I+j._z*E+b._z*s,M._w*Y+K._w*I+j._w*E+b._w*s)},Z.Hermite1stDerivative=function(M,j,K,b,g){var O=Z.Zero();return this.Hermite1stDerivativeToRef(M,j,K,b,g,O),O},Z.Hermite1stDerivativeToRef=function(Z,M,j,K,b,g){var O=b*b;g.x=6*(O-b)*Z.x+(3*O-4*b+1)*M.x+6*(-O+b)*j.x+(3*O-2*b)*K.x,g.y=6*(O-b)*Z.y+(3*O-4*b+1)*M.y+6*(-O+b)*j.y+(3*O-2*b)*K.y,g.z=6*(O-b)*Z.z+(3*O-4*b+1)*M.z+6*(-O+b)*j.z+(3*O-2*b)*K.z,g.w=6*(O-b)*Z.w+(3*O-4*b+1)*M.w+6*(-O+b)*j.w+(3*O-2*b)*K.w},Z}(),z=function(){function Z(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,Q.d.MatrixTrackPrecisionChange&&Q.d.MatrixTrackedMatrices.push(this),this._m=new Q.d.MatrixCurrentType(16),this.markAsUpdated()}return Object.defineProperty(Z,"Use64Bits",{get:function(){return Q.d.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),Z.prototype.markAsUpdated=function(){this.updateFlag=Z._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},Z.prototype._updateIdentityStatus=function(Z,M,j,K){void 0===M&&(M=!1),void 0===j&&(j=!1),void 0===K&&(K=!0),this._isIdentity=Z,this._isIdentity3x2=Z||j,this._isIdentityDirty=!this._isIdentity&&M,this._isIdentity3x2Dirty=!this._isIdentity3x2&&K},Z.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var Z=this._m;this._isIdentity=1===Z[0]&&0===Z[1]&&0===Z[2]&&0===Z[3]&&0===Z[4]&&1===Z[5]&&0===Z[6]&&0===Z[7]&&0===Z[8]&&0===Z[9]&&1===Z[10]&&0===Z[11]&&0===Z[12]&&0===Z[13]&&0===Z[14]&&1===Z[15]}return this._isIdentity},Z.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},Z.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var Z=this._m,M=Z[0],j=Z[1],K=Z[2],b=Z[3],g=Z[4],O=Z[5],Q=Z[6],Y=Z[7],I=Z[8],E=Z[9],s=Z[10],i=Z[11],a=Z[12],z=Z[13],V=Z[14],o=Z[15],c=s*o-V*i,G=E*o-z*i,f=E*V-z*s,X=I*o-a*i,d=I*V-s*a,W=I*z-a*E;return M*+(O*c-Q*G+Y*f)+j*-(g*c-Q*X+Y*d)+K*+(g*G-O*X+Y*W)+b*-(g*f-O*d+Q*W)},Z.prototype.toArray=function(){return this._m},Z.prototype.asArray=function(){return this._m},Z.prototype.invert=function(){return this.invertToRef(this),this},Z.prototype.reset=function(){return Z.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},Z.prototype.add=function(M){var j=new Z;return this.addToRef(M,j),j},Z.prototype.addToRef=function(Z,M){for(var j=this._m,K=M._m,b=Z.m,g=0;g<16;g++)K[g]=j[g]+b[g];return M.markAsUpdated(),this},Z.prototype.addToSelf=function(Z){for(var M=this._m,j=Z.m,K=0;K<16;K++)M[K]+=j[K];return this.markAsUpdated(),this},Z.prototype.invertToRef=function(M){if(!0===this._isIdentity)return Z.IdentityToRef(M),this;var j=this._m,K=j[0],b=j[1],g=j[2],O=j[3],Q=j[4],Y=j[5],I=j[6],E=j[7],s=j[8],i=j[9],a=j[10],z=j[11],V=j[12],o=j[13],c=j[14],G=j[15],f=a*G-c*z,X=i*G-o*z,d=i*c-o*a,W=s*G-V*z,A=s*c-a*V,q=s*o-V*i,T=+(Y*f-I*X+E*d),B=-(Q*f-I*W+E*A),N=+(Q*X-Y*W+E*q),U=-(Q*d-Y*A+I*q),n=K*T+b*B+g*N+O*U;if(0===n)return M.copyFrom(this),this;var k=1/n,x=I*G-c*E,R=Y*G-o*E,e=Y*c-o*I,u=Q*G-V*E,F=Q*c-V*I,C=Q*o-V*Y,y=I*z-a*E,S=Y*z-i*E,h=Y*a-i*I,w=Q*z-s*E,p=Q*a-s*I,m=Q*i-s*Y,J=-(b*f-g*X+O*d),P=+(K*f-g*W+O*A),H=-(K*X-b*W+O*q),D=+(K*d-b*A+g*q),l=+(b*x-g*R+O*e),t=-(K*x-g*u+O*F),v=+(K*R-b*u+O*C),r=-(K*e-b*F+g*C),L=-(b*y-g*S+O*h),ZZ=+(K*y-g*w+O*p),MZ=-(K*S-b*w+O*m),jZ=+(K*h-b*p+g*m);return Z.FromValuesToRef(T*k,J*k,l*k,L*k,B*k,P*k,t*k,ZZ*k,N*k,H*k,v*k,MZ*k,U*k,D*k,r*k,jZ*k,M),this},Z.prototype.addAtIndex=function(Z,M){return this._m[Z]+=M,this.markAsUpdated(),this},Z.prototype.multiplyAtIndex=function(Z,M){return this._m[Z]*=M,this.markAsUpdated(),this},Z.prototype.setTranslationFromFloats=function(Z,M,j){return this._m[12]=Z,this._m[13]=M,this._m[14]=j,this.markAsUpdated(),this},Z.prototype.addTranslationFromFloats=function(Z,M,j){return this._m[12]+=Z,this._m[13]+=M,this._m[14]+=j,this.markAsUpdated(),this},Z.prototype.setTranslation=function(Z){return this.setTranslationFromFloats(Z._x,Z._y,Z._z)},Z.prototype.getTranslation=function(){return new s(this._m[12],this._m[13],this._m[14])},Z.prototype.getTranslationToRef=function(Z){return Z.x=this._m[12],Z.y=this._m[13],Z.z=this._m[14],this},Z.prototype.removeRotationAndScaling=function(){var M=this.m;return Z.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,M[12],M[13],M[14],M[15],this),this._updateIdentityStatus(0===M[12]&&0===M[13]&&0===M[14]&&1===M[15]),this},Z.prototype.multiply=function(M){var j=new Z;return this.multiplyToRef(M,j),j},Z.prototype.copyFrom=function(Z){Z.copyToArray(this._m);var M=Z;return this.updateFlag=M.updateFlag,this._updateIdentityStatus(M._isIdentity,M._isIdentityDirty,M._isIdentity3x2,M._isIdentity3x2Dirty),this},Z.prototype.copyToArray=function(Z,M){void 0===M&&(M=0);var j=this._m;return Z[M]=j[0],Z[M+1]=j[1],Z[M+2]=j[2],Z[M+3]=j[3],Z[M+4]=j[4],Z[M+5]=j[5],Z[M+6]=j[6],Z[M+7]=j[7],Z[M+8]=j[8],Z[M+9]=j[9],Z[M+10]=j[10],Z[M+11]=j[11],Z[M+12]=j[12],Z[M+13]=j[13],Z[M+14]=j[14],Z[M+15]=j[15],this},Z.prototype.multiplyToRef=function(Z,M){return this._isIdentity?(M.copyFrom(Z),this):Z._isIdentity?(M.copyFrom(this),this):(this.multiplyToArray(Z,M._m,0),M.markAsUpdated(),this)},Z.prototype.multiplyToArray=function(Z,M,j){var K=this._m,b=Z.m,g=K[0],O=K[1],Q=K[2],Y=K[3],I=K[4],E=K[5],s=K[6],i=K[7],a=K[8],z=K[9],V=K[10],o=K[11],c=K[12],G=K[13],f=K[14],X=K[15],d=b[0],W=b[1],A=b[2],q=b[3],T=b[4],B=b[5],N=b[6],U=b[7],n=b[8],k=b[9],x=b[10],R=b[11],e=b[12],u=b[13],F=b[14],C=b[15];return M[j]=g*d+O*T+Q*n+Y*e,M[j+1]=g*W+O*B+Q*k+Y*u,M[j+2]=g*A+O*N+Q*x+Y*F,M[j+3]=g*q+O*U+Q*R+Y*C,M[j+4]=I*d+E*T+s*n+i*e,M[j+5]=I*W+E*B+s*k+i*u,M[j+6]=I*A+E*N+s*x+i*F,M[j+7]=I*q+E*U+s*R+i*C,M[j+8]=a*d+z*T+V*n+o*e,M[j+9]=a*W+z*B+V*k+o*u,M[j+10]=a*A+z*N+V*x+o*F,M[j+11]=a*q+z*U+V*R+o*C,M[j+12]=c*d+G*T+f*n+X*e,M[j+13]=c*W+G*B+f*k+X*u,M[j+14]=c*A+G*N+f*x+X*F,M[j+15]=c*q+G*U+f*R+X*C,this},Z.prototype.equals=function(Z){var M=Z;if(!M)return!1;if((this._isIdentity||M._isIdentity)&&!this._isIdentityDirty&&!M._isIdentityDirty)return this._isIdentity&&M._isIdentity;var j=this.m,K=M.m;return j[0]===K[0]&&j[1]===K[1]&&j[2]===K[2]&&j[3]===K[3]&&j[4]===K[4]&&j[5]===K[5]&&j[6]===K[6]&&j[7]===K[7]&&j[8]===K[8]&&j[9]===K[9]&&j[10]===K[10]&&j[11]===K[11]&&j[12]===K[12]&&j[13]===K[13]&&j[14]===K[14]&&j[15]===K[15]},Z.prototype.clone=function(){var M=new Z;return M.copyFrom(this),M},Z.prototype.getClassName=function(){return"Matrix"},Z.prototype.getHashCode=function(){for(var Z=I(this._m[0]),M=1;M<16;M++)Z=397*Z^I(this._m[M]);return Z},Z.prototype.decomposeToTransformNode=function(Z){return Z.rotationQuaternion=Z.rotationQuaternion||new a,this.decompose(Z.scaling,Z.rotationQuaternion,Z.position)},Z.prototype.decompose=function(M,j,K,b){if(this._isIdentity)return K&&K.setAll(0),M&&M.setAll(1),j&&j.copyFromFloats(0,0,0,1),!0;var g=this._m;if(K&&K.copyFromFloats(g[12],g[13],g[14]),(M=M||V.Vector3[0]).x=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),M.y=Math.sqrt(g[4]*g[4]+g[5]*g[5]+g[6]*g[6]),M.z=Math.sqrt(g[8]*g[8]+g[9]*g[9]+g[10]*g[10]),b){var O=b.scaling.x<0?-1:1,Q=b.scaling.y<0?-1:1,Y=b.scaling.z<0?-1:1;M.x*=O,M.y*=Q,M.z*=Y}else this.determinant()<=0&&(M.y*=-1);if(0===M._x||0===M._y||0===M._z)return j&&j.copyFromFloats(0,0,0,1),!1;if(j){var I=1/M._x,E=1/M._y,s=1/M._z;Z.FromValuesToRef(g[0]*I,g[1]*I,g[2]*I,0,g[4]*E,g[5]*E,g[6]*E,0,g[8]*s,g[9]*s,g[10]*s,0,0,0,0,1,V.Matrix[0]),a.FromRotationMatrixToRef(V.Matrix[0],j)}return!0},Z.prototype.getRow=function(Z){if(Z<0||Z>3)return null;var M=4*Z;return new i(this._m[M+0],this._m[M+1],this._m[M+2],this._m[M+3])},Z.prototype.setRow=function(Z,M){return this.setRowFromFloats(Z,M.x,M.y,M.z,M.w)},Z.prototype.transpose=function(){return Z.Transpose(this)},Z.prototype.transposeToRef=function(M){return Z.TransposeToRef(this,M),this},Z.prototype.setRowFromFloats=function(Z,M,j,K,b){if(Z<0||Z>3)return this;var g=4*Z;return this._m[g+0]=M,this._m[g+1]=j,this._m[g+2]=K,this._m[g+3]=b,this.markAsUpdated(),this},Z.prototype.scale=function(M){var j=new Z;return this.scaleToRef(M,j),j},Z.prototype.scaleToRef=function(Z,M){for(var j=0;j<16;j++)M._m[j]=this._m[j]*Z;return M.markAsUpdated(),this},Z.prototype.scaleAndAddToRef=function(Z,M){for(var j=0;j<16;j++)M._m[j]+=this._m[j]*Z;return M.markAsUpdated(),this},Z.prototype.toNormalMatrix=function(M){var j=V.Matrix[0];this.invertToRef(j),j.transposeToRef(M);var K=M._m;Z.FromValuesToRef(K[0],K[1],K[2],0,K[4],K[5],K[6],0,K[8],K[9],K[10],0,0,0,0,1,M)},Z.prototype.getRotationMatrix=function(){var M=new Z;return this.getRotationMatrixToRef(M),M},Z.prototype.getRotationMatrixToRef=function(M){var j=V.Vector3[0];if(!this.decompose(j))return Z.IdentityToRef(M),this;var K=this._m,b=1/j._x,g=1/j._y,O=1/j._z;return Z.FromValuesToRef(K[0]*b,K[1]*b,K[2]*b,0,K[4]*g,K[5]*g,K[6]*g,0,K[8]*O,K[9]*O,K[10]*O,0,0,0,0,1,M),this},Z.prototype.toggleModelMatrixHandInPlace=function(){var Z=this._m;Z[2]*=-1,Z[6]*=-1,Z[8]*=-1,Z[9]*=-1,Z[14]*=-1,this.markAsUpdated()},Z.prototype.toggleProjectionMatrixHandInPlace=function(){var Z=this._m;Z[8]*=-1,Z[9]*=-1,Z[10]*=-1,Z[11]*=-1,this.markAsUpdated()},Z.FromArray=function(M,j){void 0===j&&(j=0);var K=new Z;return Z.FromArrayToRef(M,j,K),K},Z.FromArrayToRef=function(Z,M,j){for(var K=0;K<16;K++)j._m[K]=Z[K+M];j.markAsUpdated()},Z.FromFloat32ArrayToRefScaled=function(Z,M,j,K){for(var b=0;b<16;b++)K._m[b]=Z[b+M]*j;K.markAsUpdated()},Object.defineProperty(Z,"IdentityReadOnly",{get:function(){return Z._IdentityReadOnly},enumerable:!1,configurable:!0}),Z.FromValuesToRef=function(Z,M,j,K,b,g,O,Q,Y,I,E,s,i,a,z,V,o){var c=o._m;c[0]=Z,c[1]=M,c[2]=j,c[3]=K,c[4]=b,c[5]=g,c[6]=O,c[7]=Q,c[8]=Y,c[9]=I,c[10]=E,c[11]=s,c[12]=i,c[13]=a,c[14]=z,c[15]=V,o.markAsUpdated()},Z.FromValues=function(M,j,K,b,g,O,Q,Y,I,E,s,i,a,z,V,o){var c=new Z,G=c._m;return G[0]=M,G[1]=j,G[2]=K,G[3]=b,G[4]=g,G[5]=O,G[6]=Q,G[7]=Y,G[8]=I,G[9]=E,G[10]=s,G[11]=i,G[12]=a,G[13]=z,G[14]=V,G[15]=o,c.markAsUpdated(),c},Z.Compose=function(M,j,K){var b=new Z;return Z.ComposeToRef(M,j,K,b),b},Z.ComposeToRef=function(Z,M,j,K){var b=K._m,g=M._x,O=M._y,Q=M._z,Y=M._w,I=g+g,E=O+O,s=Q+Q,i=g*I,a=g*E,z=g*s,V=O*E,o=O*s,c=Q*s,G=Y*I,f=Y*E,X=Y*s,d=Z._x,W=Z._y,A=Z._z;b[0]=(1-(V+c))*d,b[1]=(a+X)*d,b[2]=(z-f)*d,b[3]=0,b[4]=(a-X)*W,b[5]=(1-(i+c))*W,b[6]=(o+G)*W,b[7]=0,b[8]=(z+f)*A,b[9]=(o-G)*A,b[10]=(1-(i+V))*A,b[11]=0,b[12]=j._x,b[13]=j._y,b[14]=j._z,b[15]=1,K.markAsUpdated()},Z.Identity=function(){var M=Z.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return M._updateIdentityStatus(!0),M},Z.IdentityToRef=function(M){Z.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,M),M._updateIdentityStatus(!0)},Z.Zero=function(){var M=Z.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return M._updateIdentityStatus(!1),M},Z.RotationX=function(M){var j=new Z;return Z.RotationXToRef(M,j),j},Z.Invert=function(M){var j=new Z;return M.invertToRef(j),j},Z.RotationXToRef=function(M,j){var K=Math.sin(M),b=Math.cos(M);Z.FromValuesToRef(1,0,0,0,0,b,K,0,0,-K,b,0,0,0,0,1,j),j._updateIdentityStatus(1===b&&0===K)},Z.RotationY=function(M){var j=new Z;return Z.RotationYToRef(M,j),j},Z.RotationYToRef=function(M,j){var K=Math.sin(M),b=Math.cos(M);Z.FromValuesToRef(b,0,-K,0,0,1,0,0,K,0,b,0,0,0,0,1,j),j._updateIdentityStatus(1===b&&0===K)},Z.RotationZ=function(M){var j=new Z;return Z.RotationZToRef(M,j),j},Z.RotationZToRef=function(M,j){var K=Math.sin(M),b=Math.cos(M);Z.FromValuesToRef(b,K,0,0,-K,b,0,0,0,0,1,0,0,0,0,1,j),j._updateIdentityStatus(1===b&&0===K)},Z.RotationAxis=function(M,j){var K=new Z;return Z.RotationAxisToRef(M,j,K),K},Z.RotationAxisToRef=function(Z,M,j){var K=Math.sin(-M),b=Math.cos(-M),g=1-b;Z.normalize();var O=j._m;O[0]=Z._x*Z._x*g+b,O[1]=Z._x*Z._y*g-Z._z*K,O[2]=Z._x*Z._z*g+Z._y*K,O[3]=0,O[4]=Z._y*Z._x*g+Z._z*K,O[5]=Z._y*Z._y*g+b,O[6]=Z._y*Z._z*g-Z._x*K,O[7]=0,O[8]=Z._z*Z._x*g-Z._y*K,O[9]=Z._z*Z._y*g+Z._x*K,O[10]=Z._z*Z._z*g+b,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,j.markAsUpdated()},Z.RotationAlignToRef=function(Z,M,j){var K=s.Dot(M,Z),g=j._m;if(K<-1+b.e)g[0]=-1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=-1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0;else{var O=s.Cross(M,Z),Q=1/(1+K);g[0]=O._x*O._x*Q+K,g[1]=O._y*O._x*Q-O._z,g[2]=O._z*O._x*Q+O._y,g[3]=0,g[4]=O._x*O._y*Q+O._z,g[5]=O._y*O._y*Q+K,g[6]=O._z*O._y*Q-O._x,g[7]=0,g[8]=O._x*O._z*Q-O._y,g[9]=O._y*O._z*Q+O._x,g[10]=O._z*O._z*Q+K,g[11]=0}g[12]=0,g[13]=0,g[14]=0,g[15]=1,j.markAsUpdated()},Z.RotationYawPitchRoll=function(M,j,K){var b=new Z;return Z.RotationYawPitchRollToRef(M,j,K,b),b},Z.RotationYawPitchRollToRef=function(Z,M,j,K){a.RotationYawPitchRollToRef(Z,M,j,V.Quaternion[0]),V.Quaternion[0].toRotationMatrix(K)},Z.Scaling=function(M,j,K){var b=new Z;return Z.ScalingToRef(M,j,K,b),b},Z.ScalingToRef=function(M,j,K,b){Z.FromValuesToRef(M,0,0,0,0,j,0,0,0,0,K,0,0,0,0,1,b),b._updateIdentityStatus(1===M&&1===j&&1===K)},Z.Translation=function(M,j,K){var b=new Z;return Z.TranslationToRef(M,j,K,b),b},Z.TranslationToRef=function(M,j,K,b){Z.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,M,j,K,1,b),b._updateIdentityStatus(0===M&&0===j&&0===K)},Z.Lerp=function(M,j,K){var b=new Z;return Z.LerpToRef(M,j,K,b),b},Z.LerpToRef=function(Z,M,j,K){for(var b=K._m,g=Z.m,O=M.m,Q=0;Q<16;Q++)b[Q]=g[Q]*(1-j)+O[Q]*j;K.markAsUpdated()},Z.DecomposeLerp=function(M,j,K){var b=new Z;return Z.DecomposeLerpToRef(M,j,K,b),b},Z.DecomposeLerpToRef=function(M,j,K,b){var g=V.Vector3[0],O=V.Quaternion[0],Q=V.Vector3[1];M.decompose(g,O,Q);var Y=V.Vector3[2],I=V.Quaternion[1],E=V.Vector3[3];j.decompose(Y,I,E);var i=V.Vector3[4];s.LerpToRef(g,Y,K,i);var z=V.Quaternion[2];a.SlerpToRef(O,I,K,z);var o=V.Vector3[5];s.LerpToRef(Q,E,K,o),Z.ComposeToRef(i,z,o,b)},Z.LookAtLH=function(M,j,K){var b=new Z;return Z.LookAtLHToRef(M,j,K,b),b},Z.LookAtLHToRef=function(M,j,K,b){var g=V.Vector3[0],O=V.Vector3[1],Q=V.Vector3[2];j.subtractToRef(M,Q),Q.normalize(),s.CrossToRef(K,Q,g);var Y=g.lengthSquared();0===Y?g.x=1:g.normalizeFromLength(Math.sqrt(Y)),s.CrossToRef(Q,g,O),O.normalize();var I=-s.Dot(g,M),E=-s.Dot(O,M),i=-s.Dot(Q,M);Z.FromValuesToRef(g._x,O._x,Q._x,0,g._y,O._y,Q._y,0,g._z,O._z,Q._z,0,I,E,i,1,b)},Z.LookAtRH=function(M,j,K){var b=new Z;return Z.LookAtRHToRef(M,j,K,b),b},Z.LookAtRHToRef=function(M,j,K,b){var g=V.Vector3[0],O=V.Vector3[1],Q=V.Vector3[2];M.subtractToRef(j,Q),Q.normalize(),s.CrossToRef(K,Q,g);var Y=g.lengthSquared();0===Y?g.x=1:g.normalizeFromLength(Math.sqrt(Y)),s.CrossToRef(Q,g,O),O.normalize();var I=-s.Dot(g,M),E=-s.Dot(O,M),i=-s.Dot(Q,M);Z.FromValuesToRef(g._x,O._x,Q._x,0,g._y,O._y,Q._y,0,g._z,O._z,Q._z,0,I,E,i,1,b)},Z.LookDirectionLH=function(M,j){var K=new Z;return Z.LookDirectionLHToRef(M,j,K),K},Z.LookDirectionLHToRef=function(M,j,K){var b=V.Vector3[0];b.copyFrom(M),b.scaleInPlace(-1);var g=V.Vector3[1];s.CrossToRef(j,b,g),Z.FromValuesToRef(g._x,g._y,g._z,0,j._x,j._y,j._z,0,b._x,b._y,b._z,0,0,0,0,1,K)},Z.LookDirectionRH=function(M,j){var K=new Z;return Z.LookDirectionRHToRef(M,j,K),K},Z.LookDirectionRHToRef=function(M,j,K){var b=V.Vector3[2];s.CrossToRef(j,M,b),Z.FromValuesToRef(b._x,b._y,b._z,0,j._x,j._y,j._z,0,M._x,M._y,M._z,0,0,0,0,1,K)},Z.OrthoLH=function(M,j,K,b,g){var O=new Z;return Z.OrthoLHToRef(M,j,K,b,O,g),O},Z.OrthoLHToRef=function(M,j,K,b,g,O){var Q=2/M,Y=2/j,I=2/(b-K),E=-(b+K)/(b-K);Z.FromValuesToRef(Q,0,0,0,0,Y,0,0,0,0,I,0,0,0,E,1,g),O&&g.multiplyToRef(c,g),g._updateIdentityStatus(1===Q&&1===Y&&1===I&&0===E)},Z.OrthoOffCenterLH=function(M,j,K,b,g,O,Q){var Y=new Z;return Z.OrthoOffCenterLHToRef(M,j,K,b,g,O,Y,Q),Y},Z.OrthoOffCenterLHToRef=function(M,j,K,b,g,O,Q,Y){var I=2/(j-M),E=2/(b-K),s=2/(O-g),i=-(O+g)/(O-g),a=(M+j)/(M-j),z=(b+K)/(K-b);Z.FromValuesToRef(I,0,0,0,0,E,0,0,0,0,s,0,a,z,i,1,Q),Y&&Q.multiplyToRef(c,Q),Q.markAsUpdated()},Z.OrthoOffCenterRH=function(M,j,K,b,g,O,Q){var Y=new Z;return Z.OrthoOffCenterRHToRef(M,j,K,b,g,O,Y,Q),Y},Z.OrthoOffCenterRHToRef=function(M,j,K,b,g,O,Q,Y){Z.OrthoOffCenterLHToRef(M,j,K,b,g,O,Q,Y),Q._m[10]*=-1},Z.PerspectiveLH=function(M,j,K,b,g,O){void 0===O&&(O=0);var Q=new Z,Y=2*K/M,I=2*K/j,E=(b+K)/(b-K),s=-2*b*K/(b-K),i=Math.tan(O);return Z.FromValuesToRef(Y,0,0,0,0,I,0,i,0,0,E,1,0,0,s,0,Q),g&&Q.multiplyToRef(c,Q),Q._updateIdentityStatus(!1),Q},Z.PerspectiveFovLH=function(M,j,K,b,g,O,Q){void 0===O&&(O=0),void 0===Q&&(Q=!1);var Y=new Z;return Z.PerspectiveFovLHToRef(M,j,K,b,Y,!0,g,O,Q),Y},Z.PerspectiveFovLHToRef=function(M,j,K,b,g,O,Q,Y,I){void 0===O&&(O=!0),void 0===Y&&(Y=0),void 0===I&&(I=!1);var E=K,s=b,i=1/Math.tan(.5*M),a=O?i/j:i,z=O?i:i*j,V=I&&0===E?-1:0!==s?(s+E)/(s-E):1,o=I&&0===E?2*s:0!==s?-2*s*E/(s-E):-2*E,G=Math.tan(Y);Z.FromValuesToRef(a,0,0,0,0,z,0,G,0,0,V,1,0,0,o,0,g),Q&&g.multiplyToRef(c,g),g._updateIdentityStatus(!1)},Z.PerspectiveFovReverseLHToRef=function(M,j,K,b,g,O,Q,Y){void 0===O&&(O=!0),void 0===Y&&(Y=0);var I=1/Math.tan(.5*M),E=O?I/j:I,s=O?I:I*j,i=Math.tan(Y);Z.FromValuesToRef(E,0,0,0,0,s,0,i,0,0,-K,1,0,0,1,0,g),Q&&g.multiplyToRef(c,g),g._updateIdentityStatus(!1)},Z.PerspectiveFovRH=function(M,j,K,b,g,O,Q){void 0===O&&(O=0),void 0===Q&&(Q=!1);var Y=new Z;return Z.PerspectiveFovRHToRef(M,j,K,b,Y,!0,g,O,Q),Y},Z.PerspectiveFovRHToRef=function(M,j,K,b,g,O,Q,Y,I){void 0===O&&(O=!0),void 0===Y&&(Y=0),void 0===I&&(I=!1);var E=K,s=b,i=1/Math.tan(.5*M),a=O?i/j:i,z=O?i:i*j,V=I&&0===E?1:0!==s?-(s+E)/(s-E):-1,o=I&&0===E?2*s:0!==s?-2*s*E/(s-E):-2*E,G=Math.tan(Y);Z.FromValuesToRef(a,0,0,0,0,z,0,G,0,0,V,-1,0,0,o,0,g),Q&&g.multiplyToRef(c,g),g._updateIdentityStatus(!1)},Z.PerspectiveFovReverseRHToRef=function(M,j,K,b,g,O,Q,Y){void 0===O&&(O=!0),void 0===Y&&(Y=0);var I=1/Math.tan(.5*M),E=O?I/j:I,s=O?I:I*j,i=Math.tan(Y);Z.FromValuesToRef(E,0,0,0,0,s,0,i,0,0,-K,-1,0,0,-1,0,g),Q&&g.multiplyToRef(c,g),g._updateIdentityStatus(!1)},Z.PerspectiveFovWebVRToRef=function(Z,M,j,K,b,g,O){void 0===b&&(b=!1),void 0===O&&(O=0);var Q=b?-1:1,Y=Math.tan(Z.upDegrees*Math.PI/180),I=Math.tan(Z.downDegrees*Math.PI/180),E=Math.tan(Z.leftDegrees*Math.PI/180),s=Math.tan(Z.rightDegrees*Math.PI/180),i=2/(E+s),a=2/(Y+I),z=Math.tan(O),V=K._m;V[0]=i,V[1]=V[2]=V[3]=V[4]=0,V[5]=a,V[6]=0,V[7]=z,V[8]=(E-s)*i*.5,V[9]=-(Y-I)*a*.5,V[10]=-j/(M-j),V[11]=1*Q,V[12]=V[13]=V[15]=0,V[14]=-2*j*M/(j-M),g&&K.multiplyToRef(c,K),K.markAsUpdated()},Z.GetFinalMatrix=function(M,j,K,b,g,O){var Q=M.width,Y=M.height,I=M.x,E=M.y,s=Z.FromValues(Q/2,0,0,0,0,-Y/2,0,0,0,0,O-g,0,I+Q/2,Y/2+E,g,1),i=V.Matrix[0];return j.multiplyToRef(K,i),i.multiplyToRef(b,i),i.multiply(s)},Z.GetAsMatrix2x2=function(Z){var M=Z.m,j=[M[0],M[1],M[4],M[5]];return Q.d.MatrixUse64Bits?j:new Float32Array(j)},Z.GetAsMatrix3x3=function(Z){var M=Z.m,j=[M[0],M[1],M[2],M[4],M[5],M[6],M[8],M[9],M[10]];return Q.d.MatrixUse64Bits?j:new Float32Array(j)},Z.Transpose=function(M){var j=new Z;return Z.TransposeToRef(M,j),j},Z.TransposeToRef=function(Z,M){var j=M._m,K=Z.m;j[0]=K[0],j[1]=K[4],j[2]=K[8],j[3]=K[12],j[4]=K[1],j[5]=K[5],j[6]=K[9],j[7]=K[13],j[8]=K[2],j[9]=K[6],j[10]=K[10],j[11]=K[14],j[12]=K[3],j[13]=K[7],j[14]=K[11],j[15]=K[15],M.markAsUpdated(),M._updateIdentityStatus(Z._isIdentity,Z._isIdentityDirty)},Z.Reflection=function(M){var j=new Z;return Z.ReflectionToRef(M,j),j},Z.ReflectionToRef=function(M,j){M.normalize();var K=M.normal.x,b=M.normal.y,g=M.normal.z,O=-2*K,Q=-2*b,Y=-2*g;Z.FromValuesToRef(O*K+1,Q*K,Y*K,0,O*b,Q*b+1,Y*b,0,O*g,Q*g,Y*g+1,0,O*M.d,Q*M.d,Y*M.d,1,j)},Z.FromXYZAxesToRef=function(M,j,K,b){Z.FromValuesToRef(M._x,M._y,M._z,0,j._x,j._y,j._z,0,K._x,K._y,K._z,0,0,0,0,1,b)},Z.FromQuaternionToRef=function(Z,M){var j=Z._x*Z._x,K=Z._y*Z._y,b=Z._z*Z._z,g=Z._x*Z._y,O=Z._z*Z._w,Q=Z._z*Z._x,Y=Z._y*Z._w,I=Z._y*Z._z,E=Z._x*Z._w;M._m[0]=1-2*(K+b),M._m[1]=2*(g+O),M._m[2]=2*(Q-Y),M._m[3]=0,M._m[4]=2*(g-O),M._m[5]=1-2*(b+j),M._m[6]=2*(I+E),M._m[7]=0,M._m[8]=2*(Q+Y),M._m[9]=2*(I-E),M._m[10]=1-2*(K+j),M._m[11]=0,M._m[12]=0,M._m[13]=0,M._m[14]=0,M._m[15]=1,M.markAsUpdated()},Z._UpdateFlagSeed=0,Z._IdentityReadOnly=Z.Identity(),Z}(),V=function(){function Z(){}return Z.Vector3=g.e.BuildTuple(11,s.Zero),Z.Matrix=g.e.BuildTuple(2,z.Identity),Z.Quaternion=g.e.BuildTuple(3,a.Zero),Z}(),o=function(){function Z(){}return Z.Vector2=g.e.BuildTuple(3,E.Zero),Z.Vector3=g.e.BuildTuple(13,s.Zero),Z.Vector4=g.e.BuildTuple(3,i.Zero),Z.Quaternion=g.e.BuildTuple(2,a.Zero),Z.Matrix=g.e.BuildTuple(8,z.Identity),Z}();(0,O.c)("BABYLON.Vector2",E),(0,O.c)("BABYLON.Vector3",s),(0,O.c)("BABYLON.Vector4",i),(0,O.c)("BABYLON.Matrix",z);var c=z.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},91135:function(Z,M,j){"use strict";j.d(M,{d:function(){return b}});var K=j(80105),b=(function(){function Z(Z,M){void 0===Z&&(Z=K.k.Zero()),void 0===M&&(M=K.k.Up()),this.position=Z,this.normal=M}Z.prototype.clone=function(){return new Z(this.position.clone(),this.normal.clone())}}(),function(){function Z(Z,M,j){void 0===Z&&(Z=K.k.Zero()),void 0===M&&(M=K.k.Up()),void 0===j&&(j=K.h.Zero()),this.position=Z,this.normal=M,this.uv=j}return Z.prototype.clone=function(){return new Z(this.position.clone(),this.normal.clone(),this.uv.clone())},Z}())},57278:function(Z,M,j){"use strict";j.d(M,{b:function(){return K}});var K=function(){function Z(Z,M,j,K){this.x=Z,this.y=M,this.width=j,this.height=K}return Z.prototype.toGlobal=function(M,j){return new Z(this.x*M,this.y*j,this.width*M,this.height*j)},Z.prototype.toGlobalToRef=function(Z,M,j){return j.x=this.x*Z,j.y=this.y*M,j.width=this.width*Z,j.height=this.height*M,this},Z.prototype.clone=function(){return new Z(this.x,this.y,this.width,this.height)},Z}()},37094:function(Z,M,j){"use strict";j.d(M,{c:function(){return I},f:function(){return E}});var K=j(80105),b=j(39578),g=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],O=[function(){return 1},function(Z){return Z.y},function(Z){return Z.z},function(Z){return Z.x},function(Z){return Z.x*Z.y},function(Z){return Z.y*Z.z},function(Z){return 3*Z.z*Z.z-1},function(Z){return Z.x*Z.z},function(Z){return Z.x*Z.x-Z.y*Z.y}],Q=function(Z,M){return g[Z]*O[Z](M)},Y=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],I=function(){function Z(){this.preScaled=!1,this.l00=K.k.Zero(),this.l1_1=K.k.Zero(),this.l10=K.k.Zero(),this.l11=K.k.Zero(),this.l2_2=K.k.Zero(),this.l2_1=K.k.Zero(),this.l20=K.k.Zero(),this.l21=K.k.Zero(),this.l22=K.k.Zero()}return Z.prototype.addLight=function(Z,M,j){b.o.Vector3[0].set(M.r,M.g,M.b);var K=b.o.Vector3[0],g=b.o.Vector3[1];K.scaleToRef(j,g),g.scaleToRef(Q(0,Z),b.o.Vector3[2]),this.l00.addInPlace(b.o.Vector3[2]),g.scaleToRef(Q(1,Z),b.o.Vector3[2]),this.l1_1.addInPlace(b.o.Vector3[2]),g.scaleToRef(Q(2,Z),b.o.Vector3[2]),this.l10.addInPlace(b.o.Vector3[2]),g.scaleToRef(Q(3,Z),b.o.Vector3[2]),this.l11.addInPlace(b.o.Vector3[2]),g.scaleToRef(Q(4,Z),b.o.Vector3[2]),this.l2_2.addInPlace(b.o.Vector3[2]),g.scaleToRef(Q(5,Z),b.o.Vector3[2]),this.l2_1.addInPlace(b.o.Vector3[2]),g.scaleToRef(Q(6,Z),b.o.Vector3[2]),this.l20.addInPlace(b.o.Vector3[2]),g.scaleToRef(Q(7,Z),b.o.Vector3[2]),this.l21.addInPlace(b.o.Vector3[2]),g.scaleToRef(Q(8,Z),b.o.Vector3[2]),this.l22.addInPlace(b.o.Vector3[2])},Z.prototype.scaleInPlace=function(Z){this.l00.scaleInPlace(Z),this.l1_1.scaleInPlace(Z),this.l10.scaleInPlace(Z),this.l11.scaleInPlace(Z),this.l2_2.scaleInPlace(Z),this.l2_1.scaleInPlace(Z),this.l20.scaleInPlace(Z),this.l21.scaleInPlace(Z),this.l22.scaleInPlace(Z)},Z.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(Y[0]),this.l1_1.scaleInPlace(Y[1]),this.l10.scaleInPlace(Y[2]),this.l11.scaleInPlace(Y[3]),this.l2_2.scaleInPlace(Y[4]),this.l2_1.scaleInPlace(Y[5]),this.l20.scaleInPlace(Y[6]),this.l21.scaleInPlace(Y[7]),this.l22.scaleInPlace(Y[8])},Z.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},Z.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(g[0]),this.l1_1.scaleInPlace(g[1]),this.l10.scaleInPlace(g[2]),this.l11.scaleInPlace(g[3]),this.l2_2.scaleInPlace(g[4]),this.l2_1.scaleInPlace(g[5]),this.l20.scaleInPlace(g[6]),this.l21.scaleInPlace(g[7]),this.l22.scaleInPlace(g[8])},Z.prototype.updateFromArray=function(Z){return K.k.FromArrayToRef(Z[0],0,this.l00),K.k.FromArrayToRef(Z[1],0,this.l1_1),K.k.FromArrayToRef(Z[2],0,this.l10),K.k.FromArrayToRef(Z[3],0,this.l11),K.k.FromArrayToRef(Z[4],0,this.l2_2),K.k.FromArrayToRef(Z[5],0,this.l2_1),K.k.FromArrayToRef(Z[6],0,this.l20),K.k.FromArrayToRef(Z[7],0,this.l21),K.k.FromArrayToRef(Z[8],0,this.l22),this},Z.prototype.updateFromFloatsArray=function(Z){return K.k.FromFloatsToRef(Z[0],Z[1],Z[2],this.l00),K.k.FromFloatsToRef(Z[3],Z[4],Z[5],this.l1_1),K.k.FromFloatsToRef(Z[6],Z[7],Z[8],this.l10),K.k.FromFloatsToRef(Z[9],Z[10],Z[11],this.l11),K.k.FromFloatsToRef(Z[12],Z[13],Z[14],this.l2_2),K.k.FromFloatsToRef(Z[15],Z[16],Z[17],this.l2_1),K.k.FromFloatsToRef(Z[18],Z[19],Z[20],this.l20),K.k.FromFloatsToRef(Z[21],Z[22],Z[23],this.l21),K.k.FromFloatsToRef(Z[24],Z[25],Z[26],this.l22),this},Z.FromArray=function(M){return(new Z).updateFromArray(M)},Z.FromPolynomial=function(M){var j=new Z;return j.l00=M.xx.scale(.376127).add(M.yy.scale(.376127)).add(M.zz.scale(.376126)),j.l1_1=M.y.scale(.977204),j.l10=M.z.scale(.977204),j.l11=M.x.scale(.977204),j.l2_2=M.xy.scale(1.16538),j.l2_1=M.yz.scale(1.16538),j.l20=M.zz.scale(1.34567).subtract(M.xx.scale(.672834)).subtract(M.yy.scale(.672834)),j.l21=M.zx.scale(1.16538),j.l22=M.xx.scale(1.16538).subtract(M.yy.scale(1.16538)),j.l1_1.scaleInPlace(-1),j.l11.scaleInPlace(-1),j.l2_1.scaleInPlace(-1),j.l21.scaleInPlace(-1),j.scaleInPlace(Math.PI),j},Z}(),E=function(){function Z(){this.x=K.k.Zero(),this.y=K.k.Zero(),this.z=K.k.Zero(),this.xx=K.k.Zero(),this.yy=K.k.Zero(),this.zz=K.k.Zero(),this.xy=K.k.Zero(),this.yz=K.k.Zero(),this.zx=K.k.Zero()}return Object.defineProperty(Z.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=I.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!1,configurable:!0}),Z.prototype.addAmbient=function(Z){b.o.Vector3[0].copyFromFloats(Z.r,Z.g,Z.b);var M=b.o.Vector3[0];this.xx.addInPlace(M),this.yy.addInPlace(M),this.zz.addInPlace(M)},Z.prototype.scaleInPlace=function(Z){this.x.scaleInPlace(Z),this.y.scaleInPlace(Z),this.z.scaleInPlace(Z),this.xx.scaleInPlace(Z),this.yy.scaleInPlace(Z),this.zz.scaleInPlace(Z),this.yz.scaleInPlace(Z),this.zx.scaleInPlace(Z),this.xy.scaleInPlace(Z)},Z.prototype.updateFromHarmonics=function(Z){return this._harmonics=Z,this.x.copyFrom(Z.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(Z.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(Z.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(Z.l00),b.o.Vector3[0].copyFrom(Z.l20).scaleInPlace(.247708),b.o.Vector3[1].copyFrom(Z.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(b.o.Vector3[0]).addInPlace(b.o.Vector3[1]),this.yy.copyFrom(Z.l00),this.yy.scaleInPlace(.886277).subtractInPlace(b.o.Vector3[0]).subtractInPlace(b.o.Vector3[1]),this.zz.copyFrom(Z.l00),b.o.Vector3[0].copyFrom(Z.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(b.o.Vector3[0]),this.yz.copyFrom(Z.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(Z.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(Z.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this},Z.FromHarmonics=function(M){return(new Z).updateFromHarmonics(M)},Z.FromArray=function(M){var j=new Z;return K.k.FromArrayToRef(M[0],0,j.x),K.k.FromArrayToRef(M[1],0,j.y),K.k.FromArrayToRef(M[2],0,j.z),K.k.FromArrayToRef(M[3],0,j.xx),K.k.FromArrayToRef(M[4],0,j.yy),K.k.FromArrayToRef(M[5],0,j.zz),K.k.FromArrayToRef(M[6],0,j.yz),K.k.FromArrayToRef(M[7],0,j.zx),K.k.FromArrayToRef(M[8],0,j.xy),j},Z}()},64400:function(Z,M,j){"use strict";j.d(M,{b:function(){return E},d:function(){return I}});var K=j(80105),b=j(9488),g=j(65847),O=j(85779),Q=j(20334);function Y(Z){var M,j=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],g=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],Y=[],I=Z.width||Z.size||1,E=Z.height||Z.size||1,s=Z.depth||Z.size||1,i=Z.wrap||!1,a=void 0===Z.topBaseAt?1:Z.topBaseAt,z=void 0===Z.bottomBaseAt?0:Z.bottomBaseAt,V=[2,0,3,1][a=(a+4)%4],o=[2,0,1,3][z=(z+4)%4],c=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(i){j=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],c=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var G=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],f=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],X=[17,18,19,16],d=[22,23,20,21];V>0;)G.unshift(G.pop()),X.unshift(X.pop()),V--;for(;o>0;)f.unshift(f.pop()),d.unshift(d.pop()),o--;G=G.flat(),f=f.flat(),c=c.concat(G).concat(f),j.push(X[0],X[2],X[3],X[0],X[1],X[2]),j.push(d[0],d[2],d[3],d[0],d[1],d[2])}var W=[I/2,E/2,s/2];M=c.reduce((function(Z,M,j){return Z.concat(M*W[j%3])}),[]);for(var A=0===Z.sideOrientation?0:Z.sideOrientation||O.e.DEFAULTSIDE,q=Z.faceUV||new Array(6),T=Z.faceColors,B=[],N=0;N<6;N++)void 0===q[N]&&(q[N]=new K.l(0,0,1,1)),T&&void 0===T[N]&&(T[N]=new b.g(1,1,1,1));for(var U=0;U<6;U++)if(Y.push(q[U].z,Q.e.UseOpenGLOrientationForUV?1-q[U].w:q[U].w),Y.push(q[U].x,Q.e.UseOpenGLOrientationForUV?1-q[U].w:q[U].w),Y.push(q[U].x,Q.e.UseOpenGLOrientationForUV?1-q[U].y:q[U].y),Y.push(q[U].z,Q.e.UseOpenGLOrientationForUV?1-q[U].y:q[U].y),T)for(var n=0;n<4;n++)B.push(T[U].r,T[U].g,T[U].b,T[U].a);O.e._ComputeSides(A,M,j,g,Y,Z.frontUVs,Z.backUVs);var k=new O.e;if(k.indices=j,k.positions=M,k.normals=g,k.uvs=Y,T){var x=A===O.e.DOUBLESIDE?B.concat(B):B;k.colors=x}return k}function I(Z,M,j){void 0===M&&(M={}),void 0===j&&(j=null);var K=new g.b(Z,j);return M.sideOrientation=g.b._GetDefaultSideOrientation(M.sideOrientation),K._originalBuilderSideOrientation=M.sideOrientation,Y(M).applyToMesh(K,M.updatable),K}var E={CreateBox:I};O.e.CreateBox=Y,g.b.CreateBox=function(Z,M,j,K,b){return void 0===j&&(j=null),I(Z,{size:M,sideOrientation:b,updatable:K},j)}},60612:function(Z,M,j){"use strict";j.d(M,{b:function(){return Q}});var K=j(65847),b=j(85779),g=j(20334);function O(Z){var M=new Array,j=new Array,K=new Array,O=new Array,Q=Z.radius||.5,Y=Z.tessellation||64,I=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,E=0===Z.sideOrientation?0:Z.sideOrientation||b.e.DEFAULTSIDE;M.push(0,0,0),O.push(.5,.5);for(var s=2*Math.PI*I,i=1===I?s/Y:s/(Y-1),a=0,z=0;z<Y;z++){var V=Math.cos(a),o=Math.sin(a),c=(V+1)/2,G=(1-o)/2;M.push(Q*V,Q*o,0),O.push(c,g.e.UseOpenGLOrientationForUV?1-G:G),a+=i}1===I&&(M.push(M[3],M[4],M[5]),O.push(O[2],g.e.UseOpenGLOrientationForUV?1-O[3]:O[3]));for(var f=M.length/3,X=1;X<f-1;X++)j.push(X+1,0,X);b.e.ComputeNormals(M,j,K),b.e._ComputeSides(E,M,j,K,O,Z.frontUVs,Z.backUVs);var d=new b.e;return d.indices=j,d.positions=M,d.normals=K,d.uvs=O,d}function Q(Z,M,j){void 0===M&&(M={}),void 0===j&&(j=null);var b=new K.b(Z,j);return M.sideOrientation=K.b._GetDefaultSideOrientation(M.sideOrientation),b._originalBuilderSideOrientation=M.sideOrientation,O(M).applyToMesh(b,M.updatable),b}b.e.CreateDisc=O,K.b.CreateDisc=function(Z,M,j,K,b,g){return void 0===K&&(K=null),Q(Z,{radius:M,tessellation:j,sideOrientation:g,updatable:b},K)}},55706:function(Z,M,j){"use strict";j.d(M,{b:function(){return x},f:function(){return n},g:function(){return k}});var K=j(80105),b=j(65847),g=j(85779),O=j(40061),Q=j(9488),Y=j(43251),I=j(35941),E=j(46907),s=j(9892),i=j(70937),a=j(33048),z=j(31709),V=j(54497),o=j(67935),c=j(29553),G=j(78588),f={effect:null,subMesh:null},X=function(Z){function M(M,j,b,g,Q){void 0===g&&(g={}),void 0===Q&&(Q=!0);var Y=Z.call(this,M,j,Q)||this;return Y._textures={},Y._textureArrays={},Y._externalTextures={},Y._floats={},Y._ints={},Y._floatsArrays={},Y._colors3={},Y._colors3Arrays={},Y._colors4={},Y._colors4Arrays={},Y._vectors2={},Y._vectors3={},Y._vectors4={},Y._quaternions={},Y._quaternionsArrays={},Y._matrices={},Y._matrixArrays={},Y._matrices3x3={},Y._matrices2x2={},Y._vectors2Arrays={},Y._vectors3Arrays={},Y._vectors4Arrays={},Y._uniformBuffers={},Y._textureSamplers={},Y._storageBuffers={},Y._cachedWorldViewMatrix=new K.c,Y._cachedWorldViewProjectionMatrix=new K.c,Y._multiview=!1,Y._shaderPath=b,Y._options=(0,O.e)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1},g),Y}return(0,O.m)(M,Z),Object.defineProperty(M.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(Z){this._shaderPath=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"ShaderMaterial"},M.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},M.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},M.prototype._checkUniform=function(Z){-1===this._options.uniforms.indexOf(Z)&&this._options.uniforms.push(Z)},M.prototype.setTexture=function(Z,M){return-1===this._options.samplers.indexOf(Z)&&this._options.samplers.push(Z),this._textures[Z]=M,this},M.prototype.setTextureArray=function(Z,M){return-1===this._options.samplers.indexOf(Z)&&this._options.samplers.push(Z),this._checkUniform(Z),this._textureArrays[Z]=M,this},M.prototype.setExternalTexture=function(Z,M){return-1===this._options.externalTextures.indexOf(Z)&&this._options.externalTextures.push(Z),this._externalTextures[Z]=M,this},M.prototype.setFloat=function(Z,M){return this._checkUniform(Z),this._floats[Z]=M,this},M.prototype.setInt=function(Z,M){return this._checkUniform(Z),this._ints[Z]=M,this},M.prototype.setFloats=function(Z,M){return this._checkUniform(Z),this._floatsArrays[Z]=M,this},M.prototype.setColor3=function(Z,M){return this._checkUniform(Z),this._colors3[Z]=M,this},M.prototype.setColor3Array=function(Z,M){return this._checkUniform(Z),this._colors3Arrays[Z]=M.reduce((function(Z,M){return M.toArray(Z,Z.length),Z}),[]),this},M.prototype.setColor4=function(Z,M){return this._checkUniform(Z),this._colors4[Z]=M,this},M.prototype.setColor4Array=function(Z,M){return this._checkUniform(Z),this._colors4Arrays[Z]=M.reduce((function(Z,M){return M.toArray(Z,Z.length),Z}),[]),this},M.prototype.setVector2=function(Z,M){return this._checkUniform(Z),this._vectors2[Z]=M,this},M.prototype.setVector3=function(Z,M){return this._checkUniform(Z),this._vectors3[Z]=M,this},M.prototype.setVector4=function(Z,M){return this._checkUniform(Z),this._vectors4[Z]=M,this},M.prototype.setQuaternion=function(Z,M){return this._checkUniform(Z),this._quaternions[Z]=M,this},M.prototype.setQuaternionArray=function(Z,M){return this._checkUniform(Z),this._quaternionsArrays[Z]=M.reduce((function(Z,M){return M.toArray(Z,Z.length),Z}),[]),this},M.prototype.setMatrix=function(Z,M){return this._checkUniform(Z),this._matrices[Z]=M,this},M.prototype.setMatrices=function(Z,M){this._checkUniform(Z);for(var j=new Float32Array(16*M.length),K=0;K<M.length;K++){M[K].copyToArray(j,16*K)}return this._matrixArrays[Z]=j,this},M.prototype.setMatrix3x3=function(Z,M){return this._checkUniform(Z),this._matrices3x3[Z]=M,this},M.prototype.setMatrix2x2=function(Z,M){return this._checkUniform(Z),this._matrices2x2[Z]=M,this},M.prototype.setArray2=function(Z,M){return this._checkUniform(Z),this._vectors2Arrays[Z]=M,this},M.prototype.setArray3=function(Z,M){return this._checkUniform(Z),this._vectors3Arrays[Z]=M,this},M.prototype.setArray4=function(Z,M){return this._checkUniform(Z),this._vectors4Arrays[Z]=M,this},M.prototype.setUniformBuffer=function(Z,M){return-1===this._options.uniformBuffers.indexOf(Z)&&this._options.uniformBuffers.push(Z),this._uniformBuffers[Z]=M,this},M.prototype.setTextureSampler=function(Z,M){return-1===this._options.samplerObjects.indexOf(Z)&&this._options.samplerObjects.push(Z),this._textureSamplers[Z]=M,this},M.prototype.setStorageBuffer=function(Z,M){return-1===this._options.storageBuffers.indexOf(Z)&&this._options.storageBuffers.push(Z),this._storageBuffers[Z]=M,this},M.prototype.isReadyForSubMesh=function(Z,M,j){return this.isReady(Z,j,M)},M.prototype.isReady=function(Z,M,j){var K,b,g,O,Q=j&&this._storeEffectOnSubMeshes;if(this.isFrozen)if(Q){if(j.effect&&j.effect._wasPreviouslyReady)return!0}else{var I=this._drawWrapper.effect;if(I&&I._wasPreviouslyReady&&I._wasPreviouslyUsingInstances===M)return!0}var E=this.getScene(),s=E.getEngine(),i=[],z=[],o=new V.b,c=this._shaderPath,G=this._options.uniforms,X=this._options.uniformBuffers,d=this._options.samplers;s.getCaps().multiview&&E.activeCamera&&E.activeCamera.outputRenderTarget&&E.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,i.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.indexOf("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(var W=0;W<this._options.defines.length;W++){var A=0===this._options.defines[W].indexOf("#define")?this._options.defines[W]:"#define ".concat(this._options.defines[W]);i.push(A)}for(W=0;W<this._options.attributes.length;W++)z.push(this._options.attributes[W]);if(Z&&Z.isVerticesDataPresent(Y.f.ColorKind)&&(z.push(Y.f.ColorKind),i.push("#define VERTEXCOLOR")),M&&(i.push("#define INSTANCES"),a.b.PushAttributesForInstances(z),(null===Z||void 0===Z?void 0:Z.hasThinInstances)&&(i.push("#define THIN_INSTANCES"),Z&&Z.isVerticesDataPresent(Y.f.ColorInstanceKind)&&(z.push(Y.f.ColorInstanceKind),i.push("#define INSTANCESCOLOR")))),Z&&Z.useBones&&Z.computeBonesUsingShaders&&Z.skeleton){z.push(Y.f.MatricesIndicesKind),z.push(Y.f.MatricesWeightsKind),Z.numBoneInfluencers>4&&(z.push(Y.f.MatricesIndicesExtraKind),z.push(Y.f.MatricesWeightsExtraKind));var q=Z.skeleton;i.push("#define NUM_BONE_INFLUENCERS "+Z.numBoneInfluencers),o.addCPUSkinningFallback(0,Z),q.isUsingTextureForMatrices?(i.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(i.push("#define BonesPerMesh "+(q.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else i.push("#define NUM_BONE_INFLUENCERS 0");var T=0,B=Z?Z.morphTargetManager:null;if(B){var N=B.supportsUVs&&-1!==i.indexOf("#define UV1"),U=B.supportsTangents&&-1!==i.indexOf("#define TANGENT"),n=B.supportsNormals&&-1!==i.indexOf("#define NORMAL");T=B.numInfluencers,N&&i.push("#define MORPHTARGETS_UV"),U&&i.push("#define MORPHTARGETS_TANGENT"),n&&i.push("#define MORPHTARGETS_NORMAL"),T>0&&i.push("#define MORPHTARGETS"),B.isUsingTextureForTargets&&(i.push("#define MORPHTARGETS_TEXTURE"),-1===this._options.uniforms.indexOf("morphTargetTextureIndices")&&this._options.uniforms.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),i.push("#define NUM_MORPH_INFLUENCERS "+T);for(W=0;W<T;W++)z.push(Y.f.PositionKind+W),n&&z.push(Y.f.NormalKind+W),U&&z.push(Y.f.TangentKind+W),N&&z.push(Y.f.UVKind+"_"+W);T>0&&((G=G.slice()).push("morphTargetInfluences"),G.push("morphTargetTextureInfo"),G.push("morphTargetTextureIndices"))}else i.push("#define NUM_MORPH_INFLUENCERS 0");if(Z){var k=Z.bakedVertexAnimationManager;k&&k.isEnabled&&(i.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===this._options.uniforms.indexOf("bakedVertexAnimationSettings")&&this._options.uniforms.push("bakedVertexAnimationSettings"),-1===this._options.uniforms.indexOf("bakedVertexAnimationTextureSizeInverted")&&this._options.uniforms.push("bakedVertexAnimationTextureSizeInverted"),-1===this._options.uniforms.indexOf("bakedVertexAnimationTime")&&this._options.uniforms.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),a.b.PrepareAttributesForBakedVertexAnimation(z,Z,i)}for(var x in this._textures)if(!this._textures[x].isReady())return!1;Z&&this._shouldTurnAlphaTestOn(Z)&&i.push("#define ALPHATEST"),(null===this._options.useClipPlane&&E.clipPlane||this._options.useClipPlane)&&(i.push("#define CLIPPLANE"),-1===G.indexOf("vClipPlane")&&G.push("vClipPlane")),(null===this._options.useClipPlane&&E.clipPlane2||this._options.useClipPlane)&&(i.push("#define CLIPPLANE2"),-1===G.indexOf("vClipPlane2")&&G.push("vClipPlane2")),(null===this._options.useClipPlane&&E.clipPlane3||this._options.useClipPlane)&&(i.push("#define CLIPPLANE3"),-1===G.indexOf("vClipPlane3")&&G.push("vClipPlane3")),(null===this._options.useClipPlane&&E.clipPlane4||this._options.useClipPlane)&&(i.push("#define CLIPPLANE4"),-1===G.indexOf("vClipPlane4")&&G.push("vClipPlane4")),(null===this._options.useClipPlane&&E.clipPlane5||this._options.useClipPlane)&&(i.push("#define CLIPPLANE5"),-1===G.indexOf("vClipPlane5")&&G.push("vClipPlane5")),(null===this._options.useClipPlane&&E.clipPlane6||this._options.useClipPlane)&&(i.push("#define CLIPPLANE6"),-1===G.indexOf("vClipPlane6")&&G.push("vClipPlane6")),this.customShaderNameResolve&&(G=G.slice(),X=X.slice(),d=d.slice(),c=this.customShaderNameResolve(c,G,X,d,i,z));var R=Q?j._getDrawWrapper():this._drawWrapper,e=null!==(K=null===R||void 0===R?void 0:R.effect)&&void 0!==K?K:null,u=null!==(b=null===R||void 0===R?void 0:R.defines)&&void 0!==b?b:null,F=i.join("\n"),C=e;return u!==F&&(C=s.createEffect(c,{attributes:z,uniformsNames:G,uniformBuffersNames:X,samplers:d,defines:F,fallbacks:o,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:T},shaderLanguage:this._options.shaderLanguage},s),Q?j.setEffect(C,F,this._materialContext):R&&R.setEffect(C,F),this._onEffectCreatedObservable&&(f.effect=C,f.subMesh=null!==(g=null!==j&&void 0!==j?j:null===Z||void 0===Z?void 0:Z.subMeshes[0])&&void 0!==g?g:null,this._onEffectCreatedObservable.notifyObservers(f))),C._wasPreviouslyUsingInstances=!!M,null!==(O=!(null===C||void 0===C?void 0:C.isReady()))&&void 0!==O&&!O&&(e!==C&&E.resetCachedMaterial(),C._wasPreviouslyReady=!0,!0)},M.prototype.bindOnlyWorldMatrix=function(Z,M){var j=this.getScene(),K=null!==M&&void 0!==M?M:this.getEffect();K&&(-1!==this._options.uniforms.indexOf("world")&&K.setMatrix("world",Z),-1!==this._options.uniforms.indexOf("worldView")&&(Z.multiplyToRef(j.getViewMatrix(),this._cachedWorldViewMatrix),K.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(Z.multiplyToRef(j.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),K.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},M.prototype.bindForSubMesh=function(Z,M,j){var K;this.bind(Z,M,null===(K=j._drawWrapperOverride)||void 0===K?void 0:K.effect,j)},M.prototype.bind=function(Z,M,j,K){var b,g=K&&this._storeEffectOnSubMeshes,O=null!==j&&void 0!==j?j:g?K.effect:this.getEffect();if(O){this._activeEffect=O,this.bindOnlyWorldMatrix(Z,j);var Q=this._options.uniformBuffers,Y=!1;if(O&&Q&&Q.length>0&&this.getScene().getEngine().supportsUniformBuffers)for(var I=0;I<Q.length;++I){switch(Q[I]){case"Mesh":M&&(M.getMeshUniformBuffer().bindToEffect(O,"Mesh"),M.transferToEffect(Z));break;case"Scene":a.b.BindSceneUniformBuffer(O,this.getScene().getSceneUniformBuffer()),this.getScene().finalizeSceneUbo(),Y=!0}}var E=M&&g?this._mustRebind(this.getScene(),O,M.visibility):this.getScene().getCachedMaterial()!==this;if(O&&E){var s;for(s in Y||-1===this._options.uniforms.indexOf("view")||O.setMatrix("view",this.getScene().getViewMatrix()),Y||-1===this._options.uniforms.indexOf("projection")||O.setMatrix("projection",this.getScene().getProjectionMatrix()),Y||-1===this._options.uniforms.indexOf("viewProjection")||(O.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&O.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&O.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),a.b.BindBonesParameters(M,O),a.b.BindClipPlane(O,this.getScene()),this._textures)O.setTexture(s,this._textures[s]);for(s in this._textureArrays)O.setTextureArray(s,this._textureArrays[s]);for(s in this._externalTextures)O.setExternalTexture(s,this._externalTextures[s]);for(s in this._ints)O.setInt(s,this._ints[s]);for(s in this._floats)O.setFloat(s,this._floats[s]);for(s in this._floatsArrays)O.setArray(s,this._floatsArrays[s]);for(s in this._colors3)O.setColor3(s,this._colors3[s]);for(s in this._colors3Arrays)O.setArray3(s,this._colors3Arrays[s]);for(s in this._colors4){var i=this._colors4[s];O.setFloat4(s,i.r,i.g,i.b,i.a)}for(s in this._colors4Arrays)O.setArray4(s,this._colors4Arrays[s]);for(s in this._vectors2)O.setVector2(s,this._vectors2[s]);for(s in this._vectors3)O.setVector3(s,this._vectors3[s]);for(s in this._vectors4)O.setVector4(s,this._vectors4[s]);for(s in this._quaternions)O.setQuaternion(s,this._quaternions[s]);for(s in this._matrices)O.setMatrix(s,this._matrices[s]);for(s in this._matrixArrays)O.setMatrices(s,this._matrixArrays[s]);for(s in this._matrices3x3)O.setMatrix3x3(s,this._matrices3x3[s]);for(s in this._matrices2x2)O.setMatrix2x2(s,this._matrices2x2[s]);for(s in this._vectors2Arrays)O.setArray2(s,this._vectors2Arrays[s]);for(s in this._vectors3Arrays)O.setArray3(s,this._vectors3Arrays[s]);for(s in this._vectors4Arrays)O.setArray4(s,this._vectors4Arrays[s]);for(s in this._quaternionsArrays)O.setArray4(s,this._quaternionsArrays[s]);for(s in this._uniformBuffers){var z=this._uniformBuffers[s].getBuffer();z&&O.bindUniformBuffer(z,s)}for(s in this._textureSamplers)O.setTextureSampler(s,this._textureSamplers[s]);for(s in this._storageBuffers)O.setStorageBuffer(s,this._storageBuffers[s])}if(O&&M&&(E||!this.isFrozen)){var V=M.morphTargetManager;V&&V.numInfluencers>0&&a.b.BindMorphTargetParameters(M,O);var o=M.bakedVertexAnimationManager;o&&o.isEnabled&&(null===(b=M.bakedVertexAnimationManager)||void 0===b||b.bind(O,!!O._wasPreviouslyUsingInstances))}this._afterBind(M,O)}},M.prototype.getActiveTextures=function(){var M=Z.prototype.getActiveTextures.call(this);for(var j in this._textures)M.push(this._textures[j]);for(var K in this._textureArrays)for(var b=this._textureArrays[K],g=0;g<b.length;g++)M.push(b[g]);return M},M.prototype.hasTexture=function(M){if(Z.prototype.hasTexture.call(this,M))return!0;for(var j in this._textures)if(this._textures[j]===M)return!0;for(var K in this._textureArrays)for(var b=this._textureArrays[K],g=0;g<b.length;g++)if(b[g]===M)return!0;return!1},M.prototype.clone=function(Z){var j=this,K=s.b.Clone((function(){return new M(Z,j.getScene(),j._shaderPath,j._options,j._storeEffectOnSubMeshes)}),this);for(var b in K.name=Z,K.id=Z,"object"===typeof K._shaderPath&&(K._shaderPath=(0,O.e)({},K._shaderPath)),this._options=(0,O.e)({},this._options),Object.keys(this._options).forEach((function(Z){var M=j._options[Z];Array.isArray(M)&&(j._options[Z]=M.slice(0))})),this.stencil.copyTo(K.stencil),this._textures)K.setTexture(b,this._textures[b]);for(var b in this._textureArrays)K.setTextureArray(b,this._textureArrays[b]);for(var b in this._externalTextures)K.setExternalTexture(b,this._externalTextures[b]);for(var b in this._ints)K.setInt(b,this._ints[b]);for(var b in this._floats)K.setFloat(b,this._floats[b]);for(var b in this._floatsArrays)K.setFloats(b,this._floatsArrays[b]);for(var b in this._colors3)K.setColor3(b,this._colors3[b]);for(var b in this._colors3Arrays)K._colors3Arrays[b]=this._colors3Arrays[b];for(var b in this._colors4)K.setColor4(b,this._colors4[b]);for(var b in this._colors4Arrays)K._colors4Arrays[b]=this._colors4Arrays[b];for(var b in this._vectors2)K.setVector2(b,this._vectors2[b]);for(var b in this._vectors3)K.setVector3(b,this._vectors3[b]);for(var b in this._vectors4)K.setVector4(b,this._vectors4[b]);for(var b in this._quaternions)K.setQuaternion(b,this._quaternions[b]);for(var b in this._quaternionsArrays)K._quaternionsArrays[b]=this._quaternionsArrays[b];for(var b in this._matrices)K.setMatrix(b,this._matrices[b]);for(var b in this._matrixArrays)K._matrixArrays[b]=this._matrixArrays[b].slice();for(var b in this._matrices3x3)K.setMatrix3x3(b,this._matrices3x3[b]);for(var b in this._matrices2x2)K.setMatrix2x2(b,this._matrices2x2[b]);for(var b in this._vectors2Arrays)K.setArray2(b,this._vectors2Arrays[b]);for(var b in this._vectors3Arrays)K.setArray3(b,this._vectors3Arrays[b]);for(var b in this._vectors4Arrays)K.setArray4(b,this._vectors4Arrays[b]);for(var b in this._uniformBuffers)K.setUniformBuffer(b,this._uniformBuffers[b]);for(var b in this._textureSamplers)K.setTextureSampler(b,this._textureSamplers[b]);for(var b in this._storageBuffers)K.setStorageBuffer(b,this._storageBuffers[b]);return K},M.prototype.dispose=function(M,j,K){if(j){var b;for(b in this._textures)this._textures[b].dispose();for(b in this._textureArrays)for(var g=this._textureArrays[b],O=0;O<g.length;O++)g[O].dispose()}this._textures={},Z.prototype.dispose.call(this,M,j,K)},M.prototype.serialize=function(){var Z,M=s.b.Serialize(this);for(Z in M.customType="BABYLON.ShaderMaterial",M.uniqueId=this.uniqueId,M.options=this._options,M.shaderPath=this._shaderPath,M.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,M.stencil=this.stencil.serialize(),M.textures={},this._textures)M.textures[Z]=this._textures[Z].serialize();for(Z in M.textureArrays={},this._textureArrays){M.textureArrays[Z]=[];for(var j=this._textureArrays[Z],K=0;K<j.length;K++)M.textureArrays[Z].push(j[K].serialize())}for(Z in M.ints={},this._ints)M.ints[Z]=this._ints[Z];for(Z in M.floats={},this._floats)M.floats[Z]=this._floats[Z];for(Z in M.FloatArrays={},this._floatsArrays)M.FloatArrays[Z]=this._floatsArrays[Z];for(Z in M.colors3={},this._colors3)M.colors3[Z]=this._colors3[Z].asArray();for(Z in M.colors3Arrays={},this._colors3Arrays)M.colors3Arrays[Z]=this._colors3Arrays[Z];for(Z in M.colors4={},this._colors4)M.colors4[Z]=this._colors4[Z].asArray();for(Z in M.colors4Arrays={},this._colors4Arrays)M.colors4Arrays[Z]=this._colors4Arrays[Z];for(Z in M.vectors2={},this._vectors2)M.vectors2[Z]=this._vectors2[Z].asArray();for(Z in M.vectors3={},this._vectors3)M.vectors3[Z]=this._vectors3[Z].asArray();for(Z in M.vectors4={},this._vectors4)M.vectors4[Z]=this._vectors4[Z].asArray();for(Z in M.quaternions={},this._quaternions)M.quaternions[Z]=this._quaternions[Z].asArray();for(Z in M.matrices={},this._matrices)M.matrices[Z]=this._matrices[Z].asArray();for(Z in M.matrixArray={},this._matrixArrays)M.matrixArray[Z]=this._matrixArrays[Z];for(Z in M.matrices3x3={},this._matrices3x3)M.matrices3x3[Z]=this._matrices3x3[Z];for(Z in M.matrices2x2={},this._matrices2x2)M.matrices2x2[Z]=this._matrices2x2[Z];for(Z in M.vectors2Arrays={},this._vectors2Arrays)M.vectors2Arrays[Z]=this._vectors2Arrays[Z];for(Z in M.vectors3Arrays={},this._vectors3Arrays)M.vectors3Arrays[Z]=this._vectors3Arrays[Z];for(Z in M.vectors4Arrays={},this._vectors4Arrays)M.vectors4Arrays[Z]=this._vectors4Arrays[Z];for(Z in M.quaternionsArrays={},this._quaternionsArrays)M.quaternionsArrays[Z]=this._quaternionsArrays[Z];return M},M.Parse=function(Z,j,b){var g,O=s.b.Parse((function(){return new M(Z.name,j,Z.shaderPath,Z.options,Z.storeEffectOnSubMeshes)}),Z,j,b);for(g in Z.stencil&&O.stencil.parse(Z.stencil,j,b),Z.textures)O.setTexture(g,i.b.Parse(Z.textures[g],j,b));for(g in Z.textureArrays){for(var Y=Z.textureArrays[g],I=new Array,E=0;E<Y.length;E++)I.push(i.b.Parse(Y[E],j,b));O.setTextureArray(g,I)}for(g in Z.ints)O.setInt(g,Z.ints[g]);for(g in Z.floats)O.setFloat(g,Z.floats[g]);for(g in Z.floatsArrays)O.setFloats(g,Z.floatsArrays[g]);for(g in Z.colors3)O.setColor3(g,Q.e.FromArray(Z.colors3[g]));for(g in Z.colors3Arrays){var a=Z.colors3Arrays[g].reduce((function(Z,M,j){return j%3===0?Z.push([M]):Z[Z.length-1].push(M),Z}),[]).map((function(Z){return Q.e.FromArray(Z)}));O.setColor3Array(g,a)}for(g in Z.colors4)O.setColor4(g,Q.g.FromArray(Z.colors4[g]));for(g in Z.colors4Arrays){a=Z.colors4Arrays[g].reduce((function(Z,M,j){return j%4===0?Z.push([M]):Z[Z.length-1].push(M),Z}),[]).map((function(Z){return Q.g.FromArray(Z)}));O.setColor4Array(g,a)}for(g in Z.vectors2)O.setVector2(g,K.h.FromArray(Z.vectors2[g]));for(g in Z.vectors3)O.setVector3(g,K.k.FromArray(Z.vectors3[g]));for(g in Z.vectors4)O.setVector4(g,K.l.FromArray(Z.vectors4[g]));for(g in Z.quaternions)O.setQuaternion(g,K.d.FromArray(Z.quaternions[g]));for(g in Z.matrices)O.setMatrix(g,K.c.FromArray(Z.matrices[g]));for(g in Z.matrixArray)O._matrixArrays[g]=new Float32Array(Z.matrixArray[g]);for(g in Z.matrices3x3)O.setMatrix3x3(g,Z.matrices3x3[g]);for(g in Z.matrices2x2)O.setMatrix2x2(g,Z.matrices2x2[g]);for(g in Z.vectors2Arrays)O.setArray2(g,Z.vectors2Arrays[g]);for(g in Z.vectors3Arrays)O.setArray3(g,Z.vectors3Arrays[g]);for(g in Z.vectors4Arrays)O.setArray4(g,Z.vectors4Arrays[g]);for(g in Z.quaternionsArrays)O.setArray4(g,Z.quaternionsArrays[g]);return O},M.ParseFromFileAsync=function(Z,M,j,K){var b=this;return void 0===K&&(K=""),new Promise((function(g,O){var Q=new o.e;Q.addEventListener("readystatechange",(function(){if(4==Q.readyState)if(200==Q.status){var M=JSON.parse(Q.responseText),Y=b.Parse(M,j||G.e.LastCreatedScene,K);Z&&(Y.name=Z),g(Y)}else O("Unable to load the ShaderMaterial")})),Q.open("GET",M),Q.send()}))},M.CreateFromSnippetAsync=function(Z,M,j){var K=this;return void 0===j&&(j=""),new Promise((function(b,g){var O=new o.e;O.addEventListener("readystatechange",(function(){if(4==O.readyState)if(200==O.status){var Q=JSON.parse(JSON.parse(O.responseText).jsonPayload),Y=JSON.parse(Q.shaderMaterial),I=K.Parse(Y,M||G.e.LastCreatedScene,j);I.snippetId=Z,b(I)}else g("Unable to load the snippet "+Z)})),O.open("GET",K.SnippetUrl+"/"+Z.replace(/#/g,"/")),O.send()}))},M.SnippetUrl="https://snippet.babylonjs.com",M}(c.e);(0,z.c)("BABYLON.ShaderMaterial",X);var d=j(16179),W=(j(76578),j(84098),"#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}");d.d.ShadersStore.colorPixelShader=W;j(31377),j(54001),j(49329),j(16554),j(50511),j(97202),j(48623),j(61906),j(35738);var A="attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#include<vertexColorMixing>\n#define CUSTOM_VERTEX_MAIN_END\n}";d.d.ShadersStore.colorVertexShader=A;b.b._LinesMeshParser=function(Z,M){return q.Parse(Z,M)};var q=function(Z){function M(M,j,K,b,g,O,I,E){void 0===j&&(j=null),void 0===K&&(K=null),void 0===b&&(b=null);var s=Z.call(this,M,j,K,b,g)||this;s.useVertexColor=O,s.useVertexAlpha=I,s.color=new Q.e(1,1,1),s.alpha=1,b&&(s.color=b.color.clone(),s.alpha=b.alpha,s.useVertexColor=b.useVertexColor,s.useVertexAlpha=b.useVertexAlpha),s.intersectionThreshold=.1;var i={attributes:[Y.f.PositionKind],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null};return!1===I?i.needAlphaBlending=!1:i.defines.push("#define VERTEXALPHA"),O?(i.defines.push("#define VERTEXCOLOR"),i.attributes.push(Y.f.ColorKind)):(i.uniforms.push("color"),s._color4=new Q.g),s.material=E||new X("colorShader",s.getScene(),"color",i,!1),s}return(0,O.m)(M,Z),M.prototype._isShaderMaterial=function(Z){return"ShaderMaterial"===Z.getClassName()},M.prototype.isReady=function(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage)&&Z.prototype.isReady.call(this)},M.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(M.prototype,"material",{get:function(){return this._lineMaterial},set:function(Z){this._lineMaterial=Z,this._lineMaterial.fillMode=E.d.LineListDrawMode},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"checkCollisions",{get:function(){return!1},set:function(Z){},enumerable:!1,configurable:!0}),M.prototype._bind=function(){if(!this._geometry)return this;var Z=this._lineMaterial.getEffect(),M=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._userInstancedBuffersStorage?this._geometry._bind(Z,M,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(Z,M),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){var j=this.color,K=j.r,b=j.g,g=j.b;this._color4.set(K,b,g,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this},M.prototype._draw=function(Z,M,j){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var K=this.getScene().getEngine();return this._unIndexed?K.drawArraysType(E.d.LineListDrawMode,Z.verticesStart,Z.verticesCount,j):K.drawElementsType(E.d.LineListDrawMode,Z.indexStart,Z.indexCount,j),this},M.prototype.dispose=function(M){this._lineMaterial.dispose(!1,!1,!0),Z.prototype.dispose.call(this,M)},M.prototype.clone=function(Z,j,K){return void 0===j&&(j=null),new M(Z,this.getScene(),j,this,K)},M.prototype.createInstance=function(Z){var M=new T(Z,this);if(this.instancedBuffers)for(var j in M.instancedBuffers={},this.instancedBuffers)M.instancedBuffers[j]=this.instancedBuffers[j];return M},M.prototype.serialize=function(M){Z.prototype.serialize.call(this,M),M.color=this.color.asArray(),M.alpha=this.alpha},M.Parse=function(Z,j){var K=new M(Z.name,j);return K.color=Q.e.FromArray(Z.color),K.alpha=Z.alpha,K},M}(b.b),T=function(Z){function M(M,j){var K=Z.call(this,M,j)||this;return K.intersectionThreshold=j.intersectionThreshold,K}return(0,O.m)(M,Z),M.prototype.getClassName=function(){return"InstancedLinesMesh"},M}(I.d),B=j(9127);function N(Z){for(var M=[],j=[],K=Z.lines,b=Z.colors,O=[],Q=0,Y=0;Y<K.length;Y++)for(var I=K[Y],E=0;E<I.length;E++){if(j.push(I[E].x,I[E].y,I[E].z),b){var s=b[Y];O.push(s[E].r,s[E].g,s[E].b,s[E].a)}E>0&&(M.push(Q-1),M.push(Q)),Q++}var i=new g.e;return i.indices=M,i.positions=j,b&&(i.colors=O),i}function U(Z){var M,j,b=Z.dashSize||3,O=Z.gapSize||1,Q=Z.dashNb||200,Y=Z.points,I=new Array,E=new Array,s=K.k.Zero(),i=0,a=0,z=0,V=0,o=0;for(o=0;o<Y.length-1;o++)Y[o+1].subtractToRef(Y[o],s),i+=s.length();for(j=b*(M=i/Q)/(b+O),o=0;o<Y.length-1;o++){Y[o+1].subtractToRef(Y[o],s),a=Math.floor(s.length()/M),s.normalize();for(var c=0;c<a;c++)z=M*c,I.push(Y[o].x+z*s.x,Y[o].y+z*s.y,Y[o].z+z*s.z),I.push(Y[o].x+(z+j)*s.x,Y[o].y+(z+j)*s.y,Y[o].z+(z+j)*s.z),E.push(V,V+1),V+=2}var G=new g.e;return G.positions=I,G.indices=E,G}function n(Z,M,j){var K=M.instance,b=M.lines,g=M.colors;if(K){var O=K.getVerticesData(Y.f.PositionKind),Q=void 0,I=void 0;g&&(Q=K.getVerticesData(Y.f.ColorKind));for(var E=0,s=0,i=0;i<b.length;i++)for(var a=b[i],z=0;z<a.length;z++)O[E]=a[z].x,O[E+1]=a[z].y,O[E+2]=a[z].z,g&&Q&&(I=g[i],Q[s]=I[z].r,Q[s+1]=I[z].g,Q[s+2]=I[z].b,Q[s+3]=I[z].a,s+=4),E+=3;return K.updateVerticesData(Y.f.PositionKind,O,!1,!1),g&&Q&&K.updateVerticesData(Y.f.ColorKind,Q,!1,!1),K}var V=new q(Z,j,null,void 0,void 0,!!g,M.useVertexAlpha,M.material);return N(M).applyToMesh(V,M.updatable),V}function k(Z,M,j){void 0===j&&(j=null);var K=M.colors?[M.colors]:null;return n(Z,{lines:[M.points],updatable:M.updatable,instance:M.instance,colors:K,useVertexAlpha:M.useVertexAlpha,material:M.material},j)}function x(Z,M,j){void 0===j&&(j=null);var g=M.points,O=M.instance,Q=M.gapSize||1,Y=M.dashSize||3;if(O){return(M.dashNb||M.dashSize||M.gapSize||M.useVertexAlpha||M.material)&&B.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),O.updateMeshPositions((function(Z){var M,j,b=K.k.Zero(),Q=Z.length/6,Y=0,I=0,E=0,s=0,i=0,a=0;for(i=0;i<g.length-1;i++)g[i+1].subtractToRef(g[i],b),Y+=b.length();M=Y/Q;var z=O._creationDataStorage.dashSize;for(j=z*M/(z+O._creationDataStorage.gapSize),i=0;i<g.length-1;i++)for(g[i+1].subtractToRef(g[i],b),I=Math.floor(b.length()/M),b.normalize(),a=0;a<I&&s<Z.length;)E=M*a,Z[s]=g[i].x+E*b.x,Z[s+1]=g[i].y+E*b.y,Z[s+2]=g[i].z+E*b.z,Z[s+3]=g[i].x+(E+j)*b.x,Z[s+4]=g[i].y+(E+j)*b.y,Z[s+5]=g[i].z+(E+j)*b.z,s+=6,a++;for(;s<Z.length;)Z[s]=g[i].x,Z[s+1]=g[i].y,Z[s+2]=g[i].z,s+=3}),!1),O}var I=new q(Z,j,null,void 0,void 0,void 0,M.useVertexAlpha,M.material);return U(M).applyToMesh(I,M.updatable),I._creationDataStorage=new b.e,I._creationDataStorage.dashSize=Y,I._creationDataStorage.gapSize=Q,I}g.e.CreateLineSystem=N,g.e.CreateDashedLines=U,b.b.CreateLines=function(Z,M,j,K,b){return void 0===j&&(j=null),void 0===K&&(K=!1),void 0===b&&(b=null),k(Z,{points:M,updatable:K,instance:b},j)},b.b.CreateDashedLines=function(Z,M,j,K,b,g,O,Q){return void 0===g&&(g=null),x(Z,{points:M,dashSize:j,gapSize:K,dashNb:b,updatable:O,instance:Q},g)}},49620:function(Z,M,j){"use strict";j.d(M,{b:function(){return Q},d:function(){return Y}});var K=j(65847),b=j(85779),g=j(20334);function O(Z){var M=[],j=[],K=[],O=[],Q=Z.width||Z.size||1,Y=Z.height||Z.size||1,I=0===Z.sideOrientation?0:Z.sideOrientation||b.e.DEFAULTSIDE,E=Q/2,s=Y/2;j.push(-E,-s,0),K.push(0,0,-1),O.push(0,g.e.UseOpenGLOrientationForUV?1:0),j.push(E,-s,0),K.push(0,0,-1),O.push(1,g.e.UseOpenGLOrientationForUV?1:0),j.push(E,s,0),K.push(0,0,-1),O.push(1,g.e.UseOpenGLOrientationForUV?0:1),j.push(-E,s,0),K.push(0,0,-1),O.push(0,g.e.UseOpenGLOrientationForUV?0:1),M.push(0),M.push(1),M.push(2),M.push(0),M.push(2),M.push(3),b.e._ComputeSides(I,j,M,K,O,Z.frontUVs,Z.backUVs);var i=new b.e;return i.indices=M,i.positions=j,i.normals=K,i.uvs=O,i}function Q(Z,M,j){void 0===M&&(M={}),void 0===j&&(j=null);var b=new K.b(Z,j);return M.sideOrientation=K.b._GetDefaultSideOrientation(M.sideOrientation),b._originalBuilderSideOrientation=M.sideOrientation,O(M).applyToMesh(b,M.updatable),M.sourcePlane&&(b.translate(M.sourcePlane.normal,-M.sourcePlane.d),b.setDirection(M.sourcePlane.normal.scale(-1))),b}var Y={CreatePlane:Q};b.e.CreatePlane=O,K.b.CreatePlane=function(Z,M,j,K,b){return Q(Z,{size:M,width:M,height:M,sideOrientation:b,updatable:K},j)}},71898:function(Z,M,j){"use strict";j.d(M,{e:function(){return Y}});var K=j(80105),b=j(65847),g=j(85779),O=j(20334);function Q(Z){for(var M=Z.segments||32,j=Z.diameterX||Z.diameter||1,b=Z.diameterY||Z.diameter||1,Q=Z.diameterZ||Z.diameter||1,Y=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,I=Z.slice&&Z.slice<=0?1:Z.slice||1,E=0===Z.sideOrientation?0:Z.sideOrientation||g.e.DEFAULTSIDE,s=!!Z.dedupTopBottomIndices,i=new K.k(j/2,b/2,Q/2),a=2+M,z=2*a,V=[],o=[],c=[],G=[],f=0;f<=a;f++){for(var X=f/a,d=X*Math.PI*I,W=0;W<=z;W++){var A=W/z,q=A*Math.PI*2*Y,T=K.c.RotationZ(-d),B=K.c.RotationY(q),N=K.k.TransformCoordinates(K.k.Up(),T),U=K.k.TransformCoordinates(N,B),n=U.multiply(i),k=U.divide(i).normalize();o.push(n.x,n.y,n.z),c.push(k.x,k.y,k.z),G.push(A,O.e.UseOpenGLOrientationForUV?1-X:X)}if(f>0)for(var x=o.length/3,R=x-2*(z+1);R+z+2<x;R++)s?(f>1&&(V.push(R),V.push(R+1),V.push(R+z+1)),(f<a||I<1)&&(V.push(R+z+1),V.push(R+1),V.push(R+z+2))):(V.push(R),V.push(R+1),V.push(R+z+1),V.push(R+z+1),V.push(R+1),V.push(R+z+2))}g.e._ComputeSides(E,o,V,c,G,Z.frontUVs,Z.backUVs);var e=new g.e;return e.indices=V,e.positions=o,e.normals=c,e.uvs=G,e}function Y(Z,M,j){void 0===M&&(M={}),void 0===j&&(j=null);var K=new b.b(Z,j);return M.sideOrientation=b.b._GetDefaultSideOrientation(M.sideOrientation),K._originalBuilderSideOrientation=M.sideOrientation,Q(M).applyToMesh(K,M.updatable),K}g.e.CreateSphere=Q,b.b.CreateSphere=function(Z,M,j,K,b,g){return Y(Z,{segments:M,diameterX:j,diameterY:j,diameterZ:j,sideOrientation:g,updatable:b},K)}},40689:function(Z,M,j){"use strict";j.d(M,{c:function(){return E}});var K=j(9217),b=j(40061),g=function(){function Z(Z){this._pendingActions=new Array,this._workerInfos=Z.map((function(Z){return{workerPromise:Promise.resolve(Z),idle:!0}}))}return Z.prototype.dispose=function(){for(var Z=0,M=this._workerInfos;Z<M.length;Z++){M[Z].workerPromise.then((function(Z){Z.terminate()}))}this._workerInfos.length=0,this._pendingActions.length=0},Z.prototype.push=function(Z){this._executeOnIdleWorker(Z)||this._pendingActions.push(Z)},Z.prototype._executeOnIdleWorker=function(Z){for(var M=0,j=this._workerInfos;M<j.length;M++){var K=j[M];if(K.idle)return this._execute(K,Z),!0}return!1},Z.prototype._execute=function(Z,M){var j=this;Z.idle=!1,Z.workerPromise.then((function(K){M(K,(function(){var M=j._pendingActions.shift();M?j._execute(Z,M):Z.idle=!0}))}))},Z}(),O=function(Z){function M(j,K,b){void 0===b&&(b=M.DefaultOptions);var g=Z.call(this,[])||this;return g._maxWorkers=j,g._createWorkerAsync=K,g._options=b,g}return(0,b.m)(M,Z),M.prototype.push=function(Z){if(!this._executeOnIdleWorker(Z))if(this._workerInfos.length<this._maxWorkers){var M={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(M),this._execute(M,Z)}else this._pendingActions.push(Z)},M.prototype._execute=function(M,j){var K=this;M.timeoutId&&(clearTimeout(M.timeoutId),delete M.timeoutId),Z.prototype._execute.call(this,M,(function(Z,b){j(Z,(function(){b(),M.idle&&(M.timeoutId=setTimeout((function(){M.workerPromise.then((function(Z){Z.terminate()}));var Z=K._workerInfos.indexOf(M);-1!==Z&&K._workerInfos.splice(Z,1)}),K._options.idleTimeElapsedBeforeRelease))}))}))},M.DefaultOptions={idleTimeElapsedBeforeRelease:1e3},M}(g),Q=j(85779);function Y(Z,M,j,K,b,g){var O=new Z.DecoderBuffer;O.Init(M,M.byteLength);var Q,Y,I=new Z.Decoder;try{var E=I.GetEncodedGeometryType(O);switch(E){case Z.TRIANGULAR_MESH:Q=new Z.Mesh,Y=I.DecodeBufferToMesh(O,Q);break;case Z.POINT_CLOUD:Q=new Z.PointCloud,Y=I.DecodeBufferToPointCloud(O,Q);break;default:throw new Error("Invalid geometry type ".concat(E))}if(!Y.ok()||!Q.ptr)throw new Error(Y.error_msg());if(E===Z.TRIANGULAR_MESH){var s=3*Q.num_faces(),i=4*s,a=Z._malloc(i);try{I.GetTrianglesUInt32Array(Q,i,a);var z=new Uint32Array(s);z.set(new Uint32Array(Z.HEAPF32.buffer,a,s)),K(z)}finally{Z._free(a)}}var V=function(M,j,K){void 0===K&&(K=1);var g=j.num_components(),O=Q.num_points(),Y=O*g,E=Y*Float32Array.BYTES_PER_ELEMENT,s=Z._malloc(E);try{I.GetAttributeDataArrayForAllPoints(Q,j,Z.DT_FLOAT32,E,s);var i=new Float32Array(Z.HEAPF32.buffer,s,Y);if("color"===M&&3===g){for(var a=new Float32Array(4*O),z=0,V=0;z<a.length;z+=4,V+=g)a[z+0]=i[V+0],a[z+1]=i[V+1],a[z+2]=i[V+2],a[z+3]=1;b(M,a)}else{if((a=new Float32Array(Y)).set(new Float32Array(Z.HEAPF32.buffer,s,Y)),1!==K)for(z=0;z<a.length;z++)a[z]=a[z]/K;b(M,a)}}finally{Z._free(s)}};if(j)for(var o in j){var c=j[o];V(o,I.GetAttributeByUniqueId(Q,c),g&&g[o]||1)}else{var G={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var o in G){if(-1!==(c=I.GetAttributeId(Q,Z[G[o]])))V(o,I.GetAttribute(Q,c))}}}finally{Q&&Z.destroy(Q),Z.destroy(I),Z.destroy(O)}}function I(){var Z;onmessage=function(M){var j=M.data;switch(j.id){case"init":var K=j.decoder;K.url&&(importScripts(K.url),Z=DracoDecoderModule({wasmBinary:K.wasmBinary})),postMessage("done");break;case"decodeMesh":if(!Z)throw new Error("Draco decoder module is not available");Z.then((function(Z){Y(Z,j.dataView,j.attributes,(function(Z){postMessage({id:"indices",value:Z},[Z.buffer])}),(function(Z,M){postMessage({id:Z,value:M},[M.buffer])})),postMessage("done")}))}}}var E=function(){function Z(M){void 0===M&&(M=Z.DefaultNumWorkers);var j=Z.Configuration.decoder,b=j.wasmUrl&&j.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:K.d.GetAbsoluteUrl(j.wasmUrl),wasmBinaryPromise:K.d.LoadFileAsync(K.d.GetAbsoluteUrl(j.wasmBinaryUrl))}:{url:K.d.GetAbsoluteUrl(j.fallbackUrl),wasmBinaryPromise:Promise.resolve(void 0)};M&&"function"===typeof Worker?this._workerPoolPromise=b.wasmBinaryPromise.then((function(Z){var j="".concat(Y,"(").concat(I,")()"),K=URL.createObjectURL(new Blob([j],{type:"application/javascript"}));return new O(M,(function(){return new Promise((function(M,j){var g=new Worker(K),O=function Z(M){g.removeEventListener("error",Z),g.removeEventListener("message",Q),j(M)},Q=function Z(j){"done"===j.data&&(g.removeEventListener("error",O),g.removeEventListener("message",Z),M(g))};g.addEventListener("error",O),g.addEventListener("message",Q),g.postMessage({id:"init",decoder:{url:b.url,wasmBinary:Z}})}))}))})):this._decoderModulePromise=b.wasmBinaryPromise.then((function(Z){if(!b.url)throw new Error("Draco decoder module is not available");return K.d.LoadScriptAsync(b.url).then((function(){return M=Z,new Promise((function(Z){DracoDecoderModule({wasmBinary:M}).then((function(M){Z({module:M})}))}));var M}))}))}return Object.defineProperty(Z,"DecoderAvailable",{get:function(){var M=Z.Configuration.decoder;return!!(M.wasmUrl&&M.wasmBinaryUrl&&"object"===typeof WebAssembly||M.fallbackUrl)},enumerable:!1,configurable:!0}),Z.GetDefaultNumWorkers=function(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(Z,"Default",{get:function(){return Z._Default||(Z._Default=new Z),Z._Default},enumerable:!1,configurable:!0}),Z.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then((function(Z){Z.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise},Z.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then((function(){})):this._decoderModulePromise?this._decoderModulePromise.then((function(){})):Promise.resolve()},Z.prototype.decodeMeshAsync=function(Z,M,j){var K=Z instanceof ArrayBuffer?new Uint8Array(Z):Z;if(this._workerPoolPromise)return this._workerPoolPromise.then((function(Z){return new Promise((function(b,g){Z.push((function(Z,O){var Y=new Q.e,I=function M(j){Z.removeEventListener("error",M),Z.removeEventListener("message",E),g(j),O()},E=function M(K){if("done"===K.data)Z.removeEventListener("error",I),Z.removeEventListener("message",M),b(Y),O();else if("indices"===K.data.id)Y.indices=K.data.value;else{var g=j&&j[K.data.id]?j[K.data.id]:1;if(1!==g)for(var Q=0;Q<K.data.value.length;Q++)K.data.value[Q]=K.data.value[Q]/g;Y.set(K.data.value,K.data.id)}};Z.addEventListener("error",I),Z.addEventListener("message",E);var s=new Uint8Array(K.byteLength);s.set(new Uint8Array(K.buffer,K.byteOffset,K.byteLength)),Z.postMessage({id:"decodeMesh",dataView:s,attributes:M},[s.buffer])}))}))}));if(this._decoderModulePromise)return this._decoderModulePromise.then((function(Z){var b=new Q.e;return Y(Z.module,K,M,(function(Z){b.indices=Z}),(function(Z,M){b.set(M,Z)}),j),b}));throw new Error("Draco decoder module is not available")},Z.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},Z.DefaultNumWorkers=Z.GetDefaultNumWorkers(),Z._Default=null,Z}()},12753:function(Z,M,j){"use strict";j.d(M,{b:function(){return b}});var K=j(40061),b=function(Z){function M(M){var j=Z.call(this)||this;return j._buffer=M,j}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),M}(j(82419).e)},52644:function(Z,M,j){"use strict";j.d(M,{b:function(){return W}});var K=j(40061),b=j(9271),g=j(80105),O=j(90690),Q=j(43251),Y=j(85779),I=j(77129),E=j(44904),s=j(97918),i=j(90534),a=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new g.k(0,0,0),this._diffPositionForCollisions=new g.k(0,0,0),this._collisionResponse=!0},z=j(50504),V=j(18445),o=j(9488),c=j(61686),G=j(54044),f=j(31709),X=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=g.k.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},d=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new X,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._meshCollisionData=new a,this._enableDistantPicking=!1},W=function(Z){function M(j,K){void 0===K&&(K=null);var Q=Z.call(this,j,K,!1)||this;return Q._internalAbstractMeshDataInfo=new d,Q._waitingMaterialId=null,Q.cullingStrategy=M.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,Q.onCollideObservable=new b.b,Q.onCollisionPositionChangeObservable=new b.b,Q.onMaterialChangedObservable=new b.b,Q.definedFacingForward=!0,Q._occlusionQuery=null,Q._renderingGroup=null,Q.alphaIndex=Number.MAX_VALUE,Q.isVisible=!0,Q.isPickable=!0,Q.isNearPickable=!1,Q.isNearGrabbable=!1,Q.showSubMeshesBoundingBox=!1,Q.isBlocker=!1,Q.enablePointerMoveEvents=!1,Q.outlineColor=o.e.Red(),Q.outlineWidth=.02,Q.overlayColor=o.e.Red(),Q.overlayAlpha=.5,Q.useOctreeForRenderingSelection=!0,Q.useOctreeForPicking=!0,Q.useOctreeForCollisions=!0,Q.alwaysSelectAsActiveMesh=!1,Q.doNotSyncBoundingInfo=!1,Q.actionManager=null,Q.ellipsoid=new g.k(.5,1,.5),Q.ellipsoidOffset=new g.k(0,0,0),Q.edgesWidth=1,Q.edgesColor=new o.g(1,0,0,1),Q._edgesRenderer=null,Q._masterMesh=null,Q._boundingInfo=null,Q._boundingInfoIsDirty=!0,Q._renderId=0,Q._intersectionsInProgress=new Array,Q._unIndexed=!1,Q._lightSources=new Array,Q._waitingData={lods:null,actions:null,freezeWorldMatrix:null},Q._bonesTransformMatrices=null,Q._transformMatrixTexture=null,Q.onRebuildObservable=new b.b,Q._onCollisionPositionChange=function(Z,M,j){void 0===j&&(j=null),M.subtractToRef(Q._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,Q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),Q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>O.c.CollisionsEpsilon&&Q.position.addInPlace(Q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),j&&Q.onCollideObservable.notifyObservers(j),Q.onCollisionPositionChangeObservable.notifyObservers(Q.position)},Q.getScene().addMesh(Q),Q._resyncLightSources(),Q._uniformBuffer=new i.d(Q.getScene().getEngine(),void 0,void 0,j,!Q.getScene().getEngine().isWebGPU),Q._buildUniformLayout(),Q}return(0,K.m)(M,Z),Object.defineProperty(M,"BILLBOARDMODE_NONE",{get:function(){return I.d.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(M,"BILLBOARDMODE_X",{get:function(){return I.d.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(M,"BILLBOARDMODE_Y",{get:function(){return I.d.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(M,"BILLBOARDMODE_Z",{get:function(){return I.d.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"BILLBOARDMODE_ALL",{get:function(){return I.d.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(M,"BILLBOARDMODE_USE_POSITION",{get:function(){return I.d.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(Z){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(Z){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(Z){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(Z){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"collisionRetryCount",{get:function(){return this._internalAbstractMeshDataInfo._collisionRetryCount},set:function(Z){this._internalAbstractMeshDataInfo._collisionRetryCount=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"morphTargetManager",{get:function(){return this._internalAbstractMeshDataInfo._morphTargetManager},set:function(Z){this._internalAbstractMeshDataInfo._morphTargetManager!==Z&&(this._internalAbstractMeshDataInfo._morphTargetManager=Z,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"bakedVertexAnimationManager",{get:function(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager},set:function(Z){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==Z&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=Z,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),M.prototype._syncGeometryWithMorphTargetManager=function(){},M.prototype._updateNonUniformScalingState=function(M){return!!Z.prototype._updateNonUniformScalingState.call(this,M)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(M.prototype,"onCollide",{set:function(Z){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onCollisionPositionChange",{set:function(Z){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(Z){if(this._internalAbstractMeshDataInfo._visibility!==Z){var M=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=Z,(1===M&&1!==Z||1!==M&&1===Z)&&this._markSubMeshesAsMiscDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"renderingGroupId",{get:function(){return this._internalAbstractMeshDataInfo._renderingGroupId},set:function(Z){this._internalAbstractMeshDataInfo._renderingGroupId=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"material",{get:function(){return this._internalAbstractMeshDataInfo._material},set:function(Z){this._internalAbstractMeshDataInfo._material!==Z&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=Z,Z&&Z.meshMap&&(Z.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))},enumerable:!1,configurable:!0}),M.prototype.getMaterialForRenderPass=function(Z){var M;return null===(M=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===M?void 0:M[Z]},M.prototype.setMaterialForRenderPass=function(Z,M){this.resetDrawCache(Z),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[Z]=M},Object.defineProperty(M.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(Z){this._internalAbstractMeshDataInfo._receiveShadows!==Z&&(this._internalAbstractMeshDataInfo._receiveShadows=Z,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(Z){this._internalAbstractMeshDataInfo._hasVertexAlpha!==Z&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=Z,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(Z){this._internalAbstractMeshDataInfo._useVertexColors!==Z&&(this._internalAbstractMeshDataInfo._useVertexColors=Z,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(Z){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==Z&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=Z,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(Z){this._internalAbstractMeshDataInfo._numBoneInfluencers!==Z&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=Z,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(Z){this._internalAbstractMeshDataInfo._applyFog!==Z&&(this._internalAbstractMeshDataInfo._applyFog=Z,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"enableDistantPicking",{get:function(){return this._internalAbstractMeshDataInfo._enableDistantPicking},set:function(Z){this._internalAbstractMeshDataInfo._enableDistantPicking=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(Z){Z!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=Z,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"collisionMask",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask},set:function(Z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(Z)?-1:Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"collisionResponse",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse},set:function(Z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"collisionGroup",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup},set:function(Z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(Z)?-1:Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"surroundingMeshes",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes},set:function(Z){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(Z){var M=this._internalAbstractMeshDataInfo._skeleton;M&&M.needInitialSkinMatrix&&M._unregisterMeshWithPoseMatrix(this),Z&&Z.needInitialSkinMatrix&&Z._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=Z,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),M.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()},M.prototype.transferToEffect=function(Z){var M=this._uniformBuffer;M.updateMatrix("world",Z),M.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),M.update()},M.prototype.getMeshUniformBuffer=function(){return this._uniformBuffer},M.prototype.getClassName=function(){return"AbstractMesh"},M.prototype.toString=function(Z){var M="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");M+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var j=this._internalAbstractMeshDataInfo._skeleton;return j&&(M+=", skeleton: "+j.name),Z&&(M+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],M+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),M},M.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==I.d.BILLBOARDMODE_NONE?this._masterMesh:Z.prototype._getEffectiveParent.call(this)},M.prototype._getActionManagerForTrigger=function(Z,M){if(void 0===M&&(M=!0),this.actionManager&&(M||this.actionManager.isRecursive)){if(!Z)return this.actionManager;if(this.actionManager.hasSpecificTrigger(Z))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(Z,!1):null},M.prototype._rebuild=function(Z){if(void 0===Z&&(Z=!1),this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var M=0,j=this.subMeshes;M<j.length;M++){j[M]._rebuild()}},M.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var Z=0,M=this.getScene().lights;Z<M.length;Z++){var j=M[Z];j.isEnabled()&&(j.canAffectMesh(this)&&this._lightSources.push(j))}this._markSubMeshesAsLightDirty()},M.prototype._resyncLightSource=function(Z){var M=Z.isEnabled()&&Z.canAffectMesh(this),j=this._lightSources.indexOf(Z),K=!1;if(-1===j){if(!M)return;this._lightSources.push(Z)}else{if(M)return;K=!0,this._lightSources.splice(j,1)}this._markSubMeshesAsLightDirty(K)},M.prototype._unBindEffect=function(){for(var Z=0,M=this.subMeshes;Z<M.length;Z++){M[Z].setEffect(null)}},M.prototype._removeLightSource=function(Z,M){var j=this._lightSources.indexOf(Z);-1!==j&&(this._lightSources.splice(j,1),this._markSubMeshesAsLightDirty(M))},M.prototype._markSubMeshesAsDirty=function(Z){if(this.subMeshes)for(var M=0,j=this.subMeshes;M<j.length;M++)for(var K=j[M],b=0;b<K._drawWrappers.length;++b){var g=K._drawWrappers[b];g&&g.defines&&g.defines.markAllAsDirty&&Z(g.defines)}},M.prototype._markSubMeshesAsLightDirty=function(Z){void 0===Z&&(Z=!1),this._markSubMeshesAsDirty((function(M){return M.markAsLightDirty(Z)}))},M.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty((function(Z){return Z.markAsAttributesDirty()}))},M.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty((function(Z){return Z.markAsMiscDirty()}))},M.prototype.markAsDirty=function(Z){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},M.prototype.resetDrawCache=function(Z){if(this.subMeshes)for(var M=0,j=this.subMeshes;M<j.length;M++){j[M].resetDrawCache(Z)}},Object.defineProperty(M.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),M.prototype.getLOD=function(Z){return this},M.prototype.getTotalVertices=function(){return 0},M.prototype.getTotalIndices=function(){return 0},M.prototype.getIndices=function(){return null},M.prototype.getVerticesData=function(Z){return null},M.prototype.setVerticesData=function(Z,M,j,K){return this},M.prototype.updateVerticesData=function(Z,M,j,K){return this},M.prototype.setIndices=function(Z,M){return this},M.prototype.isVerticesDataPresent=function(Z){return!1},M.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)},M.prototype.setBoundingInfo=function(Z){return this._boundingInfo=Z,this},Object.defineProperty(M.prototype,"hasBoundingInfo",{get:function(){return null!==this._boundingInfo},enumerable:!1,configurable:!0}),M.prototype.buildBoundingInfo=function(Z,M,j){return this._boundingInfo=new s.c(Z,M,j),this._boundingInfo},M.prototype.normalizeToUnitCube=function(M,j,K){return void 0===M&&(M=!0),void 0===j&&(j=!1),Z.prototype.normalizeToUnitCube.call(this,M,j,K)},Object.defineProperty(M.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(Q.f.MatricesIndicesKind)&&this.isVerticesDataPresent(Q.f.MatricesWeightsKind)},enumerable:!1,configurable:!0}),M.prototype._preActivate=function(){},M.prototype._preActivateForIntermediateRendering=function(Z){},M.prototype._activate=function(Z,M){return this._renderId=Z,!0},M.prototype._postActivate=function(){},M.prototype._freeze=function(){},M.prototype._unFreeze=function(){},M.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===I.d.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():Z.prototype.getWorldMatrix.call(this)},M.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():Z.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(M.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),M.prototype.movePOV=function(Z,M,j){return this.position.addInPlace(this.calcMovePOV(Z,M,j)),this},M.prototype.calcMovePOV=function(Z,M,j){var K=new g.c;(this.rotationQuaternion?this.rotationQuaternion:g.d.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(K);var b=g.k.Zero(),O=this.definedFacingForward?-1:1;return g.k.TransformCoordinatesFromFloatsToRef(Z*O,M,j*O,K,b),b},M.prototype.rotatePOV=function(Z,M,j){return this.rotation.addInPlace(this.calcRotatePOV(Z,M,j)),this},M.prototype.calcRotatePOV=function(Z,M,j){var K=this.definedFacingForward?1:-1;return new g.k(Z*K,M,j*K)},M.prototype.refreshBoundingInfo=function(Z,M){return void 0===Z&&(Z=!1),void 0===M&&(M=!1),this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(Z,M),null),this},M.prototype._refreshBoundingInfo=function(Z,M){if(Z){var j=(0,V.d)(Z,0,this.getTotalVertices(),M);this._boundingInfo?this._boundingInfo.reConstruct(j.minimum,j.maximum):this._boundingInfo=new s.c(j.minimum,j.maximum)}if(this.subMeshes)for(var K=0;K<this.subMeshes.length;K++)this.subMeshes[K].refreshBoundingInfo(Z);this._updateBoundingInfo()},M.prototype._getData=function(Z,M,j,K){if(void 0===Z&&(Z=!1),void 0===M&&(M=!1),void 0===K&&(K=Q.f.PositionKind),(j=null!==j&&void 0!==j?j:this.getVerticesData(K).slice())&&M&&this.morphTargetManager)for(var b=0,O=0,Y=0;Y<j.length;Y++){for(var I=0;I<this.morphTargetManager.numTargets;I++){var E=this.morphTargetManager.getTarget(I),s=E.influence;if(s>0){var i=E.getPositions();i&&(j[Y]+=(i[Y]-j[Y])*s)}}if(b++,K===Q.f.PositionKind&&this._positions&&3===b){b=0;var a=3*O;this._positions[O++].copyFromFloats(j[a],j[a+1],j[a+2])}}if(j&&Z&&this.skeleton){var z=this.getVerticesData(Q.f.MatricesIndicesKind),V=this.getVerticesData(Q.f.MatricesWeightsKind);if(V&&z){var o=this.numBoneInfluencers>4,c=o?this.getVerticesData(Q.f.MatricesIndicesExtraKind):null,G=o?this.getVerticesData(Q.f.MatricesWeightsExtraKind):null,f=this.skeleton.getTransformMatrices(this),X=g.e.Vector3[0],d=g.e.Matrix[0],W=g.e.Matrix[1],A=0;for(a=0;a<j.length;a+=3,A+=4){d.reset();var q=void 0,T=void 0;for(q=0;q<4;q++)(T=V[A+q])>0&&(g.c.FromFloat32ArrayToRefScaled(f,Math.floor(16*z[A+q]),T,W),d.addToSelf(W));if(o)for(q=0;q<4;q++)(T=G[A+q])>0&&(g.c.FromFloat32ArrayToRefScaled(f,Math.floor(16*c[A+q]),T,W),d.addToSelf(W));K===Q.f.NormalKind?g.k.TransformNormalFromFloatsToRef(j[a],j[a+1],j[a+2],d,X):g.k.TransformCoordinatesFromFloatsToRef(j[a],j[a+1],j[a+2],d,X),X.toArray(j,a),K===Q.f.PositionKind&&this._positions&&this._positions[a/3].copyFrom(X)}}}return j},M.prototype.getNormalsData=function(Z,M){return void 0===Z&&(Z=!1),void 0===M&&(M=!1),this._getData(Z,M,null,Q.f.NormalKind)},M.prototype.getPositionData=function(Z,M,j){return void 0===Z&&(Z=!1),void 0===M&&(M=!1),this._getData(Z,M,j,Q.f.PositionKind)},M.prototype._getPositionData=function(Z,M){var j,K=this.getVerticesData(Q.f.PositionKind);if(this._internalAbstractMeshDataInfo._positions&&(this._internalAbstractMeshDataInfo._positions=null),K&&(Z&&this.skeleton||M&&this.morphTargetManager)){if(K=K.slice(),this._generatePointsArray(),this._positions){var b=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(b.length);for(var O=0;O<b.length;O++)this._internalAbstractMeshDataInfo._positions[O]=(null===(j=b[O])||void 0===j?void 0:j.clone())||new g.k}return this.getPositionData(Z,M,K)}return K},M.prototype._updateBoundingInfo=function(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new s.c(g.k.Zero(),g.k.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},M.prototype._updateSubMeshesBoundingInfo=function(Z){if(!this.subMeshes)return this;for(var M=this.subMeshes.length,j=0;j<M;j++){var K=this.subMeshes[j];(M>1||!K.IsGlobal)&&K.updateBoundingInfo(Z)}return this},M.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)},M.prototype.isInFrustum=function(Z){return this.getBoundingInfo().isInFrustum(Z,this.cullingStrategy)},M.prototype.isCompletelyInFrustum=function(Z){return this.getBoundingInfo().isCompletelyInFrustum(Z)},M.prototype.intersectsMesh=function(Z,M,j){void 0===M&&(M=!1);var K=this.getBoundingInfo(),b=Z.getBoundingInfo();if(K.intersects(b,M))return!0;if(j)for(var g=0,O=this.getChildMeshes();g<O.length;g++){if(O[g].intersectsMesh(Z,M,!0))return!0}return!1},M.prototype.intersectsPoint=function(Z){return this.getBoundingInfo().intersectsPoint(Z)},Object.defineProperty(M.prototype,"checkCollisions",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions},set:function(Z){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"collider",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider},enumerable:!1,configurable:!0}),M.prototype.moveWithCollisions=function(Z){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);var M=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=M.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,M.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,Z,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this},M.prototype._collideForSubMesh=function(Z,M,j){var K;if(this._generatePointsArray(),!this._positions)return this;if(!Z._lastColliderWorldVertices||!Z._lastColliderTransformMatrix.equals(M)){Z._lastColliderTransformMatrix=M.clone(),Z._lastColliderWorldVertices=[],Z._trianglePlanes=[];for(var b=Z.verticesStart,O=Z.verticesStart+Z.verticesCount,Q=b;Q<O;Q++)Z._lastColliderWorldVertices.push(g.k.TransformCoordinates(this._positions[Q],M))}return j._collide(Z._trianglePlanes,Z._lastColliderWorldVertices,this.getIndices(),Z.indexStart,Z.indexStart+Z.indexCount,Z.verticesStart,!!Z.getMaterial(),this,this._shouldConvertRHS(),7===(null===(K=Z.getMaterial())||void 0===K?void 0:K.fillMode)),this},M.prototype._processCollisionsForSubMeshes=function(Z,M){for(var j=this._scene.getCollidingSubMeshCandidates(this,Z),K=j.length,b=0;b<K;b++){var g=j.data[b];K>1&&!g._checkCollision(Z)||this._collideForSubMesh(g,M,Z)}return this},M.prototype._shouldConvertRHS=function(){return!1},M.prototype._checkCollision=function(Z){if(!this.getBoundingInfo()._checkCollision(Z))return this;var M=g.e.Matrix[0],j=g.e.Matrix[1];return g.c.ScalingToRef(1/Z._radius.x,1/Z._radius.y,1/Z._radius.z,M),this.worldMatrixFromCache.multiplyToRef(M,j),this._processCollisionsForSubMeshes(Z,j),this},M.prototype._generatePointsArray=function(){return!1},M.prototype.intersects=function(Z,M,j,K,b,O){void 0===K&&(K=!1),void 0===O&&(O=!1);var Q=new E.b,Y="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,I=this.getBoundingInfo();if(!this.subMeshes)return Q;if(!O&&(!Z.intersectsSphere(I.boundingSphere,Y)||!Z.intersectsBox(I.boundingBox,Y)))return Q;if(K)return Q.hit=!O,Q.pickedMesh=O?null:this,Q.distance=O?0:g.k.Distance(Z.origin,I.boundingSphere.center),Q.subMeshId=0,Q;if(!this._generatePointsArray())return Q;for(var s=null,i=this._scene.getIntersectingSubMeshCandidates(this,Z),a=i.length,z=!1,V=0;V<a;V++){var o=(c=i.data[V]).getMaterial();if(o&&(7==o.fillMode||0==o.fillMode||1==o.fillMode||2==o.fillMode||4==o.fillMode)){z=!0;break}}if(!z)return Q.hit=!0,Q.pickedMesh=this,Q.distance=g.k.Distance(Z.origin,I.boundingSphere.center),Q.subMeshId=-1,Q;for(V=0;V<a;V++){var c=i.data[V];if(!(a>1)||c.canIntersects(Z)){var G=c.intersects(Z,this._positions,this.getIndices(),M,j);if(G&&(M||!s||G.distance<s.distance)&&((s=G).subMeshId=V,M))break}}if(s){var f=null!==b&&void 0!==b?b:this.getWorldMatrix(),X=g.e.Vector3[0],d=g.e.Vector3[1];g.k.TransformCoordinatesToRef(Z.origin,f,X),Z.direction.scaleToRef(s.distance,d);var W=g.k.TransformNormal(d,f).addInPlace(X);return Q.hit=!0,Q.distance=g.k.Distance(X,W),Q.pickedPoint=W,Q.pickedMesh=this,Q.bu=s.bu||0,Q.bv=s.bv||0,Q.subMeshFaceId=s.faceId,Q.faceId=s.faceId+i.data[s.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),Q.subMeshId=s.subMeshId,Q}return Q},M.prototype.clone=function(Z,M,j){return null},M.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},M.prototype.dispose=function(M,j){var K,b=this;for(void 0===j&&(j=!1),this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),K=0;K<this._intersectionsInProgress.length;K++){var g=this._intersectionsInProgress[K],O=g._intersectionsInProgress.indexOf(this);g._intersectionsInProgress.splice(O,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach((function(Z){var M=Z.includedOnlyMeshes.indexOf(b);-1!==M&&Z.includedOnlyMeshes.splice(M,1),-1!==(M=Z.excludedMeshes.indexOf(b))&&Z.excludedMeshes.splice(M,1);var j=Z.getShadowGenerator();if(j){var K=j.getShadowMap();K&&K.renderList&&-1!==(M=K.renderList.indexOf(b))&&K.renderList.splice(M,1)}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var Q=this.getScene().getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,Q.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),Q.wipeCaches(),this.getScene().removeMesh(this),this._parentContainer){var Y=this._parentContainer.meshes.indexOf(this);Y>-1&&this._parentContainer.meshes.splice(Y,1),this._parentContainer=null}if(j&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!M)for(K=0;K<this.getScene().particleSystems.length;K++)this.getScene().particleSystems[K].emitter===this&&(this.getScene().particleSystems[K].dispose(),K--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),Z.prototype.dispose.call(this,M,j)},M.prototype.addChild=function(Z,M){return void 0===M&&(M=!1),Z.setParent(this,M),this},M.prototype.removeChild=function(Z,M){return void 0===M&&(M=!1),Z.setParent(null,M),this},M.prototype._initFacetData=function(){var Z=this._internalAbstractMeshDataInfo._facetData;Z.facetNormals||(Z.facetNormals=new Array),Z.facetPositions||(Z.facetPositions=new Array),Z.facetPartitioning||(Z.facetPartitioning=new Array),Z.facetNb=this.getIndices().length/3|0,Z.partitioningSubdivisions=Z.partitioningSubdivisions?Z.partitioningSubdivisions:10,Z.partitioningBBoxRatio=Z.partitioningBBoxRatio?Z.partitioningBBoxRatio:1.01;for(var M=0;M<Z.facetNb;M++)Z.facetNormals[M]=g.k.Zero(),Z.facetPositions[M]=g.k.Zero();return Z.facetDataEnabled=!0,this},M.prototype.updateFacetData=function(){var Z=this._internalAbstractMeshDataInfo._facetData;Z.facetDataEnabled||this._initFacetData();var M=this.getVerticesData(Q.f.PositionKind),j=this.getIndices(),K=this.getVerticesData(Q.f.NormalKind),b=this.getBoundingInfo();if(Z.facetDepthSort&&!Z.facetDepthSortEnabled){if(Z.facetDepthSortEnabled=!0,j instanceof Uint16Array)Z.depthSortedIndices=new Uint16Array(j);else if(j instanceof Uint32Array)Z.depthSortedIndices=new Uint32Array(j);else{for(var O=!1,I=0;I<j.length;I++)if(j[I]>65535){O=!0;break}Z.depthSortedIndices=O?new Uint32Array(j):new Uint16Array(j)}if(Z.facetDepthSortFunction=function(Z,M){return M.sqDistance-Z.sqDistance},!Z.facetDepthSortFrom){var E=this.getScene().activeCamera;Z.facetDepthSortFrom=E?E.position:g.k.Zero()}Z.depthSortedFacets=[];for(var s=0;s<Z.facetNb;s++){var i={ind:3*s,sqDistance:0};Z.depthSortedFacets.push(i)}Z.invertedMatrix=g.c.Identity(),Z.facetDepthSortOrigin=g.k.Zero()}Z.bbSize.x=b.maximum.x-b.minimum.x>c.e?b.maximum.x-b.minimum.x:c.e,Z.bbSize.y=b.maximum.y-b.minimum.y>c.e?b.maximum.y-b.minimum.y:c.e,Z.bbSize.z=b.maximum.z-b.minimum.z>c.e?b.maximum.z-b.minimum.z:c.e;var a=Z.bbSize.x>Z.bbSize.y?Z.bbSize.x:Z.bbSize.y;if(a=a>Z.bbSize.z?a:Z.bbSize.z,Z.subDiv.max=Z.partitioningSubdivisions,Z.subDiv.X=Math.floor(Z.subDiv.max*Z.bbSize.x/a),Z.subDiv.Y=Math.floor(Z.subDiv.max*Z.bbSize.y/a),Z.subDiv.Z=Math.floor(Z.subDiv.max*Z.bbSize.z/a),Z.subDiv.X=Z.subDiv.X<1?1:Z.subDiv.X,Z.subDiv.Y=Z.subDiv.Y<1?1:Z.subDiv.Y,Z.subDiv.Z=Z.subDiv.Z<1?1:Z.subDiv.Z,Z.facetParameters.facetNormals=this.getFacetLocalNormals(),Z.facetParameters.facetPositions=this.getFacetLocalPositions(),Z.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),Z.facetParameters.bInfo=b,Z.facetParameters.bbSize=Z.bbSize,Z.facetParameters.subDiv=Z.subDiv,Z.facetParameters.ratio=this.partitioningBBoxRatio,Z.facetParameters.depthSort=Z.facetDepthSort,Z.facetDepthSort&&Z.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(Z.invertedMatrix),g.k.TransformCoordinatesToRef(Z.facetDepthSortFrom,Z.invertedMatrix,Z.facetDepthSortOrigin),Z.facetParameters.distanceTo=Z.facetDepthSortOrigin),Z.facetParameters.depthSortedFacets=Z.depthSortedFacets,K&&Y.e.ComputeNormals(M,j,K,Z.facetParameters),Z.facetDepthSort&&Z.facetDepthSortEnabled){Z.depthSortedFacets.sort(Z.facetDepthSortFunction);var z=Z.depthSortedIndices.length/3|0;for(s=0;s<z;s++){var V=Z.depthSortedFacets[s].ind;Z.depthSortedIndices[3*s]=j[V],Z.depthSortedIndices[3*s+1]=j[V+1],Z.depthSortedIndices[3*s+2]=j[V+2]}this.updateIndices(Z.depthSortedIndices,void 0,!0)}return this},M.prototype.getFacetLocalNormals=function(){var Z=this._internalAbstractMeshDataInfo._facetData;return Z.facetNormals||this.updateFacetData(),Z.facetNormals},M.prototype.getFacetLocalPositions=function(){var Z=this._internalAbstractMeshDataInfo._facetData;return Z.facetPositions||this.updateFacetData(),Z.facetPositions},M.prototype.getFacetLocalPartitioning=function(){var Z=this._internalAbstractMeshDataInfo._facetData;return Z.facetPartitioning||this.updateFacetData(),Z.facetPartitioning},M.prototype.getFacetPosition=function(Z){var M=g.k.Zero();return this.getFacetPositionToRef(Z,M),M},M.prototype.getFacetPositionToRef=function(Z,M){var j=this.getFacetLocalPositions()[Z],K=this.getWorldMatrix();return g.k.TransformCoordinatesToRef(j,K,M),this},M.prototype.getFacetNormal=function(Z){var M=g.k.Zero();return this.getFacetNormalToRef(Z,M),M},M.prototype.getFacetNormalToRef=function(Z,M){var j=this.getFacetLocalNormals()[Z];return g.k.TransformNormalToRef(j,this.getWorldMatrix(),M),this},M.prototype.getFacetsAtLocalCoordinates=function(Z,M,j){var K=this.getBoundingInfo(),b=this._internalAbstractMeshDataInfo._facetData,g=Math.floor((Z-K.minimum.x*b.partitioningBBoxRatio)*b.subDiv.X*b.partitioningBBoxRatio/b.bbSize.x),O=Math.floor((M-K.minimum.y*b.partitioningBBoxRatio)*b.subDiv.Y*b.partitioningBBoxRatio/b.bbSize.y),Q=Math.floor((j-K.minimum.z*b.partitioningBBoxRatio)*b.subDiv.Z*b.partitioningBBoxRatio/b.bbSize.z);return g<0||g>b.subDiv.max||O<0||O>b.subDiv.max||Q<0||Q>b.subDiv.max?null:b.facetPartitioning[g+b.subDiv.max*O+b.subDiv.max*b.subDiv.max*Q]},M.prototype.getClosestFacetAtCoordinates=function(Z,M,j,K,b,O){void 0===b&&(b=!1),void 0===O&&(O=!0);var Q=this.getWorldMatrix(),Y=g.e.Matrix[5];Q.invertToRef(Y);var I=g.e.Vector3[8];g.k.TransformCoordinatesFromFloatsToRef(Z,M,j,Y,I);var E=this.getClosestFacetAtLocalCoordinates(I.x,I.y,I.z,K,b,O);return K&&g.k.TransformCoordinatesFromFloatsToRef(K.x,K.y,K.z,Q,K),E},M.prototype.getClosestFacetAtLocalCoordinates=function(Z,M,j,K,b,g){void 0===b&&(b=!1),void 0===g&&(g=!0);var O=null,Q=0,Y=0,I=0,E=0,s=0,i=0,a=0,z=0,V=this.getFacetLocalPositions(),o=this.getFacetLocalNormals(),c=this.getFacetsAtLocalCoordinates(Z,M,j);if(!c)return null;for(var G,f,X,d=Number.MAX_VALUE,W=d,A=0;A<c.length;A++)f=o[G=c[A]],E=(Z-(X=V[G]).x)*f.x+(M-X.y)*f.y+(j-X.z)*f.z,(!b||b&&g&&E>=0||b&&!g&&E<=0)&&(E=f.x*X.x+f.y*X.y+f.z*X.z,s=-(f.x*Z+f.y*M+f.z*j-E)/(f.x*f.x+f.y*f.y+f.z*f.z),(W=(Q=(i=Z+f.x*s)-Z)*Q+(Y=(a=M+f.y*s)-M)*Y+(I=(z=j+f.z*s)-j)*I)<d&&(d=W,O=G,K&&(K.x=i,K.y=a,K.z=z)));return O},M.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},M.prototype.disableFacetData=function(){var Z=this._internalAbstractMeshDataInfo._facetData;return Z.facetDataEnabled&&(Z.facetDataEnabled=!1,Z.facetPositions=new Array,Z.facetNormals=new Array,Z.facetPartitioning=new Array,Z.facetParameters=null,Z.depthSortedIndices=new Uint32Array(0)),this},M.prototype.updateIndices=function(Z,M,j){return void 0===j&&(j=!1),this},M.prototype.createNormals=function(Z){var M,j=this.getVerticesData(Q.f.PositionKind),K=this.getIndices();return M=this.isVerticesDataPresent(Q.f.NormalKind)?this.getVerticesData(Q.f.NormalKind):[],Y.e.ComputeNormals(j,K,M,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(Q.f.NormalKind,M,Z),this},M.prototype.alignWithNormal=function(Z,M){M||(M=G.b.Y);var j=g.e.Vector3[0],K=g.e.Vector3[1];return g.k.CrossToRef(M,Z,K),g.k.CrossToRef(Z,K,j),this.rotationQuaternion?g.d.RotationQuaternionFromAxisToRef(j,Z,K,this.rotationQuaternion):g.k.RotationFromAxisToRef(j,Z,K,this.rotation),this},M.prototype._checkOcclusionQuery=function(){return!1},M.prototype.disableEdgesRendering=function(){throw(0,z.e)("EdgesRenderer")},M.prototype.enableEdgesRendering=function(Z,M,j){throw(0,z.e)("EdgesRenderer")},M.prototype.getConnectedParticleSystems=function(){var Z=this;return this._scene.particleSystems.filter((function(M){return M.emitter===Z}))},M.OCCLUSION_TYPE_NONE=0,M.OCCLUSION_TYPE_OPTIMISTIC=1,M.OCCLUSION_TYPE_STRICT=2,M.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,M.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,M.CULLINGSTRATEGY_STANDARD=0,M.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,M.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,M.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,M}(I.d);(0,f.c)("BABYLON.AbstractMesh",W)},3579:function(Z,M,j){"use strict";j.d(M,{e:function(){return V}});var K=j(80105),b=j(9488),g=j(85779),O=j(43251),Q=j(50384),Y=j(97964),I=j(97918),E=j(9217),s=j(45883),i=j(18445),a=j(78588),z=j(20334),V=function(){function Z(Z,M,j,K,b){void 0===K&&(K=!1),void 0===b&&(b=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=M||a.e.LastCreatedScene,this._scene&&(this.id=Z,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=K,j?this.setAllVerticesData(j,K):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),b&&(this.applyToMesh(b),b.computeWorldMatrix(!0)))}return Object.defineProperty(Z.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(Z){this._boundingBias?this._boundingBias.copyFrom(Z):this._boundingBias=Z.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),Z.CreateGeometryForMesh=function(M){var j=new Z(Z.RandomId(),M.getScene());return j.applyToMesh(M),j},Object.defineProperty(Z.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),Z.prototype.getScene=function(){return this._scene},Z.prototype.getEngine=function(){return this._engine},Z.prototype.isReady=function(){return 1===this.delayLoadState||0===this.delayLoadState},Object.defineProperty(Z.prototype,"doNotSerialize",{get:function(){for(var Z=0;Z<this._meshes.length;Z++)if(!this._meshes[Z].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),Z.prototype._rebuild=function(){for(var Z in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),this._vertexBuffers){this._vertexBuffers[Z]._rebuild()}},Z.prototype.setAllVerticesData=function(Z,M){Z.applyToGeometry(this,M),this._notifyUpdate()},Z.prototype.setVerticesData=function(Z,M,j,K){void 0===j&&(j=!1),j&&Array.isArray(M)&&(M=new Float32Array(M));var b=new O.f(this._engine,M,Z,j,0===this._meshes.length,K);this.setVerticesBuffer(b)},Z.prototype.removeVerticesData=function(Z){this._vertexBuffers[Z]&&(this._vertexBuffers[Z].dispose(),delete this._vertexBuffers[Z]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()},Z.prototype.setVerticesBuffer=function(Z,M,j){void 0===M&&(M=null),void 0===j&&(j=!0);var K=Z.getKind();this._vertexBuffers[K]&&j&&this._vertexBuffers[K].dispose(),Z._buffer&&Z._buffer._increaseReferences(),this._vertexBuffers[K]=Z;var b=this._meshes,g=b.length;if(K===O.f.PositionKind){var Q=Z.getData();null!=M?this._totalVertices=M:null!=Q&&(this._totalVertices=Q.length/(Z.type===O.f.BYTE?Z.byteStride:Z.byteStride/4)),this._updateExtend(Q),this._resetPointsArrayCache();for(var Y=0;Y<g;Y++){var I=b[Y];I.buildBoundingInfo(this._extend.minimum,this._extend.maximum),I._createGlobalSubMesh(I.isUnIndexed),I.computeWorldMatrix(!0),I.synchronizeInstances()}}this._notifyUpdate(K)},Z.prototype.updateVerticesDataDirectly=function(Z,M,j,K){void 0===K&&(K=!1);var b=this.getVertexBuffer(Z);b&&(b.updateDirectly(M,j,K),this._notifyUpdate(Z))},Z.prototype.updateVerticesData=function(Z,M,j){void 0===j&&(j=!1);var K=this.getVertexBuffer(Z);K&&(K.update(M),Z===O.f.PositionKind&&this._updateBoundingInfo(j,M),this._notifyUpdate(Z))},Z.prototype._updateBoundingInfo=function(Z,M){if(Z&&this._updateExtend(M),this._resetPointsArrayCache(),Z)for(var j=0,K=this._meshes;j<K.length;j++){var b=K[j];b.hasBoundingInfo?b.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):b.buildBoundingInfo(this._extend.minimum,this._extend.maximum);for(var g=0,O=b.subMeshes;g<O.length;g++){O[g].refreshBoundingInfo()}}},Z.prototype._bind=function(Z,M,j,K){if(Z){void 0===M&&(M=this._indexBuffer);var b=this.getVertexBuffers();if(b)if(M==this._indexBuffer&&(this._vertexArrayObjects||K)){var g=K||this._vertexArrayObjects;g[Z.key]||(g[Z.key]=this._engine.recordVertexArrayObject(b,M,Z,j)),this._engine.bindVertexArrayObject(g[Z.key],M)}else this._engine.bindBuffers(b,M,Z,j)}},Z.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},Z.prototype.getVerticesData=function(Z,M,j){var K=this.getVertexBuffer(Z);return K?K.getFloatData(this._totalVertices,j||M&&1!==this._meshes.length):null},Z.prototype.isVertexBufferUpdatable=function(Z){var M=this._vertexBuffers[Z];return!!M&&M.isUpdatable()},Z.prototype.getVertexBuffer=function(Z){return this.isReady()?this._vertexBuffers[Z]:null},Z.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},Z.prototype.isVerticesDataPresent=function(Z){return this._vertexBuffers?void 0!==this._vertexBuffers[Z]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(Z)},Z.prototype.getVerticesDataKinds=function(){var Z,M=[];if(!this._vertexBuffers&&this._delayInfo)for(Z in this._delayInfo)M.push(Z);else for(Z in this._vertexBuffers)M.push(Z);return M},Z.prototype.updateIndices=function(Z,M,j){if(void 0===j&&(j=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var K=Z.length!==this._indices.length;if(j||(this._indices=Z.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,Z,M),K)for(var b=0,g=this._meshes;b<g.length;b++){g[b]._createGlobalSubMesh(!0)}}else this.setIndices(Z,null,!0)},Z.prototype.setIndices=function(Z,M,j){void 0===M&&(M=null),void 0===j&&(j=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=Z,this._indexBufferIsUpdatable=j,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,j)),void 0!=M&&(this._totalVertices=M);for(var K=0,b=this._meshes;K<b.length;K++){var g=b[K];g._createGlobalSubMesh(!0),g.synchronizeInstances()}this._notifyUpdate()},Z.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},Z.prototype.getIndices=function(Z,M){if(!this.isReady())return null;var j=this._indices;return M||Z&&1!==this._meshes.length?j.slice():j},Z.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},Z.prototype._releaseVertexArrayObject=function(Z){void 0===Z&&(Z=null),Z&&this._vertexArrayObjects&&this._vertexArrayObjects[Z.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[Z.key]),delete this._vertexArrayObjects[Z.key])},Z.prototype.releaseForMesh=function(Z,M){var j=this._meshes,K=j.indexOf(Z);-1!==K&&(j.splice(K,1),this._vertexArrayObjects&&Z._invalidateInstanceVertexArrayObject(),Z._geometry=null,0===j.length&&M&&this.dispose())},Z.prototype.applyToMesh=function(Z){if(Z._geometry!==this){var M=Z._geometry;M&&M.releaseForMesh(Z),this._vertexArrayObjects&&Z._invalidateInstanceVertexArrayObject();var j=this._meshes;Z._geometry=this,Z._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),j.push(Z),this.isReady()?this._applyToMesh(Z):this._boundingInfo&&Z.setBoundingInfo(this._boundingInfo)}},Z.prototype._updateExtend=function(Z){if(void 0===Z&&(Z=null),this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!Z&&!(Z=this.getVerticesData(O.f.PositionKind)))return;this._extend=(0,i.d)(Z,0,this._totalVertices,this.boundingBias,3)}},Z.prototype._applyToMesh=function(Z){var M=this._meshes.length;for(var j in this._vertexBuffers)1===M&&this._vertexBuffers[j].create(),j===O.f.PositionKind&&(this._extend||this._updateExtend(),Z.buildBoundingInfo(this._extend.minimum,this._extend.maximum),Z._createGlobalSubMesh(Z.isUnIndexed),Z._updateBoundingInfo());1===M&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),Z._syncGeometryWithMorphTargetManager(),Z.synchronizeInstances()},Z.prototype._notifyUpdate=function(Z){this.onGeometryUpdated&&this.onGeometryUpdated(this,Z),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(var M=0,j=this._meshes;M<j.length;M++){j[M]._markSubMeshesAsAttributesDirty()}},Z.prototype.load=function(Z,M){2!==this.delayLoadState&&(this.isReady()?M&&M():(this.delayLoadState=2,this._queueLoad(Z,M)))},Z.prototype._queueLoad=function(Z,M){var j=this;this.delayLoadingFile&&(Z._addPendingData(this),Z._loadFile(this.delayLoadingFile,(function(K){if(j._delayLoadingFunction){j._delayLoadingFunction(JSON.parse(K),j),j.delayLoadState=1,j._delayInfo=[],Z._removePendingData(j);for(var b=j._meshes,g=b.length,O=0;O<g;O++)j._applyToMesh(b[O]);M&&M()}}),void 0,!0))},Z.prototype.toLeftHanded=function(){var Z=this.getIndices(!1);if(null!=Z&&Z.length>0){for(var M=0;M<Z.length;M+=3){var j=Z[M+0];Z[M+0]=Z[M+2],Z[M+2]=j}this.setIndices(Z)}var K=this.getVerticesData(O.f.PositionKind,!1);if(null!=K&&K.length>0){for(M=0;M<K.length;M+=3)K[M+2]=-K[M+2];this.setVerticesData(O.f.PositionKind,K,!1)}var b=this.getVerticesData(O.f.NormalKind,!1);if(null!=b&&b.length>0){for(M=0;M<b.length;M+=3)b[M+2]=-b[M+2];this.setVerticesData(O.f.NormalKind,b,!1)}},Z.prototype._resetPointsArrayCache=function(){this._positions=null},Z.prototype._generatePointsArray=function(){if(this._positions)return!0;var Z=this.getVerticesData(O.f.PositionKind);if(!Z||0===Z.length)return!1;for(var M=3*this._positionsCache.length,j=this._positionsCache.length;M<Z.length;M+=3,++j)this._positionsCache[j]=K.k.FromArray(Z,M);for(M=0,j=0;M<Z.length;M+=3,++j)this._positionsCache[j].set(Z[0+M],Z[1+M],Z[2+M]);return this._positionsCache.length=Z.length/3,this._positions=this._positionsCache,!0},Z.prototype.isDisposed=function(){return this._isDisposed},Z.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var Z in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[Z]);this._vertexArrayObjects={};for(var M=this._meshes,j=M.length,K=0;K<j;K++)M[K]._invalidateInstanceVertexArrayObject()}},Z.prototype.dispose=function(){var Z,M=this._meshes,j=M.length;for(Z=0;Z<j;Z++)this.releaseForMesh(M[Z]);for(var K in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[K].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){var b=this._parentContainer.geometries.indexOf(this);b>-1&&this._parentContainer.geometries.splice(b,1),this._parentContainer=null}this._isDisposed=!0},Z.prototype.copy=function(M){var j=new g.e;j.indices=[];var K=this.getIndices();if(K)for(var b=0;b<K.length;b++)j.indices.push(K[b]);var O,Q=!1,Y=!1;for(O in this._vertexBuffers){var E=this.getVerticesData(O);if(E&&(E instanceof Float32Array?j.set(new Float32Array(E),O):j.set(E.slice(0),O),!Y)){var s=this.getVertexBuffer(O);s&&(Y=!(Q=s.isUpdatable()))}}var i=new Z(M,this._scene,j,Q);for(O in i.delayLoadState=this.delayLoadState,i.delayLoadingFile=this.delayLoadingFile,i._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)i._delayInfo=i._delayInfo||[],i._delayInfo.push(O);return i._boundingInfo=new I.c(this._extend.minimum,this._extend.maximum),i},Z.prototype.serialize=function(){var Z={};return Z.id=this.id,Z.uniqueId=this.uniqueId,Z.updatable=this._updatable,s.d&&s.d.HasTags(this)&&(Z.tags=s.d.GetTags(this)),Z},Z.prototype._toNumberArray=function(Z){return Array.isArray(Z)?Z:Array.prototype.slice.call(Z)},Z.prototype.clearCachedData=function(){for(var Z in this._indices=[],this._resetPointsArrayCache(),this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,Z)&&(this._vertexBuffers[Z]._buffer._data=null)},Z.prototype.serializeVerticeData=function(){var Z=this.serialize();return this.isVerticesDataPresent(O.f.PositionKind)&&(Z.positions=this._toNumberArray(this.getVerticesData(O.f.PositionKind)),this.isVertexBufferUpdatable(O.f.PositionKind)&&(Z.positions._updatable=!0)),this.isVerticesDataPresent(O.f.NormalKind)&&(Z.normals=this._toNumberArray(this.getVerticesData(O.f.NormalKind)),this.isVertexBufferUpdatable(O.f.NormalKind)&&(Z.normals._updatable=!0)),this.isVerticesDataPresent(O.f.TangentKind)&&(Z.tangents=this._toNumberArray(this.getVerticesData(O.f.TangentKind)),this.isVertexBufferUpdatable(O.f.TangentKind)&&(Z.tangents._updatable=!0)),this.isVerticesDataPresent(O.f.UVKind)&&(Z.uvs=this._toNumberArray(this.getVerticesData(O.f.UVKind)),this.isVertexBufferUpdatable(O.f.UVKind)&&(Z.uvs._updatable=!0)),this.isVerticesDataPresent(O.f.UV2Kind)&&(Z.uv2s=this._toNumberArray(this.getVerticesData(O.f.UV2Kind)),this.isVertexBufferUpdatable(O.f.UV2Kind)&&(Z.uv2s._updatable=!0)),this.isVerticesDataPresent(O.f.UV3Kind)&&(Z.uv3s=this._toNumberArray(this.getVerticesData(O.f.UV3Kind)),this.isVertexBufferUpdatable(O.f.UV3Kind)&&(Z.uv3s._updatable=!0)),this.isVerticesDataPresent(O.f.UV4Kind)&&(Z.uv4s=this._toNumberArray(this.getVerticesData(O.f.UV4Kind)),this.isVertexBufferUpdatable(O.f.UV4Kind)&&(Z.uv4s._updatable=!0)),this.isVerticesDataPresent(O.f.UV5Kind)&&(Z.uv5s=this._toNumberArray(this.getVerticesData(O.f.UV5Kind)),this.isVertexBufferUpdatable(O.f.UV5Kind)&&(Z.uv5s._updatable=!0)),this.isVerticesDataPresent(O.f.UV6Kind)&&(Z.uv6s=this._toNumberArray(this.getVerticesData(O.f.UV6Kind)),this.isVertexBufferUpdatable(O.f.UV6Kind)&&(Z.uv6s._updatable=!0)),this.isVerticesDataPresent(O.f.ColorKind)&&(Z.colors=this._toNumberArray(this.getVerticesData(O.f.ColorKind)),this.isVertexBufferUpdatable(O.f.ColorKind)&&(Z.colors._updatable=!0)),this.isVerticesDataPresent(O.f.MatricesIndicesKind)&&(Z.matricesIndices=this._toNumberArray(this.getVerticesData(O.f.MatricesIndicesKind)),Z.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(O.f.MatricesIndicesKind)&&(Z.matricesIndices._updatable=!0)),this.isVerticesDataPresent(O.f.MatricesWeightsKind)&&(Z.matricesWeights=this._toNumberArray(this.getVerticesData(O.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(O.f.MatricesWeightsKind)&&(Z.matricesWeights._updatable=!0)),Z.indices=this._toNumberArray(this.getIndices()),Z},Z.ExtractFromMesh=function(Z,M){var j=Z._geometry;return j?j.copy(M):null},Z.RandomId=function(){return E.d.RandomId()},Z._GetGeometryByLoadedUniqueId=function(Z,M){for(var j=0;j<M.geometries.length;j++)if(M.geometries[j]._loadedUniqueId===Z)return M.geometries[j];return null},Z._ImportGeometry=function(M,j){var K=j.getScene(),g=M.geometryUniqueId,Y=M.geometryId;if(g||Y){var I=g?this._GetGeometryByLoadedUniqueId(g,K):K.getGeometryById(Y);I&&I.applyToMesh(j)}else if(M instanceof ArrayBuffer){var E=j._binaryInfo;if(E.positionsAttrDesc&&E.positionsAttrDesc.count>0){var s=new Float32Array(M,E.positionsAttrDesc.offset,E.positionsAttrDesc.count);j.setVerticesData(O.f.PositionKind,s,!1)}if(E.normalsAttrDesc&&E.normalsAttrDesc.count>0){var i=new Float32Array(M,E.normalsAttrDesc.offset,E.normalsAttrDesc.count);j.setVerticesData(O.f.NormalKind,i,!1)}if(E.tangetsAttrDesc&&E.tangetsAttrDesc.count>0){var a=new Float32Array(M,E.tangetsAttrDesc.offset,E.tangetsAttrDesc.count);j.setVerticesData(O.f.TangentKind,a,!1)}if(E.uvsAttrDesc&&E.uvsAttrDesc.count>0){var V=new Float32Array(M,E.uvsAttrDesc.offset,E.uvsAttrDesc.count);if(z.e.UseOpenGLOrientationForUV)for(var o=1;o<V.length;o+=2)V[o]=1-V[o];j.setVerticesData(O.f.UVKind,V,!1)}if(E.uvs2AttrDesc&&E.uvs2AttrDesc.count>0){var c=new Float32Array(M,E.uvs2AttrDesc.offset,E.uvs2AttrDesc.count);if(z.e.UseOpenGLOrientationForUV)for(o=1;o<c.length;o+=2)c[o]=1-c[o];j.setVerticesData(O.f.UV2Kind,c,!1)}if(E.uvs3AttrDesc&&E.uvs3AttrDesc.count>0){var G=new Float32Array(M,E.uvs3AttrDesc.offset,E.uvs3AttrDesc.count);if(z.e.UseOpenGLOrientationForUV)for(o=1;o<G.length;o+=2)G[o]=1-G[o];j.setVerticesData(O.f.UV3Kind,G,!1)}if(E.uvs4AttrDesc&&E.uvs4AttrDesc.count>0){var f=new Float32Array(M,E.uvs4AttrDesc.offset,E.uvs4AttrDesc.count);if(z.e.UseOpenGLOrientationForUV)for(o=1;o<f.length;o+=2)f[o]=1-f[o];j.setVerticesData(O.f.UV4Kind,f,!1)}if(E.uvs5AttrDesc&&E.uvs5AttrDesc.count>0){var X=new Float32Array(M,E.uvs5AttrDesc.offset,E.uvs5AttrDesc.count);if(z.e.UseOpenGLOrientationForUV)for(o=1;o<X.length;o+=2)X[o]=1-X[o];j.setVerticesData(O.f.UV5Kind,X,!1)}if(E.uvs6AttrDesc&&E.uvs6AttrDesc.count>0){var d=new Float32Array(M,E.uvs6AttrDesc.offset,E.uvs6AttrDesc.count);if(z.e.UseOpenGLOrientationForUV)for(o=1;o<d.length;o+=2)d[o]=1-d[o];j.setVerticesData(O.f.UV6Kind,d,!1)}if(E.colorsAttrDesc&&E.colorsAttrDesc.count>0){var W=new Float32Array(M,E.colorsAttrDesc.offset,E.colorsAttrDesc.count);j.setVerticesData(O.f.ColorKind,W,!1,E.colorsAttrDesc.stride)}if(E.matricesIndicesAttrDesc&&E.matricesIndicesAttrDesc.count>0){for(var A=new Int32Array(M,E.matricesIndicesAttrDesc.offset,E.matricesIndicesAttrDesc.count),q=[],T=0;T<A.length;T++){o=A[T];q.push(255&o),q.push((65280&o)>>8),q.push((16711680&o)>>16),q.push(o>>24&255)}j.setVerticesData(O.f.MatricesIndicesKind,q,!1)}if(E.matricesIndicesExtraAttrDesc&&E.matricesIndicesExtraAttrDesc.count>0){for(A=new Int32Array(M,E.matricesIndicesExtraAttrDesc.offset,E.matricesIndicesExtraAttrDesc.count),q=[],T=0;T<A.length;T++){o=A[T];q.push(255&o),q.push((65280&o)>>8),q.push((16711680&o)>>16),q.push(o>>24&255)}j.setVerticesData(O.f.MatricesIndicesExtraKind,q,!1)}if(E.matricesWeightsAttrDesc&&E.matricesWeightsAttrDesc.count>0){var B=new Float32Array(M,E.matricesWeightsAttrDesc.offset,E.matricesWeightsAttrDesc.count);j.setVerticesData(O.f.MatricesWeightsKind,B,!1)}if(E.indicesAttrDesc&&E.indicesAttrDesc.count>0){var N=new Int32Array(M,E.indicesAttrDesc.offset,E.indicesAttrDesc.count);j.setIndices(N,null)}if(E.subMeshesAttrDesc&&E.subMeshesAttrDesc.count>0){var U=new Int32Array(M,E.subMeshesAttrDesc.offset,5*E.subMeshesAttrDesc.count);j.subMeshes=[];for(T=0;T<E.subMeshesAttrDesc.count;T++){var n=U[5*T+0],k=U[5*T+1],x=U[5*T+2],R=U[5*T+3],e=U[5*T+4];Q.b.AddToMesh(n,k,x,R,e,j)}}}else if(M.positions&&M.normals&&M.indices){if(j.setVerticesData(O.f.PositionKind,M.positions,M.positions._updatable),j.setVerticesData(O.f.NormalKind,M.normals,M.normals._updatable),M.tangents&&j.setVerticesData(O.f.TangentKind,M.tangents,M.tangents._updatable),M.uvs&&j.setVerticesData(O.f.UVKind,M.uvs,M.uvs._updatable),M.uvs2&&j.setVerticesData(O.f.UV2Kind,M.uvs2,M.uvs2._updatable),M.uvs3&&j.setVerticesData(O.f.UV3Kind,M.uvs3,M.uvs3._updatable),M.uvs4&&j.setVerticesData(O.f.UV4Kind,M.uvs4,M.uvs4._updatable),M.uvs5&&j.setVerticesData(O.f.UV5Kind,M.uvs5,M.uvs5._updatable),M.uvs6&&j.setVerticesData(O.f.UV6Kind,M.uvs6,M.uvs6._updatable),M.colors&&j.setVerticesData(O.f.ColorKind,b.g.CheckColors4(M.colors,M.positions.length/3),M.colors._updatable),M.matricesIndices)if(M.matricesIndices._isExpanded)delete M.matricesIndices._isExpanded,j.setVerticesData(O.f.MatricesIndicesKind,M.matricesIndices,M.matricesIndices._updatable);else{for(q=[],T=0;T<M.matricesIndices.length;T++){var u=M.matricesIndices[T];q.push(255&u),q.push((65280&u)>>8),q.push((16711680&u)>>16),q.push(u>>24&255)}j.setVerticesData(O.f.MatricesIndicesKind,q,M.matricesIndices._updatable)}if(M.matricesIndicesExtra)if(M.matricesIndicesExtra._isExpanded)delete M.matricesIndices._isExpanded,j.setVerticesData(O.f.MatricesIndicesExtraKind,M.matricesIndicesExtra,M.matricesIndicesExtra._updatable);else{for(q=[],T=0;T<M.matricesIndicesExtra.length;T++){u=M.matricesIndicesExtra[T];q.push(255&u),q.push((65280&u)>>8),q.push((16711680&u)>>16),q.push(u>>24&255)}j.setVerticesData(O.f.MatricesIndicesExtraKind,q,M.matricesIndicesExtra._updatable)}M.matricesWeights&&(Z._CleanMatricesWeights(M,j),j.setVerticesData(O.f.MatricesWeightsKind,M.matricesWeights,M.matricesWeights._updatable)),M.matricesWeightsExtra&&j.setVerticesData(O.f.MatricesWeightsExtraKind,M.matricesWeightsExtra,M.matricesWeights._updatable),j.setIndices(M.indices,null)}if(M.subMeshes){j.subMeshes=[];for(var F=0;F<M.subMeshes.length;F++){var C=M.subMeshes[F];Q.b.AddToMesh(C.materialIndex,C.verticesStart,C.verticesCount,C.indexStart,C.indexCount,j)}}j._shouldGenerateFlatShading&&(j.convertToFlatShadedMesh(),j._shouldGenerateFlatShading=!1),j.computeWorldMatrix(!0),K.onMeshImportedObservable.notifyObservers(j)},Z._CleanMatricesWeights=function(Z,M){var j=.001;if(Y.e.CleanBoneMatrixWeights){var K=0;if(Z.skeletonId>-1){var b=M.getScene().getLastSkeletonById(Z.skeletonId);if(b){K=b.bones.length;for(var g=M.getVerticesData(O.f.MatricesIndicesKind),Q=M.getVerticesData(O.f.MatricesIndicesExtraKind),I=Z.matricesWeights,E=Z.matricesWeightsExtra,s=Z.numBoneInfluencer,i=I.length,a=0;a<i;a+=4){for(var z=0,V=-1,o=0;o<4;o++){z+=c=I[a+o],c<j&&V<0&&(V=o)}if(E)for(o=0;o<4;o++){var c;z+=c=E[a+o],c<j&&V<0&&(V=o+4)}if((V<0||V>s-1)&&(V=s-1),z>j){var G=1/z;for(o=0;o<4;o++)I[a+o]*=G;if(E)for(o=0;o<4;o++)E[a+o]*=G}else V>=4?(E[a+V-4]=1-z,Q[a+V-4]=K):(I[a+V]=1-z,g[a+V]=K)}M.setVerticesData(O.f.MatricesIndicesKind,g),Z.matricesWeightsExtra&&M.setVerticesData(O.f.MatricesIndicesExtraKind,Q)}}}},Z.Parse=function(M,j,b){var Q=new Z(M.id,j,void 0,M.updatable);return Q._loadedUniqueId=M.uniqueId,s.d&&s.d.AddTagsTo(Q,M.tags),M.delayLoadingFile?(Q.delayLoadState=4,Q.delayLoadingFile=b+M.delayLoadingFile,Q._boundingInfo=new I.c(K.k.FromArray(M.boundingBoxMinimum),K.k.FromArray(M.boundingBoxMaximum)),Q._delayInfo=[],M.hasUVs&&Q._delayInfo.push(O.f.UVKind),M.hasUVs2&&Q._delayInfo.push(O.f.UV2Kind),M.hasUVs3&&Q._delayInfo.push(O.f.UV3Kind),M.hasUVs4&&Q._delayInfo.push(O.f.UV4Kind),M.hasUVs5&&Q._delayInfo.push(O.f.UV5Kind),M.hasUVs6&&Q._delayInfo.push(O.f.UV6Kind),M.hasColors&&Q._delayInfo.push(O.f.ColorKind),M.hasMatricesIndices&&Q._delayInfo.push(O.f.MatricesIndicesKind),M.hasMatricesWeights&&Q._delayInfo.push(O.f.MatricesWeightsKind),Q._delayLoadingFunction=g.e.ImportVertexData):g.e.ImportVertexData(M,Q),j.pushGeometry(Q,!0),Q},Z}()},35941:function(Z,M,j){"use strict";j.d(M,{d:function(){return s}});var K=j(40061),b=j(80105),g=j(9127),O=j(52644),Q=j(65847),Y=j(51004),I=j(77129),E=j(43251);Q.b._instancedMeshFactory=function(Z,M){var j=new s(Z,M);if(M.instancedBuffers)for(var K in j.instancedBuffers={},M.instancedBuffers)j.instancedBuffers[K]=M.instancedBuffers[K];return j};var s=function(Z){function M(M,j){var K=Z.call(this,M,j.getScene())||this;K._indexInSourceMeshInstanceArray=-1,K._distanceToCamera=0,j.addInstance(K),K._sourceMesh=j,K._unIndexed=j._unIndexed,K.position.copyFrom(j.position),K.rotation.copyFrom(j.rotation),K.scaling.copyFrom(j.scaling),j.rotationQuaternion&&(K.rotationQuaternion=j.rotationQuaternion.clone()),K.animations=j.animations.slice();for(var b=0,g=j.getAnimationRanges();b<g.length;b++){var O=g[b];null!=O&&K.createAnimationRange(O.name,O.from,O.to)}return K.infiniteDistance=j.infiniteDistance,K.setPivotMatrix(j.getPivotMatrix()),K.refreshBoundingInfo(!0,!0),K._syncSubMeshes(),K}return(0,K.m)(M,Z),M.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(M.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!1,configurable:!0}),M.prototype._resyncLightSources=function(){},M.prototype._resyncLightSource=function(){},M.prototype._removeLightSource=function(){},Object.defineProperty(M.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(Z){this._sourceMesh&&Z!==this._sourceMesh.renderingGroupId&&g.c.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!1,configurable:!0}),M.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},M.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(M.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!1,configurable:!0}),M.prototype.createInstance=function(Z){return this._sourceMesh.createInstance(Z)},M.prototype.isReady=function(Z){return void 0===Z&&(Z=!1),this._sourceMesh.isReady(Z,!0)},M.prototype.getVerticesData=function(Z,M){return this._sourceMesh.getVerticesData(Z,M)},M.prototype.setVerticesData=function(Z,M,j,K){return this.sourceMesh&&this.sourceMesh.setVerticesData(Z,M,j,K),this.sourceMesh},M.prototype.updateVerticesData=function(Z,M,j,K){return this.sourceMesh&&this.sourceMesh.updateVerticesData(Z,M,j,K),this.sourceMesh},M.prototype.setIndices=function(Z,M){return void 0===M&&(M=null),this.sourceMesh&&this.sourceMesh.setIndices(Z,M),this.sourceMesh},M.prototype.isVerticesDataPresent=function(Z){return this._sourceMesh.isVerticesDataPresent(Z)},M.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(M.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!1,configurable:!0}),M.prototype.refreshBoundingInfo=function(Z,M){if(void 0===Z&&(Z=!1),void 0===M&&(M=!1),this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var j=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(Z,M),j),this},M.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},M.prototype._activate=function(M,j){if(Z.prototype._activate.call(this,M,j),this._sourceMesh.subMeshes||g.c.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,M),j){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},M.prototype._postActivate=function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},M.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==I.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new b.c);var M=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,b.e.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(b.e.Vector3[7]),this._currentLOD._masterMesh=M,this._billboardWorldMatrix}return Z.prototype.getWorldMatrix.call(this)},Object.defineProperty(M.prototype,"isAnInstance",{get:function(){return!0},enumerable:!1,configurable:!0}),M.prototype.getLOD=function(Z){if(!Z)return this;var M=this.sourceMesh.getLODLevels();if(M&&0!==M.length){var j=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(Z,j.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD},M.prototype._preActivateForIntermediateRendering=function(Z){return this.sourceMesh._preActivateForIntermediateRendering(Z)},M.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var Z=0;Z<this._sourceMesh.subMeshes.length;Z++)this._sourceMesh.subMeshes[Z].clone(this,this._sourceMesh);return this},M.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},M.prototype._updateBoundingInfo=function(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},M.prototype.clone=function(Z,M,j){void 0===M&&(M=null);var K=this._sourceMesh.createInstance(Z);if(Y.d.DeepCopy(this,K,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),M&&(K.parent=M),!j)for(var b=0;b<this.getScene().meshes.length;b++){var g=this.getScene().meshes[b];g.parent===this&&g.clone(g.name,K)}return K.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(K),K},M.prototype.dispose=function(M,j){void 0===j&&(j=!1),this._sourceMesh.removeInstance(this),Z.prototype.dispose.call(this,M,j)},M.prototype._serializeAsParent=function(M){Z.prototype._serializeAsParent.call(this,M),M.parentId=this._sourceMesh.uniqueId,M.parentInstanceIndex=this._indexInSourceMeshInstanceArray},M}(O.b);Q.b.prototype.registerInstancedBuffer=function(Z,M){var j,K;if(null===(K=null===(j=this._userInstancedBuffersStorage)||void 0===j?void 0:j.vertexBuffers[Z])||void 0===K||K.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(var b=0,g=this.instances;b<g.length;b++){g[b].instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0})}this.instancedBuffers[Z]=null,this._userInstancedBuffersStorage.strides[Z]=M,this._userInstancedBuffersStorage.sizes[Z]=32*M,this._userInstancedBuffersStorage.data[Z]=new Float32Array(this._userInstancedBuffersStorage.sizes[Z]),this._userInstancedBuffersStorage.vertexBuffers[Z]=new E.f(this.getEngine(),this._userInstancedBuffersStorage.data[Z],Z,!0,!1,M,!0);for(var O=0,Q=this.instances;O<Q.length;O++){Q[O].instancedBuffers[Z]=null}this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},Q.b.prototype._processInstancedBuffers=function(Z,M){var j=Z.length;for(var K in this.instancedBuffers){for(var b=this._userInstancedBuffersStorage.sizes[K],g=this._userInstancedBuffersStorage.strides[K],O=(j+1)*g;b<O;)b*=2;this._userInstancedBuffersStorage.data[K].length!=b&&(this._userInstancedBuffersStorage.data[K]=new Float32Array(b),this._userInstancedBuffersStorage.sizes[K]=b,this._userInstancedBuffersStorage.vertexBuffers[K]&&(this._userInstancedBuffersStorage.vertexBuffers[K].dispose(),this._userInstancedBuffersStorage.vertexBuffers[K]=null));var Q=this._userInstancedBuffersStorage.data[K],Y=0;if(M)(s=this.instancedBuffers[K]).toArray?s.toArray(Q,Y):s.copyToArray?s.copyToArray(Q,Y):Q[Y]=s,Y+=g;for(var I=0;I<j;I++){var s;(s=Z[I].instancedBuffers[K]).toArray?s.toArray(Q,Y):s.copyToArray?s.copyToArray(Q,Y):Q[Y]=s,Y+=g}this._userInstancedBuffersStorage.vertexBuffers[K]?this._userInstancedBuffersStorage.vertexBuffers[K].updateDirectly(Q,0):(this._userInstancedBuffersStorage.vertexBuffers[K]=new E.f(this.getEngine(),this._userInstancedBuffersStorage.data[K],K,!0,!1,g,!0),this._invalidateInstanceVertexArrayObject())}},Q.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(var Z in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[Z]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},Q.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var Z in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[Z]&&this._userInstancedBuffersStorage.vertexBuffers[Z].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}}},65847:function(Z,M,j){"use strict";j.d(M,{b:function(){return x},e:function(){return B}});var K=j(40061),b=j(9271),g=j(9217),O=j(51004),Q=j(45883),Y=j(61633),I=j(80105),E=j(9488),s=j(74134),i=j(43251),a=j(85779),z=j(3579),V=j(52644),o=j(50384),c=j(46907),G=j(49443),f=j(97964),X=j(9892),d=j(9127),W=j(31709),A=j(50504),q=j(21693),T=function(Z,M){this.distanceOrScreenCoverage=Z,this.mesh=M},B=function(){},N=function(){this.visibleInstances={},this.batchCache=new U,this.batchCacheReplacementModeInFrozenMode=new U,this.instancesBufferSize=2048},U=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},n=function(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null},k=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0},x=function(Z){function M(j,K,g,Y,I,E){void 0===K&&(K=null),void 0===g&&(g=null),void 0===Y&&(Y=null),void 0===E&&(E=!0);var s=Z.call(this,j,K)||this;if(s._internalMeshDataInfo=new k,s.delayLoadState=0,s.instances=new Array,s._creationDataStorage=null,s._geometry=null,s._instanceDataStorage=new N,s._thinInstanceDataStorage=new n,s._shouldGenerateFlatShading=!1,s._originalBuilderSideOrientation=M.DEFAULTSIDE,s.overrideMaterialSideOrientation=null,s.ignoreCameraMaxZ=!1,K=s.getScene(),s._onBeforeDraw=function(Z,M,j){Z&&j&&(s._uniformBuffer?s.transferToEffect(M):j.bindOnlyWorldMatrix(M))},Y){if(Y._geometry&&Y._geometry.applyToMesh(s),O.d.DeepCopy(Y,s,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo"],["_poseMatrix"]),s._internalMeshDataInfo._source=Y,K.useClonedMeshMap&&(Y._internalMeshDataInfo.meshMap||(Y._internalMeshDataInfo.meshMap={}),Y._internalMeshDataInfo.meshMap[s.uniqueId]=s),s._originalBuilderSideOrientation=Y._originalBuilderSideOrientation,s._creationDataStorage=Y._creationDataStorage,Y._ranges){var i=Y._ranges;for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&s.createAnimationRange(a,i[a].from,i[a].to)}if(Y.metadata&&Y.metadata.clone?s.metadata=Y.metadata.clone():s.metadata=Y.metadata,Q.d&&Q.d.HasTags(Y)&&Q.d.AddTagsTo(s,Q.d.GetTags(Y,!0)),s.setEnabled(Y.isEnabled()),s.parent=Y.parent,s.setPivotMatrix(Y.getPivotMatrix()),s.id=j+"."+Y.id,s.material=Y.material,!I)for(var z=Y.getDescendants(!0),V=0;V<z.length;V++){var o=z[V];o.clone&&o.clone(j+"."+o.name,s)}if(Y.morphTargetManager&&(s.morphTargetManager=Y.morphTargetManager),K.getPhysicsEngine){var c=K.getPhysicsEngine();if(E&&c){var G=c.getImpostorForPhysicsObject(Y);G&&(s.physicsImpostor=G.clone(s))}}for(V=0;V<K.particleSystems.length;V++){var f=K.particleSystems[V];f.emitter===Y&&f.clone(f.name,s)}s.skeleton=Y.skeleton,s.refreshBoundingInfo(!0,!0),s.computeWorldMatrix(!0)}return null!==g&&(s.parent=g),s._instanceDataStorage.hardwareInstancedRendering=s.getEngine().getCaps().instancedArrays,s._internalMeshDataInfo._onMeshReadyObserverAdded=function(Z){Z.unregisterOnNextCall=!0,s.isReady(!0)?s.onMeshReadyObservable.notifyObservers(s):s._internalMeshDataInfo._checkReadinessObserver||(s._internalMeshDataInfo._checkReadinessObserver=s._scene.onBeforeRenderObservable.add((function(){s.isReady(!0)&&(s._scene.onBeforeRenderObservable.remove(s._internalMeshDataInfo._checkReadinessObserver),s._internalMeshDataInfo._checkReadinessObserver=null,s.onMeshReadyObservable.notifyObservers(s))})))},s.onMeshReadyObservable=new b.b(s._internalMeshDataInfo._onMeshReadyObserverAdded),Y&&Y.onClonedObservable.notifyObservers(s),s}return(0,K.m)(M,Z),M._GetDefaultSideOrientation=function(Z){return Z||M.FRONTSIDE},Object.defineProperty(M.prototype,"useLODScreenCoverage",{get:function(){return this._internalMeshDataInfo._useLODScreenCoverage},set:function(Z){this._internalMeshDataInfo._useLODScreenCoverage=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(Z){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==Z&&(Z&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(i.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(i.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=Z,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new b.b),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new b.b),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new b.b),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onBetweenPassObservable",{get:function(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new b.b),this._internalMeshDataInfo._onBetweenPassObservable},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new b.b),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onBeforeDraw",{set:function(Z){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"hasThinInstances",{get:function(){var Z;return(null!==(Z=this._thinInstanceDataStorage.instancesCount)&&void 0!==Z?Z:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"forcedInstanceCount",{get:function(){return this._internalMeshDataInfo._forcedInstanceCount},set:function(Z){this._internalMeshDataInfo._forcedInstanceCount=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(Z){this._unIndexed!==Z&&(this._unIndexed=Z,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"previousWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesPreviousData},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(Z){this._instanceDataStorage.manualUpdate=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"manualUpdateOfPreviousWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.previousManualUpdate},set:function(Z){this._instanceDataStorage.previousManualUpdate=Z},enumerable:!1,configurable:!0}),M.prototype.instantiateHierarchy=function(Z,M,j){void 0===Z&&(Z=null);var K=!(this.getTotalVertices()>0)||M&&M.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),Z||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));K.parent=Z||this.parent,K.position=this.position.clone(),K.scaling=this.scaling.clone(),this.rotationQuaternion?K.rotationQuaternion=this.rotationQuaternion.clone():K.rotation=this.rotation.clone(),j&&j(this,K);for(var b=0,g=this.getChildTransformNodes(!0);b<g.length;b++){g[b].instantiateHierarchy(K,M,j)}return K},M.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(M.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),M.prototype.toString=function(M){var j=Z.prototype.toString.call(this,M);if(j+=", n vertices: "+this.getTotalVertices(),j+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var K=0;K<this.animations.length;K++)j+=", animation[0]: "+this.animations[K].toString(M);if(M)if(this._geometry){var b=this.getIndices(),g=this.getVerticesData(i.f.PositionKind);g&&b&&(j+=", flat shading: "+(g.length/3===b.length?"YES":"NO"))}else j+=", flat shading: UNKNOWN";return j},M.prototype._unBindEffect=function(){Z.prototype._unBindEffect.call(this);for(var M=0,j=this.instances;M<j.length;M++){j[M]._unBindEffect()}},Object.defineProperty(M.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),M.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},M.prototype._sortLODLevels=function(){var Z=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort((function(M,j){return M.distanceOrScreenCoverage<j.distanceOrScreenCoverage?Z:M.distanceOrScreenCoverage>j.distanceOrScreenCoverage?-Z:0}))},M.prototype.addLODLevel=function(Z,M){if(M&&M._masterMesh)return d.c.Warn("You cannot use a mesh as LOD level twice"),this;var j=new T(Z,M);return this._internalMeshDataInfo._LODLevels.push(j),M&&(M._masterMesh=this),this._sortLODLevels(),this},M.prototype.getLODLevelAtDistance=function(Z){for(var M=this._internalMeshDataInfo,j=0;j<M._LODLevels.length;j++){var K=M._LODLevels[j];if(K.distanceOrScreenCoverage===Z)return K.mesh}return null},M.prototype.removeLODLevel=function(Z){for(var M=this._internalMeshDataInfo,j=0;j<M._LODLevels.length;j++)M._LODLevels[j].mesh===Z&&(M._LODLevels.splice(j,1),Z&&(Z._masterMesh=null));return this._sortLODLevels(),this},M.prototype.getLOD=function(Z,M){var j,K=this._internalMeshDataInfo;if(!K._LODLevels||0===K._LODLevels.length)return this;M?j=M:j=this.getBoundingInfo().boundingSphere;var b=j.centerWorld.subtract(Z.globalPosition).length(),g=b,O=1;if(K._useLODScreenCoverage){var Q=Z.screenArea,Y=j.radiusWorld*Z.minZ/b;g=(Y=Y*Y*Math.PI)/Q,O=-1}if(O*K._LODLevels[K._LODLevels.length-1].distanceOrScreenCoverage>O*g)return this.onLODLevelSelection&&this.onLODLevelSelection(g,this,this),this;for(var I=0;I<K._LODLevels.length;I++){var E=K._LODLevels[I];if(O*E.distanceOrScreenCoverage<O*g){if(E.mesh){if(4===E.mesh.delayLoadState)return E.mesh._checkDelayState(),this;if(2===E.mesh.delayLoadState)return this;E.mesh._preActivate(),E.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(g,this,E.mesh),E.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(g,this,this),this},Object.defineProperty(M.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),M.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},M.prototype.getVerticesData=function(Z,M,j){var K,b;if(!this._geometry)return null;var g=null===(b=null===(K=this._userInstancedBuffersStorage)||void 0===K?void 0:K.vertexBuffers[Z])||void 0===b?void 0:b.getFloatData(this._geometry.getTotalVertices(),j||M&&1!==this._geometry.meshes.length);return g||(g=this._geometry.getVerticesData(Z,M,j)),g},M.prototype.getVertexBuffer=function(Z){var M,j;return this._geometry?null!==(j=null===(M=this._userInstancedBuffersStorage)||void 0===M?void 0:M.vertexBuffers[Z])&&void 0!==j?j:this._geometry.getVertexBuffer(Z):null},M.prototype.isVerticesDataPresent=function(Z){var M;return this._geometry?void 0!==(null===(M=this._userInstancedBuffersStorage)||void 0===M?void 0:M.vertexBuffers[Z])||this._geometry.isVerticesDataPresent(Z):!!this._delayInfo&&-1!==this._delayInfo.indexOf(Z)},M.prototype.isVertexBufferUpdatable=function(Z){var M,j;return this._geometry?(null===(j=null===(M=this._userInstancedBuffersStorage)||void 0===M?void 0:M.vertexBuffers[Z])||void 0===j?void 0:j.isUpdatable())||this._geometry.isVertexBufferUpdatable(Z):!!this._delayInfo&&-1!==this._delayInfo.indexOf(Z)},M.prototype.getVerticesDataKinds=function(){if(!this._geometry){var Z=new Array;return this._delayInfo&&this._delayInfo.forEach((function(M){Z.push(M)})),Z}var M=this._geometry.getVerticesDataKinds();if(this._userInstancedBuffersStorage)for(var j in this._userInstancedBuffersStorage.vertexBuffers)M.push(j);return M},M.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},M.prototype.getIndices=function(Z,M){return this._geometry?this._geometry.getIndices(Z,M):[]},Object.defineProperty(M.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!1,configurable:!0}),M.prototype.isReady=function(M,j){var K,b,g,O,Q,Y;if(void 0===M&&(M=!1),void 0===j&&(j=!1),2===this.delayLoadState)return!1;if(!Z.prototype.isReady.call(this,M))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!M)return!0;var I=this.getEngine(),E=this.getScene(),s=j||I.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var i=this.material||E.defaultMaterial;if(i)if(i._storeEffectOnSubMeshes)for(var a=0,z=this.subMeshes;a<z.length;a++){var V=(W=z[a]).getMaterial();if(V)if(V._storeEffectOnSubMeshes){if(!V.isReadyForSubMesh(this,W,s))return!1}else if(!V.isReady(this,s))return!1}else if(!i.isReady(this,s))return!1;for(var o=I.currentRenderPassId,c=0,G=this.lightSources;c<G.length;c++){var f=G[c].getShadowGenerator();if(f&&(!(null===(K=f.getShadowMap())||void 0===K?void 0:K.renderList)||(null===(b=f.getShadowMap())||void 0===b?void 0:b.renderList)&&-1!==(null===(O=null===(g=f.getShadowMap())||void 0===g?void 0:g.renderList)||void 0===O?void 0:O.indexOf(this)))){f.getShadowMap()&&(I.currentRenderPassId=f.getShadowMap().renderPassId);for(var X=0,d=this.subMeshes;X<d.length;X++){var W=d[X];if(!f.isReady(W,s,null!==(Y=null===(Q=W.getMaterial())||void 0===Q?void 0:Q.needAlphaBlendingForMesh(this))&&void 0!==Y&&Y))return I.currentRenderPassId=o,!1}I.currentRenderPassId=o}}for(var A=0,q=this._internalMeshDataInfo._LODLevels;A<q.length;A++){var T=q[A];if(T.mesh&&!T.mesh.isReady(s))return!1}return!0},Object.defineProperty(M.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),M.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},M.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(M.prototype,"overridenInstanceCount",{set:function(Z){this._instanceDataStorage.overridenInstanceCount=Z},enumerable:!1,configurable:!0}),M.prototype._preActivate=function(){var Z=this._internalMeshDataInfo,M=this.getScene().getRenderId();return Z._preActivateId===M||(Z._preActivateId=M,this._instanceDataStorage.visibleInstances=null),this},M.prototype._preActivateForIntermediateRendering=function(Z){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=Z),this},M.prototype._registerInstanceForRenderId=function(Z,M){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:M,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[M]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=M,this._instanceDataStorage.visibleInstances[M]=new Array),this._instanceDataStorage.visibleInstances[M].push(Z),this},M.prototype._afterComputeWorldMatrix=function(){Z.prototype._afterComputeWorldMatrix.call(this),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},M.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},M.prototype.refreshBoundingInfo=function(Z,M){if(void 0===Z&&(Z=!1),void 0===M&&(M=!1),this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var j=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(Z,M),j),this},M.prototype._createGlobalSubMesh=function(Z){var M=this.getTotalVertices();if(!M||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var j=this.getIndices();if(!j)return null;var K=j.length,b=!1;if(Z)b=!0;else for(var g=0,O=this.subMeshes;g<O.length;g++){var Q=O[g];if(Q.indexStart+Q.indexCount>K){b=!0;break}if(Q.verticesStart+Q.verticesCount>M){b=!0;break}}if(!b)return this.subMeshes[0]}return this.releaseSubMeshes(),new o.b(0,0,M,0,this.getTotalIndices(),this)},M.prototype.subdivide=function(Z){if(!(Z<1)){for(var M=this.getTotalIndices(),j=M/Z|0,K=0;j%3!==0;)j++;this.releaseSubMeshes();for(var b=0;b<Z&&!(K>=M);b++)o.b.CreateFromIndices(0,K,b===Z-1?M-K:j,this),K+=j;this.synchronizeInstances()}},M.prototype.setVerticesData=function(Z,M,j,K){if(void 0===j&&(j=!1),this._geometry)this._geometry.setVerticesData(Z,M,j,K);else{var b=new a.e;b.set(M,Z);var g=this.getScene();new z.e(z.e.RandomId(),g,b,j,this)}return this},M.prototype.removeVerticesData=function(Z){this._geometry&&this._geometry.removeVerticesData(Z)},M.prototype.markVerticesDataAsUpdatable=function(Z,M){void 0===M&&(M=!0);var j=this.getVertexBuffer(Z);j&&j.isUpdatable()!==M&&this.setVerticesData(Z,this.getVerticesData(Z),M)},M.prototype.setVerticesBuffer=function(Z,M){return void 0===M&&(M=!0),this._geometry||(this._geometry=z.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(Z,null,M),this},M.prototype.updateVerticesData=function(Z,M,j,K){return this._geometry?(K?(this.makeGeometryUnique(),this.updateVerticesData(Z,M,j,!1)):this._geometry.updateVerticesData(Z,M,j),this):this},M.prototype.updateMeshPositions=function(Z,M){void 0===M&&(M=!0);var j=this.getVerticesData(i.f.PositionKind);if(!j)return this;if(Z(j),this.updateVerticesData(i.f.PositionKind,j,!1,!1),M){var K=this.getIndices(),b=this.getVerticesData(i.f.NormalKind);if(!b)return this;a.e.ComputeNormals(j,K,b),this.updateVerticesData(i.f.NormalKind,b,!1,!1)}return this},M.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;var Z=this._geometry,M=this._geometry.copy(z.e.RandomId());return Z.releaseForMesh(this,!0),M.applyToMesh(this),this},M.prototype.setIndices=function(Z,M,j){if(void 0===M&&(M=null),void 0===j&&(j=!1),this._geometry)this._geometry.setIndices(Z,M,j);else{var K=new a.e;K.indices=Z;var b=this.getScene();new z.e(z.e.RandomId(),b,K,j,this)}return this},M.prototype.updateIndices=function(Z,M,j){return void 0===j&&(j=!1),this._geometry?(this._geometry.updateIndices(Z,M,j),this):this},M.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},M.prototype._bind=function(Z,M,j){if(!this._geometry)return this;var K,b=this.getScene().getEngine();if(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(M),this._unIndexed)K=null;else switch(j){case c.d.PointFillMode:K=null;break;case c.d.WireFrameFillMode:K=Z._getLinesIndexBuffer(this.getIndices(),b);break;default:case c.d.TriangleFillMode:K=this._geometry.getIndexBuffer()}return!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(M,K):this._geometry._bind(M,K,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),this},M.prototype._draw=function(Z,M,j){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var K=this.getScene().getEngine();return this._unIndexed||M==c.d.PointFillMode?K.drawArraysType(M,Z.verticesStart,Z.verticesCount,this.forcedInstanceCount||j):M==c.d.WireFrameFillMode?K.drawElementsType(M,0,Z._linesIndexCount,this.forcedInstanceCount||j):K.drawElementsType(M,Z.indexStart,Z.indexCount,this.forcedInstanceCount||j),this},M.prototype.registerBeforeRender=function(Z){return this.onBeforeRenderObservable.add(Z),this},M.prototype.unregisterBeforeRender=function(Z){return this.onBeforeRenderObservable.removeCallback(Z),this},M.prototype.registerAfterRender=function(Z){return this.onAfterRenderObservable.add(Z),this},M.prototype.unregisterAfterRender=function(Z){return this.onAfterRenderObservable.removeCallback(Z),this},M.prototype._getInstancesRenderList=function(Z,M){if(void 0===M&&(M=!1),this._instanceDataStorage.isFrozen){if(M)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[Z]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[Z]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}var j=this.getScene(),K=j._isInIntermediateRendering(),b=K?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,g=this._instanceDataStorage.batchCache;if(g.mustReturn=!1,g.renderSelf[Z]=M||!b&&this.isEnabled()&&this.isVisible,g.visibleInstances[Z]=null,this._instanceDataStorage.visibleInstances&&!M){var O=this._instanceDataStorage.visibleInstances,Q=j.getRenderId(),Y=K?O.intermediateDefaultRenderId:O.defaultRenderId;g.visibleInstances[Z]=O[Q],!g.visibleInstances[Z]&&Y&&(g.visibleInstances[Z]=O[Y])}return g.hardwareInstancedRendering[Z]=!M&&this._instanceDataStorage.hardwareInstancedRendering&&null!==g.visibleInstances[Z]&&void 0!==g.visibleInstances[Z],this._instanceDataStorage.previousBatch=g,g},M.prototype._renderWithInstances=function(Z,j,K,b,g){var O,Q=K.visibleInstances[Z._id];if(!Q)return this;for(var Y=this._instanceDataStorage,E=Y.instancesBufferSize,s=Y.instancesBuffer,a=Y.instancesPreviousBuffer,z=16*(Q.length+1)*4;Y.instancesBufferSize<z;)Y.instancesBufferSize*=2;Y.instancesData&&E==Y.instancesBufferSize||(Y.instancesData=new Float32Array(Y.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!Y.instancesPreviousData||E!=Y.instancesBufferSize)&&(Y.instancesPreviousData=new Float32Array(Y.instancesBufferSize/4));var V=0,o=0,c=K.renderSelf[Z._id],G=!s||E!==Y.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!Y.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||Y.isFrozen&&!G)o=(c?1:0)+Q.length;else{var f=this.getWorldMatrix();if(c&&(this._scene.needsPreviousWorldMatrices&&(Y.masterMeshPreviousWorldMatrix?(Y.masterMeshPreviousWorldMatrix.copyToArray(Y.instancesPreviousData,V),Y.masterMeshPreviousWorldMatrix.copyFrom(f)):(Y.masterMeshPreviousWorldMatrix=f.clone(),Y.masterMeshPreviousWorldMatrix.copyToArray(Y.instancesPreviousData,V))),f.copyToArray(Y.instancesData,V),V+=16,o++),Q){if(M.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&(null===(O=Z.getMaterial())||void 0===O?void 0:O.needAlphaBlendingForMesh(Z.getRenderingMesh()))){for(var X=this._scene.activeCamera.globalPosition,d=0;d<Q.length;d++){var W=Q[d];W._distanceToCamera=I.k.Distance(W.getBoundingInfo().boundingSphere.centerWorld,X)}Q.sort((function(Z,M){return Z._distanceToCamera>M._distanceToCamera?-1:Z._distanceToCamera<M._distanceToCamera?1:0}))}for(d=0;d<Q.length;d++){var A=Q[d],q=A.getWorldMatrix();q.copyToArray(Y.instancesData,V),this._scene.needsPreviousWorldMatrices&&(A._previousWorldMatrix?(A._previousWorldMatrix.copyToArray(Y.instancesPreviousData,V),A._previousWorldMatrix.copyFrom(q)):(A._previousWorldMatrix=q.clone(),A._previousWorldMatrix.copyToArray(Y.instancesPreviousData,V))),V+=16,o++}}}return G?(s&&s.dispose(),a&&a.dispose(),s=new i.e(g,Y.instancesData,!0,16,!1,!0),Y.instancesBuffer=s,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=s.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=s.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=s.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=s.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(a=new i.e(g,Y.instancesPreviousData,!0,16,!1,!0),Y.instancesPreviousBuffer=a,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=a.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=a.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=a.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=a.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen||(s.updateDirectly(Y.instancesData,0,o),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||a.updateDirectly(Y.instancesPreviousData,0,o)),this._processInstancedBuffers(Q,c),this.getScene()._activeIndices.addCount(Z.indexCount*o,!1),g._currentDrawContext&&(g._currentDrawContext.useInstancing=!0),this._bind(Z,b,j),this._draw(Z,j,o),!this._scene.needsPreviousWorldMatrices||G||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen||this._instanceDataStorage.previousManualUpdate||a.updateDirectly(Y.instancesData,0,o),g.unbindInstanceAttributes(),this},M.prototype._renderWithThinInstances=function(Z,M,j,K){var b,g,O=null!==(g=null===(b=this._thinInstanceDataStorage)||void 0===b?void 0:b.instancesCount)&&void 0!==g?g:0;this.getScene()._activeIndices.addCount(Z.indexCount*O,!1),K._currentDrawContext&&(K._currentDrawContext.useInstancing=!0),this._bind(Z,j,M),this._draw(Z,M,O),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,O):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),K.unbindInstanceAttributes()},M.prototype._processInstancedBuffers=function(Z,M){},M.prototype._processRendering=function(Z,M,j,K,b,g,O,Q){var Y=this.getScene(),I=Y.getEngine();if(g&&M.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(M,K,j,I),this;if(g)this._renderWithInstances(M,K,b,j,I);else{I._currentDrawContext&&(I._currentDrawContext.useInstancing=!1);var E=0;b.renderSelf[M._id]&&(O&&O(!1,Z.getWorldMatrix(),Q),E++,this._draw(M,K,this._instanceDataStorage.overridenInstanceCount));var s=b.visibleInstances[M._id];if(s){var i=s.length;E+=i;for(var a=0;a<i;a++){var z=s[a].getWorldMatrix();O&&O(!0,z,Q),this._draw(M,K)}}Y._activeIndices.addCount(M.indexCount*E,!1)}return this},M.prototype._rebuild=function(M){if(void 0===M&&(M=!1),this._instanceDataStorage.instancesBuffer&&(M&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(var j in this._userInstancedBuffersStorage.vertexBuffers){var K=this._userInstancedBuffersStorage.vertexBuffers[j];K&&(M&&K.dispose(),this._userInstancedBuffersStorage.vertexBuffers[j]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,Z.prototype._rebuild.call(this,M)},M.prototype._freeze=function(){if(this.subMeshes){for(var Z=0;Z<this.subMeshes.length;Z++)this._getInstancesRenderList(Z);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},M.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},M.prototype.render=function(Z,M,j){var K,b,g,O=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;var Q=this._getInstancesRenderList(Z._id,!!j);if(Q.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var Y=O.getEngine(),I=0,E=null;this.ignoreCameraMaxZ&&O.activeCamera&&!O._isInIntermediateRendering()&&(I=O.activeCamera.maxZ,E=O.activeCamera,O.activeCamera.maxZ=0,O.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var s,i=Q.hardwareInstancedRendering[Z._id]||Z.getRenderingMesh().hasThinInstances,a=this._instanceDataStorage,z=Z.getMaterial();if(!z)return E&&(E.maxZ=I,O.updateTransformMatrix(!0)),this;if(a.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===z){if(z._storeEffectOnSubMeshes&&!(null===(K=Z.effect)||void 0===K?void 0:K._wasPreviouslyReady)||!z._storeEffectOnSubMeshes&&!(null===(b=z.getEffect())||void 0===b?void 0:b._wasPreviouslyReady))return E&&(E.maxZ=I,O.updateTransformMatrix(!0)),this}else{if(z._storeEffectOnSubMeshes){if(!z.isReadyForSubMesh(this,Z,i))return E&&(E.maxZ=I,O.updateTransformMatrix(!0)),this}else if(!z.isReady(this,i))return E&&(E.maxZ=I,O.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=z}M&&Y.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode);for(var V=null!==(g=null===(s=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?Z._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper())||void 0===s?void 0:s.effect)&&void 0!==g?g:null,o=0,G=O._beforeRenderingMeshStage;o<G.length;o++){G[o].action(this,Z,Q,V)}if(!s||!V)return E&&(E.maxZ=I,O.updateTransformMatrix(!0)),this;var f,X=j||this;if(a.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this.overrideMaterialSideOrientation)f=a.sideOrientation;else{var d=X._getWorldMatrixDeterminant();null==(f=this.overrideMaterialSideOrientation)&&(f=this._internalMeshDataInfo._effectiveMaterial.sideOrientation),d<0&&(f=f===c.d.ClockWiseSideOrientation?c.d.CounterClockWiseSideOrientation:c.d.ClockWiseSideOrientation),a.sideOrientation=f}var W=this._internalMeshDataInfo._effectiveMaterial._preBind(s,f);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&Y.setDepthWrite(!0);var A=O.forcePointsCloud?c.d.PointFillMode:O.forceWireframe?c.d.WireFrameFillMode:this._internalMeshDataInfo._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),i||this._bind(Z,V,A);var q=this._internalMeshDataInfo._effectiveMaterial,T=X.getWorldMatrix();q._storeEffectOnSubMeshes?q.bindForSubMesh(T,this,Z):q.bind(T,this),!q.backFaceCulling&&q.separateCullingPass&&(Y.setState(!0,q.zOffset,!1,!W,q.cullBackFaces,q.stencil,q.zOffsetUnits),this._processRendering(this,Z,V,A,Q,i,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),Y.setState(!0,q.zOffset,!1,W,q.cullBackFaces,q.stencil,q.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(Z)),this._processRendering(this,Z,V,A,Q,i,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(var B=0,N=O._afterRenderingMeshStage;B<N.length;B++){N[B].action(this,Z,Q,V)}return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),E&&(E.maxZ=I,O.updateTransformMatrix(!0)),this},M.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(i.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(i.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())},M.prototype._normalizeSkinFourWeights=function(){for(var Z=this.getVerticesData(i.f.MatricesWeightsKind),M=Z.length,j=0;j<M;j+=4){var K=Z[j]+Z[j+1]+Z[j+2]+Z[j+3];if(0===K)Z[j]=1;else{var b=1/K;Z[j]*=b,Z[j+1]*=b,Z[j+2]*=b,Z[j+3]*=b}}this.setVerticesData(i.f.MatricesWeightsKind,Z)},M.prototype._normalizeSkinWeightsAndExtra=function(){for(var Z=this.getVerticesData(i.f.MatricesWeightsExtraKind),M=this.getVerticesData(i.f.MatricesWeightsKind),j=M.length,K=0;K<j;K+=4){var b=M[K]+M[K+1]+M[K+2]+M[K+3];if(0===(b+=Z[K]+Z[K+1]+Z[K+2]+Z[K+3]))M[K]=1;else{var g=1/b;M[K]*=g,M[K+1]*=g,M[K+2]*=g,M[K+3]*=g,Z[K]*=g,Z[K+1]*=g,Z[K+2]*=g,Z[K+3]*=g}}this.setVerticesData(i.f.MatricesWeightsKind,M),this.setVerticesData(i.f.MatricesWeightsKind,Z)},M.prototype.validateSkinning=function(){var Z=this.getVerticesData(i.f.MatricesWeightsExtraKind),M=this.getVerticesData(i.f.MatricesWeightsKind);if(null===M||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var j=M.length,K=0,b=0,g=0,O=0,Q=null===Z?4:8,Y=new Array,I=0;I<=Q;I++)Y[I]=0;for(I=0;I<j;I+=4){for(var E=M[I],s=E,a=0===s?0:1,z=1;z<Q;z++){var V=z<4?M[I+z]:Z[I+z-4];V>E&&K++,0!==V&&a++,s+=V,E=V}if(Y[a]++,a>g&&(g=a),0===s)b++;else{var o=1/s,c=0;for(z=0;z<Q;z++)c+=z<4?Math.abs(M[I+z]-M[I+z]*o):Math.abs(Z[I+z-4]-Z[I+z-4]*o);c>.001&&O++}}var G=this.skeleton.bones.length,f=this.getVerticesData(i.f.MatricesIndicesKind),X=this.getVerticesData(i.f.MatricesIndicesExtraKind),d=0;for(I=0;I<j;I+=4)for(z=0;z<Q;z++){var W=z<4?f[I+z]:X[I+z-4];(W>=G||W<0)&&d++}return{skinned:!0,valid:0===b&&0===O&&0===d,report:"Number of Weights = "+j/4+"\nMaximum influences = "+g+"\nMissing Weights = "+b+"\nNot Sorted = "+K+"\nNot Normalized = "+O+"\nWeightCounts = ["+Y+"]\nNumber of bones = "+G+"\nBad Bone Indices = "+d}},M.prototype._checkDelayState=function(){var Z=this.getScene();return this._geometry?this._geometry.load(Z):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(Z)),this},M.prototype._queueLoad=function(Z){var M=this;Z._addPendingData(this);var j=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return g.d.LoadFile(this.delayLoadingFile,(function(j){j instanceof ArrayBuffer?M._delayLoadingFunction(j,M):M._delayLoadingFunction(JSON.parse(j),M),M.instances.forEach((function(Z){Z.refreshBoundingInfo(),Z._syncSubMeshes()})),M.delayLoadState=1,Z._removePendingData(M)}),(function(){}),Z.offlineProvider,j),this},M.prototype.isInFrustum=function(M){return 2!==this.delayLoadState&&(!!Z.prototype.isInFrustum.call(this,M)&&(this._checkDelayState(),!0))},M.prototype.setMaterialById=function(Z){var M,j=this.getScene().materials;for(M=j.length-1;M>-1;M--)if(j[M].id===Z)return this.material=j[M],this;var K=this.getScene().multiMaterials;for(M=K.length-1;M>-1;M--)if(K[M].id===Z)return this.material=K[M],this;return this},M.prototype.getAnimatables=function(){var Z=new Array;return this.material&&Z.push(this.material),this.skeleton&&Z.push(this.skeleton),Z},M.prototype.bakeTransformIntoVertices=function(Z){if(!this.isVerticesDataPresent(i.f.PositionKind))return this;var M=this.subMeshes.splice(0);this._resetPointsArrayCache();var j,K=this.getVerticesData(i.f.PositionKind),b=new Array;for(j=0;j<K.length;j+=3)I.k.TransformCoordinates(I.k.FromArray(K,j),Z).toArray(b,j);if(this.setVerticesData(i.f.PositionKind,b,this.getVertexBuffer(i.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(i.f.NormalKind)){for(K=this.getVerticesData(i.f.NormalKind),b=[],j=0;j<K.length;j+=3)I.k.TransformNormal(I.k.FromArray(K,j),Z).normalize().toArray(b,j);this.setVerticesData(i.f.NormalKind,b,this.getVertexBuffer(i.f.NormalKind).isUpdatable())}return Z.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=M,this},M.prototype.bakeCurrentTransformIntoVertices=function(Z){return void 0===Z&&(Z=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(Z),this},Object.defineProperty(M.prototype,"_positions",{get:function(){return this._internalAbstractMeshDataInfo._positions?this._internalAbstractMeshDataInfo._positions:this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),M.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},M.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},M.prototype.clone=function(Z,j,K,b){return void 0===Z&&(Z=""),void 0===j&&(j=null),void 0===b&&(b=!0),new M(Z,this.getScene(),j,this,K,b)},M.prototype.dispose=function(M,j){void 0===j&&(j=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var K=this._internalMeshDataInfo;if(K._onBeforeDrawObservable&&K._onBeforeDrawObservable.clear(),K._onBeforeBindObservable&&K._onBeforeBindObservable.clear(),K._onBeforeRenderObservable&&K._onBeforeRenderObservable.clear(),K._onAfterRenderObservable&&K._onAfterRenderObservable.clear(),K._onBetweenPassObservable&&K._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(K.meshMap)for(var b in K.meshMap){(Q=K.meshMap[b])&&(Q._internalMeshDataInfo._source=null,K.meshMap[b]=void 0)}K._source&&K._source._internalMeshDataInfo.meshMap&&(K._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var g=0,O=this.getScene().meshes;g<O.length;g++){var Q;(Q=O[g])._internalMeshDataInfo&&Q._internalMeshDataInfo._source&&Q._internalMeshDataInfo._source===this&&(Q._internalMeshDataInfo._source=null)}K._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),Z.prototype.dispose.call(this,M,j)},M.prototype._disposeInstanceSpecificData=function(){},M.prototype._disposeThinInstanceSpecificData=function(){},M.prototype._invalidateInstanceVertexArrayObject=function(){},M.prototype.applyDisplacementMap=function(Z,M,j,K,b,O,Q){var Y=this;void 0===Q&&(Q=!1);var I=this.getScene();return g.d.LoadImage(Z,(function(Z){var g=Z.width,I=Z.height,E=Y.getEngine().createCanvas(g,I).getContext("2d");E.drawImage(Z,0,0);var s=E.getImageData(0,0,g,I).data;Y.applyDisplacementMapFromBuffer(s,g,I,M,j,b,O,Q),K&&K(Y)}),(function(){}),I.offlineProvider),this},M.prototype.applyDisplacementMapFromBuffer=function(Z,M,j,K,b,g,O,Q){if(void 0===Q&&(Q=!1),!this.isVerticesDataPresent(i.f.PositionKind)||!this.isVerticesDataPresent(i.f.NormalKind)||!this.isVerticesDataPresent(i.f.UVKind))return d.c.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var Y=this.getVerticesData(i.f.PositionKind,!0,!0),E=this.getVerticesData(i.f.NormalKind),s=this.getVerticesData(i.f.UVKind),z=I.k.Zero(),V=I.k.Zero(),o=I.h.Zero();g=g||I.h.Zero(),O=O||new I.h(1,1);for(var c=0;c<Y.length;c+=3){I.k.FromArrayToRef(Y,c,z),I.k.FromArrayToRef(E,c,V),I.h.FromArrayToRef(s,c/3*2,o);var G=4*((Math.abs(o.x*O.x+g.x%1)*(M-1)%M|0)+(Math.abs(o.y*O.y+g.y%1)*(j-1)%j|0)*M),f=.3*(Z[G]/255)+.59*(Z[G+1]/255)+.11*(Z[G+2]/255);V.normalize(),V.scaleInPlace(K+(b-K)*f),(z=z.add(V)).toArray(Y,c)}return a.e.ComputeNormals(Y,this.getIndices(),E),Q?(this.setVerticesData(i.f.PositionKind,Y),this.setVerticesData(i.f.NormalKind,E),this.setVerticesData(i.f.UVKind,s)):(this.updateVerticesData(i.f.PositionKind,Y),this.updateVerticesData(i.f.NormalKind,E)),this},M.prototype.convertToFlatShadedMesh=function(){var Z,M,j=this.getVerticesDataKinds(),K={},b={},g={},O=!1;for(Z=0;Z<j.length;Z++){M=j[Z];var Q=this.getVertexBuffer(M),Y=Q.getData();(Y instanceof Array||Y instanceof Float32Array)&&0===Y.length||(M!==i.f.NormalKind?(K[M]=Q,b[M]=this.getVerticesData(M),g[M]=[]):(O=Q.isUpdatable(),j.splice(Z,1),Z--))}var E,s=this.subMeshes.slice(0),a=this.getIndices(),z=this.getTotalIndices();for(E=0;E<z;E++){var V=a[E];for(Z=0;Z<j.length;Z++)if(K[M=j[Z]])for(var c=K[M].getStrideSize(),G=0;G<c;G++)g[M].push(b[M][V*c+G])}var f,X=[],d=g[i.f.PositionKind];for(f=this.getScene().useRightHandedSystem?1===this.overrideMaterialSideOrientation:0===this.overrideMaterialSideOrientation,E=0;E<z;E+=3){a[E]=E,a[E+1]=E+1,a[E+2]=E+2;var W=I.k.FromArray(d,3*E),A=I.k.FromArray(d,3*(E+1)),q=I.k.FromArray(d,3*(E+2)),T=W.subtract(A),B=q.subtract(A),N=I.k.Normalize(I.k.Cross(T,B));f&&N.scaleInPlace(-1);for(var U=0;U<3;U++)X.push(N.x),X.push(N.y),X.push(N.z)}for(this.setIndices(a),this.setVerticesData(i.f.NormalKind,X,O),Z=0;Z<j.length;Z++)g[M=j[Z]]&&this.setVerticesData(M,g[M],K[M].isUpdatable());this.releaseSubMeshes();for(var n=0;n<s.length;n++){var k=s[n];o.b.AddToMesh(k.materialIndex,k.indexStart,k.indexCount,k.indexStart,k.indexCount,this)}return this.synchronizeInstances(),this},M.prototype.convertToUnIndexedMesh=function(){var Z,M,j=this.getVerticesDataKinds(),K={},b={},g={};for(Z=0;Z<j.length;Z++){M=j[Z];var O=this.getVertexBuffer(M);K[M]=O,b[M]=K[M].getData(),g[M]=[]}var Q,Y=this.subMeshes.slice(0),I=this.getIndices(),E=this.getTotalIndices();for(Q=0;Q<E;Q++){var s=I[Q];for(Z=0;Z<j.length;Z++)for(var i=K[M=j[Z]].getStrideSize(),a=0;a<i;a++)g[M].push(b[M][s*i+a])}for(Q=0;Q<E;Q+=3)I[Q]=Q,I[Q+1]=Q+1,I[Q+2]=Q+2;for(this.setIndices(I),Z=0;Z<j.length;Z++)M=j[Z],this.setVerticesData(M,g[M],K[M].isUpdatable(),K[M].getStrideSize());this.releaseSubMeshes();for(var z=0;z<Y.length;z++){var V=Y[z];o.b.AddToMesh(V.materialIndex,V.indexStart,V.indexCount,V.indexStart,V.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},M.prototype.flipFaces=function(Z){void 0===Z&&(Z=!1);var M,j=a.e.ExtractFromMesh(this);if(Z&&this.isVerticesDataPresent(i.f.NormalKind)&&j.normals)for(M=0;M<j.normals.length;M++)j.normals[M]*=-1;if(j.indices){var K=void 0;for(M=0;M<j.indices.length;M+=3)K=j.indices[M+1],j.indices[M+1]=j.indices[M+2],j.indices[M+2]=K}return j.applyToMesh(this,this.isVertexBufferUpdatable(i.f.PositionKind)),this},M.prototype.increaseVertices=function(Z){void 0===Z&&(Z=1);var M=a.e.ExtractFromMesh(this),j=M.indices&&!Array.isArray(M.indices)&&Array.from?Array.from(M.indices):M.indices,K=M.positions&&!Array.isArray(M.positions)&&Array.from?Array.from(M.positions):M.positions,b=M.uvs&&!Array.isArray(M.uvs)&&Array.from?Array.from(M.uvs):M.uvs,g=M.normals&&!Array.isArray(M.normals)&&Array.from?Array.from(M.normals):M.normals;if(j&&K){M.indices=j,M.positions=K,b&&(M.uvs=b),g&&(M.normals=g);for(var O=Z+1,Q=new Array,Y=0;Y<O+1;Y++)Q[Y]=new Array;var E=void 0,s=void 0,z=new I.k(0,0,0),V=new I.k(0,0,0),o=new I.h(0,0),c=new Array,G=new Array,f=new Array,X=void 0,W=K.length,A=void 0;b&&(A=b.length);var q=void 0;g&&(q=g.length);for(Y=0;Y<j.length;Y+=3){G[0]=j[Y],G[1]=j[Y+1],G[2]=j[Y+2];for(var T=0;T<3;T++)if(E=G[T],s=G[(T+1)%3],void 0===f[E]&&void 0===f[s]?(f[E]=new Array,f[s]=new Array):(void 0===f[E]&&(f[E]=new Array),void 0===f[s]&&(f[s]=new Array)),void 0===f[E][s]&&void 0===f[s][E]){f[E][s]=[],z.x=(K[3*s]-K[3*E])/O,z.y=(K[3*s+1]-K[3*E+1])/O,z.z=(K[3*s+2]-K[3*E+2])/O,g&&(V.x=(g[3*s]-g[3*E])/O,V.y=(g[3*s+1]-g[3*E+1])/O,V.z=(g[3*s+2]-g[3*E+2])/O),b&&(o.x=(b[2*s]-b[2*E])/O,o.y=(b[2*s+1]-b[2*E+1])/O),f[E][s].push(E);for(var B=1;B<O;B++)f[E][s].push(K.length/3),K[W++]=K[3*E]+B*z.x,K[W++]=K[3*E+1]+B*z.y,K[W++]=K[3*E+2]+B*z.z,g&&(g[q++]=g[3*E]+B*V.x,g[q++]=g[3*E+1]+B*V.y,g[q++]=g[3*E+2]+B*V.z),b&&(b[A++]=b[2*E]+B*o.x,b[A++]=b[2*E+1]+B*o.y);f[E][s].push(s),f[s][E]=new Array,X=f[E][s].length;for(var N=0;N<X;N++)f[s][E][N]=f[E][s][X-1-N]}Q[0][0]=j[Y],Q[1][0]=f[j[Y]][j[Y+1]][1],Q[1][1]=f[j[Y]][j[Y+2]][1];for(B=2;B<O;B++){Q[B][0]=f[j[Y]][j[Y+1]][B],Q[B][B]=f[j[Y]][j[Y+2]][B],z.x=(K[3*Q[B][B]]-K[3*Q[B][0]])/B,z.y=(K[3*Q[B][B]+1]-K[3*Q[B][0]+1])/B,z.z=(K[3*Q[B][B]+2]-K[3*Q[B][0]+2])/B,g&&(V.x=(g[3*Q[B][B]]-g[3*Q[B][0]])/B,V.y=(g[3*Q[B][B]+1]-g[3*Q[B][0]+1])/B,V.z=(g[3*Q[B][B]+2]-g[3*Q[B][0]+2])/B),b&&(o.x=(b[2*Q[B][B]]-b[2*Q[B][0]])/B,o.y=(b[2*Q[B][B]+1]-b[2*Q[B][0]+1])/B);for(T=1;T<B;T++)Q[B][T]=K.length/3,K[W++]=K[3*Q[B][0]]+T*z.x,K[W++]=K[3*Q[B][0]+1]+T*z.y,K[W++]=K[3*Q[B][0]+2]+T*z.z,g&&(g[q++]=g[3*Q[B][0]]+T*V.x,g[q++]=g[3*Q[B][0]+1]+T*V.y,g[q++]=g[3*Q[B][0]+2]+T*V.z),b&&(b[A++]=b[2*Q[B][0]]+T*o.x,b[A++]=b[2*Q[B][0]+1]+T*o.y)}Q[O]=f[j[Y+1]][j[Y+2]],c.push(Q[0][0],Q[1][0],Q[1][1]);for(B=1;B<O;B++){T=void 0;for(T=0;T<B;T++)c.push(Q[B][T],Q[B+1][T],Q[B+1][T+1]),c.push(Q[B][T],Q[B+1][T+1],Q[B][T+1]);c.push(Q[B][T],Q[B+1][T],Q[B+1][T+1])}}M.indices=c,M.applyToMesh(this,this.isVertexBufferUpdatable(i.f.PositionKind))}else d.c.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")},M.prototype.forceSharedVertices=function(){var Z=a.e.ExtractFromMesh(this),M=Z.uvs,j=Z.indices,K=Z.positions,b=Z.colors;if(void 0===j||void 0===K||null===j||null===K)d.c.Warn("VertexData contains empty entries");else{for(var g=new Array,O=new Array,Q=new Array,Y=new Array,I=new Array,E=0,s={},z=void 0,V=void 0,o=0;o<j.length;o+=3){V=[j[o],j[o+1],j[o+2]],I=new Array;for(var c=0;c<3;c++){I[c]="";for(var G=0;G<3;G++)Math.abs(K[3*V[c]+G])<1e-8&&(K[3*V[c]+G]=0),I[c]+=K[3*V[c]+G]+"|"}if(I[0]!=I[1]&&I[0]!=I[2]&&I[1]!=I[2])for(c=0;c<3;c++){if(void 0===(z=s[I[c]])){s[I[c]]=E,z=E++;for(G=0;G<3;G++)g.push(K[3*V[c]+G]);if(null!==b&&void 0!==b)for(G=0;G<4;G++)Y.push(b[4*V[c]+G]);if(null!==M&&void 0!==M)for(G=0;G<2;G++)Q.push(M[2*V[c]+G])}O.push(z)}}var f=new Array;a.e.ComputeNormals(g,O,f),Z.positions=g,Z.indices=O,Z.normals=f,null!==M&&void 0!==M&&(Z.uvs=Q),null!==b&&void 0!==b&&(Z.colors=Y),Z.applyToMesh(this,this.isVertexBufferUpdatable(i.f.PositionKind))}},M._instancedMeshFactory=function(Z,M){throw(0,A.e)("InstancedMesh")},M._PhysicsImpostorParser=function(Z,M,j){throw(0,A.e)("PhysicsImpostor")},M.prototype.createInstance=function(Z){return M._instancedMeshFactory(Z,this)},M.prototype.synchronizeInstances=function(){for(var Z=0;Z<this.instances.length;Z++){this.instances[Z]._syncSubMeshes()}return this},M.prototype.optimizeIndices=function(Z){var M=this,j=this.getIndices(),K=this.getVerticesData(i.f.PositionKind);if(!K||!j)return this;for(var b=new Array,O=0;O<K.length;O+=3)b.push(I.k.FromArray(K,O));var Q=new Array;return g.b.SyncAsyncForLoop(b.length,40,(function(Z){for(var M=b.length-1-Z,j=b[M],K=0;K<M;++K){var g=b[K];if(j.equals(g)){Q[M]=K;break}}}),(function(){for(var K=0;K<j.length;++K)j[K]=Q[j[K]]||j[K];var b=M.subMeshes.slice(0);M.setIndices(j),M.subMeshes=b,Z&&Z(M)})),this},M.prototype.serialize=function(Z){Z.name=this.name,Z.id=this.id,Z.uniqueId=this.uniqueId,Z.type=this.getClassName(),Q.d&&Q.d.HasTags(this)&&(Z.tags=Q.d.GetTags(this)),Z.position=this.position.asArray(),this.rotationQuaternion?Z.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(Z.rotation=this.rotation.asArray()),Z.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?Z.pivotMatrix=this.getPivotMatrix().asArray():Z.localMatrix=this.getPivotMatrix().asArray(),Z.isEnabled=this.isEnabled(!1),Z.isVisible=this.isVisible,Z.infiniteDistance=this.infiniteDistance,Z.pickable=this.isPickable,Z.receiveShadows=this.receiveShadows,Z.billboardMode=this.billboardMode,Z.visibility=this.visibility,Z.checkCollisions=this.checkCollisions,Z.isBlocker=this.isBlocker,Z.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&this.parent._serializeAsParent(Z),Z.isUnIndexed=this.isUnIndexed;var M=this._geometry;if(M&&this.subMeshes){Z.geometryUniqueId=M.uniqueId,Z.geometryId=M.id,Z.subMeshes=[];for(var j=0;j<this.subMeshes.length;j++){var K=this.subMeshes[j];Z.subMeshes.push({materialIndex:K.materialIndex,verticesStart:K.verticesStart,verticesCount:K.verticesCount,indexStart:K.indexStart,indexCount:K.indexCount})}}(this.material?this.material.doNotSerialize||(Z.materialUniqueId=this.material.uniqueId,Z.materialId=this.material.id):(this.material=null,Z.materialUniqueId=this._scene.defaultMaterial.uniqueId,Z.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(Z.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(Z.skeletonId=this.skeleton.id,Z.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(q.d.NAME_PHYSICSENGINE))&&((O=this.getPhysicsImpostor())&&(Z.physicsMass=O.getParam("mass"),Z.physicsFriction=O.getParam("friction"),Z.physicsRestitution=O.getParam("mass"),Z.physicsImpostor=O.type));this.metadata&&(Z.metadata=this.metadata),Z.instances=[];for(var b=0;b<this.instances.length;b++){var g=this.instances[b];if(!g.doNotSerialize){var O,Y={name:g.name,id:g.id,isEnabled:g.isEnabled(!1),isVisible:g.isVisible,isPickable:g.isPickable,checkCollisions:g.checkCollisions,position:g.position.asArray(),scaling:g.scaling.asArray()};if(g.parent&&g.parent._serializeAsParent(Y),g.rotationQuaternion?Y.rotationQuaternion=g.rotationQuaternion.asArray():g.rotation&&(Y.rotation=g.rotation.asArray()),this.getScene()._getComponent(q.d.NAME_PHYSICSENGINE))(O=g.getPhysicsImpostor())&&(Y.physicsMass=O.getParam("mass"),Y.physicsFriction=O.getParam("friction"),Y.physicsRestitution=O.getParam("mass"),Y.physicsImpostor=O.type);g.metadata&&(Y.metadata=g.metadata),Z.instances.push(Y),X.b.AppendSerializedAnimations(g,Y),Y.ranges=g.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(Z.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){var I={data:{},sizes:{},strides:{}};for(var E in this._userThinInstanceBuffersStorage.data)I.data[E]=Array.from(this._userThinInstanceBuffersStorage.data[E]),I.sizes[E]=this._userThinInstanceBuffersStorage.sizes[E],I.strides[E]=this._userThinInstanceBuffersStorage.strides[E];Z.thinInstances.userThinInstance=I}X.b.AppendSerializedAnimations(this,Z),Z.ranges=this.serializeAnimationRanges(),Z.layerMask=this.layerMask,Z.alphaIndex=this.alphaIndex,Z.hasVertexAlpha=this.hasVertexAlpha,Z.overlayAlpha=this.overlayAlpha,Z.overlayColor=this.overlayColor.asArray(),Z.renderOverlay=this.renderOverlay,Z.applyFog=this.applyFog,this.actionManager&&(Z.actions=this.actionManager.serialize(this.name))},M.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var Z=this._internalAbstractMeshDataInfo._morphTargetManager;if(Z&&Z.vertexCount){if(Z.vertexCount!==this.getTotalVertices())return d.c.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(Z.isUsingTextureForTargets)return;for(var M=0;M<Z.numInfluencers;M++){var j=Z.getActiveTarget(M),K=j.getPositions();if(!K)return void d.c.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(i.f.PositionKind+M,K,!1,3);var b=j.getNormals();b&&this.geometry.setVerticesData(i.f.NormalKind+M,b,!1,3);var g=j.getTangents();g&&this.geometry.setVerticesData(i.f.TangentKind+M,g,!1,3);var O=j.getUVs();O&&this.geometry.setVerticesData(i.f.UVKind+"_"+M,O,!1,2)}}else for(M=0;this.geometry.isVerticesDataPresent(i.f.PositionKind+M);)this.geometry.removeVerticesData(i.f.PositionKind+M),this.geometry.isVerticesDataPresent(i.f.NormalKind+M)&&this.geometry.removeVerticesData(i.f.NormalKind+M),this.geometry.isVerticesDataPresent(i.f.TangentKind+M)&&this.geometry.removeVerticesData(i.f.TangentKind+M),this.geometry.isVerticesDataPresent(i.f.UVKind+M)&&this.geometry.removeVerticesData(i.f.UVKind+"_"+M),M++}},M.Parse=function(Z,j,K){var b;if((b=Z.type&&"LinesMesh"===Z.type?M._LinesMeshParser(Z,j):Z.type&&"GroundMesh"===Z.type?M._GroundMeshParser(Z,j):Z.type&&"GoldbergMesh"===Z.type?M._GoldbergMeshParser(Z,j):new M(Z.name,j)).id=Z.id,Q.d&&Q.d.AddTagsTo(b,Z.tags),b.position=I.k.FromArray(Z.position),void 0!==Z.metadata&&(b.metadata=Z.metadata),Z.rotationQuaternion?b.rotationQuaternion=I.d.FromArray(Z.rotationQuaternion):Z.rotation&&(b.rotation=I.k.FromArray(Z.rotation)),b.scaling=I.k.FromArray(Z.scaling),Z.localMatrix?b.setPreTransformMatrix(I.c.FromArray(Z.localMatrix)):Z.pivotMatrix&&b.setPivotMatrix(I.c.FromArray(Z.pivotMatrix)),b.setEnabled(Z.isEnabled),b.isVisible=Z.isVisible,b.infiniteDistance=Z.infiniteDistance,b.showBoundingBox=Z.showBoundingBox,b.showSubMeshesBoundingBox=Z.showSubMeshesBoundingBox,void 0!==Z.applyFog&&(b.applyFog=Z.applyFog),void 0!==Z.pickable&&(b.isPickable=Z.pickable),void 0!==Z.alphaIndex&&(b.alphaIndex=Z.alphaIndex),b.receiveShadows=Z.receiveShadows,b.billboardMode=Z.billboardMode,void 0!==Z.visibility&&(b.visibility=Z.visibility),b.checkCollisions=Z.checkCollisions,b.overrideMaterialSideOrientation=Z.overrideMaterialSideOrientation,void 0!==Z.isBlocker&&(b.isBlocker=Z.isBlocker),b._shouldGenerateFlatShading=Z.useFlatShading,Z.freezeWorldMatrix&&(b._waitingData.freezeWorldMatrix=Z.freezeWorldMatrix),void 0!==Z.parentId&&(b._waitingParentId=Z.parentId),void 0!==Z.parentInstanceIndex&&(b._waitingParentInstanceIndex=Z.parentInstanceIndex),void 0!==Z.actions&&(b._waitingData.actions=Z.actions),void 0!==Z.overlayAlpha&&(b.overlayAlpha=Z.overlayAlpha),void 0!==Z.overlayColor&&(b.overlayColor=E.e.FromArray(Z.overlayColor)),void 0!==Z.renderOverlay&&(b.renderOverlay=Z.renderOverlay),b.isUnIndexed=!!Z.isUnIndexed,b.hasVertexAlpha=Z.hasVertexAlpha,Z.delayLoadingFile?(b.delayLoadState=4,b.delayLoadingFile=K+Z.delayLoadingFile,b.buildBoundingInfo(I.k.FromArray(Z.boundingBoxMinimum),I.k.FromArray(Z.boundingBoxMaximum)),Z._binaryInfo&&(b._binaryInfo=Z._binaryInfo),b._delayInfo=[],Z.hasUVs&&b._delayInfo.push(i.f.UVKind),Z.hasUVs2&&b._delayInfo.push(i.f.UV2Kind),Z.hasUVs3&&b._delayInfo.push(i.f.UV3Kind),Z.hasUVs4&&b._delayInfo.push(i.f.UV4Kind),Z.hasUVs5&&b._delayInfo.push(i.f.UV5Kind),Z.hasUVs6&&b._delayInfo.push(i.f.UV6Kind),Z.hasColors&&b._delayInfo.push(i.f.ColorKind),Z.hasMatricesIndices&&b._delayInfo.push(i.f.MatricesIndicesKind),Z.hasMatricesWeights&&b._delayInfo.push(i.f.MatricesWeightsKind),b._delayLoadingFunction=z.e._ImportGeometry,f.e.ForceFullSceneLoadingForIncremental&&b._checkDelayState()):z.e._ImportGeometry(Z,b),Z.materialUniqueId?b._waitingMaterialId=Z.materialUniqueId:Z.materialId&&(b._waitingMaterialId=Z.materialId),Z.morphTargetManagerId>-1&&(b.morphTargetManager=j.getMorphTargetManagerById(Z.morphTargetManagerId)),void 0!==Z.skeletonId&&null!==Z.skeletonId&&(b.skeleton=j.getLastSkeletonById(Z.skeletonId),Z.numBoneInfluencers&&(b.numBoneInfluencers=Z.numBoneInfluencers)),Z.animations){for(var g=0;g<Z.animations.length;g++){var O=Z.animations[g];(o=(0,W.b)("BABYLON.Animation"))&&b.animations.push(o.Parse(O))}s.b.ParseAnimationRanges(b,Z,j)}if(Z.autoAnimate&&j.beginAnimation(b,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),Z.layerMask&&!isNaN(Z.layerMask)?b.layerMask=Math.abs(parseInt(Z.layerMask)):b.layerMask=268435455,Z.physicsImpostor&&M._PhysicsImpostorParser(j,b,Z),Z.lodMeshIds&&(b._waitingData.lods={ids:Z.lodMeshIds,distances:Z.lodDistances?Z.lodDistances:null,coverages:Z.lodCoverages?Z.lodCoverages:null}),Z.instances)for(var Y=0;Y<Z.instances.length;Y++){var a=Z.instances[Y],V=b.createInstance(a.name);if(a.id&&(V.id=a.id),Q.d&&(a.tags?Q.d.AddTagsTo(V,a.tags):Q.d.AddTagsTo(V,Z.tags)),V.position=I.k.FromArray(a.position),void 0!==a.metadata&&(V.metadata=a.metadata),void 0!==a.parentId&&(V._waitingParentId=a.parentId),void 0!==a.parentInstanceIndex&&(V._waitingParentInstanceIndex=a.parentInstanceIndex),void 0!==a.isEnabled&&null!==a.isEnabled&&V.setEnabled(a.isEnabled),void 0!==a.isVisible&&null!==a.isVisible&&(V.isVisible=a.isVisible),void 0!==a.isPickable&&null!==a.isPickable&&(V.isPickable=a.isPickable),a.rotationQuaternion?V.rotationQuaternion=I.d.FromArray(a.rotationQuaternion):a.rotation&&(V.rotation=I.k.FromArray(a.rotation)),V.scaling=I.k.FromArray(a.scaling),void 0!=a.checkCollisions&&null!=a.checkCollisions&&(V.checkCollisions=a.checkCollisions),void 0!=a.pickable&&null!=a.pickable&&(V.isPickable=a.pickable),void 0!=a.showBoundingBox&&null!=a.showBoundingBox&&(V.showBoundingBox=a.showBoundingBox),void 0!=a.showSubMeshesBoundingBox&&null!=a.showSubMeshesBoundingBox&&(V.showSubMeshesBoundingBox=a.showSubMeshesBoundingBox),void 0!=a.alphaIndex&&null!=a.showSubMeshesBoundingBox&&(V.alphaIndex=a.alphaIndex),a.physicsImpostor&&M._PhysicsImpostorParser(j,V,a),a.animations){for(g=0;g<a.animations.length;g++){var o;O=a.animations[g];(o=(0,W.b)("BABYLON.Animation"))&&V.animations.push(o.Parse(O))}s.b.ParseAnimationRanges(V,a,j),a.autoAnimate&&j.beginAnimation(V,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1)}}if(Z.thinInstances){var c=Z.thinInstances;if(b.thinInstanceEnablePicking=!!c.enablePicking,c.matrixData?(b.thinInstanceSetBuffer("matrix",new Float32Array(c.matrixData),16,!1),b._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,b._thinInstanceDataStorage.instancesCount=c.instancesCount):b._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,Z.thinInstances.userThinInstance){var G=Z.thinInstances.userThinInstance;for(var X in G.data)b.thinInstanceSetBuffer(X,new Float32Array(G.data[X]),G.strides[X],!1),b._userThinInstanceBuffersStorage.sizes[X]=G.sizes[X]}}return b},M.prototype.setPositionsForCPUSkinning=function(){var Z=this._internalMeshDataInfo;if(!Z._sourcePositions){var M=this.getVerticesData(i.f.PositionKind);if(!M)return Z._sourcePositions;Z._sourcePositions=new Float32Array(M),this.isVertexBufferUpdatable(i.f.PositionKind)||this.setVerticesData(i.f.PositionKind,M,!0)}return Z._sourcePositions},M.prototype.setNormalsForCPUSkinning=function(){var Z=this._internalMeshDataInfo;if(!Z._sourceNormals){var M=this.getVerticesData(i.f.NormalKind);if(!M)return Z._sourceNormals;Z._sourceNormals=new Float32Array(M),this.isVertexBufferUpdatable(i.f.NormalKind)||this.setVerticesData(i.f.NormalKind,M,!0)}return Z._sourceNormals},M.prototype.applySkeleton=function(Z){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(i.f.PositionKind))return this;if(!this.isVerticesDataPresent(i.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(i.f.MatricesWeightsKind))return this;var M=this.isVerticesDataPresent(i.f.NormalKind),j=this._internalMeshDataInfo;if(!j._sourcePositions){var K=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=K}M&&!j._sourceNormals&&this.setNormalsForCPUSkinning();var b=this.getVerticesData(i.f.PositionKind);if(!b)return this;b instanceof Float32Array||(b=new Float32Array(b));var g=this.getVerticesData(i.f.NormalKind);if(M){if(!g)return this;g instanceof Float32Array||(g=new Float32Array(g))}var O=this.getVerticesData(i.f.MatricesIndicesKind),Q=this.getVerticesData(i.f.MatricesWeightsKind);if(!Q||!O)return this;for(var Y,E=this.numBoneInfluencers>4,s=E?this.getVerticesData(i.f.MatricesIndicesExtraKind):null,a=E?this.getVerticesData(i.f.MatricesWeightsExtraKind):null,z=Z.getTransformMatrices(this),V=I.k.Zero(),o=new I.c,c=new I.c,G=0,f=0;f<b.length;f+=3,G+=4){var X=void 0;for(Y=0;Y<4;Y++)(X=Q[G+Y])>0&&(I.c.FromFloat32ArrayToRefScaled(z,Math.floor(16*O[G+Y]),X,c),o.addToSelf(c));if(E)for(Y=0;Y<4;Y++)(X=a[G+Y])>0&&(I.c.FromFloat32ArrayToRefScaled(z,Math.floor(16*s[G+Y]),X,c),o.addToSelf(c));I.k.TransformCoordinatesFromFloatsToRef(j._sourcePositions[f],j._sourcePositions[f+1],j._sourcePositions[f+2],o,V),V.toArray(b,f),M&&(I.k.TransformNormalFromFloatsToRef(j._sourceNormals[f],j._sourceNormals[f+1],j._sourceNormals[f+2],o,V),V.toArray(g,f)),o.reset()}return this.updateVerticesData(i.f.PositionKind,b),M&&this.updateVerticesData(i.f.NormalKind,g),this},M.MinMax=function(Z){var M=null,j=null;return Z.forEach((function(Z){var K=Z.getBoundingInfo().boundingBox;M&&j?(M.minimizeInPlace(K.minimumWorld),j.maximizeInPlace(K.maximumWorld)):(M=K.minimumWorld,j=K.maximumWorld)})),M&&j?{min:M,max:j}:{min:I.k.Zero(),max:I.k.Zero()}},M.Center=function(Z){var j=Z instanceof Array?M.MinMax(Z):Z;return I.k.Center(j.min,j.max)},M.MergeMeshes=function(Z,j,K,b,g,O){return void 0===j&&(j=!0),(0,Y.k)(M._MergeMeshesCoroutine(Z,j,K,b,g,O,!1))},M.MergeMeshesAsync=function(Z,j,K,b,g,O){return void 0===j&&(j=!0),(0,Y.h)(M._MergeMeshesCoroutine(Z,j,K,b,g,O,!0),(0,Y.c)())},M._MergeMeshesCoroutine=function(Z,j,b,g,O,Q,Y){var I,E,s,i,z,V,c,f,X,W,A,q,T,B,N,U,n,k,x,R,e,u,F,C,y,S;return void 0===j&&(j=!0),(0,K.n)(this,(function(K){switch(K.label){case 0:if(0===(Z=Z.filter(Boolean)).length)return[2,null];if(!b)for(E=0,I=0;I<Z.length;I++)if((E+=Z[I].getTotalVertices())>=65536)return d.c.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),[2,null];for(Q&&(O=!1),s=new Array,i=new Array,z=new Array,V=Z[0].overrideMaterialSideOrientation,I=0;I<Z.length;I++){if((c=Z[I]).isAnInstance)return d.c.Warn("Cannot merge instance meshes."),[2,null];if(V!==c.overrideMaterialSideOrientation)return d.c.Warn("Cannot merge meshes with different overrideMaterialSideOrientation values."),[2,null];if(O&&z.push(c.getTotalIndices()),Q)if(c.material)if((f=c.material)instanceof G.e){for(X=0;X<f.subMaterials.length;X++)s.indexOf(f.subMaterials[X])<0&&s.push(f.subMaterials[X]);for(S=0;S<c.subMeshes.length;S++)i.push(s.indexOf(f.subMaterials[c.subMeshes[S].materialIndex])),z.push(c.subMeshes[S].indexCount)}else for(s.indexOf(f)<0&&s.push(f),S=0;S<c.subMeshes.length;S++)i.push(s.indexOf(f)),z.push(c.subMeshes[S].indexCount);else for(S=0;S<c.subMeshes.length;S++)i.push(0),z.push(c.subMeshes[S].indexCount)}return W=Z[0],A=function(Z){var M=Z.computeWorldMatrix(!0);return[a.e.ExtractFromMesh(Z,!1,!1),M]},q=A(W),T=q[0],B=q[1],Y?[4]:[3,2];case 1:K.sent(),K.label=2;case 2:N=new Array(Z.length-1),U=1,K.label=3;case 3:return U<Z.length?(N[U-1]=A(Z[U]),Y?[4]:[3,5]):[3,6];case 4:K.sent(),K.label=5;case 5:return U++,[3,3];case 6:n=T._mergeCoroutine(B,N,b,Y,!j),k=n.next(),K.label=7;case 7:return k.done?[3,10]:Y?[4]:[3,9];case 8:K.sent(),K.label=9;case 9:return k=n.next(),[3,7];case 10:x=k.value,g||(g=new M(W.name+"_merged",W.getScene())),R=x._applyToCoroutine(g,void 0,Y),e=R.next(),K.label=11;case 11:return e.done?[3,14]:Y?[4]:[3,13];case 12:K.sent(),K.label=13;case 13:return e=R.next(),[3,11];case 14:if(g.checkCollisions=W.checkCollisions,g.overrideMaterialSideOrientation=W.overrideMaterialSideOrientation,j)for(I=0;I<Z.length;I++)Z[I].dispose();if(O||Q){for(g.releaseSubMeshes(),I=0,u=0;I<z.length;)o.b.CreateFromIndices(0,u,z[I],g,void 0,!1),u+=z[I],I++;for(F=0,C=g.subMeshes;F<C.length;F++)C[F].refreshBoundingInfo();g.computeWorldMatrix(!0)}if(Q){for((y=new G.e(W.name+"_merged",W.getScene())).subMaterials=s,S=0;S<g.subMeshes.length;S++)g.subMeshes[S].materialIndex=i[S];g.material=y}else g.material=W.material;return[2,g]}}))},M.prototype.addInstance=function(Z){Z._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(Z)},M.prototype.removeInstance=function(Z){var M=Z._indexInSourceMeshInstanceArray;if(-1!=M){if(M!==this.instances.length-1){var j=this.instances[this.instances.length-1];this.instances[M]=j,j._indexInSourceMeshInstanceArray=M}Z._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},M.prototype._shouldConvertRHS=function(){return this.overrideMaterialSideOrientation===c.d.CounterClockWiseSideOrientation},M.FRONTSIDE=a.e.FRONTSIDE,M.BACKSIDE=a.e.BACKSIDE,M.DOUBLESIDE=a.e.DOUBLESIDE,M.DEFAULTSIDE=a.e.DEFAULTSIDE,M.NO_CAP=0,M.CAP_START=1,M.CAP_END=2,M.CAP_ALL=3,M.NO_FLIP=0,M.FLIP_TILE=1,M.ROTATE_TILE=2,M.FLIP_ROW=3,M.ROTATE_ROW=4,M.FLIP_N_ROTATE_TILE=5,M.FLIP_N_ROTATE_ROW=6,M.CENTER=0,M.LEFT=1,M.RIGHT=2,M.TOP=3,M.BOTTOM=4,M.INSTANCEDMESH_SORT_TRANSPARENT=!1,M._GroundMeshParser=function(Z,M){throw(0,A.e)("GroundMesh")},M._GoldbergMeshParser=function(Z,M){throw(0,A.e)("GoldbergMesh")},M._LinesMeshParser=function(Z,M){throw(0,A.e)("LinesMesh")},M}(V.b);(0,W.c)("BABYLON.Mesh",x),x.prototype.setMaterialByID=function(Z){return this.setMaterialById(Z)},x.CreateDisc=x.CreateDisc||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateBox=x.CreateBox||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateSphere=x.CreateSphere||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateCylinder=x.CreateCylinder||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateTorusKnot=x.CreateTorusKnot||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateTorus=x.CreateTorus||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreatePlane=x.CreatePlane||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateGround=x.CreateGround||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateTiledGround=x.CreateTiledGround||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateGroundFromHeightMap=x.CreateGroundFromHeightMap||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateTube=x.CreateTube||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreatePolyhedron=x.CreatePolyhedron||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateIcoSphere=x.CreateIcoSphere||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateDecal=x.CreateDecal||function(){throw new Error("Import MeshBuilder to populate this function")},x.CreateCapsule=x.CreateCapsule||function(){throw new Error("Import MeshBuilder to populate this function")},x.ExtendToGoldberg=x.ExtendToGoldberg||function(){throw new Error("Import MeshBuilder to populate this function")}},85779:function(Z,M,j){"use strict";j.d(M,{e:function(){return i}});var K=j(40061),b=j(80105),g=j(43251),O=j(50504),Q=j(9488),Y=j(9127),I=j(9892),E=j(61633),s=j(33224),i=function(){function Z(){this._applyTo=(0,E.g)(this._applyToCoroutine.bind(this))}return Z.prototype.set=function(Z,M){switch(Z.length||Y.c.Warn("Setting vertex data kind '".concat(M,"' with an empty array")),M){case g.f.PositionKind:this.positions=Z;break;case g.f.NormalKind:this.normals=Z;break;case g.f.TangentKind:this.tangents=Z;break;case g.f.UVKind:this.uvs=Z;break;case g.f.UV2Kind:this.uvs2=Z;break;case g.f.UV3Kind:this.uvs3=Z;break;case g.f.UV4Kind:this.uvs4=Z;break;case g.f.UV5Kind:this.uvs5=Z;break;case g.f.UV6Kind:this.uvs6=Z;break;case g.f.ColorKind:this.colors=Z;break;case g.f.MatricesIndicesKind:this.matricesIndices=Z;break;case g.f.MatricesWeightsKind:this.matricesWeights=Z;break;case g.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=Z;break;case g.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=Z}},Z.prototype.applyToMesh=function(Z,M){return this._applyTo(Z,M,!1),this},Z.prototype.applyToGeometry=function(Z,M){return this._applyTo(Z,M,!1),this},Z.prototype.updateMesh=function(Z){return this._update(Z),this},Z.prototype.updateGeometry=function(Z){return this._update(Z),this},Z.prototype._applyToCoroutine=function(Z,M,j){return void 0===M&&(M=!1),(0,K.n)(this,(function(K){switch(K.label){case 0:return this.positions?(Z.setVerticesData(g.f.PositionKind,this.positions,M),j?[4]:[3,2]):[3,2];case 1:K.sent(),K.label=2;case 2:return this.normals?(Z.setVerticesData(g.f.NormalKind,this.normals,M),j?[4]:[3,4]):[3,4];case 3:K.sent(),K.label=4;case 4:return this.tangents?(Z.setVerticesData(g.f.TangentKind,this.tangents,M),j?[4]:[3,6]):[3,6];case 5:K.sent(),K.label=6;case 6:return this.uvs?(Z.setVerticesData(g.f.UVKind,this.uvs,M),j?[4]:[3,8]):[3,8];case 7:K.sent(),K.label=8;case 8:return this.uvs2?(Z.setVerticesData(g.f.UV2Kind,this.uvs2,M),j?[4]:[3,10]):[3,10];case 9:K.sent(),K.label=10;case 10:return this.uvs3?(Z.setVerticesData(g.f.UV3Kind,this.uvs3,M),j?[4]:[3,12]):[3,12];case 11:K.sent(),K.label=12;case 12:return this.uvs4?(Z.setVerticesData(g.f.UV4Kind,this.uvs4,M),j?[4]:[3,14]):[3,14];case 13:K.sent(),K.label=14;case 14:return this.uvs5?(Z.setVerticesData(g.f.UV5Kind,this.uvs5,M),j?[4]:[3,16]):[3,16];case 15:K.sent(),K.label=16;case 16:return this.uvs6?(Z.setVerticesData(g.f.UV6Kind,this.uvs6,M),j?[4]:[3,18]):[3,18];case 17:K.sent(),K.label=18;case 18:return this.colors?(Z.setVerticesData(g.f.ColorKind,this.colors,M),j?[4]:[3,20]):[3,20];case 19:K.sent(),K.label=20;case 20:return this.matricesIndices?(Z.setVerticesData(g.f.MatricesIndicesKind,this.matricesIndices,M),j?[4]:[3,22]):[3,22];case 21:K.sent(),K.label=22;case 22:return this.matricesWeights?(Z.setVerticesData(g.f.MatricesWeightsKind,this.matricesWeights,M),j?[4]:[3,24]):[3,24];case 23:K.sent(),K.label=24;case 24:return this.matricesIndicesExtra?(Z.setVerticesData(g.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,M),j?[4]:[3,26]):[3,26];case 25:K.sent(),K.label=26;case 26:return this.matricesWeightsExtra?(Z.setVerticesData(g.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,M),j?[4]:[3,28]):[3,28];case 27:K.sent(),K.label=28;case 28:return this.indices?(Z.setIndices(this.indices,null,M),j?[4]:[3,30]):[3,31];case 29:K.sent(),K.label=30;case 30:return[3,32];case 31:Z.setIndices([],null),K.label=32;case 32:return[2,this]}}))},Z.prototype._update=function(Z,M,j){return this.positions&&Z.updateVerticesData(g.f.PositionKind,this.positions,M,j),this.normals&&Z.updateVerticesData(g.f.NormalKind,this.normals,M,j),this.tangents&&Z.updateVerticesData(g.f.TangentKind,this.tangents,M,j),this.uvs&&Z.updateVerticesData(g.f.UVKind,this.uvs,M,j),this.uvs2&&Z.updateVerticesData(g.f.UV2Kind,this.uvs2,M,j),this.uvs3&&Z.updateVerticesData(g.f.UV3Kind,this.uvs3,M,j),this.uvs4&&Z.updateVerticesData(g.f.UV4Kind,this.uvs4,M,j),this.uvs5&&Z.updateVerticesData(g.f.UV5Kind,this.uvs5,M,j),this.uvs6&&Z.updateVerticesData(g.f.UV6Kind,this.uvs6,M,j),this.colors&&Z.updateVerticesData(g.f.ColorKind,this.colors,M,j),this.matricesIndices&&Z.updateVerticesData(g.f.MatricesIndicesKind,this.matricesIndices,M,j),this.matricesWeights&&Z.updateVerticesData(g.f.MatricesWeightsKind,this.matricesWeights,M,j),this.matricesIndicesExtra&&Z.updateVerticesData(g.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,M,j),this.matricesWeightsExtra&&Z.updateVerticesData(g.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,M,j),this.indices&&Z.setIndices(this.indices,null),this},Z._TransformVector3Coordinates=function(Z,M,j,K){void 0===j&&(j=0),void 0===K&&(K=Z.length);for(var g=b.e.Vector3[0],O=b.e.Vector3[1],Q=j;Q<j+K;Q+=3)b.k.FromArrayToRef(Z,Q,g),b.k.TransformCoordinatesToRef(g,M,O),Z[Q]=O.x,Z[Q+1]=O.y,Z[Q+2]=O.z},Z._TransformVector3Normals=function(Z,M,j,K){void 0===j&&(j=0),void 0===K&&(K=Z.length);for(var g=b.e.Vector3[0],O=b.e.Vector3[1],Q=j;Q<j+K;Q+=3)b.k.FromArrayToRef(Z,Q,g),b.k.TransformNormalToRef(g,M,O),Z[Q]=O.x,Z[Q+1]=O.y,Z[Q+2]=O.z},Z._TransformVector4Normals=function(Z,M,j,K){void 0===j&&(j=0),void 0===K&&(K=Z.length);for(var g=b.e.Vector4[0],O=b.e.Vector4[1],Q=j;Q<j+K;Q+=4)b.l.FromArrayToRef(Z,Q,g),b.l.TransformNormalToRef(g,M,O),Z[Q]=O.x,Z[Q+1]=O.y,Z[Q+2]=O.z,Z[Q+3]=O.w},Z._FlipFaces=function(Z,M,j){void 0===M&&(M=0),void 0===j&&(j=Z.length);for(var K=M;K<M+j;K+=3){var b=Z[K+1];Z[K+1]=Z[K+2],Z[K+2]=b}},Z.prototype.transform=function(M){var j=M.determinant()<0;return this.positions&&Z._TransformVector3Coordinates(this.positions,M),this.normals&&Z._TransformVector3Normals(this.normals,M),this.tangents&&Z._TransformVector4Normals(this.tangents,M),j&&this.indices&&Z._FlipFaces(this.indices),this},Z.prototype.merge=function(Z,M,j){void 0===M&&(M=!1),void 0===j&&(j=!1);var K=Array.isArray(Z)?Z.map((function(Z){return[Z,void 0]})):[[Z,void 0]];return(0,E.k)(this._mergeCoroutine(void 0,K,M,!1,j))},Z.prototype._mergeCoroutine=function(M,j,b,O,Q){var Y,I,E,s,i,a,z,V,o,c,G,f,X,d,W,A,q,T,B,N=this;return void 0===b&&(b=!1),(0,K.n)(this,(function(K){switch(K.label){case 0:for(this._validate(),Y=j.map((function(Z){return Z[0]})),I=0,E=Y;I<E.length;I++)if((X=E[I])._validate(),!this.normals!==!X.normals||!this.tangents!==!X.tangents||!this.uvs!==!X.uvs||!this.uvs2!==!X.uvs2||!this.uvs3!==!X.uvs3||!this.uvs4!==!X.uvs4||!this.uvs5!==!X.uvs5||!this.uvs6!==!X.uvs6||!this.colors!==!X.colors||!this.matricesIndices!==!X.matricesIndices||!this.matricesWeights!==!X.matricesWeights||!this.matricesIndicesExtra!==!X.matricesIndicesExtra||!this.matricesWeightsExtra!==!X.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(s=Y.reduce((function(Z,M){var j,K;return Z+(null!==(K=null===(j=M.indices)||void 0===j?void 0:j.length)&&void 0!==K?K:0)}),null!==(q=null===(A=this.indices)||void 0===A?void 0:A.length)&&void 0!==q?q:0),i=Q||Y.some((function(Z){return Z.indices===N.indices})),a=i?null===(T=this.indices)||void 0===T?void 0:T.slice():this.indices,!(s>0))return[3,4];z=null!==(B=null===a||void 0===a?void 0:a.length)&&void 0!==B?B:0,a||(a=new Array(s)),a.length!==s&&(Array.isArray(a)?a.length=s:((V=b||a instanceof Uint32Array?new Uint32Array(s):new Uint16Array(s)).set(a),a=V),M&&M.determinant()<0&&Z._FlipFaces(a,0,z)),o=this.positions?this.positions.length/3:0,c=0,G=j,K.label=1;case 1:if(!(c<G.length))return[3,4];if(f=G[c],X=f[0],d=f[1],!X.indices)return[3,3];for(W=0;W<X.indices.length;W++)a[z+W]=X.indices[W]+o;return d&&d.determinant()<0&&Z._FlipFaces(a,z,X.indices.length),o+=X.positions.length/3,z+=X.indices.length,O?[4]:[3,3];case 2:K.sent(),K.label=3;case 3:return c++,[3,1];case 4:return this.indices=a,this.positions=Z._MergeElement(g.f.PositionKind,this.positions,M,j.map((function(Z){return[Z[0].positions,Z[1]]}))),O?[4]:[3,6];case 5:K.sent(),K.label=6;case 6:return this.normals=Z._MergeElement(g.f.NormalKind,this.normals,M,j.map((function(Z){return[Z[0].normals,Z[1]]}))),O?[4]:[3,8];case 7:K.sent(),K.label=8;case 8:return this.tangents=Z._MergeElement(g.f.TangentKind,this.tangents,M,j.map((function(Z){return[Z[0].tangents,Z[1]]}))),O?[4]:[3,10];case 9:K.sent(),K.label=10;case 10:return this.uvs=Z._MergeElement(g.f.UVKind,this.uvs,M,j.map((function(Z){return[Z[0].uvs,Z[1]]}))),O?[4]:[3,12];case 11:K.sent(),K.label=12;case 12:return this.uvs2=Z._MergeElement(g.f.UV2Kind,this.uvs2,M,j.map((function(Z){return[Z[0].uvs2,Z[1]]}))),O?[4]:[3,14];case 13:K.sent(),K.label=14;case 14:return this.uvs3=Z._MergeElement(g.f.UV3Kind,this.uvs3,M,j.map((function(Z){return[Z[0].uvs3,Z[1]]}))),O?[4]:[3,16];case 15:K.sent(),K.label=16;case 16:return this.uvs4=Z._MergeElement(g.f.UV4Kind,this.uvs4,M,j.map((function(Z){return[Z[0].uvs4,Z[1]]}))),O?[4]:[3,18];case 17:K.sent(),K.label=18;case 18:return this.uvs5=Z._MergeElement(g.f.UV5Kind,this.uvs5,M,j.map((function(Z){return[Z[0].uvs5,Z[1]]}))),O?[4]:[3,20];case 19:K.sent(),K.label=20;case 20:return this.uvs6=Z._MergeElement(g.f.UV6Kind,this.uvs6,M,j.map((function(Z){return[Z[0].uvs6,Z[1]]}))),O?[4]:[3,22];case 21:K.sent(),K.label=22;case 22:return this.colors=Z._MergeElement(g.f.ColorKind,this.colors,M,j.map((function(Z){return[Z[0].colors,Z[1]]}))),O?[4]:[3,24];case 23:K.sent(),K.label=24;case 24:return this.matricesIndices=Z._MergeElement(g.f.MatricesIndicesKind,this.matricesIndices,M,j.map((function(Z){return[Z[0].matricesIndices,Z[1]]}))),O?[4]:[3,26];case 25:K.sent(),K.label=26;case 26:return this.matricesWeights=Z._MergeElement(g.f.MatricesWeightsKind,this.matricesWeights,M,j.map((function(Z){return[Z[0].matricesWeights,Z[1]]}))),O?[4]:[3,28];case 27:K.sent(),K.label=28;case 28:return this.matricesIndicesExtra=Z._MergeElement(g.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,M,j.map((function(Z){return[Z[0].matricesIndicesExtra,Z[1]]}))),O?[4]:[3,30];case 29:K.sent(),K.label=30;case 30:return this.matricesWeightsExtra=Z._MergeElement(g.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,M,j.map((function(Z){return[Z[0].matricesWeightsExtra,Z[1]]}))),[2,this]}}))},Z._MergeElement=function(M,j,K,b){var O=b.filter((function(Z){return null!==Z[0]&&void 0!==Z[0]}));if(!j&&0==O.length)return j;if(!j)return this._MergeElement(M,O[0][0],O[0][1],O.slice(1));var Q=O.reduce((function(Z,M){return Z+M[0].length}),j.length),Y=M===g.f.PositionKind?Z._TransformVector3Coordinates:M===g.f.NormalKind?Z._TransformVector3Normals:M===g.f.TangentKind?Z._TransformVector4Normals:function(){};if(j instanceof Float32Array){var I=new Float32Array(Q);I.set(j),K&&Y(I,K,0,j.length);for(var E=j.length,s=0,i=O;s<i.length;s++){var a=i[s],z=a[0],V=a[1];I.set(z,E),V&&Y(I,V,E,z.length),E+=z.length}return I}for(var o=new Array(Q),c=0;c<j.length;c++)o[c]=j[c];K&&Y(o,K,0,j.length);E=j.length;for(var G=0,f=O;G<f.length;G++){var X=f[G],d=(z=X[0],X[1]);for(c=0;c<z.length;c++)o[E+c]=z[c];d&&Y(o,d,E,z.length),E+=z.length}return o},Z.prototype._validate=function(){if(!this.positions)throw new s.i("Positions are required",s.g.MeshInvalidPositionsError);var Z=function(Z,M){var j=g.f.DeduceStride(Z);if(M.length%j!==0)throw new Error("The "+Z+"s array count must be a multiple of "+j);return M.length/j},M=Z(g.f.PositionKind,this.positions),j=function(j,K){var b=Z(j,K);if(b!==M)throw new Error("The "+j+"s element count ("+b+") does not match the positions count ("+M+")")};this.normals&&j(g.f.NormalKind,this.normals),this.tangents&&j(g.f.TangentKind,this.tangents),this.uvs&&j(g.f.UVKind,this.uvs),this.uvs2&&j(g.f.UV2Kind,this.uvs2),this.uvs3&&j(g.f.UV3Kind,this.uvs3),this.uvs4&&j(g.f.UV4Kind,this.uvs4),this.uvs5&&j(g.f.UV5Kind,this.uvs5),this.uvs6&&j(g.f.UV6Kind,this.uvs6),this.colors&&j(g.f.ColorKind,this.colors),this.matricesIndices&&j(g.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&j(g.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&j(g.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&j(g.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)},Z.prototype.serialize=function(){var Z={};return this.positions&&(Z.positions=this.positions),this.normals&&(Z.normals=this.normals),this.tangents&&(Z.tangents=this.tangents),this.uvs&&(Z.uvs=this.uvs),this.uvs2&&(Z.uvs2=this.uvs2),this.uvs3&&(Z.uvs3=this.uvs3),this.uvs4&&(Z.uvs4=this.uvs4),this.uvs5&&(Z.uvs5=this.uvs5),this.uvs6&&(Z.uvs6=this.uvs6),this.colors&&(Z.colors=this.colors),this.matricesIndices&&(Z.matricesIndices=this.matricesIndices,Z.matricesIndices._isExpanded=!0),this.matricesWeights&&(Z.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(Z.matricesIndicesExtra=this.matricesIndicesExtra,Z.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(Z.matricesWeightsExtra=this.matricesWeightsExtra),Z.indices=this.indices,Z},Z.ExtractFromMesh=function(M,j,K){return Z._ExtractFrom(M,j,K)},Z.ExtractFromGeometry=function(M,j,K){return Z._ExtractFrom(M,j,K)},Z._ExtractFrom=function(M,j,K){var b=new Z;return M.isVerticesDataPresent(g.f.PositionKind)&&(b.positions=M.getVerticesData(g.f.PositionKind,j,K)),M.isVerticesDataPresent(g.f.NormalKind)&&(b.normals=M.getVerticesData(g.f.NormalKind,j,K)),M.isVerticesDataPresent(g.f.TangentKind)&&(b.tangents=M.getVerticesData(g.f.TangentKind,j,K)),M.isVerticesDataPresent(g.f.UVKind)&&(b.uvs=M.getVerticesData(g.f.UVKind,j,K)),M.isVerticesDataPresent(g.f.UV2Kind)&&(b.uvs2=M.getVerticesData(g.f.UV2Kind,j,K)),M.isVerticesDataPresent(g.f.UV3Kind)&&(b.uvs3=M.getVerticesData(g.f.UV3Kind,j,K)),M.isVerticesDataPresent(g.f.UV4Kind)&&(b.uvs4=M.getVerticesData(g.f.UV4Kind,j,K)),M.isVerticesDataPresent(g.f.UV5Kind)&&(b.uvs5=M.getVerticesData(g.f.UV5Kind,j,K)),M.isVerticesDataPresent(g.f.UV6Kind)&&(b.uvs6=M.getVerticesData(g.f.UV6Kind,j,K)),M.isVerticesDataPresent(g.f.ColorKind)&&(b.colors=M.getVerticesData(g.f.ColorKind,j,K)),M.isVerticesDataPresent(g.f.MatricesIndicesKind)&&(b.matricesIndices=M.getVerticesData(g.f.MatricesIndicesKind,j,K)),M.isVerticesDataPresent(g.f.MatricesWeightsKind)&&(b.matricesWeights=M.getVerticesData(g.f.MatricesWeightsKind,j,K)),M.isVerticesDataPresent(g.f.MatricesIndicesExtraKind)&&(b.matricesIndicesExtra=M.getVerticesData(g.f.MatricesIndicesExtraKind,j,K)),M.isVerticesDataPresent(g.f.MatricesWeightsExtraKind)&&(b.matricesWeightsExtra=M.getVerticesData(g.f.MatricesWeightsExtraKind,j,K)),b.indices=M.getIndices(j,K),b},Z.CreateRibbon=function(Z){throw(0,O.e)("ribbonBuilder")},Z.CreateBox=function(Z){throw(0,O.e)("boxBuilder")},Z.CreateTiledBox=function(Z){throw(0,O.e)("tiledBoxBuilder")},Z.CreateTiledPlane=function(Z){throw(0,O.e)("tiledPlaneBuilder")},Z.CreateSphere=function(Z){throw(0,O.e)("sphereBuilder")},Z.CreateCylinder=function(Z){throw(0,O.e)("cylinderBuilder")},Z.CreateTorus=function(Z){throw(0,O.e)("torusBuilder")},Z.CreateLineSystem=function(Z){throw(0,O.e)("linesBuilder")},Z.CreateDashedLines=function(Z){throw(0,O.e)("linesBuilder")},Z.CreateGround=function(Z){throw(0,O.e)("groundBuilder")},Z.CreateTiledGround=function(Z){throw(0,O.e)("groundBuilder")},Z.CreateGroundFromHeightMap=function(Z){throw(0,O.e)("groundBuilder")},Z.CreatePlane=function(Z){throw(0,O.e)("planeBuilder")},Z.CreateDisc=function(Z){throw(0,O.e)("discBuilder")},Z.CreatePolygon=function(Z,M,j,K,b,g,Q){throw(0,O.e)("polygonBuilder")},Z.CreateIcoSphere=function(Z){throw(0,O.e)("icoSphereBuilder")},Z.CreatePolyhedron=function(Z){throw(0,O.e)("polyhedronBuilder")},Z.CreateCapsule=function(Z){throw void 0===Z&&(Z={orientation:b.k.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),(0,O.e)("capsuleBuilder")},Z.CreateTorusKnot=function(Z){throw(0,O.e)("torusKnotBuilder")},Z.ComputeNormals=function(Z,M,j,K){var g=0,O=0,Q=0,Y=0,I=0,E=0,s=0,i=0,a=0,z=0,V=0,o=0,c=0,G=0,f=0,X=0,d=0,W=0,A=0,q=0,T=!1,B=!1,N=!1,U=!1,n=1,k=0,x=null;K&&(T=!!K.facetNormals,B=!!K.facetPositions,N=!!K.facetPartitioning,n=!0===K.useRightHandedSystem?-1:1,k=K.ratio||0,U=!!K.depthSort,x=K.distanceTo,U&&void 0===x&&(x=b.k.Zero()));var R=0,e=0,u=0,F=0;for(N&&K&&K.bbSize&&(R=K.subDiv.X*k/K.bbSize.x,e=K.subDiv.Y*k/K.bbSize.y,u=K.subDiv.Z*k/K.bbSize.z,F=K.subDiv.max*K.subDiv.max,K.facetPartitioning.length=0),g=0;g<Z.length;g++)j[g]=0;var C=M.length/3|0;for(g=0;g<C;g++){if(c=(o=3*M[3*g])+1,G=o+2,X=(f=3*M[3*g+1])+1,d=f+2,A=(W=3*M[3*g+2])+1,q=W+2,O=Z[o]-Z[f],Q=Z[c]-Z[X],Y=Z[G]-Z[d],I=Z[W]-Z[f],E=Z[A]-Z[X],i=n*(Q*(s=Z[q]-Z[d])-Y*E),a=n*(Y*I-O*s),z=n*(O*E-Q*I),i/=V=0===(V=Math.sqrt(i*i+a*a+z*z))?1:V,a/=V,z/=V,T&&K&&(K.facetNormals[g].x=i,K.facetNormals[g].y=a,K.facetNormals[g].z=z),B&&K&&(K.facetPositions[g].x=(Z[o]+Z[f]+Z[W])/3,K.facetPositions[g].y=(Z[c]+Z[X]+Z[A])/3,K.facetPositions[g].z=(Z[G]+Z[d]+Z[q])/3),N&&K){var y=Math.floor((K.facetPositions[g].x-K.bInfo.minimum.x*k)*R),S=Math.floor((K.facetPositions[g].y-K.bInfo.minimum.y*k)*e),h=Math.floor((K.facetPositions[g].z-K.bInfo.minimum.z*k)*u),w=Math.floor((Z[o]-K.bInfo.minimum.x*k)*R),p=Math.floor((Z[c]-K.bInfo.minimum.y*k)*e),m=Math.floor((Z[G]-K.bInfo.minimum.z*k)*u),J=Math.floor((Z[f]-K.bInfo.minimum.x*k)*R),P=Math.floor((Z[X]-K.bInfo.minimum.y*k)*e),H=Math.floor((Z[d]-K.bInfo.minimum.z*k)*u),D=Math.floor((Z[W]-K.bInfo.minimum.x*k)*R),l=Math.floor((Z[A]-K.bInfo.minimum.y*k)*e),t=Math.floor((Z[q]-K.bInfo.minimum.z*k)*u),v=w+K.subDiv.max*p+F*m,r=J+K.subDiv.max*P+F*H,L=D+K.subDiv.max*l+F*t,ZZ=y+K.subDiv.max*S+F*h;K.facetPartitioning[ZZ]=K.facetPartitioning[ZZ]?K.facetPartitioning[ZZ]:new Array,K.facetPartitioning[v]=K.facetPartitioning[v]?K.facetPartitioning[v]:new Array,K.facetPartitioning[r]=K.facetPartitioning[r]?K.facetPartitioning[r]:new Array,K.facetPartitioning[L]=K.facetPartitioning[L]?K.facetPartitioning[L]:new Array,K.facetPartitioning[v].push(g),r!=v&&K.facetPartitioning[r].push(g),L!=r&&L!=v&&K.facetPartitioning[L].push(g),ZZ!=v&&ZZ!=r&&ZZ!=L&&K.facetPartitioning[ZZ].push(g)}if(U&&K&&K.facetPositions){var MZ=K.depthSortedFacets[g];MZ.ind=3*g,MZ.sqDistance=b.k.DistanceSquared(K.facetPositions[g],x)}j[o]+=i,j[c]+=a,j[G]+=z,j[f]+=i,j[X]+=a,j[d]+=z,j[W]+=i,j[A]+=a,j[q]+=z}for(g=0;g<j.length/3;g++)i=j[3*g],a=j[3*g+1],z=j[3*g+2],i/=V=0===(V=Math.sqrt(i*i+a*a+z*z))?1:V,a/=V,z/=V,j[3*g]=i,j[3*g+1]=a,j[3*g+2]=z},Z._ComputeSides=function(M,j,K,g,O,Q,Y){var I,E,s=K.length,i=g.length;switch(M=M||Z.DEFAULTSIDE){case Z.FRONTSIDE:break;case Z.BACKSIDE:for(I=0;I<s;I+=3){var a=K[I];K[I]=K[I+2],K[I+2]=a}for(E=0;E<i;E++)g[E]=-g[E];break;case Z.DOUBLESIDE:for(var z=j.length,V=z/3,o=0;o<z;o++)j[z+o]=j[o];for(I=0;I<s;I+=3)K[I+s]=K[I+2]+V,K[I+1+s]=K[I+1]+V,K[I+2+s]=K[I]+V;for(E=0;E<i;E++)g[i+E]=-g[E];var c=O.length,G=0;for(G=0;G<c;G++)O[G+c]=O[G];for(Q=Q||new b.l(0,0,1,1),Y=Y||new b.l(0,0,1,1),G=0,I=0;I<c/2;I++)O[G]=Q.x+(Q.z-Q.x)*O[G],O[G+1]=Q.y+(Q.w-Q.y)*O[G+1],O[G+c]=Y.x+(Y.z-Y.x)*O[G+c],O[G+c+1]=Y.y+(Y.w-Y.y)*O[G+c+1],G+=2}},Z.ImportVertexData=function(M,j){var K=new Z,b=M.positions;b&&K.set(b,g.f.PositionKind);var O=M.normals;O&&K.set(O,g.f.NormalKind);var Y=M.tangents;Y&&K.set(Y,g.f.TangentKind);var I=M.uvs;I&&K.set(I,g.f.UVKind);var E=M.uv2s;E&&K.set(E,g.f.UV2Kind);var s=M.uv3s;s&&K.set(s,g.f.UV3Kind);var i=M.uv4s;i&&K.set(i,g.f.UV4Kind);var a=M.uv5s;a&&K.set(a,g.f.UV5Kind);var z=M.uv6s;z&&K.set(z,g.f.UV6Kind);var V=M.colors;V&&K.set(Q.g.CheckColors4(V,b.length/3),g.f.ColorKind);var o=M.matricesIndices;o&&K.set(o,g.f.MatricesIndicesKind);var c=M.matricesWeights;c&&K.set(c,g.f.MatricesWeightsKind);var G=M.indices;G&&(K.indices=G),j.setAllVerticesData(K,M.updatable)},Z.FRONTSIDE=0,Z.BACKSIDE=1,Z.DOUBLESIDE=2,Z.DEFAULTSIDE=0,(0,K.l)([I.d.filter((function(){for(var Z=[],M=0;M<arguments.length;M++)Z[M]=arguments[M];var j=Z[0];return!Array.isArray(j)}))],Z,"_TransformVector3Coordinates",null),(0,K.l)([I.d.filter((function(){for(var Z=[],M=0;M<arguments.length;M++)Z[M]=arguments[M];var j=Z[0];return!Array.isArray(j)}))],Z,"_TransformVector3Normals",null),(0,K.l)([I.d.filter((function(){for(var Z=[],M=0;M<arguments.length;M++)Z[M]=arguments[M];var j=Z[0];return!Array.isArray(j)}))],Z,"_TransformVector4Normals",null),(0,K.l)([I.d.filter((function(){for(var Z=[],M=0;M<arguments.length;M++)Z[M]=arguments[M];var j=Z[0];return!Array.isArray(j)}))],Z,"_FlipFaces",null),Z}()},54588:function(Z,M,j){"use strict";j.d(M,{b:function(){return VZ}});var K=j(80105),b=j(65847),g=j(43251),O=j(85779),Q=j(20334);function Y(Z){var M=Z.pathArray,j=Z.closeArray||!1,K=Z.closePath||!1,b=Z.invertUV||!1,Y=Math.floor(M[0].length/2),I=Z.offset||Y;I=I>Y?Y:Math.floor(I);var E,s,i,a,z=0===Z.sideOrientation?0:Z.sideOrientation||O.e.DEFAULTSIDE,V=Z.uvs,o=Z.colors,c=[],G=[],f=[],X=[],d=[],W=[],A=[],q=[],T=[],B=[];if(M.length<2){var N=[],U=[];for(i=0;i<M[0].length-I;i++)N.push(M[0][i]),U.push(M[0][i+I]);M=[N,U]}var n,k,x,R,e,u=0,F=K?1:0;for(E=M[0].length,s=0;s<M.length;s++){for(A[s]=0,d[s]=[0],E=E<(k=(n=M[s]).length)?E:k,a=0;a<k;)c.push(n[a].x,n[a].y,n[a].z),a>0&&(x=n[a].subtract(n[a-1]).length()+A[s],d[s].push(x),A[s]=x),a++;K&&(a--,c.push(n[0].x,n[0].y,n[0].z),x=n[a].subtract(n[0]).length()+A[s],d[s].push(x),A[s]=x),T[s]=k+F,B[s]=u,u+=k+F}var C,y,S=null,h=null;for(i=0;i<E+F;i++){for(q[i]=0,W[i]=[0],s=0;s<M.length-1;s++)R=M[s],e=M[s+1],i===E?(S=R[0],h=e[0]):(S=R[i],h=e[i]),x=h.subtract(S).length()+q[i],W[i].push(x),q[i]=x;j&&h&&S&&(R=M[s],e=M[0],i===E&&(h=e[0]),x=h.subtract(S).length()+q[i],q[i]=x)}if(V)for(s=0;s<V.length;s++)X.push(V[s].x,Q.e.UseOpenGLOrientationForUV?1-V[s].y:V[s].y);else for(s=0;s<M.length;s++)for(i=0;i<E+F;i++)C=0!=A[s]?d[s][i]/A[s]:0,y=0!=q[i]?W[i][s]/q[i]:0,b?X.push(y,C):X.push(C,Q.e.UseOpenGLOrientationForUV?1-y:y);for(var w=0,p=T[s=0]-1,m=T[s+1]-1,J=p<m?p:m,P=B[1]-B[0],H=j?T.length:T.length-1;w<=J&&s<H;)G.push(w,w+P,w+1),G.push(w+P+1,w+1,w+P),(w+=1)===J&&(++s===T.length-1?(P=B[0]-B[s],p=T[s]-1,m=T[0]-1):(P=B[s+1]-B[s],p=T[s]-1,m=T[s+1]-1),w=B[s],J=p<m?p+w:m+w);if(O.e.ComputeNormals(c,G,f),K){var D=0,l=0;for(s=0;s<M.length;s++)D=3*B[s],l=s+1<M.length?3*(B[s+1]-1):f.length-3,f[D]=.5*(f[D]+f[l]),f[D+1]=.5*(f[D+1]+f[l+1]),f[D+2]=.5*(f[D+2]+f[l+2]),f[l]=f[D],f[l+1]=f[D+1],f[l+2]=f[D+2]}O.e._ComputeSides(z,c,G,f,X,Z.frontUVs,Z.backUVs);var t=null;if(o){t=new Float32Array(4*o.length);for(var v=0;v<o.length;v++)t[4*v]=o[v].r,t[4*v+1]=o[v].g,t[4*v+2]=o[v].b,t[4*v+3]=o[v].a}var r=new O.e,L=new Float32Array(c),ZZ=new Float32Array(f),MZ=new Float32Array(X);return r.indices=G,r.positions=L,r.normals=ZZ,r.uvs=MZ,t&&r.set(t,g.f.ColorKind),K&&(r._idx=B),r}function I(Z,M,j){void 0===j&&(j=null);var I=M.pathArray,E=M.closeArray,s=M.closePath,i=b.b._GetDefaultSideOrientation(M.sideOrientation),a=M.instance,z=M.updatable;if(a){var V=K.e.Vector3[0].setAll(Number.MAX_VALUE),o=K.e.Vector3[1].setAll(-Number.MAX_VALUE),c=a.getVerticesData(g.f.PositionKind);if(function(Z){for(var M=I[0].length,j=a,K=0,g=j._originalBuilderSideOrientation===b.b.DOUBLESIDE?2:1,O=1;O<=g;++O)for(var Q=0;Q<I.length;++Q){var Y=I[Q],E=Y.length;M=M<E?M:E;for(var s=0;s<M;++s){var i=Y[s];Z[K]=i.x,Z[K+1]=i.y,Z[K+2]=i.z,V.minimizeInPlaceFromFloats(i.x,i.y,i.z),o.maximizeInPlaceFromFloats(i.x,i.y,i.z),K+=3}if(j._creationDataStorage&&j._creationDataStorage.closePath){i=Y[0];Z[K]=i.x,Z[K+1]=i.y,Z[K+2]=i.z,K+=3}}}(c),a.hasBoundingInfo?a.getBoundingInfo().reConstruct(V,o,a._worldMatrix):a.buildBoundingInfo(V,o,a._worldMatrix),a.updateVerticesData(g.f.PositionKind,c,!1,!1),M.colors){for(var G=a.getVerticesData(g.f.ColorKind),f=0,X=0;f<M.colors.length;f++,X+=4){var d=M.colors[f];G[X]=d.r,G[X+1]=d.g,G[X+2]=d.b,G[X+3]=d.a}a.updateVerticesData(g.f.ColorKind,G,!1,!1)}if(M.uvs){for(var W=a.getVerticesData(g.f.UVKind),A=0;A<M.uvs.length;A++)W[2*A]=M.uvs[A].x,W[2*A+1]=Q.e.UseOpenGLOrientationForUV?1-M.uvs[A].y:M.uvs[A].y;a.updateVerticesData(g.f.UVKind,W,!1,!1)}if(!a.areNormalsFrozen||a.isFacetDataEnabled){var q=a.getIndices(),T=a.getVerticesData(g.f.NormalKind),B=a.isFacetDataEnabled?a.getFacetDataParameters():null;if(O.e.ComputeNormals(c,q,T,B),a._creationDataStorage&&a._creationDataStorage.closePath)for(var N=0,U=0,n=0;n<I.length;n++)N=3*a._creationDataStorage.idx[n],U=n+1<I.length?3*(a._creationDataStorage.idx[n+1]-1):T.length-3,T[N]=.5*(T[N]+T[U]),T[N+1]=.5*(T[N+1]+T[U+1]),T[N+2]=.5*(T[N+2]+T[U+2]),T[U]=T[N],T[U+1]=T[N+1],T[U+2]=T[N+2];a.areNormalsFrozen||a.updateVerticesData(g.f.NormalKind,T,!1,!1)}return a}var k=new b.b(Z,j);k._originalBuilderSideOrientation=i,k._creationDataStorage=new b.e;var x=Y(M);return s&&(k._creationDataStorage.idx=x._idx),k._creationDataStorage.closePath=s,k._creationDataStorage.closeArray=E,x.applyToMesh(k,z),k}O.e.CreateRibbon=Y,b.b.CreateRibbon=function(Z,M,j,K,b,g,O,Q,Y){return void 0===j&&(j=!1),void 0===O&&(O=!1),I(Z,{pathArray:M,closeArray:j,closePath:K,offset:b,updatable:O,sideOrientation:Q,instance:Y},g)};var E=j(60612),s=j(64400),i=j(9488);function a(Z){var M=Z.pattern||b.b.NO_FLIP,j=Z.tileWidth||Z.tileSize||1,K=Z.tileHeight||Z.tileSize||1,g=Z.alignHorizontal||0,Q=Z.alignVertical||0,Y=Z.width||Z.size||1,I=Math.floor(Y/j),E=Y-I*j,s=Z.height||Z.size||1,i=Math.floor(s/K),a=s-i*K,z=j*I/2,V=K*i/2,o=0,c=0,G=0,f=0,X=0,d=0;if(E>0||a>0){switch(G=-z,f=-V,X=z,d=V,g){case b.b.CENTER:G-=E/=2,X+=E;break;case b.b.LEFT:X+=E,o=-E/2;break;case b.b.RIGHT:G-=E,o=E/2}switch(Q){case b.b.CENTER:f-=a/=2,d+=a;break;case b.b.BOTTOM:d+=a,c=-a/2;break;case b.b.TOP:f-=a,c=a/2}}var W=[],A=[],q=[];q[0]=[0,0,1,0,1,1,0,1],q[1]=[0,0,1,0,1,1,0,1],M!==b.b.ROTATE_TILE&&M!==b.b.ROTATE_ROW||(q[1]=[1,1,0,1,0,0,1,0]),M!==b.b.FLIP_TILE&&M!==b.b.FLIP_ROW||(q[1]=[1,0,0,0,0,1,1,1]),M!==b.b.FLIP_N_ROTATE_TILE&&M!==b.b.FLIP_N_ROTATE_ROW||(q[1]=[0,1,1,1,1,0,0,0]);for(var T=[],B=[],N=[],U=0,n=0;n<i;n++)for(var k=0;k<I;k++)W.push(k*j-z+o,n*K-V+c,0),W.push((k+1)*j-z+o,n*K-V+c,0),W.push((k+1)*j-z+o,(n+1)*K-V+c,0),W.push(k*j-z+o,(n+1)*K-V+c,0),N.push(U,U+1,U+3,U+1,U+2,U+3),T=M===b.b.FLIP_TILE||M===b.b.ROTATE_TILE||M===b.b.FLIP_N_ROTATE_TILE?T.concat(q[(k%2+n%2)%2]):M===b.b.FLIP_ROW||M===b.b.ROTATE_ROW||M===b.b.FLIP_N_ROTATE_ROW?T.concat(q[n%2]):T.concat(q[0]),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),U+=4;if(E>0||a>0){var x=a>0&&(Q===b.b.CENTER||Q===b.b.TOP),R=a>0&&(Q===b.b.CENTER||Q===b.b.BOTTOM),e=E>0&&(g===b.b.CENTER||g===b.b.RIGHT),u=E>0&&(g===b.b.CENTER||g===b.b.LEFT),F=[],C=void 0,y=void 0,S=void 0,h=void 0;if(x&&e&&(W.push(G+o,f+c,0),W.push(-z+o,f+c,0),W.push(-z+o,f+a+c,0),W.push(G+o,f+a+c,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,F=[C=1-E/j,y=1-a/K,S=1,y,S,h=1,C,h],M===b.b.ROTATE_ROW&&(F=[1-C,1-y,1-S,1-y,1-S,1-h,1-C,1-h]),M===b.b.FLIP_ROW&&(F=[1-C,y,1-S,y,1-S,h,1-C,h]),M===b.b.FLIP_N_ROTATE_ROW&&(F=[C,1-y,S,1-y,S,1-h,C,1-h]),T=T.concat(F),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),x&&u&&(W.push(z+o,f+c,0),W.push(X+o,f+c,0),W.push(X+o,f+a+c,0),W.push(z+o,f+a+c,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,F=[C=0,y=1-a/K,S=E/j,y,S,h=1,C,h],(M===b.b.ROTATE_ROW||M===b.b.ROTATE_TILE&&I%2===0)&&(F=[1-C,1-y,1-S,1-y,1-S,1-h,1-C,1-h]),(M===b.b.FLIP_ROW||M===b.b.FLIP_TILE&&I%2===0)&&(F=[1-C,y,1-S,y,1-S,h,1-C,h]),(M===b.b.FLIP_N_ROTATE_ROW||M===b.b.FLIP_N_ROTATE_TILE&&I%2===0)&&(F=[C,1-y,S,1-y,S,1-h,C,1-h]),T=T.concat(F),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),R&&e&&(W.push(G+o,V+c,0),W.push(-z+o,V+c,0),W.push(-z+o,d+c,0),W.push(G+o,d+c,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,F=[C=1-E/j,y=0,S=1,y,S,h=a/K,C,h],(M===b.b.ROTATE_ROW&&i%2===1||M===b.b.ROTATE_TILE&&i%1===0)&&(F=[1-C,1-y,1-S,1-y,1-S,1-h,1-C,1-h]),(M===b.b.FLIP_ROW&&i%2===1||M===b.b.FLIP_TILE&&i%2===0)&&(F=[1-C,y,1-S,y,1-S,h,1-C,h]),(M===b.b.FLIP_N_ROTATE_ROW&&i%2===1||M===b.b.FLIP_N_ROTATE_TILE&&i%2===0)&&(F=[C,1-y,S,1-y,S,1-h,C,1-h]),T=T.concat(F),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),R&&u&&(W.push(z+o,V+c,0),W.push(X+o,V+c,0),W.push(X+o,d+c,0),W.push(z+o,d+c,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,F=[C=0,y=0,S=E/j,y,S,h=a/K,C,h],(M===b.b.ROTATE_ROW&&i%2===1||M===b.b.ROTATE_TILE&&(i+I)%2===1)&&(F=[1-C,1-y,1-S,1-y,1-S,1-h,1-C,1-h]),(M===b.b.FLIP_ROW&&i%2===1||M===b.b.FLIP_TILE&&(i+I)%2===1)&&(F=[1-C,y,1-S,y,1-S,h,1-C,h]),(M===b.b.FLIP_N_ROTATE_ROW&&i%2===1||M===b.b.FLIP_N_ROTATE_TILE&&(i+I)%2===1)&&(F=[C,1-y,S,1-y,S,1-h,C,1-h]),T=T.concat(F),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),x){var w=[];C=0,y=1-a/K,S=1,h=1,w[0]=[C,y,S,y,S,h,C,h],w[1]=[C,y,S,y,S,h,C,h],M!==b.b.ROTATE_TILE&&M!==b.b.ROTATE_ROW||(w[1]=[1-C,1-y,1-S,1-y,1-S,1-h,1-C,1-h]),M!==b.b.FLIP_TILE&&M!==b.b.FLIP_ROW||(w[1]=[1-C,y,1-S,y,1-S,h,1-C,h]),M!==b.b.FLIP_N_ROTATE_TILE&&M!==b.b.FLIP_N_ROTATE_ROW||(w[1]=[C,1-y,S,1-y,S,1-h,C,1-h]);for(k=0;k<I;k++)W.push(k*j-z+o,f+c,0),W.push((k+1)*j-z+o,f+c,0),W.push((k+1)*j-z+o,f+a+c,0),W.push(k*j-z+o,f+a+c,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,T=M===b.b.FLIP_TILE||M===b.b.ROTATE_TILE||M===b.b.FLIP_N_ROTATE_TILE?T.concat(w[(k+1)%2]):M===b.b.FLIP_ROW||M===b.b.ROTATE_ROW||M===b.b.FLIP_N_ROTATE_ROW?T.concat(w[1]):T.concat(w[0]),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(R){var p=[];C=0,y=0,S=1,h=a/K,p[0]=[C,y,S,y,S,h,C,h],p[1]=[C,y,S,y,S,h,C,h],M!==b.b.ROTATE_TILE&&M!==b.b.ROTATE_ROW||(p[1]=[1-C,1-y,1-S,1-y,1-S,1-h,1-C,1-h]),M!==b.b.FLIP_TILE&&M!==b.b.FLIP_ROW||(p[1]=[1-C,y,1-S,y,1-S,h,1-C,h]),M!==b.b.FLIP_N_ROTATE_TILE&&M!==b.b.FLIP_N_ROTATE_ROW||(p[1]=[C,1-y,S,1-y,S,1-h,C,1-h]);for(k=0;k<I;k++)W.push(k*j-z+o,d-a+c,0),W.push((k+1)*j-z+o,d-a+c,0),W.push((k+1)*j-z+o,d+c,0),W.push(k*j-z+o,d+c,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,T=M===b.b.FLIP_TILE||M===b.b.ROTATE_TILE||M===b.b.FLIP_N_ROTATE_TILE?T.concat(p[(k+i)%2]):M===b.b.FLIP_ROW||M===b.b.ROTATE_ROW||M===b.b.FLIP_N_ROTATE_ROW?T.concat(p[i%2]):T.concat(p[0]),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(e){var m=[];C=1-E/j,y=0,S=1,h=1,m[0]=[C,y,S,y,S,h,C,h],m[1]=[C,y,S,y,S,h,C,h],M!==b.b.ROTATE_TILE&&M!==b.b.ROTATE_ROW||(m[1]=[1-C,1-y,1-S,1-y,1-S,1-h,1-C,1-h]),M!==b.b.FLIP_TILE&&M!==b.b.FLIP_ROW||(m[1]=[1-C,y,1-S,y,1-S,h,1-C,h]),M!==b.b.FLIP_N_ROTATE_TILE&&M!==b.b.FLIP_N_ROTATE_ROW||(m[1]=[C,1-y,S,1-y,S,1-h,C,1-h]);for(n=0;n<i;n++)W.push(G+o,n*K-V+c,0),W.push(G+E+o,n*K-V+c,0),W.push(G+E+o,(n+1)*K-V+c,0),W.push(G+o,(n+1)*K-V+c,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,T=M===b.b.FLIP_TILE||M===b.b.ROTATE_TILE||M===b.b.FLIP_N_ROTATE_TILE?T.concat(m[(n+1)%2]):M===b.b.FLIP_ROW||M===b.b.ROTATE_ROW||M===b.b.FLIP_N_ROTATE_ROW?T.concat(m[n%2]):T.concat(m[0]),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){var J=[];C=0,y=0,S=E/K,h=1,J[0]=[C,y,S,y,S,h,C,h],J[1]=[C,y,S,y,S,h,C,h],M!==b.b.ROTATE_TILE&&M!==b.b.ROTATE_ROW||(J[1]=[1-C,1-y,1-S,1-y,1-S,1-h,1-C,1-h]),M!==b.b.FLIP_TILE&&M!==b.b.FLIP_ROW||(J[1]=[1-C,y,1-S,y,1-S,h,1-C,h]),M!==b.b.FLIP_N_ROTATE_TILE&&M!==b.b.FLIP_N_ROTATE_ROW||(J[1]=[C,1-y,S,1-y,S,1-h,C,1-h]);for(n=0;n<i;n++)W.push(X-E+o,n*K-V+c,0),W.push(X+o,n*K-V+c,0),W.push(X+o,(n+1)*K-V+c,0),W.push(X-E+o,(n+1)*K-V+c,0),N.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,T=M===b.b.FLIP_TILE||M===b.b.ROTATE_TILE||M===b.b.FLIP_N_ROTATE_TILE?T.concat(J[(n+I)%2]):M===b.b.FLIP_ROW||M===b.b.ROTATE_ROW||M===b.b.FLIP_N_ROTATE_ROW?T.concat(J[n%2]):T.concat(J[0]),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var P=0===Z.sideOrientation?0:Z.sideOrientation||O.e.DEFAULTSIDE;O.e._ComputeSides(P,W,N,A,T,Z.frontUVs,Z.backUVs);var H=new O.e;H.indices=N,H.positions=W,H.normals=A,H.uvs=T;var D=P===O.e.DOUBLESIDE?B.concat(B):B;return H.colors=D,H}function z(Z,M,j){void 0===j&&(j=null);var K=new b.b(Z,j);return M.sideOrientation=b.b._GetDefaultSideOrientation(M.sideOrientation),K._originalBuilderSideOrientation=M.sideOrientation,a(M).applyToMesh(K,M.updatable),K}function V(Z){for(var M=Z.faceUV||new Array(6),j=Z.faceColors,g=Z.pattern||b.b.NO_FLIP,Y=Z.width||Z.size||1,I=Z.height||Z.size||1,E=Z.depth||Z.size||1,s=Z.tileWidth||Z.tileSize||1,z=Z.tileHeight||Z.tileSize||1,V=Z.alignHorizontal||0,o=Z.alignVertical||0,c=0===Z.sideOrientation?0:Z.sideOrientation||O.e.DEFAULTSIDE,G=0;G<6;G++)void 0===M[G]&&(M[G]=new K.l(0,0,1,1)),j&&void 0===j[G]&&(j[G]=new i.g(1,1,1,1));var f=Y/2,X=I/2,d=E/2,W=[];for(G=0;G<2;G++)W[G]=a({pattern:g,tileWidth:s,tileHeight:z,width:Y,height:I,alignVertical:o,alignHorizontal:V,sideOrientation:c});for(G=2;G<4;G++)W[G]=a({pattern:g,tileWidth:s,tileHeight:z,width:E,height:I,alignVertical:o,alignHorizontal:V,sideOrientation:c});var A=o;o===b.b.BOTTOM?A=b.b.TOP:o===b.b.TOP&&(A=b.b.BOTTOM);for(G=4;G<6;G++)W[G]=a({pattern:g,tileWidth:s,tileHeight:z,width:Y,height:E,alignVertical:A,alignHorizontal:V,sideOrientation:c});var q=[],T=[],B=[],N=[],U=[],n=[],k=[],x=[],R=0,e=0;for(G=0;G<6;G++){var u=W[G].positions.length;n[G]=[],k[G]=[];for(var F=0;F<u/3;F++)n[G].push(new K.k(W[G].positions[3*F],W[G].positions[3*F+1],W[G].positions[3*F+2])),k[G].push(new K.k(W[G].normals[3*F],W[G].normals[3*F+1],W[G].normals[3*F+2]));R=W[G].uvs.length,x[G]=[];for(var C=0;C<R;C+=2)x[G][C]=M[G].x+(M[G].z-M[G].x)*W[G].uvs[C],x[G][C+1]=M[G].y+(M[G].w-M[G].y)*W[G].uvs[C+1],Q.e.UseOpenGLOrientationForUV&&(x[G][C+1]=1-x[G][C+1]);if(B=B.concat(x[G]),N=N.concat(W[G].indices.map((function(Z){return Z+e}))),e+=n[G].length,j)for(var y=0;y<4;y++)U.push(j[G].r,j[G].g,j[G].b,j[G].a)}var S=new K.k(0,0,d),h=K.c.RotationY(Math.PI);q=n[0].map((function(Z){return K.k.TransformNormal(Z,h).add(S)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[]),T=k[0].map((function(Z){return K.k.TransformNormal(Z,h)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[]),q=q.concat(n[1].map((function(Z){return Z.subtract(S)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[])),T=T.concat(k[1].map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[]));var w=new K.k(f,0,0),p=K.c.RotationY(-Math.PI/2);q=q.concat(n[2].map((function(Z){return K.k.TransformNormal(Z,p).add(w)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[])),T=T.concat(k[2].map((function(Z){return K.k.TransformNormal(Z,p)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[]));var m=K.c.RotationY(Math.PI/2);q=q.concat(n[3].map((function(Z){return K.k.TransformNormal(Z,m).subtract(w)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[])),T=T.concat(k[3].map((function(Z){return K.k.TransformNormal(Z,m)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[]));var J=new K.k(0,X,0),P=K.c.RotationX(Math.PI/2);q=q.concat(n[4].map((function(Z){return K.k.TransformNormal(Z,P).add(J)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[])),T=T.concat(k[4].map((function(Z){return K.k.TransformNormal(Z,P)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[]));var H=K.c.RotationX(-Math.PI/2);q=q.concat(n[5].map((function(Z){return K.k.TransformNormal(Z,H).subtract(J)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[])),T=T.concat(k[5].map((function(Z){return K.k.TransformNormal(Z,H)})).map((function(Z){return[Z.x,Z.y,Z.z]})).reduce((function(Z,M){return Z.concat(M)}),[])),O.e._ComputeSides(c,q,N,T,B);var D=new O.e;if(D.indices=N,D.positions=q,D.normals=T,D.uvs=B,j){var l=c===O.e.DOUBLESIDE?U.concat(U):U;D.colors=l}return D}function o(Z,M,j){void 0===j&&(j=null);var K=new b.b(Z,j);return M.sideOrientation=b.b._GetDefaultSideOrientation(M.sideOrientation),K._originalBuilderSideOrientation=M.sideOrientation,V(M).applyToMesh(K,M.updatable),K}O.e.CreateTiledPlane=a;O.e.CreateTiledBox=V;var c=j(71898),G=j(37105),f=j(54044);function X(Z){var M=Z.height||2,j=0===Z.diameterTop?0:Z.diameterTop||Z.diameter||1,g=0===Z.diameterBottom?0:Z.diameterBottom||Z.diameter||1;j=j||1e-5,g=g||1e-5;var Y,I=Z.tessellation||24,E=Z.subdivisions||1,s=!!Z.hasRings,a=!!Z.enclose,z=0===Z.cap?0:Z.cap||b.b.CAP_ALL,V=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,o=0===Z.sideOrientation?0:Z.sideOrientation||O.e.DEFAULTSIDE,c=Z.faceUV||new Array(3),G=Z.faceColors,X=2+(1+(1!==V&&a?2:0))*(s?E:1);for(Y=0;Y<X;Y++)G&&void 0===G[Y]&&(G[Y]=new i.g(1,1,1,1));for(Y=0;Y<X;Y++)c&&void 0===c[Y]&&(c[Y]=new K.l(0,0,1,1));var d,W,A,q,T,B,N=new Array,U=new Array,n=new Array,k=new Array,x=new Array,R=2*Math.PI*V/I,e=(g-j)/2/M,u=K.k.Zero(),F=K.k.Zero(),C=K.k.Zero(),y=K.k.Zero(),S=K.k.Zero(),h=f.b.Y,w=1,p=1,m=0,J=0;for(q=0;q<=E;q++)for(A=((W=q/E)*(j-g)+g)/2,w=s&&0!==q&&q!==E?2:1,B=0;B<w;B++){for(s&&(p+=B),a&&(p+=2*B),T=0;T<=I;T++)d=T*R,u.x=Math.cos(-d)*A,u.y=-M/2+W*M,u.z=Math.sin(-d)*A,0===j&&q===E?(F.x=n[n.length-3*(I+1)],F.y=n[n.length-3*(I+1)+1],F.z=n[n.length-3*(I+1)+2]):(F.x=u.x,F.z=u.z,F.y=Math.sqrt(F.x*F.x+F.z*F.z)*e,F.normalize()),0===T&&(C.copyFrom(u),y.copyFrom(F)),U.push(u.x,u.y,u.z),n.push(F.x,F.y,F.z),J=s?m!==p?c[p].y:c[p].w:c[p].y+(c[p].w-c[p].y)*W,k.push(c[p].x+(c[p].z-c[p].x)*T/I,Q.e.UseOpenGLOrientationForUV?1-J:J),G&&x.push(G[p].r,G[p].g,G[p].b,G[p].a);1!==V&&a&&(U.push(u.x,u.y,u.z),U.push(0,u.y,0),U.push(0,u.y,0),U.push(C.x,C.y,C.z),K.k.CrossToRef(h,F,S),S.normalize(),n.push(S.x,S.y,S.z,S.x,S.y,S.z),K.k.CrossToRef(y,h,S),S.normalize(),n.push(S.x,S.y,S.z,S.x,S.y,S.z),J=s?m!==p?c[p+1].y:c[p+1].w:c[p+1].y+(c[p+1].w-c[p+1].y)*W,k.push(c[p+1].x,Q.e.UseOpenGLOrientationForUV?1-J:J),k.push(c[p+1].z,Q.e.UseOpenGLOrientationForUV?1-J:J),J=s?m!==p?c[p+2].y:c[p+2].w:c[p+2].y+(c[p+2].w-c[p+2].y)*W,k.push(c[p+2].x,Q.e.UseOpenGLOrientationForUV?1-J:J),k.push(c[p+2].z,Q.e.UseOpenGLOrientationForUV?1-J:J),G&&(x.push(G[p+1].r,G[p+1].g,G[p+1].b,G[p+1].a),x.push(G[p+1].r,G[p+1].g,G[p+1].b,G[p+1].a),x.push(G[p+2].r,G[p+2].g,G[p+2].b,G[p+2].a),x.push(G[p+2].r,G[p+2].g,G[p+2].b,G[p+2].a))),m!==p&&(m=p)}var P=1!==V&&a?I+4:I;for(q=0,p=0;p<E;p++){var H=0,D=0,l=0,t=0;for(T=0;T<I;T++)H=q*(P+1)+T,D=(q+1)*(P+1)+T,l=q*(P+1)+(T+1),t=(q+1)*(P+1)+(T+1),N.push(H,D,l),N.push(t,l,D);1!==V&&a&&(N.push(H+2,D+2,l+2),N.push(t+2,l+2,D+2),N.push(H+4,D+4,l+4),N.push(t+4,l+4,D+4)),q=s?q+2:q+1}var v=function(Z){var b=Z?j/2:g/2;if(0!==b){var O,Y,E,s=Z?c[X-1]:c[0],i=null;G&&(i=Z?G[X-1]:G[0]);var a=U.length/3,z=Z?M/2:-M/2,o=new K.k(0,z,0);U.push(o.x,o.y,o.z),n.push(0,Z?1:-1,0);var f=s.y+.5*(s.w-s.y);k.push(s.x+.5*(s.z-s.x),Q.e.UseOpenGLOrientationForUV?1-f:f),i&&x.push(i.r,i.g,i.b,i.a);var d=new K.h(.5,.5);for(E=0;E<=I;E++){O=2*Math.PI*E*V/I;var W=Math.cos(-O),A=Math.sin(-O);Y=new K.k(W*b,z,A*b);var q=new K.h(W*d.x+.5,A*d.y+.5);U.push(Y.x,Y.y,Y.z),n.push(0,Z?1:-1,0);var T=s.y+(s.w-s.y)*q.y;k.push(s.x+(s.z-s.x)*q.x,Q.e.UseOpenGLOrientationForUV?1-T:T),i&&x.push(i.r,i.g,i.b,i.a)}for(E=0;E<I;E++)Z?(N.push(a),N.push(a+(E+2)),N.push(a+(E+1))):(N.push(a),N.push(a+(E+1)),N.push(a+(E+2)))}};z!==b.b.CAP_START&&z!==b.b.CAP_ALL||v(!1),z!==b.b.CAP_END&&z!==b.b.CAP_ALL||v(!0),O.e._ComputeSides(o,U,N,n,k,Z.frontUVs,Z.backUVs);var r=new O.e;return r.indices=N,r.positions=U,r.normals=n,r.uvs=k,G&&(r.colors=x),r}function d(Z,M,j){void 0===M&&(M={});var K=new b.b(Z,j);return M.sideOrientation=b.b._GetDefaultSideOrientation(M.sideOrientation),K._originalBuilderSideOrientation=M.sideOrientation,X(M).applyToMesh(K,M.updatable),K}function W(Z){for(var M=[],j=[],b=[],g=[],Y=Z.diameter||1,I=Z.thickness||.5,E=Z.tessellation||16,s=0===Z.sideOrientation?0:Z.sideOrientation||O.e.DEFAULTSIDE,i=E+1,a=0;a<=E;a++)for(var z=a/E,V=a*Math.PI*2/E-Math.PI/2,o=K.c.Translation(Y/2,0,0).multiply(K.c.RotationY(V)),c=0;c<=E;c++){var G=1-c/E,f=c*Math.PI*2/E+Math.PI,X=Math.cos(f),d=Math.sin(f),W=new K.k(X,d,0),A=W.scale(I/2),q=new K.h(z,G);A=K.k.TransformCoordinates(A,o),W=K.k.TransformNormal(W,o),j.push(A.x,A.y,A.z),b.push(W.x,W.y,W.z),g.push(q.x,Q.e.UseOpenGLOrientationForUV?1-q.y:q.y);var T=(a+1)%i,B=(c+1)%i;M.push(a*i+c),M.push(a*i+B),M.push(T*i+c),M.push(a*i+B),M.push(T*i+B),M.push(T*i+c)}O.e._ComputeSides(s,j,M,b,g,Z.frontUVs,Z.backUVs);var N=new O.e;return N.indices=M,N.positions=j,N.normals=b,N.uvs=g,N}function A(Z,M,j){void 0===M&&(M={});var K=new b.b(Z,j);return M.sideOrientation=b.b._GetDefaultSideOrientation(M.sideOrientation),K._originalBuilderSideOrientation=M.sideOrientation,W(M).applyToMesh(K,M.updatable),K}O.e.CreateCylinder=X,b.b.CreateCylinder=function(Z,M,j,K,g,O,Q,Y,I){return void 0!==Q&&Q instanceof G.c||(void 0!==Q&&(I=Y||b.b.DEFAULTSIDE,Y=Q),Q=O,O=1),d(Z,{height:M,diameterTop:j,diameterBottom:K,tessellation:g,subdivisions:O,sideOrientation:I,updatable:Y},Q)};function q(Z){var M,j,b=new Array,g=new Array,Y=new Array,I=new Array,E=Z.radius||2,s=Z.tube||.5,i=Z.radialSegments||32,a=Z.tubularSegments||32,z=Z.p||2,V=Z.q||3,o=0===Z.sideOrientation?0:Z.sideOrientation||O.e.DEFAULTSIDE,c=function(Z){var M=Math.cos(Z),j=Math.sin(Z),b=V/z*Z,g=Math.cos(b),O=E*(2+g)*.5*M,Q=E*(2+g)*j*.5,Y=E*Math.sin(b)*.5;return new K.k(O,Q,Y)};for(M=0;M<=i;M++){var G=M%i/i*2*z*Math.PI,f=c(G),X=c(G+.01),d=X.subtract(f),W=X.add(f),A=K.k.Cross(d,W);for(W=K.k.Cross(A,d),A.normalize(),W.normalize(),j=0;j<a;j++){var q=j%a/a*2*Math.PI,T=-s*Math.cos(q),B=s*Math.sin(q);g.push(f.x+T*W.x+B*A.x),g.push(f.y+T*W.y+B*A.y),g.push(f.z+T*W.z+B*A.z),I.push(M/i),I.push(Q.e.UseOpenGLOrientationForUV?1-j/a:j/a)}}for(M=0;M<i;M++)for(j=0;j<a;j++){var N=(j+1)%a,U=M*a+j,n=(M+1)*a+j,k=(M+1)*a+N,x=M*a+N;b.push(x),b.push(n),b.push(U),b.push(x),b.push(k),b.push(n)}O.e.ComputeNormals(g,b,Y),O.e._ComputeSides(o,g,b,Y,I,Z.frontUVs,Z.backUVs);var R=new O.e;return R.indices=b,R.positions=g,R.normals=Y,R.uvs=I,R}function T(Z,M,j){void 0===M&&(M={});var K=new b.b(Z,j);return M.sideOrientation=b.b._GetDefaultSideOrientation(M.sideOrientation),K._originalBuilderSideOrientation=M.sideOrientation,q(M).applyToMesh(K,M.updatable),K}O.e.CreateTorus=W,b.b.CreateTorus=function(Z,M,j,K,b,g,O){return A(Z,{diameter:M,thickness:j,tessellation:K,sideOrientation:O,updatable:g},b)};O.e.CreateTorusKnot=q,b.b.CreateTorusKnot=function(Z,M,j,K,b,g,O,Q,Y,I){return T(Z,{radius:M,tube:j,radialSegments:K,tubularSegments:b,p:g,q:O,sideOrientation:I,updatable:Y},Q)};var B=j(55706),N=j(40061),U=j(9127),n=j(12476),k=j(61686),x=j(78588),R=function(Z){function M(M,j){var K=Z.call(this,M.x,M.y)||this;return K.index=j,K}return(0,N.m)(M,Z),M}(K.h),e=function(){function Z(){this.elements=new Array}return Z.prototype.add=function(Z){var M=this,j=new Array;return Z.forEach((function(Z){var K=new R(Z,M.elements.length);j.push(K),M.elements.push(K)})),j},Z.prototype.computeBounds=function(){var Z=new K.h(this.elements[0].x,this.elements[0].y),M=new K.h(this.elements[0].x,this.elements[0].y);return this.elements.forEach((function(j){j.x<Z.x?Z.x=j.x:j.x>M.x&&(M.x=j.x),j.y<Z.y?Z.y=j.y:j.y>M.y&&(M.y=j.y)})),{min:Z,max:M,width:M.x-Z.x,height:M.y-Z.y}},Z}(),u=(function(){function Z(){}Z.Rectangle=function(Z,M,j,b){return[new K.h(Z,M),new K.h(j,M),new K.h(j,b),new K.h(Z,b)]},Z.Circle=function(Z,M,j,b){void 0===M&&(M=0),void 0===j&&(j=0),void 0===b&&(b=32);for(var g=new Array,O=0,Q=2*Math.PI/b,Y=0;Y<b;Y++)g.push(new K.h(M+Math.cos(O)*Z,j+Math.sin(O)*Z)),O-=Q;return g},Z.Parse=function(Z){var M,j=Z.split(/[^-+eE.\d]+/).map(parseFloat).filter((function(Z){return!isNaN(Z)})),b=[];for(M=0;M<(2147483646&j.length);M+=2)b.push(new K.h(j[M],j[M+1]));return b},Z.StartingAt=function(Z,M){return n.i.StartingAt(Z,M)}}(),function(){function Z(Z,M,j,K){var b;void 0===K&&(K=earcut),this._points=new e,this._outlinepoints=new e,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=K,this._name=Z,this._scene=j||x.e.LastCreatedScene,b=M instanceof n.i?M.getPoints():M,this._addToepoint(b),this._points.add(b),this._outlinepoints.add(b),"undefined"===typeof this.bjsEarcut&&U.c.Warn("Earcut was not found, the polygon will not be built.")}return Z.prototype._addToepoint=function(Z){for(var M=0,j=Z;M<j.length;M++){var K=j[M];this._epoints.push(K.x,K.y)}},Z.prototype.addHole=function(Z){this._points.add(Z);var M=new e;return M.add(Z),this._holes.push(M),this._eholes.push(this._epoints.length/2),this._addToepoint(Z),this},Z.prototype.build=function(Z,M,j){void 0===Z&&(Z=!1),void 0===M&&(M=0),void 0===j&&(j=2);var K=new b.b(this._name,this._scene),O=this.buildVertexData(M,j);return K.setVerticesData(g.f.PositionKind,O.positions,Z),K.setVerticesData(g.f.NormalKind,O.normals,Z),K.setVerticesData(g.f.UVKind,O.uvs,Z),K.setIndices(O.indices),K},Z.prototype.buildVertexData=function(Z,M){var j=this;void 0===Z&&(Z=0),void 0===M&&(M=2);var K=new O.e,b=new Array,g=new Array,Q=new Array,Y=this._points.computeBounds();this._points.elements.forEach((function(Z){b.push(0,1,0),g.push(Z.x,0,Z.y),Q.push((Z.x-Y.min.x)/Y.width,(Z.y-Y.min.y)/Y.height)}));for(var I=new Array,E=this.bjsEarcut(this._epoints,this._eholes,2),s=0;s<E.length;s++)I.push(E[s]);if(Z>0){var i=g.length/3;this._points.elements.forEach((function(M){b.push(0,-1,0),g.push(M.x,-Z,M.y),Q.push(1-(M.x-Y.min.x)/Y.width,1-(M.y-Y.min.y)/Y.height)}));var a=I.length;for(s=0;s<a;s+=3){var z=I[s+0],V=I[s+1],o=I[s+2];I.push(o+i),I.push(V+i),I.push(z+i)}this._addSide(g,b,Q,I,Y,this._outlinepoints,Z,!1,M),this._holes.forEach((function(K){j._addSide(g,b,Q,I,Y,K,Z,!0,M)}))}return K.indices=I,K.positions=g,K.normals=b,K.uvs=Q,K},Z.prototype._addSide=function(Z,M,j,b,g,O,Q,Y,I){for(var E=Z.length/3,s=0,i=0;i<O.elements.length;i++){var a=O.elements[i],z=O.elements[(i+1)%O.elements.length];Z.push(a.x,0,a.y),Z.push(a.x,-Q,a.y),Z.push(z.x,0,z.y),Z.push(z.x,-Q,z.y);var V=O.elements[(i+O.elements.length-1)%O.elements.length],o=O.elements[(i+2)%O.elements.length],c=new K.k(-(z.y-a.y),0,z.x-a.x),G=new K.k(-(a.y-V.y),0,a.x-V.x),f=new K.k(-(o.y-z.y),0,o.x-z.x);Y||(c=c.scale(-1),G=G.scale(-1),f=f.scale(-1));var X=c.normalizeToNew(),d=G.normalizeToNew(),W=f.normalizeToNew(),A=K.k.Dot(d,X);d=A>I?A<k.e-1?new K.k(a.x,0,a.y).subtract(new K.k(z.x,0,z.y)).normalize():G.add(c).normalize():X;var q=K.k.Dot(f,c);W=q>I?q<k.e-1?new K.k(z.x,0,z.y).subtract(new K.k(a.x,0,a.y)).normalize():f.add(c).normalize():X,j.push(s/g.width,0),j.push(s/g.width,1),s+=c.length(),j.push(s/g.width,0),j.push(s/g.width,1),M.push(d.x,d.y,d.z),M.push(d.x,d.y,d.z),M.push(W.x,W.y,W.z),M.push(W.x,W.y,W.z),Y?(b.push(E),b.push(E+2),b.push(E+1),b.push(E+1),b.push(E+2),b.push(E+3)):(b.push(E),b.push(E+1),b.push(E+2),b.push(E+1),b.push(E+3),b.push(E+2)),E+=4}},Z}());function F(Z,M,j,b,Y,I,E){for(var s=j||new Array(3),a=b,z=[],V=E||!1,o=0;o<3;o++)void 0===s[o]&&(s[o]=new K.l(0,0,1,1)),a&&void 0===a[o]&&(a[o]=new i.g(1,1,1,1));var c=Z.getVerticesData(g.f.PositionKind),G=Z.getVerticesData(g.f.NormalKind),f=Z.getVerticesData(g.f.UVKind),X=Z.getIndices(),d=c.length/9,W=0,A=0,q=0,T=0,B=[0];if(V)for(var N=d;N<c.length/3;N+=4)A=c[3*(N+2)]-c[3*N],q=c[3*(N+2)+2]-c[3*N+2],T+=Math.sqrt(A*A+q*q),B.push(T);for(var U=0,n=0,k=0;k<G.length;k+=3)Math.abs(G[k+1])<.001&&(n=1),Math.abs(G[k+1]-1)<.001&&(n=0),Math.abs(G[k+1]+1)<.001&&(n=2),U=k/3,1===n?(W=U-d,f[2*U]=W%4<1.5?V?s[n].x+(s[n].z-s[n].x)*B[Math.floor(W/4)]/T:s[n].x:V?s[n].x+(s[n].z-s[n].x)*B[Math.floor(W/4)+1]/T:s[n].z,f[2*U+1]=W%2===0?Q.e.UseOpenGLOrientationForUV?1-s[n].w:s[n].w:Q.e.UseOpenGLOrientationForUV?1-s[n].y:s[n].y):(f[2*U]=(1-f[2*U])*s[n].x+f[2*U]*s[n].z,f[2*U+1]=(1-f[2*U+1])*s[n].y+f[2*U+1]*s[n].w,Q.e.UseOpenGLOrientationForUV&&(f[2*U+1]=1-f[2*U+1])),a&&z.push(a[n].r,a[n].g,a[n].b,a[n].a);O.e._ComputeSides(M,c,X,G,f,Y,I);var x=new O.e;if(x.indices=X,x.positions=c,x.normals=G,x.uvs=f,a){var R=M===O.e.DOUBLESIDE?z.concat(z):z;x.colors=R}return x}function C(Z,M,j,g){void 0===j&&(j=null),void 0===g&&(g=earcut),M.sideOrientation=b.b._GetDefaultSideOrientation(M.sideOrientation);for(var O=M.shape,Q=M.holes||[],Y=M.depth||0,I=M.smoothingThreshold||2,E=[],s=[],i=0;i<O.length;i++)E[i]=new K.h(O[i].x,O[i].z);E[0].equalsWithEpsilon(E[E.length-1],1e-8)&&E.pop();for(var a=new u(Z,E,j||x.e.LastCreatedScene,g),z=0;z<Q.length;z++){s=[];for(var V=0;V<Q[z].length;V++)s.push(new K.h(Q[z][V].x,Q[z][V].z));a.addHole(s)}var o=a.build(!1,Y,I);return o._originalBuilderSideOrientation=M.sideOrientation,F(o,M.sideOrientation,M.faceUV,M.faceColors,M.frontUVs,M.backUVs,M.wrap).applyToMesh(o,M.updatable),o}function y(Z,M,j,K){return void 0===j&&(j=null),void 0===K&&(K=earcut),C(Z,M,j,K)}function S(Z,M,j){void 0===j&&(j=null);var K=M.path,g=M.shape,O=M.scale||1,Q=M.rotation||0,Y=0===M.cap?0:M.cap||b.b.NO_CAP,I=M.updatable,E=b.b._GetDefaultSideOrientation(M.sideOrientation),s=M.instance||null,i=M.invertUV||!1,a=M.closeShape||!1;return w(Z,g,K,O,Q,null,null,M.closePath||!1,a,Y,!1,j,!!I,E,s,i,M.frontUVs||null,M.backUVs||null,M.firstNormal||null,!!M.adjustFrame)}function h(Z,M,j){void 0===j&&(j=null);var K=M.path,g=M.shape,O=M.scaleFunction||function(){return 1},Q=M.rotationFunction||function(){return 0},Y=M.closePath||M.ribbonCloseArray||!1,I=M.closeShape||M.ribbonClosePath||!1,E=0===M.cap?0:M.cap||b.b.NO_CAP,s=M.updatable,i=M.firstNormal||null,a=M.adjustFrame||!1;return w(Z,g,K,null,null,O,Q,Y,I,E,!0,j,!!s,b.b._GetDefaultSideOrientation(M.sideOrientation),M.instance||null,M.invertUV||!1,M.frontUVs||null,M.backUVs||null,i,a)}function w(Z,M,j,g,O,Q,Y,E,s,i,a,z,V,o,c,G,f,X,d,W){var A,q,T=function(Z,M,j,g,O,Q,Y,I,E,s,i){var a=j.getTangents(),z=j.getNormals(),V=j.getBinormals(),o=j.getDistances();if(i)for(var c=0;c<a.length;c++)if(0==a[c].x&&0==a[c].y&&0==a[c].z&&a[c].copyFrom(a[c-1]),0==z[c].x&&0==z[c].y&&0==z[c].z&&z[c].copyFrom(z[c-1]),0==V[c].x&&0==V[c].y&&0==V[c].z&&V[c].copyFrom(V[c-1]),c>0){var G=a[c-1];K.k.Dot(G,a[c])<0&&a[c].scaleInPlace(-1),G=z[c-1],K.k.Dot(G,z[c])<0&&z[c].scaleInPlace(-1),G=V[c-1],K.k.Dot(G,V[c])<0&&V[c].scaleInPlace(-1)}var f=0,X=s&&I?I:function(){return null!==Q?Q:0},d=s&&Y?Y:function(){return null!==O?O:1},W=E===b.b.NO_CAP||E===b.b.CAP_END?0:2,A=K.e.Matrix[0];for(c=0;c<M.length;c++){var q=new Array,T=X(c,o[c]),B=d(c,o[c]);K.c.RotationAxisToRef(a[c],f,A);for(var N=0;N<Z.length;N++){var U=a[c].scale(Z[N].z).add(z[c].scale(Z[N].x)).add(V[c].scale(Z[N].y)),n=K.k.Zero();K.k.TransformCoordinatesToRef(U,A,n),n.scaleInPlace(B).addInPlace(M[c]),q[N]=n}g[W]=q,f+=T,W++}var k=function(Z){var M,j=Array(),b=K.k.Zero();for(M=0;M<Z.length;M++)b.addInPlace(Z[M]);for(b.scaleInPlace(1/Z.length),M=0;M<Z.length;M++)j.push(b);return j};switch(E){case b.b.NO_CAP:break;case b.b.CAP_START:g[0]=k(g[2]),g[1]=g[2];break;case b.b.CAP_END:g[W]=g[W-1],g[W+1]=k(g[W-1]);break;case b.b.CAP_ALL:g[0]=k(g[2]),g[1]=g[2],g[W]=g[W-1],g[W+1]=k(g[W-1])}return g};if(c){var B=c._creationDataStorage;return A=d?B.path3D.update(j,d):B.path3D.update(j),c=I("",{pathArray:q=T(M,j,B.path3D,B.pathArray,g,O,Q,Y,B.cap,a,W),closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:c},z||void 0)}i=i<0||i>3?0:i;var N=I(Z,{pathArray:q=T(M,j,A=d?new n.k(j,d):new n.k(j),new Array,g,O,Q,Y,i,a,W),closeArray:E,closePath:s,updatable:V,sideOrientation:o,invertUV:G,frontUVs:f||void 0,backUVs:X||void 0},z);return N._creationDataStorage.pathArray=q,N._creationDataStorage.path3D=A,N._creationDataStorage.cap=i,N}O.e.CreatePolygon=F,b.b.CreatePolygon=function(Z,M,j,K,b,g,O){return void 0===O&&(O=earcut),C(Z,{shape:M,holes:K,updatable:b,sideOrientation:g},j,O)},b.b.ExtrudePolygon=function(Z,M,j,K,b,g,O,Q){return void 0===Q&&(Q=earcut),y(Z,{shape:M,holes:b,depth:j,updatable:g,sideOrientation:O},K,Q)};function p(Z,M,j){void 0===j&&(j=null);var g,O,Q=M.arc?M.arc<=0||M.arc>1?1:M.arc:1,Y=void 0===M.closed||M.closed,E=M.shape,s=M.radius||1,i=M.tessellation||64,a=M.clip||0,z=M.updatable,V=b.b._GetDefaultSideOrientation(M.sideOrientation),o=M.cap||b.b.NO_CAP,c=2*Math.PI,G=new Array,f=M.invertUV||!1,X=0,d=0,W=c/i*Q;for(X=0;X<=i-a;X++){for(O=[],o!=b.b.CAP_START&&o!=b.b.CAP_ALL||(O.push(new K.k(0,E[0].y,0)),O.push(new K.k(Math.cos(X*W)*E[0].x*s,E[0].y,Math.sin(X*W)*E[0].x*s))),d=0;d<E.length;d++)g=new K.k(Math.cos(X*W)*E[d].x*s,E[d].y,Math.sin(X*W)*E[d].x*s),O.push(g);o!=b.b.CAP_END&&o!=b.b.CAP_ALL||(O.push(new K.k(Math.cos(X*W)*E[E.length-1].x*s,E[E.length-1].y,Math.sin(X*W)*E[E.length-1].x*s)),O.push(new K.k(0,E[E.length-1].y,0))),G.push(O)}return I(Z,{pathArray:G,closeArray:Y,sideOrientation:V,updatable:z,invertUV:f,frontUVs:M.frontUVs,backUVs:M.backUVs},j)}b.b.ExtrudeShape=function(Z,M,j,K,g,O,Q,Y,I,E){return void 0===Q&&(Q=null),S(Z,{shape:M,path:j,scale:K,rotation:g,cap:0===O?0:O||b.b.NO_CAP,sideOrientation:I,instance:E,updatable:Y},Q)},b.b.ExtrudeShapeCustom=function(Z,M,j,K,g,O,Q,Y,I,E,s,i){return h(Z,{shape:M,path:j,scaleFunction:K,rotationFunction:g,ribbonCloseArray:O,ribbonClosePath:Q,cap:0===Y?0:Y||b.b.NO_CAP,sideOrientation:s,instance:i,updatable:E},I)};b.b.CreateLathe=function(Z,M,j,K,b,g,O){return p(Z,{shape:M,radius:j,tessellation:K,sideOrientation:O,updatable:g},b)};var m=j(49620);b.b._GroundMeshParser=function(Z,M){return J.Parse(Z,M)};var J=function(Z){function M(M,j){var K=Z.call(this,M,j)||this;return K.generateOctree=!1,K}return(0,N.m)(M,Z),M.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(M.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!1,configurable:!0}),M.prototype.optimize=function(Z,M){void 0===M&&(M=32),this._subdivisionsX=Z,this._subdivisionsY=Z,this.subdivide(Z);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(M)},M.prototype.getHeightAtCoordinates=function(Z,M){var j=this.getWorldMatrix(),b=K.e.Matrix[5];j.invertToRef(b);var g=K.e.Vector3[8];if(K.k.TransformCoordinatesFromFloatsToRef(Z,0,M,b,g),Z=g.x,M=g.z,Z<this._minX||Z>this._maxX||M<this._minZ||M>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var O=this._getFacetAt(Z,M),Q=-(O.x*Z+O.z*M+O.w)/O.y;return K.k.TransformCoordinatesFromFloatsToRef(0,Q,0,j,g),g.y},M.prototype.getNormalAtCoordinates=function(Z,M){var j=new K.k(0,1,0);return this.getNormalAtCoordinatesToRef(Z,M,j),j},M.prototype.getNormalAtCoordinatesToRef=function(Z,M,j){var b=this.getWorldMatrix(),g=K.e.Matrix[5];b.invertToRef(g);var O=K.e.Vector3[8];if(K.k.TransformCoordinatesFromFloatsToRef(Z,0,M,g,O),Z=O.x,M=O.z,Z<this._minX||Z>this._maxX||M<this._minZ||M>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var Q=this._getFacetAt(Z,M);return K.k.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,b,j),this},M.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},M.prototype._getFacetAt=function(Z,M){var j=Math.floor((Z+this._maxX)*this._subdivisionsX/this._width),K=Math.floor(-(M+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),b=this._heightQuads[K*this._subdivisionsX+j];return M<b.slope.x*Z+b.slope.y?b.facet1:b.facet2},M.prototype._initHeightQuads=function(){var Z=this._subdivisionsX,M=this._subdivisionsY;this._heightQuads=new Array;for(var j=0;j<M;j++)for(var b=0;b<Z;b++){var g={slope:K.h.Zero(),facet1:new K.l(0,0,0,0),facet2:new K.l(0,0,0,0)};this._heightQuads[j*Z+b]=g}return this},M.prototype._computeHeightQuads=function(){var Z=this.getVerticesData(g.f.PositionKind);if(!Z)return this;for(var M=K.e.Vector3[3],j=K.e.Vector3[2],b=K.e.Vector3[1],O=K.e.Vector3[0],Q=K.e.Vector3[4],Y=K.e.Vector3[5],I=K.e.Vector3[6],E=K.e.Vector3[7],s=K.e.Vector3[8],i=0,a=0,z=0,V=0,o=0,c=0,G=0,f=this._subdivisionsX,X=this._subdivisionsY,d=0;d<X;d++)for(var W=0;W<f;W++){i=3*W,a=d*(f+1)*3,z=(d+1)*(f+1)*3,M.x=Z[a+i],M.y=Z[a+i+1],M.z=Z[a+i+2],j.x=Z[a+i+3],j.y=Z[a+i+4],j.z=Z[a+i+5],b.x=Z[z+i],b.y=Z[z+i+1],b.z=Z[z+i+2],O.x=Z[z+i+3],O.y=Z[z+i+4],O.z=Z[z+i+5],V=(O.z-M.z)/(O.x-M.x),o=M.z-V*M.x,j.subtractToRef(M,Q),b.subtractToRef(M,Y),O.subtractToRef(M,I),K.k.CrossToRef(I,Y,E),K.k.CrossToRef(Q,I,s),E.normalize(),s.normalize(),c=-(E.x*M.x+E.y*M.y+E.z*M.z),G=-(s.x*j.x+s.y*j.y+s.z*j.z);var A=this._heightQuads[d*f+W];A.slope.copyFromFloats(V,o),A.facet1.copyFromFloats(E.x,E.y,E.z,c),A.facet2.copyFromFloats(s.x,s.y,s.z,G)}return this},M.prototype.serialize=function(M){Z.prototype.serialize.call(this,M),M.subdivisionsX=this._subdivisionsX,M.subdivisionsY=this._subdivisionsY,M.minX=this._minX,M.maxX=this._maxX,M.minZ=this._minZ,M.maxZ=this._maxZ,M.width=this._width,M.height=this._height},M.Parse=function(Z,j){var K=new M(Z.name,j);return K._subdivisionsX=Z.subdivisionsX||1,K._subdivisionsY=Z.subdivisionsY||1,K._minX=Z.minX,K._maxX=Z.maxX,K._minZ=Z.minZ,K._maxZ=Z.maxZ,K._width=Z.width,K._height=Z.height,K},M}(b.b),P=j(9217);function H(Z){var M,j,b=[],g=[],Y=[],I=[],E=Z.width||1,s=Z.height||1,i=Z.subdivisionsX||Z.subdivisions||1,a=Z.subdivisionsY||Z.subdivisions||1;for(M=0;M<=a;M++)for(j=0;j<=i;j++){var z=new K.k(j*E/i-E/2,0,(a-M)*s/a-s/2),V=new K.k(0,1,0);g.push(z.x,z.y,z.z),Y.push(V.x,V.y,V.z),I.push(j/i,Q.e.UseOpenGLOrientationForUV?M/a:1-M/a)}for(M=0;M<a;M++)for(j=0;j<i;j++)b.push(j+1+(M+1)*(i+1)),b.push(j+1+M*(i+1)),b.push(j+M*(i+1)),b.push(j+(M+1)*(i+1)),b.push(j+1+(M+1)*(i+1)),b.push(j+M*(i+1));var o=new O.e;return o.indices=b,o.positions=g,o.normals=Y,o.uvs=I,o}function D(Z){var M,j,b,g,Q=void 0!==Z.xmin&&null!==Z.xmin?Z.xmin:-1,Y=void 0!==Z.zmin&&null!==Z.zmin?Z.zmin:-1,I=void 0!==Z.xmax&&null!==Z.xmax?Z.xmax:1,E=void 0!==Z.zmax&&null!==Z.zmax?Z.zmax:1,s=Z.subdivisions||{w:1,h:1},i=Z.precision||{w:1,h:1},a=new Array,z=new Array,V=new Array,o=new Array;s.h=s.h<1?1:s.h,s.w=s.w<1?1:s.w,i.w=i.w<1?1:i.w,i.h=i.h<1?1:i.h;var c=(I-Q)/s.w,G=(E-Y)/s.h;function f(Z,b,g,O){var Q=z.length/3,Y=i.w+1;for(M=0;M<i.h;M++)for(j=0;j<i.w;j++){var I=[Q+j+M*Y,Q+(j+1)+M*Y,Q+(j+1)+(M+1)*Y,Q+j+(M+1)*Y];a.push(I[1]),a.push(I[2]),a.push(I[3]),a.push(I[0]),a.push(I[1]),a.push(I[3])}var E=K.k.Zero(),s=new K.k(0,1,0);for(M=0;M<=i.h;M++)for(E.z=M*(O-b)/i.h+b,j=0;j<=i.w;j++)E.x=j*(g-Z)/i.w+Z,E.y=0,z.push(E.x,E.y,E.z),V.push(s.x,s.y,s.z),o.push(j/i.w,M/i.h)}for(b=0;b<s.h;b++)for(g=0;g<s.w;g++)f(Q+g*c,Y+b*G,Q+(g+1)*c,Y+(b+1)*G);var X=new O.e;return X.indices=a,X.positions=z,X.normals=V,X.uvs=o,X}function l(Z){var M,j,b=[],g=[],Q=[],Y=[],I=Z.colorFilter||new i.e(.3,.59,.11),E=Z.alphaFilter||0,s=!1;if(Z.minHeight>Z.maxHeight){s=!0;var a=Z.maxHeight;Z.maxHeight=Z.minHeight,Z.minHeight=a}for(M=0;M<=Z.subdivisions;M++)for(j=0;j<=Z.subdivisions;j++){var z=new K.k(j*Z.width/Z.subdivisions-Z.width/2,0,(Z.subdivisions-M)*Z.height/Z.subdivisions-Z.height/2),V=4*(((z.x+Z.width/2)/Z.width*(Z.bufferWidth-1)|0)+((1-(z.z+Z.height/2)/Z.height)*(Z.bufferHeight-1)|0)*Z.bufferWidth),o=Z.buffer[V]/255,c=Z.buffer[V+1]/255,G=Z.buffer[V+2]/255,f=Z.buffer[V+3]/255;s&&(o=1-o,c=1-c,G=1-G);var X=o*I.r+c*I.g+G*I.b;z.y=f>=E?Z.minHeight+(Z.maxHeight-Z.minHeight)*X:Z.minHeight-k.e,g.push(z.x,z.y,z.z),Q.push(0,0,0),Y.push(j/Z.subdivisions,1-M/Z.subdivisions)}for(M=0;M<Z.subdivisions;M++)for(j=0;j<Z.subdivisions;j++){var d=j+1+(M+1)*(Z.subdivisions+1),W=j+1+M*(Z.subdivisions+1),A=j+M*(Z.subdivisions+1),q=j+(M+1)*(Z.subdivisions+1),T=g[3*d+1]>=Z.minHeight,B=g[3*W+1]>=Z.minHeight,N=g[3*A+1]>=Z.minHeight;T&&B&&N&&(b.push(d),b.push(W),b.push(A)),g[3*q+1]>=Z.minHeight&&T&&N&&(b.push(q),b.push(d),b.push(A))}O.e.ComputeNormals(g,b,Q);var U=new O.e;return U.indices=b,U.positions=g,U.normals=Q,U.uvs=Y,U}function t(Z,M,j){void 0===M&&(M={});var K=new J(Z,j);return K._setReady(!1),K._subdivisionsX=M.subdivisionsX||M.subdivisions||1,K._subdivisionsY=M.subdivisionsY||M.subdivisions||1,K._width=M.width||1,K._height=M.height||1,K._maxX=K._width/2,K._maxZ=K._height/2,K._minX=-K._maxX,K._minZ=-K._maxZ,H(M).applyToMesh(K,M.updatable),K._setReady(!0),K}function v(Z,M,j){void 0===j&&(j=null);var K=new b.b(Z,j);return D(M).applyToMesh(K,M.updatable),K}function r(Z,M,j,K){void 0===j&&(j={}),void 0===K&&(K=null);var b=j.width||10,g=j.height||10,O=j.subdivisions||1,Q=j.minHeight||0,Y=j.maxHeight||1,I=j.colorFilter||new i.e(.3,.59,.11),E=j.alphaFilter||0,s=j.updatable,a=j.onReady;K=K||x.e.LastCreatedScene;var z=new J(Z,K);z._subdivisionsX=O,z._subdivisionsY=O,z._width=b,z._height=g,z._maxX=z._width/2,z._maxZ=z._height/2,z._minX=-z._maxX,z._minZ=-z._maxZ,z._setReady(!1);return P.d.LoadImage(M,(function(Z){var M=Z.width,j=Z.height;if(!K.isDisposed){var i=null===K||void 0===K?void 0:K.getEngine().resizeImageBitmap(Z,M,j);l({width:b,height:g,subdivisions:O,minHeight:Q,maxHeight:Y,colorFilter:I,buffer:i,bufferWidth:M,bufferHeight:j,alphaFilter:E}).applyToMesh(z,s),a&&a(z),z._setReady(!0)}}),(function(){}),K.offlineProvider),z}function L(Z,M,j){void 0===j&&(j=null);var g=M.path,O=M.instance,Q=1;void 0!==M.radius?Q=M.radius:O&&(Q=O._creationDataStorage.radius);var Y=M.tessellation||64,E=M.radiusFunction||null,s=M.cap||b.b.NO_CAP,i=M.invertUV||!1,a=M.updatable,z=b.b._GetDefaultSideOrientation(M.sideOrientation);M.arc=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1;var V,o,c=function(Z,M,j,g,O,Q,Y,I){for(var E,s,i,a,z=M.getTangents(),V=M.getNormals(),o=M.getDistances(),c=2*Math.PI/O*I,G=Q||function(){return g},f=K.e.Matrix[0],X=Y===b.b.NO_CAP||Y===b.b.CAP_END?0:2,d=0;d<Z.length;d++){s=G(d,o[d]),E=Array(),i=V[d];for(var W=0;W<O;W++)K.c.RotationAxisToRef(z[d],c*W,f),a=E[W]?E[W]:K.k.Zero(),K.k.TransformCoordinatesToRef(i,f,a),a.scaleInPlace(s).addInPlace(Z[d]),E[W]=a;j[X]=E,X++}var A=function(M,j){for(var K=Array(),b=0;b<M;b++)K.push(Z[j]);return K};switch(Y){case b.b.NO_CAP:break;case b.b.CAP_START:j[0]=A(O,0),j[1]=j[2].slice(0);break;case b.b.CAP_END:j[X]=j[X-1].slice(0),j[X+1]=A(O,Z.length-1);break;case b.b.CAP_ALL:j[0]=A(O,0),j[1]=j[2].slice(0),j[X]=j[X-1].slice(0),j[X+1]=A(O,Z.length-1)}return j};if(O){var G=O._creationDataStorage,f=M.arc||G.arc;return O=I("",{pathArray:o=c(g,V=G.path3D.update(g),G.pathArray,Q,G.tessellation,E,G.cap,f),instance:O}),G.path3D=V,G.pathArray=o,G.arc=f,G.radius=Q,O}s=s<0||s>3?0:s;var X=I(Z,{pathArray:o=c(g,V=new n.k(g),new Array,Q,Y,E,s,M.arc),closePath:!0,closeArray:!1,updatable:a,sideOrientation:z,invertUV:i,frontUVs:M.frontUVs,backUVs:M.backUVs},j);return X._creationDataStorage.pathArray=o,X._creationDataStorage.path3D=V,X._creationDataStorage.tessellation=Y,X._creationDataStorage.cap=s,X._creationDataStorage.arc=M.arc,X._creationDataStorage.radius=Q,X}O.e.CreateGround=H,O.e.CreateTiledGround=D,O.e.CreateGroundFromHeightMap=l,b.b.CreateGround=function(Z,M,j,K,b,g){return t(Z,{width:M,height:j,subdivisions:K,updatable:g},b)},b.b.CreateTiledGround=function(Z,M,j,K,b,g,O,Q,Y){return v(Z,{xmin:M,zmin:j,xmax:K,zmax:b,subdivisions:g,precision:O,updatable:Y},Q)},b.b.CreateGroundFromHeightMap=function(Z,M,j,K,b,g,O,Q,Y,I,E){return r(Z,M,{width:j,height:K,subdivisions:b,minHeight:g,maxHeight:O,updatable:Y,onReady:I,alphaFilter:E},Q)};function ZZ(Z){var M=[];M[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},M[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},M[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},M[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},M[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},M[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},M[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},M[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},M[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},M[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},M[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},M[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},M[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},M[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},M[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var j,b,g,Y,I,E,s=Z.type&&(Z.type<0||Z.type>=M.length)?0:Z.type||0,a=Z.size,z=Z.sizeX||a||1,V=Z.sizeY||a||1,o=Z.sizeZ||a||1,c=Z.custom||M[s],G=c.face.length,f=Z.faceUV||new Array(G),X=Z.faceColors,d=void 0===Z.flat||Z.flat,W=0===Z.sideOrientation?0:Z.sideOrientation||O.e.DEFAULTSIDE,A=new Array,q=new Array,T=new Array,B=new Array,N=new Array,U=0,n=0,k=new Array,x=0,R=0;if(d)for(R=0;R<G;R++)X&&void 0===X[R]&&(X[R]=new i.g(1,1,1,1)),f&&void 0===f[R]&&(f[R]=new K.l(0,0,1,1));if(d)for(R=0;R<G;R++){var e=c.face[R].length;for(g=2*Math.PI/e,Y=.5*Math.tan(g/2),I=.5,x=0;x<e;x++)A.push(c.vertex[c.face[R][x]][0]*z,c.vertex[c.face[R][x]][1]*V,c.vertex[c.face[R][x]][2]*o),k.push(U),U++,j=f[R].x+(f[R].z-f[R].x)*(.5+Y),b=f[R].y+(f[R].w-f[R].y)*(I-.5),B.push(j,Q.e.UseOpenGLOrientationForUV?1-b:b),E=Y*Math.cos(g)-I*Math.sin(g),I=Y*Math.sin(g)+I*Math.cos(g),Y=E,X&&N.push(X[R].r,X[R].g,X[R].b,X[R].a);for(x=0;x<e-2;x++)q.push(k[0+n],k[x+2+n],k[x+1+n]);n+=e}else{for(x=0;x<c.vertex.length;x++)A.push(c.vertex[x][0]*z,c.vertex[x][1]*V,c.vertex[x][2]*o),B.push(0,Q.e.UseOpenGLOrientationForUV?1:0);for(R=0;R<G;R++)for(x=0;x<c.face[R].length-2;x++)q.push(c.face[R][0],c.face[R][x+2],c.face[R][x+1])}O.e.ComputeNormals(A,q,T),O.e._ComputeSides(W,A,q,T,B,Z.frontUVs,Z.backUVs);var u=new O.e;return u.positions=A,u.indices=q,u.normals=T,u.uvs=B,X&&d&&(u.colors=N),u}function MZ(Z,M,j){void 0===M&&(M={}),void 0===j&&(j=null);var K=new b.b(Z,j);return M.sideOrientation=b.b._GetDefaultSideOrientation(M.sideOrientation),K._originalBuilderSideOrientation=M.sideOrientation,ZZ(M).applyToMesh(K,M.updatable),K}b.b.CreateTube=function(Z,M,j,K,b,g,O,Q,Y,I){return L(Z,{path:M,radius:j,tessellation:K,radiusFunction:b,arc:1,cap:g,updatable:Q,sideOrientation:Y,instance:I},O)};function jZ(Z){var M,j=Z.sideOrientation||O.e.DEFAULTSIDE,b=Z.radius||1,g=void 0===Z.flat||Z.flat,Y=Z.subdivisions||4,I=Z.radiusX||b,E=Z.radiusY||b,s=Z.radiusZ||b,i=(1+Math.sqrt(5))/2,a=[-1,i,-0,1,i,0,-1,-i,0,1,-i,0,0,-1,-i,0,1,-i,0,-1,i,0,1,i,i,0,1,i,0,-1,-i,0,1,-i,0,-1],z=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],V=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],o=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],c=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],G=new Array,f=new Array,X=new Array,d=new Array,W=0,A=new Array(3),q=new Array(3);for(M=0;M<3;M++)A[M]=K.k.Zero(),q[M]=K.h.Zero();for(var T=0;T<20;T++){for(M=0;M<3;M++){var B=z[3*T+M];A[M].copyFromFloats(a[3*V[B]],a[3*V[B]+1],a[3*V[B]+2]),A[M].normalize().scaleInPlace(b),q[M].copyFromFloats(.134765625*o[2*B]+.05859375+-.0390625*c[T],.2333984375*o[2*B+1]+.025390625+.01953125*c[T])}for(var N=function(Z,M,j,b){var O,i=K.k.Lerp(A[0],A[2],M/Y),a=K.k.Lerp(A[1],A[2],M/Y),z=Y===M?A[2]:K.k.Lerp(i,a,Z/(Y-M));if(z.normalize(),g){var V=K.k.Lerp(A[0],A[2],b/Y),o=K.k.Lerp(A[1],A[2],b/Y);O=K.k.Lerp(V,o,j/(Y-b))}else O=new K.k(z.x,z.y,z.z);O.x/=I,O.y/=E,O.z/=s,O.normalize();var c=K.h.Lerp(q[0],q[2],M/Y),T=K.h.Lerp(q[1],q[2],M/Y),B=Y===M?q[2]:K.h.Lerp(c,T,Z/(Y-M));f.push(z.x*I,z.y*E,z.z*s),X.push(O.x,O.y,O.z),d.push(B.x,Q.e.UseOpenGLOrientationForUV?1-B.y:B.y),G.push(W),W++},U=0;U<Y;U++)for(var n=0;n+U<Y;n++)N(n,U,n+1/3,U+1/3),N(n+1,U,n+1/3,U+1/3),N(n,U+1,n+1/3,U+1/3),n+U+1<Y&&(N(n+1,U,n+2/3,U+2/3),N(n+1,U+1,n+2/3,U+2/3),N(n,U+1,n+2/3,U+2/3))}O.e._ComputeSides(j,f,G,X,d,Z.frontUVs,Z.backUVs);var k=new O.e;return k.indices=G,k.positions=f,k.normals=X,k.uvs=d,k}function KZ(Z,M,j){void 0===M&&(M={}),void 0===j&&(j=null);var K=new b.b(Z,j);return M.sideOrientation=b.b._GetDefaultSideOrientation(M.sideOrientation),K._originalBuilderSideOrientation=M.sideOrientation,jZ(M).applyToMesh(K,M.updatable),K}O.e.CreatePolyhedron=ZZ,b.b.CreatePolyhedron=function(Z,M,j){return MZ(Z,M,j)};O.e.CreateIcoSphere=jZ,b.b.CreateIcoSphere=function(Z,M,j){return KZ(Z,M,j)};var bZ=j(91135);function gZ(Z,M,j){var Y=M.getIndices(),I=M.getVerticesData(g.f.PositionKind),E=M.getVerticesData(g.f.NormalKind),s=M.getVerticesData(g.f.UVKind),i=j.position||K.k.Zero(),a=j.normal||K.k.Up(),z=j.size||K.k.One(),V=j.angle||0;if(!a){var o=new K.k(0,0,1),c=M.getScene().activeCamera,G=K.k.TransformCoordinates(o,c.getWorldMatrix());a=c.globalPosition.subtract(G)}var f=-Math.atan2(a.z,a.x)-Math.PI/2,X=Math.sqrt(a.x*a.x+a.z*a.z),d=Math.atan2(a.y,X),W=K.c.RotationYawPitchRoll(f,d,V).multiply(K.c.Translation(i.x,i.y,i.z)),A=K.c.Invert(W),q=M.getWorldMatrix().multiply(A),T=new O.e;T.indices=[],T.positions=[],T.normals=[],T.uvs=[];for(var B=0,N=function(Z){var M=new bZ.d;if(!Y||!I||!E)return M;var b=Y[Z];if(M.position=new K.k(I[3*b],I[3*b+1],I[3*b+2]),M.position=K.k.TransformCoordinates(M.position,q),M.normal=new K.k(E[3*b],E[3*b+1],E[3*b+2]),M.normal=K.k.TransformNormal(M.normal,q),j.captureUVS&&s){var g=s[2*b+1];M.uv=new K.h(s[2*b],Q.e.UseOpenGLOrientationForUV?1-g:g)}return M},U=function(Z,M){if(0===Z.length)return Z;for(var j=.5*Math.abs(K.k.Dot(z,M)),b=function(Z,b){var g=K.k.GetClipFactor(Z.position,b.position,M,j);return new bZ.d(K.k.Lerp(Z.position,b.position,g),K.k.Lerp(Z.normal,b.normal,g))},g=new Array,O=0;O<Z.length;O+=3){var Q=null,Y=null,I=null,E=null,s=K.k.Dot(Z[O].position,M)-j>0,i=K.k.Dot(Z[O+1].position,M)-j>0,a=K.k.Dot(Z[O+2].position,M)-j>0;switch((s?1:0)+(i?1:0)+(a?1:0)){case 0:g.push(Z[O]),g.push(Z[O+1]),g.push(Z[O+2]);break;case 1:if(s&&(Q=Z[O+1],Y=Z[O+2],I=b(Z[O],Q),E=b(Z[O],Y)),i){Q=Z[O],Y=Z[O+2],I=b(Z[O+1],Q),E=b(Z[O+1],Y),g.push(I),g.push(Y.clone()),g.push(Q.clone()),g.push(Y.clone()),g.push(I.clone()),g.push(E);break}a&&(Q=Z[O],Y=Z[O+1],I=b(Z[O+2],Q),E=b(Z[O+2],Y)),Q&&Y&&I&&E&&(g.push(Q.clone()),g.push(Y.clone()),g.push(I),g.push(E),g.push(I.clone()),g.push(Y.clone()));break;case 2:s||(Y=b(Q=Z[O].clone(),Z[O+1]),I=b(Q,Z[O+2]),g.push(Q),g.push(Y),g.push(I)),i||(Y=b(Q=Z[O+1].clone(),Z[O+2]),I=b(Q,Z[O]),g.push(Q),g.push(Y),g.push(I)),a||(Y=b(Q=Z[O+2].clone(),Z[O]),I=b(Q,Z[O+1]),g.push(Q),g.push(Y),g.push(I))}}return g},n=0;n<Y.length;n+=3){var k=new Array;if(k.push(N(n)),k.push(N(n+1)),k.push(N(n+2)),k=U(k,new K.k(1,0,0)),k=U(k,new K.k(-1,0,0)),k=U(k,new K.k(0,1,0)),k=U(k,new K.k(0,-1,0)),k=U(k,new K.k(0,0,1)),0!==(k=U(k,new K.k(0,0,-1))).length)for(var x=0;x<k.length;x++){var R=k[x];if(T.indices.push(B),R.position.toArray(T.positions,3*B),R.normal.toArray(T.normals,3*B),j.captureUVS)R.uv.toArray(T.uvs,2*B);else{T.uvs.push(.5+R.position.x/z.x);var e=.5+R.position.y/z.y;T.uvs.push(Q.e.UseOpenGLOrientationForUV?1-e:e)}B++}}var u=new b.b(Z,M.getScene());return T.applyToMesh(u),u.position=i.clone(),u.rotation=new K.k(d,f,V),u}function OZ(Z){void 0===Z&&(Z={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var M,j,b=Math.max(Z.subdivisions?Z.subdivisions:2,1),g=Math.max(Z.tessellation?Z.tessellation:16,3),Y=Math.max(Z.height?Z.height:1,0),I=Math.max(Z.radius?Z.radius:.25,0),E=Math.max(Z.capSubdivisions?Z.capSubdivisions:6,1),s=g,i=b,a=Math.max(Z.radiusTop?Z.radiusTop:I,0),z=Math.max(Z.radiusBottom?Z.radiusBottom:I,0),V=Y-(a+z),o=2*Math.PI,c=Math.max(Z.topCapSubdivisions?Z.topCapSubdivisions:E,1),G=Math.max(Z.bottomCapSubdivisions?Z.bottomCapSubdivisions:E,1),f=Math.acos((z-a)/Y),X=[],d=[],W=[],A=[],q=0,T=[],B=.5*V,N=.5*Math.PI,U=K.k.Zero(),n=K.k.Zero(),k=Math.cos(f),x=Math.sin(f),R=new K.h(a*x,B+a*k).subtract(new K.h(z*x,z*k-B)).length(),e=a*f+R+z*(N-f),u=0;for(j=0;j<=c;j++){var F=[],C=N-f*(j/c);u+=a*f/c;var y=Math.cos(C),S=Math.sin(C),h=y*a;for(M=0;M<=s;M++){var w=(H=M/s)*o+0,p=Math.sin(w),m=Math.cos(w);n.x=h*p,n.y=B+S*a,n.z=h*m,d.push(n.x,n.y,n.z),U.set(y*p,S,y*m),W.push(U.x,U.y,U.z),A.push(H,Q.e.UseOpenGLOrientationForUV?u/e:1-u/e),F.push(q),q++}T.push(F)}var J=Y-a-z+k*a-k*z,P=x*(z-a)/J;for(j=1;j<=i;j++){F=[];u+=R/i;h=x*(j*(z-a)/i+a);for(M=0;M<=s;M++){w=(H=M/s)*o+0,p=Math.sin(w),m=Math.cos(w);n.x=h*p,n.y=B+k*a-j*J/i,n.z=h*m,d.push(n.x,n.y,n.z),U.set(p,P,m).normalize(),W.push(U.x,U.y,U.z),A.push(H,Q.e.UseOpenGLOrientationForUV?u/e:1-u/e),F.push(q),q++}T.push(F)}for(j=1;j<=G;j++){F=[],C=N-f-(Math.PI-f)*(j/G);u+=z*f/G;y=Math.cos(C),S=Math.sin(C),h=y*z;for(M=0;M<=s;M++){var H;w=(H=M/s)*o+0,p=Math.sin(w),m=Math.cos(w);n.x=h*p,n.y=S*z-B,n.z=h*m,d.push(n.x,n.y,n.z),U.set(y*p,S,y*m),W.push(U.x,U.y,U.z),A.push(H,Q.e.UseOpenGLOrientationForUV?u/e:1-u/e),F.push(q),q++}T.push(F)}for(M=0;M<s;M++)for(j=0;j<c+i+G;j++){var D=T[j][M],l=T[j+1][M],t=T[j+1][M+1],v=T[j][M+1];X.push(D),X.push(l),X.push(v),X.push(l),X.push(t),X.push(v)}if(X=X.reverse(),Z.orientation&&!Z.orientation.equals(K.k.Up())){var r=new K.c;Z.orientation.clone().scale(.5*Math.PI).cross(K.k.Up()).toQuaternion().toRotationMatrix(r);for(var L=K.k.Zero(),ZZ=0;ZZ<d.length;ZZ+=3)L.set(d[ZZ],d[ZZ+1],d[ZZ+2]),K.k.TransformCoordinatesToRef(L.clone(),r,L),d[ZZ]=L.x,d[ZZ+1]=L.y,d[ZZ+2]=L.z}var MZ=new O.e;return MZ.positions=d,MZ.normals=W,MZ.uvs=A,MZ.indices=X,MZ}function QZ(Z,M,j){void 0===M&&(M={orientation:K.k.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1}),void 0===j&&(j=null);var g=new b.b(Z,j);return OZ(M).applyToMesh(g,M.updatable),g}b.b.CreateDecal=function(Z,M,j,K,b,g){return gZ(Z,M,{position:j,normal:K,size:b,angle:g})};b.b.CreateCapsule=function(Z,M,j){return QZ(Z,M,j)},O.e.CreateCapsule=OZ;var YZ=j(96658),IZ=function(){function Z(Z,M){void 0===Z&&(Z=0),void 0===M&&(M=0),this.x=Z,this.y=M,Z!==Math.floor(Z)&&(Math.floor(Z),U.c.Warn("x is not an integer, floor(x) used")),M!==Math.floor(M)&&(Math.floor(M),U.c.Warn("y is not an integer, floor(y) used"))}return Z.prototype.clone=function(){return new Z(this.x,this.y)},Z.prototype.rotate60About=function(Z){var M=this.x;return this.x=Z.x+Z.y-this.y,this.y=M+this.y-Z.x,this},Z.prototype.rotateNeg60About=function(Z){var M=this.x;return this.x=M+this.y-Z.y,this.y=Z.x+Z.y-M,this},Z.prototype.rotate120=function(Z,M){Z!==Math.floor(Z)&&(Math.floor(Z),U.c.Warn("m not an integer only floor(m) used")),M!==Math.floor(M)&&(Math.floor(M),U.c.Warn("n not an integer only floor(n) used"));var j=this.x;return this.x=Z-j-this.y,this.y=M+j,this},Z.prototype.rotateNeg120=function(Z,M){Z!==Math.floor(Z)&&(Math.floor(Z),U.c.Warn("m is not an integer, floor(m) used")),M!==Math.floor(M)&&(Math.floor(M),U.c.Warn("n is not an integer,   floor(n) used"));var j=this.x;return this.x=this.y-M,this.y=Z+M-j-this.y,this},Z.prototype.toCartesianOrigin=function(Z,M){var j=K.k.Zero();return j.x=Z.x+2*this.x*M+this.y*M,j.y=Z.y+Math.sqrt(3)*this.y*M,j},Z.Zero=function(){return new Z(0,0)},Z}(),EZ=function(){function Z(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new sZ("icosahedron","Regular",[[0,k.g,-1],[-k.g,1,0],[-1,0,-k.g],[1,0,-k.g],[k.g,1,0],[0,k.g,1],[-1,0,k.g],[-k.g,-1,0],[0,-k.g,-1],[k.g,-1,0],[1,0,k.g],[0,-k.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}return Z.prototype.setIndices=function(){var Z,M,j,K,b,g,O,Q=12,Y={},I=this.m,E=this.n,s=I;0!==E&&(s=YZ.b.HCF(I,E)),Z=I/s,M=E/s;var i,a,z,V=IZ.Zero(),o=new IZ(I,E),c=new IZ(-E,I+E),G=IZ.Zero(),f=IZ.Zero(),X=IZ.Zero(),d=[],W=[],A=this.vertByDist,q=function(Z,M,j,K){a=M+"|"+K,(i=Z+"|"+j)in Y||a in Y?i in Y&&!(a in Y)?Y[a]=Y[i]:a in Y&&!(i in Y)&&(Y[i]=Y[a]):(Y[i]=Q,Y[a]=Q,Q++),A[j][0]>2?W[Y[i]]=[-A[j][0],A[j][1],Y[i]]:W[Y[i]]=[d[A[j][0]],A[j][1],Y[i]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(var T=0;T<20;T++){if(b=(d=this.IDATA.face[T])[2],g=d[1],O=d[0],z=V.x+"|"+V.y,(i=T+"|"+z)in Y||(Y[i]=b,W[b]=[d[A[z][0]],A[z][1]]),z=o.x+"|"+o.y,(i=T+"|"+z)in Y||(Y[i]=g,W[g]=[d[A[z][0]],A[z][1]]),z=c.x+"|"+c.y,(i=T+"|"+z)in Y||(Y[i]=O,W[O]=[d[A[z][0]],A[z][1]]),j=this.IDATA.edgematch[T][0],"B"===(K=this.IDATA.edgematch[T][1]))for(var B=1;B<s;B++)f.x=I-B*(Z+M),f.y=E+B*Z,X.x=-B*M,X.y=B*(Z+M),q(T,j,z=f.x+"|"+f.y,X.x+"|"+X.y);if("O"===K)for(B=1;B<s;B++)X.x=-B*M,X.y=B*(Z+M),G.x=B*Z,G.y=B*M,q(T,j,z=X.x+"|"+X.y,G.x+"|"+G.y);if(j=this.IDATA.edgematch[T][2],(K=this.IDATA.edgematch[T][3])&&"A"===K)for(B=1;B<s;B++)G.x=B*Z,G.y=B*M,f.x=I-(s-B)*(Z+M),f.y=E+(s-B)*Z,q(T,j,z=G.x+"|"+G.y,f.x+"|"+f.y);for(B=0;B<this.vertices.length;B++)z=this.vertices[B].x+"|"+this.vertices[B].y,(i=T+"|"+z)in Y||(Y[i]=Q++,A[z][0]>2?W[Y[i]]=[-A[z][0],A[z][1],Y[i]]:W[Y[i]]=[d[A[z][0]],A[z][1],Y[i]])}this.closestTo=W,this.vecToidx=Y},Z.prototype.calcCoeffs=function(){var Z=this.m,M=this.n,j=Math.sqrt(3)/3,K=Z*Z+M*M+Z*M;this.coau=(Z+M)/K,this.cobu=-M/K,this.coav=-j*(Z-M)/K,this.cobv=j*(2*Z+M)/K},Z.prototype.createInnerFacets=function(){for(var Z=this.m,M=this.n,j=0;j<M+Z+1;j++)for(var K=this.min[j];K<this.max[j]+1;K++)K<this.max[j]&&K<this.max[j+1]+1&&this.innerFacets.push(["|"+K+"|"+j,"|"+K+"|"+(j+1),"|"+(K+1)+"|"+j]),j>0&&K<this.max[j-1]&&K+1<this.max[j]+1&&this.innerFacets.push(["|"+K+"|"+j,"|"+(K+1)+"|"+j,"|"+(K+1)+"|"+(j-1)])},Z.prototype.edgeVecsABOB=function(){for(var Z=this.m,M=this.n,j=new IZ(-M,Z+M),K=1;K<Z+M;K++){var b=new IZ(this.min[K],K),g=new IZ(this.min[K-1],K-1),O=new IZ(this.min[K+1],K+1),Q=b.clone(),Y=g.clone(),I=O.clone();Q.rotate60About(j),Y.rotate60About(j),I.rotate60About(j);var E=new IZ(this.max[Q.y],Q.y),s=new IZ(this.max[Q.y-1],Q.y-1),i=new IZ(this.max[Q.y-1]-1,Q.y-1);Q.x===E.x&&Q.y===E.y||(Q.x!==s.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,s,i]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,i,E])):Q.y===I.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([b,g,s]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([b,s,O])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([b,g,s]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,s,E])))}},Z.prototype.mapABOBtoOBOA=function(){for(var Z=new IZ(0,0),M=0;M<this.isoVecsABOB.length;M++){for(var j=[],K=0;K<3;K++)Z.x=this.isoVecsABOB[M][K].x,Z.y=this.isoVecsABOB[M][K].y,0===this.vertexTypes[M][K]&&Z.rotateNeg120(this.m,this.n),j.push(Z.clone());this.isoVecsOBOA.push(j)}},Z.prototype.mapABOBtoBAOA=function(){for(var Z=new IZ(0,0),M=0;M<this.isoVecsABOB.length;M++){for(var j=[],K=0;K<3;K++)Z.x=this.isoVecsABOB[M][K].x,Z.y=this.isoVecsABOB[M][K].y,1===this.vertexTypes[M][K]&&Z.rotate120(this.m,this.n),j.push(Z.clone());this.isoVecsBAOA.push(j)}},Z.prototype.MapToFace=function(Z,M){for(var j,b=this.IDATA.face[Z],g=b[2],O=b[1],Q=b[0],Y=K.k.FromArray(this.IDATA.vertex[g]),I=K.k.FromArray(this.IDATA.vertex[O]),E=K.k.FromArray(this.IDATA.vertex[Q]),s=I.subtract(Y),i=E.subtract(Y),a=s.scale(this.coau).add(i.scale(this.cobu)),z=s.scale(this.coav).add(i.scale(this.cobv)),V=[],o=K.e.Vector3[0],c=0;c<this.cartesian.length;c++)o=a.scale(this.cartesian[c].x).add(z.scale(this.cartesian[c].y)).add(Y),V[c]=[o.x,o.y,o.z],j=Z+"|"+this.vertices[c].x+"|"+this.vertices[c].y,M.vertex[this.vecToidx[j]]=[o.x,o.y,o.z]},Z.prototype.build=function(Z,M){var j=new Array,K=IZ.Zero(),b=new IZ(Z,M),g=new IZ(-M,Z+M);j.push(K,b,g);for(var O=M;O<Z+1;O++)for(var Q=0;Q<Z+1-O;Q++)j.push(new IZ(Q,O));if(M>0){for(var Y=YZ.b.HCF(Z,M),I=Z/Y,E=M/Y,s=1;s<Y;s++)j.push(new IZ(s*I,s*E)),j.push(new IZ(-s*E,s*(I+E))),j.push(new IZ(Z-s*(I+E),M+s*I));for(var i=Z/M,a=1;a<M;a++)for(var z=0;z<a*i;z++)j.push(new IZ(z,a)),j.push(new IZ(z,a).rotate120(Z,M)),j.push(new IZ(z,a).rotateNeg120(Z,M))}j.sort((function(Z,M){return Z.x-M.x})),j.sort((function(Z,M){return Z.y-M.y}));var V=new Array(Z+M+1),o=new Array(Z+M+1);for(s=0;s<V.length;s++)V[s]=1/0,o[s]=-1/0;var c=0,G=0,f=j.length;for(s=0;s<f;s++)G=j[s].x,V[c=j[s].y]=Math.min(G,V[c]),o[c]=Math.max(G,o[c]);var X=function(j,K){var b=j.clone();return"A"===K&&b.rotateNeg120(Z,M),"B"===K&&b.rotate120(Z,M),b.x<0?b.y:b.x+b.y},d=[],W=[],A=[],q=[],T={},B=[],N=-1,U=-1;for(s=0;s<f;s++)d[s]=j[s].toCartesianOrigin(new IZ(0,0),.5),W[s]=X(j[s],"O"),A[s]=X(j[s],"A"),q[s]=X(j[s],"B"),W[s]===A[s]&&A[s]===q[s]?(N=3,U=W[s]):W[s]===A[s]?(N=4,U=W[s]):A[s]===q[s]?(N=5,U=A[s]):q[s]===W[s]&&(N=6,U=W[s]),W[s]<A[s]&&W[s]<q[s]&&(N=2,U=W[s]),A[s]<W[s]&&A[s]<q[s]&&(N=1,U=A[s]),q[s]<A[s]&&q[s]<W[s]&&(N=0,U=q[s]),B.push([N,U,j[s].x,j[s].y]);B.sort((function(Z,M){return Z[2]-M[2]})),B.sort((function(Z,M){return Z[3]-M[3]})),B.sort((function(Z,M){return Z[1]-M[1]})),B.sort((function(Z,M){return Z[0]-M[0]}));for(var n=0;n<B.length;n++)T[B[n][2]+"|"+B[n][3]]=[B[n][0],B[n][1],n];return this.m=Z,this.n=M,this.vertices=j,this.vertByDist=T,this.cartesian=d,this.min=V,this.max=o,this},Z}(),sZ=function(Z,M,j,K){this.name=Z,this.category=M,this.vertex=j,this.face=K},iZ=function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}return(0,N.m)(M,Z),M.prototype.innerToData=function(Z,M){for(var j=0;j<M.innerFacets.length;j++)this.face.push(M.innerFacets[j].map((function(j){return M.vecToidx[Z+j]})))},M.prototype.mapABOBtoDATA=function(Z,M){for(var j=M.IDATA.edgematch[Z][0],K=0;K<M.isoVecsABOB.length;K++){for(var b=[],g=0;g<3;g++)0===M.vertexTypes[K][g]?b.push(Z+"|"+M.isoVecsABOB[K][g].x+"|"+M.isoVecsABOB[K][g].y):b.push(j+"|"+M.isoVecsABOB[K][g].x+"|"+M.isoVecsABOB[K][g].y);this.face.push([M.vecToidx[b[0]],M.vecToidx[b[1]],M.vecToidx[b[2]]])}},M.prototype.mapOBOAtoDATA=function(Z,M){for(var j=M.IDATA.edgematch[Z][0],K=0;K<M.isoVecsOBOA.length;K++){for(var b=[],g=0;g<3;g++)1===M.vertexTypes[K][g]?b.push(Z+"|"+M.isoVecsOBOA[K][g].x+"|"+M.isoVecsOBOA[K][g].y):b.push(j+"|"+M.isoVecsOBOA[K][g].x+"|"+M.isoVecsOBOA[K][g].y);this.face.push([M.vecToidx[b[0]],M.vecToidx[b[1]],M.vecToidx[b[2]]])}},M.prototype.mapBAOAtoDATA=function(Z,M){for(var j=M.IDATA.edgematch[Z][2],K=0;K<M.isoVecsBAOA.length;K++){for(var b=[],g=0;g<3;g++)1===M.vertexTypes[K][g]?b.push(Z+"|"+M.isoVecsBAOA[K][g].x+"|"+M.isoVecsBAOA[K][g].y):b.push(j+"|"+M.isoVecsBAOA[K][g].x+"|"+M.isoVecsBAOA[K][g].y);this.face.push([M.vecToidx[b[0]],M.vecToidx[b[1]],M.vecToidx[b[2]]])}},M.prototype.orderData=function(Z){for(var M=[],j=0;j<13;j++)M[j]=[];var K=Z.closestTo;for(j=0;j<K.length;j++)K[j][0]>-1?K[j][1]>0&&M[K[j][0]].push([j,K[j][1]]):M[12].push([j,K[j][0]]);var b=[];for(j=0;j<12;j++)b[j]=j;var g=12;for(j=0;j<12;j++){M[j].sort((function(Z,M){return Z[1]-M[1]}));for(var O=0;O<M[j].length;O++)b[M[j][O][0]]=g++}for(O=0;O<M[12].length;O++)b[M[12][O][0]]=g++;for(j=0;j<this.vertex.length;j++)this.vertex[j].push(b[j]);this.vertex.sort((function(Z,M){return Z[3]-M[3]}));for(j=0;j<this.vertex.length;j++)this.vertex[j].pop();for(j=0;j<this.face.length;j++)for(O=0;O<this.face[j].length;O++)this.face[j][O]=b[this.face[j][O]];this.sharedNodes=M[12].length,this.poleNodes=this.vertex.length-this.sharedNodes},M.prototype.setOrder=function(Z,M){var j=[],K=[],b=M.pop();K.push(b);var g=this.face[b].indexOf(Z);g=(g+2)%3;var O=this.face[b][g];j.push(O);for(var Q=0;M.length>0;)b=M[Q],this.face[b].indexOf(O)>-1?(g=(this.face[b].indexOf(O)+1)%3,O=this.face[b][g],j.push(O),K.push(b),M.splice(Q,1),Q=0):Q++;return this.adjacentFaces.push(j),K},M.prototype.toGoldbergPolyhedronData=function(){var Z=this,M=new sZ("GeoDual","Goldberg",[],[]);M.name="GD dual";for(var j=this.vertex.length,K=new Array(j),b=0;b<j;b++)K[b]=[];for(var g=0;g<this.face.length;g++)for(var O=0;O<3;O++)K[this.face[g][O]].push(g);var Q=0,Y=0,I=0,E=[],s=[];this.adjacentFaces=[];for(var i=0;i<K.length;i++)M.face[i]=this.setOrder(i,K[i].concat([])),K[i].forEach((function(j){Q=0,Y=0,I=0,E=Z.face[j];for(var K=0;K<3;K++)s=Z.vertex[E[K]],Q+=s[0],Y+=s[1],I+=s[2];M.vertex[j]=[Q/3,Y/3,I/3]}));return M},M.BuildGeodesicData=function(Z){var j=new M("Geodesic-m-n","Geodesic",[[0,k.g,-1],[-k.g,1,0],[-1,0,-k.g],[1,0,-k.g],[k.g,1,0],[0,k.g,1],[-1,0,k.g],[-k.g,-1,0],[0,-k.g,-1],[k.g,-1,0],[1,0,k.g],[0,-k.g,1]],[]);Z.setIndices(),Z.calcCoeffs(),Z.createInnerFacets(),Z.edgeVecsABOB(),Z.mapABOBtoOBOA(),Z.mapABOBtoBAOA();for(var K=0;K<Z.IDATA.face.length;K++)Z.MapToFace(K,j),j.innerToData(K,Z),"B"===Z.IDATA.edgematch[K][1]&&j.mapABOBtoDATA(K,Z),"O"===Z.IDATA.edgematch[K][1]&&j.mapOBOAtoDATA(K,Z),"A"===Z.IDATA.edgematch[K][3]&&j.mapBAOAtoDATA(K,Z);j.orderData(Z);return j.vertex=j.vertex.map((function(Z){var M=Z[0],j=Z[1],K=Z[2],b=Math.sqrt(M*M+j*j+K*K);return Z[0]*=1/b,Z[1]*=1/b,Z[2]*=1/b,Z})),j},M}(sZ);b.b._GoldbergMeshParser=function(Z,M){return aZ.Parse(Z,M)};var aZ=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]},M}return(0,N.m)(M,Z),M.prototype.relatedGoldbergFace=function(Z,M){return void 0===M?(Z>this.goldbergData.nbUnsharedFaces-1&&(U.c.Warn("Maximum number of unshared faces used"),Z=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+Z):(Z>11&&(U.c.Warn("Last pole used"),Z=11),M>this.goldbergData.nbFacesAtPole-1&&(U.c.Warn("Maximum number of faces at a pole used"),M=this.goldbergData.nbFacesAtPole-1),12+Z*this.goldbergData.nbFacesAtPole+M)},M.prototype._changeGoldbergFaceColors=function(Z){for(var M=0;M<Z.length;M++)for(var j=Z[M][0],K=Z[M][1],b=Z[M][2],g=j;g<K+1;g++)this.goldbergData.faceColors[g]=b;var O=[];for(g=0;g<12;g++)for(M=0;M<5;M++)O.push(this.goldbergData.faceColors[g].r,this.goldbergData.faceColors[g].g,this.goldbergData.faceColors[g].b,this.goldbergData.faceColors[g].a);for(g=12;g<this.goldbergData.faceColors.length;g++)for(M=0;M<6;M++)O.push(this.goldbergData.faceColors[g].r,this.goldbergData.faceColors[g].g,this.goldbergData.faceColors[g].b,this.goldbergData.faceColors[g].a);return O},M.prototype.setGoldbergFaceColors=function(Z){var M=this._changeGoldbergFaceColors(Z);this.setVerticesData(g.f.ColorKind,M)},M.prototype.updateGoldbergFaceColors=function(Z){var M=this._changeGoldbergFaceColors(Z);this.updateVerticesData(g.f.ColorKind,M)},M.prototype._changeGoldbergFaceUVs=function(Z){for(var M=this.getVerticesData(g.f.UVKind),j=0;j<Z.length;j++){for(var K=Z[j][0],b=Z[j][1],O=Z[j][2],Q=Z[j][3],Y=Z[j][4],I=[],E=[],s=void 0,i=void 0,a=0;a<5;a++)s=O.x+Q*Math.cos(Y+a*Math.PI/2.5),i=O.y+Q*Math.sin(Y+a*Math.PI/2.5),s<0&&(s=0),s>1&&(s=1),I.push(s,i);for(a=0;a<6;a++)s=O.x+Q*Math.cos(Y+a*Math.PI/3),i=O.y+Q*Math.sin(Y+a*Math.PI/3),s<0&&(s=0),s>1&&(s=1),E.push(s,i);for(var z=K;z<Math.min(12,b+1);z++)for(a=0;a<5;a++)M[10*z+2*a]=I[2*a],M[10*z+2*a+1]=I[2*a+1];for(z=Math.max(12,K);z<b+1;z++)for(a=0;a<6;a++)M[12*z-24+2*a]=E[2*a],M[12*z-23+2*a]=E[2*a+1]}return M},M.prototype.setGoldbergFaceUVs=function(Z){var M=this._changeGoldbergFaceUVs(Z);this.setVerticesData(g.f.UVKind,M)},M.prototype.updateGoldbergFaceUVs=function(Z){var M=this._changeGoldbergFaceUVs(Z);this.updateVerticesData(g.f.UVKind,M)},M.prototype.placeOnGoldbergFaceAt=function(Z,M,j){var b=K.k.RotationFromAxis(this.goldbergData.faceXaxis[M],this.goldbergData.faceYaxis[M],this.goldbergData.faceZaxis[M]);Z.rotation=b,Z.position=this.goldbergData.faceCenters[M].add(this.goldbergData.faceXaxis[M].scale(j.x)).add(this.goldbergData.faceYaxis[M].scale(j.y)).add(this.goldbergData.faceZaxis[M].scale(j.z))},M.prototype.serialize=function(M){Z.prototype.serialize.call(this,M),M.type="GoldbergMesh";var j={};if(j.adjacentFaces=this.goldbergData.adjacentFaces,j.nbSharedFaces=this.goldbergData.nbSharedFaces,j.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,j.nbFaces=this.goldbergData.nbFaces,j.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){j.faceColors=[];for(var K=0,b=this.goldbergData.faceColors;K<b.length;K++){var g=b[K];j.faceColors.push(g.asArray())}}if(this.goldbergData.faceCenters){j.faceCenters=[];for(var O=0,Q=this.goldbergData.faceCenters;O<Q.length;O++){var Y=Q[O];j.faceCenters.push(Y.asArray())}}if(this.goldbergData.faceZaxis){j.faceZaxis=[];for(var I=0,E=this.goldbergData.faceZaxis;I<E.length;I++){Y=E[I];j.faceZaxis.push(Y.asArray())}}if(this.goldbergData.faceYaxis){j.faceYaxis=[];for(var s=0,i=this.goldbergData.faceYaxis;s<i.length;s++){Y=i[s];j.faceYaxis.push(Y.asArray())}}if(this.goldbergData.faceXaxis){j.faceXaxis=[];for(var a=0,z=this.goldbergData.faceXaxis;a<z.length;a++){Y=z[a];j.faceXaxis.push(Y.asArray())}}M.goldbergData=j},M.Parse=function(Z,j){var b=Z.goldbergData;b.faceColors=b.faceColors.map((function(Z){return i.g.FromArray(Z)})),b.faceCenters=b.faceCenters.map((function(Z){return K.k.FromArray(Z)})),b.faceZaxis=b.faceZaxis.map((function(Z){return K.k.FromArray(Z)})),b.faceXaxis=b.faceXaxis.map((function(Z){return K.k.FromArray(Z)})),b.faceYaxis=b.faceYaxis.map((function(Z){return K.k.FromArray(Z)}));var g=new M(Z.name,j);return g.goldbergData=b,g},M}(b.b);function zZ(Z,M,j){void 0===j&&(j=null);var g=M.size,Y=M.sizeX||g||1,I=M.sizeY||g||1,E=M.sizeZ||g||1,s=M.m||1;s!==Math.floor(s)&&(Math.floor(s),U.c.Warn("m not an integer only floor(m) used"));var a=M.n||0;if(a!==Math.floor(a)&&(Math.floor(a),U.c.Warn("n not an integer only floor(n) used")),a>s){var z=a;a=s,s=z,U.c.Warn("n > m therefore m and n swapped")}var V=new EZ;V.build(s,a);var o=iZ.BuildGeodesicData(V),c=o.toGoldbergPolyhedronData(),G=new aZ(Z,j);M.sideOrientation=b.b._GetDefaultSideOrientation(M.sideOrientation),G._originalBuilderSideOrientation=M.sideOrientation;var f=function(Z,M){for(var j=Z.size,b=Z.sizeX||j||1,g=Z.sizeY||j||1,Y=Z.sizeZ||j||1,I=0===Z.sideOrientation?0:Z.sideOrientation||O.e.DEFAULTSIDE,E=new Array,s=new Array,i=new Array,a=new Array,z=1/0,V=-1/0,o=1/0,c=-1/0,G=0;G<M.vertex.length;G++)z=Math.min(z,M.vertex[G][0]*b),V=Math.max(V,M.vertex[G][0]*b),o=Math.min(o,M.vertex[G][1]*g),c=Math.max(c,M.vertex[G][1]*g);for(var f=0,X=0;X<M.face.length;X++){var d=M.face[X],W=K.k.FromArray(M.vertex[d[0]]),A=K.k.FromArray(M.vertex[d[2]]),q=K.k.FromArray(M.vertex[d[1]]),T=A.subtract(W),B=q.subtract(W),N=K.k.Cross(B,T).normalize();for(G=0;G<d.length;G++){i.push(N.x,N.y,N.z);var U=M.vertex[d[G]];E.push(U[0]*b,U[1]*g,U[2]*Y);var n=(U[1]*g-o)/(c-o);a.push((U[0]*b-z)/(V-z),Q.e.UseOpenGLOrientationForUV?1-n:n)}for(G=0;G<d.length-2;G++)s.push(f,f+G+2,f+G+1);f+=d.length}O.e._ComputeSides(I,E,s,i,a);var k=new O.e;return k.positions=E,k.indices=s,k.normals=i,k.uvs=a,k}(M,c);f.applyToMesh(G,M.updatable),G.goldbergData.nbSharedFaces=o.sharedNodes,G.goldbergData.nbUnsharedFaces=o.poleNodes,G.goldbergData.adjacentFaces=o.adjacentFaces,G.goldbergData.nbFaces=G.goldbergData.nbSharedFaces+G.goldbergData.nbUnsharedFaces,G.goldbergData.nbFacesAtPole=(G.goldbergData.nbUnsharedFaces-12)/12;for(var X=0;X<o.vertex.length;X++)G.goldbergData.faceCenters.push(K.k.FromArray(o.vertex[X])),G.goldbergData.faceCenters[X].x*=Y,G.goldbergData.faceCenters[X].y*=I,G.goldbergData.faceCenters[X].z*=E,G.goldbergData.faceColors.push(new i.g(1,1,1,1));for(X=0;X<c.face.length;X++){var d=c.face[X],W=K.k.FromArray(c.vertex[d[0]]),A=K.k.FromArray(c.vertex[d[2]]),q=K.k.FromArray(c.vertex[d[1]]),T=A.subtract(W),B=q.subtract(W),N=K.k.Cross(B,T).normalize(),n=K.k.Cross(B,N).normalize();G.goldbergData.faceXaxis.push(B.normalize()),G.goldbergData.faceYaxis.push(N),G.goldbergData.faceZaxis.push(n)}return G}b.b.CreateGoldberg=zZ;var VZ={CreateBox:s.d,CreateTiledBox:o,CreateSphere:c.e,CreateDisc:E.b,CreateIcoSphere:KZ,CreateRibbon:I,CreateCylinder:d,CreateTorus:A,CreateTorusKnot:T,CreateLineSystem:B.f,CreateLines:B.g,CreateDashedLines:B.b,ExtrudeShape:S,ExtrudeShapeCustom:h,CreateLathe:p,CreateTiledPlane:z,CreatePlane:m.b,CreateGround:t,CreateTiledGround:v,CreateGroundFromHeightMap:r,CreatePolygon:C,ExtrudePolygon:y,CreateTube:L,CreatePolyhedron:MZ,CreateGeodesic:function(Z,M,j){void 0===j&&(j=null);var K=M.m||1;K!==Math.floor(K)&&(Math.floor(K),U.c.Warn("m not an integer only floor(m) used"));var b=M.n||0;if(b!==Math.floor(b)&&(Math.floor(b),U.c.Warn("n not an integer only floor(n) used")),b>K){var g=b;b=K,K=g,U.c.Warn("n > m therefore m and n swapped")}var O=new EZ;return O.build(K,b),MZ(Z,{custom:iZ.BuildGeodesicData(O),size:M.size,sizeX:M.sizeX,sizeY:M.sizeY,sizeZ:M.sizeZ,faceUV:M.faceUV,faceColors:M.faceColors,flat:M.flat,updatable:M.updatable,sideOrientation:M.sideOrientation,frontUVs:M.frontUVs,backUVs:M.backUVs},j)},CreateGoldberg:zZ,CreateDecal:gZ,CreateCapsule:QZ}},50384:function(Z,M,j){"use strict";j.d(M,{b:function(){return Y}});var K=j(43251),b=j(16035),g=j(97918),O=j(18445),Q=j(61803),Y=function(){function Z(Z,M,j,K,b,g,O,Q,Y){void 0===Q&&(Q=!0),void 0===Y&&(Y=!0),this.materialIndex=Z,this.verticesStart=M,this.verticesCount=j,this.indexStart=K,this.indexCount=b,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=g,this._renderingMesh=O||g,Y&&g.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=g.subMeshes.length-1,Q&&(this.refreshBoundingInfo(),g.computeWorldMatrix(!0))}return Object.defineProperty(Z.prototype,"materialDefines",{get:function(){var Z;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(Z=this._getDrawWrapper())||void 0===Z?void 0:Z.defines},set:function(Z){var M;(null!==(M=this._mainDrawWrapperOverride)&&void 0!==M?M:this._getDrawWrapper(void 0,!0)).defines=Z},enumerable:!1,configurable:!0}),Z.prototype._getDrawWrapper=function(Z,M){void 0===M&&(M=!1),Z=null!==Z&&void 0!==Z?Z:this._engine.currentRenderPassId;var j=this._drawWrappers[Z];return!j&&M&&(this._drawWrappers[Z]=j=new Q.e(this._mesh.getScene().getEngine())),j},Z.prototype._removeDrawWrapper=function(Z,M){var j;void 0===M&&(M=!0),M&&(null===(j=this._drawWrappers[Z])||void 0===j||j.dispose()),this._drawWrappers[Z]=void 0},Object.defineProperty(Z.prototype,"effect",{get:function(){var Z,M;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:null!==(M=null===(Z=this._getDrawWrapper())||void 0===Z?void 0:Z.effect)&&void 0!==M?M:null},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"_drawWrapper",{get:function(){var Z;return null!==(Z=this._mainDrawWrapperOverride)&&void 0!==Z?Z:this._getDrawWrapper(void 0,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"_drawWrapperOverride",{get:function(){return this._mainDrawWrapperOverride},enumerable:!1,configurable:!0}),Z.prototype._setMainDrawWrapperOverride=function(Z){this._mainDrawWrapperOverride=Z},Z.prototype.setEffect=function(Z,M,j,K){void 0===M&&(M=null),void 0===K&&(K=!0);var b=this._drawWrapper;b.setEffect(Z,M,K),void 0!==j&&(b.materialContext=j),Z||(b.defines=null,b.materialContext=void 0)},Z.prototype.resetDrawCache=function(Z){if(this._drawWrappers){if(void 0!==Z)return void this._removeDrawWrapper(Z);for(var M=0,j=this._drawWrappers;M<j.length;M++){var K=j[M];null===K||void 0===K||K.dispose()}}this._drawWrappers=[]},Z.AddToMesh=function(M,j,K,b,g,O,Q,Y){return void 0===Y&&(Y=!0),new Z(M,j,K,b,g,O,Q,Y)},Object.defineProperty(Z.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()},enumerable:!1,configurable:!0}),Z.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},Z.prototype.setBoundingInfo=function(Z){return this._boundingInfo=Z,this},Z.prototype.getMesh=function(){return this._mesh},Z.prototype.getRenderingMesh=function(){return this._renderingMesh},Z.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},Z.prototype.getEffectiveMesh=function(){var Z=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return Z||this._renderingMesh},Z.prototype.getMaterial=function(Z){var M;void 0===Z&&(Z=!0);var j=null!==(M=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))&&void 0!==M?M:this._renderingMesh.material;if(!j)return Z?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(j)){var K=j.getSubMaterial(this.materialIndex);return this._currentMaterial!==K&&(this._currentMaterial=K,this.resetDrawCache()),K}return j},Z.prototype._isMultiMaterial=function(Z){return void 0!==Z.getSubMaterial},Z.prototype.refreshBoundingInfo=function(Z){if(void 0===Z&&(Z=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(Z||(Z=this._renderingMesh.getVerticesData(K.f.PositionKind)),!Z)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var M,j=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===j.length){var b=this._renderingMesh.getBoundingInfo();M={minimum:b.minimum.clone(),maximum:b.maximum.clone()}}else M=(0,O.c)(Z,j,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(M.minimum,M.maximum):this._boundingInfo=new g.c(M.minimum,M.maximum),this},Z.prototype._checkCollision=function(Z){return this.getBoundingInfo()._checkCollision(Z)},Z.prototype.updateBoundingInfo=function(Z){var M=this.getBoundingInfo();return M||(this.refreshBoundingInfo(),M=this.getBoundingInfo()),M&&M.update(Z),this},Z.prototype.isInFrustum=function(Z){var M=this.getBoundingInfo();return!!M&&M.isInFrustum(Z,this._mesh.cullingStrategy)},Z.prototype.isCompletelyInFrustum=function(Z){var M=this.getBoundingInfo();return!!M&&M.isCompletelyInFrustum(Z)},Z.prototype.render=function(Z){return this._renderingMesh.render(this,Z,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},Z.prototype._getLinesIndexBuffer=function(Z,M){if(!this._linesIndexBuffer){for(var j=[],K=this.indexStart;K<this.indexStart+this.indexCount;K+=3)j.push(Z[K],Z[K+1],Z[K+1],Z[K+2],Z[K+2],Z[K]);this._linesIndexBuffer=M.createIndexBuffer(j),this._linesIndexCount=j.length}return this._linesIndexBuffer},Z.prototype.canIntersects=function(Z){var M=this.getBoundingInfo();return!!M&&Z.intersectsBox(M.boundingBox)},Z.prototype.intersects=function(Z,M,j,K,b){var g=this.getMaterial();if(!g)return null;var O=3,Q=!1;switch(g.fillMode){case 3:case 5:case 6:case 8:return null;case 7:O=1,Q=!0}return 4===g.fillMode?j.length?this._intersectLines(Z,M,j,this._mesh.intersectionThreshold,K):this._intersectUnIndexedLines(Z,M,j,this._mesh.intersectionThreshold,K):!j.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(Z,M,j,K,b):this._intersectTriangles(Z,M,j,O,Q,K,b)},Z.prototype._intersectLines=function(Z,M,j,K,g){for(var O=null,Q=this.indexStart;Q<this.indexStart+this.indexCount;Q+=2){var Y=M[j[Q]],I=M[j[Q+1]],E=Z.intersectionSegment(Y,I,K);if(!(E<0)&&((g||!O||E<O.distance)&&((O=new b.b(null,null,E)).faceId=Q/2,g)))break}return O},Z.prototype._intersectUnIndexedLines=function(Z,M,j,K,g){for(var O=null,Q=this.verticesStart;Q<this.verticesStart+this.verticesCount;Q+=2){var Y=M[Q],I=M[Q+1],E=Z.intersectionSegment(Y,I,K);if(!(E<0)&&((g||!O||E<O.distance)&&((O=new b.b(null,null,E)).faceId=Q/2,g)))break}return O},Z.prototype._intersectTriangles=function(Z,M,j,K,b,g,O){for(var Q=null,Y=-1,I=this.indexStart;I<this.indexStart+this.indexCount-(3-K);I+=K){Y++;var E=j[I],s=j[I+1],i=j[I+2];if(b&&4294967295===i)I+=2;else{var a=M[E],z=M[s],V=M[i];if(a&&z&&V&&(!O||O(a,z,V,Z))){var o=Z.intersectsTriangle(a,z,V);if(o){if(o.distance<0)continue;if((g||!Q||o.distance<Q.distance)&&((Q=o).faceId=Y,g))break}}}}return Q},Z.prototype._intersectUnIndexedTriangles=function(Z,M,j,K,b){for(var g=null,O=this.verticesStart;O<this.verticesStart+this.verticesCount;O+=3){var Q=M[O],Y=M[O+1],I=M[O+2];if(!b||b(Q,Y,I,Z)){var E=Z.intersectsTriangle(Q,Y,I);if(E){if(E.distance<0)continue;if((K||!g||E.distance<g.distance)&&((g=E).faceId=O/3,K))break}}}return g},Z.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},Z.prototype.clone=function(M,j){var K=new Z(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,M,j,!1);if(!this.IsGlobal){var b=this.getBoundingInfo();if(!b)return K;K._boundingInfo=new g.c(b.minimum,b.maximum)}return K},Z.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var Z=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(Z,1),this.resetDrawCache()},Z.prototype.getClassName=function(){return"SubMesh"},Z.CreateFromIndices=function(M,j,K,b,g,O){void 0===O&&(O=!0);for(var Q=Number.MAX_VALUE,Y=-Number.MAX_VALUE,I=(g||b).getIndices(),E=j;E<j+K;E++){var s=I[E];s<Q&&(Q=s),s>Y&&(Y=s)}return new Z(M,Q,Y-Q+1,j,K,b,g,O)},Z}()},14313:function(Z,M,j){"use strict";var K=j(65847),b=j(43251),g=j(80105);K.b.prototype.thinInstanceAdd=function(Z,M){void 0===M&&(M=!0),this._thinInstanceUpdateBufferSize("matrix",Array.isArray(Z)?Z.length:1);var j=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(Z))for(var K=0;K<Z.length;++K)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,Z[K],K===Z.length-1&&M);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,Z,M);return j},K.b.prototype.thinInstanceAddSelf=function(Z){return void 0===Z&&(Z=!0),this.thinInstanceAdd(g.c.IdentityReadOnly,Z)},K.b.prototype.thinInstanceRegisterAttribute=function(Z,M){Z===b.f.ColorKind&&(Z=b.f.ColorInstanceKind),this.removeVerticesData(Z),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[Z]=M,this._userThinInstanceBuffersStorage.sizes[Z]=M*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[Z]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[Z]),this._userThinInstanceBuffersStorage.vertexBuffers[Z]=new b.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[Z],Z,!0,!1,M,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[Z])},K.b.prototype.thinInstanceSetMatrixAt=function(Z,M,j){if(void 0===j&&(j=!0),!this._thinInstanceDataStorage.matrixData||Z>=this._thinInstanceDataStorage.instancesCount)return!1;var K=this._thinInstanceDataStorage.matrixData;return M.copyToArray(K,16*Z),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[Z]=M),j&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},K.b.prototype.thinInstanceSetAttributeAt=function(Z,M,j,K){return void 0===K&&(K=!0),Z===b.f.ColorKind&&(Z=b.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[Z]||M>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(Z,0),this._userThinInstanceBuffersStorage.data[Z].set(j,M*this._userThinInstanceBuffersStorage.strides[Z]),K&&this.thinInstanceBufferUpdated(Z),!0)},Object.defineProperty(K.b.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(Z){var M,j,K=null!==(M=this._thinInstanceDataStorage.matrixData)&&void 0!==M?M:null===(j=this.source)||void 0===j?void 0:j._thinInstanceDataStorage.matrixData;Z<=(K?K.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=Z)},enumerable:!0,configurable:!0}),K.b.prototype._thinInstanceCreateMatrixBuffer=function(Z,M,j){void 0===j&&(j=!1),Z===b.f.ColorKind&&(Z=b.f.ColorInstanceKind);for(var K=new b.e(this.getEngine(),M,!j,16,!1,!0),g=0;g<4;g++)this.setVerticesBuffer(K.createVertexBuffer(Z+g,4*g,4));return K},K.b.prototype.thinInstanceSetBuffer=function(Z,M,j,K){var g,O,Q;void 0===j&&(j=0),void 0===K&&(K=!1),j=j||16,"matrix"===Z?(null===(g=this._thinInstanceDataStorage.matrixBuffer)||void 0===g||g.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=M?M.length:32*j,this._thinInstanceDataStorage.matrixData=M,this._thinInstanceDataStorage.worldMatrices=null,null!==M?(this._thinInstanceDataStorage.instancesCount=M.length/j,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",M,K),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo())):"previousMatrix"===Z?(null===(O=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===O||O.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=M,null!==M&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",M,K))):(Z===b.f.ColorKind&&(Z=b.f.ColorInstanceKind),null===M?(null===(Q=this._userThinInstanceBuffersStorage)||void 0===Q?void 0:Q.data[Z])&&(this.removeVerticesData(Z),delete this._userThinInstanceBuffersStorage.data[Z],delete this._userThinInstanceBuffersStorage.strides[Z],delete this._userThinInstanceBuffersStorage.sizes[Z],delete this._userThinInstanceBuffersStorage.vertexBuffers[Z]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[Z]=M,this._userThinInstanceBuffersStorage.strides[Z]=j,this._userThinInstanceBuffersStorage.sizes[Z]=M.length,this._userThinInstanceBuffersStorage.vertexBuffers[Z]=new b.f(this.getEngine(),M,Z,!K,!1,j,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[Z])))},K.b.prototype.thinInstanceBufferUpdated=function(Z){var M,j,K;"matrix"===Z?null===(M=this._thinInstanceDataStorage.matrixBuffer)||void 0===M||M.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount):"previousMatrix"===Z?null===(j=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===j||j.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount):(Z===b.f.ColorKind&&(Z=b.f.ColorInstanceKind),(null===(K=this._userThinInstanceBuffersStorage)||void 0===K?void 0:K.vertexBuffers[Z])&&this._userThinInstanceBuffersStorage.vertexBuffers[Z].updateDirectly(this._userThinInstanceBuffersStorage.data[Z],0))},K.b.prototype.thinInstancePartialBufferUpdate=function(Z,M,j){var K;"matrix"===Z?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(M,j):(Z===b.f.ColorKind&&(Z=b.f.ColorInstanceKind),(null===(K=this._userThinInstanceBuffersStorage)||void 0===K?void 0:K.vertexBuffers[Z])&&this._userThinInstanceBuffersStorage.vertexBuffers[Z].updateDirectly(M,j))},K.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];var Z=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=new Array;for(var M=0;M<this._thinInstanceDataStorage.instancesCount;++M)this._thinInstanceDataStorage.worldMatrices[M]=g.c.FromArray(Z,16*M)}return this._thinInstanceDataStorage.worldMatrices},K.b.prototype.thinInstanceRefreshBoundingInfo=function(Z,M,j){if(void 0===Z&&(Z=!1),void 0===M&&(M=!1),void 0===j&&(j=!1),this._thinInstanceDataStorage.matrixData&&this._thinInstanceDataStorage.matrixBuffer){var K=this._thinInstanceDataStorage.boundingVectors;Z&&(K.length=0,this.refreshBoundingInfo(M,j));var b=this.getBoundingInfo(),O=this._thinInstanceDataStorage.matrixData;if(0===K.length)for(var Q=0;Q<b.boundingBox.vectors.length;++Q)K.push(b.boundingBox.vectors[Q].clone());g.e.Vector3[0].setAll(Number.POSITIVE_INFINITY),g.e.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(var Y=0;Y<this._thinInstanceDataStorage.instancesCount;++Y){g.c.FromArrayToRef(O,16*Y,g.e.Matrix[0]);for(Q=0;Q<K.length;++Q)g.k.TransformCoordinatesToRef(K[Q],g.e.Matrix[0],g.e.Vector3[2]),g.e.Vector3[0].minimizeInPlace(g.e.Vector3[2]),g.e.Vector3[1].maximizeInPlace(g.e.Vector3[2])}b.reConstruct(g.e.Vector3[0],g.e.Vector3[1]),this._updateBoundingInfo()}},K.b.prototype._thinInstanceUpdateBufferSize=function(Z,M){var j,K,g;void 0===M&&(M=1),Z===b.f.ColorKind&&(Z=b.f.ColorInstanceKind);var O="matrix"===Z;if(O||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[Z]){for(var Q=O?16:this._userThinInstanceBuffersStorage.strides[Z],Y=O?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[Z],I=O?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[Z],E=(this._thinInstanceDataStorage.instancesCount+M)*Q,s=Y;s<E;)s*=2;if(!I||Y!=s){if(I){var i=new Float32Array(s);i.set(I,0),I=i}else I=new Float32Array(s);O?(null===(j=this._thinInstanceDataStorage.matrixBuffer)||void 0===j||j.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",I,!1),this._thinInstanceDataStorage.matrixData=I,this._thinInstanceDataStorage.matrixBufferSize=s,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&(null===(K=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===K||K.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",I,!1))):(null===(g=this._userThinInstanceBuffersStorage.vertexBuffers[Z])||void 0===g||g.dispose(),this._userThinInstanceBuffersStorage.data[Z]=I,this._userThinInstanceBuffersStorage.sizes[Z]=s,this._userThinInstanceBuffersStorage.vertexBuffers[Z]=new b.f(this.getEngine(),I,Z,!0,!1,Q,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[Z]))}}},K.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},K.b.prototype._disposeThinInstanceSpecificData=function(){var Z;(null===(Z=this._thinInstanceDataStorage)||void 0===Z?void 0:Z.matrixBuffer)&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},77129:function(Z,M,j){"use strict";j.d(M,{d:function(){return I}});var K=j(40061),b=j(9892),g=j(9271),O=j(80105),Q=j(74134),Y=j(54044),I=function(Z){function M(j,K,b){void 0===K&&(K=null),void 0===b&&(b=!0);var Q=Z.call(this,j,K)||this;return Q._forward=new O.k(0,0,1),Q._up=new O.k(0,1,0),Q._right=new O.k(1,0,0),Q._position=O.k.Zero(),Q._rotation=O.k.Zero(),Q._rotationQuaternion=null,Q._scaling=O.k.One(),Q._transformToBoneReferal=null,Q._isAbsoluteSynced=!1,Q._billboardMode=M.BILLBOARDMODE_NONE,Q._preserveParentRotationForBillboard=!1,Q.scalingDeterminant=1,Q._infiniteDistance=!1,Q.ignoreNonUniformScaling=!1,Q.reIntegrateRotationIntoRotationQuaternion=!1,Q._poseMatrix=null,Q._localMatrix=O.c.Zero(),Q._usePivotMatrix=!1,Q._absolutePosition=O.k.Zero(),Q._absoluteScaling=O.k.Zero(),Q._absoluteRotationQuaternion=O.d.Identity(),Q._pivotMatrix=O.c.Identity(),Q._postMultiplyPivotMatrix=!1,Q._isWorldMatrixFrozen=!1,Q._indexInSceneTransformNodesArray=-1,Q.onAfterWorldMatrixUpdateObservable=new g.b,Q._nonUniformScaling=!1,b&&Q.getScene().addTransformNode(Q),Q}return(0,K.m)(M,Z),Object.defineProperty(M.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(Z){this._billboardMode!==Z&&(this._billboardMode=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(Z){Z!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(Z){this._infiniteDistance!==Z&&(this._infiniteDistance=Z)},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(M.prototype,"position",{get:function(){return this._position},set:function(Z){this._position=Z,this._isDirty=!0},enumerable:!1,configurable:!0}),M.prototype.isUsingPivotMatrix=function(){return this._usePivotMatrix},Object.defineProperty(M.prototype,"rotation",{get:function(){return this._rotation},set:function(Z){this._rotation=Z,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"scaling",{get:function(){return this._scaling},set:function(Z){this._scaling=Z,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(Z){this._rotationQuaternion=Z,Z&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"forward",{get:function(){return O.k.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"up",{get:function(){return O.k.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"right",{get:function(){return O.k.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()},enumerable:!1,configurable:!0}),M.prototype.updatePoseMatrix=function(Z){return this._poseMatrix?(this._poseMatrix.copyFrom(Z),this):(this._poseMatrix=Z.clone(),this)},M.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=O.c.Identity()),this._poseMatrix},M.prototype._isSynchronized=function(){var Z=this._cache;return this._billboardMode===Z.billboardMode&&this._billboardMode===M.BILLBOARDMODE_NONE&&(!Z.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))},M.prototype._initCache=function(){Z.prototype._initCache.call(this);var M=this._cache;M.localMatrixUpdated=!1,M.billboardMode=-1,M.infiniteDistance=!1},Object.defineProperty(M.prototype,"absolutePosition",{get:function(){return this.getAbsolutePosition()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),M.prototype.setPreTransformMatrix=function(Z){return this.setPivotMatrix(Z,!1)},M.prototype.setPivotMatrix=function(Z,M){return void 0===M&&(M=!0),this._pivotMatrix.copyFrom(Z),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=M,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=O.c.Invert(this._pivotMatrix)),this},M.prototype.getPivotMatrix=function(){return this._pivotMatrix},M.prototype.instantiateHierarchy=function(Z,M,j){void 0===Z&&(Z=null);var K=this.clone("Clone of "+(this.name||this.id),Z||this.parent,!0);K&&j&&j(this,K);for(var b=0,g=this.getChildTransformNodes(!0);b<g.length;b++){g[b].instantiateHierarchy(K,M,j)}return K},M.prototype.freezeWorldMatrix=function(Z,M){return void 0===Z&&(Z=null),void 0===M&&(M=!1),Z?M?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||O.d.Identity(),Z.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=Z,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},M.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(M.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),M.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},M.prototype.setAbsolutePosition=function(Z){if(!Z)return this;var M,j,K;if(void 0===Z.x){if(arguments.length<3)return this;M=arguments[0],j=arguments[1],K=arguments[2]}else M=Z.x,j=Z.y,K=Z.z;if(this.parent){var b=O.e.Matrix[0];this.parent.getWorldMatrix().invertToRef(b),O.k.TransformCoordinatesFromFloatsToRef(M,j,K,b,this.position)}else this.position.x=M,this.position.y=j,this.position.z=K;return this._absolutePosition.copyFrom(Z),this},M.prototype.setPositionWithLocalVector=function(Z){return this.computeWorldMatrix(),this.position=O.k.TransformNormal(Z,this._localMatrix),this},M.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var Z=O.e.Matrix[0];return this._localMatrix.invertToRef(Z),O.k.TransformNormal(this.position,Z)},M.prototype.locallyTranslate=function(Z){return this.computeWorldMatrix(!0),this.position=O.k.TransformCoordinates(Z,this._localMatrix),this},M.prototype.lookAt=function(Z,j,K,b,g){void 0===j&&(j=0),void 0===K&&(K=0),void 0===b&&(b=0),void 0===g&&(g=Y.f.LOCAL);var Q=M._LookAtVectorCache,I=g===Y.f.LOCAL?this.position:this.getAbsolutePosition();if(Z.subtractToRef(I,Q),this.setDirection(Q,j,K,b),g===Y.f.WORLD&&this.parent)if(this.rotationQuaternion){var E=O.e.Matrix[0];this.rotationQuaternion.toRotationMatrix(E);var s=O.e.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(s),s.invert(),E.multiplyToRef(s,E),this.rotationQuaternion.fromRotationMatrix(E)}else{var i=O.e.Quaternion[0];O.d.FromEulerVectorToRef(this.rotation,i);E=O.e.Matrix[0];i.toRotationMatrix(E);s=O.e.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(s),s.invert(),E.multiplyToRef(s,E),i.fromRotationMatrix(E),i.toEulerAnglesToRef(this.rotation)}return this},M.prototype.getDirection=function(Z){var M=O.k.Zero();return this.getDirectionToRef(Z,M),M},M.prototype.getDirectionToRef=function(Z,M){return O.k.TransformNormalToRef(Z,this.getWorldMatrix(),M),this},M.prototype.setDirection=function(Z,M,j,K){void 0===M&&(M=0),void 0===j&&(j=0),void 0===K&&(K=0);var b=-Math.atan2(Z.z,Z.x)+Math.PI/2,g=Math.sqrt(Z.x*Z.x+Z.z*Z.z),Q=-Math.atan2(Z.y,g);return this.rotationQuaternion?O.d.RotationYawPitchRollToRef(b+M,Q+j,K,this.rotationQuaternion):(this.rotation.x=Q+j,this.rotation.y=b+M,this.rotation.z=K),this},M.prototype.setPivotPoint=function(Z,M){void 0===M&&(M=Y.f.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var j=this.getWorldMatrix();if(M==Y.f.WORLD){var K=O.e.Matrix[0];j.invertToRef(K),Z=O.k.TransformCoordinates(Z,K)}return this.setPivotMatrix(O.c.Translation(-Z.x,-Z.y,-Z.z),!0)},M.prototype.getPivotPoint=function(){var Z=O.k.Zero();return this.getPivotPointToRef(Z),Z},M.prototype.getPivotPointToRef=function(Z){return Z.x=-this._pivotMatrix.m[12],Z.y=-this._pivotMatrix.m[13],Z.z=-this._pivotMatrix.m[14],this},M.prototype.getAbsolutePivotPoint=function(){var Z=O.k.Zero();return this.getAbsolutePivotPointToRef(Z),Z},M.prototype.getAbsolutePivotPointToRef=function(Z){return this.getPivotPointToRef(Z),O.k.TransformCoordinatesToRef(Z,this.getWorldMatrix(),Z),this},M.prototype.markAsDirty=function(M){if(this._children)for(var j=0,K=this._children;j<K.length;j++){K[j].markAsDirty(M)}return Z.prototype.markAsDirty.call(this,M)},M.prototype.setParent=function(Z,j){if(void 0===j&&(j=!1),!Z&&!this.parent)return this;var K=O.e.Quaternion[0],b=O.e.Vector3[0],g=O.e.Vector3[1],Q=O.e.Matrix[1];O.c.IdentityToRef(Q);var Y=O.e.Matrix[0];this.computeWorldMatrix(!0);var I=this.rotationQuaternion;return I||(I=M._TmpRotation,O.d.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,I)),O.c.ComposeToRef(this.scaling,I,this.position,Y),this.parent&&Y.multiplyToRef(this.parent.computeWorldMatrix(!0),Y),Z&&(Z.computeWorldMatrix(!0).invertToRef(Q),Y.multiplyToRef(Q,Y)),Y.decompose(g,K,b,j?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(K):K.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(g),this.position.copyFrom(b),this.parent=Z,this},Object.defineProperty(M.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),M.prototype._updateNonUniformScalingState=function(Z){return this._nonUniformScaling!==Z&&(this._nonUniformScaling=Z,!0)},M.prototype.attachToBone=function(Z,M){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=M,this.parent=Z,Z.getSkeleton().prepare(),Z.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},M.prototype.detachFromBone=function(Z){return void 0===Z&&(Z=!1),this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=Z?this._currentParentWhenAttachingToBone:null,this):(Z&&(this.parent=this._currentParentWhenAttachingToBone),this)},M.prototype.rotate=function(Z,j,K){var b;if(Z.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),K&&K!==Y.f.LOCAL){if(this.parent){var g=O.e.Matrix[0];this.parent.getWorldMatrix().invertToRef(g),Z=O.k.TransformNormal(Z,g)}(b=O.d.RotationAxisToRef(Z,j,M._RotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else b=O.d.RotationAxisToRef(Z,j,M._RotationAxisCache),this.rotationQuaternion.multiplyToRef(b,this.rotationQuaternion);return this},M.prototype.rotateAround=function(Z,M,j){M.normalize(),this.rotationQuaternion||(this.rotationQuaternion=O.d.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var K=O.e.Vector3[0],b=O.e.Vector3[1],g=O.e.Vector3[2],Q=O.e.Quaternion[0],Y=O.e.Matrix[0],I=O.e.Matrix[1],E=O.e.Matrix[2],s=O.e.Matrix[3];return Z.subtractToRef(this.position,K),O.c.TranslationToRef(K.x,K.y,K.z,Y),O.c.TranslationToRef(-K.x,-K.y,-K.z,I),O.c.RotationAxisToRef(M,j,E),I.multiplyToRef(E,s),s.multiplyToRef(Y,s),s.decompose(b,Q,g),this.position.addInPlace(g),Q.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},M.prototype.translate=function(Z,M,j){var K=Z.scale(M);if(j&&j!==Y.f.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(K));else{var b=this.getPositionExpressedInLocalSpace().add(K);this.setPositionWithLocalVector(b)}return this},M.prototype.addRotation=function(Z,M,j){var K;this.rotationQuaternion?K=this.rotationQuaternion:(K=O.e.Quaternion[1],O.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,K));var b=O.e.Quaternion[0];return O.d.RotationYawPitchRollToRef(M,Z,j,b),K.multiplyInPlace(b),this.rotationQuaternion||K.toEulerAnglesToRef(this.rotation),this},M.prototype._getEffectiveParent=function(){return this.parent},M.prototype.computeWorldMatrix=function(Z){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var j=this.getScene().getRenderId();if(!this._isDirty&&!Z&&(this._currentRenderId===j||this.isSynchronized()))return this._currentRenderId=j,this._worldMatrix;var K=this.getScene().activeCamera,b=0!==(this._billboardMode&M.BILLBOARDMODE_USE_POSITION),g=this._billboardMode!==M.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;this._updateCache();var Q=this._cache;Q.pivotMatrixUpdated=!1,Q.billboardMode=this.billboardMode,Q.infiniteDistance=this.infiniteDistance,Q.parent=this._parentNode,this._currentRenderId=j,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var Y,I=this._getEffectiveParent(),E=M._TmpScaling,s=this._position;if(this._infiniteDistance&&!this.parent&&K){var i=K.getWorldMatrix(),a=new O.k(i.m[12],i.m[13],i.m[14]);(s=M._TmpTranslation).copyFromFloats(this._position.x+a.x,this._position.y+a.y,this._position.z+a.z)}(E.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion)?(this._rotationQuaternion._isDirty=!1,Y=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&(A=this.rotation.lengthSquared())&&(this._rotationQuaternion.multiplyInPlace(O.d.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(Y=M._TmpRotation,O.d.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,Y));if(this._usePivotMatrix){var z=O.e.Matrix[1];O.c.ScalingToRef(E.x,E.y,E.z,z);var V=O.e.Matrix[0];Y.toRotationMatrix(V),this._pivotMatrix.multiplyToRef(z,O.e.Matrix[4]),O.e.Matrix[4].multiplyToRef(V,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(s.x,s.y,s.z)}else O.c.ComposeToRef(E,Y,s,this._localMatrix);if(I&&I.getWorldMatrix){if(Z&&I.computeWorldMatrix(Z),g){this._transformToBoneReferal?I.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),O.e.Matrix[7]):O.e.Matrix[7].copyFrom(I.getWorldMatrix());var o=O.e.Vector3[5],c=O.e.Vector3[6];O.e.Matrix[7].decompose(c,void 0,o),O.c.ScalingToRef(c.x,c.y,c.z,O.e.Matrix[7]),O.e.Matrix[7].setTranslation(o),this._localMatrix.multiplyToRef(O.e.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(I.getWorldMatrix(),O.e.Matrix[6]),O.e.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(I.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(g&&K&&this.billboardMode&&!b){var G=O.e.Vector3[0];if(this._worldMatrix.getTranslationToRef(G),O.e.Matrix[1].copyFrom(K.getViewMatrix()),O.e.Matrix[1].setTranslationFromFloats(0,0,0),O.e.Matrix[1].invertToRef(O.e.Matrix[0]),(this.billboardMode&M.BILLBOARDMODE_ALL)!==M.BILLBOARDMODE_ALL){O.e.Matrix[0].decompose(void 0,O.e.Quaternion[0],void 0);var f=O.e.Vector3[1];O.e.Quaternion[0].toEulerAnglesToRef(f),(this.billboardMode&M.BILLBOARDMODE_X)!==M.BILLBOARDMODE_X&&(f.x=0),(this.billboardMode&M.BILLBOARDMODE_Y)!==M.BILLBOARDMODE_Y&&(f.y=0),(this.billboardMode&M.BILLBOARDMODE_Z)!==M.BILLBOARDMODE_Z&&(f.z=0),O.c.RotationYawPitchRollToRef(f.y,f.x,f.z,O.e.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(O.e.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(O.e.Vector3[0])}else if(g&&K&&this.billboardMode&&b){G=O.e.Vector3[0];this._worldMatrix.getTranslationToRef(G);var X=K.globalPosition;this._worldMatrix.invertToRef(O.e.Matrix[1]);var d=O.e.Vector3[1];O.k.TransformCoordinatesToRef(X,O.e.Matrix[1],d),d.normalize();var W=-Math.atan2(d.z,d.x)+Math.PI/2,A=Math.sqrt(d.x*d.x+d.z*d.z),q=-Math.atan2(d.y,A);if(O.d.RotationYawPitchRollToRef(W,q,0,O.e.Quaternion[0]),(this.billboardMode&M.BILLBOARDMODE_ALL)!==M.BILLBOARDMODE_ALL){f=O.e.Vector3[1];O.e.Quaternion[0].toEulerAnglesToRef(f),(this.billboardMode&M.BILLBOARDMODE_X)!==M.BILLBOARDMODE_X&&(f.x=0),(this.billboardMode&M.BILLBOARDMODE_Y)!==M.BILLBOARDMODE_Y&&(f.y=0),(this.billboardMode&M.BILLBOARDMODE_Z)!==M.BILLBOARDMODE_Z&&(f.z=0),O.c.RotationYawPitchRollToRef(f.y,f.x,f.z,O.e.Matrix[0])}else O.c.FromQuaternionToRef(O.e.Quaternion[0],O.e.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(O.e.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(O.e.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):I&&I._nonUniformScaling?this._updateNonUniformScalingState(I._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=O.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},M.prototype.resetLocalMatrix=function(Z){if(void 0===Z&&(Z=!0),this.computeWorldMatrix(),Z)for(var M=this.getChildren(),j=0;j<M.length;++j){var K=M[j];if(K){K.computeWorldMatrix();var b=O.e.Matrix[0];K._localMatrix.multiplyToRef(this._localMatrix,b);var g=O.e.Quaternion[0];b.decompose(K.scaling,g,K.position),K.rotationQuaternion?K.rotationQuaternion.copyFrom(g):g.toEulerAnglesToRef(K.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=O.d.Identity()),this._worldMatrix=O.c.Identity()},M.prototype._afterComputeWorldMatrix=function(){},M.prototype.registerAfterWorldMatrixUpdate=function(Z){return this.onAfterWorldMatrixUpdateObservable.add(Z),this},M.prototype.unregisterAfterWorldMatrixUpdate=function(Z){return this.onAfterWorldMatrixUpdateObservable.removeCallback(Z),this},M.prototype.getPositionInCameraSpace=function(Z){return void 0===Z&&(Z=null),Z||(Z=this.getScene().activeCamera),O.k.TransformCoordinates(this.getAbsolutePosition(),Z.getViewMatrix())},M.prototype.getDistanceToCamera=function(Z){return void 0===Z&&(Z=null),Z||(Z=this.getScene().activeCamera),this.getAbsolutePosition().subtract(Z.globalPosition).length()},M.prototype.clone=function(Z,j,K){var g=this,O=b.b.Clone((function(){return new M(Z,g.getScene())}),this);if(O.name=Z,O.id=Z,j&&(O.parent=j),!K)for(var Q=this.getDescendants(!0),Y=0;Y<Q.length;Y++){var I=Q[Y];I.clone&&I.clone(Z+"."+I.name,O)}return O},M.prototype.serialize=function(Z){var M=b.b.Serialize(this,Z);return M.type=this.getClassName(),M.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(M),M.localMatrix=this.getPivotMatrix().asArray(),M.isEnabled=this.isEnabled(),M},M.Parse=function(Z,j,K){var g=b.b.Parse((function(){return new M(Z.name,j)}),Z,j,K);return Z.localMatrix?g.setPreTransformMatrix(O.c.FromArray(Z.localMatrix)):Z.pivotMatrix&&g.setPivotMatrix(O.c.FromArray(Z.pivotMatrix)),g.setEnabled(Z.isEnabled),void 0!==Z.parentId&&(g._waitingParentId=Z.parentId),void 0!==Z.parentInstanceIndex&&(g._waitingParentInstanceIndex=Z.parentInstanceIndex),g},M.prototype.getChildTransformNodes=function(Z,j){var K=[];return this._getDescendants(K,Z,(function(Z){return(!j||j(Z))&&Z instanceof M})),K},M.prototype.dispose=function(M,j){if(void 0===j&&(j=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){var K=this._parentContainer.transformNodes.indexOf(this);K>-1&&this._parentContainer.transformNodes.splice(K,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),M)for(var b=0,g=this.getChildTransformNodes(!0);b<g.length;b++){var O=g[b];O.parent=null,O.computeWorldMatrix(!0)}Z.prototype.dispose.call(this,M,j)},M.prototype.normalizeToUnitCube=function(Z,M,j){void 0===Z&&(Z=!0),void 0===M&&(M=!1);var K=null,b=null;M&&(this.rotationQuaternion?(b=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(K=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var g=this.getHierarchyBoundingVectors(Z,j),O=g.max.subtract(g.min),Q=Math.max(O.x,O.y,O.z);if(0===Q)return this;var Y=1/Q;return this.scaling.scaleInPlace(Y),M&&(this.rotationQuaternion&&b?this.rotationQuaternion.copyFrom(b):this.rotation&&K&&this.rotation.copyFrom(K)),this},M.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},M.BILLBOARDMODE_NONE=0,M.BILLBOARDMODE_X=1,M.BILLBOARDMODE_Y=2,M.BILLBOARDMODE_Z=4,M.BILLBOARDMODE_ALL=7,M.BILLBOARDMODE_USE_POSITION=128,M._TmpRotation=O.d.Zero(),M._TmpScaling=O.k.Zero(),M._TmpTranslation=O.k.Zero(),M._LookAtVectorCache=new O.k(0,0,0),M._RotationAxisCache=new O.d,(0,K.l)([(0,b.x)("position")],M.prototype,"_position",void 0),(0,K.l)([(0,b.x)("rotation")],M.prototype,"_rotation",void 0),(0,K.l)([(0,b.q)("rotationQuaternion")],M.prototype,"_rotationQuaternion",void 0),(0,K.l)([(0,b.x)("scaling")],M.prototype,"_scaling",void 0),(0,K.l)([(0,b.z)("billboardMode")],M.prototype,"_billboardMode",void 0),(0,K.l)([(0,b.z)()],M.prototype,"scalingDeterminant",void 0),(0,K.l)([(0,b.z)("infiniteDistance")],M.prototype,"_infiniteDistance",void 0),(0,K.l)([(0,b.z)()],M.prototype,"ignoreNonUniformScaling",void 0),(0,K.l)([(0,b.z)()],M.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),M}(Q.b)},89214:function(Z,M,j){"use strict";j.d(M,{e:function(){return K}});var K=function(){function Z(){}return Z.BuildArray=function(Z,M){for(var j=[],K=0;K<Z;++K)j.push(M());return j},Z.BuildTuple=function(M,j){return Z.BuildArray(M,j)},Z}()},5344:function(Z,M,j){"use strict";j.d(M,{b:function(){return Q}});var K=j(70937),b=j(81965),g=j(9217),O=0,Q=function(Z){if(!Z.environmentBRDFTexture){var M=Z.useDelayedTextureLoading;Z.useDelayedTextureLoading=!1;var j=Z._blockEntityCollection;Z._blockEntityCollection=!1;var Q=K.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+O++,Z,!0,!1,K.b.BILINEAR_SAMPLINGMODE);Z._blockEntityCollection=j;var Y=Z.getEngine().getLoadedTexturesCache(),I=Y.indexOf(Q.getInternalTexture());-1!==I&&Y.splice(I,1),Q.isRGBD=!0,Q.wrapU=K.b.CLAMP_ADDRESSMODE,Q.wrapV=K.b.CLAMP_ADDRESSMODE,Z.environmentBRDFTexture=Q,Z.useDelayedTextureLoading=M,b.e.ExpandRGBDTexture(Q);var E=Z.getEngine().onContextRestoredObservable.add((function(){Q.isRGBD=!0;!function Z(){Q.isReady()?b.e.ExpandRGBDTexture(Q):g.d.SetImmediate(Z)}()}));Z.onDisposeObservable.add((function(){Z.getEngine().onContextRestoredObservable.remove(E)}))}return Z.environmentBRDFTexture}},61633:function(Z,M,j){"use strict";function K(Z,M,j){try{var K=Z.next();K.done?M(K):K.value?K.value.then((function(){K.value=void 0,M(K)}),j):M(K)}catch(Z){j(Z)}}function b(Z){var M;return void 0===Z&&(Z=25),function(j,b,g){var O=performance.now();void 0===M||O-M>Z?(M=O,setTimeout((function(){K(j,b,g)}),0)):K(j,b,g)}}function g(Z,M,j,K,b){!function g(){var O,Q=function(Z){Z.done?j(Z.value):void 0===O?O=!0:g()};do{O=void 0,b&&b.aborted?K(new Error("Aborted")):M(Z,Q,K),void 0===O&&(O=!1)}while(O)}()}function O(Z,M){var j;return g(Z,K,(function(Z){return j=Z}),(function(Z){throw Z}),M),j}function Q(Z,M,j){return new Promise((function(K,b){g(Z,M,K,b,j)}))}function Y(Z,M){return function(){for(var j=[],K=0;K<arguments.length;K++)j[K]=arguments[K];return O(Z.apply(void 0,j),M)}}j.d(M,{c:function(){return b},g:function(){return Y},h:function(){return Q},k:function(){return O}})},9892:function(Z,M,j){"use strict";j.d(M,{b:function(){return T},c:function(){return i},d:function(){return B},h:function(){return X},i:function(){return V},j:function(){return d},k:function(){return o},m:function(){return W},n:function(){return q},p:function(){return f},q:function(){return A},s:function(){return z},t:function(){return c},x:function(){return G},z:function(){return a}});var K=j(45883),b=j(80105),g=j(50504),O=j(9488),Q={},Y={},I=function(Z,M,j){var b=Z();K.d&&K.d.AddTagsTo(b,M.tags);var g=E(b);for(var O in g){var Q=g[O],Y=M[O],I=Q.type;if(void 0!==Y&&null!==Y&&("uniqueId"!==O||T.AllowLoadingUniqueId))switch(I){case 0:case 6:case 11:b[O]=Y;break;case 1:b[O]=j||Y.isRenderTarget?Y:Y.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:b[O]=j?Y:Y.clone()}}return b};function E(Z){var M=Z.getClassName();if(Y[M])return Y[M];Y[M]={};for(var j=Y[M],K=Z,b=M;b;){var g=Q[b];for(var O in g)j[O]=g[O];var I=void 0,E=!1;do{if(!(I=Object.getPrototypeOf(K)).getClassName){E=!0;break}if(I.getClassName()!==b)break;K=I}while(I);if(E)break;b=I.getClassName(),K=I}return j}function s(Z,M){return function(j,K){var b=function(Z){var M=Z.getClassName();return Q[M]||(Q[M]={}),Q[M]}(j);b[K]||(b[K]={type:Z,sourceName:M})}}function i(Z,M){return void 0===M&&(M=null),function(Z,M){return void 0===M&&(M=null),function(j,K){var b=M||"_"+K;Object.defineProperty(j,K,{get:function(){return this[b]},set:function(M){"function"===typeof this.equals&&this.equals(M)||this[b]!==M&&(this[b]=M,j[Z].apply(this))},enumerable:!0,configurable:!0})}}(Z,M)}function a(Z){return s(0,Z)}function z(Z){return s(1,Z)}function V(Z){return s(2,Z)}function o(Z){return s(3,Z)}function c(Z){return s(4,Z)}function G(Z){return s(5,Z)}function f(Z){return s(6,Z)}function X(Z){return s(7,Z)}function d(Z){return s(8,Z)}function W(Z){return s(9,Z)}function A(Z){return s(10,Z)}function q(Z){return s(12,Z)}var T=function(){function Z(){}return Z.AppendSerializedAnimations=function(Z,M){if(Z.animations){M.animations=[];for(var j=0;j<Z.animations.length;j++){var K=Z.animations[j];M.animations.push(K.serialize())}}},Z.Serialize=function(M,j){j||(j={}),K.d&&(j.tags=K.d.GetTags(M));var b=E(M);for(var g in b){var O=b[g],Q=O.sourceName||g,Y=O.type,I=M[g];if(void 0!==I&&null!==I&&("uniqueId"!==g||Z.AllowLoadingUniqueId))switch(Y){case 0:j[Q]=I;break;case 1:case 3:case 7:case 9:j[Q]=I.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:j[Q]=I.asArray();break;case 6:case 11:j[Q]=I.id}}return j},Z.Parse=function(M,j,g,Q){void 0===Q&&(Q=null);var Y=M();Q||(Q=""),K.d&&K.d.AddTagsTo(Y,j.tags);var I=E(Y);for(var s in I){var i=I[s],a=j[i.sourceName||s],z=i.type;if(void 0!==a&&null!==a&&("uniqueId"!==s||Z.AllowLoadingUniqueId)){var V=Y;switch(z){case 0:V[s]=a;break;case 1:g&&(V[s]=Z._TextureParser(a,g,Q));break;case 2:V[s]=O.e.FromArray(a);break;case 3:V[s]=Z._FresnelParametersParser(a);break;case 4:V[s]=b.h.FromArray(a);break;case 5:V[s]=b.k.FromArray(a);break;case 6:g&&(V[s]=g.getLastMeshById(a));break;case 7:V[s]=Z._ColorCurvesParser(a);break;case 8:V[s]=O.g.FromArray(a);break;case 9:V[s]=Z._ImageProcessingConfigurationParser(a);break;case 10:V[s]=b.d.FromArray(a);break;case 11:g&&(V[s]=g.getCameraById(a));break;case 12:V[s]=b.c.FromArray(a)}}}return Y},Z.Clone=function(Z,M){return I(Z,M,!1)},Z.Instanciate=function(Z,M){return I(Z,M,!0)},Z.AllowLoadingUniqueId=!1,Z._ImageProcessingConfigurationParser=function(Z){throw(0,g.e)("ImageProcessingConfiguration")},Z._FresnelParametersParser=function(Z){throw(0,g.e)("FresnelParameters")},Z._ColorCurvesParser=function(Z){throw(0,g.e)("ColorCurves")},Z._TextureParser=function(Z,M,j){throw(0,g.e)("Texture")},Z}();function B(Z,M,j,K){var b=j.value;j.value=function(){for(var j=[],g=0;g<arguments.length;g++)j[g]=arguments[g];var O=b;if("undefined"!==typeof _native&&_native[M]){var Q=_native[M];O=K?function(){for(var Z=[],M=0;M<arguments.length;M++)Z[M]=arguments[M];return K.apply(void 0,Z)?Q.apply(void 0,Z):b.apply(void 0,Z)}:Q}return Z[M]=O,O.apply(void 0,j)}}B.filter=function(Z){return function(M,j,K){return B(M,j,K,Z)}}},51004:function(Z,M,j){"use strict";j.d(M,{d:function(){return g}});var K=j(9127),b=function(Z,M){return Z?Z.getClassName&&"Mesh"===Z.getClassName()?null:Z.getClassName&&"SubMesh"===Z.getClassName()?Z.clone(M):Z.clone?Z.clone():null:null};var g=function(){function Z(){}return Z.DeepCopy=function(Z,M,j,g){for(var O=function(Z){var M=[];do{Object.getOwnPropertyNames(Z).forEach((function(Z){-1===M.indexOf(Z)&&M.push(Z)}))}while(Z=Object.getPrototypeOf(Z));return M}(Z),Q=0,Y=O;Q<Y.length;Q++){var I=Y[Q];if(("_"!==I[0]||g&&-1!==g.indexOf(I))&&(!I.endsWith("Observable")&&(!j||-1===j.indexOf(I)))){var E=Z[I],s=typeof E;if("function"!==s)try{if("object"===s)if(E instanceof Array){if(M[I]=[],E.length>0)if("object"==typeof E[0])for(var i=0;i<E.length;i++){var a=b(E[i],M);-1===M[I].indexOf(a)&&M[I].push(a)}else M[I]=E.slice(0)}else M[I]=b(E,M);else M[I]=E}catch(Z){K.c.Warn(Z.message)}}}},Z}()},50504:function(Z,M,j){"use strict";function K(Z){return"".concat(Z," needs to be imported before as it contains a side-effect required by your code.")}j.d(M,{e:function(){return K}})},60985:function(Z,M,j){"use strict";function K(){return"undefined"!==typeof window}function b(){return"undefined"!==typeof navigator}function g(){return"undefined"!==typeof document}function O(Z){for(var M="",j=Z.firstChild;j;)3===j.nodeType&&(M+=j.textContent),j=j.nextSibling;return M}j.d(M,{d:function(){return Q},g:function(){return O},k:function(){return g},n:function(){return b},q:function(){return K}});var Q={IsWindowObjectExist:K,IsNavigatorAvailable:b,IsDocumentAvailable:g,GetDOMTextContent:O}},33224:function(Z,M,j){"use strict";j.d(M,{d:function(){return b},g:function(){return g},i:function(){return O}});var K=j(40061),b=function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}return(0,K.m)(M,Z),M._setPrototypeOf=Object.setPrototypeOf||function(Z,M){return Z.__proto__=M,Z},M}(Error),g={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},O=function(Z){function M(j,K,g){var O=Z.call(this,j)||this;return O.errorCode=K,O.innerError=g,O.name="RuntimeError",b._setPrototypeOf(O,M.prototype),O}return(0,K.m)(M,Z),M}(b)},82790:function(Z,M,j){"use strict";j.d(M,{b:function(){return n},d:function(){return X},e:function(){return U},h:function(){return T},g:function(){return c},i:function(){return A},m:function(){return q},o:function(){return B},p:function(){return W}});var K=j(40061),b=j(67935),g=j(60985),O=j(9271),Q=function(){function Z(){}return Z.FilesToLoad={},Z}(),Y=function(){function Z(){}return Z.ExponentialBackoff=function(Z,M){return void 0===Z&&(Z=3),void 0===M&&(M=500),function(j,K,b){return 0!==K.status||b>=Z||-1!==j.indexOf("file:")?-1:Math.pow(2,b)*M}},Z}(),I=j(33224),E=j(50459),s=j(42647),i=j(72284),a=j(78588),z=j(9127),V=j(1116),o=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),c=function(Z){function M(j,K){var g=Z.call(this,j,I.g.LoadFileError)||this;return g.name="LoadFileError",I.d._setPrototypeOf(g,M.prototype),K instanceof b.e?g.request=K:g.file=K,g}return(0,K.m)(M,Z),M}(I.i),G=function(Z){function M(j,K){var b=Z.call(this,j,I.g.RequestFileError)||this;return b.request=K,b.name="RequestFileError",I.d._setPrototypeOf(b,M.prototype),b}return(0,K.m)(M,Z),M}(I.i),f=function(Z){function M(j,K){var b=Z.call(this,j,I.g.ReadFileError)||this;return b.file=K,b.name="ReadFileError",I.d._setPrototypeOf(b,M.prototype),b}return(0,K.m)(M,Z),M}(I.i),X={DefaultRetryStrategy:Y.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:function(Z){return Z}},d=function(Z){return Z=Z.replace(/#/gm,"%23")},W=function(Z,M){if((!Z||0!==Z.indexOf("data:"))&&X.CorsBehavior)if("string"===typeof X.CorsBehavior||X.CorsBehavior instanceof String)M.crossOrigin=X.CorsBehavior;else{var j=X.CorsBehavior(Z);j&&(M.crossOrigin=j)}},A=function(Z,M,j,b,g,O){var Y,I;void 0===g&&(g="");var s=!1;Z instanceof ArrayBuffer||ArrayBuffer.isView(Z)?"undefined"!==typeof Blob?(I=URL.createObjectURL(new Blob([Z],{type:g})),s=!0):I="data:".concat(g,";base64,")+(0,E.j)(Z):Z instanceof Blob?(I=URL.createObjectURL(Z),s=!0):(I=d(Z),I=X.PreprocessUrl(Z));var i=a.e.LastCreatedEngine,z=function(M){if(j){var K=I||Z.toString();j("Error while trying to load image: ".concat(0===K.indexOf("http")||K.length<=128?K:K.slice(0,128)+"..."),M)}};if("undefined"===typeof Image||null!==(Y=null===i||void 0===i?void 0:i._features.forceBitmapOverHTMLImageElement)&&void 0!==Y&&Y)return T(I,(function(b){i.createImageBitmap(new Blob([b],{type:g}),(0,K.e)({premultiplyAlpha:"none"},O)).then((function(Z){M(Z),s&&URL.revokeObjectURL(I)})).catch((function(M){j&&j("Error while trying to load image: "+Z,M)}))}),void 0,b||void 0,!0,(function(Z,M){z(M)})),null;var V=new Image;W(I,V);var o=function Z(){V.removeEventListener("load",Z),V.removeEventListener("error",c),M(V),s&&V.src&&URL.revokeObjectURL(V.src)},c=function Z(M){V.removeEventListener("load",o),V.removeEventListener("error",Z),z(M),s&&V.src&&URL.revokeObjectURL(V.src)};V.addEventListener("load",o),V.addEventListener("error",c);var G=function(){V.src=I};if("blob:"!==I.substr(0,5)&&"data:"!==I.substr(0,5)&&b&&b.enableTexturesOffline)b.open((function(){b&&b.loadImage(I,V)}),G);else{if(-1!==I.indexOf("file:")){var f=decodeURIComponent(I.substring(5).toLowerCase());if(Q.FilesToLoad[f]){try{var A=void 0;try{A=URL.createObjectURL(Q.FilesToLoad[f])}catch(Z){A=URL.createObjectURL(Q.FilesToLoad[f])}V.src=A,s=!0}catch(Z){V.src=""}return V}}G()}return V},q=function(Z,M,j,K,b){var g=new FileReader,Q={onCompleteObservable:new O.b,abort:function(){return g.abort()}};return g.onloadend=function(){return Q.onCompleteObservable.notifyObservers(Q)},b&&(g.onerror=function(){b(new f("Unable to read ".concat(Z.name),Z))}),g.onload=function(Z){M(Z.target.result)},j&&(g.onprogress=j),K?g.readAsArrayBuffer(Z):g.readAsText(Z),Q},T=function(Z,M,j,K,b,g,Y){if(Z.name)return q(Z,M,j,b,g?function(Z){g(void 0,Z)}:void 0);var I=Z;if(-1!==I.indexOf("file:")){var E=decodeURIComponent(I.substring(5).toLowerCase());0===E.indexOf("./")&&(E=E.substring(2));var s=Q.FilesToLoad[E];if(s)return q(s,M,j,b,g?function(Z){return g(void 0,new c(Z.message,Z.file))}:void 0)}if(U(I)){var i={onCompleteObservable:new O.b,abort:function(){return function(){}}};try{M(b?n(I):x(I))}catch(Z){g?g(void 0,Z):z.c.Error(Z.message||"Failed to parse the Data URL")}return V.c.SetImmediate((function(){i.onCompleteObservable.notifyObservers(i)})),i}return B(I,(function(Z,j){M(Z,j?j.responseURL:void 0)}),j,K,b,g?function(Z){g(Z.request,new c(Z.message,Z.request))}:void 0,Y)},B=function(Z,M,j,K,Q,Y,I){Z=d(Z),Z=X.PreprocessUrl(Z);var E=X.BaseUrl+Z,s=!1,i={onCompleteObservable:new O.b,abort:function(){return s=!0}},a=function(){var Z,K=new b.e,O=null,a=function(){K&&(j&&K.removeEventListener("progress",j),Z&&K.removeEventListener("readystatechange",Z),K.removeEventListener("loadend",V))},V=function(){a(),i.onCompleteObservable.notifyObservers(i),i.onCompleteObservable.clear(),j=void 0,Z=null,V=null,Y=void 0,I=void 0,M=void 0};i.abort=function(){s=!0,V&&V(),K&&K.readyState!==(XMLHttpRequest.DONE||4)&&K.abort(),null!==O&&(clearTimeout(O),O=null),K=null};var o=function(Z){var M=Z.message||"Unknown error";Y&&K?Y(new G(M,K)):z.c.Error(M)};!function i(z){if(K){if(K.open("GET",E),I)try{I(K)}catch(Z){return void o(Z)}Q&&(K.responseType="arraybuffer"),j&&K.addEventListener("progress",j),V&&K.addEventListener("loadend",V),Z=function(){if(!s&&K&&K.readyState===(XMLHttpRequest.DONE||4)){if(Z&&K.removeEventListener("readystatechange",Z),K.status>=200&&K.status<300||0===K.status&&(!(0,g.q)()||N())){try{M&&M(Q?K.response:K.responseText,K)}catch(Z){o(Z)}return}var j=X.DefaultRetryStrategy;if(j){var I=j(E,K,z);if(-1!==I)return a(),K=new b.e,void(O=setTimeout((function(){return i(z+1)}),I))}var V=new G("Error status: "+K.status+" "+K.statusText+" - Unable to load "+E,K);Y&&Y(V)}},K.addEventListener("readystatechange",Z),K.send()}}(0)};if(K&&K.enableSceneOffline){var V=function(Z){Z&&Z.status>400?Y&&Y(Z):a()};K.open((function(){K&&K.loadFile(X.BaseUrl+Z,(function(Z){!s&&M&&M(Z),i.onCompleteObservable.notifyObservers(i)}),j?function(Z){!s&&j&&j(Z)}:void 0,V,Q)}),V)}else a();return i},N=function(){return"undefined"!==typeof location&&"file:"===location.protocol},U=function(Z){return o.test(Z)};function n(Z){return(0,E.e)(Z.split(",")[1])}var k,x=function(Z){return(0,E.f)(Z.split(",")[1])};i.d._FileToolsLoadImage=A,i.d._FileToolsLoadFile=T,s.b._FileToolsLoadFile=T;!function(Z,M,j,K,b,g,O,Q,Y,I){k={DecodeBase64UrlToBinary:Z,DecodeBase64UrlToString:M,DefaultRetryStrategy:j.DefaultRetryStrategy,BaseUrl:j.BaseUrl,CorsBehavior:j.CorsBehavior,PreprocessUrl:j.PreprocessUrl,IsBase64DataUrl:K,IsFileURL:b,LoadFile:g,LoadImage:O,ReadFile:Q,RequestFile:Y,SetCorsBehavior:I},Object.defineProperty(k,"DefaultRetryStrategy",{get:function(){return j.DefaultRetryStrategy},set:function(Z){j.DefaultRetryStrategy=Z}}),Object.defineProperty(k,"BaseUrl",{get:function(){return j.BaseUrl},set:function(Z){j.BaseUrl=Z}}),Object.defineProperty(k,"PreprocessUrl",{get:function(){return j.PreprocessUrl},set:function(Z){j.PreprocessUrl=Z}}),Object.defineProperty(k,"CorsBehavior",{get:function(){return j.CorsBehavior},set:function(Z){j.CorsBehavior=Z}})}(n,x,X,U,N,T,A,q,B,W)},28372:function(Z,M,j){"use strict";function K(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(Z){var M=16*Math.random()|0;return("x"===Z?M:3&M|8).toString(16)}))}j.d(M,{d:function(){return K}})},90526:function(Z,M,j){"use strict";j.d(M,{e:function(){return g}});var K=j(9127),b=j(31709),g=function(){function Z(){}return Z.Instantiate=function(Z){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[Z])return this.RegisteredExternalClasses[Z];var M=(0,b.b)(Z);if(M)return M;K.c.Warn(Z+" not found, you may have missed an import.");for(var j=Z.split("."),g=window||this,O=0,Q=j.length;O<Q;O++)g=g[j[O]];return"function"!==typeof g?null:g},Z.RegisteredExternalClasses={},Z}()},9127:function(Z,M,j){"use strict";j.d(M,{c:function(){return K}});var K=function(){function Z(){}return Z._CheckLimit=function(M,j){var K=Z._LogLimitOutputs[M];return K?K.current++:(K={limit:j,current:1},Z._LogLimitOutputs[M]=K),K.current<=K.limit},Z._GenerateLimitMessage=function(M,j){var K=Z._LogLimitOutputs[M];if(K&&Z.MessageLimitReached&&K.current===K.limit)switch(j){case 0:Z.Log(Z.MessageLimitReached.replace(/%LIMIT%/g,""+K.limit).replace(/%TYPE%/g,"log"));break;case 1:Z.Warn(Z.MessageLimitReached.replace(/%LIMIT%/g,""+K.limit).replace(/%TYPE%/g,"warning"));break;case 2:Z.Error(Z.MessageLimitReached.replace(/%LIMIT%/g,""+K.limit).replace(/%TYPE%/g,"error"))}},Z._AddLogEntry=function(M){Z._LogCache=M+Z._LogCache,Z.OnNewCacheEntry&&Z.OnNewCacheEntry(M)},Z._FormatMessage=function(Z){var M=function(Z){return Z<10?"0"+Z:""+Z},j=new Date;return"["+M(j.getHours())+":"+M(j.getMinutes())+":"+M(j.getSeconds())+"]: "+Z},Z._LogDisabled=function(Z,M){},Z._LogEnabled=function(M,j){if(void 0===j||Z._CheckLimit(M,j)){var K=Z._FormatMessage(M);console.log("BJS - "+K);var b="<div style='color:white'>"+K+"</div><br>";Z._AddLogEntry(b),Z._GenerateLimitMessage(M,0)}},Z._WarnDisabled=function(Z,M){},Z._WarnEnabled=function(M,j){if(void 0===j||Z._CheckLimit(M,j)){var K=Z._FormatMessage(M);console.warn("BJS - "+K);var b="<div style='color:orange'>"+M+"</div><br>";Z._AddLogEntry(b),Z._GenerateLimitMessage(M,1)}},Z._ErrorDisabled=function(Z,M){},Z._ErrorEnabled=function(M,j){if(void 0===j||Z._CheckLimit(M,j)){var K=Z._FormatMessage(M);Z.errorsCount++,console.error("BJS - "+K);var b="<div style='color:red'>"+K+"</div><br>";Z._AddLogEntry(b),Z._GenerateLimitMessage(M,2)}},Object.defineProperty(Z,"LogCache",{get:function(){return Z._LogCache},enumerable:!1,configurable:!0}),Z.ClearLogCache=function(){Z._LogCache="",Z._LogLimitOutputs={},Z.errorsCount=0},Object.defineProperty(Z,"LogLevels",{set:function(M){(M&Z.MessageLogLevel)===Z.MessageLogLevel?Z.Log=Z._LogEnabled:Z.Log=Z._LogDisabled,(M&Z.WarningLogLevel)===Z.WarningLogLevel?Z.Warn=Z._WarnEnabled:Z.Warn=Z._WarnDisabled,(M&Z.ErrorLogLevel)===Z.ErrorLogLevel?Z.Error=Z._ErrorEnabled:Z.Error=Z._ErrorDisabled},enumerable:!1,configurable:!0}),Z.NoneLogLevel=0,Z.MessageLogLevel=1,Z.WarningLogLevel=2,Z.ErrorLogLevel=4,Z.AllLogLevel=7,Z.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",Z._LogCache="",Z._LogLimitOutputs={},Z.errorsCount=0,Z.Log=Z._LogEnabled,Z.Warn=Z._WarnEnabled,Z.Error=Z._ErrorEnabled,Z}()},9271:function(Z,M,j){"use strict";j.d(M,{b:function(){return g}});var K=function(){function Z(Z,M,j,K){void 0===M&&(M=!1),this.initialize(Z,M,j,K)}return Z.prototype.initialize=function(Z,M,j,K){return void 0===M&&(M=!1),this.mask=Z,this.skipNextObservers=M,this.target=j,this.currentTarget=K,this},Z}(),b=function(Z,M,j){void 0===j&&(j=null),this.callback=Z,this.mask=M,this.scope=j,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},g=(function(){function Z(){}Z.prototype.dispose=function(){if(this._observers&&this._observables)for(var Z=0;Z<this._observers.length;Z++)this._observables[Z].remove(this._observers[Z]);this._observers=null,this._observables=null},Z.Watch=function(M,j,K,b){void 0===K&&(K=-1),void 0===b&&(b=null);var g=new Z;g._observers=new Array,g._observables=M;for(var O=0,Q=M;O<Q.length;O++){var Y=Q[O].add(j,K,!1,b);Y&&g._observers.push(Y)}return g}}(),function(){function Z(Z){this._observers=new Array,this._eventState=new K(0),Z&&(this._onObserverAdded=Z)}return Z.FromPromise=function(M,j){var K=new Z;return M.then((function(Z){K.notifyObservers(Z)})).catch((function(Z){if(!j)throw Z;j.notifyObservers(Z)})),K},Object.defineProperty(Z.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),Z.prototype.add=function(Z,M,j,K,g){if(void 0===M&&(M=-1),void 0===j&&(j=!1),void 0===K&&(K=null),void 0===g&&(g=!1),!Z)return null;var O=new b(Z,M,K);return O.unregisterOnNextCall=g,j?this._observers.unshift(O):this._observers.push(O),this._onObserverAdded&&this._onObserverAdded(O),O},Z.prototype.addOnce=function(Z){return this.add(Z,void 0,void 0,void 0,!0)},Z.prototype.remove=function(Z){return!!Z&&(-1!==this._observers.indexOf(Z)&&(this._deferUnregister(Z),!0))},Z.prototype.removeCallback=function(Z,M){for(var j=0;j<this._observers.length;j++){var K=this._observers[j];if(!K._willBeUnregistered&&(K.callback===Z&&(!M||M===K.scope)))return this._deferUnregister(K),!0}return!1},Z.prototype._deferUnregister=function(Z){var M=this;Z.unregisterOnNextCall=!1,Z._willBeUnregistered=!0,setTimeout((function(){M._remove(Z)}),0)},Z.prototype._remove=function(Z){if(!Z)return!1;var M=this._observers.indexOf(Z);return-1!==M&&(this._observers.splice(M,1),!0)},Z.prototype.makeObserverTopPriority=function(Z){this._remove(Z),this._observers.unshift(Z)},Z.prototype.makeObserverBottomPriority=function(Z){this._remove(Z),this._observers.push(Z)},Z.prototype.notifyObservers=function(Z,M,j,K,b){if(void 0===M&&(M=-1),!this._observers.length)return!0;var g=this._eventState;g.mask=M,g.target=j,g.currentTarget=K,g.skipNextObservers=!1,g.lastReturnValue=Z,g.userInfo=b;for(var O=0,Q=this._observers;O<Q.length;O++){var Y=Q[O];if(!Y._willBeUnregistered&&(Y.mask&M&&(Y.scope?g.lastReturnValue=Y.callback.apply(Y.scope,[Z,g]):g.lastReturnValue=Y.callback(Z,g),Y.unregisterOnNextCall&&this._deferUnregister(Y)),g.skipNextObservers))return!1}return!0},Z.prototype.notifyObserversWithPromise=function(Z,M,j,K,b){var g=this;void 0===M&&(M=-1);var O=Promise.resolve(Z);if(!this._observers.length)return O;var Q=this._eventState;return Q.mask=M,Q.target=j,Q.currentTarget=K,Q.skipNextObservers=!1,Q.userInfo=b,this._observers.forEach((function(j){Q.skipNextObservers||j._willBeUnregistered||j.mask&M&&(O=j.scope?O.then((function(M){return Q.lastReturnValue=M,j.callback.apply(j.scope,[Z,Q])})):O.then((function(M){return Q.lastReturnValue=M,j.callback(Z,Q)})),j.unregisterOnNextCall&&g._deferUnregister(j))})),O.then((function(){return Z}))},Z.prototype.notifyObserver=function(Z,M,j){if(void 0===j&&(j=-1),!Z._willBeUnregistered){var K=this._eventState;K.mask=j,K.skipNextObservers=!1,Z.callback(M,K),Z.unregisterOnNextCall&&this._deferUnregister(Z)}},Z.prototype.hasObservers=function(){return this._observers.length>0},Z.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},Z.prototype.clone=function(){var M=new Z;return M._observers=this._observers.slice(0),M},Z.prototype.hasSpecificMask=function(Z){void 0===Z&&(Z=-1);for(var M=0,j=this._observers;M<j.length;M++){var K=j[M];if(K.mask&Z||K.mask===Z)return!0}return!1},Z}())},16945:function(Z,M,j){"use strict";j.d(M,{d:function(){return b}});var K=j(19500),b=function(){function Z(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(Z.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),Z.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},Z.prototype.addCount=function(M,j){Z.Enabled&&(this._current+=M,j&&this._fetchResult())},Z.prototype.beginMonitoring=function(){Z.Enabled&&(this._startMonitoringTime=K.c.Now)},Z.prototype.endMonitoring=function(M){if(void 0===M&&(M=!0),Z.Enabled){M&&this.fetchNewFrame();var j=K.c.Now;this._current=j-this._startMonitoringTime,M&&this._fetchResult()}},Z.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var Z=K.c.Now;Z-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=Z,this._lastSecAccumulated=0,this._lastSecValueCount=0)},Z.Enabled=!0,Z}()},19500:function(Z,M,j){"use strict";j.d(M,{c:function(){return b}});var K=j(60985),b=function(){function Z(){}return Object.defineProperty(Z,"Now",{get:function(){return K.d.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),Z}()},81965:function(Z,M,j){"use strict";j.d(M,{e:function(){return a}});var K=j(56965),b=(j(69233),j(84468),j(70937),j(52128),j(40061)),g=j(90690),O=j(16179),Q="varying vec2 vUV;\nuniform sampler2D textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}";O.d.ShadersStore.passPixelShader=Q;var Y="varying vec2 vUV;\nuniform samplerCube textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\nvec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001));\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));\n#endif\n}";O.d.ShadersStore.passCubePixelShader=Y;var I=j(31709),E=j(9892),s=function(Z){function M(M,j,K,b,g,O,Q,Y){return void 0===K&&(K=null),void 0===Q&&(Q=0),void 0===Y&&(Y=!1),Z.call(this,M,"pass",null,null,j,K,b,g,O,void 0,Q,void 0,null,Y)||this}return(0,b.m)(M,Z),M.prototype.getClassName=function(){return"PassPostProcess"},M._Parse=function(Z,j,K,b){return E.b.Parse((function(){return new M(Z.name,Z.options,j,Z.renderTargetSamplingMode,Z._engine,Z.reusable)}),Z,K,b)},M}(K.d);(0,I.c)("BABYLON.PassPostProcess",s);!function(Z){function M(M,j,K,b,g,O,Q,Y){void 0===K&&(K=null),void 0===Q&&(Q=0),void 0===Y&&(Y=!1);var I=Z.call(this,M,"passCube",null,null,j,K,b,g,O,"#define POSITIVEX",Q,void 0,null,Y)||this;return I._face=0,I}(0,b.m)(M,Z),Object.defineProperty(M.prototype,"face",{get:function(){return this._face},set:function(Z){if(!(Z<0||Z>5))switch(this._face=Z,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"PassCubePostProcess"},M._Parse=function(Z,j,K,b){return E.b.Parse((function(){return new M(Z.name,Z.options,j,Z.renderTargetSamplingMode,Z._engine,Z.reusable)}),Z,K,b)}}(K.d);function i(Z,M,j,b,g,O){var Q=M.getEngine();return M.isReady=!1,g=null!==g&&void 0!==g?g:M.samplingMode,b=null!==b&&void 0!==b?b:M.type,O=null!==O&&void 0!==O?O:M.format,-1===b&&(b=0),new Promise((function(Y){var I=new K.d("postprocess",Z,null,null,1,null,g,Q,!1,void 0,b,void 0,null,!1,O);I.externalTextureSamplerBinding=!0;var E=Q.createRenderTargetTexture({width:M.width,height:M.height},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:g,type:b,format:O});I.getEffect().executeWhenCompiled((function(){I.onApply=function(Z){Z._bindTexture("textureSampler",M),Z.setFloat2("scale",1,1)},j.postProcessManager.directRender([I],E,!0),Q.restoreDefaultFramebuffer(),Q._releaseTexture(M),I&&I.dispose(),E._swapAndDie(M),M.type=b,M.format=5,M.isReady=!0,Y(M)}))}))}g.c._RescalePostProcessFactory=function(Z){return new s("rescale",1,null,2,Z,!1,0)};var a=function(){function Z(){}return Z.ExpandRGBDTexture=function(Z){var M=Z._texture;if(M&&Z.isRGBD){var j=M.getEngine(),b=j.getCaps(),g=M.isReady,O=!1;b.textureHalfFloatRender&&b.textureHalfFloatLinearFiltering?(O=!0,M.type=2):b.textureFloatRender&&b.textureFloatLinearFiltering&&(O=!0,M.type=1),O&&(M.isReady=!1,M._isRGBD=!1,M.invertY=!1);var Q=function(){if(O){var b=new K.d("rgbdDecode","rgbdDecode",null,null,1,null,3,j,!1,void 0,M.type,void 0,null,!1);b.externalTextureSamplerBinding=!0;var g=j.createRenderTargetTexture(M.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:M.samplingMode,type:M.type,format:5});b.getEffect().executeWhenCompiled((function(){b.onApply=function(Z){Z._bindTexture("textureSampler",M),Z.setFloat2("scale",1,1)},Z.getScene().postProcessManager.directRender([b],g,!0),j.restoreDefaultFramebuffer(),j._releaseTexture(M),b&&b.dispose(),g._swapAndDie(M),M.isReady=!0}))}};g?Q():Z.onLoadObservable.addOnce(Q)}},Z.EncodeTextureToRGBD=function(Z,M,j){return void 0===j&&(j=0),i("rgbdEncode",Z,M,j,1,5)},Z}()},17190:function(Z,M,j){"use strict";j.d(M,{c:function(){return g},f:function(){return b}});var K=j(40061),b=function(){function Z(M){this.length=0,this.data=new Array(M),this._id=Z._GlobalId++}return Z.prototype.push=function(Z){this.data[this.length++]=Z,this.length>this.data.length&&(this.data.length*=2)},Z.prototype.forEach=function(Z){for(var M=0;M<this.length;M++)Z(this.data[M])},Z.prototype.sort=function(Z){this.data.sort(Z)},Z.prototype.reset=function(){this.length=0},Z.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},Z.prototype.concat=function(Z){if(0!==Z.length){this.length+Z.length>this.data.length&&(this.data.length=2*(this.length+Z.length));for(var M=0;M<Z.length;M++)this.data[this.length++]=(Z.data||Z)[M]}},Z.prototype.indexOf=function(Z){var M=this.data.indexOf(Z);return M>=this.length?-1:M},Z.prototype.contains=function(Z){return-1!==this.indexOf(Z)},Z._GlobalId=0,Z}(),g=function(Z){function M(){var M=null!==Z&&Z.apply(this,arguments)||this;return M._duplicateId=0,M}return(0,K.m)(M,Z),M.prototype.push=function(M){Z.prototype.push.call(this,M),M.__smartArrayFlags||(M.__smartArrayFlags={}),M.__smartArrayFlags[this._id]=this._duplicateId},M.prototype.pushNoDuplicate=function(Z){return(!Z.__smartArrayFlags||Z.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(Z),!0)},M.prototype.reset=function(){Z.prototype.reset.call(this),this._duplicateId++},M.prototype.concatWithNoDuplicate=function(Z){if(0!==Z.length){this.length+Z.length>this.data.length&&(this.data.length=2*(this.length+Z.length));for(var M=0;M<Z.length;M++){var j=(Z.data||Z)[M];this.pushNoDuplicate(j)}}},M}(b)},50459:function(Z,M,j){"use strict";j.d(M,{e:function(){return O},f:function(){return g},g:function(){return K},j:function(){return b}});var K=function(Z){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(Z);for(var M="",j=0;j<Z.byteLength;j++)M+=String.fromCharCode(Z[j]);return M},b=function(Z){for(var M,j,K,b,g,O,Q,Y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",I="",E=0,s=ArrayBuffer.isView(Z)?new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength):new Uint8Array(Z);E<s.length;)b=(M=s[E++])>>2,g=(3&M)<<4|(j=E<s.length?s[E++]:Number.NaN)>>4,O=(15&j)<<2|(K=E<s.length?s[E++]:Number.NaN)>>6,Q=63&K,isNaN(j)?O=Q=64:isNaN(K)&&(Q=64),I+=Y.charAt(b)+Y.charAt(g)+Y.charAt(O)+Y.charAt(Q);return I},g=function(Z){return atob(Z)},O=function(Z){for(var M=g(Z),j=M.length,K=new Uint8Array(new ArrayBuffer(j)),b=0;b<j;b++)K[b]=M.charCodeAt(b);return K.buffer}},45883:function(Z,M,j){"use strict";j.d(M,{d:function(){return b}});var K=function(){function Z(){}return Z.Eval=function(M,j){return"true"===(M=M.match(/\([^()]*\)/g)?M.replace(/\([^()]*\)/g,(function(M){return M=M.slice(1,M.length-1),Z._HandleParenthesisContent(M,j)})):Z._HandleParenthesisContent(M,j))||"false"!==M&&Z.Eval(M,j)},Z._HandleParenthesisContent=function(M,j){var K;j=j||function(Z){return"true"===Z};var b=M.split("||");for(var g in b)if(Object.prototype.hasOwnProperty.call(b,g)){var O=Z._SimplifyNegation(b[g].trim()),Q=O.split("&&");if(Q.length>1)for(var Y=0;Y<Q.length;++Y){var I=Z._SimplifyNegation(Q[Y].trim());if(!(K="true"!==I&&"false"!==I?"!"===I[0]?!j(I.substring(1)):j(I):"true"===I)){O="false";break}}if(K||"true"===O){K=!0;break}K="true"!==O&&"false"!==O?"!"===O[0]?!j(O.substring(1)):j(O):"true"===O}return K?"true":"false"},Z._SimplifyNegation=function(Z){return"!true"===(Z=(Z=Z.replace(/^[\s!]+/,(function(Z){return(Z=Z.replace(/[\s]/g,(function(){return""}))).length%2?"!":""}))).trim())?Z="false":"!false"===Z&&(Z="true"),Z},Z}(),b=function(){function Z(){}return Z.EnableFor=function(M){M._tags=M._tags||{},M.hasTags=function(){return Z.HasTags(M)},M.addTags=function(j){return Z.AddTagsTo(M,j)},M.removeTags=function(j){return Z.RemoveTagsFrom(M,j)},M.matchesTagsQuery=function(j){return Z.MatchesQuery(M,j)}},Z.DisableFor=function(Z){delete Z._tags,delete Z.hasTags,delete Z.addTags,delete Z.removeTags,delete Z.matchesTagsQuery},Z.HasTags=function(Z){if(!Z._tags)return!1;var M=Z._tags;for(var j in M)if(Object.prototype.hasOwnProperty.call(M,j))return!0;return!1},Z.GetTags=function(Z,M){if(void 0===M&&(M=!0),!Z._tags)return null;if(M){var j=[];for(var K in Z._tags)Object.prototype.hasOwnProperty.call(Z._tags,K)&&!0===Z._tags[K]&&j.push(K);return j.join(" ")}return Z._tags},Z.AddTagsTo=function(M,j){j&&("string"===typeof j&&j.split(" ").forEach((function(j){Z._AddTagTo(M,j)})))},Z._AddTagTo=function(M,j){""!==(j=j.trim())&&"true"!==j&&"false"!==j&&(j.match(/[\s]/)||j.match(/^([!]|([|]|[&]){2})/)||(Z.EnableFor(M),M._tags[j]=!0))},Z.RemoveTagsFrom=function(M,j){if(Z.HasTags(M)){var K=j.split(" ");for(var b in K)Z._RemoveTagFrom(M,K[b])}},Z._RemoveTagFrom=function(Z,M){delete Z._tags[M]},Z.MatchesQuery=function(M,j){return void 0===j||(""===j?Z.HasTags(M):K.Eval(j,(function(j){return Z.HasTags(M)&&M._tags[j]})))},Z}()},1116:function(Z,M,j){"use strict";j.d(M,{c:function(){return b}});var K=j(60985),b=function(){function Z(){}return Z.SetImmediate=function(Z){(0,K.q)()&&window.setImmediate?window.setImmediate(Z):setTimeout(Z,1)},Z}()},9217:function(Z,M,j){"use strict";j.d(M,{b:function(){return c},d:function(){return o}});var K=j(40061),b=j(9271),g=j(60985),O=j(9127),Q=j(51004),Y=j(19500),I=j(50504),E=j(67935),s=j(78588),i=j(82790),a=j(1116),z=j(90526),V=j(28372),o=function(){function Z(){}return Object.defineProperty(Z,"BaseUrl",{get:function(){return i.d.BaseUrl},set:function(Z){i.d.BaseUrl=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"DefaultRetryStrategy",{get:function(){return i.d.DefaultRetryStrategy},set:function(Z){i.d.DefaultRetryStrategy=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"CorsBehavior",{get:function(){return i.d.CorsBehavior},set:function(Z){i.d.CorsBehavior=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"UseFallbackTexture",{get:function(){return s.e.UseFallbackTexture},set:function(Z){s.e.UseFallbackTexture=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"RegisteredExternalClasses",{get:function(){return z.e.RegisteredExternalClasses},set:function(Z){z.e.RegisteredExternalClasses=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"fallbackTexture",{get:function(){return s.e.FallbackTexture},set:function(Z){s.e.FallbackTexture=Z},enumerable:!1,configurable:!0}),Z.FetchToRef=function(Z,M,j,K,b,g){var O=4*((Math.abs(Z)*j%j|0)+(Math.abs(M)*K%K|0)*j);g.r=b[O]/255,g.g=b[O+1]/255,g.b=b[O+2]/255,g.a=b[O+3]/255},Z.Mix=function(Z,M,j){return Z*(1-j)+M*j},Z.Instantiate=function(Z){return z.e.Instantiate(Z)},Z.SetImmediate=function(Z){a.c.SetImmediate(Z)},Z.IsExponentOfTwo=function(Z){var M=1;do{M*=2}while(M<Z);return M===Z},Z.FloatRound=function(M){return Math.fround?Math.fround(M):(Z._TmpFloatArray[0]=M,Z._TmpFloatArray[0])},Z.GetFilename=function(Z){var M=Z.lastIndexOf("/");return M<0?Z:Z.substring(M+1)},Z.GetFolderPath=function(Z,M){void 0===M&&(M=!1);var j=Z.lastIndexOf("/");return j<0?M?Z:"":Z.substring(0,j+1)},Z.ToDegrees=function(Z){return 180*Z/Math.PI},Z.ToRadians=function(Z){return Z*Math.PI/180},Z.MakeArray=function(Z,M){return!0===M||void 0!==Z&&null!=Z?Array.isArray(Z)?Z:[Z]:null},Z.GetPointerPrefix=function(Z){var M="pointer";return(0,g.q)()&&!window.PointerEvent&&(M="mouse"),!Z._badDesktopOS||Z._badOS||document&&"ontouchend"in document||(M="mouse"),M},Z.SetCorsBehavior=function(Z,M){(0,i.p)(Z,M)},Z.SetReferrerPolicyBehavior=function(Z,M){M.referrerPolicy=Z},Z.CleanUrl=function(Z){return Z=Z.replace(/#/gm,"%23")},Object.defineProperty(Z,"PreprocessUrl",{get:function(){return i.d.PreprocessUrl},set:function(Z){i.d.PreprocessUrl=Z},enumerable:!1,configurable:!0}),Z.LoadImage=function(Z,M,j,K,b,g){return(0,i.i)(Z,M,j,K,b,g)},Z.LoadFile=function(Z,M,j,K,b,g){return(0,i.h)(Z,M,j,K,b,g)},Z.LoadFileAsync=function(Z,M){return void 0===M&&(M=!0),new Promise((function(j,K){(0,i.h)(Z,(function(Z){j(Z)}),void 0,void 0,M,(function(Z,M){K(M)}))}))},Z.LoadScript=function(Z,M,j,K){if((0,g.q)()){var b=document.getElementsByTagName("head")[0],O=document.createElement("script");O.setAttribute("type","text/javascript"),O.setAttribute("src",Z),K&&(O.id=K),O.onload=function(){M&&M()},O.onerror=function(M){j&&j("Unable to load script '".concat(Z,"'"),M)},b.appendChild(O)}},Z.LoadScriptAsync=function(Z){var M=this;return new Promise((function(j,K){M.LoadScript(Z,(function(){j()}),(function(Z,M){K(M)}))}))},Z.ReadFileAsDataURL=function(Z,M,j){var K=new FileReader,g={onCompleteObservable:new b.b,abort:function(){return K.abort()}};return K.onloadend=function(){g.onCompleteObservable.notifyObservers(g)},K.onload=function(Z){M(Z.target.result)},K.onprogress=j,K.readAsDataURL(Z),g},Z.ReadFile=function(Z,M,j,K,b){return(0,i.m)(Z,M,j,K,b)},Z.FileAsURL=function(Z){var M=new Blob([Z]);return(window.URL||window.webkitURL).createObjectURL(M)},Z.Format=function(Z,M){return void 0===M&&(M=2),Z.toFixed(M)},Z.DeepCopy=function(Z,M,j,K){Q.d.DeepCopy(Z,M,j,K)},Z.IsEmpty=function(Z){for(var M in Z)if(Object.prototype.hasOwnProperty.call(Z,M))return!1;return!0},Z.RegisterTopRootEvents=function(Z,M){for(var j=0;j<M.length;j++){var K=M[j];Z.addEventListener(K.name,K.handler,!1);try{window.parent&&window.parent.addEventListener(K.name,K.handler,!1)}catch(Z){}}},Z.UnregisterTopRootEvents=function(Z,M){for(var j=0;j<M.length;j++){var K=M[j];Z.removeEventListener(K.name,K.handler);try{Z.parent&&Z.parent.removeEventListener(K.name,K.handler)}catch(Z){}}},Z.DumpFramebuffer=function(M,j,b,g,O,Q){return void 0===O&&(O="image/png"),(0,K.h)(this,void 0,void 0,(function(){var Y,I;return(0,K.n)(this,(function(K){switch(K.label){case 0:return[4,b.readPixels(0,0,M,j)];case 1:return Y=K.sent(),I=new Uint8Array(Y.buffer),Z.DumpData(M,j,I,g,O,Q,!0),[2]}}))}))},Z.DumpData=function(M,j,K,b,g,O,Q,Y,I){void 0===g&&(g="image/png"),void 0===Q&&(Q=!1),void 0===Y&&(Y=!1),Z._ScreenshotCanvas||(Z._ScreenshotCanvas=document.createElement("canvas")),Z._ScreenshotCanvas.width=M,Z._ScreenshotCanvas.height=j;var E=Z._ScreenshotCanvas.getContext("2d");if(E){if(K instanceof Float32Array){for(var s=new Uint8Array(K.length),i=K.length;i--;){var a=K[i];s[i]=a<0?0:a>1?1:Math.round(255*a)}K=s}var z=E.createImageData(M,j);z.data.set(K),E.putImageData(z,0,0);var V=Z._ScreenshotCanvas;if(Q){var o=document.createElement("canvas");o.width=M,o.height=j;var c=o.getContext("2d");if(!c)return;c.translate(0,j),c.scale(1,-1),c.drawImage(Z._ScreenshotCanvas,0,0),V=o}Y?Z.ToBlob(V,(function(Z){var M=new FileReader;M.onload=function(Z){var M=Z.target.result;b&&b(M)},M.readAsArrayBuffer(Z)}),g,I):Z.EncodeScreenshotCanvasData(b,g,O,V,I)}},Z.DumpDataAsync=function(M,j,K,b,g,O,Q,Y){return void 0===b&&(b="image/png"),void 0===O&&(O=!1),void 0===Q&&(Q=!1),new Promise((function(I){Z.DumpData(M,j,K,(function(Z){return I(Z)}),b,g,O,Q,Y)}))},Z.ToBlob=function(Z,M,j,K){void 0===j&&(j="image/png"),Z.toBlob||(Z.toBlob=function(Z,M,j){var K=this;setTimeout((function(){for(var b=atob(K.toDataURL(M,j).split(",")[1]),g=b.length,O=new Uint8Array(g),Q=0;Q<g;Q++)O[Q]=b.charCodeAt(Q);Z(new Blob([O]))}))}),Z.toBlob((function(Z){M(Z)}),j,K)},Z.DownloadBlob=function(M,j){if("download"in document.createElement("a")){if(!j){var K=new Date;j="screenshot_"+((K.getFullYear()+"-"+(K.getMonth()+1)).slice(2)+"-"+K.getDate()+"_"+K.getHours()+"-"+("0"+K.getMinutes()).slice(-2))+".png"}Z.Download(M,j)}else if(M){var b=URL.createObjectURL(M),g=window.open("");if(!g)return;var O=g.document.createElement("img");O.onload=function(){URL.revokeObjectURL(b)},O.src=b,g.document.body.appendChild(O)}},Z.EncodeScreenshotCanvasData=function(M,j,K,b,g){(void 0===j&&(j="image/png"),M)?M((null!==b&&void 0!==b?b:Z._ScreenshotCanvas).toDataURL(j,g)):this.ToBlob(null!==b&&void 0!==b?b:Z._ScreenshotCanvas,(function(M){M&&Z.DownloadBlob(M,K)}),j,g)},Z.Download=function(Z,M){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(Z,M);else{var j=window.URL.createObjectURL(Z),K=document.createElement("a");document.body.appendChild(K),K.style.display="none",K.href=j,K.download=M,K.addEventListener("click",(function(){K.parentElement&&K.parentElement.removeChild(K)})),K.click(),window.URL.revokeObjectURL(j)}},Z.BackCompatCameraNoPreventDefault=function(Z){return"boolean"===typeof Z[0]?Z[0]:"boolean"===typeof Z[1]&&Z[1]},Z.CreateScreenshot=function(Z,M,j,K,b){throw void 0===b&&(b="image/png"),(0,I.e)("ScreenshotTools")},Z.CreateScreenshotAsync=function(Z,M,j,K){throw void 0===K&&(K="image/png"),(0,I.e)("ScreenshotTools")},Z.CreateScreenshotUsingRenderTarget=function(Z,M,j,K,b,g,O,Q){throw void 0===b&&(b="image/png"),void 0===g&&(g=1),void 0===O&&(O=!1),(0,I.e)("ScreenshotTools")},Z.CreateScreenshotUsingRenderTargetAsync=function(Z,M,j,K,b,g,O){throw void 0===K&&(K="image/png"),void 0===b&&(b=1),void 0===g&&(g=!1),(0,I.e)("ScreenshotTools")},Z.RandomId=function(){return(0,V.d)()},Z.IsBase64=function(Z){return(0,i.e)(Z)},Z.DecodeBase64=function(Z){return(0,i.b)(Z)},Object.defineProperty(Z,"errorsCount",{get:function(){return O.c.errorsCount},enumerable:!1,configurable:!0}),Z.Log=function(Z){O.c.Log(Z)},Z.Warn=function(Z){O.c.Warn(Z)},Z.Error=function(Z){O.c.Error(Z)},Object.defineProperty(Z,"LogCache",{get:function(){return O.c.LogCache},enumerable:!1,configurable:!0}),Z.ClearLogCache=function(){O.c.ClearLogCache()},Object.defineProperty(Z,"LogLevels",{set:function(Z){O.c.LogLevels=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"PerformanceLogLevel",{set:function(M){return(M&Z.PerformanceUserMarkLogLevel)===Z.PerformanceUserMarkLogLevel?(Z.StartPerformanceCounter=Z._StartUserMark,void(Z.EndPerformanceCounter=Z._EndUserMark)):(M&Z.PerformanceConsoleLogLevel)===Z.PerformanceConsoleLogLevel?(Z.StartPerformanceCounter=Z._StartPerformanceConsole,void(Z.EndPerformanceCounter=Z._EndPerformanceConsole)):(Z.StartPerformanceCounter=Z._StartPerformanceCounterDisabled,void(Z.EndPerformanceCounter=Z._EndPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Z._StartPerformanceCounterDisabled=function(Z,M){},Z._EndPerformanceCounterDisabled=function(Z,M){},Z._StartUserMark=function(M,j){if(void 0===j&&(j=!0),!Z._Performance){if(!(0,g.q)())return;Z._Performance=window.performance}j&&Z._Performance.mark&&Z._Performance.mark(M+"-Begin")},Z._EndUserMark=function(M,j){void 0===j&&(j=!0),j&&Z._Performance.mark&&(Z._Performance.mark(M+"-End"),Z._Performance.measure(M,M+"-Begin",M+"-End"))},Z._StartPerformanceConsole=function(M,j){void 0===j&&(j=!0),j&&(Z._StartUserMark(M,j),console.time&&console.time(M))},Z._EndPerformanceConsole=function(M,j){void 0===j&&(j=!0),j&&(Z._EndUserMark(M,j),console.timeEnd(M))},Object.defineProperty(Z,"Now",{get:function(){return Y.c.Now},enumerable:!1,configurable:!0}),Z.GetClassName=function(Z,M){void 0===M&&(M=!1);var j=null;if(!M&&Z.getClassName)j=Z.getClassName();else{if(Z instanceof Object)j=(M?Z:Object.getPrototypeOf(Z)).constructor.__bjsclassName__;j||(j=typeof Z)}return j},Z.First=function(Z,M){for(var j=0,K=Z;j<K.length;j++){var b=K[j];if(M(b))return b}return null},Z.getFullClassName=function(Z,M){void 0===M&&(M=!1);var j=null,K=null;if(!M&&Z.getClassName)j=Z.getClassName();else{if(Z instanceof Object){var b=M?Z:Object.getPrototypeOf(Z);j=b.constructor.__bjsclassName__,K=b.constructor.__bjsmoduleName__}j||(j=typeof Z)}return j?(null!=K?K+".":"")+j:null},Z.DelayAsync=function(Z){return new Promise((function(M){setTimeout((function(){M()}),Z)}))},Z.IsSafari=function(){return!!(0,g.n)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},Z.UseCustomRequestHeaders=!1,Z.CustomRequestHeaders=E.e.CustomRequestHeaders,Z._TmpFloatArray=new Float32Array(1),Z.GetDOMTextContent=g.g,Z.GetAbsoluteUrl="object"===typeof document?function(Z){var M=document.createElement("a");return M.href=Z,M.href}:"function"===typeof URL&&"object"===typeof location?function(Z){return new URL(Z,location.origin).href}:function(){throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},Z.NoneLogLevel=O.c.NoneLogLevel,Z.MessageLogLevel=O.c.MessageLogLevel,Z.WarningLogLevel=O.c.WarningLogLevel,Z.ErrorLogLevel=O.c.ErrorLogLevel,Z.AllLogLevel=O.c.AllLogLevel,Z.IsWindowObjectExist=g.q,Z.PerformanceNoneLogLevel=0,Z.PerformanceUserMarkLogLevel=1,Z.PerformanceConsoleLogLevel=2,Z.StartPerformanceCounter=Z._StartPerformanceCounterDisabled,Z.EndPerformanceCounter=Z._EndPerformanceCounterDisabled,Z}();var c=function(){function Z(Z,M,j,K){void 0===K&&(K=0),this.iterations=Z,this.index=K-1,this._done=!1,this._fn=M,this._successCallback=j}return Z.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},Z.prototype.breakLoop=function(){this._done=!0,this._successCallback()},Z.Run=function(M,j,K,b){void 0===b&&(b=0);var g=new Z(M,j,K,b);return g.executeNext(),g},Z.SyncAsyncForLoop=function(M,j,K,b,g,O){return void 0===O&&(O=0),Z.Run(Math.ceil(M/j),(function(Z){g&&g()?Z.breakLoop():setTimeout((function(){for(var b=0;b<j;++b){var O=Z.index*j+b;if(O>=M)break;if(K(O),g&&g()){Z.breakLoop();break}}Z.executeNext()}),O)}),b)},Z}();s.e.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},31709:function(Z,M,j){"use strict";j.d(M,{b:function(){return g},c:function(){return b}});var K={};function b(Z,M){K[Z]=M}function g(Z){return K[Z]}},45934:function(Z,M,j){"use strict";j.d(M,{c:function(){return K}});var K=function(){function Z(){}return Object.defineProperty(Z,"UniqueId",{get:function(){var Z=this._UniqueIdCounter;return this._UniqueIdCounter++,Z},enumerable:!1,configurable:!0}),Z._UniqueIdCounter=1,Z}()},67935:function(Z,M,j){"use strict";j.d(M,{e:function(){return K}});var K=function(){function Z(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}return Z.prototype._injectCustomRequestHeaders=function(){if(!this._shouldSkipRequestModifications(this._requestURL))for(var M in Z.CustomRequestHeaders){var j=Z.CustomRequestHeaders[M];j&&this._xhr.setRequestHeader(M,j)}},Z.prototype._shouldSkipRequestModifications=function(M){return Z.SkipRequestModificationForBabylonCDN&&(M.includes("preview.babylonjs.com")||M.includes("cdn.babylonjs.com"))},Object.defineProperty(Z.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(Z){this._xhr.onprogress=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(Z){this._xhr.responseType=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"timeout",{get:function(){return this._xhr.timeout},set:function(Z){this._xhr.timeout=Z},enumerable:!1,configurable:!0}),Z.prototype.addEventListener=function(Z,M,j){this._xhr.addEventListener(Z,M,j)},Z.prototype.removeEventListener=function(Z,M,j){this._xhr.removeEventListener(Z,M,j)},Z.prototype.abort=function(){this._xhr.abort()},Z.prototype.send=function(M){Z.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(M)},Z.prototype.open=function(M,j){for(var K=0,b=Z.CustomRequestModifiers;K<b.length;K++){var g=b[K];if(this._shouldSkipRequestModifications(j))return;g(this._xhr,j)}return j=(j=j.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=j,this._xhr.open(M,j,!0)},Z.prototype.setRequestHeader=function(Z,M){this._xhr.setRequestHeader(Z,M)},Z.prototype.getResponseHeader=function(Z){return this._xhr.getResponseHeader(Z)},Z.CustomRequestHeaders={},Z.CustomRequestModifiers=new Array,Z.SkipRequestModificationForBabylonCDN=!0,Z}()},44811:function(Z,M,j){"use strict";j.d(M,{e:function(){return KZ}});var K=j(80105),b=j(23016),g=j(51004),O=j(96658),Q=function(){function Z(){this.direction1=new K.k(0,1,0),this.direction2=new K.k(0,1,0),this.minEmitBox=new K.k(-.5,-.5,-.5),this.maxEmitBox=new K.k(.5,.5,.5)}return Z.prototype.startDirectionFunction=function(Z,M,j,b){var g=O.b.RandomRange(this.direction1.x,this.direction2.x),Q=O.b.RandomRange(this.direction1.y,this.direction2.y),Y=O.b.RandomRange(this.direction1.z,this.direction2.z);if(b)return M.x=g,M.y=Q,void(M.z=Y);K.k.TransformNormalFromFloatsToRef(g,Q,Y,Z,M)},Z.prototype.startPositionFunction=function(Z,M,j,b){var g=O.b.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),Q=O.b.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),Y=O.b.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);if(b)return M.x=g,M.y=Q,void(M.z=Y);K.k.TransformCoordinatesFromFloatsToRef(g,Q,Y,Z,M)},Z.prototype.clone=function(){var M=new Z;return g.d.DeepCopy(this,M),M},Z.prototype.applyToShader=function(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2),Z.setVector3("minEmitBox",this.minEmitBox),Z.setVector3("maxEmitBox",this.maxEmitBox)},Z.prototype.buildUniformLayout=function(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3),Z.addUniform("minEmitBox",3),Z.addUniform("maxEmitBox",3)},Z.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},Z.prototype.getClassName=function(){return"BoxParticleEmitter"},Z.prototype.serialize=function(){var Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.asArray(),Z.direction2=this.direction2.asArray(),Z.minEmitBox=this.minEmitBox.asArray(),Z.maxEmitBox=this.maxEmitBox.asArray(),Z},Z.prototype.parse=function(Z){K.k.FromArrayToRef(Z.direction1,0,this.direction1),K.k.FromArrayToRef(Z.direction2,0,this.direction2),K.k.FromArrayToRef(Z.minEmitBox,0,this.minEmitBox),K.k.FromArrayToRef(Z.maxEmitBox,0,this.maxEmitBox)},Z}(),Y=function(){function Z(Z,M,j){void 0===Z&&(Z=1),void 0===M&&(M=Math.PI),void 0===j&&(j=0),this.directionRandomizer=j,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=M,this.radius=Z}return Object.defineProperty(Z.prototype,"radius",{get:function(){return this._radius},set:function(Z){this._radius=Z,this._buildHeight()},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"angle",{get:function(){return this._angle},set:function(Z){this._angle=Z,this._buildHeight()},enumerable:!1,configurable:!0}),Z.prototype._buildHeight=function(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1},Z.prototype.startDirectionFunction=function(Z,M,j,b){b?K.e.Vector3[0].copyFrom(j._localPosition).normalize():j.position.subtractToRef(Z.getTranslation(),K.e.Vector3[0]).normalize();var g=O.b.RandomRange(0,this.directionRandomizer),Q=O.b.RandomRange(0,this.directionRandomizer),Y=O.b.RandomRange(0,this.directionRandomizer);M.x=K.e.Vector3[0].x+g,M.y=K.e.Vector3[0].y+Q,M.z=K.e.Vector3[0].z+Y,M.normalize()},Z.prototype.startPositionFunction=function(Z,M,j,b){var g,Q=O.b.RandomRange(0,2*Math.PI);g=this.emitFromSpawnPointOnly?1e-4:1-(g=O.b.RandomRange(0,this.heightRange))*g;var Y=this._radius-O.b.RandomRange(0,this._radius*this.radiusRange),I=(Y*=g)*Math.sin(Q),E=Y*Math.cos(Q),s=g*this._height;if(b)return M.x=I,M.y=s,void(M.z=E);K.k.TransformCoordinatesFromFloatsToRef(I,s,E,Z,M)},Z.prototype.clone=function(){var M=new Z(this._radius,this._angle,this.directionRandomizer);return g.d.DeepCopy(this,M),M},Z.prototype.applyToShader=function(Z){Z.setFloat2("radius",this._radius,this.radiusRange),Z.setFloat("coneAngle",this._angle),Z.setFloat2("height",this._height,this.heightRange),Z.setFloat("directionRandomizer",this.directionRandomizer)},Z.prototype.buildUniformLayout=function(Z){Z.addUniform("radius",2),Z.addUniform("coneAngle",1),Z.addUniform("height",2),Z.addUniform("directionRandomizer",1)},Z.prototype.getEffectDefines=function(){var Z="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(Z+="\n#define CONEEMITTERSPAWNPOINT"),Z},Z.prototype.getClassName=function(){return"ConeParticleEmitter"},Z.prototype.serialize=function(){var Z={};return Z.type=this.getClassName(),Z.radius=this._radius,Z.angle=this._angle,Z.directionRandomizer=this.directionRandomizer,Z.radiusRange=this.radiusRange,Z.heightRange=this.heightRange,Z.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,Z},Z.prototype.parse=function(Z){this.radius=Z.radius,this.angle=Z.angle,this.directionRandomizer=Z.directionRandomizer,this.radiusRange=void 0!==Z.radiusRange?Z.radiusRange:1,this.heightRange=void 0!==Z.radiusRange?Z.heightRange:1,this.emitFromSpawnPointOnly=void 0!==Z.emitFromSpawnPointOnly&&Z.emitFromSpawnPointOnly},Z}(),I=j(40061),E=function(){function Z(Z,M,j,b){void 0===Z&&(Z=1),void 0===M&&(M=1),void 0===j&&(j=1),void 0===b&&(b=0),this.radius=Z,this.height=M,this.radiusRange=j,this.directionRandomizer=b,this._tempVector=K.k.Zero()}return Z.prototype.startDirectionFunction=function(Z,M,j,b,g){j.position.subtractToRef(Z.getTranslation(),this._tempVector),this._tempVector.normalize(),K.k.TransformNormalToRef(this._tempVector,g,this._tempVector);var Q=O.b.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=O.b.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Q,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),b?M.copyFrom(this._tempVector):K.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z,M)},Z.prototype.startPositionFunction=function(Z,M,j,b){var g=O.b.RandomRange(-this.height/2,this.height/2),Q=O.b.RandomRange(0,2*Math.PI),Y=O.b.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),I=Math.sqrt(Y)*this.radius,E=I*Math.cos(Q),s=I*Math.sin(Q);b?M.copyFromFloats(E,g,s):K.k.TransformCoordinatesFromFloatsToRef(E,g,s,Z,M)},Z.prototype.clone=function(){var M=new Z(this.radius,this.directionRandomizer);return g.d.DeepCopy(this,M),M},Z.prototype.applyToShader=function(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)},Z.prototype.buildUniformLayout=function(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)},Z.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},Z.prototype.getClassName=function(){return"CylinderParticleEmitter"},Z.prototype.serialize=function(){var Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.height=this.height,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z},Z.prototype.parse=function(Z){this.radius=Z.radius,this.height=Z.height,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer},Z}(),s=function(Z){function M(M,j,b,g,O){void 0===M&&(M=1),void 0===j&&(j=1),void 0===b&&(b=1),void 0===g&&(g=new K.k(0,1,0)),void 0===O&&(O=new K.k(0,1,0));var Q=Z.call(this,M,j,b)||this;return Q.direction1=g,Q.direction2=O,Q}return(0,I.m)(M,Z),M.prototype.startDirectionFunction=function(Z,M){var j=O.b.RandomRange(this.direction1.x,this.direction2.x),b=O.b.RandomRange(this.direction1.y,this.direction2.y),g=O.b.RandomRange(this.direction1.z,this.direction2.z);K.k.TransformNormalFromFloatsToRef(j,b,g,Z,M)},M.prototype.clone=function(){var Z=new M(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return g.d.DeepCopy(this,Z),Z},M.prototype.applyToShader=function(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)},M.prototype.buildUniformLayout=function(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)},M.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"},M.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},M.prototype.serialize=function(){var M=Z.prototype.serialize.call(this);return M.direction1=this.direction1.asArray(),M.direction2=this.direction2.asArray(),M},M.prototype.parse=function(M){Z.prototype.parse.call(this,M),this.direction1.copyFrom(M.direction1),this.direction2.copyFrom(M.direction2)},M}(E),i=function(){function Z(Z,M,j){void 0===Z&&(Z=1),void 0===M&&(M=1),void 0===j&&(j=0),this.radius=Z,this.radiusRange=M,this.directionRandomizer=j}return Z.prototype.startDirectionFunction=function(Z,M,j,b){var g=j.position.subtract(Z.getTranslation()).normalize(),Q=O.b.RandomRange(0,this.directionRandomizer),Y=O.b.RandomRange(0,this.directionRandomizer),I=O.b.RandomRange(0,this.directionRandomizer);g.x+=Q,g.y+=Y,g.z+=I,g.normalize(),b?M.copyFrom(g):K.k.TransformNormalFromFloatsToRef(g.x,g.y,g.z,Z,M)},Z.prototype.startPositionFunction=function(Z,M,j,b){var g=this.radius-O.b.RandomRange(0,this.radius*this.radiusRange),Q=O.b.RandomRange(0,1),Y=O.b.RandomRange(0,2*Math.PI),I=Math.acos(2*Q-1),E=g*Math.cos(Y)*Math.sin(I),s=g*Math.cos(I),i=g*Math.sin(Y)*Math.sin(I);b?M.copyFromFloats(E,Math.abs(s),i):K.k.TransformCoordinatesFromFloatsToRef(E,Math.abs(s),i,Z,M)},Z.prototype.clone=function(){var M=new Z(this.radius,this.directionRandomizer);return g.d.DeepCopy(this,M),M},Z.prototype.applyToShader=function(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)},Z.prototype.buildUniformLayout=function(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)},Z.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},Z.prototype.getClassName=function(){return"HemisphericParticleEmitter"},Z.prototype.serialize=function(){var Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z},Z.prototype.parse=function(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer},Z}(),a=function(){function Z(){this.direction1=new K.k(0,1,0),this.direction2=new K.k(0,1,0)}return Z.prototype.startDirectionFunction=function(Z,M,j,b){var g=O.b.RandomRange(this.direction1.x,this.direction2.x),Q=O.b.RandomRange(this.direction1.y,this.direction2.y),Y=O.b.RandomRange(this.direction1.z,this.direction2.z);b?M.copyFromFloats(g,Q,Y):K.k.TransformNormalFromFloatsToRef(g,Q,Y,Z,M)},Z.prototype.startPositionFunction=function(Z,M,j,b){b?M.copyFromFloats(0,0,0):K.k.TransformCoordinatesFromFloatsToRef(0,0,0,Z,M)},Z.prototype.clone=function(){var M=new Z;return g.d.DeepCopy(this,M),M},Z.prototype.applyToShader=function(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)},Z.prototype.buildUniformLayout=function(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)},Z.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},Z.prototype.getClassName=function(){return"PointParticleEmitter"},Z.prototype.serialize=function(){var Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.asArray(),Z.direction2=this.direction2.asArray(),Z},Z.prototype.parse=function(Z){K.k.FromArrayToRef(Z.direction1,0,this.direction1),K.k.FromArrayToRef(Z.direction2,0,this.direction2)},Z}(),z=function(){function Z(Z,M,j){void 0===Z&&(Z=1),void 0===M&&(M=1),void 0===j&&(j=0),this.radius=Z,this.radiusRange=M,this.directionRandomizer=j}return Z.prototype.startDirectionFunction=function(Z,M,j,b){var g=j.position.subtract(Z.getTranslation()).normalize(),Q=O.b.RandomRange(0,this.directionRandomizer),Y=O.b.RandomRange(0,this.directionRandomizer),I=O.b.RandomRange(0,this.directionRandomizer);g.x+=Q,g.y+=Y,g.z+=I,g.normalize(),b?M.copyFrom(g):K.k.TransformNormalFromFloatsToRef(g.x,g.y,g.z,Z,M)},Z.prototype.startPositionFunction=function(Z,M,j,b){var g=this.radius-O.b.RandomRange(0,this.radius*this.radiusRange),Q=O.b.RandomRange(0,1),Y=O.b.RandomRange(0,2*Math.PI),I=Math.acos(2*Q-1),E=g*Math.cos(Y)*Math.sin(I),s=g*Math.cos(I),i=g*Math.sin(Y)*Math.sin(I);b?M.copyFromFloats(E,s,i):K.k.TransformCoordinatesFromFloatsToRef(E,s,i,Z,M)},Z.prototype.clone=function(){var M=new Z(this.radius,this.directionRandomizer);return g.d.DeepCopy(this,M),M},Z.prototype.applyToShader=function(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)},Z.prototype.buildUniformLayout=function(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)},Z.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},Z.prototype.getClassName=function(){return"SphereParticleEmitter"},Z.prototype.serialize=function(){var Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z},Z.prototype.parse=function(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer},Z}(),V=function(Z){function M(M,j,b){void 0===M&&(M=1),void 0===j&&(j=new K.k(0,1,0)),void 0===b&&(b=new K.k(0,1,0));var g=Z.call(this,M)||this;return g.direction1=j,g.direction2=b,g}return(0,I.m)(M,Z),M.prototype.startDirectionFunction=function(Z,M){var j=O.b.RandomRange(this.direction1.x,this.direction2.x),b=O.b.RandomRange(this.direction1.y,this.direction2.y),g=O.b.RandomRange(this.direction1.z,this.direction2.z);K.k.TransformNormalFromFloatsToRef(j,b,g,Z,M)},M.prototype.clone=function(){var Z=new M(this.radius,this.direction1,this.direction2);return g.d.DeepCopy(this,Z),Z},M.prototype.applyToShader=function(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)},M.prototype.buildUniformLayout=function(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)},M.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"},M.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},M.prototype.serialize=function(){var M=Z.prototype.serialize.call(this);return M.direction1=this.direction1.asArray(),M.direction2=this.direction2.asArray(),M},M.prototype.parse=function(M){Z.prototype.parse.call(this,M),this.direction1.copyFrom(M.direction1),this.direction2.copyFrom(M.direction2)},M}(z),o=function(){function Z(){this.particlePositionGenerator=function(){},this.particleDestinationGenerator=function(){}}return Z.prototype.startDirectionFunction=function(Z,M,j,b){var g=K.e.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,j,g);var O=K.e.Vector3[1];g.subtractToRef(j.position,O),O.scaleToRef(1/j.lifeTime,g)}else g.set(0,0,0);b?M.copyFrom(g):K.k.TransformNormalToRef(g,Z,M)},Z.prototype.startPositionFunction=function(Z,M,j,b){var g=K.e.Vector3[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,j,g):g.set(0,0,0),b?M.copyFrom(g):K.k.TransformCoordinatesToRef(g,Z,M)},Z.prototype.clone=function(){var M=new Z;return g.d.DeepCopy(this,M),M},Z.prototype.applyToShader=function(Z){},Z.prototype.buildUniformLayout=function(Z){},Z.prototype.getEffectDefines=function(){return"#define CUSTOMEMITTER"},Z.prototype.getClassName=function(){return"CustomParticleEmitter"},Z.prototype.serialize=function(){var Z={};return Z.type=this.getClassName(),Z},Z.prototype.parse=function(Z){},Z}(),c=j(43251),G=function(){function Z(Z){void 0===Z&&(Z=null),this._indices=null,this._positions=null,this._normals=null,this._storedNormal=K.k.Zero(),this._mesh=null,this.direction1=new K.k(0,1,0),this.direction2=new K.k(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=Z}return Object.defineProperty(Z.prototype,"mesh",{get:function(){return this._mesh},set:function(Z){this._mesh!==Z&&(this._mesh=Z,Z?(this._indices=Z.getIndices(),this._positions=Z.getVerticesData(c.f.PositionKind),this._normals=Z.getVerticesData(c.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))},enumerable:!1,configurable:!0}),Z.prototype.startDirectionFunction=function(Z,M,j,b){if(this.useMeshNormalsForDirection&&this._normals)K.k.TransformNormalToRef(this._storedNormal,Z,M);else{var g=O.b.RandomRange(this.direction1.x,this.direction2.x),Q=O.b.RandomRange(this.direction1.y,this.direction2.y),Y=O.b.RandomRange(this.direction1.z,this.direction2.z);b?M.copyFromFloats(g,Q,Y):K.k.TransformNormalFromFloatsToRef(g,Q,Y,Z,M)}},Z.prototype.startPositionFunction=function(Z,M,j,b){if(this._indices&&this._positions){var g=3*Math.random()*(this._indices.length/3)|0,O=Math.random(),Q=Math.random()*(1-O),Y=1-O-Q,I=this._indices[g],E=this._indices[g+1],s=this._indices[g+2],i=K.e.Vector3[0],a=K.e.Vector3[1],z=K.e.Vector3[2],V=K.e.Vector3[3];K.k.FromArrayToRef(this._positions,3*I,i),K.k.FromArrayToRef(this._positions,3*E,a),K.k.FromArrayToRef(this._positions,3*s,z),V.x=O*i.x+Q*a.x+Y*z.x,V.y=O*i.y+Q*a.y+Y*z.y,V.z=O*i.z+Q*a.z+Y*z.z,b?M.copyFromFloats(V.x,V.y,V.z):K.k.TransformCoordinatesFromFloatsToRef(V.x,V.y,V.z,Z,M),this.useMeshNormalsForDirection&&this._normals&&(K.k.FromArrayToRef(this._normals,3*I,i),K.k.FromArrayToRef(this._normals,3*E,a),K.k.FromArrayToRef(this._normals,3*s,z),this._storedNormal.x=O*i.x+Q*a.x+Y*z.x,this._storedNormal.y=O*i.y+Q*a.y+Y*z.y,this._storedNormal.z=O*i.z+Q*a.z+Y*z.z)}},Z.prototype.clone=function(){var M=new Z(this.mesh);return g.d.DeepCopy(this,M),M},Z.prototype.applyToShader=function(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)},Z.prototype.buildUniformLayout=function(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)},Z.prototype.getEffectDefines=function(){return""},Z.prototype.getClassName=function(){return"MeshParticleEmitter"},Z.prototype.serialize=function(){var Z,M={};return M.type=this.getClassName(),M.direction1=this.direction1.asArray(),M.direction2=this.direction2.asArray(),M.meshId=null===(Z=this.mesh)||void 0===Z?void 0:Z.id,M.useMeshNormalsForDirection=this.useMeshNormalsForDirection,M},Z.prototype.parse=function(Z,M){K.k.FromArrayToRef(Z.direction1,0,this.direction1),K.k.FromArrayToRef(Z.direction2,0,this.direction2),Z.meshId&&M&&(this.mesh=M.getLastMeshById(Z.meshId)),this.useMeshNormalsForDirection=Z.useMeshNormalsForDirection},Z}(),f=j(9488),X=(j(37855),function(){function Z(M){this.animations=[],this.renderingGroupId=0,this.emitter=K.k.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this._rootUrl="",this.noiseStrength=new K.k(10,10,10),this.onAnimationEnd=null,this.blendMode=Z.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new K.h(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new K.k(0,0,0),this.gravity=K.k.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new f.g(1,1,1,1),this.color2=new f.g(1,1,1,1),this.colorDead=new f.g(0,0,0,1),this.textureMask=new f.g(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new b.b,this.id=M,this.name=M}return Object.defineProperty(Z.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(Z){this._noiseTexture!==Z&&(this._noiseTexture=Z,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(Z){this._isAnimationSheetEnabled!=Z&&(this._isAnimationSheetEnabled=Z,this._reset())},enumerable:!1,configurable:!0}),Z.prototype.getScene=function(){return this._scene},Z.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},Z.prototype.getDragGradients=function(){return this._dragGradients},Z.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},Z.prototype.getColorGradients=function(){return this._colorGradients},Z.prototype.getSizeGradients=function(){return this._sizeGradients},Z.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},Z.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},Z.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},Z.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},Z.prototype.getVelocityGradients=function(){return this._velocityGradients},Z.prototype.getStartSizeGradients=function(){return this._startSizeGradients},Z.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(Z.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:K.k.Zero()},set:function(Z){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:K.k.Zero()},set:function(Z){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:K.k.Zero()},set:function(Z){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:K.k.Zero()},set:function(Z){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(Z){this._billboardMode!==Z&&(this._billboardMode=Z,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(Z){this._isBillboardBased!==Z&&(this._isBillboardBased=Z,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(Z){this._attachImageProcessingConfiguration(Z)},enumerable:!1,configurable:!0}),Z.prototype._attachImageProcessingConfiguration=function(Z){Z!==this._imageProcessingConfiguration&&(!Z&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=Z)},Z.prototype._reset=function(){},Z.prototype._removeGradientAndTexture=function(Z,M,j){if(!M)return this;for(var K=0,b=0,g=M;b<g.length;b++){if(g[b].gradient===Z){M.splice(K,1);break}K++}return j&&j.dispose(),this},Z.prototype.createPointEmitter=function(Z,M){var j=new a;return j.direction1=Z,j.direction2=M,this.particleEmitterType=j,j},Z.prototype.createHemisphericEmitter=function(Z,M){void 0===Z&&(Z=1),void 0===M&&(M=1);var j=new i(Z,M);return this.particleEmitterType=j,j},Z.prototype.createSphereEmitter=function(Z,M){void 0===Z&&(Z=1),void 0===M&&(M=1);var j=new z(Z,M);return this.particleEmitterType=j,j},Z.prototype.createDirectedSphereEmitter=function(Z,M,j){void 0===Z&&(Z=1),void 0===M&&(M=new K.k(0,1,0)),void 0===j&&(j=new K.k(0,1,0));var b=new V(Z,M,j);return this.particleEmitterType=b,b},Z.prototype.createCylinderEmitter=function(Z,M,j,K){void 0===Z&&(Z=1),void 0===M&&(M=1),void 0===j&&(j=1),void 0===K&&(K=0);var b=new E(Z,M,j,K);return this.particleEmitterType=b,b},Z.prototype.createDirectedCylinderEmitter=function(Z,M,j,b,g){void 0===Z&&(Z=1),void 0===M&&(M=1),void 0===j&&(j=1),void 0===b&&(b=new K.k(0,1,0)),void 0===g&&(g=new K.k(0,1,0));var O=new s(Z,M,j,b,g);return this.particleEmitterType=O,O},Z.prototype.createConeEmitter=function(Z,M){void 0===Z&&(Z=1),void 0===M&&(M=Math.PI/4);var j=new Y(Z,M);return this.particleEmitterType=j,j},Z.prototype.createBoxEmitter=function(Z,M,j,K){var b=new Q;return this.particleEmitterType=b,this.direction1=Z,this.direction2=M,this.minEmitBox=j,this.maxEmitBox=K,b},Z.BLENDMODE_ONEONE=0,Z.BLENDMODE_STANDARD=1,Z.BLENDMODE_ADD=2,Z.BLENDMODE_MULTIPLY=3,Z.BLENDMODE_MULTIPLYADD=4,Z}()),d=j(90559),W=function(){function Z(Z){this._isUbo(Z)?(this.setMatrix3x3=Z.updateMatrix3x3.bind(Z),this.setMatrix2x2=Z.updateMatrix2x2.bind(Z),this.setFloat=Z.updateFloat.bind(Z),this.setFloat2=Z.updateFloat2.bind(Z),this.setFloat3=Z.updateFloat3.bind(Z),this.setFloat4=Z.updateFloat4.bind(Z),this.setFloatArray=Z.updateFloatArray.bind(Z),this.setArray=Z.updateArray.bind(Z),this.setIntArray=Z.updateIntArray.bind(Z),this.setMatrix=Z.updateMatrix.bind(Z),this.setMatrices=Z.updateMatrices.bind(Z),this.setVector3=Z.updateVector3.bind(Z),this.setVector4=Z.updateVector4.bind(Z),this.setColor3=Z.updateColor3.bind(Z),this.setColor4=Z.updateColor4.bind(Z),this.setDirectColor4=Z.updateDirectColor4.bind(Z),this.setInt=Z.updateInt.bind(Z),this.setInt2=Z.updateInt2.bind(Z),this.setInt3=Z.updateInt3.bind(Z),this.setInt4=Z.updateInt4.bind(Z)):(this.setMatrix3x3=Z.setMatrix3x3.bind(Z),this.setMatrix2x2=Z.setMatrix2x2.bind(Z),this.setFloat=Z.setFloat.bind(Z),this.setFloat2=Z.setFloat2.bind(Z),this.setFloat3=Z.setFloat3.bind(Z),this.setFloat4=Z.setFloat4.bind(Z),this.setFloatArray=Z.setFloatArray.bind(Z),this.setArray=Z.setArray.bind(Z),this.setIntArray=Z.setIntArray.bind(Z),this.setMatrix=Z.setMatrix.bind(Z),this.setMatrices=Z.setMatrices.bind(Z),this.setVector3=Z.setVector3.bind(Z),this.setVector4=Z.setVector4.bind(Z),this.setColor3=Z.setColor3.bind(Z),this.setColor4=Z.setColor4.bind(Z),this.setDirectColor4=Z.setDirectColor4.bind(Z),this.setInt=Z.setInt.bind(Z),this.setInt2=Z.setInt2.bind(Z),this.setInt3=Z.setInt3.bind(Z),this.setInt4=Z.setInt4.bind(Z))}return Z.prototype._isUbo=function(Z){return void 0!==Z.addUniform},Z}(),A=j(31709),q=j(16179),T="#version 300 es\nvoid main() {\ndiscard;\n}\n";q.d.ShadersStore.gpuUpdateParticlesPixelShader=T;var B="#version 300 es\n#define PI 3.14159\nuniform float currentCount;\nuniform float timeDelta;\nuniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;\nuniform vec2 emitPower;\nuniform vec2 sizeRange;\nuniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;\nuniform vec4 color2;\n#endif\nuniform vec3 gravity;\nuniform sampler2D randomSampler;\nuniform sampler2D randomSampler2;\nuniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\nuniform vec3 minEmitBox;\nuniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;\nuniform float radiusRange;\nuniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;\nuniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;\nuniform float height;\nuniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;\nuniform float coneAngle;\nuniform vec2 height;\nuniform float directionRandomizer;\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;\nin float life;\nin vec4 seed;\nin vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;\nin vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;\nout float outLife;\nout vec4 outSeed;\nout vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;\nout vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;\nuniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;\nuniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {\nreturn texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;\n}\nvec4 getRandomVec4(float offset) {\nreturn texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));\n}\nvoid main() {\nfloat newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {\nvec3 newPosition;\nvec3 newDirection;\nvec4 randoms=getRandomVec4(seed.x);\noutLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;\noutAge=newAge-life;\noutSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;\noutSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;\noutAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nnewPosition=vec3(0,0,0);\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nnewPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;\nnewDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nnewPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);\nnewDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nnewPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nfloat yPos=(randoms2.x-0.5)*height;\nfloat angle=randoms2.y*PI*2.;\nfloat inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));\nfloat positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));\nfloat xPos=positionRadius*cos(angle);\nfloat zPos=positionRadius*sin(angle);\nnewPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;\nnewDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));\nnewDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nfloat s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;\nh=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;\nlRadius=lRadius*h;\nfloat randX=lRadius*sin(s);\nfloat randZ=lRadius*cos(s);\nfloat randY=h *height.x;\nnewPosition=vec3(randX,randY,randZ); \nif (abs(cos(coneAngle))==1.0) {\nnewDirection=vec3(0.,1.0,0.);\n} else {\nvec3 randoms3=getRandomVec3(seed.z);\nnewDirection=normalize(newPosition+directionRandomizer*randoms3); \n}\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;\noutInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);\nnewDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {\nfloat directionScale=timeDelta;\noutAge=newAge;\nfloat ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;\noutSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;\noutSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;\nfloat currentVelocity=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*limitVelocityDamping;\n}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;\nvec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;\noutDirection=outDirection+force*timeDelta;\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;\noutAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;\nfloat dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;\noffsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;\nif (cellInfos.w==1.0) {\nratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);\n}\nelse {\nratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);\n}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}\n}";q.d.ShadersStore.gpuUpdateParticlesVertexShader=B;var N=function(){function Z(Z,M){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=Z,this._engine=M,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}return Z.prototype.isUpdateBufferCreated=function(){return!!this._updateEffect},Z.prototype.isUpdateBufferReady=function(){var Z,M;return null!==(M=null===(Z=this._updateEffect)||void 0===Z?void 0:Z.isReady())&&void 0!==M&&M},Z.prototype.createUpdateBuffer=function(Z){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof o&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=Z,this._updateEffect=new d.e("gpuUpdateParticles",this._updateEffectOptions,this._engine),new W(this._updateEffect)},Z.prototype.createVertexBuffers=function(Z,M){this._updateVAO.push(this._createUpdateVAO(Z)),this._renderVAO.push(this._engine.recordVertexArrayObject(M,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null)},Z.prototype.createParticleBuffer=function(Z){return Z},Z.prototype.bindDrawBuffers=function(Z){this._engine.bindVertexArrayObject(this._renderVAO[Z],null)},Z.prototype.preUpdateParticleBuffer=function(){var Z=this._engine;if(this._engine.enableEffect(this._updateEffect),!Z.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")},Z.prototype.updateParticleBuffer=function(Z,M,j){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[Z],null);var K=this._engine;K.bindTransformFeedbackBuffer(M.getBuffer()),K.setRasterizerState(!1),K.beginTransformFeedback(!0),K.drawArraysType(3,0,j),K.endTransformFeedback(),K.setRasterizerState(!0),K.bindTransformFeedbackBuffer(null)},Z.prototype.releaseBuffers=function(){},Z.prototype.releaseVertexBuffers=function(){for(var Z=0;Z<this._updateVAO.length;Z++)this._engine.releaseVertexArrayObject(this._updateVAO[Z]);this._updateVAO=[];for(Z=0;Z<this._renderVAO.length;Z++)this._engine.releaseVertexArrayObject(this._renderVAO[Z]);this._renderVAO=[]},Z.prototype._createUpdateVAO=function(Z){var M={};M.position=Z.createVertexBuffer("position",0,3);var j=3;M.age=Z.createVertexBuffer("age",j,1),j+=1,M.size=Z.createVertexBuffer("size",j,3),j+=3,M.life=Z.createVertexBuffer("life",j,1),j+=1,M.seed=Z.createVertexBuffer("seed",j,4),j+=4,M.direction=Z.createVertexBuffer("direction",j,3),j+=3,this._parent.particleEmitterType instanceof o&&(M.initialPosition=Z.createVertexBuffer("initialPosition",j,3),j+=3),this._parent._colorGradientsTexture||(M.color=Z.createVertexBuffer("color",j,4),j+=4),this._parent._isBillboardBased||(M.initialDirection=Z.createVertexBuffer("initialDirection",j,3),j+=3),this._parent.noiseTexture&&(M.noiseCoordinates1=Z.createVertexBuffer("noiseCoordinates1",j,3),j+=3,M.noiseCoordinates2=Z.createVertexBuffer("noiseCoordinates2",j,3),j+=3),this._parent._angularSpeedGradientsTexture?(M.angle=Z.createVertexBuffer("angle",j,1),j+=1):(M.angle=Z.createVertexBuffer("angle",j,2),j+=2),this._parent._isAnimationSheetEnabled&&(M.cellIndex=Z.createVertexBuffer("cellIndex",j,1),j+=1,this._parent.spriteRandomStartCell&&(M.cellStartOffset=Z.createVertexBuffer("cellStartOffset",j,1),j+=1));var K=this._engine.recordVertexArrayObject(M,null,this._updateEffect);return this._engine.bindArrayBuffer(null),K},Z}();(0,A.c)("BABYLON.WebGL2ParticleSystem",N);var U,n=function(){function Z(Z,M,j){void 0===j&&(j=3),this._engine=Z,this._engine._storageBuffers.push(this),this._create(M,j)}return Z.prototype._create=function(Z,M){this._bufferSize=Z,this._creationFlags=M,this._buffer=this._engine.createStorageBuffer(Z,M)},Z.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)},Z.prototype.getBuffer=function(){return this._buffer},Z.prototype.update=function(Z,M,j){this._buffer&&this._engine.updateStorageBuffer(this._buffer,Z,M,j)},Z.prototype.read=function(Z,M,j){return this._engine.readFromStorageBuffer(this._buffer,Z,M,j)},Z.prototype.dispose=function(){var Z=this._engine._storageBuffers,M=Z.indexOf(this);-1!==M&&(Z[M]=Z[Z.length-1],Z.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null},Z}(),k=j(9892),x=j(72284);!function(Z){Z[Z.Texture=0]="Texture",Z[Z.StorageTexture=1]="StorageTexture",Z[Z.UniformBuffer=2]="UniformBuffer",Z[Z.StorageBuffer=3]="StorageBuffer",Z[Z.TextureWithoutSampler=4]="TextureWithoutSampler",Z[Z.Sampler=5]="Sampler"}(U||(U={})),x.d.prototype.createComputeEffect=function(Z,M){throw new Error("createComputeEffect: This engine does not support compute shaders!")},x.d.prototype.createComputePipelineContext=function(){throw new Error("createComputePipelineContext: This engine does not support compute shaders!")},x.d.prototype.createComputeContext=function(){},x.d.prototype.computeDispatch=function(Z,M,j,K,b,g,O){throw new Error("computeDispatch: This engine does not support compute shaders!")},x.d.prototype.areAllComputeEffectsReady=function(){return!0},x.d.prototype.releaseComputeEffects=function(){},x.d.prototype._prepareComputePipelineContext=function(Z,M,j,K,b){},x.d.prototype._rebuildComputeEffects=function(){},x.d.prototype._executeWhenComputeStateIsCompiled=function(Z,M){M()},x.d.prototype._releaseComputeEffect=function(Z){},x.d.prototype._deleteComputePipelineContext=function(Z){};var R=j(70937),e=j(45934),u=j(9127),F=j(80150),C=function(){function Z(Z,M,j,K){void 0===K&&(K={}),this._bindings={},this._samplers={},this._contextIsDirty=!1,this.onCompiled=null,this.onError=null,this.name=Z,this._engine=M,this.uniqueId=e.c.UniqueId,this._engine.getCaps().supportComputeShaders?K.bindingsMapping?(this._context=M.createComputeContext(),this._shaderPath=j,this._options=(0,I.e)({bindingsMapping:{},defines:[]},K)):u.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):u.c.Error("This engine does not support compute shaders!")}return Object.defineProperty(Z.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"shaderPath",{get:function(){return this._shaderPath},enumerable:!1,configurable:!0}),Z.prototype.getClassName=function(){return"ComputeShader"},Z.prototype.setTexture=function(Z,M,j){void 0===j&&(j=!0);var K=this._bindings[Z];this._bindings[Z]={type:j?U.Texture:U.TextureWithoutSampler,object:M,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!K||K.object!==M||K.type!==this._bindings[Z].type)},Z.prototype.setStorageTexture=function(Z,M){var j=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==M),this._bindings[Z]={type:U.StorageTexture,object:M,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}},Z.prototype.setUniformBuffer=function(Z,M){var j=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==M),this._bindings[Z]={type:U.UniformBuffer,object:M,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}},Z.prototype.setStorageBuffer=function(Z,M){var j=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==M),this._bindings[Z]={type:U.StorageBuffer,object:M,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}},Z.prototype.setTextureSampler=function(Z,M){var j=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!j||!M.compareSampler(j.object)),this._bindings[Z]={type:U.Sampler,object:M,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}},Z.prototype.isReady=function(){var Z=this._effect;for(var M in this._bindings){var j=this._bindings[M],K=j.type,b=j.object;switch(K){case U.Texture:case U.TextureWithoutSampler:case U.StorageTexture:if(!b.isReady())return!1}}var g=[],O=this._shaderPath;if(this._options.defines)for(var Q=0;Q<this._options.defines.length;Q++)g.push(this._options.defines[Q]);var Y=g.join("\n");return this._cachedDefines!==Y&&(this._cachedDefines=Y,Z=this._engine.createComputeEffect(O,{defines:Y,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=Z),!!Z.isReady()},Z.prototype.dispatch=function(Z,M,j){var K;if(!this.isReady())return!1;for(var b in this._bindings){var g=this._bindings[b];if(!this._options.bindingsMapping[b])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+b+"'");if(g.type===U.Texture){var O=this._samplers[b],Q=g.object;O&&Q._texture&&O.compareSampler(Q._texture)||(this._samplers[b]=(new F.b).setParameters(Q.wrapU,Q.wrapV,Q.wrapR,Q.anisotropicFilteringLevel,Q._texture.samplingMode,null===(K=Q._texture)||void 0===K?void 0:K._comparisonFunction),this._contextIsDirty=!0)}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),this._engine.computeDispatch(this._effect,this._context,this._bindings,Z,M,j,this._options.bindingsMapping),!0},Z.prototype.dispatchWhenReady=function(Z,M,j,K){var b=this;return void 0===K&&(K=10),new Promise((function(g){!function O(){b.dispatch(Z,M,j)?g():setTimeout(O,K)}()}))},Z.prototype.serialize=function(){var Z=k.b.Serialize(this);for(var M in Z.options=this._options,Z.shaderPath=this._shaderPath,Z.bindings={},Z.textures={},this._bindings){var j=this._bindings[M],K=j.object;switch(j.type){case U.Texture:case U.TextureWithoutSampler:case U.StorageTexture:var b=K.serialize();b&&(Z.textures[M]=b,Z.bindings[M]={type:j.type});case U.UniformBuffer:}}return Z},Z.Parse=function(M,j,K){var b=k.b.Parse((function(){return new Z(M.name,j.getEngine(),M.shaderPath,M.options)}),M,j,K);for(var g in M.textures){var O=M.bindings[g],Q=R.b.Parse(M.textures[g],j,K);O.type===U.Texture?b.setTexture(g,Q):O.type===U.TextureWithoutSampler?b.setTexture(g,Q,!1):b.setStorageTexture(g,Q)}return b},(0,I.l)([(0,k.z)()],Z.prototype,"name",void 0),Z}();(0,A.c)("BABYLON.ComputeShader",C);var y=j(90534),S="struct Particle {\nposition : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};\nstruct Particles {\nparticles : array<Particle>,\n};\nstruct SimParams {\ncurrentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\ndirectionRandomizer : f32,\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};\n@binding(0) @group(0) var<uniform> params : SimParams;\n@binding(1) @group(0) var<storage,read> particlesIn : Particles;\n@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;\n@binding(3) @group(0) var randomTexture : texture_2d<f32>;\n@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;\n@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;\n@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;\n@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;\n@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;\n@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;\n@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {\nreturn textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;\n}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {\nreturn textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);\n}\n@stage(compute) @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\nlet index : u32=GlobalInvocationID.x;\nlet vertexID : f32=f32(index);\nif (index>=u32(params.currentCount)) {\nreturn;\n}\nlet PI : f32=3.14159;\nlet timeDelta : f32=params.timeDelta;\nlet newAge : f32=particlesIn.particles[index].age+timeDelta;\nlet life : f32=particlesIn.particles[index].life;\nlet seed : vec4<f32>=particlesIn.particles[index].seed;\nlet direction : vec3<f32>=particlesIn.particles[index].direction;\nif (newAge>=life && params.stopFactor != 0.) {\nvar newPosition : vec3<f32>;\nvar newDirection : vec3<f32>;\nlet randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);\nlet outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;\nparticlesOut.particles[index].life=outLife;\nparticlesOut.particles[index].age=newAge-life;\nparticlesOut.particles[index].seed=seed;\nvar sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nnewPosition=vec3<f32>(0.,0.,0.);\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nnewPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nlet phi : f32=2.0*PI*randoms2.x;\nlet theta : f32=acos(-1.0+2.0*randoms2.y);\nlet randX : f32=cos(phi)*sin(theta);\nlet randY : f32=cos(theta);\nlet randZ : f32=sin(phi)*sin(theta);\nnewPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nlet phi : f32=2.0*PI*randoms2.x;\nlet theta : f32=acos(-1.0+2.0*randoms2.y);\nlet randX : f32=cos(phi)*sin(theta);\nlet randY : f32=cos(theta);\nlet randZ : f32=sin(phi)*sin(theta);\nnewPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nlet yPos : f32=(-0.5+randoms2.x)*params.height;\nvar angle : f32=randoms2.y*PI*2.;\nlet inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);\nlet positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));\nlet xPos : f32=positionRadius*cos(angle);\nlet zPos : f32=positionRadius*sin(angle);\nnewPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;\nnewDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));\nnewDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;\nh=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;\nlRadius=lRadius*h;\nlet randX : f32=lRadius*sin(s);\nlet randZ : f32=lRadius*cos(s);\nlet randY : f32=h *params.height.x;\nnewPosition=vec3<f32>(randX,randY,randZ); \nif (abs(cos(params.coneAngle))==1.0) {\nnewDirection=vec3<f32>(0.,1.0,0.);\n} else {\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3); \n}\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;\nparticlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);\nnewDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;\nparticlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {\nvar directionScale : f32=timeDelta;\nparticlesOut.particles[index].age=newAge;\nlet ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;\nparticlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\nlet currentVelocity : f32=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*params.limitVelocityDamping;\n}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;\nlet noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;\nlet fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;\nlet fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;\nlet fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;\nlet force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;\nparticlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;\nparticlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;\nparticlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\nparticlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;\nparticlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;\nlet dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;\nparticlesOut.particles[index].cellStartOffset=cellStartOffset;\noffsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;\nif (params.cellInfos.w==1.0) {\nratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);\n}\nelse {\nratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);\n}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}\n}\n";q.d.ShadersStoreWGSL.gpuUpdateParticlesComputeShader=S;var h=function(){function Z(Z,M){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=Z,this._engine=M}return Z.prototype.isUpdateBufferCreated=function(){return!!this._updateComputeShader},Z.prototype.isUpdateBufferReady=function(){var Z,M;return null!==(M=null===(Z=this._updateComputeShader)||void 0===Z?void 0:Z.isReady())&&void 0!==M&&M},Z.prototype.createUpdateBuffer=function(Z){var M,j={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(j.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(j.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(j.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(j.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(j.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(j.noiseTexture={group:1,binding:11}),this._updateComputeShader=new C("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:j,defines:Z.split("\n")}),null===(M=this._simParamsComputeShader)||void 0===M||M.dispose(),this._simParamsComputeShader=new y.d(this._engine),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new W(this._simParamsComputeShader)},Z.prototype.createVertexBuffers=function(Z,M){this._renderVertexBuffers.push(M)},Z.prototype.createParticleBuffer=function(Z){var M=new n(this._engine,4*Z.length,11);return M.update(Z),this._bufferComputeShader.push(M),M.getBuffer()},Z.prototype.bindDrawBuffers=function(Z,M){this._engine.bindBuffers(this._renderVertexBuffers[Z],null,M)},Z.prototype.preUpdateParticleBuffer=function(){},Z.prototype.updateParticleBuffer=function(Z,M,j){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[Z]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^Z]),this._updateComputeShader.dispatch(Math.ceil(j/64))},Z.prototype.releaseBuffers=function(){for(var Z,M=0;M<this._bufferComputeShader.length;++M)this._bufferComputeShader[M].dispose();this._bufferComputeShader=[],null===(Z=this._simParamsComputeShader)||void 0===Z||Z.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null},Z.prototype.releaseVertexBuffers=function(){this._renderVertexBuffers=[]},Z}();(0,A.c)("BABYLON.ComputeShaderParticleSystem",h);var w,p=function(){function Z(Z,M,j){this.gradient=Z,this.color1=M,this.color2=j}return Z.prototype.getColorToRef=function(Z){this.color2?f.g.LerpToRef(this.color1,this.color2,Math.random(),Z):Z.copyFrom(this.color1)},Z}(),m=function(Z,M){this.gradient=Z,this.color=M},J=function(){function Z(Z,M,j){this.gradient=Z,this.factor1=M,this.factor2=j}return Z.prototype.getFactor=function(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()},Z}(),P=function(){function Z(){}return Z.GetCurrentGradient=function(Z,M,j){if(M[0].gradient>Z)j(M[0],M[0],1);else{for(var K=0;K<M.length-1;K++){var b=M[K],g=M[K+1];if(Z>=b.gradient&&Z<=g.gradient)return void j(b,g,(Z-b.gradient)/(g.gradient-b.gradient))}var O=M.length-1;j(M[O],M[O],1)}},Z}(),H=j(9271),D=j(15099),l=j(78588),t=function(){function Z(M){this.particleSystem=M,this.position=K.k.Zero(),this.direction=K.k.Zero(),this.color=new f.g(0,0,0,0),this.colorStep=new f.g(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new K.h(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new f.g(0,0,0,0),this._currentColor2=new f.g(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=Z._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}return Z.prototype._updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},Z.prototype.updateCellIndex=function(){var Z=this.age,M=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===M?(M=1,Z=this._randomCellOffset):Z+=this._randomCellOffset);var j,K=this._initialEndSpriteCellID-this._initialStartSpriteCellID;j=this._initialSpriteCellLoop?O.b.Clamp(Z*M%this.lifeTime/this.lifeTime):O.b.Clamp(Z*M/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+j*K|0},Z.prototype._inheritParticleInfoToSubEmitter=function(Z){if(Z.particleSystem.emitter.position){var M=Z.particleSystem.emitter;if(M.position.copyFrom(this.position),Z.inheritDirection){var j=K.e.Vector3[0];this.direction.normalizeToRef(j),M.setDirection(j,0,Math.PI/2)}}else{Z.particleSystem.emitter.copyFrom(this.position)}this.direction.scaleToRef(Z.inheritedVelocityAmount/2,K.e.Vector3[0]),Z.particleSystem._inheritedVelocityOffset.copyFrom(K.e.Vector3[0])},Z.prototype._inheritParticleInfoToSubEmitters=function(){var Z=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((function(M){Z._inheritParticleInfoToSubEmitter(M)}))},Z.prototype._reset=function(){this.age=0,this.id=Z._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},Z.prototype.copyTo=function(Z){Z.position.copyFrom(this.position),this._initialDirection?Z._initialDirection?Z._initialDirection.copyFrom(this._initialDirection):Z._initialDirection=this._initialDirection.clone():Z._initialDirection=null,Z.direction.copyFrom(this.direction),this._localPosition&&(Z._localPosition?Z._localPosition.copyFrom(this._localPosition):Z._localPosition=this._localPosition.clone()),Z.color.copyFrom(this.color),Z.colorStep.copyFrom(this.colorStep),Z.lifeTime=this.lifeTime,Z.age=this.age,Z._randomCellOffset=this._randomCellOffset,Z.size=this.size,Z.scale.copyFrom(this.scale),Z.angle=this.angle,Z.angularSpeed=this.angularSpeed,Z.particleSystem=this.particleSystem,Z.cellIndex=this.cellIndex,Z.id=this.id,Z._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(Z._currentColorGradient=this._currentColorGradient,Z._currentColor1.copyFrom(this._currentColor1),Z._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(Z._currentSizeGradient=this._currentSizeGradient,Z._currentSize1=this._currentSize1,Z._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(Z._currentAngularSpeedGradient=this._currentAngularSpeedGradient,Z._currentAngularSpeed1=this._currentAngularSpeed1,Z._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(Z._currentVelocityGradient=this._currentVelocityGradient,Z._currentVelocity1=this._currentVelocity1,Z._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(Z._currentLimitVelocityGradient=this._currentLimitVelocityGradient,Z._currentLimitVelocity1=this._currentLimitVelocity1,Z._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(Z._currentDragGradient=this._currentDragGradient,Z._currentDrag1=this._currentDrag1,Z._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(Z._initialStartSpriteCellID=this._initialStartSpriteCellID,Z._initialEndSpriteCellID=this._initialEndSpriteCellID,Z._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(Z.remapData&&this.remapData?Z.remapData.copyFrom(this.remapData):Z.remapData=new K.l(0,0,0,0)),this._randomNoiseCoordinates1&&(Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),Z._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(Z._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),Z._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},Z._Count=0,Z}(),v=j(50504);!function(Z){Z[Z.ATTACHED=0]="ATTACHED",Z[Z.END=1]="END"}(w||(w={}));var r=function(){function Z(Z){if(this.particleSystem=Z,this.type=w.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!Z.emitter||!Z.emitter.dispose){var M=(0,A.b)("BABYLON.AbstractMesh");Z.emitter=new M("SubemitterSystemEmitter",Z.getScene()),Z._disposeEmitterOnDispose=!0}}return Z.prototype.clone=function(){var M=this.particleSystem.emitter;if(M){if(M instanceof K.k)M=M.clone();else if(-1!==M.getClassName().indexOf("Mesh")){(M=new((0,A.b)("BABYLON.Mesh"))("",M.getScene())).isVisible=!1}}else M=new K.k;var j=new Z(this.particleSystem.clone(this.particleSystem.name,M));return j.particleSystem.name+="Clone",j.type=this.type,j.inheritDirection=this.inheritDirection,j.inheritedVelocityAmount=this.inheritedVelocityAmount,j.particleSystem._disposeEmitterOnDispose=!0,j.particleSystem.disposeOnStop=!0,j},Z.prototype.serialize=function(Z){void 0===Z&&(Z=!1);var M={};return M.type=this.type,M.inheritDirection=this.inheritDirection,M.inheritedVelocityAmount=this.inheritedVelocityAmount,M.particleSystem=this.particleSystem.serialize(Z),M},Z._ParseParticleSystem=function(Z,M,j,K){throw void 0===K&&(K=!1),(0,v.e)("ParseParticle")},Z.Parse=function(M,j,K){var b=M.particleSystem,g=new Z(Z._ParseParticleSystem(b,j,K,!0));return g.type=M.type,g.inheritDirection=M.inheritDirection,g.inheritedVelocityAmount=M.inheritedVelocityAmount,g.particleSystem._isSubEmitter=!0,g},Z.prototype.dispose=function(){this.particleSystem.dispose()},Z}(),L=j(61803),ZZ=(j(76578),j(23598),j(83874),j(68923),j(84098),"varying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\nuniform sampler2D rampSampler;\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);\nvec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;\nfloat remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);\nvec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));\nbaseColor.rgb*=rampColor.rgb;\nfloat finalAlpha=baseColor.a;\nbaseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;\nbaseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\nbaseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}");q.d.ShadersStore.particlesPixelShader=ZZ;j(49329),j(61906);var MZ="attribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvPositionW=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition;\nvPositionW=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;\nvPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvPositionW=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset/particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";q.d.ShadersStore.particlesVertexShader=MZ;var jZ=j(86018),KZ=(j(54980),function(Z){function M(M,j,b,g,Y,I){void 0===g&&(g=null),void 0===Y&&(Y=!1),void 0===I&&(I=.01);var E=Z.call(this,M)||this;E._emitterInverseWorldMatrix=K.c.Identity(),E._inheritedVelocityOffset=new K.k,E.onDisposeObservable=new H.b,E.onStoppedObservable=new H.b,E._particles=new Array,E._stockParticles=new Array,E._newPartsExcess=0,E._vertexBuffers={},E._scaledColorStep=new f.g(0,0,0,0),E._colorDiff=new f.g(0,0,0,0),E._scaledDirection=K.k.Zero(),E._scaledGravity=K.k.Zero(),E._currentRenderId=-1,E._useInstancing=!1,E._started=!1,E._stopped=!1,E._actualFrame=0,E._currentEmitRate1=0,E._currentEmitRate2=0,E._currentStartSize1=0,E._currentStartSize2=0,E._rawTextureWidth=256,E._useRampGradients=!1,E._disposeEmitterOnDispose=!1,E.isLocal=!1,E._onBeforeDrawParticlesObservable=null,E.recycleParticle=function(Z){var M=E._particles.pop();M!==Z&&M.copyTo(Z),E._stockParticles.push(M)},E._createParticle=function(){var Z;if(0!==E._stockParticles.length?(Z=E._stockParticles.pop())._reset():Z=new t(E),E._subEmitters&&E._subEmitters.length>0){var M=E._subEmitters[Math.floor(Math.random()*E._subEmitters.length)];Z._attachedSubEmitters=[],M.forEach((function(M){if(M.type===w.ATTACHED){var j=M.clone();Z._attachedSubEmitters.push(j),j.particleSystem.start()}}))}return Z},E._emitFromParticle=function(Z){if(E._subEmitters&&0!==E._subEmitters.length){var M=Math.floor(Math.random()*E._subEmitters.length);E._subEmitters[M].forEach((function(M){if(M.type===w.END){var j=M.clone();Z._inheritParticleInfoToSubEmitter(j),j.particleSystem._rootParticleSystem=E,E.activeSubSystems.push(j.particleSystem),j.particleSystem.start()}}))}},E._capacity=j,E._epsilon=I,E._isAnimationSheetEnabled=Y,b&&"Scene"!==b.getClassName()?(E._engine=b,E.defaultProjectionMatrix=K.c.PerspectiveFovLH(.8,1,.1,100,E._engine.isNDCHalfZRange)):(E._scene=b||l.e.LastCreatedScene,E._engine=E._scene.getEngine(),E.uniqueId=E._scene.getUniqueId(),E._scene.particleSystems.push(E)),E._engine.getCaps().vertexArrayObject&&(E._vertexArrayObject=null),E._attachImageProcessingConfiguration(null),E._customWrappers={0:new L.e(E._engine)},E._customWrappers[0].effect=g,E._drawWrappers=[],E._useInstancing=E._engine.getCaps().instancedArrays,E._createIndexBuffer(),E._createVertexBuffers(),E.particleEmitterType=new Q;var s=null;return E.updateFunction=function(Z){var M,j=null;E.noiseTexture&&(j=E.noiseTexture.getSize(),null===(M=E.noiseTexture.getContent())||void 0===M||M.then((function(Z){s=Z})));for(var b,g=function(M){var g=Z[M],Q=E._scaledUpdateSpeed,Y=g.age;if(g.age+=Q,g.age>g.lifeTime){var I=g.age-Y;Q=(g.lifeTime-Y)*Q/I,g.age=g.lifeTime}var i=g.age/g.lifeTime;E._colorGradients&&E._colorGradients.length>0?P.GetCurrentGradient(i,E._colorGradients,(function(Z,M,j){Z!==g._currentColorGradient&&(g._currentColor1.copyFrom(g._currentColor2),M.getColorToRef(g._currentColor2),g._currentColorGradient=Z),f.g.LerpToRef(g._currentColor1,g._currentColor2,j,g.color)})):(g.colorStep.scaleToRef(Q,E._scaledColorStep),g.color.addInPlace(E._scaledColorStep),g.color.a<0&&(g.color.a=0)),E._angularSpeedGradients&&E._angularSpeedGradients.length>0&&P.GetCurrentGradient(i,E._angularSpeedGradients,(function(Z,M,j){Z!==g._currentAngularSpeedGradient&&(g._currentAngularSpeed1=g._currentAngularSpeed2,g._currentAngularSpeed2=M.getFactor(),g._currentAngularSpeedGradient=Z),g.angularSpeed=O.b.Lerp(g._currentAngularSpeed1,g._currentAngularSpeed2,j)})),g.angle+=g.angularSpeed*Q;var a=Q;if(E._velocityGradients&&E._velocityGradients.length>0&&P.GetCurrentGradient(i,E._velocityGradients,(function(Z,M,j){Z!==g._currentVelocityGradient&&(g._currentVelocity1=g._currentVelocity2,g._currentVelocity2=M.getFactor(),g._currentVelocityGradient=Z),a*=O.b.Lerp(g._currentVelocity1,g._currentVelocity2,j)})),g.direction.scaleToRef(a,E._scaledDirection),E._limitVelocityGradients&&E._limitVelocityGradients.length>0&&P.GetCurrentGradient(i,E._limitVelocityGradients,(function(Z,M,j){Z!==g._currentLimitVelocityGradient&&(g._currentLimitVelocity1=g._currentLimitVelocity2,g._currentLimitVelocity2=M.getFactor(),g._currentLimitVelocityGradient=Z);var K=O.b.Lerp(g._currentLimitVelocity1,g._currentLimitVelocity2,j);g.direction.length()>K&&g.direction.scaleInPlace(E.limitVelocityDamping)})),E._dragGradients&&E._dragGradients.length>0&&P.GetCurrentGradient(i,E._dragGradients,(function(Z,M,j){Z!==g._currentDragGradient&&(g._currentDrag1=g._currentDrag2,g._currentDrag2=M.getFactor(),g._currentDragGradient=Z);var K=O.b.Lerp(g._currentDrag1,g._currentDrag2,j);E._scaledDirection.scaleInPlace(1-K)})),E.isLocal&&g._localPosition?(g._localPosition.addInPlace(E._scaledDirection),K.k.TransformCoordinatesToRef(g._localPosition,E._emitterWorldMatrix,g.position)):g.position.addInPlace(E._scaledDirection),s&&j&&g._randomNoiseCoordinates1){var z=E._fetchR(g._randomNoiseCoordinates1.x,g._randomNoiseCoordinates1.y,j.width,j.height,s),V=E._fetchR(g._randomNoiseCoordinates1.z,g._randomNoiseCoordinates2.x,j.width,j.height,s),o=E._fetchR(g._randomNoiseCoordinates2.y,g._randomNoiseCoordinates2.z,j.width,j.height,s),c=K.e.Vector3[0],G=K.e.Vector3[1];c.copyFromFloats((2*z-1)*E.noiseStrength.x,(2*V-1)*E.noiseStrength.y,(2*o-1)*E.noiseStrength.z),c.scaleToRef(Q,G),g.direction.addInPlace(G)}if(E.gravity.scaleToRef(Q,E._scaledGravity),g.direction.addInPlace(E._scaledGravity),E._sizeGradients&&E._sizeGradients.length>0&&P.GetCurrentGradient(i,E._sizeGradients,(function(Z,M,j){Z!==g._currentSizeGradient&&(g._currentSize1=g._currentSize2,g._currentSize2=M.getFactor(),g._currentSizeGradient=Z),g.size=O.b.Lerp(g._currentSize1,g._currentSize2,j)})),E._useRampGradients&&(E._colorRemapGradients&&E._colorRemapGradients.length>0&&P.GetCurrentGradient(i,E._colorRemapGradients,(function(Z,M,j){var K=O.b.Lerp(Z.factor1,M.factor1,j),b=O.b.Lerp(Z.factor2,M.factor2,j);g.remapData.x=K,g.remapData.y=b-K})),E._alphaRemapGradients&&E._alphaRemapGradients.length>0&&P.GetCurrentGradient(i,E._alphaRemapGradients,(function(Z,M,j){var K=O.b.Lerp(Z.factor1,M.factor1,j),b=O.b.Lerp(Z.factor2,M.factor2,j);g.remapData.z=K,g.remapData.w=b-K}))),E._isAnimationSheetEnabled&&g.updateCellIndex(),g._inheritParticleInfoToSubEmitters(),g.age>=g.lifeTime)return E._emitFromParticle(g),g._attachedSubEmitters&&(g._attachedSubEmitters.forEach((function(Z){Z.particleSystem.disposeOnStop=!0,Z.particleSystem.stop()})),g._attachedSubEmitters=null),E.recycleParticle(g),M--,b=M,"continue";b=M},Q=0;Q<Z.length;Q++)g(Q),Q=b},E}return(0,I.m)(M,Z),Object.defineProperty(M.prototype,"onDispose",{set:function(Z){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(Z){this._useRampGradients!==Z&&(this._useRampGradients=Z,this._resetEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"particles",{get:function(){return this._particles},enumerable:!1,configurable:!0}),M.prototype.getActiveCount=function(){return this._particles.length},M.prototype.getClassName=function(){return"ParticleSystem"},M.prototype.isStopping=function(){return this._stopped&&this.isAlive()},M.prototype.getCustomEffect=function(Z){var M,j;return void 0===Z&&(Z=0),null!==(j=null===(M=this._customWrappers[Z])||void 0===M?void 0:M.effect)&&void 0!==j?j:this._customWrappers[0].effect},M.prototype._getCustomDrawWrapper=function(Z){var M;return void 0===Z&&(Z=0),null!==(M=this._customWrappers[Z])&&void 0!==M?M:this._customWrappers[0]},M.prototype.setCustomEffect=function(Z,M){void 0===M&&(M=0),this._customWrappers[M]=new L.e(this._engine),this._customWrappers[M].effect=Z,this._customWrappers[M].drawContext&&(this._customWrappers[M].drawContext.useInstancing=this._useInstancing)},Object.defineProperty(M.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new H.b),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"vertexShaderName",{get:function(){return"particles"},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"vertexBuffers",{get:function(){return this._vertexBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!1,configurable:!0}),M.prototype._addFactorGradient=function(Z,M,j,K){var b=new J(M,j,K);Z.push(b),Z.sort((function(Z,M){return Z.gradient<M.gradient?-1:Z.gradient>M.gradient?1:0}))},M.prototype._removeFactorGradient=function(Z,M){if(Z)for(var j=0,K=0,b=Z;K<b.length;K++){if(b[K].gradient===M){Z.splice(j,1);break}j++}},M.prototype.addLifeTimeGradient=function(Z,M,j){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,Z,M,j),this},M.prototype.removeLifeTimeGradient=function(Z){return this._removeFactorGradient(this._lifeTimeGradients,Z),this},M.prototype.addSizeGradient=function(Z,M,j){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,Z,M,j),this},M.prototype.removeSizeGradient=function(Z){return this._removeFactorGradient(this._sizeGradients,Z),this},M.prototype.addColorRemapGradient=function(Z,M,j){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,Z,M,j),this},M.prototype.removeColorRemapGradient=function(Z){return this._removeFactorGradient(this._colorRemapGradients,Z),this},M.prototype.addAlphaRemapGradient=function(Z,M,j){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,Z,M,j),this},M.prototype.removeAlphaRemapGradient=function(Z){return this._removeFactorGradient(this._alphaRemapGradients,Z),this},M.prototype.addAngularSpeedGradient=function(Z,M,j){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,Z,M,j),this},M.prototype.removeAngularSpeedGradient=function(Z){return this._removeFactorGradient(this._angularSpeedGradients,Z),this},M.prototype.addVelocityGradient=function(Z,M,j){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,Z,M,j),this},M.prototype.removeVelocityGradient=function(Z){return this._removeFactorGradient(this._velocityGradients,Z),this},M.prototype.addLimitVelocityGradient=function(Z,M,j){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,Z,M,j),this},M.prototype.removeLimitVelocityGradient=function(Z){return this._removeFactorGradient(this._limitVelocityGradients,Z),this},M.prototype.addDragGradient=function(Z,M,j){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,Z,M,j),this},M.prototype.removeDragGradient=function(Z){return this._removeFactorGradient(this._dragGradients,Z),this},M.prototype.addEmitRateGradient=function(Z,M,j){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,Z,M,j),this},M.prototype.removeEmitRateGradient=function(Z){return this._removeFactorGradient(this._emitRateGradients,Z),this},M.prototype.addStartSizeGradient=function(Z,M,j){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,Z,M,j),this},M.prototype.removeStartSizeGradient=function(Z){return this._removeFactorGradient(this._startSizeGradients,Z),this},M.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture&&this._scene){for(var Z=new Uint8Array(4*this._rawTextureWidth),M=f.h.Color3[0],j=function(j){var b=j/K._rawTextureWidth;P.GetCurrentGradient(b,K._rampGradients,(function(K,b,g){f.e.LerpToRef(K.color,b.color,g,M),Z[4*j]=255*M.r,Z[4*j+1]=255*M.g,Z[4*j+2]=255*M.b,Z[4*j+3]=255}))},K=this,b=0;b<this._rawTextureWidth;b++)j(b);this._rampGradientsTexture=D.d.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1)}},M.prototype.getRampGradients=function(){return this._rampGradients},M.prototype.forceRefreshGradients=function(){this._syncRampGradientTexture()},M.prototype._syncRampGradientTexture=function(){this._rampGradients&&(this._rampGradients.sort((function(Z,M){return Z.gradient<M.gradient?-1:Z.gradient>M.gradient?1:0})),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())},M.prototype.addRampGradient=function(Z,M){this._rampGradients||(this._rampGradients=[]);var j=new m(Z,M);return this._rampGradients.push(j),this._syncRampGradientTexture(),this},M.prototype.removeRampGradient=function(Z){return this._removeGradientAndTexture(Z,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},M.prototype.addColorGradient=function(Z,M,j){this._colorGradients||(this._colorGradients=[]);var K=new p(Z,M,j);return this._colorGradients.push(K),this._colorGradients.sort((function(Z,M){return Z.gradient<M.gradient?-1:Z.gradient>M.gradient?1:0})),this},M.prototype.removeColorGradient=function(Z){if(!this._colorGradients)return this;for(var M=0,j=0,K=this._colorGradients;j<K.length;j++){if(K[j].gradient===Z){this._colorGradients.splice(M,1);break}M++}return this},M.prototype.resetDrawCache=function(){for(var Z=0,M=this._drawWrappers;Z<M.length;Z++){var j=M[Z];if(j)for(var K=0,b=j;K<b.length;K++){var g=b[K];null===g||void 0===g||g.dispose()}}this._drawWrappers=[]},M.prototype._fetchR=function(Z,M,j,K,b){return b[4*(((Z=.5*Math.abs(Z)+.5)*j%j|0)+((M=.5*Math.abs(M)+.5)*K%K|0)*j)]/255},M.prototype._reset=function(){this._resetEffect()},M.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()},M.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==M.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var Z=this._engine,j=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*j),this._vertexBuffer=new c.e(Z,this._vertexData,!0,j);var K=0,b=this._vertexBuffer.createVertexBuffer(c.f.PositionKind,K,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[c.f.PositionKind]=b,K+=3;var g=this._vertexBuffer.createVertexBuffer(c.f.ColorKind,K,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[c.f.ColorKind]=g,K+=4;var O=this._vertexBuffer.createVertexBuffer("angle",K,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=O,K+=1;var Q,Y=this._vertexBuffer.createVertexBuffer("size",K,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Y,K+=2,this._isAnimationSheetEnabled){var I=this._vertexBuffer.createVertexBuffer("cellIndex",K,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=I,K+=1}if(!this._isBillboardBased||this.billboardMode===M.BILLBOARDMODE_STRETCHED){var E=this._vertexBuffer.createVertexBuffer("direction",K,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=E,K+=3}if(this._useRampGradients){var s=this._vertexBuffer.createVertexBuffer("remapData",K,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=s,K+=4}if(this._useInstancing){var i=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new c.e(Z,i,!1,2),Q=this._spriteBuffer.createVertexBuffer("offset",0,2)}else Q=this._vertexBuffer.createVertexBuffer("offset",K,2,this._vertexBufferSize,this._useInstancing),K+=2;this._vertexBuffers.offset=Q,this.resetDrawCache()},M.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var Z=[],M=0,j=0;j<this._capacity;j++)Z.push(M),Z.push(M+1),Z.push(M+2),Z.push(M),Z.push(M+2),Z.push(M+3),M+=4;this._indexBuffer=this._engine.createIndexBuffer(Z)}},M.prototype.getCapacity=function(){return this._capacity},M.prototype.isAlive=function(){return this._alive},M.prototype.isStarted=function(){return this._started},M.prototype._prepareSubEmitterInternalArray=function(){var Z=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((function(j){j instanceof M?Z._subEmitters.push([new r(j)]):j instanceof r?Z._subEmitters.push([j]):j instanceof Array&&Z._subEmitters.push(j)}))},M.prototype.start=function(Z){var M,j=this;if(void 0===Z&&(Z=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(Z)setTimeout((function(){j.start(0)}),Z);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){-1!==(null===(M=this.emitter)||void 0===M?void 0:M.getClassName().indexOf("Mesh"))&&this.emitter.computeWorldMatrix(!0);var K=this.noiseTexture;if(K&&K.onGeneratedObservable)K.onGeneratedObservable.addOnce((function(){setTimeout((function(){for(var Z=0;Z<j.preWarmCycles;Z++)j.animate(!0),K.render()}))}));else for(var b=0;b<this.preWarmCycles;b++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},M.prototype.stop=function(Z){void 0===Z&&(Z=!0),this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,Z&&this._stopSubEmitters())},M.prototype.reset=function(){this._stockParticles=[],this._particles=[]},M.prototype._appendParticleVertex=function(Z,j,b,g){var O=Z*this._vertexBufferSize;if(this._vertexData[O++]=j.position.x+this.worldOffset.x,this._vertexData[O++]=j.position.y+this.worldOffset.y,this._vertexData[O++]=j.position.z+this.worldOffset.z,this._vertexData[O++]=j.color.r,this._vertexData[O++]=j.color.g,this._vertexData[O++]=j.color.b,this._vertexData[O++]=j.color.a,this._vertexData[O++]=j.angle,this._vertexData[O++]=j.scale.x*j.size,this._vertexData[O++]=j.scale.y*j.size,this._isAnimationSheetEnabled&&(this._vertexData[O++]=j.cellIndex),this._isBillboardBased)this.billboardMode===M.BILLBOARDMODE_STRETCHED&&(this._vertexData[O++]=j.direction.x,this._vertexData[O++]=j.direction.y,this._vertexData[O++]=j.direction.z);else if(j._initialDirection){var Q=j._initialDirection;this.isLocal&&(K.k.TransformNormalToRef(Q,this._emitterWorldMatrix,K.e.Vector3[0]),Q=K.e.Vector3[0]),0===Q.x&&0===Q.z&&(Q.x=.001),this._vertexData[O++]=Q.x,this._vertexData[O++]=Q.y,this._vertexData[O++]=Q.z}else{var Y=j.direction;this.isLocal&&(K.k.TransformNormalToRef(Y,this._emitterWorldMatrix,K.e.Vector3[0]),Y=K.e.Vector3[0]),0===Y.x&&0===Y.z&&(Y.x=.001),this._vertexData[O++]=Y.x,this._vertexData[O++]=Y.y,this._vertexData[O++]=Y.z}this._useRampGradients&&j.remapData&&(this._vertexData[O++]=j.remapData.x,this._vertexData[O++]=j.remapData.y,this._vertexData[O++]=j.remapData.z,this._vertexData[O++]=j.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===b?b=this._epsilon:1===b&&(b=1-this._epsilon),0===g?g=this._epsilon:1===g&&(g=1-this._epsilon)),this._vertexData[O++]=b,this._vertexData[O++]=g)},M.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach((function(Z){Z.stop(!0)})),this.activeSubSystems=new Array)},M.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var Z=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==Z&&this._rootParticleSystem.activeSubSystems.splice(Z,1),this._rootParticleSystem=null}},M.prototype._update=function(Z){var M,j=this;if(this._alive=this._particles.length>0,this.emitter.position){var b=this.emitter;this._emitterWorldMatrix=b.getWorldMatrix()}else{var g=this.emitter;this._emitterWorldMatrix=K.c.Translation(g.x,g.y,g.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this._particles);for(var Q=function(Z){if(Y._particles.length===Y._capacity)return"break";if(M=Y._createParticle(),Y._particles.push(M),Y.targetStopDuration&&Y._lifeTimeGradients&&Y._lifeTimeGradients.length>0){var b=O.b.Clamp(Y._actualFrame/Y.targetStopDuration);P.GetCurrentGradient(b,Y._lifeTimeGradients,(function(Z,j){var K=Z,g=j,Q=K.getFactor(),Y=g.getFactor(),I=(b-K.gradient)/(g.gradient-K.gradient);M.lifeTime=O.b.Lerp(Q,Y,I)}))}else M.lifeTime=O.b.RandomRange(Y.minLifeTime,Y.maxLifeTime);var g=O.b.RandomRange(Y.minEmitPower,Y.maxEmitPower);if(Y.startPositionFunction?Y.startPositionFunction(Y._emitterWorldMatrix,M.position,M,Y.isLocal):Y.particleEmitterType.startPositionFunction(Y._emitterWorldMatrix,M.position,M,Y.isLocal),Y.isLocal&&(M._localPosition?M._localPosition.copyFrom(M.position):M._localPosition=M.position.clone(),K.k.TransformCoordinatesToRef(M._localPosition,Y._emitterWorldMatrix,M.position)),Y.startDirectionFunction?Y.startDirectionFunction(Y._emitterWorldMatrix,M.direction,M,Y.isLocal):Y.particleEmitterType.startDirectionFunction(Y._emitterWorldMatrix,M.direction,M,Y.isLocal,Y._emitterInverseWorldMatrix),0===g?M._initialDirection?M._initialDirection.copyFrom(M.direction):M._initialDirection=M.direction.clone():M._initialDirection=null,M.direction.scaleInPlace(g),Y._sizeGradients&&0!==Y._sizeGradients.length?(M._currentSizeGradient=Y._sizeGradients[0],M._currentSize1=M._currentSizeGradient.getFactor(),M.size=M._currentSize1,Y._sizeGradients.length>1?M._currentSize2=Y._sizeGradients[1].getFactor():M._currentSize2=M._currentSize1):M.size=O.b.RandomRange(Y.minSize,Y.maxSize),M.scale.copyFromFloats(O.b.RandomRange(Y.minScaleX,Y.maxScaleX),O.b.RandomRange(Y.minScaleY,Y.maxScaleY)),Y._startSizeGradients&&Y._startSizeGradients[0]&&Y.targetStopDuration){var Q=Y._actualFrame/Y.targetStopDuration;P.GetCurrentGradient(Q,Y._startSizeGradients,(function(Z,K,b){Z!==j._currentStartSizeGradient&&(j._currentStartSize1=j._currentStartSize2,j._currentStartSize2=K.getFactor(),j._currentStartSizeGradient=Z);var g=O.b.Lerp(j._currentStartSize1,j._currentStartSize2,b);M.scale.scaleInPlace(g)}))}if(Y._angularSpeedGradients&&0!==Y._angularSpeedGradients.length?(M._currentAngularSpeedGradient=Y._angularSpeedGradients[0],M.angularSpeed=M._currentAngularSpeedGradient.getFactor(),M._currentAngularSpeed1=M.angularSpeed,Y._angularSpeedGradients.length>1?M._currentAngularSpeed2=Y._angularSpeedGradients[1].getFactor():M._currentAngularSpeed2=M._currentAngularSpeed1):M.angularSpeed=O.b.RandomRange(Y.minAngularSpeed,Y.maxAngularSpeed),M.angle=O.b.RandomRange(Y.minInitialRotation,Y.maxInitialRotation),Y._velocityGradients&&Y._velocityGradients.length>0&&(M._currentVelocityGradient=Y._velocityGradients[0],M._currentVelocity1=M._currentVelocityGradient.getFactor(),Y._velocityGradients.length>1?M._currentVelocity2=Y._velocityGradients[1].getFactor():M._currentVelocity2=M._currentVelocity1),Y._limitVelocityGradients&&Y._limitVelocityGradients.length>0&&(M._currentLimitVelocityGradient=Y._limitVelocityGradients[0],M._currentLimitVelocity1=M._currentLimitVelocityGradient.getFactor(),Y._limitVelocityGradients.length>1?M._currentLimitVelocity2=Y._limitVelocityGradients[1].getFactor():M._currentLimitVelocity2=M._currentLimitVelocity1),Y._dragGradients&&Y._dragGradients.length>0&&(M._currentDragGradient=Y._dragGradients[0],M._currentDrag1=M._currentDragGradient.getFactor(),Y._dragGradients.length>1?M._currentDrag2=Y._dragGradients[1].getFactor():M._currentDrag2=M._currentDrag1),Y._colorGradients&&0!==Y._colorGradients.length)M._currentColorGradient=Y._colorGradients[0],M._currentColorGradient.getColorToRef(M.color),M._currentColor1.copyFrom(M.color),Y._colorGradients.length>1?Y._colorGradients[1].getColorToRef(M._currentColor2):M._currentColor2.copyFrom(M.color);else{var I=O.b.RandomRange(0,1);f.g.LerpToRef(Y.color1,Y.color2,I,M.color),Y.colorDead.subtractToRef(M.color,Y._colorDiff),Y._colorDiff.scaleToRef(1/M.lifeTime,M.colorStep)}Y._isAnimationSheetEnabled&&(M._initialStartSpriteCellID=Y.startSpriteCellID,M._initialEndSpriteCellID=Y.endSpriteCellID,M._initialSpriteCellLoop=Y.spriteCellLoop),M.direction.addInPlace(Y._inheritedVelocityOffset),Y._useRampGradients&&(M.remapData=new K.l(0,1,0,1)),Y.noiseTexture&&(M._randomNoiseCoordinates1?(M._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),M._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(M._randomNoiseCoordinates1=new K.k(Math.random(),Math.random(),Math.random()),M._randomNoiseCoordinates2=new K.k(Math.random(),Math.random(),Math.random()))),M._inheritParticleInfoToSubEmitters()},Y=this,I=0;I<Z;I++){if("break"===Q())break}},M._GetAttributeNamesOrOptions=function(Z,M,j){void 0===Z&&(Z=!1),void 0===M&&(M=!1),void 0===j&&(j=!1);var K=[c.f.PositionKind,c.f.ColorKind,"angle","offset","size"];return Z&&K.push("cellIndex"),M||K.push("direction"),j&&K.push("remapData"),K},M._GetEffectCreationOptions=function(Z){void 0===Z&&(Z=!1);var M=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMask","translationPivot","eyePosition"];return Z&&M.push("particlesInfos"),M},M.prototype.fillDefines=function(Z,j){if(this._scene&&(this._scene.clipPlane&&Z.push("#define CLIPPLANE"),this._scene.clipPlane2&&Z.push("#define CLIPPLANE2"),this._scene.clipPlane3&&Z.push("#define CLIPPLANE3"),this._scene.clipPlane4&&Z.push("#define CLIPPLANE4"),this._scene.clipPlane5&&Z.push("#define CLIPPLANE5"),this._scene.clipPlane6&&Z.push("#define CLIPPLANE6")),this._isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),j===M.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&Z.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case M.BILLBOARDMODE_Y:Z.push("#define BILLBOARDY");break;case M.BILLBOARDMODE_STRETCHED:Z.push("#define BILLBOARDSTRETCHED");break;case M.BILLBOARDMODE_ALL:Z.push("#define BILLBOARDMODE_ALL")}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(this._imageProcessingConfigurationDefines.toString()))},M.prototype.fillUniformsAttributesAndSamplerNames=function(Z,j,K){j.push.apply(j,M._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==M.BILLBOARDMODE_STRETCHED,this._useRampGradients)),Z.push.apply(Z,M._GetEffectCreationOptions(this._isAnimationSheetEnabled)),K.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&(b.e.PrepareUniforms(Z,this._imageProcessingConfigurationDefines),b.e.PrepareSamplers(K,this._imageProcessingConfigurationDefines))},M.prototype._getWrapper=function(Z){var M=this._getCustomDrawWrapper(Z);if(null===M||void 0===M?void 0:M.effect)return M;var j=[];this.fillDefines(j,Z);var K=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0,b=this._drawWrappers[K];b||(b=this._drawWrappers[K]=[]);var g=b[Z];g||((g=new L.e(this._engine)).drawContext&&(g.drawContext.useInstancing=this._useInstancing),b[Z]=g);var O=j.join("\n");if(g.defines!==O){var Q=[],Y=[],I=[];this.fillUniformsAttributesAndSamplerNames(Y,Q,I),g.setEffect(this._engine.createEffect("particles",Q,Y,I,O),O)}return g},M.prototype.animate=function(Z){var M,j=this;if(void 0===Z&&(Z=!1),this._started){if(!Z&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var K;if(this._scaledUpdateSpeed=this.updateSpeed*(Z?this.preWarmStepOffset:(null===(M=this._scene)||void 0===M?void 0:M.getAnimationRatio())||1),this.manualEmitCount>-1)K=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var b=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var g=this._actualFrame/this.targetStopDuration;P.GetCurrentGradient(g,this._emitRateGradients,(function(Z,M,K){Z!==j._currentEmitRateGradient&&(j._currentEmitRate1=j._currentEmitRate2,j._currentEmitRate2=M.getFactor(),j._currentEmitRateGradient=Z),b=O.b.Lerp(j._currentEmitRate1,j._currentEmitRate2,K)}))}K=b*this._scaledUpdateSpeed>>0,this._newPartsExcess+=b*this._scaledUpdateSpeed-K}if(this._newPartsExcess>1&&(K+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?K=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(K),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Z){for(var Q=0,Y=0;Y<this._particles.length;Y++){var I=this._particles[Y];this._appendParticleVertices(Q,I),Q+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this._particles.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}},M.prototype._appendParticleVertices=function(Z,M){this._appendParticleVertex(Z++,M,0,0),this._useInstancing||(this._appendParticleVertex(Z++,M,1,0),this._appendParticleVertex(Z++,M,1,1),this._appendParticleVertex(Z++,M,0,1))},M.prototype.rebuild=function(){var Z,M;for(var j in this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(Z=this._spriteBuffer)||void 0===Z||Z._rebuild(),null===(M=this._vertexBuffer)||void 0===M||M._rebuild(),this._vertexBuffers)this._vertexBuffers[j]._rebuild();this.resetDrawCache()},M.prototype.isReady=function(){if(!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==M.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(M.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(M.BLENDMODE_ADD).effect.isReady())return!1}return!0},M.prototype._render=function(Z){var j,b,g=this._getWrapper(Z),O=g.effect,Q=this._engine;Q.enableEffect(g);var Y=null!==(j=this.defaultViewMatrix)&&void 0!==j?j:this._scene.getViewMatrix();if(O.setTexture("diffuseSampler",this.particleTexture),O.setMatrix("view",Y),O.setMatrix("projection",null!==(b=this.defaultProjectionMatrix)&&void 0!==b?b:this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var I=this.particleTexture.getBaseSize();O.setFloat3("particlesInfos",this.spriteCellWidth/I.width,this.spriteCellHeight/I.height,this.spriteCellWidth/I.width)}if(O.setVector2("translationPivot",this.translationPivot),O.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){var E=this._scene.activeCamera;O.setVector3("eyePosition",E.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),O.setTexture("rampSampler",this._rampGradientsTexture));var s=O.defines;switch(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&jZ.b.BindClipPlane(O,this._scene),s.indexOf("#define BILLBOARDMODE_ALL")>=0&&(Y.invertToRef(K.e.Matrix[0]),O.setMatrix("invView",K.e.Matrix[0])),void 0!==this._vertexArrayObject?(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,O)),this._engine.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):Q.bindBuffers(this._vertexBuffers,this._indexBuffer,O),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(O),Z){case M.BLENDMODE_ADD:Q.setAlphaMode(1);break;case M.BLENDMODE_ONEONE:Q.setAlphaMode(6);break;case M.BLENDMODE_STANDARD:Q.setAlphaMode(2);break;case M.BLENDMODE_MULTIPLY:Q.setAlphaMode(4)}return this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(O),this._useInstancing?Q.drawArraysType(7,0,4,this._particles.length):Q.drawElementsType(0,0,6*this._particles.length),this._particles.length},M.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var Z=this._engine;Z.setState&&(Z.setState(!1),this.forceDepthWrite&&Z.setDepthWrite(!0));var j=0;return j=this.blendMode===M.BLENDMODE_MULTIPLYADD?this._render(M.BLENDMODE_MULTIPLY)+this._render(M.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),j},M.prototype.dispose=function(Z){if(void 0===Z&&(Z=!0),this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),this._subEmitters&&this._subEmitters.length){for(var M=0;M<this._subEmitters.length;M++)for(var j=0,K=this._subEmitters[M];j<K.length;j++){K[j].dispose()}this._subEmitters=[],this.subEmitters=[]}(this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene)&&((M=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(M,1),this._scene._activeParticleSystems.dispose());this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onStoppedObservable.clear(),this.reset()},M.prototype.clone=function(Z,j){var K=(0,I.e)({},this._customWrappers),b=null,g=this._engine;if(g.createEffectForParticles&&null!=this.customShader){var O=(b=this.customShader).shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",Q=g.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,O);K[0]?K[0].effect=Q:this.setCustomEffect(Q,0)}var Y=this.serialize(),E=M.Parse(Y,this._scene||this._engine,this._rootUrl);return E.name=Z,E.customShader=b,E._customWrappers=K,void 0===j&&(j=this.emitter),this.noiseTexture&&(E.noiseTexture=this.noiseTexture.clone()),E.emitter=j,this.preventAutoStart||E.start(),E},M.prototype.serialize=function(Z){void 0===Z&&(Z=!1);var j={};if(M._Serialize(j,this,Z),j.textureMask=this.textureMask.asArray(),j.customShader=this.customShader,j.preventAutoStart=this.preventAutoStart,this.subEmitters){j.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var K=0,b=this._subEmitters;K<b.length;K++){for(var g=[],O=0,Q=b[K];O<Q.length;O++){var Y=Q[O];g.push(Y.serialize(Z))}j.subEmitters.push(g)}}return j},M._Serialize=function(Z,M,j){if(Z.name=M.name,Z.id=M.id,Z.capacity=M.getCapacity(),Z.disposeOnStop=M.disposeOnStop,Z.manualEmitCount=M.manualEmitCount,M.emitter.position){var K=M.emitter;Z.emitterId=K.id}else{var b=M.emitter;Z.emitter=b.asArray()}M.particleEmitterType&&(Z.particleEmitterType=M.particleEmitterType.serialize()),M.particleTexture&&(j?Z.texture=M.particleTexture.serialize():(Z.textureName=M.particleTexture.name,Z.invertY=!!M.particleTexture._invertY)),Z.isLocal=M.isLocal,k.b.AppendSerializedAnimations(M,Z),Z.beginAnimationOnStart=M.beginAnimationOnStart,Z.beginAnimationFrom=M.beginAnimationFrom,Z.beginAnimationTo=M.beginAnimationTo,Z.beginAnimationLoop=M.beginAnimationLoop,Z.startDelay=M.startDelay,Z.renderingGroupId=M.renderingGroupId,Z.isBillboardBased=M.isBillboardBased,Z.billboardMode=M.billboardMode,Z.minAngularSpeed=M.minAngularSpeed,Z.maxAngularSpeed=M.maxAngularSpeed,Z.minSize=M.minSize,Z.maxSize=M.maxSize,Z.minScaleX=M.minScaleX,Z.maxScaleX=M.maxScaleX,Z.minScaleY=M.minScaleY,Z.maxScaleY=M.maxScaleY,Z.minEmitPower=M.minEmitPower,Z.maxEmitPower=M.maxEmitPower,Z.minLifeTime=M.minLifeTime,Z.maxLifeTime=M.maxLifeTime,Z.emitRate=M.emitRate,Z.gravity=M.gravity.asArray(),Z.noiseStrength=M.noiseStrength.asArray(),Z.color1=M.color1.asArray(),Z.color2=M.color2.asArray(),Z.colorDead=M.colorDead.asArray(),Z.updateSpeed=M.updateSpeed,Z.targetStopDuration=M.targetStopDuration,Z.blendMode=M.blendMode,Z.preWarmCycles=M.preWarmCycles,Z.preWarmStepOffset=M.preWarmStepOffset,Z.minInitialRotation=M.minInitialRotation,Z.maxInitialRotation=M.maxInitialRotation,Z.startSpriteCellID=M.startSpriteCellID,Z.spriteCellLoop=M.spriteCellLoop,Z.endSpriteCellID=M.endSpriteCellID,Z.spriteCellChangeSpeed=M.spriteCellChangeSpeed,Z.spriteCellWidth=M.spriteCellWidth,Z.spriteCellHeight=M.spriteCellHeight,Z.spriteRandomStartCell=M.spriteRandomStartCell,Z.isAnimationSheetEnabled=M.isAnimationSheetEnabled;var g=M.getColorGradients();if(g){Z.colorGradients=[];for(var O=0,Q=g;O<Q.length;O++){var Y=Q[O],I={gradient:Y.gradient,color1:Y.color1.asArray()};Y.color2?I.color2=Y.color2.asArray():I.color2=Y.color1.asArray(),Z.colorGradients.push(I)}}var E=M.getRampGradients();if(E){Z.rampGradients=[];for(var s=0,i=E;s<i.length;s++){var a=i[s];I={gradient:a.gradient,color:a.color.asArray()};Z.rampGradients.push(I)}Z.useRampGradients=M.useRampGradients}var z=M.getColorRemapGradients();if(z){Z.colorRemapGradients=[];for(var V=0,o=z;V<o.length;V++){var c=o[V];I={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?I.factor2=c.factor2:I.factor2=c.factor1,Z.colorRemapGradients.push(I)}}var G=M.getAlphaRemapGradients();if(G){Z.alphaRemapGradients=[];for(var f=0,X=G;f<X.length;f++){var d=X[f];I={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?I.factor2=d.factor2:I.factor2=d.factor1,Z.alphaRemapGradients.push(I)}}var W=M.getSizeGradients();if(W){Z.sizeGradients=[];for(var A=0,q=W;A<q.length;A++){var T=q[A];I={gradient:T.gradient,factor1:T.factor1};void 0!==T.factor2?I.factor2=T.factor2:I.factor2=T.factor1,Z.sizeGradients.push(I)}}var B=M.getAngularSpeedGradients();if(B){Z.angularSpeedGradients=[];for(var N=0,U=B;N<U.length;N++){var n=U[N];I={gradient:n.gradient,factor1:n.factor1};void 0!==n.factor2?I.factor2=n.factor2:I.factor2=n.factor1,Z.angularSpeedGradients.push(I)}}var x=M.getVelocityGradients();if(x){Z.velocityGradients=[];for(var R=0,e=x;R<e.length;R++){var u=e[R];I={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?I.factor2=u.factor2:I.factor2=u.factor1,Z.velocityGradients.push(I)}}var F=M.getDragGradients();if(F){Z.dragGradients=[];for(var C=0,y=F;C<y.length;C++){var S=y[C];I={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?I.factor2=S.factor2:I.factor2=S.factor1,Z.dragGradients.push(I)}}var h=M.getEmitRateGradients();if(h){Z.emitRateGradients=[];for(var w=0,p=h;w<p.length;w++){var m=p[w];I={gradient:m.gradient,factor1:m.factor1};void 0!==m.factor2?I.factor2=m.factor2:I.factor2=m.factor1,Z.emitRateGradients.push(I)}}var J=M.getStartSizeGradients();if(J){Z.startSizeGradients=[];for(var P=0,H=J;P<H.length;P++){var D=H[P];I={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?I.factor2=D.factor2:I.factor2=D.factor1,Z.startSizeGradients.push(I)}}var l=M.getLifeTimeGradients();if(l){Z.lifeTimeGradients=[];for(var t=0,v=l;t<v.length;t++){var r=v[t];I={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?I.factor2=r.factor2:I.factor2=r.factor1,Z.lifeTimeGradients.push(I)}}var L=M.getLimitVelocityGradients();if(L){Z.limitVelocityGradients=[];for(var ZZ=0,MZ=L;ZZ<MZ.length;ZZ++){var jZ=MZ[ZZ];I={gradient:jZ.gradient,factor1:jZ.factor1};void 0!==jZ.factor2?I.factor2=jZ.factor2:I.factor2=jZ.factor1,Z.limitVelocityGradients.push(I)}Z.limitVelocityDamping=M.limitVelocityDamping}M.noiseTexture&&(Z.noiseTexture=M.noiseTexture.serialize())},M._Parse=function(Z,M,j,b){var g,O,I,o;o=j instanceof x.d?null:j;var c,X=(0,A.b)("BABYLON.Texture");if(X&&o&&(Z.texture?M.particleTexture=X.Parse(Z.texture,o,b):Z.textureName&&(M.particleTexture=new X(b+Z.textureName,o,!1,void 0===Z.invertY||Z.invertY),M.particleTexture.name=Z.textureName)),Z.emitterId||0===Z.emitterId||void 0!==Z.emitter?Z.emitterId&&o?M.emitter=o.getLastMeshById(Z.emitterId):M.emitter=K.k.FromArray(Z.emitter):M.emitter=K.k.Zero(),M.isLocal=!!Z.isLocal,void 0!==Z.renderingGroupId&&(M.renderingGroupId=Z.renderingGroupId),void 0!==Z.isBillboardBased&&(M.isBillboardBased=Z.isBillboardBased),void 0!==Z.billboardMode&&(M.billboardMode=Z.billboardMode),Z.animations){for(var d=0;d<Z.animations.length;d++){var W=Z.animations[d],q=(0,A.b)("BABYLON.Animation");q&&M.animations.push(q.Parse(W))}M.beginAnimationOnStart=Z.beginAnimationOnStart,M.beginAnimationFrom=Z.beginAnimationFrom,M.beginAnimationTo=Z.beginAnimationTo,M.beginAnimationLoop=Z.beginAnimationLoop}if(Z.autoAnimate&&o&&o.beginAnimation(M,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),M.startDelay=0|Z.startDelay,M.minAngularSpeed=Z.minAngularSpeed,M.maxAngularSpeed=Z.maxAngularSpeed,M.minSize=Z.minSize,M.maxSize=Z.maxSize,Z.minScaleX&&(M.minScaleX=Z.minScaleX,M.maxScaleX=Z.maxScaleX,M.minScaleY=Z.minScaleY,M.maxScaleY=Z.maxScaleY),void 0!==Z.preWarmCycles&&(M.preWarmCycles=Z.preWarmCycles,M.preWarmStepOffset=Z.preWarmStepOffset),void 0!==Z.minInitialRotation&&(M.minInitialRotation=Z.minInitialRotation,M.maxInitialRotation=Z.maxInitialRotation),M.minLifeTime=Z.minLifeTime,M.maxLifeTime=Z.maxLifeTime,M.minEmitPower=Z.minEmitPower,M.maxEmitPower=Z.maxEmitPower,M.emitRate=Z.emitRate,M.gravity=K.k.FromArray(Z.gravity),Z.noiseStrength&&(M.noiseStrength=K.k.FromArray(Z.noiseStrength)),M.color1=f.g.FromArray(Z.color1),M.color2=f.g.FromArray(Z.color2),M.colorDead=f.g.FromArray(Z.colorDead),M.updateSpeed=Z.updateSpeed,M.targetStopDuration=Z.targetStopDuration,M.blendMode=Z.blendMode,Z.colorGradients)for(var T=0,B=Z.colorGradients;T<B.length;T++){var N=B[T];M.addColorGradient(N.gradient,f.g.FromArray(N.color1),N.color2?f.g.FromArray(N.color2):void 0)}if(Z.rampGradients){for(var U=0,n=Z.rampGradients;U<n.length;U++){var k=n[U];M.addRampGradient(k.gradient,f.e.FromArray(k.color))}M.useRampGradients=Z.useRampGradients}if(Z.colorRemapGradients)for(var R=0,e=Z.colorRemapGradients;R<e.length;R++){var u=e[R];M.addColorRemapGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2)}if(Z.alphaRemapGradients)for(var F=0,C=Z.alphaRemapGradients;F<C.length;F++){var y=C[F];M.addAlphaRemapGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2)}if(Z.sizeGradients)for(var S=0,h=Z.sizeGradients;S<h.length;S++){var w=h[S];M.addSizeGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2)}if(Z.angularSpeedGradients)for(var p=0,m=Z.angularSpeedGradients;p<m.length;p++){var J=m[p];M.addAngularSpeedGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2)}if(Z.velocityGradients)for(var P=0,H=Z.velocityGradients;P<H.length;P++){var D=H[P];M.addVelocityGradient(D.gradient,void 0!==D.factor1?D.factor1:D.factor,D.factor2)}if(Z.dragGradients)for(var l=0,t=Z.dragGradients;l<t.length;l++){var v=t[l];M.addDragGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2)}if(Z.emitRateGradients)for(var r=0,L=Z.emitRateGradients;r<L.length;r++){var ZZ=L[r];M.addEmitRateGradient(ZZ.gradient,void 0!==ZZ.factor1?ZZ.factor1:ZZ.factor,ZZ.factor2)}if(Z.startSizeGradients)for(var MZ=0,jZ=Z.startSizeGradients;MZ<jZ.length;MZ++){var KZ=jZ[MZ];M.addStartSizeGradient(KZ.gradient,void 0!==KZ.factor1?KZ.factor1:KZ.factor,KZ.factor2)}if(Z.lifeTimeGradients)for(var bZ=0,gZ=Z.lifeTimeGradients;bZ<gZ.length;bZ++){var OZ=gZ[bZ];M.addLifeTimeGradient(OZ.gradient,void 0!==OZ.factor1?OZ.factor1:OZ.factor,OZ.factor2)}if(Z.limitVelocityGradients){for(var QZ=0,YZ=Z.limitVelocityGradients;QZ<YZ.length;QZ++){var IZ=YZ[QZ];M.addLimitVelocityGradient(IZ.gradient,void 0!==IZ.factor1?IZ.factor1:IZ.factor,IZ.factor2)}M.limitVelocityDamping=Z.limitVelocityDamping}if(Z.noiseTexture&&o){var EZ=(0,A.b)("BABYLON.ProceduralTexture");M.noiseTexture=EZ.Parse(Z.noiseTexture,o,b)}if(Z.particleEmitterType){switch(Z.particleEmitterType.type){case"SphereParticleEmitter":c=new z;break;case"SphereDirectedParticleEmitter":c=new V;break;case"ConeEmitter":case"ConeParticleEmitter":c=new Y;break;case"CylinderParticleEmitter":c=new E;break;case"CylinderDirectedParticleEmitter":c=new s;break;case"HemisphericParticleEmitter":c=new i;break;case"PointParticleEmitter":c=new a;break;case"MeshParticleEmitter":c=new G;break;default:c=new Q}c.parse(Z.particleEmitterType,o)}else(c=new Q).parse(Z,o);M.particleEmitterType=c,M.startSpriteCellID=Z.startSpriteCellID,M.endSpriteCellID=Z.endSpriteCellID,M.spriteCellLoop=null===(g=Z.spriteCellLoop)||void 0===g||g,M.spriteCellWidth=Z.spriteCellWidth,M.spriteCellHeight=Z.spriteCellHeight,M.spriteCellChangeSpeed=Z.spriteCellChangeSpeed,M.spriteRandomStartCell=Z.spriteRandomStartCell,M.disposeOnStop=null!==(O=Z.disposeOnStop)&&void 0!==O&&O,M.manualEmitCount=null!==(I=Z.manualEmitCount)&&void 0!==I?I:-1},M.Parse=function(Z,j,K,b,g){void 0===b&&(b=!1);var O,Q=Z.name,Y=null,I=null;if(O=j instanceof x.d?j:j.getEngine(),Z.customShader&&O.createEffectForParticles){var E=(I=Z.customShader).shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"";Y=O.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,E)}var s=new M(Q,g||Z.capacity,j,Y,Z.isAnimationSheetEnabled);if(s.customShader=I,s._rootUrl=K,Z.id&&(s.id=Z.id),Z.subEmitters){s.subEmitters=[];for(var i=0,a=Z.subEmitters;i<a.length;i++){for(var z=[],V=0,o=a[i];V<o.length;V++){var c=o[V];z.push(r.Parse(c,j,K))}s.subEmitters.push(z)}}return M._Parse(Z,s,j,K),Z.textureMask&&(s.textureMask=f.g.FromArray(Z.textureMask)),Z.preventAutoStart&&(s.preventAutoStart=Z.preventAutoStart),b||s.preventAutoStart||s.start(),s},M.BILLBOARDMODE_Y=2,M.BILLBOARDMODE_ALL=7,M.BILLBOARDMODE_STRETCHED=8,M}(X));r._ParseParticleSystem=KZ.Parse;var bZ=j(33048),gZ="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";q.d.IncludesShadersStore.clipPlaneFragmentDeclaration2=gZ;var OZ="precision highp float;\nuniform sampler2D diffuseSampler;\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;\ngl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\ngl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";q.d.ShadersStore.gpuRenderParticlesPixelShader=OZ;var QZ="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nout float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nout float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nout float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nout float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nout float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nout float fClipDistance6;\n#endif\n";q.d.IncludesShadersStore.clipPlaneVertexDeclaration2=QZ;var YZ="precision highp float;\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\nuniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;\nattribute float age;\nattribute float life;\nattribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;\nattribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);\nfloat columnOffset=cellIndex-rowOffset*sheetInfos.z;\nvec2 uvScale=sheetInfos.xy;\nvec2 uvOffset=vec2(uv.x ,1.0-uv.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=age/life;\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;\n#ifdef BILLBOARD\nvec4 rotatedCorner;\nrotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=(position+worldOffset)-eyePosition;\nyaxis.y=0.;\nvPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=(position+worldOffset)-eyePosition;\nvPositionW=rotateAlign(toCamera,rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=0.;\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nvec3 yaxis=normalize(initialDirection);\nvPositionW=rotate(yaxis,rotatedCorner);\nvec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n}";q.d.ShadersStore.gpuRenderParticlesVertexShader=YZ;var IZ=function(Z){function M(M,j,b,g,O){void 0===g&&(g=null),void 0===O&&(O=!1);var Y=Z.call(this,M)||this;if(Y.layerMask=268435455,Y._accumulatedCount=0,Y._targetIndex=0,Y._currentRenderId=-1,Y._currentRenderingCameraUniqueId=-1,Y._started=!1,Y._stopped=!1,Y._timeDelta=0,Y._actualFrame=0,Y._rawTextureWidth=256,Y.onDisposeObservable=new H.b,Y.onStoppedObservable=new H.b,Y.forceDepthWrite=!1,Y._preWarmDone=!1,Y.isLocal=!1,Y._onBeforeDrawParticlesObservable=null,b&&"Scene"!==b.getClassName()?(Y._engine=b,Y.defaultProjectionMatrix=K.c.PerspectiveFovLH(.8,1,.1,100,Y._engine.isNDCHalfZRange)):(Y._scene=b||l.e.LastCreatedScene,Y._engine=Y._scene.getEngine(),Y.uniqueId=Y._scene.getUniqueId(),Y._scene.particleSystems.push(Y)),Y._engine.getCaps().supportComputeShaders){if(!(0,A.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");Y._platform=new((0,A.b)("BABYLON.ComputeShaderParticleSystem"))(Y,Y._engine)}else{if(!(0,A.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");Y._platform=new((0,A.b)("BABYLON.WebGL2ParticleSystem"))(Y,Y._engine)}Y._customWrappers={0:new L.e(Y._engine)},Y._customWrappers[0].effect=g,Y._drawWrappers={0:new L.e(Y._engine)},Y._drawWrappers[0].drawContext&&(Y._drawWrappers[0].drawContext.useInstancing=!0),Y._attachImageProcessingConfiguration(null),(j=null!==j&&void 0!==j?j:{}).randomTextureSize||delete j.randomTextureSize;var E=(0,I.e)({capacity:5e4,randomTextureSize:Y._engine.getCaps().maxTextureSize},j),s=j;isFinite(s)&&(E.capacity=s),Y._capacity=E.capacity,Y._activeCount=E.capacity,Y._currentActiveCount=0,Y._isAnimationSheetEnabled=O,Y.particleEmitterType=new Q;for(var i=Math.min(Y._engine.getCaps().maxTextureSize,E.randomTextureSize),a=[],z=0;z<i;++z)a.push(Math.random()),a.push(Math.random()),a.push(Math.random()),a.push(Math.random());Y._randomTexture=new D.d(new Float32Array(a),i,1,5,b,!1,!1,1,1),Y._randomTexture.name="GPUParticleSystem_random1",Y._randomTexture.wrapU=1,Y._randomTexture.wrapV=1,a=[];for(z=0;z<i;++z)a.push(Math.random()),a.push(Math.random()),a.push(Math.random()),a.push(Math.random());return Y._randomTexture2=new D.d(new Float32Array(a),i,1,5,b,!1,!1,1,1),Y._randomTexture2.name="GPUParticleSystem_random2",Y._randomTexture2.wrapU=1,Y._randomTexture2.wrapV=1,Y._randomTextureSize=i,Y}return(0,I.m)(M,Z),Object.defineProperty(M,"IsSupported",{get:function(){if(!l.e.LastCreatedEngine)return!1;var Z=l.e.LastCreatedEngine.getCaps();return Z.supportTransformFeedbacks||Z.supportComputeShaders},enumerable:!1,configurable:!0}),M.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(M.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(Z){this._activeCount=Math.min(Z,this._capacity)},enumerable:!1,configurable:!0}),M.prototype.isReady=function(){if(!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==KZ.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(KZ.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(KZ.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)},M.prototype.isStarted=function(){return this._started},M.prototype.isStopped=function(){return this._stopped},M.prototype.isStopping=function(){return!1},M.prototype.getActiveCount=function(){return this._currentActiveCount},M.prototype.start=function(Z){var M=this;if(void 0===Z&&(Z=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";Z?setTimeout((function(){M.start(0)}),Z):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},M.prototype.stop=function(){this._stopped||(this._stopped=!0)},M.prototype.reset=function(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0},M.prototype.getClassName=function(){return"GPUParticleSystem"},M.prototype.getCustomEffect=function(Z){var M,j;return void 0===Z&&(Z=0),null!==(j=null===(M=this._customWrappers[Z])||void 0===M?void 0:M.effect)&&void 0!==j?j:this._customWrappers[0].effect},M.prototype._getCustomDrawWrapper=function(Z){var M;return void 0===Z&&(Z=0),null!==(M=this._customWrappers[Z])&&void 0!==M?M:this._customWrappers[0]},M.prototype.setCustomEffect=function(Z,M){void 0===M&&(M=0),this._customWrappers[M]=new L.e(this._engine),this._customWrappers[M].effect=Z},Object.defineProperty(M.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new H.b),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"vertexShaderName",{get:function(){return"gpuRenderParticles"},enumerable:!1,configurable:!0}),M.prototype._removeGradientAndTexture=function(M,j,K){return Z.prototype._removeGradientAndTexture.call(this,M,j,K),this._releaseBuffers(),this},M.prototype.addColorGradient=function(Z,M){this._colorGradients||(this._colorGradients=[]);var j=new p(Z,M);return this._colorGradients.push(j),this._refreshColorGradient(!0),this._releaseBuffers(),this},M.prototype._refreshColorGradient=function(Z){void 0===Z&&(Z=!1),this._colorGradients&&(Z&&this._colorGradients.sort((function(Z,M){return Z.gradient<M.gradient?-1:Z.gradient>M.gradient?1:0})),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))},M.prototype.forceRefreshGradients=function(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()},M.prototype.removeColorGradient=function(Z){return this._removeGradientAndTexture(Z,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},M.prototype.resetDrawCache=function(){var Z;for(var M in this._drawWrappers){null===(Z=this._drawWrappers[M].drawContext)||void 0===Z||Z.reset()}},M.prototype._addFactorGradient=function(Z,M,j){var K=new J(M,j);Z.push(K),this._releaseBuffers()},M.prototype.addSizeGradient=function(Z,M){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,Z,M),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this},M.prototype.removeSizeGradient=function(Z){return this._removeGradientAndTexture(Z,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},M.prototype._refreshFactorGradient=function(Z,M,j){if(void 0===j&&(j=!1),Z){j&&Z.sort((function(Z,M){return Z.gradient<M.gradient?-1:Z.gradient>M.gradient?1:0}));var K=this;K[M]&&(K[M].dispose(),K[M]=null)}},M.prototype.addAngularSpeedGradient=function(Z,M){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,Z,M),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this},M.prototype.removeAngularSpeedGradient=function(Z){return this._removeGradientAndTexture(Z,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},M.prototype.addVelocityGradient=function(Z,M){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,Z,M),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this},M.prototype.removeVelocityGradient=function(Z){return this._removeGradientAndTexture(Z,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},M.prototype.addLimitVelocityGradient=function(Z,M){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,Z,M),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this},M.prototype.removeLimitVelocityGradient=function(Z){return this._removeGradientAndTexture(Z,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},M.prototype.addDragGradient=function(Z,M){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,Z,M),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this},M.prototype.removeDragGradient=function(Z){return this._removeGradientAndTexture(Z,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},M.prototype.addEmitRateGradient=function(){return this},M.prototype.removeEmitRateGradient=function(){return this},M.prototype.addStartSizeGradient=function(){return this},M.prototype.removeStartSizeGradient=function(){return this},M.prototype.addColorRemapGradient=function(){return this},M.prototype.removeColorRemapGradient=function(){return this},M.prototype.addAlphaRemapGradient=function(){return this},M.prototype.removeAlphaRemapGradient=function(){return this},M.prototype.addRampGradient=function(){return this},M.prototype.removeRampGradient=function(){return this},M.prototype.getRampGradients=function(){return null},Object.defineProperty(M.prototype,"useRampGradients",{get:function(){return!1},set:function(Z){},enumerable:!1,configurable:!0}),M.prototype.addLifeTimeGradient=function(){return this},M.prototype.removeLifeTimeGradient=function(){return this},M.prototype._reset=function(){this._releaseBuffers()},M.prototype._createVertexBuffers=function(Z,M,j){var K={};K.position=M.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);var b=3;K.age=M.createVertexBuffer("age",b,1,this._attributesStrideSize,!0),b+=1,K.size=M.createVertexBuffer("size",b,3,this._attributesStrideSize,!0),b+=3,K.life=M.createVertexBuffer("life",b,1,this._attributesStrideSize,!0),b+=1,b+=4,this.billboardMode===KZ.BILLBOARDMODE_STRETCHED&&(K.direction=M.createVertexBuffer("direction",b,3,this._attributesStrideSize,!0)),b+=3,this._platform.alignDataInBuffer&&(b+=1),this.particleEmitterType instanceof o&&(b+=3,this._platform.alignDataInBuffer&&(b+=1)),this._colorGradientsTexture||(K.color=M.createVertexBuffer("color",b,4,this._attributesStrideSize,!0),b+=4),this._isBillboardBased||(K.initialDirection=M.createVertexBuffer("initialDirection",b,3,this._attributesStrideSize,!0),b+=3,this._platform.alignDataInBuffer&&(b+=1)),this.noiseTexture&&(K.noiseCoordinates1=M.createVertexBuffer("noiseCoordinates1",b,3,this._attributesStrideSize,!0),b+=3,this._platform.alignDataInBuffer&&(b+=1),K.noiseCoordinates2=M.createVertexBuffer("noiseCoordinates2",b,3,this._attributesStrideSize,!0),b+=3,this._platform.alignDataInBuffer&&(b+=1)),K.angle=M.createVertexBuffer("angle",b,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?b++:b+=2,this._isAnimationSheetEnabled&&(K.cellIndex=M.createVertexBuffer("cellIndex",b,1,this._attributesStrideSize,!0),b+=1,this.spriteRandomStartCell&&(K.cellStartOffset=M.createVertexBuffer("cellStartOffset",b,1,this._attributesStrideSize,!0),b+=1)),K.offset=j.createVertexBuffer("offset",0,2),K.uv=j.createVertexBuffer("uv",2,2),this._platform.createVertexBuffers(Z,K),this.resetDrawCache()},M.prototype._initialize=function(Z){if(void 0===Z&&(Z=!1),!this._buffer0||Z){var M=this._engine,j=new Array;this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof o&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));for(var b=this.particleEmitterType instanceof o,g=K.e.Vector3[0],O=0,Q=0;Q<this._capacity;Q++)if(j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),b?(this.particleEmitterType.particleDestinationGenerator(Q,null,g),j.push(g.x),j.push(g.y),j.push(g.z)):(j.push(0),j.push(0),j.push(0)),this._platform.alignDataInBuffer&&j.push(0),O+=16,b&&(this.particleEmitterType.particlePositionGenerator(Q,null,g),j.push(g.x),j.push(g.y),j.push(g.z),this._platform.alignDataInBuffer&&j.push(0),O+=4),this._colorGradientsTexture||(j.push(0),j.push(0),j.push(0),j.push(0),O+=4),this.isBillboardBased||(j.push(0),j.push(0),j.push(0),this._platform.alignDataInBuffer&&j.push(0),O+=4),this.noiseTexture&&(j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),this._platform.alignDataInBuffer&&j.push(0),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),this._platform.alignDataInBuffer&&j.push(0),O+=8),j.push(0),O+=1,this._angularSpeedGradientsTexture||(j.push(0),O+=1),this._isAnimationSheetEnabled&&(j.push(0),O+=1,this.spriteRandomStartCell&&(j.push(0),O+=1)),this._platform.alignDataInBuffer){var Y=3-(O+3&3);for(O+=Y;Y-- >0;)j.push(0)}var I=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),E=this._platform.createParticleBuffer(j),s=this._platform.createParticleBuffer(j);this._buffer0=new c.e(M,E,!1,this._attributesStrideSize),this._buffer1=new c.e(M,s,!1,this._attributesStrideSize),this._spriteBuffer=new c.e(M,I,!1,4),this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},M.prototype._recreateUpdateEffect=function(){var Z=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(Z+="\n#define BILLBOARD"),this._colorGradientsTexture&&(Z+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(Z+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(Z+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(Z+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(Z+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(Z+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(Z+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(Z+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(Z+="\n#define NOISE"),this.isLocal&&(Z+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===Z||(this._cachedUpdateDefines=Z,this._updateBuffer=this._platform.createUpdateBuffer(Z))},M.prototype._getWrapper=function(Z){var M=this._getCustomDrawWrapper(Z);if(null===M||void 0===M?void 0:M.effect)return M;var j=[];this.fillDefines(j,Z);var K=this._drawWrappers[Z];K||((K=new L.e(this._engine)).drawContext&&(K.drawContext.useInstancing=!0),this._drawWrappers[Z]=K);var b=j.join("\n");if(K.defines!==b){var g=[],O=[],Q=[];this.fillUniformsAttributesAndSamplerNames(O,g,Q),K.setEffect(this._engine.createEffect("gpuRenderParticles",g,O,Q,b),b)}return K},M._GetAttributeNamesOrOptions=function(Z,M,j,K){void 0===Z&&(Z=!1),void 0===M&&(M=!1),void 0===j&&(j=!1),void 0===K&&(K=!1);var b=[c.f.PositionKind,"age","life","size","angle"];return Z||b.push(c.f.ColorKind),M&&b.push("cellIndex"),j||b.push("initialDirection"),K||b.push("direction"),b.push("offset",c.f.UVKind),b},M._GetEffectCreationOptions=function(Z){void 0===Z&&(Z=!1);var M=["emitterWM","worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","translationPivot","eyePosition"];return Z&&M.push("sheetInfos"),M},M.prototype.fillDefines=function(Z,M){if(void 0===M&&(M=0),this._scene&&(this._scene.clipPlane&&Z.push("#define CLIPPLANE"),this._scene.clipPlane2&&Z.push("#define CLIPPLANE2"),this._scene.clipPlane3&&Z.push("#define CLIPPLANE3"),this._scene.clipPlane4&&Z.push("#define CLIPPLANE4"),this._scene.clipPlane5&&Z.push("#define CLIPPLANE5"),this._scene.clipPlane6&&Z.push("#define CLIPPLANE6")),M===KZ.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this.isLocal&&Z.push("#define LOCAL"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case KZ.BILLBOARDMODE_Y:Z.push("#define BILLBOARDY");break;case KZ.BILLBOARDMODE_STRETCHED:Z.push("#define BILLBOARDSTRETCHED");break;case KZ.BILLBOARDMODE_ALL:Z.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&Z.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(""+this._imageProcessingConfigurationDefines.toString()))},M.prototype.fillUniformsAttributesAndSamplerNames=function(Z,j,K){j.push.apply(j,M._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===KZ.BILLBOARDMODE_STRETCHED)),Z.push.apply(Z,M._GetEffectCreationOptions(this._isAnimationSheetEnabled)),K.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(b.e.PrepareUniforms(Z,this._imageProcessingConfigurationDefines),b.e.PrepareSamplers(K,this._imageProcessingConfigurationDefines))},M.prototype.animate=function(Z){var M;void 0===Z&&(Z=!1),this._timeDelta=this.updateSpeed*(Z?this.preWarmStepOffset:(null===(M=this._scene)||void 0===M?void 0:M.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},M.prototype._createFactorGradientTexture=function(Z,M){var j=this[M];if(Z&&Z.length&&!j){for(var K=new Float32Array(this._rawTextureWidth),b=function(M){var j=M/g._rawTextureWidth;P.GetCurrentGradient(j,Z,(function(Z,j,b){K[M]=O.b.Lerp(Z.factor1,j.factor1,b)}))},g=this,Q=0;Q<this._rawTextureWidth;Q++)b(Q);this[M]=D.d.CreateRTexture(K,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1)}},M.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},M.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},M.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},M.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},M.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},M.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var Z=new Uint8Array(4*this._rawTextureWidth),M=f.h.Color4[0],j=function(j){var b=j/K._rawTextureWidth;P.GetCurrentGradient(b,K._colorGradients,(function(K,b,g){f.g.LerpToRef(K.color1,b.color1,g,M),Z[4*j]=255*M.r,Z[4*j+1]=255*M.g,Z[4*j+2]=255*M.b,Z[4*j+3]=255*M.a}))},K=this,b=0;b<this._rawTextureWidth;b++)j(b);this._colorGradientsTexture=D.d.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1)}},M.prototype._render=function(Z,M){var j,b,g=this._getWrapper(Z),O=g.effect;this._engine.enableEffect(g);var Q=(null===(j=this._scene)||void 0===j?void 0:j.getViewMatrix())||K.c.IdentityReadOnly;if(O.setMatrix("view",Q),O.setMatrix("projection",null!==(b=this.defaultProjectionMatrix)&&void 0!==b?b:this._scene.getProjectionMatrix()),O.setTexture("diffuseSampler",this.particleTexture),O.setVector2("translationPivot",this.translationPivot),O.setVector3("worldOffset",this.worldOffset),this.isLocal&&O.setMatrix("emitterWM",M),this._colorGradientsTexture?O.setTexture("colorGradientSampler",this._colorGradientsTexture):O.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var Y=this.particleTexture.getBaseSize();O.setFloat3("sheetInfos",this.spriteCellWidth/Y.width,this.spriteCellHeight/Y.height,Y.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){var I=this._scene.activeCamera;O.setVector3("eyePosition",I.globalPosition)}var E=O.defines;if(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&bZ.b.BindClipPlane(O,this._scene),E.indexOf("#define BILLBOARDMODE_ALL")>=0){var s=Q.clone();s.invert(),O.setMatrix("invView",s)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(O),Z){case KZ.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case KZ.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case KZ.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case KZ.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,O),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(O),this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),this._currentActiveCount},M.prototype.render=function(Z,M){if(void 0===Z&&(Z=!1),void 0===M&&(M=!1),!this._started)return 0;if(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),!this.isReady())return 0;if(!Z&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(var j=0;j<this.preWarmCycles;j++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getFrameId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var b=0|this._accumulatedCount;this._accumulatedCount-=b,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+b)}if(!this._currentActiveCount)return 0;var g;if(this.emitter.position){g=this.emitter.getWorldMatrix()}else{var O=this.emitter;g=K.c.Translation(O.x,O.y,O.z)}var Q=this._engine;this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",g),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount);var Y=0;Z||M||(Q.setState(!1),this.forceDepthWrite&&Q.setDepthWrite(!0),Y=this.blendMode===KZ.BLENDMODE_MULTIPLYADD?this._render(KZ.BLENDMODE_MULTIPLY,g)+this._render(KZ.BLENDMODE_ADD,g):this._render(this.blendMode,g),this._engine.setAlphaMode(0)),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);var I=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=I,Y},M.prototype.rebuild=function(){this._initialize(!0)},M.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()},M.prototype.dispose=function(Z){for(var M in void 0===Z&&(Z=!0),this._drawWrappers){this._drawWrappers[M].dispose()}if(this._drawWrappers={},this._scene){var j=this._scene.particleSystems.indexOf(this);j>-1&&this._scene.particleSystems.splice(j,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},M.prototype.clone=function(Z,j){var K=(0,I.e)({},this._customWrappers),b=null,g=this._engine;if(g.createEffectForParticles&&null!=this.customShader){var O=(b=this.customShader).shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"";K[0]=g.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,O,void 0,void 0,void 0,this)}var Q=this.serialize(),Y=M.Parse(Q,this._scene||this._engine,this._rootUrl);return Y.name=Z,Y.customShader=b,Y._customWrappers=K,void 0===j&&(j=this.emitter),this.noiseTexture&&(Y.noiseTexture=this.noiseTexture.clone()),Y.emitter=j,Y},M.prototype.serialize=function(Z){void 0===Z&&(Z=!1);var M={};return KZ._Serialize(M,this,Z),M.activeParticleCount=this.activeParticleCount,M.randomTextureSize=this._randomTextureSize,M.customShader=this.customShader,M},M.Parse=function(Z,j,K,b,g){void 0===b&&(b=!1);var O,Q=Z.name;O=j instanceof x.d?j:j.getEngine();var Y=new M(Q,{capacity:g||Z.capacity,randomTextureSize:Z.randomTextureSize},j,null,Z.isAnimationSheetEnabled);if(Y._rootUrl=K,Z.customShader&&O.createEffectForParticles){var I=Z.customShader,E=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"",s=O.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,E,void 0,void 0,void 0,Y);Y.setCustomEffect(s,0),Y.customShader=I}return Z.id&&(Y.id=Z.id),Z.activeParticleCount&&(Y.activeParticleCount=Z.activeParticleCount),KZ._Parse(Z,Y,j,K),Z.preventAutoStart&&(Y.preventAutoStart=Z.preventAutoStart),b||Y.preventAutoStart||Y.start(),Y},M}(X),EZ=j(9217),sZ=j(71898),iZ=j(87683),aZ=function(){function Z(){this._emitterNodeIsOwned=!0,this.systems=new Array}return Object.defineProperty(Z.prototype,"emitterNode",{get:function(){return this._emitterNode},set:function(Z){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(var M=0,j=this.systems;M<j.length;M++){j[M].emitter=Z}this._emitterNode=Z},enumerable:!1,configurable:!0}),Z.prototype.setEmitterAsSphere=function(Z,M,j){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:Z,renderingGroupId:M};var K=(0,sZ.e)("emitterSphere",{diameter:Z.diameter,segments:Z.segments},j);K.renderingGroupId=M;var b=new iZ.c("emitterSphereMaterial",j);b.emissiveColor=Z.color,K.material=b;for(var g=0,O=this.systems;g<O.length;g++){O[g].emitter=K}this._emitterNode=K},Z.prototype.start=function(Z){for(var M=0,j=this.systems;M<j.length;M++){var K=j[M];Z&&(K.emitter=Z),K.start()}},Z.prototype.dispose=function(){for(var Z=0,M=this.systems;Z<M.length;Z++){M[Z].dispose()}this.systems=[],this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)},Z.prototype.serialize=function(Z){void 0===Z&&(Z=!1);for(var M={systems:[]},j=0,K=this.systems;j<K.length;j++){var b=K[j];M.systems.push(b.serialize(Z))}return this._emitterNode&&(M.emitter=this._emitterCreationOptions),M},Z.Parse=function(M,j,K,b){void 0===K&&(K=!1);var g=new Z,O=this.BaseAssetsUrl+"/textures/";j=j||l.e.LastCreatedScene;for(var Q=0,Y=M.systems;Q<Y.length;Q++){var I=Y[Q];g.systems.push(K?IZ.Parse(I,j,O,!0,b):KZ.Parse(I,j,O,!0,b))}if(M.emitter){var E=M.emitter.options;if("Sphere"===M.emitter.kind)g.setEmitterAsSphere({diameter:E.diameter,segments:E.segments,color:f.e.FromArray(E.color)},M.emitter.renderingGroupId,j)}return g},Z.BaseAssetsUrl="https://assets.babylonjs.com/particles",Z}(),zZ=j(67935),VZ=(function(){function Z(){}Z.CreateDefault=function(Z,M,j,K){var b;return void 0===M&&(M=500),void 0===K&&(K=!1),(b=K?new IZ("default system",{capacity:M},j):new KZ("default system",M,j)).emitter=Z,b.particleTexture=new R.b("https://assets.babylonjs.com/textures/flare.png",b.getScene()),b.createConeEmitter(.1,Math.PI/4),b.color1=new f.g(1,1,1,1),b.color2=new f.g(1,1,1,1),b.colorDead=new f.g(1,1,1,0),b.minSize=.1,b.maxSize=.1,b.minEmitPower=2,b.maxEmitPower=2,b.updateSpeed=1/60,b.emitRate=30,b},Z.CreateAsync=function(M,j,K,b){void 0===K&&(K=!1),j||(j=l.e.LastCreatedScene);var g={};return j._addPendingData(g),new Promise((function(O,Q){if(K&&!IZ.IsSupported)return j._removePendingData(g),Q("Particle system with GPU is not supported.");EZ.d.LoadFile("".concat(Z.BaseAssetsUrl,"/systems/").concat(M,".json"),(function(Z){j._removePendingData(g);var M=JSON.parse(Z.toString());return O(aZ.Parse(M,j,K,b))}),void 0,void 0,void 0,(function(){return j._removePendingData(g),Q("An error occurred with the creation of your particle system. Check if your type '".concat(M,"' exists."))}))}))},Z.ExportSet=function(Z){for(var M=new aZ,j=0,K=Z;j<K.length;j++){var b=K[j];M.systems.push(b)}return M},Z.ParseFromFileAsync=function(Z,M,j,K,b,g){return void 0===K&&(K=!1),void 0===b&&(b=""),new Promise((function(O,Q){var Y=new zZ.e;Y.addEventListener("readystatechange",(function(){if(4==Y.readyState)if(200==Y.status){var M=JSON.parse(Y.responseText),I=void 0;I=K?IZ.Parse(M,j,b,!1,g):KZ.Parse(M,j,b,!1,g),Z&&(I.name=Z),O(I)}else Q("Unable to load the particle system")})),Y.open("GET",M),Y.send()}))},Z.CreateFromSnippetAsync=function(Z,M,j,K,b){var g=this;if(void 0===j&&(j=!1),void 0===K&&(K=""),"_BLANK"===Z){var O=this.CreateDefault(null);return O.start(),Promise.resolve(O)}return new Promise((function(O,Q){var Y=new zZ.e;Y.addEventListener("readystatechange",(function(){if(4==Y.readyState)if(200==Y.status){var g=JSON.parse(JSON.parse(Y.responseText).jsonPayload),I=JSON.parse(g.particleSystem),E=void 0;(E=j?IZ.Parse(I,M,K,!1,b):KZ.Parse(I,M,K,!1,b)).snippetId=Z,O(E)}else Q("Unable to load the snippet "+Z)})),Y.open("GET",g.SnippetUrl+"/"+Z.replace(/#/g,"/")),Y.send()}))},Z.BaseAssetsUrl=aZ.BaseAssetsUrl,Z.SnippetUrl="https://snippet.babylonjs.com"}(),j(65847)),oZ=j(60569),cZ=j(90690),GZ=j(21693);oZ.d.AddParser(GZ.d.NAME_PARTICLESYSTEM,(function(Z,M,j,K){var b=oZ.d.GetIndividualParser(GZ.d.NAME_PARTICLESYSTEM);if(b&&void 0!==Z.particleSystems&&null!==Z.particleSystems)for(var g=0,O=Z.particleSystems.length;g<O;g++){var Q=Z.particleSystems[g];j.particleSystems.push(b(Q,M,K))}})),oZ.d.AddIndividualParser(GZ.d.NAME_PARTICLESYSTEM,(function(Z,M,j){return Z.activeParticleCount?IZ.Parse(Z,M,j):KZ.Parse(Z,M,j)})),cZ.c.prototype.createEffectForParticles=function(Z,M,j,K,b,g,O,Q){var Y;void 0===M&&(M=[]),void 0===j&&(j=[]),void 0===K&&(K="");var I=[],E=[],s=[];return Q?Q.fillUniformsAttributesAndSamplerNames(E,I,s):(I=KZ._GetAttributeNamesOrOptions(),E=KZ._GetEffectCreationOptions()),-1===K.indexOf(" BILLBOARD")&&(K+="\n#define BILLBOARD\n"),-1===j.indexOf("diffuseSampler")&&j.push("diffuseSampler"),this.createEffect({vertex:null!==(Y=null===Q||void 0===Q?void 0:Q.vertexShaderName)&&void 0!==Y?Y:"particles",fragmentElement:Z},I,E.concat(M),s.concat(j),K,b,g,O)},VZ.b.prototype.getEmittedParticleSystems=function(){for(var Z=new Array,M=0;M<this.getScene().particleSystems.length;M++){var j=this.getScene().particleSystems[M];j.emitter===this&&Z.push(j)}return Z},VZ.b.prototype.getHierarchyEmittedParticleSystems=function(){var Z=new Array,M=this.getDescendants();M.push(this);for(var j=0;j<this.getScene().particleSystems.length;j++){var K=this.getScene().particleSystems[j],b=K.emitter;b.position&&-1!==M.indexOf(b)&&Z.push(K)}return Z};var fZ,XZ=j(97918),dZ=j(70176),WZ=j(52644),AZ=function(){function Z(Z,M,j,b,g,O,Q,Y,I,E){void 0===I&&(I=null),void 0===E&&(E=null),this.idx=0,this.id=0,this.color=new f.g(1,1,1,1),this.position=K.k.Zero(),this.rotation=K.k.Zero(),this.scaling=K.k.One(),this.uvs=new K.l(0,0,1,1),this.velocity=K.k.Zero(),this.pivot=K.k.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.props=null,this.cullingStrategy=WZ.b.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=K.k.Zero(),this.idx=Z,this.id=M,this._pos=j,this._ind=b,this._model=g,this.shapeId=O,this.idxInShape=Q,this._sps=Y,I&&(this._modelBoundingInfo=I,this._boundingInfo=new XZ.c(I.minimum,I.maximum)),null!==E&&(this.materialIndex=E)}return Z.prototype.getBoundingInfo=function(){return this._boundingInfo},Object.defineProperty(Z.prototype,"hasBoundingInfo",{get:function(){return null!==this._boundingInfo},enumerable:!1,configurable:!0}),Z.prototype.copyToRef=function(Z){return Z.position.copyFrom(this.position),Z.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(Z.rotationQuaternion?Z.rotationQuaternion.copyFrom(this.rotationQuaternion):Z.rotationQuaternion=this.rotationQuaternion.clone()),Z.scaling.copyFrom(this.scaling),this.color&&(Z.color?Z.color.copyFrom(this.color):Z.color=this.color.clone()),Z.uvs.copyFrom(this.uvs),Z.velocity.copyFrom(this.velocity),Z.pivot.copyFrom(this.pivot),Z.translateFromPivot=this.translateFromPivot,Z.alive=this.alive,Z.isVisible=this.isVisible,Z.parentId=this.parentId,Z.cullingStrategy=this.cullingStrategy,null!==this.materialIndex&&(Z.materialIndex=this.materialIndex),this},Object.defineProperty(Z.prototype,"scale",{get:function(){return this.scaling},set:function(Z){this.scaling=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(Z){this.rotationQuaternion=Z},enumerable:!1,configurable:!0}),Z.prototype.intersectsMesh=function(Z){return!(!this._boundingInfo||!Z.hasBoundingInfo)&&(this._sps._bSphereOnly?dZ.c.Intersects(this._boundingInfo.boundingSphere,Z.getBoundingInfo().boundingSphere):this._boundingInfo.intersects(Z.getBoundingInfo(),!1))},Z.prototype.isInFrustum=function(Z){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(Z,this.cullingStrategy)},Z.prototype.getRotationMatrix=function(Z){var M;if(this.rotationQuaternion)M=this.rotationQuaternion;else{M=K.e.Quaternion[0];var j=this.rotation;K.d.RotationYawPitchRollToRef(j.y,j.x,j.z,M)}M.toRotationMatrix(Z)},Z}(),qZ=function(){function Z(Z,M,j,K,b,g,O,Q,Y){this._indicesLength=0,this.shapeId=Z,this._shape=M,this._indices=j,this._indicesLength=j.length,this._shapeUV=g,this._shapeColors=b,this._normals=K,this._positionFunction=O,this._vertexFunction=Q,this._material=Y}return Object.defineProperty(Z.prototype,"shapeID",{get:function(){return this.shapeId},set:function(Z){this.shapeId=Z},enumerable:!1,configurable:!0}),Z}(),TZ=function(Z,M,j,K){this.idx=0,this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.idx=Z,this.ind=M,this.indicesLength=j,this.materialIndex=K},BZ=function(){function Z(){this.position=K.k.Zero(),this.color=new f.g(1,1,1,1),this.uv=K.h.Zero()}return Object.defineProperty(Z.prototype,"x",{get:function(){return this.position.x},set:function(Z){this.position.x=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"y",{get:function(){return this.position.y},set:function(Z){this.position.y=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"z",{get:function(){return this.position.z},set:function(Z){this.position.z=Z},enumerable:!1,configurable:!0}),Z}(),NZ=j(85779),UZ=j(60612),nZ=j(54044),kZ=j(50384),xZ=j(49443),RZ=(function(){function Z(Z,M,j){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new AZ(0,0,0,0,null,0,0,this),this._color=new f.g(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=function(Z,M){return M.sqDistance-Z.sqDistance},this._materialSortFunction=function(Z,M){return Z.materialIndex-M.materialIndex},this._autoUpdateSubMeshes=!1,this.name=Z,this._scene=M||l.e.LastCreatedScene,this._camera=M.activeCamera,this._pickable=!!j&&j.isPickable,this._depthSort=!!j&&j.enableDepthSort,this._multimaterialEnabled=!!j&&j.enableMultiMaterial,this._useModelMaterial=!!j&&j.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!j&&j.expandable,this._particlesIntersect=!!j&&j.particleIntersection,this._bSphereOnly=!!j&&j.boundingSphereOnly,this._bSphereRadiusFactor=j&&j.bSphereRadiusFactor?j.bSphereRadiusFactor:1,j&&void 0!==j.updatable?this._updatable=j.updatable:this._updatable=!0,this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new xZ.e(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={}),this._tmpVertex=new BZ}Z.prototype.buildMesh=function(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(0===this.nbParticles&&!this.mesh){var Z=(0,UZ.b)("",{radius:1,tessellation:3},this._scene);this.addShape(Z,1),Z.dispose()}if(this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){var M=new VZ.b(this.name,this._scene);this.mesh=M}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&NZ.e.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var j=new NZ.e;if(j.indices=this._depthSort?this._indices:this._indices32,j.set(this._positions32,c.f.PositionKind),j.set(this._normals32,c.f.NormalKind),this._uvs32.length>0&&j.set(this._uvs32,c.f.UVKind),this._colors32.length>0&&j.set(this._colors32,c.f.ColorKind),j.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._pickable)for(var K=0,b=0;b<this.nbParticles;b++)for(var g=this.particles[b],O=g._model._indicesLength,Q=0;Q<O;Q++){if(0==Q%3){var Y={idx:g.idx,faceId:K};this.pickedParticles[K]=Y,K++}}return this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this.mesh},Z.prototype.digest=function(Z,M){var j=M&&M.facetNb||1,b=M&&M.number||0,g=M&&M.delta||0,O=Z.getVerticesData(c.f.PositionKind),Q=Z.getIndices(),Y=Z.getVerticesData(c.f.UVKind),I=Z.getVerticesData(c.f.ColorKind),E=Z.getVerticesData(c.f.NormalKind),s=M&&M.storage?M.storage:null,i=0,a=Q.length/3;b?(b=b>a?a:b,j=Math.round(a/b),g=0):j=j>a?a:j;for(var z=[],V=[],o=[],G=[],f=[],X=K.k.Zero(),d=j;i<a;){i>a-(j=d+Math.floor((1+g)*Math.random()))&&(j=a-i),z.length=0,V.length=0,o.length=0,G.length=0,f.length=0;for(var W=0,A=3*i;A<3*(i+j);A++){o.push(W);var q=Q[A],T=3*q;if(z.push(O[T],O[T+1],O[T+2]),V.push(E[T],E[T+1],E[T+2]),Y){var B=2*q;G.push(Y[B],Y[B+1])}if(I){var N=4*q;f.push(I[N],I[N+1],I[N+2],I[N+3])}W++}var U=this.nbParticles,n=this._posToShape(z),k=this._uvsToShapeUV(G),x=o.slice(),R=f.slice(),e=V.slice();X.copyFromFloats(0,0,0);var u=void 0;for(u=0;u<n.length;u++)X.addInPlace(n[u]);X.scaleInPlace(1/n.length);var F=new K.k(1/0,1/0,1/0),C=new K.k(-1/0,-1/0,-1/0);for(u=0;u<n.length;u++)n[u].subtractInPlace(X),F.minimizeInPlaceFromFloats(n[u].x,n[u].y,n[u].z),C.maximizeInPlaceFromFloats(n[u].x,n[u].y,n[u].z);var y=void 0;this._particlesIntersect&&(y=new XZ.c(F,C));var S=null;this._useModelMaterial&&(S=Z.material?Z.material:this._setDefaultMaterial());var h=new qZ(this._shapeCounter,n,x,e,R,k,null,null,S),w=this._positions.length,p=this._indices.length;this._meshBuilder(this._index,p,n,this._positions,x,this._indices,G,this._uvs,R,this._colors,e,this._normals,U,0,null,h),this._addParticle(U,this._lastParticleId,w,p,h,this._shapeCounter,0,y,s),this.particles[this.nbParticles].position.addInPlace(X),s||(this._index+=n.length,U++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,i+=j}return this._isNotBuilt=!0,this},Z.prototype._unrotateFixedNormals=function(){for(var Z=0,M=0,j=K.e.Vector3[0],b=K.e.Quaternion[0],g=K.e.Matrix[0],O=0;O<this.particles.length;O++){var Q=this.particles[O],Y=Q._model._shape;if(Q.rotationQuaternion)Q.rotationQuaternion.conjugateToRef(b);else{var I=Q.rotation;K.d.RotationYawPitchRollToRef(I.y,I.x,I.z,b),b.conjugateInPlace()}b.toRotationMatrix(g);for(var E=0;E<Y.length;E++)M=Z+3*E,K.k.TransformNormalFromFloatsToRef(this._normals32[M],this._normals32[M+1],this._normals32[M+2],g,j),j.toArray(this._fixedNormal32,M);Z=M+3}},Z.prototype._resetCopy=function(){var Z=this._copy;Z.position.setAll(0),Z.rotation.setAll(0),Z.rotationQuaternion=null,Z.scaling.setAll(1),Z.uvs.copyFromFloats(0,0,1,1),Z.color=null,Z.translateFromPivot=!1,Z.shapeId=0,Z.materialIndex=null},Z.prototype._meshBuilder=function(Z,M,j,b,g,O,Q,Y,I,E,s,i,a,z,V,o){var c,G=0,f=0,X=0;this._resetCopy();var d=this._copy,W=!(!V||!V.storage);if(d.idx=a,d.idxInShape=z,d.shapeId=o.shapeId,this._useModelMaterial){var A=o._material.uniqueId,q=this._materialIndexesById;Object.prototype.hasOwnProperty.call(q,A)||(q[A]=this._materials.length,this._materials.push(o._material));var T=q[A];d.materialIndex=T}if(V&&V.positionFunction&&(V.positionFunction(d,a,z),this._mustUnrotateFixedNormals=!0),W)return d;var B=K.e.Matrix[0],N=this._tmpVertex,U=N.position,n=N.color,k=N.uv,x=K.e.Vector3[1],R=K.e.Vector3[2],e=K.e.Vector3[3];K.c.IdentityToRef(B),d.getRotationMatrix(B),d.pivot.multiplyToRef(d.scaling,e),d.translateFromPivot?R.setAll(0):R.copyFrom(e);var u=V&&V.vertexFunction;for(c=0;c<j.length;c++){if(U.copyFrom(j[c]),d.color&&n.copyFrom(d.color),Q&&k.copyFromFloats(Q[G],Q[G+1]),u&&V.vertexFunction(d,N,c),U.multiplyInPlace(d.scaling).subtractInPlace(e),K.k.TransformCoordinatesToRef(U,B,x),x.addInPlace(R).addInPlace(d.position),b.push(x.x,x.y,x.z),Q){var F=d.uvs;Y.push((F.z-F.x)*k.x+F.x,(F.w-F.y)*k.y+F.y),G+=2}if(d.color)this._color.copyFrom(n);else{var C=this._color;I&&void 0!==I[f]?(C.r=I[f],C.g=I[f+1],C.b=I[f+2],C.a=I[f+3]):(C.r=1,C.g=1,C.b=1,C.a=1)}E.push(this._color.r,this._color.g,this._color.b,this._color.a),f+=4,!this.recomputeNormals&&s&&(K.k.TransformNormalFromFloatsToRef(s[X],s[X+1],s[X+2],B,U),i.push(U.x,U.y,U.z),X+=3)}for(c=0;c<g.length;c++){var y=Z+g[c];O.push(y),y>65535&&(this._needs32Bits=!0)}if(this._depthSort||this._multimaterialEnabled){var S=null!==d.materialIndex?d.materialIndex:0;this.depthSortedParticles.push(new TZ(a,M,g.length,S))}return d},Z.prototype._posToShape=function(Z){for(var M=[],j=0;j<Z.length;j+=3)M.push(K.k.FromArray(Z,j));return M},Z.prototype._uvsToShapeUV=function(Z){var M=[];if(Z)for(var j=0;j<Z.length;j++)M.push(Z[j]);return M},Z.prototype._addParticle=function(Z,M,j,K,b,g,O,Q,Y){void 0===Q&&(Q=null),void 0===Y&&(Y=null);var I=new AZ(Z,M,j,K,b,g,O,this,Q);return(Y||this.particles).push(I),I},Z.prototype.addShape=function(Z,M,j){var K=Z.getVerticesData(c.f.PositionKind),b=Z.getIndices(),g=Z.getVerticesData(c.f.UVKind),O=Z.getVerticesData(c.f.ColorKind),Q=Z.getVerticesData(c.f.NormalKind);this.recomputeNormals=!Q;var Y=Array.from(b),I=Array.from(Q),E=O?Array.from(O):[],s=j&&j.storage?j.storage:null,i=null;this._particlesIntersect&&(i=Z.getBoundingInfo());var a=this._posToShape(K),z=this._uvsToShapeUV(g),V=j?j.positionFunction:null,o=j?j.vertexFunction:null,G=null;this._useModelMaterial&&(G=Z.material?Z.material:this._setDefaultMaterial());for(var f=new qZ(this._shapeCounter,a,Y,I,E,z,V,o,G),X=0;X<M;X++)this._insertNewParticle(this.nbParticles,X,f,a,b,g,O,Q,i,s,j);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1},Z.prototype._rebuildParticle=function(Z,M){void 0===M&&(M=!1),this._resetCopy();var j=this._copy;Z._model._positionFunction&&Z._model._positionFunction(j,Z.idx,Z.idxInShape);var b=K.e.Matrix[0],g=K.e.Vector3[0],O=K.e.Vector3[1],Q=K.e.Vector3[2],Y=K.e.Vector3[3];j.getRotationMatrix(b),Z.pivot.multiplyToRef(Z.scaling,Y),j.translateFromPivot?Q.copyFromFloats(0,0,0):Q.copyFrom(Y);for(var I=Z._model._shape,E=0;E<I.length;E++)g.copyFrom(I[E]),Z._model._vertexFunction&&Z._model._vertexFunction(j,g,E),g.multiplyInPlace(j.scaling).subtractInPlace(Y),K.k.TransformCoordinatesToRef(g,b,O),O.addInPlace(Q).addInPlace(j.position).toArray(this._positions32,Z._pos+3*E);M&&(Z.position.setAll(0),Z.rotation.setAll(0),Z.rotationQuaternion=null,Z.scaling.setAll(1),Z.uvs.setAll(0),Z.pivot.setAll(0),Z.translateFromPivot=!1,Z.parentId=null)},Z.prototype.rebuildMesh=function(Z){void 0===Z&&(Z=!1);for(var M=0;M<this.particles.length;M++)this._rebuildParticle(this.particles[M],Z);return this.mesh.updateVerticesData(c.f.PositionKind,this._positions32,!1,!1),this},Z.prototype.removeParticles=function(Z,M){var j=M-Z+1;if(!this._expandable||j<=0||j>=this.nbParticles||!this._updatable)return[];var K=this.particles,b=this.nbParticles;if(M<b-1)for(var g=M+1,O=K[g]._pos-K[Z]._pos,Q=K[g]._ind-K[Z]._ind,Y=g;Y<b;Y++){var I=K[Y];I._pos-=O,I._ind-=Q}var E=K.splice(Z,j);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);for(var s=0,i=K.length,a=0;a<i;a++){var z=K[a],V=z._model,o=V._shape,c=V._indices,G=V._normals,f=V._shapeColors,X=V._shapeUV;z.idx=a,this._idxOfId[z.id]=a,this._meshBuilder(this._index,s,o,this._positions,c,this._indices,X,this._uvs,f,this._colors,G,this._normals,z.idx,z.idxInShape,null,V),this._index+=o.length,s+=c.length}return this.nbParticles-=j,this._isNotBuilt=!0,E},Z.prototype.insertParticlesFromArray=function(Z){if(!this._expandable)return this;for(var M=0,j=Z[0].shapeId,K=Z.length,b=0;b<K;b++){var g=Z[b],O=g._model,Q=O._shape,Y=O._indices,I=O._shapeUV,E=O._shapeColors,s=O._normals,i=!s;this.recomputeNormals=i||this.recomputeNormals;var a=g.getBoundingInfo(),z=this._insertNewParticle(this.nbParticles,M,O,Q,Y,I,E,s,a,null,null);g.copyToRef(z),M++,j!=g.shapeId&&(j=g.shapeId,M=0)}return this._isNotBuilt=!0,this},Z.prototype._insertNewParticle=function(Z,M,j,K,b,g,O,Q,Y,I,E){var s=this._positions.length,i=this._indices.length,a=this._meshBuilder(this._index,i,K,this._positions,b,this._indices,g,this._uvs,O,this._colors,Q,this._normals,Z,M,E,j),z=null;return this._updatable&&((z=this._addParticle(this.nbParticles,this._lastParticleId,s,i,j,this._shapeCounter,M,Y,I)).position.copyFrom(a.position),z.rotation.copyFrom(a.rotation),a.rotationQuaternion&&(z.rotationQuaternion?z.rotationQuaternion.copyFrom(a.rotationQuaternion):z.rotationQuaternion=a.rotationQuaternion.clone()),a.color&&(z.color?z.color.copyFrom(a.color):z.color=a.color.clone()),z.scaling.copyFrom(a.scaling),z.uvs.copyFrom(a.uvs),null!==a.materialIndex&&(z.materialIndex=a.materialIndex),this.expandable&&(this._idxOfId[z.id]=z.idx)),I||(this._index+=K.length,this.nbParticles++,this._lastParticleId++),z},Z.prototype.setParticles=function(Z,M,j){if(void 0===Z&&(Z=0),void 0===M&&(M=this.nbParticles-1),void 0===j&&(j=!0),!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(Z,M,j);var b=K.e.Matrix[0],g=K.e.Matrix[1],O=this.mesh,Q=this._colors32,Y=this._positions32,I=this._normals32,E=this._uvs32,s=this._indices32,i=this._indices,a=this._fixedNormal32,z=K.e.Vector3,V=z[5].copyFromFloats(1,0,0),o=z[6].copyFromFloats(0,1,0),G=z[7].copyFromFloats(0,0,1),f=z[8].setAll(Number.MAX_VALUE),X=z[9].setAll(-Number.MAX_VALUE),d=z[10].setAll(0),W=this._tmpVertex,A=W.position,q=W.color,T=W.uv;if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(g)),this.billboard){var B=z[0];this._camera.getDirectionToRef(nZ.b.Z,B),K.k.TransformNormalToRef(B,g,G),G.normalize();var N=this._camera.getViewMatrix(!0);K.k.TransformNormalFromFloatsToRef(N.m[1],N.m[5],N.m[9],g,o),K.k.CrossToRef(o,G,V),o.normalize(),V.normalize()}this._depthSort&&K.k.TransformCoordinatesToRef(this._camera.globalPosition,g,d),K.c.IdentityToRef(b);var U=0,n=0,k=0,x=0,R=0,e=0,u=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),M=M>=this.nbParticles?this.nbParticles-1:M,this._computeBoundingBox&&(0!=Z||M!=this.nbParticles-1)){var F=this.mesh.getBoundingInfo();F&&(f.copyFrom(F.minimum),X.copyFrom(F.maximum))}var C=(n=this.particles[Z]._pos)/3|0;x=4*C,e=2*C;for(var y=Z;y<=M;y++){var S=this.particles[y];this.updateParticle(S);var h=S._model._shape,w=S._model._shapeUV,p=S._rotationMatrix,m=S.position,J=S.rotation,P=S.scaling,H=S._globalPosition;if(this._depthSort&&this._depthSortParticles){var D=this.depthSortedParticles[y];D.idx=S.idx,D.ind=S._ind,D.indicesLength=S._model._indicesLength,D.sqDistance=K.k.DistanceSquared(S.position,d)}if(!S.alive||S._stillInvisible&&!S.isVisible)n+=3*(u=h.length),x+=4*u,e+=2*u;else{if(S.isVisible){S._stillInvisible=!1;var l=z[12];if(S.pivot.multiplyToRef(P,l),this.billboard&&(J.x=0,J.y=0),(this._computeParticleRotation||this.billboard)&&S.getRotationMatrix(b),null!==S.parentId){var t=this.getParticleById(S.parentId);if(t){var v=t._rotationMatrix,r=t._globalPosition,L=m.x*v[1]+m.y*v[4]+m.z*v[7],ZZ=m.x*v[0]+m.y*v[3]+m.z*v[6],MZ=m.x*v[2]+m.y*v[5]+m.z*v[8];if(H.x=r.x+ZZ,H.y=r.y+L,H.z=r.z+MZ,this._computeParticleRotation||this.billboard){var jZ=b.m;p[0]=jZ[0]*v[0]+jZ[1]*v[3]+jZ[2]*v[6],p[1]=jZ[0]*v[1]+jZ[1]*v[4]+jZ[2]*v[7],p[2]=jZ[0]*v[2]+jZ[1]*v[5]+jZ[2]*v[8],p[3]=jZ[4]*v[0]+jZ[5]*v[3]+jZ[6]*v[6],p[4]=jZ[4]*v[1]+jZ[5]*v[4]+jZ[6]*v[7],p[5]=jZ[4]*v[2]+jZ[5]*v[5]+jZ[6]*v[8],p[6]=jZ[8]*v[0]+jZ[9]*v[3]+jZ[10]*v[6],p[7]=jZ[8]*v[1]+jZ[9]*v[4]+jZ[10]*v[7],p[8]=jZ[8]*v[2]+jZ[9]*v[5]+jZ[10]*v[8]}}else S.parentId=null}else if(H.x=m.x,H.y=m.y,H.z=m.z,this._computeParticleRotation||this.billboard){jZ=b.m;p[0]=jZ[0],p[1]=jZ[1],p[2]=jZ[2],p[3]=jZ[4],p[4]=jZ[5],p[5]=jZ[6],p[6]=jZ[8],p[7]=jZ[9],p[8]=jZ[10]}var KZ=z[11];for(S.translateFromPivot?KZ.setAll(0):KZ.copyFrom(l),u=0;u<h.length;u++){U=n+3*u,k=x+4*u,R=e+2*u;var bZ=2*u,gZ=bZ+1;A.copyFrom(h[u]),this._computeParticleColor&&S.color&&q.copyFrom(S.color),this._computeParticleTexture&&T.copyFromFloats(w[bZ],w[gZ]),this._computeParticleVertex&&this.updateParticleVertex(S,W,u);var OZ=A.x*P.x-l.x,QZ=A.y*P.y-l.y,YZ=A.z*P.z-l.z;ZZ=OZ*p[0]+QZ*p[3]+YZ*p[6],L=OZ*p[1]+QZ*p[4]+YZ*p[7],MZ=OZ*p[2]+QZ*p[5]+YZ*p[8];ZZ+=KZ.x,L+=KZ.y,MZ+=KZ.z;var IZ=Y[U]=H.x+V.x*ZZ+o.x*L+G.x*MZ,EZ=Y[U+1]=H.y+V.y*ZZ+o.y*L+G.y*MZ,sZ=Y[U+2]=H.z+V.z*ZZ+o.z*L+G.z*MZ;if(this._computeBoundingBox&&(f.minimizeInPlaceFromFloats(IZ,EZ,sZ),X.maximizeInPlaceFromFloats(IZ,EZ,sZ)),!this._computeParticleVertex){var iZ=a[U],aZ=a[U+1],zZ=a[U+2],VZ=iZ*p[0]+aZ*p[3]+zZ*p[6],oZ=iZ*p[1]+aZ*p[4]+zZ*p[7],cZ=iZ*p[2]+aZ*p[5]+zZ*p[8];I[U]=V.x*VZ+o.x*oZ+G.x*cZ,I[U+1]=V.y*VZ+o.y*oZ+G.y*cZ,I[U+2]=V.z*VZ+o.z*oZ+G.z*cZ}if(this._computeParticleColor&&S.color){var GZ=this._colors32;GZ[k]=q.r,GZ[k+1]=q.g,GZ[k+2]=q.b,GZ[k+3]=q.a}if(this._computeParticleTexture){var fZ=S.uvs;E[R]=T.x*(fZ.z-fZ.x)+fZ.x,E[R+1]=T.y*(fZ.w-fZ.y)+fZ.y}}}else for(S._stillInvisible=!0,u=0;u<h.length;u++){if(k=x+4*u,R=e+2*u,Y[U=n+3*u]=Y[U+1]=Y[U+2]=0,I[U]=I[U+1]=I[U+2]=0,this._computeParticleColor&&S.color){var XZ=S.color;Q[k]=XZ.r,Q[k+1]=XZ.g,Q[k+2]=XZ.b,Q[k+3]=XZ.a}if(this._computeParticleTexture){fZ=S.uvs;E[R]=w[2*u]*(fZ.z-fZ.x)+fZ.x,E[R+1]=w[2*u+1]*(fZ.w-fZ.y)+fZ.y}}if(this._particlesIntersect){var dZ=S.getBoundingInfo(),WZ=dZ.boundingBox,AZ=dZ.boundingSphere,qZ=S._modelBoundingInfo;if(!this._bSphereOnly){var TZ=qZ.boundingBox.vectors,BZ=z[1],UZ=z[2];BZ.setAll(Number.MAX_VALUE),UZ.setAll(-Number.MAX_VALUE);for(var kZ=0;kZ<8;kZ++){var xZ=TZ[kZ].x*P.x,RZ=TZ[kZ].y*P.y,eZ=TZ[kZ].z*P.z,uZ=(ZZ=xZ*p[0]+RZ*p[3]+eZ*p[6],L=xZ*p[1]+RZ*p[4]+eZ*p[7],MZ=xZ*p[2]+RZ*p[5]+eZ*p[8],m.x+V.x*ZZ+o.x*L+G.x*MZ),FZ=m.y+V.y*ZZ+o.y*L+G.y*MZ,CZ=m.z+V.z*ZZ+o.z*L+G.z*MZ;BZ.minimizeInPlaceFromFloats(uZ,FZ,CZ),UZ.maximizeInPlaceFromFloats(uZ,FZ,CZ)}WZ.reConstruct(BZ,UZ,O._worldMatrix)}var yZ=qZ.minimum.multiplyToRef(P,z[1]),SZ=qZ.maximum.multiplyToRef(P,z[2]),hZ=SZ.addToRef(yZ,z[3]).scaleInPlace(.5).addInPlace(H),wZ=SZ.subtractToRef(yZ,z[4]).scaleInPlace(.5*this._bSphereRadiusFactor),pZ=hZ.subtractToRef(wZ,z[1]),mZ=hZ.addToRef(wZ,z[2]);AZ.reConstruct(pZ,mZ,O._worldMatrix)}n=U+3,x=k+4,e=R+2}}if(j){if(this._computeParticleColor)(DZ=O.getVertexBuffer(c.f.ColorKind))&&!O.isPickable?DZ.updateDirectly(Q,0):O.updateVerticesData(c.f.ColorKind,Q,!1,!1);if(this._computeParticleTexture)(DZ=O.getVertexBuffer(c.f.UVKind))&&!O.isPickable?DZ.updateDirectly(E,0):O.updateVerticesData(c.f.UVKind,E,!1,!1);var JZ=O.getVertexBuffer(c.f.PositionKind);if(JZ&&!O.isPickable?JZ.updateDirectly(Y,0):O.updateVerticesData(c.f.PositionKind,Y,!1,!1),!O.areNormalsFrozen||O.isFacetDataEnabled){if(this._computeParticleVertex||O.isFacetDataEnabled){var PZ=O.isFacetDataEnabled?O.getFacetDataParameters():null;NZ.e.ComputeNormals(Y,s,I,PZ);for(var HZ=0;HZ<I.length;HZ++)a[HZ]=I[HZ]}var DZ;if(!O.areNormalsFrozen)(DZ=O.getVertexBuffer(c.f.NormalKind))&&!O.isPickable?DZ.updateDirectly(I,0):O.updateVerticesData(c.f.NormalKind,I,!1,!1)}if(this._depthSort&&this._depthSortParticles){var lZ=this.depthSortedParticles;lZ.sort(this._depthSortFunction);for(var tZ=lZ.length,vZ=0,rZ=0,LZ=0;LZ<tZ;LZ++){var ZM=lZ[LZ],MM=ZM.indicesLength,jM=ZM.ind;for(HZ=0;HZ<MM;HZ++){if(s[vZ]=i[jM+HZ],vZ++,this._pickable)if(0==HZ%3){var KM=this.pickedParticles[rZ];KM.idx=ZM.idx,KM.faceId=rZ,rZ++}}}O.updateIndices(s)}}return this._computeBoundingBox&&(O.hasBoundingInfo?O.getBoundingInfo().reConstruct(f,X,O._worldMatrix):O.buildBoundingInfo(f,X,O._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this.afterUpdateParticles(Z,M,j),this},Z.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null,this.pickedBySubMesh=null,this._materials=null,this._materialIndexes=null,this._indicesByMaterial=null,this._idxOfId=null},Z.prototype.pickedParticle=function(Z){if(Z.hit){var M=Z.subMeshId,j=Z.faceId-this.mesh.subMeshes[M].indexStart/3,K=this.pickedBySubMesh;if(K[M]&&K[M][j])return K[M][j]}return null},Z.prototype.getParticleById=function(Z){var M=this.particles[Z];if(M&&M.id==Z)return M;var j=this.particles,K=this._idxOfId[Z];if(void 0!==K)return j[K];for(var b=0,g=this.nbParticles;b<g;){var O=j[b];if(O.id==Z)return O;b++}return null},Z.prototype.getParticlesByShapeId=function(Z){var M=[];return this.getParticlesByShapeIdToRef(Z,M),M},Z.prototype.getParticlesByShapeIdToRef=function(Z,M){M.length=0;for(var j=0;j<this.nbParticles;j++){var K=this.particles[j];K.shapeId==Z&&M.push(K)}return this},Z.prototype.computeSubMeshes=function(){if(!this.mesh||!this._multimaterialEnabled)return this;var Z=this.depthSortedParticles;if(this.particles.length>0)for(var M=0;M<this.particles.length;M++){var j=this.particles[M];j.materialIndex||(j.materialIndex=0);var K=Z[M];K.materialIndex=j.materialIndex,K.ind=j._ind,K.indicesLength=j._model._indicesLength,K.idx=j.idx}this._sortParticlesByMaterial();var b=this._indicesByMaterial,g=this._materialIndexes,O=this.mesh;O.subMeshes=[];for(var Q=O.getTotalVertices(),Y=0;Y<g.length;Y++){var I=b[Y],E=b[Y+1]-I,s=g[Y];new kZ.b(s,0,Q,I,E,O)}return this},Z.prototype._sortParticlesByMaterial=function(){var Z=[0];this._indicesByMaterial=Z;var M=[];this._materialIndexes=M;var j=this.depthSortedParticles;j.sort(this._materialSortFunction);var K=j.length,b=this._indices32,g=this._indices,O=0,Q=0,Y=0,I=j[0].materialIndex;M.push(I),this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]);for(var E=0;E<K;E++){var s=j[E],i=s.indicesLength,a=s.ind;s.materialIndex!==I&&(I=s.materialIndex,Z.push(Y),M.push(I),this._pickable&&(O++,this.pickedBySubMesh[O]=[],Q=0));for(var z=0,V=0;V<i;V++){if(b[Y]=g[a+V],this._pickable)if(0==V%3){var o=this.pickedBySubMesh[O][Q];o?(o.idx=s.idx,o.faceId=z):this.pickedBySubMesh[O][Q]={idx:s.idx,faceId:z},Q++,z++}Y++}}return Z.push(b.length),this._updatable&&this.mesh.updateIndices(b),this},Z.prototype._setMaterialIndexesById=function(){this._materialIndexesById={};for(var Z=0;Z<this._materials.length;Z++){var M=this._materials[Z].uniqueId;this._materialIndexesById[M]=Z}},Z.prototype._filterUniqueMaterialId=function(Z){return Z.filter((function(Z,M,j){return j.indexOf(Z)===M}))},Z.prototype._setDefaultMaterial=function(){return this._defaultMaterial||(this._defaultMaterial=new iZ.c(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial},Z.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},Z.prototype.setVisibilityBox=function(Z){var M=Z/2;this.mesh.buildBoundingInfo(new K.k(-M,-M,-M),new K.k(M,M,M))},Object.defineProperty(Z.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(Z){this._alwaysVisible=Z,this.mesh.alwaysSelectAsActiveMesh=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(Z){this._isVisibilityBoxLocked=Z,this.mesh.getBoundingInfo().isLocked=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(Z){this._computeParticleRotation=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(Z){this._computeParticleColor=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(Z){this._computeParticleTexture=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(Z){this._computeParticleVertex=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(Z){this._computeBoundingBox=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(Z){this._depthSortParticles=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"expandable",{get:function(){return this._expandable},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"multimaterialEnabled",{get:function(){return this._multimaterialEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"useModelMaterial",{get:function(){return this._useModelMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"materials",{get:function(){return this._materials},enumerable:!1,configurable:!0}),Z.prototype.setMultiMaterial=function(Z){this._materials=this._filterUniqueMaterialId(Z),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new xZ.e(this.name+"MultiMaterial",this._scene);for(var M=0;M<this._materials.length;M++)this._multimaterial.subMaterials.push(this._materials[M]);this.computeSubMeshes(),this.mesh.material=this._multimaterial},Object.defineProperty(Z.prototype,"multimaterial",{get:function(){return this._multimaterial},set:function(Z){this._multimaterial=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"autoUpdateSubMeshes",{get:function(){return this._autoUpdateSubMeshes},set:function(Z){this._autoUpdateSubMeshes=Z},enumerable:!1,configurable:!0}),Z.prototype.initParticles=function(){},Z.prototype.recycleParticle=function(Z){return Z},Z.prototype.updateParticle=function(Z){return Z},Z.prototype.updateParticleVertex=function(Z,M,j){return this},Z.prototype.beforeUpdateParticles=function(Z,M,j){},Z.prototype.afterUpdateParticles=function(Z,M,j){}}(),j(39578)),eZ=function(){function Z(Z,M,j,K,b){this.idx=0,this.color=new RZ.i(1,1,1,1),this.position=RZ.w.Zero(),this.rotation=RZ.w.Zero(),this.uv=new RZ.s(0,0),this.velocity=RZ.w.Zero(),this.pivot=RZ.w.Zero(),this.translateFromPivot=!1,this._pos=0,this._ind=0,this.groupId=0,this.idxInGroup=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=RZ.w.Zero(),this.idx=Z,this._group=M,this.groupId=j,this.idxInGroup=K,this._pcs=b}return Object.defineProperty(Z.prototype,"size",{get:function(){return this.size},set:function(Z){this.size=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(Z){this.rotationQuaternion=Z},enumerable:!1,configurable:!0}),Z.prototype.intersectsMesh=function(Z,M){if(!Z.hasBoundingInfo)return!1;if(M=M||!1)return Z.getBoundingInfo().boundingSphere.intersectsPoint(this.position.add(this._pcs.mesh.position));var j,K,b,g,O,Q;j=Z.getBoundingInfo().boundingBox.maximumWorld.x,K=Z.getBoundingInfo().boundingBox.minimumWorld.x,b=Z.getBoundingInfo().boundingBox.maximumWorld.y,g=Z.getBoundingInfo().boundingBox.minimumWorld.y,O=Z.getBoundingInfo().boundingBox.maximumWorld.z,Q=Z.getBoundingInfo().boundingBox.minimumWorld.z;var Y=this.position.x+this._pcs.mesh.position.x,I=this.position.y+this._pcs.mesh.position.y,E=this.position.z+this._pcs.mesh.position.z;return K<=Y&&Y<=j&&g<=I&&I<=b&&Q<=E&&E<=O},Z.prototype.getRotationMatrix=function(Z){var M;if(this.rotationQuaternion)M=this.rotationQuaternion;else{M=RZ.o.Quaternion[0];var j=this.rotation;RZ.l.RotationYawPitchRollToRef(j.y,j.x,j.z,M)}M.toRotationMatrix(Z)},Z}(),uZ=function(){function Z(Z,M){this.groupId=Z,this._positionFunction=M}return Object.defineProperty(Z.prototype,"groupID",{get:function(){return this.groupId},set:function(Z){this.groupId=Z},enumerable:!1,configurable:!0}),Z}(),FZ=j(11126),CZ=j(76384);!function(Z){Z[Z.Color=2]="Color",Z[Z.UV=1]="UV",Z[Z.Random=0]="Random",Z[Z.Stated=3]="Stated"}(fZ||(fZ={}));!function(){function Z(Z,M,j,K){this.particles=new Array,this.nbParticles=0,this.counter=0,this.vars={},this._promises=[],this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._updatable=!0,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._groups=new Array,this._groupCounter=0,this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeBoundingBox=!1,this._isReady=!1,this.name=Z,this._size=M,this._scene=j||l.e.LastCreatedScene,K&&void 0!==K.updatable?this._updatable=K.updatable:this._updatable=!0}Object.defineProperty(Z.prototype,"positions",{get:function(){return this._positions32},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"colors",{get:function(){return this._colors32},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"uvs",{get:function(){return this._uvs32},enumerable:!1,configurable:!0}),Z.prototype.buildMeshAsync=function(Z){var M=this;return Promise.all(this._promises).then((function(){return M._isReady=!0,M._buildMesh(Z)}))},Z.prototype._buildMesh=function(Z){0===this.nbParticles&&this.addPoints(1),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors);var M=new NZ.e;M.set(this._positions32,c.f.PositionKind),this._uvs32.length>0&&M.set(this._uvs32,c.f.UVKind);var j=0;this._colors32.length>0&&(j=1,M.set(this._colors32,c.f.ColorKind));var K=new VZ.b(this.name,this._scene);M.applyToMesh(K,this._updatable),this.mesh=K,this._positions=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0);var b=Z;return b||((b=new iZ.c("point cloud material",this._scene)).emissiveColor=new RZ.e(j,j,j),b.disableLighting=!0,b.pointsCloud=!0,b.pointSize=this._size),K.material=b,new Promise((function(Z){return Z(K)}))},Z.prototype._addParticle=function(Z,M,j,K){var b=new eZ(Z,M,j,K,this);return this.particles.push(b),b},Z.prototype._randomUnitVector=function(Z){Z.position=new K.k(Math.random(),Math.random(),Math.random()),Z.color=new RZ.i(1,1,1,1)},Z.prototype._getColorIndicesForCoord=function(Z,M,j,K){var b=Z._groupImageData,g=j*(4*K)+4*M,O=[g,g+1,g+2,g+3],Q=O[1],Y=O[2],I=O[3],E=b[O[0]],s=b[Q],i=b[Y],a=b[I];return new RZ.i(E/255,s/255,i/255,a)},Z.prototype._setPointsColorOrUV=function(Z,M,j,b,g,Q,Y){j&&Z.updateFacetData();var I=2*Z.getBoundingInfo().boundingSphere.radius,E=Z.getVerticesData(c.f.PositionKind),s=Z.getIndices(),i=Z.getVerticesData(c.f.UVKind),a=Z.getVerticesData(c.f.ColorKind),z=K.k.Zero();Z.computeWorldMatrix();var V=Z.getWorldMatrix();if(!V.isIdentity()){E=E.slice(0);for(var o=0;o<E.length/3;o++)K.k.TransformCoordinatesFromFloatsToRef(E[3*o],E[3*o+1],E[3*o+2],V,z),E[3*o]=z.x,E[3*o+1]=z.y,E[3*o+2]=z.z}var G,f,X=0,d=0,W=0,A=0,q=0,T=0,B=0,N=0,U=0,n=0,k=0,x=0,R=0,e=K.k.Zero(),u=K.k.Zero(),F=K.k.Zero(),C=K.k.Zero(),y=K.k.Zero(),S=0,h=0,w=0,p=0,m=0,J=0,P=K.h.Zero(),H=K.h.Zero(),D=K.h.Zero(),l=K.h.Zero(),t=K.h.Zero(),v=0,r=0,L=0,ZZ=0,MZ=0,jZ=0,KZ=0,bZ=0,gZ=0,OZ=0,QZ=0,YZ=0,IZ=K.l.Zero(),EZ=K.l.Zero(),sZ=K.l.Zero(),iZ=K.l.Zero(),aZ=K.l.Zero(),zZ=0,VZ=0;Y=Y||0;for(var oZ,cZ=new K.l(0,0,0,0),GZ=K.k.Zero(),fZ=K.k.Zero(),XZ=K.k.Zero(),dZ=0,WZ=K.k.Zero(),AZ=0,qZ=0,TZ=new FZ.b(K.k.Zero(),new K.k(1,0,0)),BZ=K.k.Zero(),NZ=0;NZ<s.length/3;NZ++){d=s[3*NZ],W=s[3*NZ+1],A=s[3*NZ+2],q=E[3*d],T=E[3*d+1],B=E[3*d+2],N=E[3*W],U=E[3*W+1],n=E[3*W+2],k=E[3*A],x=E[3*A+1],R=E[3*A+2],e.set(q,T,B),u.set(N,U,n),F.set(k,x,R),u.subtractToRef(e,C),F.subtractToRef(u,y),i&&(S=i[2*d],h=i[2*d+1],w=i[2*W],p=i[2*W+1],m=i[2*A],J=i[2*A+1],P.set(S,h),H.set(w,p),D.set(m,J),H.subtractToRef(P,l),D.subtractToRef(H,t)),a&&b&&(v=a[4*d],r=a[4*d+1],L=a[4*d+2],ZZ=a[4*d+3],MZ=a[4*W],jZ=a[4*W+1],KZ=a[4*W+2],bZ=a[4*W+3],gZ=a[4*A],OZ=a[4*A+1],QZ=a[4*A+2],YZ=a[4*A+3],IZ.set(v,r,L,ZZ),EZ.set(MZ,jZ,KZ,bZ),sZ.set(gZ,OZ,QZ,YZ),EZ.subtractToRef(IZ,iZ),sZ.subtractToRef(EZ,aZ));for(var UZ=void 0,nZ=void 0,kZ=void 0,xZ=void 0,eZ=void 0,uZ=void 0,CZ=void 0,yZ=void 0,SZ=new RZ.e(0,0,0),hZ=new RZ.e(0,0,0),wZ=void 0,pZ=void 0,mZ=0;mZ<M._groupDensity[NZ];mZ++)X=this.particles.length,this._addParticle(X,M,this._groupCounter,NZ+mZ),pZ=this.particles[X],zZ=O.b.RandomRange(0,1),VZ=O.b.RandomRange(0,1),G=e.add(C.scale(zZ)).add(y.scale(zZ*VZ)),j&&(GZ=Z.getFacetNormal(NZ).normalize().scale(-1),fZ=C.clone().normalize(),XZ=K.k.Cross(GZ,fZ),dZ=O.b.RandomRange(0,2*Math.PI),WZ=fZ.scale(Math.cos(dZ)).add(XZ.scale(Math.sin(dZ))),dZ=O.b.RandomRange(.1,Math.PI/2),BZ=WZ.scale(Math.cos(dZ)).add(GZ.scale(Math.sin(dZ))),TZ.origin=G.add(BZ.scale(1e-5)),TZ.direction=BZ,TZ.length=I,(oZ=TZ.intersectsMesh(Z)).hit&&(qZ=oZ.pickedPoint.subtract(G).length(),AZ=O.b.RandomRange(0,1)*qZ,G.addInPlace(BZ.scale(AZ)))),pZ.position=G.clone(),this._positions.push(pZ.position.x,pZ.position.y,pZ.position.z),void 0!==b?i&&(f=P.add(l.scale(zZ)).add(t.scale(zZ*VZ)),b?g&&null!==M._groupImageData?(UZ=M._groupImgWidth,nZ=M._groupImgHeight,wZ=this._getColorIndicesForCoord(M,Math.round(f.x*UZ),Math.round(f.y*nZ),UZ),pZ.color=wZ,this._colors.push(wZ.r,wZ.g,wZ.b,wZ.a)):a?(cZ=IZ.add(iZ.scale(zZ)).add(aZ.scale(zZ*VZ)),pZ.color=new RZ.i(cZ.x,cZ.y,cZ.z,cZ.w),this._colors.push(cZ.x,cZ.y,cZ.z,cZ.w)):(cZ=IZ.set(Math.random(),Math.random(),Math.random(),1),pZ.color=new RZ.i(cZ.x,cZ.y,cZ.z,cZ.w),this._colors.push(cZ.x,cZ.y,cZ.z,cZ.w)):(pZ.uv=f.clone(),this._uvs.push(pZ.uv.x,pZ.uv.y))):(Q?(SZ.set(Q.r,Q.g,Q.b),kZ=O.b.RandomRange(-Y,Y),xZ=O.b.RandomRange(-Y,Y),eZ=(yZ=SZ.toHSV()).r,(uZ=yZ.g+kZ)<0&&(uZ=0),uZ>1&&(uZ=1),(CZ=yZ.b+xZ)<0&&(CZ=0),CZ>1&&(CZ=1),RZ.e.HSVtoRGBToRef(eZ,uZ,CZ,hZ),cZ.set(hZ.r,hZ.g,hZ.b,1)):cZ=IZ.set(Math.random(),Math.random(),Math.random(),1),pZ.color=new RZ.i(cZ.x,cZ.y,cZ.z,cZ.w),this._colors.push(cZ.x,cZ.y,cZ.z,cZ.w))}},Z.prototype._colorFromTexture=function(Z,M,j){var K=this;if(null===Z.material)return u.c.Warn(Z.name+"has no material."),M._groupImageData=null,void this._setPointsColorOrUV(Z,M,j,!0,!1);var b=Z.material.getActiveTextures();if(0===b.length)return u.c.Warn(Z.name+"has no usable texture."),M._groupImageData=null,void this._setPointsColorOrUV(Z,M,j,!0,!1);var g=Z.clone();g.setEnabled(!1),this._promises.push(new Promise((function(Z){CZ.e.WhenAllReady(b,(function(){var O=M._textureNb;O<0&&(O=0),O>b.length-1&&(O=b.length-1);var Q=function(){M._groupImgWidth=b[O].getSize().width,M._groupImgHeight=b[O].getSize().height,K._setPointsColorOrUV(g,M,j,!0,!0),g.dispose(),Z()};M._groupImageData=null;var Y=b[O].readPixels();Y?Y.then((function(Z){M._groupImageData=Z,Q()})):Q()}))})))},Z.prototype._calculateDensity=function(Z,M,j){for(var b,g,O,Q,Y,I,E,s,i,a,z,V,o,c,G,f,X,d=new Array,W=K.k.Zero(),A=K.k.Zero(),q=K.k.Zero(),T=K.k.Zero(),B=K.k.Zero(),N=K.k.Zero(),U=new Array,n=0,k=j.length/3,x=0;x<k;x++)b=j[3*x],g=j[3*x+1],O=j[3*x+2],Q=M[3*b],Y=M[3*b+1],I=M[3*b+2],E=M[3*g],s=M[3*g+1],i=M[3*g+2],a=M[3*O],z=M[3*O+1],V=M[3*O+2],W.set(Q,Y,I),A.set(E,s,i),q.set(a,z,V),A.subtractToRef(W,T),q.subtractToRef(A,B),q.subtractToRef(W,N),f=((o=T.length())+(c=B.length())+(G=N.length()))/2,n+=X=Math.sqrt(f*(f-o)*(f-c)*(f-G)),U[x]=X;var R=0;for(x=0;x<k;x++)d[x]=Math.floor(Z*U[x]/n),R+=d[x];var e=Z-R,u=Math.floor(e/k),F=e%k;u>0&&(d=d.map((function(Z){return Z+u})));for(x=0;x<F;x++)d[x]+=1;return d},Z.prototype.addPoints=function(Z,M){void 0===M&&(M=this._randomUnitVector);for(var j,K=new uZ(this._groupCounter,M),b=this.nbParticles,g=0;g<Z;g++)j=this._addParticle(b,K,this._groupCounter,g),K&&K._positionFunction&&K._positionFunction(j,b,g),this._positions.push(j.position.x,j.position.y,j.position.z),j.color&&this._colors.push(j.color.r,j.color.g,j.color.b,j.color.a),j.uv&&this._uvs.push(j.uv.x,j.uv.y),b++;return this.nbParticles+=Z,this._groupCounter++,this._groupCounter},Z.prototype.addSurfacePoints=function(Z,M,j,K,b){var g=j||fZ.Random;(isNaN(g)||g<0||g>3)&&(g=fZ.Random);var O=Z.getVerticesData(c.f.PositionKind),Q=Z.getIndices();this._groups.push(this._groupCounter);var Y=new uZ(this._groupCounter,null);switch(Y._groupDensity=this._calculateDensity(M,O,Q),g===fZ.Color?Y._textureNb=K||0:K=K||new RZ.i(1,1,1,1),g){case fZ.Color:this._colorFromTexture(Z,Y,!1);break;case fZ.UV:this._setPointsColorOrUV(Z,Y,!1,!1,!1);break;case fZ.Random:this._setPointsColorOrUV(Z,Y,!1);break;case fZ.Stated:this._setPointsColorOrUV(Z,Y,!1,void 0,void 0,K,b)}return this.nbParticles+=M,this._groupCounter++,this._groupCounter-1},Z.prototype.addVolumePoints=function(Z,M,j,K,b){var g=j||fZ.Random;(isNaN(g)||g<0||g>3)&&(g=fZ.Random);var O=Z.getVerticesData(c.f.PositionKind),Q=Z.getIndices();this._groups.push(this._groupCounter);var Y=new uZ(this._groupCounter,null);switch(Y._groupDensity=this._calculateDensity(M,O,Q),g===fZ.Color?Y._textureNb=K||0:K=K||new RZ.i(1,1,1,1),g){case fZ.Color:this._colorFromTexture(Z,Y,!0);break;case fZ.UV:this._setPointsColorOrUV(Z,Y,!0,!1,!1);break;case fZ.Random:this._setPointsColorOrUV(Z,Y,!0);break;case fZ.Stated:this._setPointsColorOrUV(Z,Y,!0,void 0,void 0,K,b)}return this.nbParticles+=M,this._groupCounter++,this._groupCounter-1},Z.prototype.setParticles=function(Z,M,j){if(void 0===Z&&(Z=0),void 0===M&&(M=this.nbParticles-1),void 0===j&&(j=!0),!this._updatable||!this._isReady)return this;this.beforeUpdateParticles(Z,M,j);var b=K.e.Matrix[0],g=this.mesh,O=this._colors32,Q=this._positions32,Y=this._uvs32,I=K.e.Vector3,E=I[5].copyFromFloats(1,0,0),s=I[6].copyFromFloats(0,1,0),i=I[7].copyFromFloats(0,0,1),a=I[8].setAll(Number.MAX_VALUE),z=I[9].setAll(-Number.MAX_VALUE);K.c.IdentityToRef(b);var V=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),M=M>=this.nbParticles?this.nbParticles-1:M,this._computeBoundingBox&&(0!=Z||M!=this.nbParticles-1)){var o=this.mesh.getBoundingInfo();o&&(a.copyFrom(o.minimum),z.copyFrom(o.maximum))}V=0;for(var G=0,f=0,X=0,d=Z;d<=M;d++){var W=this.particles[d];G=3*(V=W.idx),f=4*V,X=2*V,this.updateParticle(W);var A=W._rotationMatrix,q=W.position,T=W._globalPosition;if(this._computeParticleRotation&&W.getRotationMatrix(b),null!==W.parentId){var B=this.particles[W.parentId],N=B._rotationMatrix,U=B._globalPosition,n=q.x*N[1]+q.y*N[4]+q.z*N[7],k=q.x*N[0]+q.y*N[3]+q.z*N[6],x=q.x*N[2]+q.y*N[5]+q.z*N[8];if(T.x=U.x+k,T.y=U.y+n,T.z=U.z+x,this._computeParticleRotation){var R=b.m;A[0]=R[0]*N[0]+R[1]*N[3]+R[2]*N[6],A[1]=R[0]*N[1]+R[1]*N[4]+R[2]*N[7],A[2]=R[0]*N[2]+R[1]*N[5]+R[2]*N[8],A[3]=R[4]*N[0]+R[5]*N[3]+R[6]*N[6],A[4]=R[4]*N[1]+R[5]*N[4]+R[6]*N[7],A[5]=R[4]*N[2]+R[5]*N[5]+R[6]*N[8],A[6]=R[8]*N[0]+R[9]*N[3]+R[10]*N[6],A[7]=R[8]*N[1]+R[9]*N[4]+R[10]*N[7],A[8]=R[8]*N[2]+R[9]*N[5]+R[10]*N[8]}}else if(T.x=0,T.y=0,T.z=0,this._computeParticleRotation){R=b.m;A[0]=R[0],A[1]=R[1],A[2]=R[2],A[3]=R[4],A[4]=R[5],A[5]=R[6],A[6]=R[8],A[7]=R[9],A[8]=R[10]}var e=I[11];W.translateFromPivot?e.setAll(0):e.copyFrom(W.pivot);var u=I[0];u.copyFrom(W.position);var F=u.x-W.pivot.x,C=u.y-W.pivot.y,y=u.z-W.pivot.z,S=F*A[0]+C*A[3]+y*A[6],h=F*A[1]+C*A[4]+y*A[7],w=F*A[2]+C*A[5]+y*A[8];S+=e.x,h+=e.y,w+=e.z;var p=Q[G]=T.x+E.x*S+s.x*h+i.x*w,m=Q[G+1]=T.y+E.y*S+s.y*h+i.y*w,J=Q[G+2]=T.z+E.z*S+s.z*h+i.z*w;if(this._computeBoundingBox&&(a.minimizeInPlaceFromFloats(p,m,J),z.maximizeInPlaceFromFloats(p,m,J)),this._computeParticleColor&&W.color){var P=W.color,H=this._colors32;H[f]=P.r,H[f+1]=P.g,H[f+2]=P.b,H[f+3]=P.a}if(this._computeParticleTexture&&W.uv){var D=W.uv,l=this._uvs32;l[X]=D.x,l[X+1]=D.y}}return j&&(this._computeParticleColor&&g.updateVerticesData(c.f.ColorKind,O,!1,!1),this._computeParticleTexture&&g.updateVerticesData(c.f.UVKind,Y,!1,!1),g.updateVerticesData(c.f.PositionKind,Q,!1,!1)),this._computeBoundingBox&&(g.hasBoundingInfo?g.getBoundingInfo().reConstruct(a,z,g._worldMatrix):g.buildBoundingInfo(a,z,g._worldMatrix)),this.afterUpdateParticles(Z,M,j),this},Z.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._uvs32=null,this._colors32=null},Z.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},Z.prototype.setVisibilityBox=function(Z){var M=Z/2;this.mesh.buildBoundingInfo(new K.k(-M,-M,-M),new K.k(M,M,M))},Object.defineProperty(Z.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(Z){this._alwaysVisible=Z,this.mesh.alwaysSelectAsActiveMesh=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"computeParticleRotation",{set:function(Z){this._computeParticleRotation=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(Z){this._computeParticleColor=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(Z){this._computeParticleTexture=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(Z){this._computeBoundingBox=Z},enumerable:!1,configurable:!0}),Z.prototype.initParticles=function(){},Z.prototype.recycleParticle=function(Z){return Z},Z.prototype.updateParticle=function(Z){return Z},Z.prototype.beforeUpdateParticles=function(Z,M,j){},Z.prototype.afterUpdateParticles=function(Z,M,j){}}()},56965:function(Z,M,j){"use strict";j.d(M,{d:function(){return i}});var K=j(40061),b=j(17190),g=j(9271),O=j(80105),Q="attribute vec2 position;\nuniform vec2 scale;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";j(16179).d.ShadersStore.postprocessVertexShader=Q;var Y=j(90690),I=(j(84468),j(9892)),E=j(31709),s=j(61803),i=function(){function Z(Z,M,j,K,Q,Y,I,E,i,a,z,V,o,c,G){void 0===I&&(I=1),void 0===a&&(a=null),void 0===z&&(z=0),void 0===V&&(V="postprocess"),void 0===c&&(c=!1),void 0===G&&(G=5),this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.alphaMode=0,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new b.f(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new O.h(1,1),this._texelSize=O.h.Zero(),this.onActivateObservable=new g.b,this.onSizeChangedObservable=new g.b,this.onApplyObservable=new g.b,this.onBeforeRenderObservable=new g.b,this.onAfterRenderObservable=new g.b,this.name=Z,null!=Y?(this._camera=Y,this._scene=Y.getScene(),Y.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):E&&(this._engine=E,this._engine.postProcesses.push(this)),this._options=Q,this.renderTargetSamplingMode=I||1,this._reusable=i||!1,this._textureType=z,this._textureFormat=G,this._samplers=K||[],this._samplers.push("textureSampler"),this._fragmentUrl=M,this._vertexUrl=V,this._parameters=j||[],this._parameters.push("scale"),this._indexParameters=o,this._drawWrapper=new s.e(this._engine),c||this.updateEffect(a)}return Object.defineProperty(Z.prototype,"samples",{get:function(){return this._samples},set:function(Z){var M=this;this._samples=Math.min(Z,this._engine.getCaps().maxMSAASamples),this._textures.forEach((function(Z){Z.samples!==M._samples&&M._engine.updateRenderTargetTextureSampleCount(Z,M._samples)}))},enumerable:!1,configurable:!0}),Z.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(Z.prototype,"onActivate",{set:function(Z){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),Z&&(this._onActivateObserver=this.onActivateObservable.add(Z))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onSizeChanged",{set:function(Z){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onApply",{set:function(Z){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onBeforeRender",{set:function(Z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onAfterRender",{set:function(Z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(Z){this._forcedOutputTexture=Z},enumerable:!1,configurable:!0}),Z.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())},Z.prototype.getCamera=function(){return this._camera},Object.defineProperty(Z.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!1,configurable:!0}),Z.prototype.getClassName=function(){return"PostProcess"},Z.prototype.getEngine=function(){return this._engine},Z.prototype.getEffect=function(){return this._drawWrapper.effect},Z.prototype.shareOutputWith=function(Z){return this._disposeTextures(),this._shareOutputWithPostProcess=Z,this},Z.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new b.f(2)),this._shareOutputWithPostProcess=null},Z.prototype.updateEffect=function(Z,M,j,K,b,g,O,Q){void 0===Z&&(Z=null),void 0===M&&(M=null),void 0===j&&(j=null),this._postProcessDefines=Z,this._drawWrapper.effect=this._engine.createEffect({vertex:null!==O&&void 0!==O?O:this._vertexUrl,fragment:null!==Q&&void 0!==Q?Q:this._fragmentUrl},["position"],M||this._parameters,j||this._samplers,null!==Z?Z:"",void 0,b,g,K||this._indexParameters)},Z.prototype.isReusable=function(){return this._reusable},Z.prototype.markTextureDirty=function(){this.width=-1},Z.prototype._createRenderTargetTexture=function(Z,M,j){void 0===j&&(j=0);for(var K=0;K<this._textureCache.length;K++)if(this._textureCache[K].texture.width===Z.width&&this._textureCache[K].texture.height===Z.height&&this._textureCache[K].postProcessChannel===j&&this._textureCache[K].texture._generateDepthBuffer===M.generateDepthBuffer)return this._textureCache[K].texture;var b=this._engine.createRenderTargetTexture(Z,M);return this._textureCache.push({texture:b,postProcessChannel:j,lastUsedRenderId:-1}),b},Z.prototype._flushTextureCache=function(){for(var Z=this._renderId,M=this._textureCache.length-1;M>=0;M--)if(Z-this._textureCache[M].lastUsedRenderId>100){for(var j=!1,K=0;K<this._textures.length;K++)if(this._textures.data[K]===this._textureCache[M].texture){j=!0;break}j||(this._textureCache[M].texture.dispose(),this._textureCache.splice(M,1))}},Z.prototype._resize=function(Z,M,j,K,b){this._textures.length>0&&this._textures.reset(),this.width=Z,this.height=M;for(var g=null,O=0;O<j._postProcesses.length;O++)if(null!==j._postProcesses[O]){g=j._postProcesses[O];break}var Q={width:this.width,height:this.height},Y={generateMipMaps:K,generateDepthBuffer:b||g===this,generateStencilBuffer:(b||g===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._createRenderTargetTexture(Q,Y,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(Q,Y,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)},Z.prototype.activate=function(Z,M,j){var K,b,g=this;void 0===M&&(M=null);var O=(Z=Z||this._camera).getScene(),Q=O.getEngine(),I=Q.getCaps().maxTextureSize,E=(M?M.width:this._engine.getRenderWidth(!0))*this._options|0,s=(M?M.height:this._engine.getRenderHeight(!0))*this._options|0,i=Z.parent;!i||i.leftCamera!=Z&&i.rightCamera!=Z||(E/=2);var a,z=this._options.width||E,V=this._options.height||s,o=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var c=Q.currentViewport;c&&(z*=c.width,V*=c.height)}(o||this.alwaysForcePOT)&&(this._options.width||(z=Q.needPOTTextures?Y.c.GetExponentOfTwo(z,I,this.scaleMode):z),this._options.height||(V=Q.needPOTTextures?Y.c.GetExponentOfTwo(V,I,this.scaleMode):V)),this.width===z&&this.height===V||this._resize(z,V,Z,o,j),this._textures.forEach((function(Z){Z.samples!==g.samples&&g._engine.updateRenderTargetTextureSampleCount(Z,g.samples)})),this._flushTextureCache(),this._renderId++}if(this._shareOutputWithPostProcess)a=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)a=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{a=this.inputTexture;for(var G=void 0,f=0;f<this._textureCache.length;f++)if(this._textureCache[f].texture===a){G=this._textureCache[f];break}G&&(G.lastUsedRenderId=this._renderId)}return this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(E/z,s/V),this._engine.bindFramebuffer(a,0,E,s,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(a,0,void 0,void 0,this.forceFullscreenViewport)),null===(b=(K=this._engine)._debugInsertMarker)||void 0===b||b.call(K,"post process ".concat(this.name," input")),this.onActivateObservable.notifyObservers(Z),this.autoClear&&0===this.alphaMode&&this._engine.clear(this.clearColor?this.clearColor:O.clearColor,O._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),a},Object.defineProperty(Z.prototype,"isSupported",{get:function(){return this._drawWrapper.effect.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0}),Z.prototype.isReady=function(){var Z,M;return null!==(M=null===(Z=this._drawWrapper.effect)||void 0===Z?void 0:Z.isReady())&&void 0!==M&&M},Z.prototype.apply=function(){var Z,M;return(null===(Z=this._drawWrapper.effect)||void 0===Z?void 0:Z.isReady())?(this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),M=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",null===M||void 0===M?void 0:M.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),this._drawWrapper.effect):null},Z.prototype._disposeTextures=function(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())},Z.prototype._disposeTextureCache=function(){for(var Z=this._textureCache.length-1;Z>=0;Z--)this._textureCache[Z].texture.dispose();this._textureCache.length=0},Z.prototype.setPrePassRenderer=function(Z){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=Z.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)},Z.prototype.dispose=function(Z){var M;if(Z=Z||this._camera,this._disposeTextures(),this._scene&&-1!==(M=this._scene.postProcesses.indexOf(this))&&this._scene.postProcesses.splice(M,1),this._parentContainer){var j=this._parentContainer.postProcesses.indexOf(this);j>-1&&this._parentContainer.postProcesses.splice(j,1),this._parentContainer=null}if(-1!==(M=this._engine.postProcesses.indexOf(this))&&this._engine.postProcesses.splice(M,1),Z){if(Z.detachPostProcess(this),0===(M=Z._postProcesses.indexOf(this))&&Z._postProcesses.length>0){var K=this._camera._getFirstPostProcess();K&&K.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},Z.prototype.serialize=function(){var Z=I.b.Serialize(this),M=this.getCamera()||this._scene&&this._scene.activeCamera;return Z.customType="BABYLON."+this.getClassName(),Z.cameraId=M?M.id:null,Z.reusable=this._reusable,Z.textureType=this._textureType,Z.fragmentUrl=this._fragmentUrl,Z.parameters=this._parameters,Z.samplers=this._samplers,Z.options=this._options,Z.defines=this._postProcessDefines,Z.textureFormat=this._textureFormat,Z.vertexUrl=this._vertexUrl,Z.indexParameters=this._indexParameters,Z},Z.prototype.clone=function(){var M=this.serialize();M._engine=this._engine,M.cameraId=null;var j=Z.Parse(M,this._scene,"");return j?(j.onActivateObservable=this.onActivateObservable.clone(),j.onSizeChangedObservable=this.onSizeChangedObservable.clone(),j.onApplyObservable=this.onApplyObservable.clone(),j.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),j.onAfterRenderObservable=this.onAfterRenderObservable.clone(),j._prePassEffectConfiguration=this._prePassEffectConfiguration,j):null},Z.Parse=function(Z,M,j){var K=(0,E.b)(Z.customType);if(!K||!K._Parse)return null;var b=M?M.getCameraById(Z.cameraId):null;return K._Parse(Z,b,M,j)},Z._Parse=function(M,j,K,b){return I.b.Parse((function(){return new Z(M.name,M.fragmentUrl,M.parameters,M.samplers,M.options,j,M.renderTargetSamplingMode,M._engine,M.reusable,M.defines,M.textureType,M.vertexUrl,M.indexParameters,!1,M.textureFormat)}),M,K,b)},(0,K.l)([(0,I.z)()],Z.prototype,"uniqueId",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"name",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"width",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"height",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"renderTargetSamplingMode",void 0),(0,K.l)([(0,I.j)()],Z.prototype,"clearColor",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"autoClear",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"alphaMode",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"alphaConstants",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"enablePixelPerfectMode",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"forceFullscreenViewport",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"scaleMode",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"alwaysForcePOT",void 0),(0,K.l)([(0,I.z)("samples")],Z.prototype,"_samples",void 0),(0,K.l)([(0,I.z)()],Z.prototype,"adaptScaleToCurrentViewport",void 0),Z}();(0,E.c)("BABYLON.PostProcess",i)},64833:function(Z,M,j){"use strict";j.d(M,{c:function(){return b}});var K=j(43251),b=function(){function Z(Z){this._vertexBuffers={},this._scene=Z}return Z.prototype._prepareBuffers=function(){if(!this._vertexBuffers[K.f.PositionKind]){var Z=[];Z.push(1,1),Z.push(-1,1),Z.push(-1,-1),Z.push(1,-1),this._vertexBuffers[K.f.PositionKind]=new K.f(this._scene.getEngine(),Z,K.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}},Z.prototype._buildIndexBuffer=function(){var Z=[];Z.push(0),Z.push(1),Z.push(2),Z.push(0),Z.push(2),Z.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(Z)},Z.prototype._rebuild=function(){var Z=this._vertexBuffers[K.f.PositionKind];Z&&(Z._rebuild(),this._buildIndexBuffer())},Z.prototype._prepareFrame=function(Z,M){void 0===Z&&(Z=null),void 0===M&&(M=null);var j=this._scene.activeCamera;return!!j&&(!(!(M=M||j._postProcesses.filter((function(Z){return null!=Z})))||0===M.length||!this._scene.postProcessesEnabled)&&(M[0].activate(j,Z,null!==M&&void 0!==M),!0))},Z.prototype.directRender=function(Z,M,j,K,b,g){var O;void 0===M&&(M=null),void 0===j&&(j=!1),void 0===K&&(K=0),void 0===b&&(b=0),void 0===g&&(g=!1);for(var Q=this._scene.getEngine(),Y=0;Y<Z.length;Y++){Y<Z.length-1?Z[Y+1].activate(this._scene.activeCamera,null===M||void 0===M?void 0:M.texture):(M?Q.bindFramebuffer(M,K,void 0,void 0,j,b):g||Q.restoreDefaultFramebuffer(),null===(O=Q._debugInsertMarker)||void 0===O||O.call(Q,"post process ".concat(Z[Y].name," output")));var I=Z[Y],E=I.apply();E&&(I.onBeforeRenderObservable.notifyObservers(E),this._prepareBuffers(),Q.bindBuffers(this._vertexBuffers,this._indexBuffer,E),Q.drawElementsType(0,0,6),I.onAfterRenderObservable.notifyObservers(E))}Q.setDepthBuffer(!0),Q.setDepthWrite(!0)},Z.prototype._finalizeFrame=function(Z,M,j,K,b){var g;void 0===b&&(b=!1);var O=this._scene.activeCamera;if(O&&(K=K||O._postProcesses.filter((function(Z){return null!=Z})),0!==K.length&&this._scene.postProcessesEnabled)){for(var Q=this._scene.getEngine(),Y=0,I=K.length;Y<I;Y++){var E=K[Y];if(Y<I-1?E._outputTexture=K[Y+1].activate(O,null===M||void 0===M?void 0:M.texture):(M?(Q.bindFramebuffer(M,j,void 0,void 0,b),E._outputTexture=M):(Q.restoreDefaultFramebuffer(),E._outputTexture=null),null===(g=Q._debugInsertMarker)||void 0===g||g.call(Q,"post process ".concat(K[Y].name," output"))),Z)break;var s=E.apply();s&&(E.onBeforeRenderObservable.notifyObservers(s),this._prepareBuffers(),Q.bindBuffers(this._vertexBuffers,this._indexBuffer,s),Q.drawElementsType(0,0,6),E.onAfterRenderObservable.notifyObservers(s))}Q.setDepthBuffer(!0),Q.setDepthWrite(!0),Q.setAlphaMode(0)}},Z.prototype.dispose=function(){var Z=this._vertexBuffers[K.f.PositionKind];Z&&(Z.dispose(),this._vertexBuffers[K.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},Z}()},16369:function(Z,M,j){"use strict";j.d(M,{e:function(){return Q}});var K=j(17190),b=j(80105),g=function(){function Z(Z,M,j,b,g){void 0===j&&(j=null),void 0===b&&(b=null),void 0===g&&(g=null),this.index=Z,this._opaqueSubMeshes=new K.f(256),this._transparentSubMeshes=new K.f(256),this._alphaTestSubMeshes=new K.f(256),this._depthOnlySubMeshes=new K.f(256),this._particleSystems=new K.f(256),this._spriteManagers=new K.f(256),this._empty=!0,this._edgesRenderers=new K.c(16),this._scene=M,this.opaqueSortCompareFn=j,this.alphaTestSortCompareFn=b,this.transparentSortCompareFn=g}return Object.defineProperty(Z.prototype,"opaqueSortCompareFn",{set:function(M){this._opaqueSortCompareFn=M||Z.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"alphaTestSortCompareFn",{set:function(M){this._alphaTestSortCompareFn=M||Z.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"transparentSortCompareFn",{set:function(M){this._transparentSortCompareFn=M||Z.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted},enumerable:!1,configurable:!0}),Z.prototype.render=function(Z,M,j,K){if(Z)Z(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var b=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(b.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),b.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var g=b.getStencilBuffer();if(b.setStencilBuffer(!1),M&&this._renderSprites(),j&&this._renderParticles(K),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(b.setStencilBuffer(g),this._scene.useOrderIndependentTransparency){var O=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);O.length&&this._renderTransparent(O)}else this._renderTransparent(this._transparentSubMeshes);b.setAlphaMode(0)}if(b.setStencilBuffer(!1),this._edgesRenderers.length){for(var Q=0;Q<this._edgesRenderers.length;Q++)this._edgesRenderers.data[Q].render();b.setAlphaMode(0)}b.setStencilBuffer(g)}},Z.prototype._renderOpaqueSorted=function(M){return Z._RenderSorted(M,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},Z.prototype._renderAlphaTestSorted=function(M){return Z._RenderSorted(M,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},Z.prototype._renderTransparentSorted=function(M){return Z._RenderSorted(M,this._transparentSortCompareFn,this._scene.activeCamera,!0)},Z._RenderSorted=function(M,j,K,g){var O,Q=0,Y=K?K.globalPosition:Z._ZeroVector;if(g)for(;Q<M.length;Q++)(O=M.data[Q])._alphaIndex=O.getMesh().alphaIndex,O._distanceToCamera=b.k.Distance(O.getBoundingInfo().boundingSphere.centerWorld,Y);var I=M.length===M.data.length?M.data:M.data.slice(0,M.length);j&&I.sort(j);var E=I[0].getMesh().getScene();for(Q=0;Q<I.length;Q++)if(O=I[Q],!E._activeMeshesFrozenButKeepClipping||O.isInFrustum(E._frustumPlanes)){if(g){var s=O.getMaterial();if(s&&s.needDepthPrePass){var i=s.getScene().getEngine();i.setColorWrite(!1),i.setAlphaMode(0),O.render(!1),i.setColorWrite(!0)}}O.render(g)}},Z.defaultTransparentSortCompare=function(M,j){return M._alphaIndex>j._alphaIndex?1:M._alphaIndex<j._alphaIndex?-1:Z.backToFrontSortCompare(M,j)},Z.backToFrontSortCompare=function(Z,M){return Z._distanceToCamera<M._distanceToCamera?1:Z._distanceToCamera>M._distanceToCamera?-1:0},Z.frontToBackSortCompare=function(Z,M){return Z._distanceToCamera<M._distanceToCamera?-1:Z._distanceToCamera>M._distanceToCamera?1:0},Z.PainterSortCompare=function(Z,M){var j=Z.getMesh(),K=M.getMesh();return j.material&&K.material?j.material.uniqueId-K.material.uniqueId:j.uniqueId-K.uniqueId},Z.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset(),this._empty=!0},Z.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},Z.prototype.dispatch=function(Z,M,j){void 0===M&&(M=Z.getMesh()),void 0===j&&(j=Z.getMaterial()),null!==j&&void 0!==j&&(j.needAlphaBlendingForMesh(M)?this._transparentSubMeshes.push(Z):j.needAlphaTesting()?(j.needDepthPrePass&&this._depthOnlySubMeshes.push(Z),this._alphaTestSubMeshes.push(Z)):(j.needDepthPrePass&&this._depthOnlySubMeshes.push(Z),this._opaqueSubMeshes.push(Z)),M._renderingGroup=this,M._edgesRenderer&&M._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(M._edgesRenderer),this._empty=!1)},Z.prototype.dispatchSprites=function(Z){this._spriteManagers.push(Z),this._empty=!1},Z.prototype.dispatchParticles=function(Z){this._particleSystems.push(Z),this._empty=!1},Z.prototype._renderParticles=function(Z){if(0!==this._particleSystems.length){var M=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var j=0;j<this._particleSystems.length;j++){var K=this._particleSystems.data[j];if(0!==(M&&M.layerMask&K.layerMask)){var b=K.emitter;b.position&&Z&&-1===Z.indexOf(b)||this._scene._activeParticles.addCount(K.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},Z.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var Z=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var M=0;M<this._spriteManagers.length;M++){var j=this._spriteManagers.data[M];0!==(Z&&Z.layerMask&j.layerMask)&&j.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},Z._ZeroVector=b.k.Zero(),Z}(),O=function(){},Q=function(){function Z(M){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new O,this._scene=M;for(var j=Z.MIN_RENDERINGGROUPS;j<Z.MAX_RENDERINGGROUPS;j++)this._autoClearDepthStencil[j]={autoClear:!0,depth:!0,stencil:!0}}return Z.prototype._clearDepthStencilBuffer=function(Z,M){void 0===Z&&(Z=!0),void 0===M&&(M=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,Z,M),this._depthStencilBufferAlreadyCleaned=!0)},Z.prototype.render=function(M,j,K,b){var g=this._renderingGroupInfo;if(g.scene=this._scene,g.camera=this._scene.activeCamera,this._scene.spriteManagers&&b)for(var O=0;O<this._scene.spriteManagers.length;O++){var Q=this._scene.spriteManagers[O];this.dispatchSprites(Q)}for(O=Z.MIN_RENDERINGGROUPS;O<Z.MAX_RENDERINGGROUPS;O++){this._depthStencilBufferAlreadyCleaned=O===Z.MIN_RENDERINGGROUPS;var Y=this._renderingGroups[O];if(Y&&!Y._empty){var I=Math.pow(2,O);if(g.renderingGroupId=O,this._scene.onBeforeRenderingGroupObservable.notifyObservers(g,I),Z.AUTOCLEAR){var E=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(O):this._autoClearDepthStencil[O];E&&E.autoClear&&this._clearDepthStencilBuffer(E.depth,E.stencil)}for(var s=0,i=this._scene._beforeRenderingGroupDrawStage;s<i.length;s++){i[s].action(O)}Y.render(M,b,K,j);for(var a=0,z=this._scene._afterRenderingGroupDrawStage;a<z.length;a++){z[a].action(O)}this._scene.onAfterRenderingGroupObservable.notifyObservers(g,I)}}},Z.prototype.reset=function(){for(var M=Z.MIN_RENDERINGGROUPS;M<Z.MAX_RENDERINGGROUPS;M++){var j=this._renderingGroups[M];j&&j.prepare()}},Z.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},Z.prototype.freeRenderingGroups=function(){for(var M=Z.MIN_RENDERINGGROUPS;M<Z.MAX_RENDERINGGROUPS;M++){var j=this._renderingGroups[M];j&&j.dispose()}},Z.prototype._prepareRenderingGroup=function(Z){void 0===this._renderingGroups[Z]&&(this._renderingGroups[Z]=new g(Z,this._scene,this._customOpaqueSortCompareFn[Z],this._customAlphaTestSortCompareFn[Z],this._customTransparentSortCompareFn[Z]))},Z.prototype.dispatchSprites=function(Z){var M=Z.renderingGroupId||0;this._prepareRenderingGroup(M),this._renderingGroups[M].dispatchSprites(Z)},Z.prototype.dispatchParticles=function(Z){var M=Z.renderingGroupId||0;this._prepareRenderingGroup(M),this._renderingGroups[M].dispatchParticles(Z)},Z.prototype.dispatch=function(Z,M,j){void 0===M&&(M=Z.getMesh());var K=M.renderingGroupId||0;this._prepareRenderingGroup(K),this._renderingGroups[K].dispatch(Z,M,j)},Z.prototype.setRenderingOrder=function(Z,M,j,K){if(void 0===M&&(M=null),void 0===j&&(j=null),void 0===K&&(K=null),this._customOpaqueSortCompareFn[Z]=M,this._customAlphaTestSortCompareFn[Z]=j,this._customTransparentSortCompareFn[Z]=K,this._renderingGroups[Z]){var b=this._renderingGroups[Z];b.opaqueSortCompareFn=this._customOpaqueSortCompareFn[Z],b.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[Z],b.transparentSortCompareFn=this._customTransparentSortCompareFn[Z]}},Z.prototype.setRenderingAutoClearDepthStencil=function(Z,M,j,K){void 0===j&&(j=!0),void 0===K&&(K=!0),this._autoClearDepthStencil[Z]={autoClear:M,depth:j,stencil:K}},Z.prototype.getAutoClearDepthStencilSetup=function(Z){return this._autoClearDepthStencil[Z]},Z.MAX_RENDERINGGROUPS=4,Z.MIN_RENDERINGGROUPS=0,Z.AUTOCLEAR=!0,Z}()},48623:function(Z,M,j){"use strict";var K="bakedVertexAnimation",b="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;\nfloat VATEndFrame=BVASNAME.y;\nfloat VATOffsetFrame=BVASNAME.z;\nfloat VATSpeed=BVASNAME.w;\nfloat totalFrames=VATEndFrame-VATStartFrame+1.0;\nfloat time=bakedVertexAnimationTime*VATSpeed/totalFrames;\nfloat frameCorrection=time<1.0 ? 0.0 : 1.0;\nfloat numOfFrames=totalFrames-frameCorrection;\nfloat VATFrameNum=fract(time)*numOfFrames;\nVATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);\nVATFrameNum=floor(VATFrameNum);\nVATFrameNum+=VATStartFrame+frameCorrection;\nmat4 VATInfluence;\nVATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;\n}\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},54001:function(Z,M,j){"use strict";var K="bakedVertexAnimationDeclaration",b="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;\nuniform vec2 bakedVertexAnimationTextureSizeInverted;\nuniform vec4 bakedVertexAnimationSettings;\nuniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{\nfloat offset=index*4.0;\nfloat frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;\nfloat dx=bakedVertexAnimationTextureSizeInverted.x;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},31377:function(Z,M,j){"use strict";var K="bonesDeclaration",b="#if NUM_BONE_INFLUENCERS>0\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#ifdef BONES_VELOCITY_ENABLED\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#endif\n#ifdef BONETEXTURE\n#define inline\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index *4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},97202:function(Z,M,j){"use strict";var K="bonesVertex",b="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},78767:function(Z,M,j){"use strict";var K="bumpFragment",b="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#elif defined(BUMP)\nfloat normalScale=vBumpInfos.y;\n#else\nfloat normalScale=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#elif defined(BUMP)\nvec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vTangentSpaceParams);\n#else\nvec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nvec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;\nmat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);\nvec2 detailNormalRG=detailColor.wy*2.0-1.0;\nfloat detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));\nvec3 detailNormal=vec3(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz *2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,texture2D(bumpSampler,vBumpUV+uvOffset).xyz,vBumpInfos.y);\n#else\nvec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal.xy*=vDetailInfos.z;\nvec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal.xy*=vDetailInfos.z;\nbumpNormal+=vec3(0.0,0.0,1.0);\ndetailNormal*=vec3(-1.0,-1.0,1.0);\nvec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal.xy*=vDetailInfos.z;\nnormalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},49904:function(Z,M,j){"use strict";var K=j(16179),b=(j(54587),"bumpFragmentFunctions"),g="#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,texCoord+vCurrOffset).w;\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n";K.d.IncludesShadersStore[b]=g},72994:function(Z,M,j){"use strict";var K="bumpFragmentMainFunctions",b="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)\n{\n#ifdef NORMALXYSCALE\nnormal=normalize(normal*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*normal);\n}\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{\nreturn perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);\n}\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},70179:function(Z,M,j){"use strict";var K="bumpVertex",b="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},20142:function(Z,M,j){"use strict";var K="bumpVertexDeclaration",b="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},84098:function(Z,M,j){"use strict";var K="clipPlaneFragment",b="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{\ndiscard;\n}\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},76578:function(Z,M,j){"use strict";var K="clipPlaneFragmentDeclaration",b="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},61906:function(Z,M,j){"use strict";var K="clipPlaneVertex",b="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},49329:function(Z,M,j){"use strict";var K="clipPlaneVertexDeclaration",b="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nvarying float fClipDistance6;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},75060:function(Z,M,j){"use strict";var K="depthPrePass",b="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},80345:function(Z,M,j){"use strict";var K="fogFragment",b="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},35850:function(Z,M,j){"use strict";var K="fogFragmentDeclaration",b="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR==vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},32560:function(Z,M,j){"use strict";var K="fogVertex",b="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},23654:function(Z,M,j){"use strict";var K="fogVertexDeclaration",b="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},83874:function(Z,M,j){"use strict";var K="helperFunctions",b="const float PI=3.1415926535897932384626433832795;\nconst float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nfloat toLinearSpace(float color)\n{\nreturn pow(color,LinearEncodePowerApprox);\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec4 toLinearSpace(vec4 color)\n{\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nvec4 toGammaSpace(vec4 color)\n{\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n}\nfloat toGammaSpace(float color)\n{\nreturn pow(color,GammaEncodePowerApprox);\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nvec3 square(vec3 value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D =max(rgbdMaxRange/maxRGB,1.);\nD =clamp(floor(D)/255.0,0.,1.);\nvec3 rgb=color.rgb*D;\nrgb=toGammaSpace(rgb);\nreturn vec4(clamp(rgb,0.,1.),D); \n}\nvec3 fromRGBD(vec4 rgbd) {\nrgbd.rgb=toLinearSpace(rgbd.rgb);\nreturn rgbd.rgb/rgbd.a;\n}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\nvec3 intersectPositionWS=vertexPos+origVec*distance;\nreturn intersectPositionWS-cubePos;\n}\n";j(16179).d.IncludesShadersStore[K]=b},23598:function(Z,M,j){"use strict";var K="imageProcessingDeclaration",b="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},68923:function(Z,M,j){"use strict";var K="imageProcessingFunctions",b="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}";j(16179).d.IncludesShadersStore[K]=b},16554:function(Z,M,j){"use strict";var K="instancesDeclaration",b="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute vec4 previousWorld0;\nattribute vec4 previousWorld1;\nattribute vec4 previousWorld2;\nattribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform mat4 previousWorld;\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},50511:function(Z,M,j){"use strict";var K="instancesVertex",b="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,previousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},57932:function(Z,M,j){"use strict";var K="lightFragment",b="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#ifdef IRIDESCENCE\npreInfo.iridescenceIntensity=iridescenceIntensity;\n#endif\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\npreInfo.roughness=sheenOut.sheenIntensity;\n#else\n#ifdef HEMILIGHT{X}\npreInfo.roughness=sheenOut.sheenRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef CLEARCOAT\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearcoatOut.clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\nabsorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) \n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {\nindex{X}=i;\nbreak;\n}\n}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];\nfloat diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};\nif (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{\nindex{X}+=1;\nfloat nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else \ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},65084:function(Z,M,j){"use strict";var K="lightFragmentDeclaration",b="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},45928:function(Z,M,j){"use strict";var K="lightUboDeclaration",b="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X}; \n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},65359:function(Z,M,j){"use strict";var K="lightVxFragmentDeclaration",b="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},58003:function(Z,M,j){"use strict";var K="lightVxUboDeclaration",b="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},96919:function(Z,M,j){"use strict";var K="logDepthDeclaration",b="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},84981:function(Z,M,j){"use strict";var K="logDepthFragment",b="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},30242:function(Z,M,j){"use strict";var K="logDepthVertex",b="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},87321:function(Z,M,j){"use strict";var K="mainUVVaryingDeclaration",b="#ifdef MAINUV{X}\nvarying vec2 vMainUV{X};\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},61496:function(Z,M,j){"use strict";var K="meshUboDeclaration",b="#ifdef WEBGL2\nuniform mat4 world;\nuniform float visibility;\n#else\nlayout(std140,column_major) uniform;\nuniform Mesh\n{\nmat4 world;\nfloat visibility;\n};\n#endif\n#define WORLD_UBO\n";j(16179).d.IncludesShadersStore[K]=b},48767:function(Z,M,j){"use strict";var K="morphTargetsVertex",b="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE \nvertexID=float(gl_VertexID)*morphTargetTextureInfo.x;\npositionUpdated+=(readVector3FromRawSampler({X},vertexID)-position)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(readVector3FromRawSampler({X},vertexID) -normal)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(readVector3FromRawSampler({X},vertexID).xy-uv)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(readVector3FromRawSampler({X},vertexID) -tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#else\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},83700:function(Z,M,j){"use strict";var K="morphTargetsVertexDeclaration",b="#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},63886:function(Z,M,j){"use strict";var K="morphTargetsVertexGlobal",b="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nfloat vertexID;\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},36062:function(Z,M,j){"use strict";var K="morphTargetsVertexGlobalDeclaration",b="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#ifdef MORPHTARGETS_TEXTURE \nprecision mediump sampler2DArray; \nuniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];\nuniform vec3 morphTargetTextureInfo;\nuniform sampler2DArray morphTargets;\nvec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);\nfloat x=vertexIndex-y*morphTargetTextureInfo.y;\nvec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);\nreturn texture(morphTargets,textureUV).xyz;\n}\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},44184:function(Z,M,j){"use strict";var K="oitDeclaration",b="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out vec2 depth; \nlayout(location=1) out vec4 frontColor;\nlayout(location=2) out vec4 backColor;\n#define MAX_DEPTH 99999.0\nhighp vec4 gl_FragColor;\nuniform sampler2D oitDepthSampler;\nuniform sampler2D oitFrontColorSampler;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},69991:function(Z,M,j){"use strict";var K="oitFragment",b="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nfloat fragDepth=gl_FragCoord.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nuint halfFloat=packHalf2x16(vec2(fragDepth));\nvec2 full=unpackHalf2x16(halfFloat);\nfragDepth=full.x;\n#endif\nivec2 fragCoord=ivec2(gl_FragCoord.xy);\nvec2 lastDepth=texelFetch(oitDepthSampler,fragCoord,0).rg;\nvec4 lastFrontColor=texelFetch(oitFrontColorSampler,fragCoord,0);\ndepth.rg=vec2(-MAX_DEPTH);\nfrontColor=lastFrontColor;\nbackColor=vec4(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nfloat furthestDepth=-lastDepth.x;\nfloat nearestDepth=lastDepth.y;\n#else\nfloat nearestDepth=-lastDepth.x;\nfloat furthestDepth=lastDepth.y;\n#endif\nfloat alphaMultiplier=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn;\n}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\ndepth.rg=vec2(-fragDepth,fragDepth);\nreturn;\n}\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},74422:function(Z,M,j){"use strict";var K="prePassDeclaration",b="#ifdef PREPASS\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out highp vec4 glFragData[{X}];highp vec4 gl_FragColor;\n#ifdef PREPASS_DEPTH\nvarying highp vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying highp vec4 vCurrentPosition;varying highp vec4 vPreviousPosition;\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},32875:function(Z,M,j){"use strict";var K="prePassVertex",b="#ifdef PREPASS_DEPTH\nvViewPos=(view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;\npreviousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*finalPreviousWorld*previousInfluence*vec4(positionUpdated,1.0);\n#else\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},63201:function(Z,M,j){"use strict";var K="prePassVertexDeclaration",b="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform mat4 previousViewProjection;\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},31814:function(Z,M,j){"use strict";var K="reflectionFunction",b="vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0); \n}\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(1.0-s,t,0); \n}\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=worldPos.xyz-eyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*(view*worldPos));\n}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*vec4(positionW,1.));\n}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},54587:function(Z,M,j){"use strict";var K="samplerFragmentDeclaration",b="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\nuniform sampler2D _SAMPLERNAME_Sampler;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},138:function(Z,M,j){"use strict";var K="samplerVertexDeclaration",b="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},58878:function(Z,M,j){"use strict";var K="samplerVertexImplementation",b="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (v_INFONAME_==0.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uvUpdated,1.0,0.0));\n}\n#ifdef UV2\nelse if (v_INFONAME_==1.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef UV3\nelse if (v_INFONAME_==2.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv3,1.0,0.0));\n}\n#endif\n#ifdef UV4\nelse if (v_INFONAME_==3.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv4,1.0,0.0));\n}\n#endif\n#ifdef UV5\nelse if (v_INFONAME_==4.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv5,1.0,0.0));\n}\n#endif\n#ifdef UV6\nelse if (v_INFONAME_==5.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv6,1.0,0.0));\n}\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},88987:function(Z,M,j){"use strict";var K="sceneUboDeclaration",b="layout(std140,column_major) uniform;\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif \nmat4 view;\nmat4 projection;\nvec4 vEyePosition;\n};\n";j(16179).d.IncludesShadersStore[K]=b},35765:function(Z,M,j){"use strict";var K="shadowsFragmentFunctions",b="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\n#define inline\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nreturn depth>shadow ? darkness : 1.0;\n}\n#define inline\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\n#define inline\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness); \nreturn esm;\n}\n#define inline\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\n#if defined(WEBGL2) || defined(WEBGPU)\n#define inline\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nvec3 uvLayer=vec3(uv.x,uv.y,layer);\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;\n}\n#endif\n#define inline\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;\n}\n}\n#define inline\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#ifdef IS_NDC_HALF_ZRANGE\n#define ZINCLIP clipSpace.z\n#else\n#define ZINCLIP uvDepth.z\n#endif\n#if defined(WEBGL2) || defined(WEBGPU)\n#define GREATEST_LESS_THAN_ONE 0.99999994\n#define inline\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat shadow=texture2D(shadowSampler,uvDepthLayer);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n#define inline\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture2D(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nelse\n{\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\nfloat AAOffset=shadowMapSizeInverse*10.;\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);\nvec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec4 offset=vec4(poissonSamplers[i],0.);\noffset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);\nshadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\nshadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture2D(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nelse\n{\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\nfloat AAOffset=shadowMapSizeInverse*10.;\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n}\n#define inline\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\n#define inline\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\n#define inline\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#define inline\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#define inline\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#define inline\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},70323:function(Z,M,j){"use strict";var K="shadowsVertex",b="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {\nvPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}[i]=(-vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}[i]=(vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}=(-vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}=(vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},94040:function(Z,M,j){"use strict";var K="uvAttributeDeclaration",b="#ifdef UV{X}\nattribute vec2 uv{X};\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},3970:function(Z,M,j){"use strict";var K="uvVariableDeclaration",b="#if !defined(UV{X}) && defined(MAINUV{X})\nvec2 uv{X}=vec2(0.,0.);\n#endif\n#ifdef MAINUV{X}\nvMainUV{X}=uv{X};\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},35738:function(Z,M,j){"use strict";var K="vertexColorMixing",b="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvColor=vec4(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvColor*=color;\n#else\nvColor.rgb*=color.rgb;\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvColor*=instanceColor;\n#endif\n#endif\n";j(16179).d.IncludesShadersStore[K]=b},69233:function(Z,M,j){"use strict";var K=j(16179),b=(j(83874),"rgbdDecodePixelShader"),g="varying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}";K.d.ShadersStore[b]=g},60569:function(Z,M,j){"use strict";j.d(M,{d:function(){return K}});var K=function(){function Z(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return Z.AddParser=function(Z,M){this._BabylonFileParsers[Z]=M},Z.GetParser=function(Z){return this._BabylonFileParsers[Z]?this._BabylonFileParsers[Z]:null},Z.AddIndividualParser=function(Z,M){this._IndividualBabylonFileParsers[Z]=M},Z.GetIndividualParser=function(Z){return this._IndividualBabylonFileParsers[Z]?this._IndividualBabylonFileParsers[Z]:null},Z.Parse=function(Z,M,j,K){for(var b in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,b)&&this._BabylonFileParsers[b](Z,M,j,K)},Object.defineProperty(Z.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(Z){this._environmentTexture=Z},enumerable:!1,configurable:!0}),Z.prototype.getNodes=function(){var Z=new Array;return Z=(Z=(Z=(Z=Z.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach((function(M){return Z=Z.concat(M.bones)})),Z},Z._BabylonFileParsers={},Z._IndividualBabylonFileParsers={},Z}()},74134:function(Z,M,j){"use strict";j.d(M,{b:function(){return E}});var K=j(40061),b=j(80105),g=j(9892),O=j(9271),Q=j(78588),Y=j(50504),I=function(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new O.b,this._onClonedObservable=new O.b},E=function(){function Z(Z,M){void 0===M&&(M=null),this._isDirty=!1,this._nodeDataStorage=new I,this.state="",this.metadata=null,this.reservedDataStore=null,this._parentContainer=null,this.animations=new Array,this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=b.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new O.b,this._onDisposeObserver=null,this._behaviors=new Array,this.name=Z,this.id=Z,this._scene=M||Q.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return Z.AddNodeConstructor=function(Z,M){this._NodeConstructors[Z]=M},Z.Construct=function(Z,M,j,K){var b=this._NodeConstructors[Z];return b?b(M,j,K):null},Object.defineProperty(Z.prototype,"doNotSerialize",{get:function(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(Z){this._nodeDataStorage._doNotSerialize=Z},enumerable:!1,configurable:!0}),Z.prototype.isDisposed=function(){return this._nodeDataStorage._isDisposed},Object.defineProperty(Z.prototype,"parent",{get:function(){return this._parentNode},set:function(Z){if(this._parentNode!==Z){var M=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var j=this._parentNode._children.indexOf(this);-1!==j&&this._parentNode._children.splice(j,1),Z||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=Z,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),M||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),Z.prototype._serializeAsParent=function(Z){Z.parentId=this.uniqueId},Z.prototype._addToSceneRootNodes=function(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},Z.prototype._removeFromSceneRootNodes=function(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){var Z=this._scene.rootNodes,M=Z.length-1;Z[this._nodeDataStorage._sceneRootNodesIndex]=Z[M],Z[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}},Object.defineProperty(Z.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(Z){this._animationPropertiesOverride=Z},enumerable:!1,configurable:!0}),Z.prototype.getClassName=function(){return"Node"},Object.defineProperty(Z.prototype,"onDispose",{set:function(Z){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onEnabledStateChangedObservable",{get:function(){return this._nodeDataStorage._onEnabledStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onClonedObservable",{get:function(){return this._nodeDataStorage._onClonedObservable},enumerable:!1,configurable:!0}),Z.prototype.getScene=function(){return this._scene},Z.prototype.getEngine=function(){return this._scene.getEngine()},Z.prototype.addBehavior=function(Z,M){var j=this;return void 0===M&&(M=!1),-1!==this._behaviors.indexOf(Z)||(Z.init(),this._scene.isLoading&&!M?this._scene.onDataLoadedObservable.addOnce((function(){Z.attach(j)})):Z.attach(this),this._behaviors.push(Z)),this},Z.prototype.removeBehavior=function(Z){var M=this._behaviors.indexOf(Z);return-1===M||(this._behaviors[M].detach(),this._behaviors.splice(M,1)),this},Object.defineProperty(Z.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),Z.prototype.getBehaviorByName=function(Z){for(var M=0,j=this._behaviors;M<j.length;M++){var K=j[M];if(K.name===Z)return K}return null},Z.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},Z.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(Z.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),Z.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},Z.prototype.updateCache=function(Z){!Z&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},Z.prototype._getActionManagerForTrigger=function(Z,M){return void 0===M&&(M=!0),this.parent?this.parent._getActionManagerForTrigger(Z,!1):null},Z.prototype._updateCache=function(Z){},Z.prototype._isSynchronized=function(){return!0},Z.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},Z.prototype.isSynchronizedWithParent=function(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},Z.prototype.isSynchronized=function(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},Z.prototype.isReady=function(Z){return void 0===Z&&(Z=!1),this._nodeDataStorage._isReady},Z.prototype.markAsDirty=function(Z){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Z.prototype.isEnabled=function(Z){return void 0===Z&&(Z=!0),!1===Z?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled},Z.prototype._syncParentEnabledState=function(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((function(Z){Z._syncParentEnabledState()}))},Z.prototype.setEnabled=function(Z){this._nodeDataStorage._isEnabled!==Z&&(this._nodeDataStorage._isEnabled=Z,this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(Z),this._syncParentEnabledState())},Z.prototype.isDescendantOf=function(Z){return!!this.parent&&(this.parent===Z||this.parent.isDescendantOf(Z))},Z.prototype._getDescendants=function(Z,M,j){if(void 0===M&&(M=!1),this._children)for(var K=0;K<this._children.length;K++){var b=this._children[K];j&&!j(b)||Z.push(b),M||b._getDescendants(Z,!1,j)}},Z.prototype.getDescendants=function(Z,M){var j=new Array;return this._getDescendants(j,Z,M),j},Z.prototype.getChildMeshes=function(Z,M){var j=[];return this._getDescendants(j,Z,(function(Z){return(!M||M(Z))&&void 0!==Z.cullingStrategy})),j},Z.prototype.getChildren=function(Z,M){return void 0===M&&(M=!0),this.getDescendants(M,Z)},Z.prototype._setReady=function(Z){Z!==this._nodeDataStorage._isReady&&(Z?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)},Z.prototype.getAnimationByName=function(Z){for(var M=0;M<this.animations.length;M++){var j=this.animations[M];if(j.name===Z)return j}return null},Z.prototype.createAnimationRange=function(M,j,K){if(!this._ranges[M]){this._ranges[M]=Z._AnimationRangeFactory(M,j,K);for(var b=0,g=this.animations.length;b<g;b++)this.animations[b]&&this.animations[b].createRange(M,j,K)}},Z.prototype.deleteAnimationRange=function(Z,M){void 0===M&&(M=!0);for(var j=0,K=this.animations.length;j<K;j++)this.animations[j]&&this.animations[j].deleteRange(Z,M);this._ranges[Z]=null},Z.prototype.getAnimationRange=function(Z){return this._ranges[Z]||null},Z.prototype.getAnimationRanges=function(){var Z,M=[];for(Z in this._ranges)M.push(this._ranges[Z]);return M},Z.prototype.beginAnimation=function(Z,M,j,K){var b=this.getAnimationRange(Z);return b?this._scene.beginAnimation(this,b.from,b.to,M,j,K):null},Z.prototype.serializeAnimationRanges=function(){var Z=[];for(var M in this._ranges){var j=this._ranges[M];if(j){var K={};K.name=M,K.from=j.from,K.to=j.to,Z.push(K)}}return Z},Z.prototype.computeWorldMatrix=function(Z){return this._worldMatrix||(this._worldMatrix=b.c.Identity()),this._worldMatrix},Z.prototype.dispose=function(Z,M){if(void 0===M&&(M=!1),this._nodeDataStorage._isDisposed=!0,!Z)for(var j=0,K=this.getDescendants(!0);j<K.length;j++){K[j].dispose(Z,M)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(var b=0,g=this._behaviors;b<g.length;b++){g[b].detach()}this._behaviors=[],this.metadata=null},Z.ParseAnimationRanges=function(Z,M,j){if(M.ranges)for(var K=0;K<M.ranges.length;K++){var b=M.ranges[K];Z.createAnimationRange(b.name,b.from,b.to)}},Z.prototype.getHierarchyBoundingVectors=function(Z,M){var j,K;void 0===Z&&(Z=!0),void 0===M&&(M=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var g=this;if(g.getBoundingInfo&&g.subMeshes){var O=g.getBoundingInfo();j=O.boundingBox.minimumWorld.clone(),K=O.boundingBox.maximumWorld.clone()}else j=new b.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),K=new b.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(Z)for(var Q=0,Y=this.getDescendants(!1);Q<Y.length;Q++){var I=Y[Q];if(I.computeWorldMatrix(!0),(!M||M(I))&&I.getBoundingInfo&&0!==I.getTotalVertices()){var E=I.getBoundingInfo().boundingBox,s=E.minimumWorld,i=E.maximumWorld;b.k.CheckExtends(s,j,K),b.k.CheckExtends(i,j,K)}}return{min:j,max:K}},Z._AnimationRangeFactory=function(Z,M,j){throw(0,Y.e)("AnimationRange")},Z._NodeConstructors={},(0,K.l)([(0,g.z)()],Z.prototype,"name",void 0),(0,K.l)([(0,g.z)()],Z.prototype,"id",void 0),(0,K.l)([(0,g.z)()],Z.prototype,"uniqueId",void 0),(0,K.l)([(0,g.z)()],Z.prototype,"state",void 0),(0,K.l)([(0,g.z)()],Z.prototype,"metadata",void 0),Z}()},40061:function(Z,M,j){"use strict";j.d(M,{e:function(){return g},h:function(){return Q},l:function(){return O},m:function(){return b},n:function(){return Y}});var K=function(Z,M){return K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Z,M){Z.__proto__=M}||function(Z,M){for(var j in M)Object.prototype.hasOwnProperty.call(M,j)&&(Z[j]=M[j])},K(Z,M)};function b(Z,M){if("function"!==typeof M&&null!==M)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function j(){this.constructor=Z}K(Z,M),Z.prototype=null===M?Object.create(M):(j.prototype=M.prototype,new j)}var g=function(){return g=Object.assign||function(Z){for(var M,j=1,K=arguments.length;j<K;j++)for(var b in M=arguments[j])Object.prototype.hasOwnProperty.call(M,b)&&(Z[b]=M[b]);return Z},g.apply(this,arguments)};function O(Z,M,j,K){var b,g=arguments.length,O=g<3?M:null===K?K=Object.getOwnPropertyDescriptor(M,j):K;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)O=Reflect.decorate(Z,M,j,K);else for(var Q=Z.length-1;Q>=0;Q--)(b=Z[Q])&&(O=(g<3?b(O):g>3?b(M,j,O):b(M,j))||O);return g>3&&O&&Object.defineProperty(M,j,O),O}function Q(Z,M,j,K){return new(j||(j=Promise))((function(b,g){function O(Z){try{Y(K.next(Z))}catch(Z){g(Z)}}function Q(Z){try{Y(K.throw(Z))}catch(Z){g(Z)}}function Y(Z){var M;Z.done?b(Z.value):(M=Z.value,M instanceof j?M:new j((function(Z){Z(M)}))).then(O,Q)}Y((K=K.apply(Z,M||[])).next())}))}function Y(Z,M){var j,K,b,g,O={label:0,sent:function(){if(1&b[0])throw b[1];return b[1]},trys:[],ops:[]};return g={next:Q(0),throw:Q(1),return:Q(2)},"function"===typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function Q(Q){return function(Y){return function(Q){if(j)throw new TypeError("Generator is already executing.");for(;g&&(g=0,Q[0]&&(O=0)),O;)try{if(j=1,K&&(b=2&Q[0]?K.return:Q[0]?K.throw||((b=K.return)&&b.call(K),0):K.next)&&!(b=b.call(K,Q[1])).done)return b;switch(K=0,b&&(Q=[2&Q[0],b.value]),Q[0]){case 0:case 1:b=Q;break;case 4:return O.label++,{value:Q[1],done:!1};case 5:O.label++,K=Q[1],Q=[0];continue;case 7:Q=O.ops.pop(),O.trys.pop();continue;default:if(!(b=(b=O.trys).length>0&&b[b.length-1])&&(6===Q[0]||2===Q[0])){O=0;continue}if(3===Q[0]&&(!b||Q[1]>b[0]&&Q[1]<b[3])){O.label=Q[1];break}if(6===Q[0]&&O.label<b[1]){O.label=b[1],b=Q;break}if(b&&O.label<b[2]){O.label=b[2],O.ops.push(Q);break}b[2]&&O.ops.pop(),O.trys.pop();continue}Q=M.call(Z,O)}catch(Z){Q=[6,Z],K=0}finally{j=b=0}if(5&Q[0])throw Q[1];return{value:Q[0]?Q[1]:void 0,done:!0}}([Q,Y])}}}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError},37105:function(Z,M,j){"use strict";j.d(M,{c:function(){return v}});var K,b,g,O,Q,Y,I,E=j(40061),s=j(9217),i=j(19500),a=j(9271),z=j(17190),V=function(){function Z(){this._count=0,this._data={}}return Z.prototype.copyFrom=function(Z){var M=this;this.clear(),Z.forEach((function(Z,j){return M.add(Z,j)}))},Z.prototype.get=function(Z){var M=this._data[Z];if(void 0!==M)return M},Z.prototype.getOrAddWithFactory=function(Z,M){var j=this.get(Z);return void 0!==j||(j=M(Z))&&this.add(Z,j),j},Z.prototype.getOrAdd=function(Z,M){var j=this.get(Z);return void 0!==j?j:(this.add(Z,M),M)},Z.prototype.contains=function(Z){return void 0!==this._data[Z]},Z.prototype.add=function(Z,M){return void 0===this._data[Z]&&(this._data[Z]=M,++this._count,!0)},Z.prototype.set=function(Z,M){return void 0!==this._data[Z]&&(this._data[Z]=M,!0)},Z.prototype.getAndRemove=function(Z){var M=this.get(Z);return void 0!==M?(delete this._data[Z],--this._count,M):null},Z.prototype.remove=function(Z){return!!this.contains(Z)&&(delete this._data[Z],--this._count,!0)},Z.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(Z.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),Z.prototype.forEach=function(Z){for(var M in this._data){Z(M,this._data[M])}},Z.prototype.first=function(Z){for(var M in this._data){var j=Z(M,this._data[M]);if(j)return j}return null},Z}(),o=j(45883),c=j(80105),G=j(60569),f=j(23016),X=j(90534),d=j(44904),W=function(){function Z(Z,M,j,K,b,g){this.source=Z,this.pointerX=M,this.pointerY=j,this.meshUnderPointer=K,this.sourceEvent=b,this.additionalData=g}return Z.CreateNew=function(M,j,K){var b=M.getScene();return new Z(M,b.pointerX,b.pointerY,b.meshUnderPointer||M,j,K)},Z.CreateNewFromSprite=function(M,j,K,b){return new Z(M,j.pointerX,j.pointerY,j.meshUnderPointer,K,b)},Z.CreateNewFromScene=function(M,j){return new Z(null,M.pointerX,M.pointerY,M.meshUnderPointer,j)},Z.CreateNewFromPrimitive=function(M,j,K,b){return new Z(M,j.x,j.y,null,K,b)},Z}(),A=j(64833),q=j(16369),T=j(21693),B=j(60985),N=j(78588),U=j(50504),n=j(25239),k=function(){function Z(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(Z,"HasTriggers",{get:function(){for(var M in Z.Triggers)if(Object.prototype.hasOwnProperty.call(Z.Triggers,M))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"HasPickTriggers",{get:function(){for(var M in Z.Triggers)if(Object.prototype.hasOwnProperty.call(Z.Triggers,M)){var j=parseInt(M);if(j>=1&&j<=7)return!0}return!1},enumerable:!1,configurable:!0}),Z.HasSpecificTrigger=function(M){for(var j in Z.Triggers){if(Object.prototype.hasOwnProperty.call(Z.Triggers,j))if(parseInt(j)===M)return!0}return!1},Z.Triggers={},Z}(),x=j(45591);!function(Z){Z[Z.Generic=0]="Generic",Z[Z.Keyboard=1]="Keyboard",Z[Z.Mouse=2]="Mouse",Z[Z.Touch=3]="Touch",Z[Z.DualShock=4]="DualShock",Z[Z.Xbox=5]="Xbox",Z[Z.Switch=6]="Switch",Z[Z.DualSense=7]="DualSense"}(K||(K={})),function(Z){Z[Z.Horizontal=0]="Horizontal",Z[Z.Vertical=1]="Vertical",Z[Z.LeftClick=2]="LeftClick",Z[Z.MiddleClick=3]="MiddleClick",Z[Z.RightClick=4]="RightClick",Z[Z.BrowserBack=5]="BrowserBack",Z[Z.BrowserForward=6]="BrowserForward",Z[Z.MouseWheelX=7]="MouseWheelX",Z[Z.MouseWheelY=8]="MouseWheelY",Z[Z.MouseWheelZ=9]="MouseWheelZ",Z[Z.Move=12]="Move"}(b||(b={})),function(Z){Z[Z.Horizontal=0]="Horizontal",Z[Z.Vertical=1]="Vertical",Z[Z.LeftClick=2]="LeftClick",Z[Z.MiddleClick=3]="MiddleClick",Z[Z.RightClick=4]="RightClick",Z[Z.BrowserBack=5]="BrowserBack",Z[Z.BrowserForward=6]="BrowserForward",Z[Z.MouseWheelX=7]="MouseWheelX",Z[Z.MouseWheelY=8]="MouseWheelY",Z[Z.MouseWheelZ=9]="MouseWheelZ",Z[Z.DeltaHorizontal=10]="DeltaHorizontal",Z[Z.DeltaVertical=11]="DeltaVertical"}(g||(g={})),function(Z){Z[Z.Cross=0]="Cross",Z[Z.Circle=1]="Circle",Z[Z.Square=2]="Square",Z[Z.Triangle=3]="Triangle",Z[Z.L1=4]="L1",Z[Z.R1=5]="R1",Z[Z.L2=6]="L2",Z[Z.R2=7]="R2",Z[Z.Share=8]="Share",Z[Z.Options=9]="Options",Z[Z.L3=10]="L3",Z[Z.R3=11]="R3",Z[Z.DPadUp=12]="DPadUp",Z[Z.DPadDown=13]="DPadDown",Z[Z.DPadLeft=14]="DPadLeft",Z[Z.DPadRight=15]="DPadRight",Z[Z.Home=16]="Home",Z[Z.TouchPad=17]="TouchPad",Z[Z.LStickXAxis=18]="LStickXAxis",Z[Z.LStickYAxis=19]="LStickYAxis",Z[Z.RStickXAxis=20]="RStickXAxis",Z[Z.RStickYAxis=21]="RStickYAxis"}(O||(O={})),function(Z){Z[Z.Cross=0]="Cross",Z[Z.Circle=1]="Circle",Z[Z.Square=2]="Square",Z[Z.Triangle=3]="Triangle",Z[Z.L1=4]="L1",Z[Z.R1=5]="R1",Z[Z.L2=6]="L2",Z[Z.R2=7]="R2",Z[Z.Create=8]="Create",Z[Z.Options=9]="Options",Z[Z.L3=10]="L3",Z[Z.R3=11]="R3",Z[Z.DPadUp=12]="DPadUp",Z[Z.DPadDown=13]="DPadDown",Z[Z.DPadLeft=14]="DPadLeft",Z[Z.DPadRight=15]="DPadRight",Z[Z.Home=16]="Home",Z[Z.TouchPad=17]="TouchPad",Z[Z.LStickXAxis=18]="LStickXAxis",Z[Z.LStickYAxis=19]="LStickYAxis",Z[Z.RStickXAxis=20]="RStickXAxis",Z[Z.RStickYAxis=21]="RStickYAxis"}(Q||(Q={})),function(Z){Z[Z.A=0]="A",Z[Z.B=1]="B",Z[Z.X=2]="X",Z[Z.Y=3]="Y",Z[Z.LB=4]="LB",Z[Z.RB=5]="RB",Z[Z.LT=6]="LT",Z[Z.RT=7]="RT",Z[Z.Back=8]="Back",Z[Z.Start=9]="Start",Z[Z.LS=10]="LS",Z[Z.RS=11]="RS",Z[Z.DPadUp=12]="DPadUp",Z[Z.DPadDown=13]="DPadDown",Z[Z.DPadLeft=14]="DPadLeft",Z[Z.DPadRight=15]="DPadRight",Z[Z.Home=16]="Home",Z[Z.LStickXAxis=17]="LStickXAxis",Z[Z.LStickYAxis=18]="LStickYAxis",Z[Z.RStickXAxis=19]="RStickXAxis",Z[Z.RStickYAxis=20]="RStickYAxis"}(Y||(Y={})),function(Z){Z[Z.B=0]="B",Z[Z.A=1]="A",Z[Z.Y=2]="Y",Z[Z.X=3]="X",Z[Z.L=4]="L",Z[Z.R=5]="R",Z[Z.ZL=6]="ZL",Z[Z.ZR=7]="ZR",Z[Z.Minus=8]="Minus",Z[Z.Plus=9]="Plus",Z[Z.LS=10]="LS",Z[Z.RS=11]="RS",Z[Z.DPadUp=12]="DPadUp",Z[Z.DPadDown=13]="DPadDown",Z[Z.DPadLeft=14]="DPadLeft",Z[Z.DPadRight=15]="DPadRight",Z[Z.Home=16]="Home",Z[Z.Capture=17]="Capture",Z[Z.LStickXAxis=18]="LStickXAxis",Z[Z.LStickYAxis=19]="LStickYAxis",Z[Z.RStickXAxis=20]="RStickXAxis",Z[Z.RStickYAxis=21]="RStickYAxis"}(I||(I={}));var R=j(13316),e=function(){function Z(){}return Z.CreateDeviceEvent=function(Z,M,j,g,O,Q){switch(Z){case K.Keyboard:return this._CreateKeyboardEvent(j,g,O,Q);case K.Mouse:if(j===b.MouseWheelX||j===b.MouseWheelY||j===b.MouseWheelZ)return this._CreateWheelEvent(Z,M,j,g,O,Q);case K.Touch:return this._CreatePointerEvent(Z,M,j,g,O,Q);default:throw"Unable to generate event for device ".concat(K[Z])}},Z._CreatePointerEvent=function(Z,M,j,g,O,Q){var Y=this._CreateMouseEvent(Z,M,j,g,O,Q);return Z===K.Mouse?(Y.deviceType=K.Mouse,Y.pointerId=1,Y.pointerType="mouse"):(Y.deviceType=K.Touch,Y.pointerId=M,Y.pointerType="touch"),j===b.Move?Y.type="pointermove":j>=b.LeftClick&&j<=b.RightClick&&(Y.type=1===g?"pointerdown":"pointerup",Y.button=j-2),Y},Z._CreateWheelEvent=function(Z,M,j,K,g,O){var Q=this._CreateMouseEvent(Z,M,j,K,g,O);switch(Q.type="wheel",Q.deltaMode=R.e.DOM_DELTA_PIXEL,Q.deltaX=0,Q.deltaY=0,Q.deltaZ=0,j){case b.MouseWheelX:Q.deltaX=K;break;case b.MouseWheelY:Q.deltaY=K;break;case b.MouseWheelZ:Q.deltaZ=K}return Q},Z._CreateMouseEvent=function(Z,M,j,K,O,Q){var Y=this._CreateEvent(Q),I=O.pollInput(Z,M,b.Horizontal),E=O.pollInput(Z,M,b.Vertical);return Q?(Y.movementX=0,Y.movementY=0,Y.offsetX=Y.movementX-Q.getBoundingClientRect().x,Y.offsetY=Y.movementY-Q.getBoundingClientRect().y):(Y.movementX=O.pollInput(Z,M,g.DeltaHorizontal),Y.movementY=O.pollInput(Z,M,g.DeltaVertical),Y.offsetX=0,Y.offsetY=0),this._CheckNonCharacterKeys(Y,O),Y.clientX=I,Y.clientY=E,Y.x=I,Y.y=E,Y.deviceType=Z,Y.deviceSlot=M,Y.inputIndex=j,Y},Z._CreateKeyboardEvent=function(Z,M,j,b){var g=this._CreateEvent(b);return this._CheckNonCharacterKeys(g,j),g.deviceType=K.Keyboard,g.deviceSlot=0,g.inputIndex=Z,g.type=1===M?"keydown":"keyup",g.key=String.fromCharCode(Z),g.keyCode=Z,g},Z._CheckNonCharacterKeys=function(Z,M){var j=M.isDeviceAvailable(K.Keyboard),b=j&&1===M.pollInput(K.Keyboard,0,18),g=j&&1===M.pollInput(K.Keyboard,0,17),O=j&&(1===M.pollInput(K.Keyboard,0,91)||1===M.pollInput(K.Keyboard,0,92)||1===M.pollInput(K.Keyboard,0,93)),Q=j&&1===M.pollInput(K.Keyboard,0,16);Z.altKey=b,Z.ctrlKey=g,Z.metaKey=O,Z.shiftKey=Q},Z._CreateEvent=function(Z){var M={preventDefault:function(){}};return M.target=Z,M},Z}(),u=function(){function Z(Z,M,j){var K=this;this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(Z,M,(function(Z,M,b,g){var O=e.CreateDeviceEvent(Z,M,b,g,K);j(Z,M,O)})):this._createDummyNativeInput()}return Z.prototype.pollInput=function(Z,M,j){return this._nativeInput.pollInput(Z,M,j)},Z.prototype.isDeviceAvailable=function(Z){return Z===K.Mouse||Z===K.Touch},Z.prototype.dispose=function(){this._nativeInput.dispose()},Z.prototype._createDummyNativeInput=function(){return{pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}}},Z}(),F=Object.keys(b).length/2,C=function(){function Z(Z,M,j,K){var b=this;this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=s.d.IsSafari(),this._usingMacOS=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=function(Z){},this._keyboardUpEvent=function(Z){},this._keyboardBlurEvent=function(Z){},this._pointerMoveEvent=function(Z){},this._pointerDownEvent=function(Z){},this._pointerUpEvent=function(Z){},this._pointerCancelEvent=function(Z){},this._pointerWheelEvent=function(Z){},this._pointerBlurEvent=function(Z){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=B.d.IsNavigatorAvailable()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(Z){},this._gamepadDisconnectedEvent=function(Z){},this._eventPrefix=s.d.GetPointerPrefix(Z),this._engine=Z,this._onDeviceConnected=M,this._onDeviceDisconnected=j,this._onInputChanged=K,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){b._enableEvents()})}return Z.prototype.pollInput=function(Z,M,j){var g=this._inputs[Z][M];if(!g)throw"Unable to find device ".concat(K[Z]);Z>=K.DualShock&&Z<=K.DualSense&&this._updateDevice(Z,M,j);var O=g[j];if(void 0===O)throw"Unable to find input ".concat(j," for device ").concat(K[Z]," in slot ").concat(M);return j===b.Move&&s.d.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),O},Z.prototype.isDeviceAvailable=function(Z){return void 0!==this._inputs[Z]},Z.prototype.dispose=function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()},Z.prototype._enableEvents=function(){var Z=null===this||void 0===this?void 0:this._engine.getInputElement();if(Z&&(!this._eventsAttached||this._elementToAttachTo!==Z)){if(this._disableEvents(),this._inputs)for(var M=0,j=this._inputs;M<j.length;M++){var K=j[M];if(K)for(var b in K){var g=K[+b];if(g)for(var O=0;O<g.length;O++)g[O]=0}}this._elementToAttachTo=Z,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}},Z.prototype._disableEvents=function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1},Z.prototype._checkForConnectedDevices=function(){if(navigator.getGamepads)for(var Z=0,M=navigator.getGamepads();Z<M.length;Z++){var j=M[Z];j&&this._addGamePad(j)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(K.Mouse,0,0,0)},Z.prototype._addGamePad=function(Z){var M=this._getGamepadDeviceType(Z.id),j=Z.index;this._gamepads=this._gamepads||new Array(Z.index+1),this._registerDevice(M,j,Z.buttons.length+Z.axes.length),this._gamepads[j]=M},Z.prototype._addPointerDevice=function(Z,M,j,K){this._pointerActive||(this._pointerActive=!0),this._registerDevice(Z,M,F);var b=this._inputs[Z][M];b[0]=j,b[1]=K},Z.prototype._registerDevice=function(Z,M,j){if(void 0===M)throw"Unable to register device ".concat(K[Z]," to undefined slot.");if(this._inputs[Z]||(this._inputs[Z]={}),!this._inputs[Z][M]){for(var b=new Array(j),g=0;g<j;g++)b[g]=0;this._inputs[Z][M]=b,this._onDeviceConnected(Z,M)}},Z.prototype._unregisterDevice=function(Z,M){this._inputs[Z][M]&&(delete this._inputs[Z][M],this._onDeviceDisconnected(Z,M))},Z.prototype._handleKeyActions=function(){var Z=this;this._keyboardDownEvent=function(M){Z._keyboardActive||(Z._keyboardActive=!0,Z._registerDevice(K.Keyboard,0,255));var j=Z._inputs[K.Keyboard][0];if(j){j[M.keyCode]=1;var b=M;b.inputIndex=M.keyCode,Z._usingMacOS&&M.metaKey&&"Meta"!==M.key&&(Z._metaKeys.includes(M.keyCode)||Z._metaKeys.push(M.keyCode)),Z._onInputChanged(K.Keyboard,0,b)}},this._keyboardUpEvent=function(M){Z._keyboardActive||(Z._keyboardActive=!0,Z._registerDevice(K.Keyboard,0,255));var j=Z._inputs[K.Keyboard][0];if(j){j[M.keyCode]=0;var b=M;if(b.inputIndex=M.keyCode,Z._usingMacOS&&"Meta"===M.key&&Z._metaKeys.length>0){for(var g=0,O=Z._metaKeys;g<O.length;g++){var Q=O[g],Y=e.CreateDeviceEvent(K.Keyboard,0,Q,0,Z,Z._elementToAttachTo);j[Q]=0,Z._onInputChanged(K.Keyboard,0,Y)}Z._metaKeys.splice(0,Z._metaKeys.length)}Z._onInputChanged(K.Keyboard,0,b)}},this._keyboardBlurEvent=function(){if(Z._keyboardActive){for(var M=Z._inputs[K.Keyboard][0],j=0;j<M.length;j++)if(0!==M[j]){M[j]=0;var b=e.CreateDeviceEvent(K.Keyboard,0,j,0,Z,Z._elementToAttachTo);Z._onInputChanged(K.Keyboard,0,b)}Z._usingMacOS&&Z._metaKeys.splice(0,Z._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)},Z.prototype._handlePointerActions=function(){var Z=this;this._maxTouchPoints=B.d.IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var M=0;M<this._maxTouchPoints;M++)this._activeTouchIds[M]=-1;this._pointerMoveEvent=function(M){var j=Z._getPointerType(M),g=j===K.Mouse?0:Z._activeTouchIds.indexOf(M.pointerId);Z._inputs[j]||(Z._inputs[j]={}),Z._inputs[j][g]||Z._addPointerDevice(j,g,M.clientX,M.clientY);var O=Z._inputs[j][g];if(O){O[b.Horizontal]=M.clientX,O[b.Vertical]=M.clientY;var Q=M;Q.inputIndex=b.Move,Z._onInputChanged(j,g,Q),Z._usingSafari||-1===M.button||(Q.inputIndex=M.button+2,O[M.button+2]=O[M.button+2]?0:1,Z._onInputChanged(j,g,Q))}},this._pointerDownEvent=function(M){var j=Z._getPointerType(M),g=j===K.Mouse?0:M.pointerId;if(j===K.Touch){var O=Z._activeTouchIds.indexOf(-1);if(!(O>=0))return void s.d.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(Z._maxTouchPoints));g=O,Z._activeTouchIds[O]=M.pointerId}Z._inputs[j]||(Z._inputs[j]={}),Z._inputs[j][g]?j===K.Touch&&Z._onDeviceConnected(j,g):Z._addPointerDevice(j,g,M.clientX,M.clientY);var Q=Z._inputs[j][g];if(Q){var Y=Q[b.Horizontal],I=Q[b.Vertical];if(j===K.Mouse){if(-1===Z._mouseId&&(void 0===M.pointerId?Z._mouseId=Z._isUsingFirefox?0:1:Z._mouseId=M.pointerId),!document.pointerLockElement)try{Z._elementToAttachTo.setPointerCapture(Z._mouseId)}catch(Z){}}else if(M.pointerId&&!document.pointerLockElement)try{Z._elementToAttachTo.setPointerCapture(M.pointerId)}catch(Z){}Q[b.Horizontal]=M.clientX,Q[b.Vertical]=M.clientY,Q[M.button+2]=1;var E=M;E.inputIndex=M.button+2,Z._onInputChanged(j,g,E),Y===M.clientX&&I===M.clientY||(E.inputIndex=b.Move,Z._onInputChanged(j,g,E))}},this._pointerUpEvent=function(M){var j,g,O,Q,Y,I=Z._getPointerType(M),E=I===K.Mouse?0:Z._activeTouchIds.indexOf(M.pointerId);if(I===K.Touch){if(-1===E)return;Z._activeTouchIds[E]=-1}var s=null===(j=Z._inputs[I])||void 0===j?void 0:j[E];if(s&&0!==s[M.button+2]){var i=s[b.Horizontal],a=s[b.Vertical];s[b.Horizontal]=M.clientX,s[b.Vertical]=M.clientY,s[M.button+2]=0;var z=M;i===M.clientX&&a===M.clientY||(z.inputIndex=b.Move,Z._onInputChanged(I,E,z)),z.inputIndex=M.button+2,I===K.Mouse&&Z._mouseId>=0&&(null===(O=(g=Z._elementToAttachTo).hasPointerCapture)||void 0===O?void 0:O.call(g,Z._mouseId))?Z._elementToAttachTo.releasePointerCapture(Z._mouseId):M.pointerId&&(null===(Y=(Q=Z._elementToAttachTo).hasPointerCapture)||void 0===Y?void 0:Y.call(Q,M.pointerId))&&Z._elementToAttachTo.releasePointerCapture(M.pointerId),Z._onInputChanged(I,E,z),I===K.Touch&&Z._onDeviceDisconnected(I,E)}},this._pointerCancelEvent=function(M){var j,g,O,Q;if("mouse"===M.pointerType){var Y=Z._inputs[K.Mouse][0];Z._mouseId>=0&&(null===(g=(j=Z._elementToAttachTo).hasPointerCapture)||void 0===g?void 0:g.call(j,Z._mouseId))&&Z._elementToAttachTo.releasePointerCapture(Z._mouseId);for(var I=b.LeftClick;I<=b.BrowserForward;I++)if(1===Y[I]){Y[I]=0;var E=e.CreateDeviceEvent(K.Mouse,0,I,0,Z,Z._elementToAttachTo);Z._onInputChanged(K.Mouse,0,E)}}else{var s=Z._activeTouchIds.indexOf(M.pointerId);(null===(Q=(O=Z._elementToAttachTo).hasPointerCapture)||void 0===Q?void 0:Q.call(O,M.pointerId))&&Z._elementToAttachTo.releasePointerCapture(M.pointerId),Z._inputs[K.Touch][s][b.LeftClick]=0;E=e.CreateDeviceEvent(K.Touch,s,b.LeftClick,0,Z,Z._elementToAttachTo);Z._onInputChanged(K.Touch,s,E),Z._activeTouchIds[s]=-1,Z._onDeviceDisconnected(K.Touch,s)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";var j=!1,g=function(){};try{var O=Object.defineProperty({},"passive",{get:function(){j=!0}});this._elementToAttachTo.addEventListener("test",g,O),this._elementToAttachTo.removeEventListener("test",g,O)}catch(Z){}this._pointerBlurEvent=function(){var M,j,g,O,Q;if(Z.isDeviceAvailable(K.Mouse)){var Y=Z._inputs[K.Mouse][0];Z._mouseId>=0&&(null===(j=(M=Z._elementToAttachTo).hasPointerCapture)||void 0===j?void 0:j.call(M,Z._mouseId))&&Z._elementToAttachTo.releasePointerCapture(Z._mouseId);for(var I=b.LeftClick;I<=b.BrowserForward;I++)if(1===Y[I]){Y[I]=0;var E=e.CreateDeviceEvent(K.Mouse,0,I,0,Z,Z._elementToAttachTo);Z._onInputChanged(K.Mouse,0,E)}}if(Z.isDeviceAvailable(K.Touch)){Y=Z._inputs[K.Touch];for(var s=0;s<Z._activeTouchIds.length;s++){var i=Z._activeTouchIds[s];if((null===(O=(g=Z._elementToAttachTo).hasPointerCapture)||void 0===O?void 0:O.call(g,i))&&Z._elementToAttachTo.releasePointerCapture(i),-1!==i&&1===(null===(Q=Y[s])||void 0===Q?void 0:Q[b.LeftClick])){Y[s][b.LeftClick]=0;E=e.CreateDeviceEvent(K.Touch,s,b.LeftClick,0,Z,Z._elementToAttachTo);Z._onInputChanged(K.Touch,s,E),Z._activeTouchIds[s]=-1,Z._onDeviceDisconnected(K.Touch,s)}}}},this._pointerWheelEvent=function(M){var j=K.Mouse;Z._inputs[j]||(Z._inputs[j]=[]),Z._inputs[j][0]||(Z._pointerActive=!0,Z._registerDevice(j,0,F));var g=Z._inputs[j][0];if(g){g[b.MouseWheelX]=M.deltaX||0,g[b.MouseWheelY]=M.deltaY||M.wheelDelta||0,g[b.MouseWheelZ]=M.deltaZ||0;var O=M;0!==g[b.MouseWheelX]&&(O.inputIndex=b.MouseWheelX,Z._onInputChanged(j,0,O)),0!==g[b.MouseWheelY]&&(O.inputIndex=b.MouseWheelY,Z._onInputChanged(j,0,O)),0!==g[b.MouseWheelZ]&&(O.inputIndex=b.MouseWheelZ,Z._onInputChanged(j,0,O))}},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!j&&{passive:!0}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((function(){if(Z.isDeviceAvailable(K.Mouse)){var M=Z._inputs[K.Mouse][0];M[b.MouseWheelX]=0,M[b.MouseWheelY]=0,M[b.MouseWheelZ]=0}}))},Z.prototype._handleGamepadActions=function(){var Z=this;this._gamepadConnectedEvent=function(M){Z._addGamePad(M.gamepad)},this._gamepadDisconnectedEvent=function(M){if(Z._gamepads){var j=Z._getGamepadDeviceType(M.gamepad.id),K=M.gamepad.index;Z._unregisterDevice(j,K),delete Z._gamepads[K]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},Z.prototype._updateDevice=function(Z,M,j){var K=navigator.getGamepads()[M];if(K&&Z===this._gamepads[M]){var b=this._inputs[Z][M];j>=K.buttons.length?b[j]=K.axes[j-K.buttons.length].valueOf():b[j]=K.buttons[j].value}},Z.prototype._getGamepadDeviceType=function(Z){return-1!==Z.indexOf("054c")?-1!==Z.indexOf("0ce6")?K.DualSense:K.DualShock:-1!==Z.indexOf("Xbox One")||-1!==Z.search("Xbox 360")||-1!==Z.search("xinput")?K.Xbox:-1!==Z.indexOf("057e")?K.Switch:K.Generic},Z.prototype._getPointerType=function(Z){var M=K.Mouse;return("touch"===Z.pointerType||"pen"===Z.pointerType||Z.touches)&&(M=K.Touch),M},Z}(),y=function(){function Z(Z,M,j){void 0===j&&(j=0),this.deviceType=M,this.deviceSlot=j,this.onInputChangedObservable=new a.b,this._deviceInputSystem=Z}return Z.prototype.getInput=function(Z){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,Z)},Z}(),S=function(){function Z(Z){var M=this;this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(Z){for(var j=0;j<M._devices.length;j++){var K=M._devices[j];for(var b in K){var g=+b;Z._addDevice(new y(M._deviceInputSystem,j,g))}}M._registeredManagers.push(Z)},this.unregisterManager=function(Z){var j=M._registeredManagers.indexOf(Z);j>-1&&M._registeredManagers.splice(j,1)};var j=Object.keys(K).length/2;this._devices=new Array(j);var b=function(Z,j){M._devices[Z]||(M._devices[Z]=new Array),M._devices[Z][j]||(M._devices[Z][j]=j);for(var K=0,b=M._registeredManagers;K<b.length;K++){var g=b[K],O=new y(M._deviceInputSystem,Z,j);g._addDevice(O)}},g=function(Z,j){var K;(null===(K=M._devices[Z])||void 0===K?void 0:K[j])&&delete M._devices[Z][j];for(var b=0,g=M._registeredManagers;b<g.length;b++){g[b]._removeDevice(Z,j)}},O=function(Z,j,K){if(K)for(var b=0,g=M._registeredManagers;b<g.length;b++){g[b]._onInputChanged(Z,j,K)}};"undefined"!==typeof _native?this._deviceInputSystem=new u(b,g,O):this._deviceInputSystem=new C(Z,b,g,O)}return Z.prototype.dispose=function(){this._deviceInputSystem.dispose()},Z}(),h=function(){function Z(Z){var M=this,j=Object.keys(K).length/2;this._devices=new Array(j),this._firstDevice=new Array(j),this._engine=Z,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new S(Z)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new a.b((function(Z){for(var j=0,K=M._devices;j<K.length;j++){var b=K[j];if(b)for(var g=0,O=b;g<O.length;g++){var Q=O[g];Q&&M.onDeviceConnectedObservable.notifyObserver(Z,Q)}}})),this.onDeviceDisconnectedObservable=new a.b,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=Z.onDisposeObservable.add((function(){M.dispose()}))}return Z.prototype.getDeviceSource=function(Z,M){if(void 0===M){if(void 0===this._firstDevice[Z])return null;M=this._firstDevice[Z]}return this._devices[Z]&&void 0!==this._devices[Z][M]?this._devices[Z][M]:null},Z.prototype.getDeviceSources=function(Z){return this._devices[Z].filter((function(Z){return!!Z}))},Z.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)},Z.prototype._addDevice=function(Z){this._devices[Z.deviceType]||(this._devices[Z.deviceType]=new Array),this._devices[Z.deviceType][Z.deviceSlot]||(this._devices[Z.deviceType][Z.deviceSlot]=Z,this._updateFirstDevices(Z.deviceType)),this.onDeviceConnectedObservable.notifyObservers(Z)},Z.prototype._removeDevice=function(Z,M){var j,K,b=null===(j=this._devices[Z])||void 0===j?void 0:j[M];this.onDeviceDisconnectedObservable.notifyObservers(b),(null===(K=this._devices[Z])||void 0===K?void 0:K[M])&&delete this._devices[Z][M],this._updateFirstDevices(Z)},Z.prototype._onInputChanged=function(Z,M,j){var K,b;null===(b=null===(K=this._devices[Z])||void 0===K?void 0:K[M])||void 0===b||b.onInputChangedObservable.notifyObservers(j)},Z.prototype._updateFirstDevices=function(Z){switch(Z){case K.Keyboard:case K.Mouse:this._firstDevice[Z]=0;break;case K.Touch:case K.DualSense:case K.DualShock:case K.Xbox:case K.Switch:case K.Generic:delete this._firstDevice[Z];var M=this._devices[Z];if(M)for(var j=0;j<M.length;j++)if(M[j]){this._firstDevice[Z]=j;break}}},Z}(),w=function(){function Z(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(Z.prototype,"singleClick",{get:function(){return this._singleClick},set:function(Z){this._singleClick=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(Z){this._doubleClick=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(Z){this._hasSwiped=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"ignore",{get:function(){return this._ignore},set:function(Z){this._ignore=Z},enumerable:!1,configurable:!0}),Z}(),p=function(){function Z(Z){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new c.h(0,0),this._previousStartingPointerPosition=new c.h(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._deviceSourceManager=null,this._scene=Z||N.e.LastCreatedScene,this._scene}return Object.defineProperty(Z.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),Z.prototype.getMeshUnderPointerByPointerId=function(Z){return this._meshUnderPointerId[Z]||null},Object.defineProperty(Z.prototype,"unTranslatedPointer",{get:function(){return new c.h(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"pointerX",{get:function(){return this._pointerX},set:function(Z){this._pointerX=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"pointerY",{get:function(){return this._pointerY},set:function(Z){this._pointerY=Z},enumerable:!1,configurable:!0}),Z.prototype._updatePointerPosition=function(Z){var M=this._scene.getEngine().getInputElementClientRect();M&&(this._pointerX=Z.clientX-M.left,this._pointerY=Z.clientY-M.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},Z.prototype._processPointerMove=function(Z,M){var j=this._scene,K=j.getEngine(),b=K.getInputElement();b&&(b.tabIndex=K.canvasTabIndex,j.doNotHandleCursors||(b.style.cursor=j.defaultCursor));var g=!!(Z&&Z.hit&&Z.pickedMesh);if(g){if(j.setPointerOverMesh(Z.pickedMesh,M.pointerId,Z),!j.doNotHandleCursors&&b&&this._pointerOverMesh){var O=this._pointerOverMesh._getActionManagerForTrigger();O&&O.hasPointerTriggers&&(b.style.cursor=O.hoverCursor||j.hoverCursor)}}else j.setPointerOverMesh(null,M.pointerId,Z);for(var Q=0,Y=j._pointerMoveStage;Q<Y.length;Q++){Z=Y[Q].action(this._unTranslatedPointerX,this._unTranslatedPointerY,Z,g,b)}if(Z){var I="wheel"===M.type||"mousewheel"===M.type||"DOMMouseScroll"===M.type?n.d.POINTERWHEEL:n.d.POINTERMOVE;if(j.onPointerMove&&j.onPointerMove(M,Z,I),j.onPointerObservable.hasObservers()){var E=new n.j(I,M,Z);this._setRayOnPointerInfo(E),j.onPointerObservable.notifyObservers(E,I)}}},Z.prototype._setRayOnPointerInfo=function(Z){var M=this._scene;Z.pickInfo&&!Z.pickInfo._pickingUnavailable&&(Z.pickInfo.ray||(Z.pickInfo.ray=M.createPickingRay(Z.event.offsetX,Z.event.offsetY,c.c.Identity(),M.activeCamera)))},Z.prototype._checkPrePointerObservable=function(Z,M,j){var K=this._scene,b=new n.h(j,M,this._unTranslatedPointerX,this._unTranslatedPointerY);return Z&&(b.ray=Z.ray,Z.originMesh&&(b.nearInteractionPickingInfo=Z)),K.onPrePointerObservable.notifyObservers(b,j),!!b.skipOnPointerObservable},Z.prototype.simulatePointerMove=function(Z,M){var j=new PointerEvent("pointermove",M);j.inputIndex=b.Move,this._checkPrePointerObservable(Z,j,n.d.POINTERMOVE)||this._processPointerMove(Z,j)},Z.prototype.simulatePointerDown=function(Z,M){var j=new PointerEvent("pointerdown",M);j.inputIndex=j.button+2,this._checkPrePointerObservable(Z,j,n.d.POINTERDOWN)||this._processPointerDown(Z,j)},Z.prototype._processPointerDown=function(M,j){var K=this,b=this._scene;if(M&&M.hit&&M.pickedMesh){this._pickedDownMesh=M.pickedMesh;var g=M.pickedMesh._getActionManagerForTrigger();if(g){if(g.hasPickTriggers)switch(g.processTrigger(5,W.CreateNew(M.pickedMesh,j)),j.button){case 0:g.processTrigger(2,W.CreateNew(M.pickedMesh,j));break;case 1:g.processTrigger(4,W.CreateNew(M.pickedMesh,j));break;case 2:g.processTrigger(3,W.CreateNew(M.pickedMesh,j))}g.hasSpecificTrigger(8)&&window.setTimeout((function(){var M=b.pick(K._unTranslatedPointerX,K._unTranslatedPointerY,(function(Z){return Z.isPickable&&Z.isVisible&&Z.isReady()&&Z.actionManager&&Z.actionManager.hasSpecificTrigger(8)&&Z===K._pickedDownMesh}),!1,b.cameraToUseForPointers);M&&M.hit&&M.pickedMesh&&g&&0!==K._totalPointersPressed&&Date.now()-K._startingPointerTime>Z.LongPressDelay&&!K._isPointerSwiping()&&(K._startingPointerTime=0,g.processTrigger(8,W.CreateNew(M.pickedMesh,j)))}),Z.LongPressDelay)}}else for(var O=0,Q=b._pointerDownStage;O<Q.length;O++){M=Q[O].action(this._unTranslatedPointerX,this._unTranslatedPointerY,M,j)}if(M){var Y=n.d.POINTERDOWN;if(b.onPointerDown&&b.onPointerDown(j,M,Y),b.onPointerObservable.hasObservers()){var I=new n.j(Y,j,M);this._setRayOnPointerInfo(I),b.onPointerObservable.notifyObservers(I,Y)}}},Z.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>Z.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>Z.DragMovementThreshold},Z.prototype.simulatePointerUp=function(Z,M,j){var K=new PointerEvent("pointerup",M);K.inputIndex=b.Move;var g=new w;j?g.doubleClick=!0:g.singleClick=!0,this._checkPrePointerObservable(Z,K,n.d.POINTERUP)||this._processPointerUp(Z,K,g)},Z.prototype._processPointerUp=function(Z,M,j){var K=this._scene;if(Z&&Z.hit&&Z.pickedMesh){if(this._pickedUpMesh=Z.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(K.onPointerPick&&K.onPointerPick(M,Z),j.singleClick&&!j.ignore&&K.onPointerObservable.hasObservers())){var b=n.d.POINTERPICK,g=new n.j(b,M,Z);this._setRayOnPointerInfo(g),K.onPointerObservable.notifyObservers(g,b)}var O=Z.pickedMesh._getActionManagerForTrigger();if(O&&!j.ignore){O.processTrigger(7,W.CreateNew(Z.pickedMesh,M,Z)),!j.hasSwiped&&j.singleClick&&O.processTrigger(1,W.CreateNew(Z.pickedMesh,M,Z));var Q=Z.pickedMesh._getActionManagerForTrigger(6);j.doubleClick&&Q&&Q.processTrigger(6,W.CreateNew(Z.pickedMesh,M,Z))}}else if(!j.ignore)for(var Y=0,I=K._pointerUpStage;Y<I.length;Y++){Z=I[Y].action(this._unTranslatedPointerX,this._unTranslatedPointerY,Z,M)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var E=this._pickedDownMesh._getActionManagerForTrigger(16);E&&E.processTrigger(16,W.CreateNew(this._pickedDownMesh,M))}var s=0;if(K.onPointerObservable.hasObservers()){if(!j.ignore&&!j.hasSwiped&&(j.singleClick&&K.onPointerObservable.hasSpecificMask(n.d.POINTERTAP)?s=n.d.POINTERTAP:j.doubleClick&&K.onPointerObservable.hasSpecificMask(n.d.POINTERDOUBLETAP)&&(s=n.d.POINTERDOUBLETAP),s)){g=new n.j(s,M,Z);this._setRayOnPointerInfo(g),K.onPointerObservable.notifyObservers(g,s)}if(!j.ignore){s=n.d.POINTERUP;g=new n.j(s,M,Z);this._setRayOnPointerInfo(g),K.onPointerObservable.notifyObservers(g,s)}}K.onPointerUp&&!j.ignore&&K.onPointerUp(M,Z,s)},Z.prototype.isPointerCaptured=function(Z){return void 0===Z&&(Z=0),this._pointerCaptures[Z]},Z.prototype.attachControl=function(M,j,g,O){var Q=this;void 0===M&&(M=!0),void 0===j&&(j=!0),void 0===g&&(g=!0),void 0===O&&(O=null);var Y=this._scene,I=Y.getEngine();O||(O=I.getInputElement()),this._alreadyAttached&&this.detachControl(),O&&(this._alreadyAttachedTo=O),this._deviceSourceManager=new h(I),this._initActionManager=function(Z){if(!Q._meshPickProceed){var M=Y.skipPointerUpPicking?null:Y.pick(Q._unTranslatedPointerX,Q._unTranslatedPointerY,Y.pointerUpPredicate,!1,Y.cameraToUseForPointers);Q._currentPickResult=M,M&&(Z=M.hit&&M.pickedMesh?M.pickedMesh._getActionManagerForTrigger():null),Q._meshPickProceed=!0}return Z},this._delayedSimpleClick=function(M,j,K){(Date.now()-Q._previousStartingPointerTime>Z.DoubleClickDelay&&!Q._doubleClickOccured||M!==Q._previousButtonPressed)&&(Q._doubleClickOccured=!1,j.singleClick=!0,j.ignore=!1,K(j,Q._currentPickResult))},this._initClickEvent=function(M,j,K,b){var g=new w;Q._currentPickResult=null;var O=null,Y=M.hasSpecificMask(n.d.POINTERPICK)||j.hasSpecificMask(n.d.POINTERPICK)||M.hasSpecificMask(n.d.POINTERTAP)||j.hasSpecificMask(n.d.POINTERTAP)||M.hasSpecificMask(n.d.POINTERDOUBLETAP)||j.hasSpecificMask(n.d.POINTERDOUBLETAP);!Y&&k&&(O=Q._initActionManager(O,g))&&(Y=O.hasPickTriggers);var I=!1;if(Y){var E=K.button;if(g.hasSwiped=Q._isPointerSwiping(),!g.hasSwiped){var s=!Z.ExclusiveDoubleClickMode;s||(s=!M.hasSpecificMask(n.d.POINTERDOUBLETAP)&&!j.hasSpecificMask(n.d.POINTERDOUBLETAP))&&!k.HasSpecificTrigger(6)&&(O=Q._initActionManager(O,g))&&(s=!O.hasSpecificTrigger(6)),s?(Date.now()-Q._previousStartingPointerTime>Z.DoubleClickDelay||E!==Q._previousButtonPressed)&&(g.singleClick=!0,b(g,Q._currentPickResult),I=!0):(Q._previousDelayedSimpleClickTimeout=Q._delayedSimpleClickTimeout,Q._delayedSimpleClickTimeout=window.setTimeout(Q._delayedSimpleClick.bind(Q,E,g,b),Z.DoubleClickDelay));var i=M.hasSpecificMask(n.d.POINTERDOUBLETAP)||j.hasSpecificMask(n.d.POINTERDOUBLETAP);!i&&k.HasSpecificTrigger(6)&&(O=Q._initActionManager(O,g))&&(i=O.hasSpecificTrigger(6)),i&&(E===Q._previousButtonPressed&&Date.now()-Q._previousStartingPointerTime<Z.DoubleClickDelay&&!Q._doubleClickOccured?(g.hasSwiped||Q._isPointerSwiping()?(Q._doubleClickOccured=!1,Q._previousStartingPointerTime=Q._startingPointerTime,Q._previousStartingPointerPosition.x=Q._startingPointerPosition.x,Q._previousStartingPointerPosition.y=Q._startingPointerPosition.y,Q._previousButtonPressed=E,Z.ExclusiveDoubleClickMode?(Q._previousDelayedSimpleClickTimeout&&clearTimeout(Q._previousDelayedSimpleClickTimeout),Q._previousDelayedSimpleClickTimeout=Q._delayedSimpleClickTimeout,b(g,Q._previousPickResult)):b(g,Q._currentPickResult)):(Q._previousStartingPointerTime=0,Q._doubleClickOccured=!0,g.doubleClick=!0,g.ignore=!1,Z.ExclusiveDoubleClickMode&&Q._previousDelayedSimpleClickTimeout&&clearTimeout(Q._previousDelayedSimpleClickTimeout),Q._previousDelayedSimpleClickTimeout=Q._delayedSimpleClickTimeout,b(g,Q._currentPickResult)),I=!0):(Q._doubleClickOccured=!1,Q._previousStartingPointerTime=Q._startingPointerTime,Q._previousStartingPointerPosition.x=Q._startingPointerPosition.x,Q._previousStartingPointerPosition.y=Q._startingPointerPosition.y,Q._previousButtonPressed=E))}}I||b(g,Q._currentPickResult)},this._onPointerMove=function(Z){if(void 0===Z.pointerId&&(Z.pointerId=0),Q._updatePointerPosition(Z),!Q._checkPrePointerObservable(null,Z,"wheel"===Z.type||"mousewheel"===Z.type||"DOMMouseScroll"===Z.type?n.d.POINTERWHEEL:n.d.POINTERMOVE)&&(Y.cameraToUseForPointers||Y.activeCamera))if(Y.skipPointerMovePicking)Q._processPointerMove(new d.b,Z);else{Y.pointerMovePredicate||(Y.pointerMovePredicate=function(Z){return Z.isPickable&&Z.isVisible&&Z.isReady()&&Z.isEnabled()&&(Z.enablePointerMoveEvents||Y.constantlyUpdateMeshUnderPointer||null!==Z._getActionManagerForTrigger())&&(!Y.cameraToUseForPointers||0!==(Y.cameraToUseForPointers.layerMask&Z.layerMask))});var M=Y.pick(Q._unTranslatedPointerX,Q._unTranslatedPointerY,Y.pointerMovePredicate,!1,Y.cameraToUseForPointers,Y.pointerMoveTrianglePredicate);Q._processPointerMove(M,Z)}},this._onPointerDown=function(Z){var M;(Q._totalPointersPressed++,Q._pickedDownMesh=null,Q._meshPickProceed=!1,void 0===Z.pointerId&&(Z.pointerId=0),Q._updatePointerPosition(Z),Y.preventDefaultOnPointerDown&&O&&(Z.preventDefault(),O.focus()),Q._startingPointerPosition.x=Q._pointerX,Q._startingPointerPosition.y=Q._pointerY,Q._startingPointerTime=Date.now(),Q._checkPrePointerObservable(null,Z,n.d.POINTERDOWN))||(Y.cameraToUseForPointers||Y.activeCamera)&&(Q._pointerCaptures[Z.pointerId]=!0,Y.pointerDownPredicate||(Y.pointerDownPredicate=function(Z){return Z.isPickable&&Z.isVisible&&Z.isReady()&&Z.isEnabled()&&(!Y.cameraToUseForPointers||0!==(Y.cameraToUseForPointers.layerMask&Z.layerMask))}),Q._pickedDownMesh=null,M=Y.skipPointerDownPicking?new d.b:Y.pick(Q._unTranslatedPointerX,Q._unTranslatedPointerY,Y.pointerDownPredicate,!1,Y.cameraToUseForPointers),Q._processPointerDown(M,Z))},this._onPointerUp=function(Z){0!==Q._totalPointersPressed&&(Q._totalPointersPressed--,Q._pickedUpMesh=null,Q._meshPickProceed=!1,void 0===Z.pointerId&&(Z.pointerId=0),Q._updatePointerPosition(Z),Y.preventDefaultOnPointerUp&&O&&(Z.preventDefault(),O.focus()),Q._initClickEvent(Y.onPrePointerObservable,Y.onPointerObservable,Z,(function(M,j){if(Y.onPrePointerObservable.hasObservers()&&!M.ignore){if(!M.hasSwiped){if(M.singleClick&&Y.onPrePointerObservable.hasSpecificMask(n.d.POINTERTAP)&&Q._checkPrePointerObservable(null,Z,n.d.POINTERTAP))return;if(M.doubleClick&&Y.onPrePointerObservable.hasSpecificMask(n.d.POINTERDOUBLETAP)&&Q._checkPrePointerObservable(null,Z,n.d.POINTERDOUBLETAP))return}if(Q._checkPrePointerObservable(null,Z,n.d.POINTERUP))return}!Q._pointerCaptures[Z.pointerId]&&Z.buttons>0||(Q._pointerCaptures[Z.pointerId]=!1,(Y.cameraToUseForPointers||Y.activeCamera)&&(Y.pointerUpPredicate||(Y.pointerUpPredicate=function(Z){return Z.isPickable&&Z.isVisible&&Z.isReady()&&Z.isEnabled()&&(!Y.cameraToUseForPointers||0!==(Y.cameraToUseForPointers.layerMask&Z.layerMask))}),!Q._meshPickProceed&&(k&&k.HasTriggers||Y.onPointerObservable.hasObservers())&&Q._initActionManager(null,M),j||(j=Q._currentPickResult),Q._processPointerUp(j,Z,M),Q._previousPickResult=Q._currentPickResult))})))},this._onKeyDown=function(Z){var M=x.e.KEYDOWN;if(Y.onPreKeyboardObservable.hasObservers()){var j=new x.h(M,Z);if(Y.onPreKeyboardObservable.notifyObservers(j,M),j.skipOnKeyboardObservable)return}if(Y.onKeyboardObservable.hasObservers()){j=new x.j(M,Z);Y.onKeyboardObservable.notifyObservers(j,M)}Y.actionManager&&Y.actionManager.processTrigger(14,W.CreateNewFromScene(Y,Z))},this._onKeyUp=function(Z){var M=x.e.KEYUP;if(Y.onPreKeyboardObservable.hasObservers()){var j=new x.h(M,Z);if(Y.onPreKeyboardObservable.notifyObservers(j,M),j.skipOnKeyboardObservable)return}if(Y.onKeyboardObservable.hasObservers()){j=new x.j(M,Z);Y.onKeyboardObservable.notifyObservers(j,M)}Y.actionManager&&Y.actionManager.processTrigger(15,W.CreateNewFromScene(Y,Z))},this._deviceSourceManager.onDeviceConnectedObservable.add((function(Z){Z.deviceType===K.Mouse?Z.onInputChangedObservable.add((function(K){K.inputIndex===b.LeftClick||K.inputIndex===b.MiddleClick||K.inputIndex===b.RightClick?j&&1===Z.getInput(K.inputIndex)?Q._onPointerDown(K):M&&0===Z.getInput(K.inputIndex)&&Q._onPointerUp(K):g&&(K.inputIndex===b.Move?Q._onPointerMove(K):K.inputIndex!==b.MouseWheelX&&K.inputIndex!==b.MouseWheelY&&K.inputIndex!==b.MouseWheelZ||Q._onPointerMove(K))})):Z.deviceType===K.Touch?Z.onInputChangedObservable.add((function(K){K.inputIndex===b.LeftClick&&(j&&1===Z.getInput(K.inputIndex)?Q._onPointerDown(K):M&&0===Z.getInput(K.inputIndex)&&Q._onPointerUp(K)),g&&K.inputIndex===b.Move&&Q._onPointerMove(K)})):Z.deviceType===K.Keyboard&&Z.onInputChangedObservable.add((function(Z){"keydown"===Z.type?Q._onKeyDown(Z):"keyup"===Z.type&&Q._onKeyUp(Z)}))})),this._alreadyAttached=!0},Z.prototype.detachControl=function(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)},Z.prototype.setPointerOverMesh=function(Z,M,j){if(void 0===M&&(M=0),this._meshUnderPointerId[M]!==Z){var K,b=this._meshUnderPointerId[M];b&&(K=b._getActionManagerForTrigger(10))&&K.processTrigger(10,W.CreateNew(b,void 0,{pointerId:M})),Z?(this._meshUnderPointerId[M]=Z,this._pointerOverMesh=Z,(K=Z._getActionManagerForTrigger(9))&&K.processTrigger(9,W.CreateNew(Z,void 0,{pointerId:M,pickResult:j}))):(delete this._meshUnderPointerId[M],this._pointerOverMesh=null)}},Z.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},Z.prototype._invalidateMesh=function(Z){for(var M in this._pointerOverMesh===Z&&(this._pointerOverMesh=null),this._pickedDownMesh===Z&&(this._pickedDownMesh=null),this._pickedUpMesh===Z&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[M]===Z&&delete this._meshUnderPointerId[M]},Z.DragMovementThreshold=10,Z.LongPressDelay=500,Z.DoubleClickDelay=300,Z.ExclusiveDoubleClickMode=!1,Z}(),m=j(16945),J=j(9488),P=j(46647),H=j(45934),D=j(82790),l=j(21876),t=function(){function Z(M,j){Z.IsAvailable&&(this._observer=new window.ComputePressureObserver(M,j))}return Object.defineProperty(Z,"IsAvailable",{get:function(){return(0,B.q)()&&"ComputePressureObserver"in window},enumerable:!1,configurable:!0}),Z.prototype.observe=function(){var Z,M;(null===(Z=this._observer)||void 0===Z?void 0:Z.observe)&&(null===(M=this._observer)||void 0===M||M.observe().catch((function(){})))},Z.prototype.unobserve=function(){var Z,M;(null===(Z=this._observer)||void 0===Z?void 0:Z.unobserve)&&(null===(M=this._observer)||void 0===M||M.unobserve())},Z}(),v=function(Z){function M(j,K){var b=Z.call(this)||this;b._inputManager=new p(b),b.cameraToUseForPointers=null,b._isScene=!0,b._blockEntityCollection=!1,b.autoClear=!0,b.autoClearDepthAndStencil=!0,b.clearColor=new J.g(.2,.2,.3,1),b.ambientColor=new J.e(0,0,0),b.environmentIntensity=1,b._forceWireframe=!1,b._skipFrustumClipping=!1,b._forcePointsCloud=!1,b.animationsEnabled=!0,b._animationPropertiesOverride=null,b.useConstantAnimationDeltaTime=!1,b.constantlyUpdateMeshUnderPointer=!1,b.hoverCursor="pointer",b.defaultCursor="",b.doNotHandleCursors=!1,b.preventDefaultOnPointerDown=!0,b.preventDefaultOnPointerUp=!0,b.metadata=null,b.reservedDataStore=null,b.disableOfflineSupportExceptionRules=new Array,b.onDisposeObservable=new a.b,b._onDisposeObserver=null,b.onBeforeRenderObservable=new a.b,b._onBeforeRenderObserver=null,b.onAfterRenderObservable=new a.b,b.onAfterRenderCameraObservable=new a.b,b._onAfterRenderObserver=null,b.onBeforeAnimationsObservable=new a.b,b.onAfterAnimationsObservable=new a.b,b.onBeforeDrawPhaseObservable=new a.b,b.onAfterDrawPhaseObservable=new a.b,b.onReadyObservable=new a.b,b.onBeforeCameraRenderObservable=new a.b,b._onBeforeCameraRenderObserver=null,b.onAfterCameraRenderObservable=new a.b,b._onAfterCameraRenderObserver=null,b.onBeforeActiveMeshesEvaluationObservable=new a.b,b.onAfterActiveMeshesEvaluationObservable=new a.b,b.onBeforeParticlesRenderingObservable=new a.b,b.onAfterParticlesRenderingObservable=new a.b,b.onDataLoadedObservable=new a.b,b.onNewCameraAddedObservable=new a.b,b.onCameraRemovedObservable=new a.b,b.onNewLightAddedObservable=new a.b,b.onLightRemovedObservable=new a.b,b.onNewGeometryAddedObservable=new a.b,b.onGeometryRemovedObservable=new a.b,b.onNewTransformNodeAddedObservable=new a.b,b.onTransformNodeRemovedObservable=new a.b,b.onNewMeshAddedObservable=new a.b,b.onMeshRemovedObservable=new a.b,b.onNewSkeletonAddedObservable=new a.b,b.onSkeletonRemovedObservable=new a.b,b.onNewMaterialAddedObservable=new a.b,b.onNewMultiMaterialAddedObservable=new a.b,b.onMaterialRemovedObservable=new a.b,b.onMultiMaterialRemovedObservable=new a.b,b.onNewTextureAddedObservable=new a.b,b.onTextureRemovedObservable=new a.b,b.onBeforeRenderTargetsRenderObservable=new a.b,b.onAfterRenderTargetsRenderObservable=new a.b,b.onBeforeStepObservable=new a.b,b.onAfterStepObservable=new a.b,b.onActiveCameraChanged=new a.b,b.onBeforeRenderingGroupObservable=new a.b,b.onAfterRenderingGroupObservable=new a.b,b.onMeshImportedObservable=new a.b,b.onAnimationFileImportedObservable=new a.b,b._registeredForLateAnimationBindings=new z.c(256),b.skipPointerMovePicking=!1,b.skipPointerDownPicking=!1,b.skipPointerUpPicking=!1,b.onPrePointerObservable=new a.b,b.onPointerObservable=new a.b,b.onPreKeyboardObservable=new a.b,b.onKeyboardObservable=new a.b,b._useRightHandedSystem=!1,b._timeAccumulator=0,b._currentStepId=0,b._currentInternalStep=0,b._fogEnabled=!0,b._fogMode=M.FOGMODE_NONE,b.fogColor=new J.e(.2,.2,.3),b.fogDensity=.1,b.fogStart=0,b.fogEnd=1e3,b.needsPreviousWorldMatrices=!1,b._shadowsEnabled=!0,b._lightsEnabled=!0,b.activeCameras=new Array,b._texturesEnabled=!0,b.physicsEnabled=!0,b.particlesEnabled=!0,b.spritesEnabled=!0,b._skeletonsEnabled=!0,b.lensFlaresEnabled=!0,b.collisionsEnabled=!0,b.gravity=new c.k(0,-9.807,0),b.postProcessesEnabled=!0,b.renderTargetsEnabled=!0,b.dumpNextRenderTargets=!1,b.customRenderTargets=new Array,b.importedMeshesFiles=new Array,b.probesEnabled=!0,b._meshesForIntersections=new z.c(256),b.proceduralTexturesEnabled=!0,b._totalVertices=new m.d,b._activeIndices=new m.d,b._activeParticles=new m.d,b._activeBones=new m.d,b._animationTime=0,b.animationTimeScale=1,b._renderId=0,b._frameId=0,b._executeWhenReadyTimeoutId=null,b._intermediateRendering=!1,b._defaultFrameBufferCleared=!1,b._viewUpdateFlag=-1,b._projectionUpdateFlag=-1,b._toBeDisposed=new Array(256),b._activeRequests=new Array,b._pendingData=new Array,b._isDisposed=!1,b.dispatchAllSubMeshesOfActiveMeshes=!1,b._activeMeshes=new z.f(256),b._processedMaterials=new z.f(256),b._renderTargets=new z.c(256),b._materialsRenderTargets=new z.c(256),b._activeParticleSystems=new z.f(256),b._activeSkeletons=new z.c(32),b._softwareSkinnedMeshes=new z.c(32),b._activeAnimatables=new Array,b._transformMatrix=c.c.Zero(),b.requireLightSorting=!1,b._components=[],b._serializableComponents=[],b._transientComponents=[],b._beforeCameraUpdateStage=T.f.Create(),b._beforeClearStage=T.f.Create(),b._beforeRenderTargetClearStage=T.f.Create(),b._gatherRenderTargetsStage=T.f.Create(),b._gatherActiveCameraRenderTargetsStage=T.f.Create(),b._isReadyForMeshStage=T.f.Create(),b._beforeEvaluateActiveMeshStage=T.f.Create(),b._evaluateSubMeshStage=T.f.Create(),b._preActiveMeshStage=T.f.Create(),b._cameraDrawRenderTargetStage=T.f.Create(),b._beforeCameraDrawStage=T.f.Create(),b._beforeRenderTargetDrawStage=T.f.Create(),b._beforeRenderingGroupDrawStage=T.f.Create(),b._beforeRenderingMeshStage=T.f.Create(),b._afterRenderingMeshStage=T.f.Create(),b._afterRenderingGroupDrawStage=T.f.Create(),b._afterCameraDrawStage=T.f.Create(),b._afterRenderTargetDrawStage=T.f.Create(),b._afterRenderStage=T.f.Create(),b._pointerMoveStage=T.f.Create(),b._pointerDownStage=T.f.Create(),b._pointerUpStage=T.f.Create(),b._geometriesByUniqueId=null,b._defaultMeshCandidates={data:[],length:0},b._defaultSubMeshCandidates={data:[],length:0},b._preventFreeActiveMeshesAndRenderingGroups=!1,b._activeMeshesFrozen=!1,b._activeMeshesFrozenButKeepClipping=!1,b._skipEvaluateActiveMeshesCompletely=!1,b._allowPostProcessClearColor=!0,b.getDeterministicFrameTime=function(){return b._engine.getTimeStep()},b._blockMaterialDirtyMechanism=!1,b._perfCollector=null,b.onComputePressureChanged=new a.b;var g=(0,E.e)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},K);return b._engine=j||N.e.LastCreatedEngine,g.virtual?b._engine._virtualScenes.push(b):(N.e._LastCreatedScene=b,b._engine.scenes.push(b)),b._uid=null,b._renderingManager=new q.e(b),A.c&&(b.postProcessManager=new A.c(b)),(0,B.q)()&&b.attachControl(),b._createUbo(),f.e&&(b._imageProcessingConfiguration=new f.e),b.setDefaultCandidateProviders(),g.useGeometryUniqueIdsMap&&(b._geometriesByUniqueId={}),b.useMaterialMeshMap=g.useMaterialMeshMap,b.useClonedMeshMap=g.useClonedMeshMap,K&&K.virtual||b._engine.onNewSceneAddedObservable.notifyObservers(b),t.IsAvailable&&(b._computePressureObserver=new t((function(Z){b.onComputePressureChanged.notifyObservers(Z)}),{cpuUtilizationThresholds:[.25,.5,.75,.9],cpuSpeedThresholds:[.5]}),b._computePressureObserver.observe()),b}return(0,E.m)(M,Z),M.DefaultMaterialFactory=function(Z){throw(0,U.e)("StandardMaterial")},M.CollisionCoordinatorFactory=function(){throw(0,U.e)("DefaultCollisionCoordinator")},Object.defineProperty(M.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(Z){this._environmentTexture!==Z&&(this._environmentTexture=Z,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(Z){this._forceWireframe!==Z&&(this._forceWireframe=Z,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(Z){this._skipFrustumClipping!==Z&&(this._skipFrustumClipping=Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(Z){this._forcePointsCloud!==Z&&(this._forcePointsCloud=Z,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(Z){this._animationPropertiesOverride=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onDispose",{set:function(Z){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"beforeRender",{set:function(Z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),Z&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(Z))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"afterRender",{set:function(Z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),Z&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(Z))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"beforeCameraRender",{set:function(Z){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"afterCameraRender",{set:function(Z){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(M,"DragMovementThreshold",{get:function(){return p.DragMovementThreshold},set:function(Z){p.DragMovementThreshold=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"LongPressDelay",{get:function(){return p.LongPressDelay},set:function(Z){p.LongPressDelay=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"DoubleClickDelay",{get:function(){return p.DoubleClickDelay},set:function(Z){p.DoubleClickDelay=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M,"ExclusiveDoubleClickMode",{get:function(){return p.ExclusiveDoubleClickMode},set:function(Z){p.ExclusiveDoubleClickMode=Z},enumerable:!1,configurable:!0}),M.prototype.bindEyePosition=function(Z,M,j){var K;void 0===M&&(M="vEyePosition"),void 0===j&&(j=!1);var b=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:null!==(K=this.activeCamera.globalPosition)&&void 0!==K?K:this.activeCamera.devicePosition,g=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return c.e.Vector4[0].set(b.x,b.y,b.z,g?-1:1),Z&&(j?Z.setFloat3(M,c.e.Vector4[0].x,c.e.Vector4[0].y,c.e.Vector4[0].z):Z.setVector4(M,c.e.Vector4[0])),c.e.Vector4[0]},M.prototype.finalizeSceneUbo=function(){var Z=this.getSceneUniformBuffer(),M=this.bindEyePosition(null);return Z.updateFloat4("vEyePosition",M.x,M.y,M.z,M.w),Z.update(),Z},Object.defineProperty(M.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(Z){this._useRightHandedSystem!==Z&&(this._useRightHandedSystem=Z,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),M.prototype.setStepId=function(Z){this._currentStepId=Z},M.prototype.getStepId=function(){return this._currentStepId},M.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(M.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(Z){this._fogEnabled!==Z&&(this._fogEnabled=Z,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"fogMode",{get:function(){return this._fogMode},set:function(Z){this._fogMode!==Z&&(this._fogMode=Z,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"prePass",{get:function(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(Z){this._shadowsEnabled!==Z&&(this._shadowsEnabled=Z,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(Z){this._lightsEnabled!==Z&&(this._lightsEnabled=Z,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(Z){Z!==this._activeCamera&&(this._activeCamera=Z,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=M.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(Z){this._defaultMaterial=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(Z){this._texturesEnabled!==Z&&(this._texturesEnabled=Z,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(Z){this._skeletonsEnabled!==Z&&(this._skeletonsEnabled=Z,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=M.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),M.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var Z=0,M=this._transientComponents;Z<M.length;Z++){M[Z].register()}this._transientComponents=[]}},M.prototype._addComponent=function(Z){this._components.push(Z),this._transientComponents.push(Z);var M=Z;M.addFromContainer&&M.serialize&&this._serializableComponents.push(M)},M.prototype._getComponent=function(Z){for(var M=0,j=this._components;M<j.length;M++){var K=j[M];if(K.name===Z)return K}return null},M.prototype.getClassName=function(){return"Scene"},M.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},M.prototype._getDefaultSubMeshCandidates=function(Z){return this._defaultSubMeshCandidates.data=Z.subMeshes,this._defaultSubMeshCandidates.length=Z.subMeshes.length,this._defaultSubMeshCandidates},M.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(M.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(Z){this._inputManager.pointerX=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(Z){this._inputManager.pointerY=Z},enumerable:!1,configurable:!0}),M.prototype.getCachedMaterial=function(){return this._cachedMaterial},M.prototype.getCachedEffect=function(){return this._cachedEffect},M.prototype.getCachedVisibility=function(){return this._cachedVisibility},M.prototype.isCachedMaterialInvalid=function(Z,M,j){return void 0===j&&(j=1),this._cachedEffect!==M||this._cachedMaterial!==Z||this._cachedVisibility!==j},M.prototype.getEngine=function(){return this._engine},M.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(M.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),M.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(M.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),M.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(M.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),M.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(M.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),M.prototype.getActiveMeshes=function(){return this._activeMeshes},M.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},M.prototype.getRenderId=function(){return this._renderId},M.prototype.getFrameId=function(){return this._frameId},M.prototype.incrementRenderId=function(){this._renderId++},M.prototype._createUbo=function(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())},M.prototype.simulatePointerMove=function(Z,M){return this._inputManager.simulatePointerMove(Z,M),this},M.prototype.simulatePointerDown=function(Z,M){return this._inputManager.simulatePointerDown(Z,M),this},M.prototype.simulatePointerUp=function(Z,M,j){return this._inputManager.simulatePointerUp(Z,M,j),this},M.prototype.isPointerCaptured=function(Z){return void 0===Z&&(Z=0),this._inputManager.isPointerCaptured(Z)},M.prototype.attachControl=function(Z,M,j){void 0===Z&&(Z=!0),void 0===M&&(M=!0),void 0===j&&(j=!0),this._inputManager.attachControl(Z,M,j)},M.prototype.detachControl=function(){this._inputManager.detachControl()},M.prototype.isReady=function(Z){if(void 0===Z&&(Z=!0),this._isDisposed)return!1;var M,j=this.getEngine(),K=!0;for(this._pendingData.length>0&&(K=!1),Z&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),M=0;M<this.meshes.length;M++){var b=this.meshes[M];if(b.subMeshes&&0!==b.subMeshes.length)if(b.isReady(!0)){for(var g=b.hasThinInstances||"InstancedMesh"===b.getClassName()||"InstancedLinesMesh"===b.getClassName()||j.getCaps().instancedArrays&&b.instances.length>0,O=0,Q=this._isReadyForMeshStage;O<Q.length;O++){Q[O].action(b,g)||(K=!1)}if(Z){var Y=b.material||this.defaultMaterial;if(Y)if(Y._storeEffectOnSubMeshes)for(var I=0,E=b.subMeshes;I<E.length;I++){var s=E[I].getMaterial();s&&s.hasRenderTargetTextures&&null!=s.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(s)&&(this._processedMaterials.push(s),this._materialsRenderTargets.concatWithNoDuplicate(s.getRenderTargetTextures()))}else Y.hasRenderTargetTextures&&null!=Y.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(Y)&&(this._processedMaterials.push(Y),this._materialsRenderTargets.concatWithNoDuplicate(Y.getRenderTargetTextures()))}}else K=!1}if(!K)return!1;if(!j.areAllEffectsReady())return!1;if(Z)for(M=0;M<this._materialsRenderTargets.length;++M){if(!this._materialsRenderTargets.data[M].isReadyForRendering())return!1}for(M=0;M<this.geometries.length;M++){if(2===this.geometries[M].delayLoadState)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var i=0,a=this.activeCameras;i<a.length;i++){if(!a[i].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var z=0,V=this.particleSystems;z<V.length;z++){if(!V[z].isReady())return!1}return!0},M.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},M.prototype.registerBeforeRender=function(Z){this.onBeforeRenderObservable.add(Z)},M.prototype.unregisterBeforeRender=function(Z){this.onBeforeRenderObservable.removeCallback(Z)},M.prototype.registerAfterRender=function(Z){this.onAfterRenderObservable.add(Z)},M.prototype.unregisterAfterRender=function(Z){this.onAfterRenderObservable.removeCallback(Z)},M.prototype._executeOnceBeforeRender=function(Z){var M=this;this.registerBeforeRender((function j(){Z(),setTimeout((function(){M.unregisterBeforeRender(j)}))}))},M.prototype.executeOnceBeforeRender=function(Z,M){var j=this;void 0!==M?setTimeout((function(){j._executeOnceBeforeRender(Z)}),M):this._executeOnceBeforeRender(Z)},M.prototype._addPendingData=function(Z){this._pendingData.push(Z)},M.prototype._removePendingData=function(Z){var M=this.isLoading,j=this._pendingData.indexOf(Z);-1!==j&&this._pendingData.splice(j,1),M&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},M.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(M.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),M.prototype.executeWhenReady=function(Z,M){void 0===M&&(M=!1),this.onReadyObservable.add(Z),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(M)},M.prototype.whenReadyAsync=function(Z){var M=this;return void 0===Z&&(Z=!1),new Promise((function(j){M.executeWhenReady((function(){j()}),Z)}))},M.prototype._checkIsReady=function(Z){var M=this;return void 0===Z&&(Z=!1),this._registerTransientComponents(),this.isReady(Z)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((function(){M._checkIsReady(Z)}),100))},Object.defineProperty(M.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),M.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=i.c.Now},M.prototype.getViewMatrix=function(){return this._viewMatrix},M.prototype.getProjectionMatrix=function(){return this._projectionMatrix},M.prototype.getTransformMatrix=function(){return this._transformMatrix},M.prototype.setTransformMatrix=function(Z,M,j,K){j||K||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===Z.updateFlag&&this._projectionUpdateFlag===M.updateFlag||(this._viewUpdateFlag=Z.updateFlag,this._projectionUpdateFlag=M.updateFlag,this._viewMatrix=Z,this._projectionMatrix=M,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?P.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=P.e.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(j,K):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))},M.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},M.prototype.createSceneUniformBuffer=function(Z){var M=new X.d(this._engine,void 0,!1,null!==Z&&void 0!==Z?Z:"scene");return M.addUniform("viewProjection",16),M.addUniform("view",16),M.addUniform("projection",16),M.addUniform("vEyePosition",4),M},M.prototype.setSceneUniformBuffer=function(Z){this._sceneUbo=Z,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1},M.prototype.getUniqueId=function(){return H.c.UniqueId},M.prototype.addMesh=function(Z,M){var j=this;void 0===M&&(M=!1),this._blockEntityCollection||(this.meshes.push(Z),Z._resyncLightSources(),Z.parent||Z._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(Z),M&&Z.getChildMeshes().forEach((function(Z){j.addMesh(Z)})))},M.prototype.removeMesh=function(Z,M){var j=this;void 0===M&&(M=!1);var K=this.meshes.indexOf(Z);return-1!==K&&(this.meshes[K]=this.meshes[this.meshes.length-1],this.meshes.pop(),Z.parent||Z._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(Z),this.onMeshRemovedObservable.notifyObservers(Z),M&&Z.getChildMeshes().forEach((function(Z){j.removeMesh(Z)})),K},M.prototype.addTransformNode=function(Z){this._blockEntityCollection||Z.getScene()===this&&-1!==Z._indexInSceneTransformNodesArray||(Z._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(Z),Z.parent||Z._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(Z))},M.prototype.removeTransformNode=function(Z){var M=Z._indexInSceneTransformNodesArray;if(-1!==M){if(M!==this.transformNodes.length-1){var j=this.transformNodes[this.transformNodes.length-1];this.transformNodes[M]=j,j._indexInSceneTransformNodesArray=M}Z._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),Z.parent||Z._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(Z),M},M.prototype.removeSkeleton=function(Z){var M=this.skeletons.indexOf(Z);return-1!==M&&(this.skeletons.splice(M,1),this.onSkeletonRemovedObservable.notifyObservers(Z),this._executeActiveContainerCleanup(this._activeSkeletons)),M},M.prototype.removeMorphTargetManager=function(Z){var M=this.morphTargetManagers.indexOf(Z);return-1!==M&&this.morphTargetManagers.splice(M,1),M},M.prototype.removeLight=function(Z){var M=this.lights.indexOf(Z);if(-1!==M){for(var j=0,K=this.meshes;j<K.length;j++){K[j]._removeLightSource(Z,!1)}this.lights.splice(M,1),this.sortLightsByPriority(),Z.parent||Z._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(Z),M},M.prototype.removeCamera=function(Z){var M=this.cameras.indexOf(Z);if(-1!==M&&(this.cameras.splice(M,1),Z.parent||Z._removeFromSceneRootNodes()),this.activeCameras){var j=this.activeCameras.indexOf(Z);-1!==j&&this.activeCameras.splice(j,1)}return this.activeCamera===Z&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(Z),M},M.prototype.removeParticleSystem=function(Z){var M=this.particleSystems.indexOf(Z);return-1!==M&&(this.particleSystems.splice(M,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),M},M.prototype.removeAnimation=function(Z){var M=this.animations.indexOf(Z);return-1!==M&&this.animations.splice(M,1),M},M.prototype.stopAnimation=function(Z,M,j){},M.prototype.removeAnimationGroup=function(Z){var M=this.animationGroups.indexOf(Z);return-1!==M&&this.animationGroups.splice(M,1),M},M.prototype.removeMultiMaterial=function(Z){var M=this.multiMaterials.indexOf(Z);return-1!==M&&this.multiMaterials.splice(M,1),this.onMultiMaterialRemovedObservable.notifyObservers(Z),M},M.prototype.removeMaterial=function(Z){var M=Z._indexInSceneMaterialArray;if(-1!==M&&M<this.materials.length){if(M!==this.materials.length-1){var j=this.materials[this.materials.length-1];this.materials[M]=j,j._indexInSceneMaterialArray=M}Z._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(Z),M},M.prototype.removeActionManager=function(Z){var M=this.actionManagers.indexOf(Z);return-1!==M&&this.actionManagers.splice(M,1),M},M.prototype.removeTexture=function(Z){var M=this.textures.indexOf(Z);return-1!==M&&this.textures.splice(M,1),this.onTextureRemovedObservable.notifyObservers(Z),M},M.prototype.addLight=function(Z){if(!this._blockEntityCollection){this.lights.push(Z),this.sortLightsByPriority(),Z.parent||Z._addToSceneRootNodes();for(var M=0,j=this.meshes;M<j.length;M++){var K=j[M];-1===K.lightSources.indexOf(Z)&&(K.lightSources.push(Z),K._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(Z)}},M.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(l.b.CompareLightsPriority)},M.prototype.addCamera=function(Z){this._blockEntityCollection||(this.cameras.push(Z),this.onNewCameraAddedObservable.notifyObservers(Z),Z.parent||Z._addToSceneRootNodes())},M.prototype.addSkeleton=function(Z){this._blockEntityCollection||(this.skeletons.push(Z),this.onNewSkeletonAddedObservable.notifyObservers(Z))},M.prototype.addParticleSystem=function(Z){this._blockEntityCollection||this.particleSystems.push(Z)},M.prototype.addAnimation=function(Z){this._blockEntityCollection||this.animations.push(Z)},M.prototype.addAnimationGroup=function(Z){this._blockEntityCollection||this.animationGroups.push(Z)},M.prototype.addMultiMaterial=function(Z){this._blockEntityCollection||(this.multiMaterials.push(Z),this.onNewMultiMaterialAddedObservable.notifyObservers(Z))},M.prototype.addMaterial=function(Z){this._blockEntityCollection||Z.getScene()===this&&-1!==Z._indexInSceneMaterialArray||(Z._indexInSceneMaterialArray=this.materials.length,this.materials.push(Z),this.onNewMaterialAddedObservable.notifyObservers(Z))},M.prototype.addMorphTargetManager=function(Z){this._blockEntityCollection||this.morphTargetManagers.push(Z)},M.prototype.addGeometry=function(Z){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[Z.uniqueId]=this.geometries.length),this.geometries.push(Z))},M.prototype.addActionManager=function(Z){this.actionManagers.push(Z)},M.prototype.addTexture=function(Z){this._blockEntityCollection||(this.textures.push(Z),this.onNewTextureAddedObservable.notifyObservers(Z))},M.prototype.switchActiveCamera=function(Z,M){void 0===M&&(M=!0),this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=Z,M&&Z.attachControl())},M.prototype.setActiveCameraById=function(Z){var M=this.getCameraById(Z);return M?(this.activeCamera=M,M):null},M.prototype.setActiveCameraByName=function(Z){var M=this.getCameraByName(Z);return M?(this.activeCamera=M,M):null},M.prototype.getAnimationGroupByName=function(Z){for(var M=0;M<this.animationGroups.length;M++)if(this.animationGroups[M].name===Z)return this.animationGroups[M];return null},M.prototype.getMaterialByUniqueID=function(Z){for(var M=0;M<this.materials.length;M++)if(this.materials[M].uniqueId===Z)return this.materials[M];return null},M.prototype.getMaterialById=function(Z){for(var M=0;M<this.materials.length;M++)if(this.materials[M].id===Z)return this.materials[M];return null},M.prototype.getLastMaterialById=function(Z,M){void 0===M&&(M=!1);for(var j=this.materials.length-1;j>=0;j--)if(this.materials[j].id===Z)return this.materials[j];if(M)for(j=this.multiMaterials.length-1;j>=0;j--)if(this.multiMaterials[j].id===Z)return this.multiMaterials[j];return null},M.prototype.getMaterialByName=function(Z){for(var M=0;M<this.materials.length;M++)if(this.materials[M].name===Z)return this.materials[M];return null},M.prototype.getTextureByUniqueId=function(Z){for(var M=0;M<this.textures.length;M++)if(this.textures[M].uniqueId===Z)return this.textures[M];return null},M.prototype.getTextureByName=function(Z){for(var M=0;M<this.textures.length;M++)if(this.textures[M].name===Z)return this.textures[M];return null},M.prototype.getCameraById=function(Z){for(var M=0;M<this.cameras.length;M++)if(this.cameras[M].id===Z)return this.cameras[M];return null},M.prototype.getCameraByUniqueId=function(Z){for(var M=0;M<this.cameras.length;M++)if(this.cameras[M].uniqueId===Z)return this.cameras[M];return null},M.prototype.getCameraByName=function(Z){for(var M=0;M<this.cameras.length;M++)if(this.cameras[M].name===Z)return this.cameras[M];return null},M.prototype.getBoneById=function(Z){for(var M=0;M<this.skeletons.length;M++)for(var j=this.skeletons[M],K=0;K<j.bones.length;K++)if(j.bones[K].id===Z)return j.bones[K];return null},M.prototype.getBoneByName=function(Z){for(var M=0;M<this.skeletons.length;M++)for(var j=this.skeletons[M],K=0;K<j.bones.length;K++)if(j.bones[K].name===Z)return j.bones[K];return null},M.prototype.getLightByName=function(Z){for(var M=0;M<this.lights.length;M++)if(this.lights[M].name===Z)return this.lights[M];return null},M.prototype.getLightById=function(Z){for(var M=0;M<this.lights.length;M++)if(this.lights[M].id===Z)return this.lights[M];return null},M.prototype.getLightByUniqueId=function(Z){for(var M=0;M<this.lights.length;M++)if(this.lights[M].uniqueId===Z)return this.lights[M];return null},M.prototype.getParticleSystemById=function(Z){for(var M=0;M<this.particleSystems.length;M++)if(this.particleSystems[M].id===Z)return this.particleSystems[M];return null},M.prototype.getGeometryById=function(Z){for(var M=0;M<this.geometries.length;M++)if(this.geometries[M].id===Z)return this.geometries[M];return null},M.prototype._getGeometryByUniqueId=function(Z){if(this._geometriesByUniqueId){if(void 0!==(M=this._geometriesByUniqueId[Z]))return this.geometries[M]}else for(var M=0;M<this.geometries.length;M++)if(this.geometries[M].uniqueId===Z)return this.geometries[M];return null},M.prototype.pushGeometry=function(Z,M){return!(!M&&this._getGeometryByUniqueId(Z.uniqueId))&&(this.addGeometry(Z),this.onNewGeometryAddedObservable.notifyObservers(Z),!0)},M.prototype.removeGeometry=function(Z){var M;if(this._geometriesByUniqueId){if(void 0===(M=this._geometriesByUniqueId[Z.uniqueId]))return!1}else if((M=this.geometries.indexOf(Z))<0)return!1;if(M!==this.geometries.length-1){var j=this.geometries[this.geometries.length-1];j&&(this.geometries[M]=j,this._geometriesByUniqueId&&(this._geometriesByUniqueId[j.uniqueId]=M,this._geometriesByUniqueId[Z.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(Z),!0},M.prototype.getGeometries=function(){return this.geometries},M.prototype.getMeshById=function(Z){for(var M=0;M<this.meshes.length;M++)if(this.meshes[M].id===Z)return this.meshes[M];return null},M.prototype.getMeshesById=function(Z){return this.meshes.filter((function(M){return M.id===Z}))},M.prototype.getTransformNodeById=function(Z){for(var M=0;M<this.transformNodes.length;M++)if(this.transformNodes[M].id===Z)return this.transformNodes[M];return null},M.prototype.getTransformNodeByUniqueId=function(Z){for(var M=0;M<this.transformNodes.length;M++)if(this.transformNodes[M].uniqueId===Z)return this.transformNodes[M];return null},M.prototype.getTransformNodesById=function(Z){return this.transformNodes.filter((function(M){return M.id===Z}))},M.prototype.getMeshByUniqueId=function(Z){for(var M=0;M<this.meshes.length;M++)if(this.meshes[M].uniqueId===Z)return this.meshes[M];return null},M.prototype.getLastMeshById=function(Z){for(var M=this.meshes.length-1;M>=0;M--)if(this.meshes[M].id===Z)return this.meshes[M];return null},M.prototype.getLastEntryById=function(Z){var M;for(M=this.meshes.length-1;M>=0;M--)if(this.meshes[M].id===Z)return this.meshes[M];for(M=this.transformNodes.length-1;M>=0;M--)if(this.transformNodes[M].id===Z)return this.transformNodes[M];for(M=this.cameras.length-1;M>=0;M--)if(this.cameras[M].id===Z)return this.cameras[M];for(M=this.lights.length-1;M>=0;M--)if(this.lights[M].id===Z)return this.lights[M];return null},M.prototype.getNodeById=function(Z){var M=this.getMeshById(Z);if(M)return M;var j=this.getTransformNodeById(Z);if(j)return j;var K=this.getLightById(Z);if(K)return K;var b=this.getCameraById(Z);if(b)return b;var g=this.getBoneById(Z);return g||null},M.prototype.getNodeByName=function(Z){var M=this.getMeshByName(Z);if(M)return M;var j=this.getTransformNodeByName(Z);if(j)return j;var K=this.getLightByName(Z);if(K)return K;var b=this.getCameraByName(Z);if(b)return b;var g=this.getBoneByName(Z);return g||null},M.prototype.getMeshByName=function(Z){for(var M=0;M<this.meshes.length;M++)if(this.meshes[M].name===Z)return this.meshes[M];return null},M.prototype.getTransformNodeByName=function(Z){for(var M=0;M<this.transformNodes.length;M++)if(this.transformNodes[M].name===Z)return this.transformNodes[M];return null},M.prototype.getLastSkeletonById=function(Z){for(var M=this.skeletons.length-1;M>=0;M--)if(this.skeletons[M].id===Z)return this.skeletons[M];return null},M.prototype.getSkeletonByUniqueId=function(Z){for(var M=0;M<this.skeletons.length;M++)if(this.skeletons[M].uniqueId===Z)return this.skeletons[M];return null},M.prototype.getSkeletonById=function(Z){for(var M=0;M<this.skeletons.length;M++)if(this.skeletons[M].id===Z)return this.skeletons[M];return null},M.prototype.getSkeletonByName=function(Z){for(var M=0;M<this.skeletons.length;M++)if(this.skeletons[M].name===Z)return this.skeletons[M];return null},M.prototype.getMorphTargetManagerById=function(Z){for(var M=0;M<this.morphTargetManagers.length;M++)if(this.morphTargetManagers[M].uniqueId===Z)return this.morphTargetManagers[M];return null},M.prototype.getMorphTargetById=function(Z){for(var M=0;M<this.morphTargetManagers.length;++M)for(var j=this.morphTargetManagers[M],K=0;K<j.numTargets;++K){var b=j.getTarget(K);if(b.id===Z)return b}return null},M.prototype.getMorphTargetByName=function(Z){for(var M=0;M<this.morphTargetManagers.length;++M)for(var j=this.morphTargetManagers[M],K=0;K<j.numTargets;++K){var b=j.getTarget(K);if(b.name===Z)return b}return null},M.prototype.getPostProcessByName=function(Z){for(var M=0;M<this.postProcesses.length;++M){var j=this.postProcesses[M];if(j.name===Z)return j}return null},M.prototype.isActiveMesh=function(Z){return-1!==this._activeMeshes.indexOf(Z)},Object.defineProperty(M.prototype,"uid",{get:function(){return this._uid||(this._uid=s.d.RandomId()),this._uid},enumerable:!1,configurable:!0}),M.prototype.addExternalData=function(Z,M){return this._externalData||(this._externalData=new V),this._externalData.add(Z,M)},M.prototype.getExternalData=function(Z){return this._externalData?this._externalData.get(Z):null},M.prototype.getOrAddExternalDataWithFactory=function(Z,M){return this._externalData||(this._externalData=new V),this._externalData.getOrAddWithFactory(Z,M)},M.prototype.removeExternalData=function(Z){return this._externalData.remove(Z)},M.prototype._evaluateSubMesh=function(Z,M,j){if(j.hasInstances||j.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||M.alwaysSelectAsActiveMesh||1===M.subMeshes.length||Z.isInFrustum(this._frustumPlanes)){for(var K=0,b=this._evaluateSubMeshStage;K<b.length;K++){b[K].action(M,Z)}var g=Z.getMaterial();null!==g&&void 0!==g&&(g.hasRenderTargetTextures&&null!=g.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(g)&&(this._processedMaterials.push(g),this._materialsRenderTargets.concatWithNoDuplicate(g.getRenderTargetTextures())),this._renderingManager.dispatch(Z,M,g))}},M.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(M.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(Z){this._preventFreeActiveMeshesAndRenderingGroups!==Z&&(Z&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=Z)},enumerable:!1,configurable:!0}),M.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var Z=0;Z<this.activeCameras.length;Z++){var M=this.activeCameras[Z];M&&M._activeMeshes&&M._activeMeshes.dispose()}},M.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var Z=0;Z<this.textures.length;Z++){var M=this.textures[Z];M&&M.renderList&&M.freeRenderingGroups()}},M.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},M.prototype.freezeActiveMeshes=function(Z,M,j,K,b){var g=this;return void 0===Z&&(Z=!1),void 0===K&&(K=!0),void 0===b&&(b=!1),this.executeWhenReady((function(){if(g.activeCamera){if(g._frustumPlanes||g.updateTransformMatrix(),g._evaluateActiveMeshes(),g._activeMeshesFrozen=!0,g._activeMeshesFrozenButKeepClipping=b,g._skipEvaluateActiveMeshesCompletely=Z,K)for(var O=0;O<g._activeMeshes.length;O++)g._activeMeshes.data[O]._freeze();M&&M()}else j&&j("No active camera found")})),this},M.prototype.unfreezeActiveMeshes=function(){for(var Z=0;Z<this.meshes.length;Z++){var M=this.meshes[Z];M._internalAbstractMeshDataInfo&&(M._internalAbstractMeshDataInfo._isActive=!1)}for(Z=0;Z<this._activeMeshes.length;Z++)this._activeMeshes.data[Z]._unFreeze();return this._activeMeshesFrozen=!1,this},M.prototype._executeActiveContainerCleanup=function(Z){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((function(){return Z.dispose()}))},M.prototype._evaluateActiveMeshes=function(){var Z;if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)this._activeMeshes.length>0&&(null===(Z=this.activeCamera)||void 0===Z||Z._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset());else if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var M=this._activeMeshes.length,j=0;j<M;j++){(Y=this._activeMeshes.data[j]).computeWorldMatrix()}if(this._activeParticleSystems){var K=this._activeParticleSystems.length;for(j=0;j<K;j++)this._activeParticleSystems.data[j].animate()}}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(var b=0,g=this._beforeEvaluateActiveMeshStage;b<g.length;b++){g[b].action()}var O=this.getActiveMeshCandidates(),Q=O.length;for(j=0;j<Q;j++){var Y;if((Y=O.data[j])._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!Y.isBlocked&&(this._totalVertices.addCount(Y.getTotalVertices(),!1),Y.isReady()&&Y.isEnabled()&&!Y.scaling.hasAZeroComponent)){Y.computeWorldMatrix(),Y.actionManager&&Y.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(Y);var I=this.customLODSelector?this.customLODSelector(Y,this.activeCamera):Y.getLOD(this.activeCamera);if(Y._internalAbstractMeshDataInfo._currentLOD=I,Y._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==I&&null!==I&&(I!==Y&&0!==I.billboardMode&&I.computeWorldMatrix(),Y._preActivate(),Y.isVisible&&Y.visibility>0&&0!==(Y.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||Y.alwaysSelectAsActiveMesh||Y.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(Y),this.activeCamera._activeMeshes.push(Y),I!==Y&&I._activate(this._renderId,!1);for(var E=0,s=this._preActiveMeshStage;E<s.length;E++){s[E].action(Y)}Y._activate(this._renderId,!1)&&(Y.isAnInstance?Y._internalAbstractMeshDataInfo._actAsRegularMesh&&(I=Y):I._internalAbstractMeshDataInfo._onlyForInstances=!1,I._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(Y,I)),Y._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var i=0;i<this.particleSystems.length;i++){var a=this.particleSystems[i];if(a.isStarted()&&a.emitter){var z=a.emitter;z.position&&!z.isEnabled()||(this._activeParticleSystems.push(a),a.animate(),this._renderingManager.dispatchParticles(a))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},M.prototype._activeMesh=function(Z,M){if(this._skeletonsEnabled&&null!==M.skeleton&&void 0!==M.skeleton&&(this._activeSkeletons.pushNoDuplicate(M.skeleton)&&(M.skeleton.prepare(),this._activeBones.addCount(M.skeleton.bones.length,!1)),M.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(M)),M&&M.subMeshes&&M.subMeshes.length>0)for(var j=this.getActiveSubMeshCandidates(M),K=j.length,b=0;b<K;b++){var g=j.data[b];this._evaluateSubMesh(g,M,Z)}},M.prototype.updateTransformMatrix=function(Z){if(this.activeCamera)if(this.activeCamera._renderingMultiview){var M=this.activeCamera._rigCameras[0],j=this.activeCamera._rigCameras[1];this.setTransformMatrix(M.getViewMatrix(),M.getProjectionMatrix(Z),j.getViewMatrix(),j.getProjectionMatrix(Z))}else this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(Z))},M.prototype._bindFrameBuffer=function(Z,M){void 0===M&&(M=!0),Z&&Z._multiviewTexture?Z._multiviewTexture._bindFrameBuffer():Z&&Z.outputRenderTarget?Z.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),M&&this._clearFrameBuffer(Z)},M.prototype._clearFrameBuffer=function(Z){if(Z&&Z._multiviewTexture);else if(Z&&Z.outputRenderTarget){var M=Z.outputRenderTarget;M.onClearObservable.hasObservers()?M.onClearObservable.notifyObservers(this._engine):M.skipInitialClear||(this._engine.clear(M.clearColor||this.clearColor,!M._cleared,!0,!0),M._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())},M.prototype._renderForCamera=function(Z,M,j){var K,b,g;if(void 0===j&&(j=!0),!Z||!Z._skipRendering){var O=this._engine;if(this._activeCamera=Z,!this.activeCamera)throw new Error("Active camera not set");if(O.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&j){var Q=!0;Z._renderingMultiview&&Z.outputRenderTarget&&(Q=Z.outputRenderTarget.skipInitialClear,this.autoClear&&(Z.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),Z._renderingMultiview&&Z.outputRenderTarget&&(Z.outputRenderTarget.skipInitialClear=Q)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var Y=0;Y<this._softwareSkinnedMeshes.length;Y++){var I=this._softwareSkinnedMeshes.data[Y];I.applySkeleton(I.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),Z.customRenderTargets&&Z.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(Z.customRenderTargets),M&&M.customRenderTargets&&M.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(M.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(var E=0,i=this._gatherActiveCameraRenderTargetsStage;E<i.length;E++){i[E].action(this._renderTargets)}var a=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){s.d.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var z=0;z<this._renderTargets.length;z++){var V=this._renderTargets.data[z];if(V._shouldRender()){this._renderId++;var o=V.activeCamera&&V.activeCamera!==this.activeCamera;V.render(o,this.dumpNextRenderTargets),a=!0}}s.d.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var c=0,G=this._cameraDrawRenderTargetStage;c<G.length;c++){a=G[c].action(this.activeCamera)||a}this._intermediateRendering=!1}this._engine.currentRenderPassId=null!==(g=null!==(b=null===(K=Z.outputRenderTarget)||void 0===K?void 0:K.renderPassId)&&void 0!==b?b:Z.renderPassId)&&void 0!==g?g:0,a&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||Z._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(var f=0,X=this._beforeCameraDrawStage;f<X.length;f++){X[f].action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),O.snapshotRendering&&1===O.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var d=0,W=this._afterCameraDrawStage;d<W.length;d++){W[d].action(this.activeCamera)}if(this.postProcessManager&&!Z._multiviewTexture){var A=Z.outputRenderTarget?Z.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(Z.isIntermediate,A)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},M.prototype._processSubCameras=function(Z,M){if(void 0===M&&(M=!0),0===Z.cameraRigMode||Z._renderingMultiview)return Z._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(Z,void 0,M),void this.onAfterRenderCameraObservable.notifyObservers(Z);if(Z._useMultiviewToSingleView)this._renderMultiviewToSingleView(Z);else{this.onBeforeCameraRenderObservable.notifyObservers(Z);for(var j=0;j<Z._rigCameras.length;j++)this._renderForCamera(Z._rigCameras[j],Z)}this._activeCamera=Z,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(Z)},M.prototype._checkIntersections=function(){for(var Z=0;Z<this._meshesForIntersections.length;Z++){var M=this._meshesForIntersections.data[Z];if(M.actionManager)for(var j=function(Z){var j=M.actionManager.actions[Z];if(12===j.trigger||13===j.trigger){var K=j.getTriggerParameter(),b=K.mesh?K.mesh:K,g=b.intersectsMesh(M,K.usePreciseIntersection),O=M._intersectionsInProgress.indexOf(b);g&&-1===O?12===j.trigger?(j._executeCurrent(W.CreateNew(M,void 0,b)),M._intersectionsInProgress.push(b)):13===j.trigger&&M._intersectionsInProgress.push(b):!g&&O>-1&&(13===j.trigger&&j._executeCurrent(W.CreateNew(M,void 0,b)),M.actionManager.hasSpecificTrigger(13,(function(Z){var M=Z.mesh?Z.mesh:Z;return b===M}))&&13!==j.trigger||M._intersectionsInProgress.splice(O,1))}},K=0;M.actionManager&&K<M.actionManager.actions.length;K++)j(K)}},M.prototype._advancePhysicsEngineStep=function(Z){},M.prototype._animate=function(){},M.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var Z=Math.max(M.MinDeltaTime,Math.min(this._engine.getDeltaTime(),M.MaxDeltaTime))+this._timeAccumulator,j=this._engine.getTimeStep(),K=1e3/j/1e3,b=0,g=this._engine.getLockstepMaxSteps(),O=Math.floor(Z/j);for(O=Math.min(O,g);Z>0&&b<O;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=j*K,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(j),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,b++,Z-=j;this._timeAccumulator=Z<0?0:Z}else{Z=this.useConstantAnimationDeltaTime?16:Math.max(M.MinDeltaTime,Math.min(this._engine.getDeltaTime(),M.MaxDeltaTime));this._animationRatio=.06*Z,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(Z)}},M.prototype._clear=function(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)},M.prototype._checkCameraRenderTarget=function(Z){var M;if((null===Z||void 0===Z?void 0:Z.outputRenderTarget)&&!(null===Z||void 0===Z?void 0:Z.isRigCamera)&&(Z.outputRenderTarget._cleared=!1),null===(M=null===Z||void 0===Z?void 0:Z.rigCameras)||void 0===M?void 0:M.length)for(var j=0;j<Z.rigCameras.length;++j){var K=Z.rigCameras[j].outputRenderTarget;K&&(K._cleared=!1)}},M.prototype.resetDrawCache=function(Z){if(this.meshes)for(var M=0,j=this.meshes;M<j.length;M++){j[M].resetDrawCache(Z)}},M.prototype.render=function(Z,M){var j,K,b;if(void 0===Z&&(Z=!0),void 0===M&&(M=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),(null===(j=this.activeCameras)||void 0===j?void 0:j.length)&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),M||this.animate();for(var g=0,O=this._beforeCameraUpdateStage;g<O.length;g++){O[g].action()}if(Z)if(this.activeCameras&&this.activeCameras.length>0)for(var Q=0;Q<this.activeCameras.length;Q++){var Y=this.activeCameras[Q];if(Y.update(),0!==Y.cameraRigMode)for(var I=0;I<Y._rigCameras.length;I++)Y._rigCameras[I].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(I=0;I<this.activeCamera._rigCameras.length;I++)this.activeCamera._rigCameras[I].update();this.onBeforeRenderObservable.notifyObservers(this);var E=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var i=(null===(K=this.activeCameras)||void 0===K?void 0:K.length)?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){s.d.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var a=0;a<this.customRenderTargets.length;a++){var z=this.customRenderTargets[a];if(z._shouldRender()){if(this._renderId++,this.activeCamera=z.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");E.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),z.render(i!==this.activeCamera,this.dumpNextRenderTargets)}}s.d.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=null!==(b=null===i||void 0===i?void 0:i.renderPassId)&&void 0!==b?b:0,this.activeCamera=i,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var V=0,o=this._beforeClearStage;V<o.length;V++){o[V].action()}this._clearFrameBuffer(this.activeCamera);for(var c=0,G=this._gatherRenderTargetsStage;c<G.length;c++){G[c].action(this._renderTargets)}if(this.activeCameras&&this.activeCameras.length>0)for(Q=0;Q<this.activeCameras.length;Q++)this._processSubCameras(this.activeCameras[Q],Q>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(var f=0,X=this._afterRenderStage;f<X.length;f++){X[f].action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(I=0;I<this._toBeDisposed.length;I++){var d=this._toBeDisposed[I];d&&d.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}},M.prototype.freezeMaterials=function(){for(var Z=0;Z<this.materials.length;Z++)this.materials[Z].freeze()},M.prototype.unfreezeMaterials=function(){for(var Z=0;Z<this.materials.length;Z++)this.materials[Z].unfreeze()},M.prototype.dispose=function(){var Z;if(!this.isDisposed){this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var M=0,j=this._activeRequests.slice();M<j.length;M++){j[M].abort()}if(this._activeRequests=[],this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onComputePressureChanged.clear(),null===(Z=this._computePressureObserver)||void 0===Z||Z.unobserve(),this._computePressureObserver=void 0,this.detachControl(),this._engine.getInputElement())for(var K=0;K<this.cameras.length;K++)this.cameras[K].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(function(Z){return Z.dispose(!0)})),this._disposeList(this.transformNodes,(function(Z){return Z.dispose(!0)})),this._disposeList(this.cameras),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);var b=this._engine.scenes.indexOf(this);b>-1&&this._engine.scenes.splice(b,1),N.e._LastCreatedScene===this&&(this._engine.scenes.length>0?N.e._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:N.e._LastCreatedScene=null),(b=this._engine._virtualScenes.indexOf(this))>-1&&this._engine._virtualScenes.splice(b,1),this._engine.wipeCaches(!0),this._isDisposed=!0}},M.prototype._disposeList=function(Z,M){M=null!==M&&void 0!==M?M:function(Z){return Z.dispose()};for(var j=0,K=Z.slice(0);j<K.length;j++){M(K[j])}Z.length=0},Object.defineProperty(M.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),M.prototype.clearCachedVertexData=function(){for(var Z=0;Z<this.meshes.length;Z++){var M=this.meshes[Z].geometry;M&&M.clearCachedData()}},M.prototype.cleanCachedTextureBuffer=function(){for(var Z=0,M=this.textures;Z<M.length;Z++){var j=M[Z];j._buffer&&(j._buffer=null)}},M.prototype.getWorldExtends=function(Z){var M=new c.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),j=new c.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Z=Z||function(){return!0},this.meshes.filter(Z).forEach((function(Z){if(Z.computeWorldMatrix(!0),Z.subMeshes&&0!==Z.subMeshes.length&&!Z.infiniteDistance){var K=Z.getBoundingInfo(),b=K.boundingBox.minimumWorld,g=K.boundingBox.maximumWorld;c.k.CheckExtends(b,M,j),c.k.CheckExtends(g,M,j)}})),{min:M,max:j}},M.prototype.createPickingRay=function(Z,M,j,K,b){throw void 0===b&&(b=!1),(0,U.e)("Ray")},M.prototype.createPickingRayToRef=function(Z,M,j,K,b,g,O){throw void 0===g&&(g=!1),void 0===O&&(O=!1),(0,U.e)("Ray")},M.prototype.createPickingRayInCameraSpace=function(Z,M,j){throw(0,U.e)("Ray")},M.prototype.createPickingRayInCameraSpaceToRef=function(Z,M,j,K){throw(0,U.e)("Ray")},M.prototype.pick=function(Z,M,j,K,b,g){var O=new d.b;return O._pickingUnavailable=!0,O},M.prototype.pickWithBoundingInfo=function(Z,M,j,K,b){var g=new d.b;return g._pickingUnavailable=!0,g},M.prototype.pickWithRay=function(Z,M,j,K){throw(0,U.e)("Ray")},M.prototype.multiPick=function(Z,M,j,K,b){throw(0,U.e)("Ray")},M.prototype.multiPickWithRay=function(Z,M,j){throw(0,U.e)("Ray")},M.prototype.setPointerOverMesh=function(Z,M,j){this._inputManager.setPointerOverMesh(Z,M,j)},M.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},M.prototype._rebuildGeometries=function(){for(var Z=0,M=this.geometries;Z<M.length;Z++){M[Z]._rebuild()}for(var j=0,K=this.meshes;j<K.length;j++){K[j]._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var b=0,g=this._components;b<g.length;b++){g[b].rebuild()}for(var O=0,Q=this.particleSystems;O<Q.length;O++){Q[O].rebuild()}if(this.spriteManagers)for(var Y=0,I=this.spriteManagers;Y<I.length;Y++){I[Y].rebuild()}},M.prototype._rebuildTextures=function(){for(var Z=0,M=this.textures;Z<M.length;Z++){M[Z]._rebuild()}this.markAllMaterialsAsDirty(1)},M.prototype._getByTags=function(Z,M,j){if(void 0===M)return Z;var K=[];for(var b in j=j||function(Z){},Z){var g=Z[b];o.d&&o.d.MatchesQuery(g,M)&&(K.push(g),j(g))}return K},M.prototype.getMeshesByTags=function(Z,M){return this._getByTags(this.meshes,Z,M)},M.prototype.getCamerasByTags=function(Z,M){return this._getByTags(this.cameras,Z,M)},M.prototype.getLightsByTags=function(Z,M){return this._getByTags(this.lights,Z,M)},M.prototype.getMaterialByTags=function(Z,M){return this._getByTags(this.materials,Z,M).concat(this._getByTags(this.multiMaterials,Z,M))},M.prototype.getTransformNodesByTags=function(Z,M){return this._getByTags(this.transformNodes,Z,M)},M.prototype.setRenderingOrder=function(Z,M,j,K){void 0===M&&(M=null),void 0===j&&(j=null),void 0===K&&(K=null),this._renderingManager.setRenderingOrder(Z,M,j,K)},M.prototype.setRenderingAutoClearDepthStencil=function(Z,M,j,K){void 0===j&&(j=!0),void 0===K&&(K=!0),this._renderingManager.setRenderingAutoClearDepthStencil(Z,M,j,K)},M.prototype.getAutoClearDepthStencilSetup=function(Z){return this._renderingManager.getAutoClearDepthStencilSetup(Z)},Object.defineProperty(M.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(Z){this._blockMaterialDirtyMechanism!==Z&&(this._blockMaterialDirtyMechanism=Z,Z||this.markAllMaterialsAsDirty(63))},enumerable:!1,configurable:!0}),M.prototype.markAllMaterialsAsDirty=function(Z,M){if(!this._blockMaterialDirtyMechanism)for(var j=0,K=this.materials;j<K.length;j++){var b=K[j];M&&!M(b)||b.markAsDirty(Z)}},M.prototype._loadFile=function(Z,M,j,K,b,g,O){var Q=this,Y=(0,D.h)(Z,M,j,K?this.offlineProvider:void 0,b,g,O);return this._activeRequests.push(Y),Y.onCompleteObservable.add((function(Z){Q._activeRequests.splice(Q._activeRequests.indexOf(Z),1)})),Y},M.prototype._loadFileAsync=function(Z,M,j,K,b){var g=this;return new Promise((function(O,Q){g._loadFile(Z,(function(Z){O(Z)}),M,j,K,(function(Z,M){Q(M)}),b)}))},M.prototype._requestFile=function(Z,M,j,K,b,g,O){var Q=this,Y=(0,D.o)(Z,M,j,K?this.offlineProvider:void 0,b,g,O);return this._activeRequests.push(Y),Y.onCompleteObservable.add((function(Z){Q._activeRequests.splice(Q._activeRequests.indexOf(Z),1)})),Y},M.prototype._requestFileAsync=function(Z,M,j,K,b){var g=this;return new Promise((function(O,Q){g._requestFile(Z,(function(Z){O(Z)}),M,j,K,(function(Z){Q(Z)}),b)}))},M.prototype._readFile=function(Z,M,j,K,b){var g=this,O=(0,D.m)(Z,M,j,K,b);return this._activeRequests.push(O),O.onCompleteObservable.add((function(Z){g._activeRequests.splice(g._activeRequests.indexOf(Z),1)})),O},M.prototype._readFileAsync=function(Z,M,j){var K=this;return new Promise((function(b,g){K._readFile(Z,(function(Z){b(Z)}),M,j,(function(Z){g(Z)}))}))},M.prototype.getPerfCollector=function(){throw(0,U.e)("performanceViewerSceneExtension")},M.FOGMODE_NONE=0,M.FOGMODE_EXP=1,M.FOGMODE_EXP2=2,M.FOGMODE_LINEAR=3,M.MinDeltaTime=1,M.MaxDeltaTime=1e3,M}(G.d);v.prototype.setActiveCameraByID=function(Z){return this.setActiveCameraById(Z)},v.prototype.getLastMaterialByID=function(Z){return this.getLastMaterialById(Z)},v.prototype.getMaterialByID=function(Z){return this.getMaterialById(Z)},v.prototype.getTextureByUniqueID=function(Z){return this.getTextureByUniqueId(Z)},v.prototype.getCameraByID=function(Z){return this.getCameraById(Z)},v.prototype.getCameraByUniqueID=function(Z){return this.getCameraByUniqueId(Z)},v.prototype.getBoneByID=function(Z){return this.getBoneById(Z)},v.prototype.getLightByID=function(Z){return this.getLightById(Z)},v.prototype.getLightByUniqueID=function(Z){return this.getLightByUniqueId(Z)},v.prototype.getParticleSystemByID=function(Z){return this.getParticleSystemById(Z)},v.prototype.getGeometryByID=function(Z){return this.getGeometryById(Z)},v.prototype.getMeshByID=function(Z){return this.getMeshById(Z)},v.prototype.getMeshesByID=function(Z){return this.getMeshesById(Z)},v.prototype.getTransformNodeByID=function(Z){return this.getTransformNodeById(Z)},v.prototype.getTransformNodeByUniqueID=function(Z){return this.getTransformNodeByUniqueId(Z)},v.prototype.getTransformNodesByID=function(Z){return this.getTransformNodesById(Z)},v.prototype.getMeshByUniqueID=function(Z){return this.getMeshByUniqueId(Z)},v.prototype.getLastMeshByID=function(Z){return this.getLastMeshById(Z)},v.prototype.getLastEntryByID=function(Z){return this.getLastEntryById(Z)},v.prototype.getNodeByID=function(Z){return this.getNodeById(Z)},v.prototype.getLastSkeletonByID=function(Z){return this.getLastSkeletonById(Z)}},21693:function(Z,M,j){"use strict";j.d(M,{d:function(){return b},f:function(){return g}});var K=j(40061),b=function(){function Z(){}return Z.NAME_EFFECTLAYER="EffectLayer",Z.NAME_LAYER="Layer",Z.NAME_LENSFLARESYSTEM="LensFlareSystem",Z.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",Z.NAME_PARTICLESYSTEM="ParticleSystem",Z.NAME_GAMEPAD="Gamepad",Z.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",Z.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",Z.NAME_PREPASSRENDERER="PrePassRenderer",Z.NAME_DEPTHRENDERER="DepthRenderer",Z.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",Z.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",Z.NAME_SPRITE="Sprite",Z.NAME_SUBSURFACE="SubSurface",Z.NAME_OUTLINERENDERER="Outline",Z.NAME_PROCEDURALTEXTURE="ProceduralTexture",Z.NAME_SHADOWGENERATOR="ShadowGenerator",Z.NAME_OCTREE="Octree",Z.NAME_PHYSICSENGINE="PhysicsEngine",Z.NAME_AUDIO="Audio",Z.STEP_ISREADYFORMESH_EFFECTLAYER=0,Z.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,Z.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,Z.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,Z.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,Z.STEP_BEFORECAMERADRAW_PREPASS=0,Z.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,Z.STEP_BEFORECAMERADRAW_LAYER=2,Z.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,Z.STEP_BEFORERENDERTARGETDRAW_LAYER=1,Z.STEP_BEFORERENDERINGMESH_PREPASS=0,Z.STEP_BEFORERENDERINGMESH_OUTLINE=1,Z.STEP_AFTERRENDERINGMESH_PREPASS=0,Z.STEP_AFTERRENDERINGMESH_OUTLINE=1,Z.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,Z.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,Z.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,Z.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,Z.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,Z.STEP_BEFORECLEAR_PREPASS=1,Z.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,Z.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,Z.STEP_AFTERRENDERTARGETDRAW_LAYER=1,Z.STEP_AFTERCAMERADRAW_PREPASS=0,Z.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,Z.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,Z.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,Z.STEP_AFTERCAMERADRAW_LAYER=4,Z.STEP_AFTERRENDER_AUDIO=0,Z.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,Z.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,Z.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,Z.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,Z.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,Z.STEP_POINTERMOVE_SPRITE=0,Z.STEP_POINTERDOWN_SPRITE=0,Z.STEP_POINTERUP_SPRITE=0,Z}(),g=function(Z){function M(M){return Z.apply(this,M)||this}return(0,K.m)(M,Z),M.Create=function(){return Object.create(M.prototype)},M.prototype.registerStep=function(Z,M,j){var K=0;for(Number.MAX_VALUE;K<this.length;K++){if(Z<this[K].index)break}this.splice(K,0,{index:Z,component:M,action:j.bind(M)})},M.prototype.clear=function(){this.length=0},M}(Array)},63251:function(Z,M,j){"use strict";var K=function(){function Z(){var Z=this;this.promise=new Promise((function(M,j){Z._resolve=M,Z._reject=j}))}return Object.defineProperty(Z.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),Z}(),b=j(80105),g=j(9488),O=j(9217),Q=j(37643),Y=j(35958),I=j(21664),E=j(9271),s=j(78588),i=j(45883),a=function(){function Z(){}return Z.prototype.getClassName=function(){return"TargetedAnimation"},Z.prototype.serialize=function(){var Z={};return Z.animation=this.animation.serialize(),Z.targetId=this.target.id,Z},Z}(),z=function(){function Z(Z,M){void 0===M&&(M=null),this.name=Z,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._parentContainer=null,this.onAnimationEndObservable=new E.b,this.onAnimationLoopObservable=new E.b,this.onAnimationGroupLoopObservable=new E.b,this.onAnimationGroupEndObservable=new E.b,this.onAnimationGroupPauseObservable=new E.b,this.onAnimationGroupPlayObservable=new E.b,this.metadata=null,this._scene=M||s.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}return Object.defineProperty(Z.prototype,"from",{get:function(){return this._from},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"to",{get:function(){return this._to},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(Z){if(this._speedRatio!==Z){this._speedRatio=Z;for(var M=0;M<this._animatables.length;M++){this._animatables[M].speedRatio=this._speedRatio}}},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(Z){if(this._loopAnimation!==Z){this._loopAnimation=Z;for(var M=0;M<this._animatables.length;M++){this._animatables[M].loopAnimation=this._loopAnimation}}},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isAdditive",{get:function(){return this._isAdditive},set:function(Z){if(this._isAdditive!==Z){this._isAdditive=Z;for(var M=0;M<this._animatables.length;M++){this._animatables[M].isAdditive=this._isAdditive}}},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"animatables",{get:function(){return this._animatables},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"children",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),Z.prototype.addTargetedAnimation=function(Z,M){var j=new a;j.animation=Z,j.target=M;var K=Z.getKeys();return this._from>K[0].frame&&(this._from=K[0].frame),this._to<K[K.length-1].frame&&(this._to=K[K.length-1].frame),this._targetedAnimations.push(j),j},Z.prototype.normalize=function(Z,M){void 0===Z&&(Z=null),void 0===M&&(M=null),null==Z&&(Z=this._from),null==M&&(M=this._to);for(var j=0;j<this._targetedAnimations.length;j++){var K=this._targetedAnimations[j].animation.getKeys(),b=K[0],g=K[K.length-1];if(b.frame>Z){var O={frame:Z,value:b.value,inTangent:b.inTangent,outTangent:b.outTangent,interpolation:b.interpolation};K.splice(0,0,O)}if(g.frame<M){O={frame:M,value:g.value,inTangent:g.inTangent,outTangent:g.outTangent,interpolation:g.interpolation};K.push(O)}}return this._from=Z,this._to=M,this},Z.prototype._processLoop=function(Z,M,j){var K=this;Z.onAnimationLoop=function(){K.onAnimationLoopObservable.notifyObservers(M),K._animationLoopFlags[j]||(K._animationLoopFlags[j]=!0,K._animationLoopCount++,K._animationLoopCount===K._targetedAnimations.length&&(K.onAnimationGroupLoopObservable.notifyObservers(K),K._animationLoopCount=0,K._animationLoopFlags=[]))}},Z.prototype.start=function(Z,M,j,K,b){var g=this;if(void 0===Z&&(Z=!1),void 0===M&&(M=1),this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=Z,this._animationLoopCount=0,this._animationLoopFlags=[];for(var O=function(O){var Y=Q._targetedAnimations[O],I=Q._scene.beginDirectAnimation(Y.target,[Y.animation],void 0!==j?j:Q._from,void 0!==K?K:Q._to,Z,M,void 0,void 0,void 0!==b?b:Q._isAdditive);I.onAnimationEnd=function(){g.onAnimationEndObservable.notifyObservers(Y),g._checkAnimationGroupEnded(I)},Q._processLoop(I,Y,O),Q._animatables.push(I)},Q=this,Y=0;Y<this._targetedAnimations.length;Y++)O(Y);return this._speedRatio=M,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},Z.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var Z=0;Z<this._animatables.length;Z++){this._animatables[Z].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this},Z.prototype.play=function(Z){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(void 0!==Z&&(this.loopAnimation=Z),this.restart()):(this.stop(),this.start(Z,this._speedRatio)),this._isPaused=!1,this},Z.prototype.reset=function(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(),this;for(var Z=0;Z<this._animatables.length;Z++){this._animatables[Z].reset()}return this},Z.prototype.restart=function(){if(!this._isStarted)return this;for(var Z=0;Z<this._animatables.length;Z++){this._animatables[Z].restart()}return this.onAnimationGroupPlayObservable.notifyObservers(this),this},Z.prototype.stop=function(){if(!this._isStarted)return this;for(var Z=this._animatables.slice(),M=0;M<Z.length;M++)Z[M].stop();return this._isStarted=!1,this},Z.prototype.setWeightForAllAnimatables=function(Z){for(var M=0;M<this._animatables.length;M++){this._animatables[M].weight=Z}return this},Z.prototype.syncAllAnimationsWith=function(Z){for(var M=0;M<this._animatables.length;M++){this._animatables[M].syncWith(Z)}return this},Z.prototype.goToFrame=function(Z){if(!this._isStarted)return this;for(var M=0;M<this._animatables.length;M++){this._animatables[M].goToFrame(Z)}return this},Z.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var Z=this._scene.animationGroups.indexOf(this);if(Z>-1&&this._scene.animationGroups.splice(Z,1),this._parentContainer){var M=this._parentContainer.animationGroups.indexOf(this);M>-1&&this._parentContainer.animationGroups.splice(M,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},Z.prototype._checkAnimationGroupEnded=function(Z){var M=this._animatables.indexOf(Z);M>-1&&this._animatables.splice(M,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},Z.prototype.clone=function(M,j,K){void 0===K&&(K=!1);for(var b=new Z(M||this.name,this._scene),g=0,O=this._targetedAnimations;g<O.length;g++){var Q=O[g];b.addTargetedAnimation(K?Q.animation.clone():Q.animation,j?j(Q.target):Q.target)}return b},Z.prototype.serialize=function(){var Z={};Z.name=this.name,Z.from=this.from,Z.to=this.to,Z.targetedAnimations=[];for(var M=0;M<this.targetedAnimations.length;M++){var j=this.targetedAnimations[M];Z.targetedAnimations[M]=j.serialize()}return i.d&&i.d.HasTags(this)&&(Z.tags=i.d.GetTags(this)),this.metadata&&(Z.metadata=this.metadata),Z},Z.Parse=function(M,j){for(var K=new Z(M.name,j),b=0;b<M.targetedAnimations.length;b++){var g=M.targetedAnimations[b],O=I.c.Parse(g.animation),Q=g.targetId;if("influence"===g.animation.property){var Y=j.getMorphTargetById(Q);Y&&K.addTargetedAnimation(O,Y)}else{var E=j.getNodeById(Q);null!=E&&K.addTargetedAnimation(O,E)}}return null!==M.from&&null!==M.to&&K.normalize(M.from,M.to),i.d&&i.d.AddTagsTo(K,M.tags),void 0!==M.metadata&&(K.metadata=M.metadata),K},Z.MakeAnimationAdditive=function(Z,M,j,K,b){void 0===M&&(M=0),void 0===K&&(K=!1);var g=Z;K&&(g=Z.clone(b||g.name));for(var O=g.targetedAnimations,Q=0;Q<O.length;Q++){var Y=O[Q];I.c.MakeAnimationAdditive(Y.animation,M,j)}return g.isAdditive=!0,g},Z.prototype.getClassName=function(){return"AnimationGroup"},Z.prototype.toString=function(Z){var M="Name: "+this.name;return M+=", type: "+this.getClassName(),Z&&(M+=", from: "+this._from,M+=", to: "+this._to,M+=", isStarted: "+this._isStarted,M+=", speedRatio: "+this._speedRatio,M+=", targetedAnimations length: "+this._targetedAnimations.length,M+=", animatables length: "+this._animatables),M},Z}(),V=j(40061),o=j(89214),c=j(74134),G=j(54044),f=function(Z){function M(M,j,K,g,O,Q,Y){void 0===K&&(K=null),void 0===g&&(g=null),void 0===O&&(O=null),void 0===Q&&(Q=null),void 0===Y&&(Y=null);var I=Z.call(this,M,j.getScene())||this;return I.name=M,I.children=new Array,I.animations=new Array,I._index=null,I._absoluteTransform=new b.c,I._invertedAbsoluteTransform=new b.c,I._scalingDeterminant=1,I._worldTransform=new b.c,I._needToDecompose=!0,I._needToCompose=!1,I._linkedTransformNode=null,I._waitingTransformNodeId=null,I._skeleton=j,I._localMatrix=g?g.clone():b.c.Identity(),I._restPose=O||I._localMatrix.clone(),I._baseMatrix=Q||I._localMatrix.clone(),I._index=Y,j.bones.push(I),I.setParent(K,!1),(Q||g)&&I._updateDifferenceMatrix(),I}return(0,V.m)(M,Z),Object.defineProperty(M.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(Z){this._needToCompose=!1,Z.updateFlag!==this._localMatrix.updateFlag&&(this._localMatrix.copyFrom(Z),this._markAsDirtyAndDecompose())},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"Bone"},M.prototype.getSkeleton=function(){return this._skeleton},Object.defineProperty(M.prototype,"parent",{get:function(){return this._parentNode},set:function(Z){this.setParent(Z)},enumerable:!1,configurable:!0}),M.prototype.getParent=function(){return this.parent},M.prototype.getChildren=function(){return this.children},M.prototype.getIndex=function(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index},M.prototype.setParent=function(Z,M){if(void 0===M&&(M=!0),this.parent!==Z){if(this.parent){var j=this.parent.children.indexOf(this);-1!==j&&this.parent.children.splice(j,1)}this._parentNode=Z,this.parent&&this.parent.children.push(this),M&&this._updateDifferenceMatrix(),this.markAsDirty()}},M.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},M.prototype.getBaseMatrix=function(){return this._baseMatrix},M.prototype.getRestPose=function(){return this._restPose},M.prototype.setRestPose=function(Z){this._restPose.copyFrom(Z)},M.prototype.getBindPose=function(){return this._baseMatrix},M.prototype.setBindPose=function(Z){this.updateMatrix(Z)},M.prototype.getWorldMatrix=function(){return this._worldTransform},M.prototype.returnToRest=function(){var Z;if(this._linkedTransformNode){var M=b.e.Vector3[0],j=b.e.Quaternion[0],K=b.e.Vector3[1];this.getRestPose().decompose(M,j,K),this._linkedTransformNode.position.copyFrom(K),this._linkedTransformNode.rotationQuaternion=null!==(Z=this._linkedTransformNode.rotationQuaternion)&&void 0!==Z?Z:b.d.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(j),this._linkedTransformNode.scaling.copyFrom(M)}else this._matrix=this._restPose},M.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},M.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},M.prototype.linkTransformNode=function(Z){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=Z,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},M.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(M.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(Z){this._decompose(),this._localPosition.copyFrom(Z),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"rotation",{get:function(){return this.getRotation()},set:function(Z){this.setRotation(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(Z){this.setRotationQuaternion(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"scaling",{get:function(){return this.getScale()},set:function(Z){this.setScale(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),M.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=b.k.Zero(),this._localRotation=b.d.Zero(),this._localPosition=b.k.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},M.prototype._compose=function(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,b.c.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)},M.prototype.updateMatrix=function(Z,M,j){void 0===M&&(M=!0),void 0===j&&(j=!0),this._baseMatrix.copyFrom(Z),M&&this._updateDifferenceMatrix(),j?this._matrix=Z:this.markAsDirty()},M.prototype._updateDifferenceMatrix=function(Z,M){if(void 0===M&&(M=!0),Z||(Z=this._baseMatrix),this.parent?Z.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(Z),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),M)for(var j=0;j<this.children.length;j++)this.children[j]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},M.prototype.markAsDirty=function(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this},M.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},M.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},M.prototype.translate=function(Z,j,K){void 0===j&&(j=G.f.LOCAL);var g=this.getLocalMatrix();if(j==G.f.LOCAL)g.addAtIndex(12,Z.x),g.addAtIndex(13,Z.y),g.addAtIndex(14,Z.z);else{var O=null;K&&(O=K.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var Q=M._TmpMats[0],Y=M._TmpVecs[0];this.parent?K&&O?(Q.copyFrom(this.parent.getAbsoluteTransform()),Q.multiplyToRef(O,Q)):Q.copyFrom(this.parent.getAbsoluteTransform()):b.c.IdentityToRef(Q),Q.setTranslationFromFloats(0,0,0),Q.invert(),b.k.TransformCoordinatesToRef(Z,Q,Y),g.addAtIndex(12,Y.x),g.addAtIndex(13,Y.y),g.addAtIndex(14,Y.z)}this._markAsDirtyAndDecompose()},M.prototype.setPosition=function(Z,j,K){void 0===j&&(j=G.f.LOCAL);var g=this.getLocalMatrix();if(j==G.f.LOCAL)g.setTranslationFromFloats(Z.x,Z.y,Z.z);else{var O=null;K&&(O=K.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var Q=M._TmpMats[0],Y=M._TmpVecs[0];this.parent?(K&&O?(Q.copyFrom(this.parent.getAbsoluteTransform()),Q.multiplyToRef(O,Q)):Q.copyFrom(this.parent.getAbsoluteTransform()),Q.invert()):b.c.IdentityToRef(Q),b.k.TransformCoordinatesToRef(Z,Q,Y),g.setTranslationFromFloats(Y.x,Y.y,Y.z)}this._markAsDirtyAndDecompose()},M.prototype.setAbsolutePosition=function(Z,M){this.setPosition(Z,G.f.WORLD,M)},M.prototype.scale=function(Z,j,K,g){void 0===g&&(g=!1);var O=this.getLocalMatrix(),Q=M._TmpMats[0];b.c.ScalingToRef(Z,j,K,Q),Q.multiplyToRef(O,O),Q.invert();for(var Y=0,I=this.children;Y<I.length;Y++){var E=(a=I[Y]).getLocalMatrix();E.multiplyToRef(Q,E),E.multiplyAtIndex(12,Z),E.multiplyAtIndex(13,j),E.multiplyAtIndex(14,K),a._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),g)for(var s=0,i=this.children;s<i.length;s++){var a;(a=i[s]).scale(Z,j,K,g)}},M.prototype.setScale=function(Z){this._decompose(),this._localScaling.copyFrom(Z),this._markAsDirtyAndCompose()},M.prototype.getScale=function(){return this._decompose(),this._localScaling},M.prototype.getScaleToRef=function(Z){this._decompose(),Z.copyFrom(this._localScaling)},M.prototype.setYawPitchRoll=function(Z,j,K,g,O){if(void 0===g&&(g=G.f.LOCAL),g===G.f.LOCAL){var Q=M._TmpQuat;return b.d.RotationYawPitchRollToRef(Z,j,K,Q),void this.setRotationQuaternion(Q,g,O)}var Y=M._TmpMats[0];if(this._getNegativeRotationToRef(Y,O)){var I=M._TmpMats[1];b.c.RotationYawPitchRollToRef(Z,j,K,I),Y.multiplyToRef(I,I),this._rotateWithMatrix(I,g,O)}},M.prototype.rotate=function(Z,j,K,g){void 0===K&&(K=G.f.LOCAL);var O=M._TmpMats[0];O.setTranslationFromFloats(0,0,0),b.c.RotationAxisToRef(Z,j,O),this._rotateWithMatrix(O,K,g)},M.prototype.setAxisAngle=function(Z,j,K,g){if(void 0===K&&(K=G.f.LOCAL),K===G.f.LOCAL){var O=M._TmpQuat;return b.d.RotationAxisToRef(Z,j,O),void this.setRotationQuaternion(O,K,g)}var Q=M._TmpMats[0];if(this._getNegativeRotationToRef(Q,g)){var Y=M._TmpMats[1];b.c.RotationAxisToRef(Z,j,Y),Q.multiplyToRef(Y,Y),this._rotateWithMatrix(Y,K,g)}},M.prototype.setRotation=function(Z,M,j){void 0===M&&(M=G.f.LOCAL),this.setYawPitchRoll(Z.y,Z.x,Z.z,M,j)},M.prototype.setRotationQuaternion=function(Z,j,K){if(void 0===j&&(j=G.f.LOCAL),j===G.f.LOCAL)return this._decompose(),this._localRotation.copyFrom(Z),void this._markAsDirtyAndCompose();var g=M._TmpMats[0];if(this._getNegativeRotationToRef(g,K)){var O=M._TmpMats[1];b.c.FromQuaternionToRef(Z,O),g.multiplyToRef(O,O),this._rotateWithMatrix(O,j,K)}},M.prototype.setRotationMatrix=function(Z,j,K){if(void 0===j&&(j=G.f.LOCAL),j===G.f.LOCAL){var g=M._TmpQuat;return b.d.FromRotationMatrixToRef(Z,g),void this.setRotationQuaternion(g,j,K)}var O=M._TmpMats[0];if(this._getNegativeRotationToRef(O,K)){var Q=M._TmpMats[1];Q.copyFrom(Z),O.multiplyToRef(Z,Q),this._rotateWithMatrix(Q,j,K)}},M.prototype._rotateWithMatrix=function(Z,j,K){void 0===j&&(j=G.f.LOCAL);var b=this.getLocalMatrix(),g=b.m[12],O=b.m[13],Q=b.m[14],Y=this.getParent(),I=M._TmpMats[3],E=M._TmpMats[4];Y&&j==G.f.WORLD?(K?(I.copyFrom(K.getWorldMatrix()),Y.getAbsoluteTransform().multiplyToRef(I,I)):I.copyFrom(Y.getAbsoluteTransform()),E.copyFrom(I),E.invert(),b.multiplyToRef(I,b),b.multiplyToRef(Z,b),b.multiplyToRef(E,b)):j==G.f.WORLD&&K?(I.copyFrom(K.getWorldMatrix()),E.copyFrom(I),E.invert(),b.multiplyToRef(I,b),b.multiplyToRef(Z,b),b.multiplyToRef(E,b)):b.multiplyToRef(Z,b),b.setTranslationFromFloats(g,O,Q),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},M.prototype._getNegativeRotationToRef=function(Z,j){var K=M._TmpMats[2];return Z.copyFrom(this.getAbsoluteTransform()),j?(Z.multiplyToRef(j.getWorldMatrix(),Z),b.c.ScalingToRef(j.scaling.x,j.scaling.y,j.scaling.z,K)):b.c.IdentityToRef(K),Z.invert(),!isNaN(Z.m[0])&&(K.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyToRef(K,Z),!0)},M.prototype.getPosition=function(Z,M){void 0===Z&&(Z=G.f.LOCAL),void 0===M&&(M=null);var j=b.k.Zero();return this.getPositionToRef(Z,M,j),j},M.prototype.getPositionToRef=function(Z,j,K){if(void 0===Z&&(Z=G.f.LOCAL),Z==G.f.LOCAL){var b=this.getLocalMatrix();K.x=b.m[12],K.y=b.m[13],K.z=b.m[14]}else{var g=null;j&&(g=j.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var O=M._TmpMats[0];j&&g?(O.copyFrom(this.getAbsoluteTransform()),O.multiplyToRef(g,O)):O=this.getAbsoluteTransform(),K.x=O.m[12],K.y=O.m[13],K.z=O.m[14]}},M.prototype.getAbsolutePosition=function(Z){void 0===Z&&(Z=null);var M=b.k.Zero();return this.getPositionToRef(G.f.WORLD,Z,M),M},M.prototype.getAbsolutePositionToRef=function(Z,M){this.getPositionToRef(G.f.WORLD,Z,M)},M.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var Z=this._skeleton.getPoseMatrix();Z&&this._absoluteTransform.multiplyToRef(Z,this._absoluteTransform)}for(var M=this.children,j=M.length,K=0;K<j;K++)M[K].computeAbsoluteTransforms()},M.prototype.getDirection=function(Z,M){void 0===M&&(M=null);var j=b.k.Zero();return this.getDirectionToRef(Z,M,j),j},M.prototype.getDirectionToRef=function(Z,j,K){void 0===j&&(j=null);var g=null;j&&(g=j.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var O=M._TmpMats[0];O.copyFrom(this.getAbsoluteTransform()),j&&g&&O.multiplyToRef(g,O),b.k.TransformNormalToRef(Z,O,K),K.normalize()},M.prototype.getRotation=function(Z,M){void 0===Z&&(Z=G.f.LOCAL),void 0===M&&(M=null);var j=b.k.Zero();return this.getRotationToRef(Z,M,j),j},M.prototype.getRotationToRef=function(Z,j,K){void 0===Z&&(Z=G.f.LOCAL),void 0===j&&(j=null);var b=M._TmpQuat;this.getRotationQuaternionToRef(Z,j,b),b.toEulerAnglesToRef(K)},M.prototype.getRotationQuaternion=function(Z,M){void 0===Z&&(Z=G.f.LOCAL),void 0===M&&(M=null);var j=b.d.Identity();return this.getRotationQuaternionToRef(Z,M,j),j},M.prototype.getRotationQuaternionToRef=function(Z,j,K){if(void 0===Z&&(Z=G.f.LOCAL),void 0===j&&(j=null),Z==G.f.LOCAL)this._decompose(),K.copyFrom(this._localRotation);else{var b=M._TmpMats[0],g=this.getAbsoluteTransform();j?g.multiplyToRef(j.getWorldMatrix(),b):b.copyFrom(g),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.decompose(void 0,K,void 0)}},M.prototype.getRotationMatrix=function(Z,M){void 0===Z&&(Z=G.f.LOCAL);var j=b.c.Identity();return this.getRotationMatrixToRef(Z,M,j),j},M.prototype.getRotationMatrixToRef=function(Z,j,K){if(void 0===Z&&(Z=G.f.LOCAL),Z==G.f.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(K);else{var b=M._TmpMats[0],g=this.getAbsoluteTransform();j?g.multiplyToRef(j.getWorldMatrix(),b):b.copyFrom(g),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.getRotationMatrixToRef(K)}},M.prototype.getAbsolutePositionFromLocal=function(Z,M){void 0===M&&(M=null);var j=b.k.Zero();return this.getAbsolutePositionFromLocalToRef(Z,M,j),j},M.prototype.getAbsolutePositionFromLocalToRef=function(Z,j,K){void 0===j&&(j=null);var g=null;j&&(g=j.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var O=M._TmpMats[0];j&&g?(O.copyFrom(this.getAbsoluteTransform()),O.multiplyToRef(g,O)):O=this.getAbsoluteTransform(),b.k.TransformCoordinatesToRef(Z,O,K)},M.prototype.getLocalPositionFromAbsolute=function(Z,M){void 0===M&&(M=null);var j=b.k.Zero();return this.getLocalPositionFromAbsoluteToRef(Z,M,j),j},M.prototype.getLocalPositionFromAbsoluteToRef=function(Z,j,K){void 0===j&&(j=null);var g=null;j&&(g=j.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var O=M._TmpMats[0];O.copyFrom(this.getAbsoluteTransform()),j&&g&&O.multiplyToRef(g,O),O.invert(),b.k.TransformCoordinatesToRef(Z,O,K)},M.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},M._TmpVecs=o.e.BuildArray(2,b.k.Zero),M._TmpQuat=b.d.Identity(),M._TmpMats=o.e.BuildArray(5,b.c.Identity),M}(c.b),X=j(15099),d=j(7686),W=j(9127),A=j(51004),q=function(){function Z(Z,M,j){this.name=Z,this.id=M,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=b.c.Identity(),this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new E.b,this.bones=[],this._scene=j||s.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var K=this._scene.getEngine().getCaps();this._canUseTextureForBones=K.textureFloat&&K.maxVertexTextureImageUnits>0}return Object.defineProperty(Z.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(Z){this._useTextureToStoreBoneMatrices=Z,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(Z){this._animationPropertiesOverride=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Z.prototype.getClassName=function(){return"Skeleton"},Z.prototype.getChildren=function(){return this.bones.filter((function(Z){return!Z.getParent()}))},Z.prototype.getTransformMatrices=function(Z){return this.needInitialSkinMatrix?(Z._bonesTransformMatrices||this.prepare(),Z._bonesTransformMatrices):(this._transformMatrices||this.prepare(),this._transformMatrices)},Z.prototype.getTransformMatrixTexture=function(Z){return this.needInitialSkinMatrix&&Z._transformMatrixTexture?Z._transformMatrixTexture:this._transformMatrixTexture},Z.prototype.getScene=function(){return this._scene},Z.prototype.toString=function(Z){var M="Name: ".concat(this.name,", nBones: ").concat(this.bones.length);if(M+=", nAnimationRanges: ".concat(this._ranges?Object.keys(this._ranges).length:"none"),Z){M+=", Ranges: {";var j=!0;for(var K in this._ranges)j&&(M+=", ",j=!1),M+=K;M+="}"}return M},Z.prototype.getBoneIndexByName=function(Z){for(var M=0,j=this.bones.length;M<j;M++)if(this.bones[M].name===Z)return M;return-1},Z.prototype.createAnimationRange=function(Z,M,j){if(!this._ranges[Z]){this._ranges[Z]=new d.c(Z,M,j);for(var K=0,b=this.bones.length;K<b;K++)this.bones[K].animations[0]&&this.bones[K].animations[0].createRange(Z,M,j)}},Z.prototype.deleteAnimationRange=function(Z,M){void 0===M&&(M=!0);for(var j=0,K=this.bones.length;j<K;j++)this.bones[j].animations[0]&&this.bones[j].animations[0].deleteRange(Z,M);this._ranges[Z]=null},Z.prototype.getAnimationRange=function(Z){return this._ranges[Z]||null},Z.prototype.getAnimationRanges=function(){var Z,M=[];for(Z in this._ranges)M.push(this._ranges[Z]);return M},Z.prototype.copyAnimationRange=function(Z,M,j){if(void 0===j&&(j=!1),this._ranges[M]||!Z.getAnimationRange(M))return!1;var K,b,g=!0,O=this._getHighestAnimationFrame()+1,Q={},Y=Z.bones;for(b=0,K=Y.length;b<K;b++)Q[Y[b].name]=Y[b];this.bones.length!==Y.length&&(W.c.Warn("copyAnimationRange: this rig has ".concat(this.bones.length," bones, while source as ").concat(Y.length)),g=!1);var I=j&&this.dimensionsAtRest&&Z.dimensionsAtRest?this.dimensionsAtRest.divide(Z.dimensionsAtRest):null;for(b=0,K=this.bones.length;b<K;b++){var E=this.bones[b].name,s=Q[E];s?g=g&&this.bones[b].copyAnimationRange(s,M,O,j,I):(W.c.Warn("copyAnimationRange: not same rig, missing source bone "+E),g=!1)}var i=Z.getAnimationRange(M);return i&&(this._ranges[M]=new d.c(M,i.from+O,i.to+O)),g},Z.prototype.returnToRest=function(){for(var Z=0,M=this.bones;Z<M.length;Z++){var j=M[Z];-1!==j._index&&j.returnToRest()}},Z.prototype._getHighestAnimationFrame=function(){for(var Z=0,M=0,j=this.bones.length;M<j;M++)if(this.bones[M].animations[0]){var K=this.bones[M].animations[0].getHighestFrame();Z<K&&(Z=K)}return Z},Z.prototype.beginAnimation=function(Z,M,j,K){var b=this.getAnimationRange(Z);return b?this._scene.beginAnimation(this,b.from,b.to,M,j,K):null},Z.MakeAnimationAdditive=function(Z,M,j){void 0===M&&(M=0);var K=Z.getAnimationRange(j);if(!K)return null;for(var b=Z._scene.getAllAnimatablesByTarget(Z),g=null,O=0;O<b.length;O++){var Q=b[O];if(Q.fromFrame===(null===K||void 0===K?void 0:K.from)&&Q.toFrame===(null===K||void 0===K?void 0:K.to)){g=Q;break}}var Y=Z.getAnimatables();for(O=0;O<Y.length;O++){var E=Y[O].animations;if(E)for(var s=0;s<E.length;s++)I.c.MakeAnimationAdditive(E[s],M,j)}return g&&(g.isAdditive=!0),Z},Z.prototype._markAsDirty=function(){this._isDirty=!0,this._absoluteTransformIsDirty=!0},Z.prototype._registerMeshWithPoseMatrix=function(Z){this._meshesWithPoseMatrix.push(Z)},Z.prototype._unregisterMeshWithPoseMatrix=function(Z){var M=this._meshesWithPoseMatrix.indexOf(Z);M>-1&&this._meshesWithPoseMatrix.splice(M,1)},Z.prototype._computeTransformMatrices=function(Z,M){this.onBeforeComputeObservable.notifyObservers(this);for(var j=0;j<this.bones.length;j++){var K=this.bones[j];K._childUpdateId++;var b=K.getParent();if(b?K.getLocalMatrix().multiplyToRef(b.getWorldMatrix(),K.getWorldMatrix()):M?K.getLocalMatrix().multiplyToRef(M,K.getWorldMatrix()):K.getWorldMatrix().copyFrom(K.getLocalMatrix()),-1!==K._index){var g=null===K._index?j:K._index;K.getInvertedAbsoluteTransform().multiplyToArray(K.getWorldMatrix(),Z,16*g)}}this._identity.copyToArray(Z,16*this.bones.length)},Z.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var Z=0,M=this.bones;Z<M.length;Z++){(E=M[Z])._linkedTransformNode&&(E._linkedTransformNode.computeWorldMatrix(),E._matrix=E._linkedTransformNode._localMatrix)}if(this.needInitialSkinMatrix)for(var j=0,K=this._meshesWithPoseMatrix;j<K.length;j++){var g=K[j],O=g.getPoseMatrix(),Q=this._isDirty;if(g._bonesTransformMatrices&&g._bonesTransformMatrices.length===16*(this.bones.length+1)||(g._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Q=!0),Q){if(this._synchronizedWithMesh!==g){this._synchronizedWithMesh=g;for(var Y=0,I=this.bones;Y<I.length;Y++){var E;if(!(E=I[Y]).getParent())E.getBaseMatrix().multiplyToRef(O,b.e.Matrix[1]),E._updateDifferenceMatrix(b.e.Matrix[1])}if(this.isUsingTextureForMatrices){var s=4*(this.bones.length+1);g._transformMatrixTexture&&g._transformMatrixTexture.getSize().width===s||(g._transformMatrixTexture&&g._transformMatrixTexture.dispose(),g._transformMatrixTexture=X.d.CreateRGBATexture(g._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(g._bonesTransformMatrices,O),this.isUsingTextureForMatrices&&g._transformMatrixTexture&&g._transformMatrixTexture.update(g._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=X.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1},Z.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var Z=0;Z<this.bones.length;Z++)this._animatables.push(this.bones[Z])}return this._animatables},Z.prototype.clone=function(M,j){var K=new Z(M,j||M,this._scene);K.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var b=0;b<this.bones.length;b++){var g=this.bones[b],O=null,Q=g.getParent();if(Q){var Y=this.bones.indexOf(Q);O=K.bones[Y]}var I=new f(g.name,K,O,g.getBaseMatrix().clone(),g.getRestPose().clone());I._index=g._index,g._linkedTransformNode&&I.linkTransformNode(g._linkedTransformNode),A.d.DeepCopy(g.animations,I.animations)}if(this._ranges)for(var E in K._ranges={},this._ranges){var s=this._ranges[E];s&&(K._ranges[E]=s.clone())}return this._isDirty=!0,K},Z.prototype.enableBlending=function(Z){void 0===Z&&(Z=.01),this.bones.forEach((function(M){M.animations.forEach((function(M){M.enableBlending=!0,M.blendingSpeed=Z}))}))},Z.prototype.dispose=function(){if(this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._parentContainer){var Z=this._parentContainer.skeletons.indexOf(this);Z>-1&&this._parentContainer.skeletons.splice(Z,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},Z.prototype.serialize=function(){var Z,M={};M.name=this.name,M.id=this.id,this.dimensionsAtRest&&(M.dimensionsAtRest=this.dimensionsAtRest.asArray()),M.bones=[],M.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var j=0;j<this.bones.length;j++){var K=this.bones[j],b=K.getParent(),g={parentBoneIndex:b?this.bones.indexOf(b):-1,index:K.getIndex(),name:K.name,id:K.id,matrix:K.getBaseMatrix().toArray(),rest:K.getRestPose().toArray(),linkedTransformNodeId:null===(Z=K.getTransformNode())||void 0===Z?void 0:Z.id};for(var O in M.bones.push(g),K.length&&(g.length=K.length),K.metadata&&(g.metadata=K.metadata),K.animations&&K.animations.length>0&&(g.animation=K.animations[0].serialize()),M.ranges=[],this._ranges){var Q=this._ranges[O];if(Q){var Y={};Y.name=O,Y.from=Q.from,Y.to=Q.to,M.ranges.push(Y)}}}return M},Z.Parse=function(M,j){var K,g=new Z(M.name,M.id,j);for(M.dimensionsAtRest&&(g.dimensionsAtRest=b.k.FromArray(M.dimensionsAtRest)),g.needInitialSkinMatrix=M.needInitialSkinMatrix,K=0;K<M.bones.length;K++){var O=M.bones[K],Q=M.bones[K].index,Y=null;O.parentBoneIndex>-1&&(Y=g.bones[O.parentBoneIndex]);var E=O.rest?b.c.FromArray(O.rest):null,s=new f(O.name,g,Y,b.c.FromArray(O.matrix),E,null,Q);void 0!==O.id&&null!==O.id&&(s.id=O.id),O.length&&(s.length=O.length),O.metadata&&(s.metadata=O.metadata),O.animation&&s.animations.push(I.c.Parse(O.animation)),void 0!==O.linkedTransformNodeId&&null!==O.linkedTransformNodeId&&(g._hasWaitingData=!0,s._waitingTransformNodeId=O.linkedTransformNodeId)}if(M.ranges)for(K=0;K<M.ranges.length;K++){var i=M.ranges[K];g.createAnimationRange(i.name,i.from,i.to)}return g},Z.prototype.computeAbsoluteTransforms=function(Z){void 0===Z&&(Z=!1),(this._absoluteTransformIsDirty||Z)&&(this.bones[0].computeAbsoluteTransforms(),this._absoluteTransformIsDirty=!1)},Z.prototype.getPoseMatrix=function(){var Z=null;return this._meshesWithPoseMatrix.length>0&&(Z=this._meshesWithPoseMatrix[0].getPoseMatrix()),Z},Z.prototype.sortBones=function(){for(var Z=new Array,M=new Array(this.bones.length),j=0;j<this.bones.length;j++)this._sortBones(j,Z,M);this.bones=Z},Z.prototype._sortBones=function(Z,M,j){if(!j[Z]){j[Z]=!0;var K=this.bones[Z];if(K){void 0===K._index&&(K._index=Z);var b=K.getParent();b&&this._sortBones(this.bones.indexOf(b),M,j),M.push(K)}}},Z.prototype.setCurrentPoseAsRest=function(){this.bones.forEach((function(Z){Z.setCurrentPoseAsRest()}))},Z}(),T=j(46907),B=j(9892),N=j(5344),U=j(82325),n=j(31709),k=function(Z){function M(j,K){var b=Z.call(this,j,K)||this;return b.directIntensity=1,b.emissiveIntensity=1,b.environmentIntensity=1,b.specularIntensity=1,b.disableBumpMap=!1,b.ambientTextureStrength=1,b.ambientTextureImpactOnAnalyticalLights=M.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,b.metallicF0Factor=1,b.metallicReflectanceColor=g.e.White(),b.useOnlyMetallicFromMetallicReflectanceTexture=!1,b.ambientColor=new g.e(0,0,0),b.albedoColor=new g.e(1,1,1),b.reflectivityColor=new g.e(1,1,1),b.reflectionColor=new g.e(1,1,1),b.emissiveColor=new g.e(0,0,0),b.microSurface=1,b.useLightmapAsShadowmap=!1,b.useAlphaFromAlbedoTexture=!1,b.forceAlphaTest=!1,b.alphaCutOff=.4,b.useSpecularOverAlpha=!0,b.useMicroSurfaceFromReflectivityMapAlpha=!1,b.useRoughnessFromMetallicTextureAlpha=!0,b.useRoughnessFromMetallicTextureGreen=!1,b.useMetallnessFromMetallicTextureBlue=!1,b.useAmbientOcclusionFromMetallicTextureRed=!1,b.useAmbientInGrayScale=!1,b.useAutoMicroSurfaceFromReflectivityMap=!1,b.useRadianceOverAlpha=!0,b.useObjectSpaceNormalMap=!1,b.useParallax=!1,b.useParallaxOcclusion=!1,b.parallaxScaleBias=.05,b.disableLighting=!1,b.forceIrradianceInFragment=!1,b.maxSimultaneousLights=4,b.invertNormalMapX=!1,b.invertNormalMapY=!1,b.twoSidedLighting=!1,b.useAlphaFresnel=!1,b.useLinearAlphaFresnel=!1,b.environmentBRDFTexture=null,b.forceNormalForward=!1,b.enableSpecularAntiAliasing=!1,b.useHorizonOcclusion=!0,b.useRadianceOcclusion=!0,b.unlit=!1,b._environmentBRDFTexture=(0,N.b)(b.getScene()),b}return(0,V.m)(M,Z),Object.defineProperty(M.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(Z){this.subSurface.refractionTexture=Z,Z?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"indexOfRefraction",{get:function(){return this.subSurface.indexOfRefraction},set:function(Z){this.subSurface.indexOfRefraction=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(Z){this.subSurface.invertRefractionY=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(Z){this.subSurface.linkRefractionWithTransparency=Z,Z&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===U.b.LIGHTFALLOFF_PHYSICAL},set:function(Z){Z!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=Z?U.b.LIGHTFALLOFF_PHYSICAL:U.b.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===U.b.LIGHTFALLOFF_GLTF},set:function(Z){Z!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=Z?U.b.LIGHTFALLOFF_GLTF:U.b.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(Z){this._attachImageProcessingConfiguration(Z),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(Z){this.imageProcessingConfiguration.colorCurvesEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(Z){this.imageProcessingConfiguration.colorGradingEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(Z){this._imageProcessingConfiguration.toneMappingEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(Z){this._imageProcessingConfiguration.exposure=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(Z){this._imageProcessingConfiguration.contrast=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(Z){this._imageProcessingConfiguration.colorGradingTexture=Z},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(Z){this._imageProcessingConfiguration.colorCurves=Z},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"PBRMaterial"},M.prototype.clone=function(Z){var j=this,K=B.b.Clone((function(){return new M(Z,j.getScene())}),this);return K.id=Z,K.name=Z,this.stencil.copyTo(K.stencil),this.clearCoat.copyTo(K.clearCoat),this.anisotropy.copyTo(K.anisotropy),this.brdf.copyTo(K.brdf),this.sheen.copyTo(K.sheen),this.subSurface.copyTo(K.subSurface),K},M.prototype.serialize=function(){var M=Z.prototype.serialize.call(this);return M.customType="BABYLON.PBRMaterial",M.clearCoat=this.clearCoat.serialize(),M.anisotropy=this.anisotropy.serialize(),M.brdf=this.brdf.serialize(),M.sheen=this.sheen.serialize(),M.subSurface=this.subSurface.serialize(),M.iridescence=this.iridescence.serialize(),M},M.Parse=function(Z,j,K){var b=B.b.Parse((function(){return new M(Z.name,j)}),Z,j,K);return Z.stencil&&b.stencil.parse(Z.stencil,j,K),Z.clearCoat&&b.clearCoat.parse(Z.clearCoat,j,K),Z.anisotropy&&b.anisotropy.parse(Z.anisotropy,j,K),Z.brdf&&b.brdf.parse(Z.brdf,j,K),Z.sheen&&b.sheen.parse(Z.sheen,j,K),Z.subSurface&&b.subSurface.parse(Z.subSurface,j,K),Z.iridescence&&b.iridescence.parse(Z.iridescence,j,K),b},M.PBRMATERIAL_OPAQUE=U.b.PBRMATERIAL_OPAQUE,M.PBRMATERIAL_ALPHATEST=U.b.PBRMATERIAL_ALPHATEST,M.PBRMATERIAL_ALPHABLEND=U.b.PBRMATERIAL_ALPHABLEND,M.PBRMATERIAL_ALPHATESTANDBLEND=U.b.PBRMATERIAL_ALPHATESTANDBLEND,M.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=U.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"directIntensity",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"emissiveIntensity",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"environmentIntensity",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"specularIntensity",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"disableBumpMap",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"albedoTexture",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientTexture",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientTextureStrength",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"opacityTexture",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectionTexture",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"emissiveTexture",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectivityTexture",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"metallicTexture",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"metallic",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"roughness",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"metallicF0Factor",void 0),(0,V.l)([(0,B.i)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"metallicReflectanceColor",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"metallicReflectanceTexture",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectanceTexture",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"microSurfaceTexture",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"bumpTexture",void 0),(0,V.l)([(0,B.s)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty",null)],M.prototype,"lightmapTexture",void 0),(0,V.l)([(0,B.i)("ambient"),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientColor",void 0),(0,V.l)([(0,B.i)("albedo"),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"albedoColor",void 0),(0,V.l)([(0,B.i)("reflectivity"),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectivityColor",void 0),(0,V.l)([(0,B.i)("reflection"),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectionColor",void 0),(0,V.l)([(0,B.i)("emissive"),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"emissiveColor",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"microSurface",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useLightmapAsShadowmap",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"useAlphaFromAlbedoTexture",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"forceAlphaTest",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"alphaCutOff",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useSpecularOverAlpha",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useAmbientInGrayScale",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,V.l)([(0,B.z)()],M.prototype,"usePhysicalLightFalloff",null),(0,V.l)([(0,B.z)()],M.prototype,"useGLTFLightFalloff",null),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRadianceOverAlpha",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useObjectSpaceNormalMap",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useParallax",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useParallaxOcclusion",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"parallaxScaleBias",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsLightsDirty")],M.prototype,"disableLighting",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"forceIrradianceInFragment",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsLightsDirty")],M.prototype,"maxSimultaneousLights",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertNormalMapX",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertNormalMapY",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"twoSidedLighting",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useAlphaFresnel",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useLinearAlphaFresnel",void 0),(0,V.l)([(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"environmentBRDFTexture",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"forceNormalForward",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"enableSpecularAntiAliasing",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useHorizonOcclusion",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRadianceOcclusion",void 0),(0,V.l)([(0,B.z)(),(0,B.c)("_markAllSubMeshesAsMiscDirty")],M.prototype,"unlit",void 0),M}(U.b);(0,n.c)("BABYLON.PBRMaterial",k);var x=j(70937),R=j(77129),e=j(43251),u=j(3579),F=j(65847),C=function(){function Z(Z,M,j){void 0===M&&(M=0),void 0===j&&(j=null),this.name=Z,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new E.b,this._onDataLayoutChanged=new E.b,this._animationPropertiesOverride=null,this._scene=j||s.e.LastCreatedScene,this.influence=M,this._scene&&(this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(Z.prototype,"influence",{get:function(){return this._influence},set:function(Z){if(this._influence!==Z){var M=this._influence;this._influence=Z,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===M||0===Z)}},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(Z){this._animationPropertiesOverride=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!1,configurable:!0}),Z.prototype.setPositions=function(Z){var M=this.hasPositions;this._positions=Z,M!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},Z.prototype.getPositions=function(){return this._positions},Z.prototype.setNormals=function(Z){var M=this.hasNormals;this._normals=Z,M!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},Z.prototype.getNormals=function(){return this._normals},Z.prototype.setTangents=function(Z){var M=this.hasTangents;this._tangents=Z,M!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},Z.prototype.getTangents=function(){return this._tangents},Z.prototype.setUVs=function(Z){var M=this.hasUVs;this._uvs=Z,M!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)},Z.prototype.getUVs=function(){return this._uvs},Z.prototype.clone=function(){var M=this,j=B.b.Clone((function(){return new Z(M.name,M.influence,M._scene)}),this);return j._positions=this._positions,j._normals=this._normals,j._tangents=this._tangents,j._uvs=this._uvs,j},Z.prototype.serialize=function(){var Z={};return Z.name=this.name,Z.influence=this.influence,Z.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(Z.id=this.id),this.hasNormals&&(Z.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(Z.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(Z.uvs=Array.prototype.slice.call(this.getUVs())),B.b.AppendSerializedAnimations(this,Z),Z},Z.prototype.getClassName=function(){return"MorphTarget"},Z.Parse=function(M,j){var K=new Z(M.name,M.influence);if(K.setPositions(M.positions),null!=M.id&&(K.id=M.id),M.normals&&K.setNormals(M.normals),M.tangents&&K.setTangents(M.tangents),M.uvs&&K.setUVs(M.uvs),M.animations){for(var b=0;b<M.animations.length;b++){var g=M.animations[b],O=(0,n.b)("BABYLON.Animation");O&&K.animations.push(O.Parse(g))}M.autoAnimate&&j&&j.beginAnimation(K,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1)}return K},Z.FromMesh=function(M,j,K){j||(j=M.name);var b=new Z(j,K,M.getScene());return b.setPositions(M.getVerticesData(e.f.PositionKind)),M.isVerticesDataPresent(e.f.NormalKind)&&b.setNormals(M.getVerticesData(e.f.NormalKind)),M.isVerticesDataPresent(e.f.TangentKind)&&b.setTangents(M.getVerticesData(e.f.TangentKind)),M.isVerticesDataPresent(e.f.UVKind)&&b.setUVs(M.getVerticesData(e.f.UVKind)),b},(0,V.l)([(0,B.z)()],Z.prototype,"id",void 0),Z}(),y=j(17190),S=j(57194),h=function(){function Z(Z){if(void 0===Z&&(Z=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new y.f(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._useTextureToStoreTargets=!0,Z||(Z=s.e.LastCreatedScene),this._scene=Z,this._scene){this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId();var M=this._scene.getEngine().getCaps();this._canUseTextureForTargets=M.canUseGLVertexID&&M.textureFloat&&M.maxVertexTextureImageUnits>0&&M.texture2DArrayMaxLayerCount>1}}return Object.defineProperty(Z.prototype,"areUpdatesFrozen",{get:function(){return this._blockCounter>0},set:function(Z){Z?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&this.enableNormalMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"influences",{get:function(){return this._influences},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"useTextureToStoreTargets",{get:function(){return this._useTextureToStoreTargets},set:function(Z){this._useTextureToStoreTargets=Z},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"isUsingTextureForTargets",{get:function(){return Z.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets},enumerable:!1,configurable:!0}),Z.prototype.getActiveTarget=function(Z){return this._activeTargets.data[Z]},Z.prototype.getTarget=function(Z){return this._targets[Z]},Z.prototype.addTarget=function(Z){var M=this;this._targets.push(Z),this._targetInfluenceChangedObservers.push(Z.onInfluenceChanged.add((function(Z){M._syncActiveTargets(Z)}))),this._targetDataLayoutChangedObservers.push(Z._onDataLayoutChanged.add((function(){M._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)},Z.prototype.removeTarget=function(Z){var M=this._targets.indexOf(Z);M>=0&&(this._targets.splice(M,1),Z.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(M,1)[0]),Z._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(M,1)[0]),this._syncActiveTargets(!0))},Z.prototype._bind=function(Z){Z.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),Z.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),Z.setTexture("morphTargets",this._targetStoreTexture)},Z.prototype.clone=function(){for(var M=new Z(this._scene),j=0,K=this._targets;j<K.length;j++){var b=K[j];M.addTarget(b.clone())}return M.enableNormalMorphing=this.enableNormalMorphing,M.enableTangentMorphing=this.enableTangentMorphing,M.enableUVMorphing=this.enableUVMorphing,M},Z.prototype.serialize=function(){var Z={};Z.id=this.uniqueId,Z.targets=[];for(var M=0,j=this._targets;M<j.length;M++){var K=j[M];Z.targets.push(K.serialize())}return Z},Z.prototype._syncActiveTargets=function(Z){if(!this.areUpdatesFrozen){var M=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));for(var j=-1,K=0,b=this._targets;K<b.length;K++){var g=b[K];if(j++,0!==g.influence||!this.optimizeInfluencers){this._activeTargets.push(g),this._morphTargetTextureIndices[M]=j,this._tempInfluences[M++]=g.influence,this._supportsNormals=this._supportsNormals&&g.hasNormals,this._supportsTangents=this._supportsTangents&&g.hasTangents,this._supportsUVs=this._supportsUVs&&g.hasUVs;var O=g.getPositions();if(O){var Q=O.length/3;if(0===this._vertexCount)this._vertexCount=Q;else if(this._vertexCount!==Q)return void W.c.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===M||(this._influences=new Float32Array(M));for(var Y=0;Y<M;Y++)this._influences[Y]=this._tempInfluences[Y];Z&&this.synchronize()}},Z.prototype.synchronize=function(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&this._vertexCount){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride,this._textureHeight=1;var Z=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>Z&&(this._textureHeight=Math.ceil(this._textureWidth/Z),this._textureWidth=Z);var M=!0;if(this._targetStoreTexture){var j=this._targetStoreTexture.getSize();j.width===this._textureWidth&&j.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(M=!1)}if(M){this._targetStoreTexture&&this._targetStoreTexture.dispose();for(var K=this._targets.length,b=new Float32Array(K*this._textureWidth*this._textureHeight*4),g=0,O=0;O<K;O++){var Q=this._targets[O],Y=Q.getPositions(),I=Q.getNormals(),E=Q.getUVs(),s=Q.getTangents();if(!Y)return void(0===O&&W.c.Error("Invalid morph target. Target must have positions."));g=O*this._textureWidth*this._textureHeight*4;for(var i=0;i<this._vertexCount;i++)b[g]=Y[3*i],b[g+1]=Y[3*i+1],b[g+2]=Y[3*i+2],g+=4,I&&(b[g]=I[3*i],b[g+1]=I[3*i+1],b[g+2]=I[3*i+2],g+=4),E&&(b[g]=E[2*i],b[g+1]=E[2*i+1],g+=4),s&&(b[g]=s[3*i],b[g+1]=s[3*i+1],b[g+2]=s[3*i+2],g+=4)}this._targetStoreTexture=S.e.CreateRGBATexture(b,this._textureWidth,this._textureHeight,K,this._scene,!1,!1,1,1)}}for(var a=0,z=this._scene.meshes;a<z.length;a++){var V=z[a];V.morphTargetManager===this&&V._syncGeometryWithMorphTargetManager()}}},Z.prototype.dispose=function(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene&&(this._scene.removeMorphTargetManager(this),this._parentContainer)){var Z=this._parentContainer.morphTargetManagers.indexOf(this);Z>-1&&this._parentContainer.morphTargetManagers.splice(Z,1),this._parentContainer=null}},Z.Parse=function(M,j){var K=new Z(j);K._uniqueId=M.id;for(var b=0,g=M.targets;b<g.length;b++){var O=g[b];K.addTarget(C.Parse(O,j))}return K},Z.EnableTextureStorage=!0,Z}(),w=j(47984),p=j(25488),m=j(82790),J=j(97918),P=function(){function Z(){}return Z.Get=function(Z,M,j){if(!M||void 0==j||!M[j])throw new Error("".concat(Z,": Failed to find index (").concat(j,")"));return M[j]},Z.Assign=function(Z){if(Z)for(var M=0;M<Z.length;M++)Z[M].index=M},Z}();function H(){for(var Z=[],M=0;M<arguments.length;M++)Z[M]=arguments[M];var j=function(Z){return Z&&"object"===typeof Z};return Z.reduce((function(Z,M){return Object.keys(M).forEach((function(K){var b=Z[K],g=M[K];Array.isArray(b)&&Array.isArray(g)?Z[K]=b.concat.apply(b,g):j(b)&&j(g)?Z[K]=H(b,g):Z[K]=g})),Z}),{})}var D=function(){function Z(Z){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=Z}return Z.RegisterExtension=function(M,j){Z.UnregisterExtension(M)&&W.c.Warn("Extension with the name '".concat(M,"' already exists")),Z._RegisteredExtensions[M]={factory:j}},Z.UnregisterExtension=function(M){return!!Z._RegisteredExtensions[M]&&(delete Z._RegisteredExtensions[M],!0)},Object.defineProperty(Z.prototype,"gltf",{get:function(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"babylonScene",{get:function(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0}),Z.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((function(Z){return Z.dispose&&Z.dispose()})),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())},Z.prototype.importMeshAsync=function(Z,M,j,K,b,g,O){var Q=this;return void 0===O&&(O=""),Promise.resolve().then((function(){Q._babylonScene=M,Q._assetContainer=j,Q._loadData(K);var g=null;if(Z){var Y={};if(Q._gltf.nodes)for(var I=0,E=Q._gltf.nodes;I<E.length;I++){var s=E[I];s.name&&(Y[s.name]=s.index)}g=(Z instanceof Array?Z:[Z]).map((function(Z){var M=Y[Z];if(void 0===M)throw new Error("Failed to find node '".concat(Z,"'"));return M}))}return Q._loadAsync(b,O,g,(function(){return{meshes:Q._getMeshes(),particleSystems:[],skeletons:Q._getSkeletons(),animationGroups:Q._getAnimationGroups(),lights:Q._babylonLights,transformNodes:Q._getTransformNodes(),geometries:Q._getGeometries()}}))}))},Z.prototype.loadAsync=function(Z,M,j,K,b){var g=this;return void 0===b&&(b=""),Promise.resolve().then((function(){return g._babylonScene=Z,g._loadData(M),g._loadAsync(j,b,null,(function(){}))}))},Z.prototype._loadAsync=function(Z,M,j,K){var b=this;return Promise.resolve().then((function(){b._rootUrl=Z,b._uniqueRootUrl=!Z.startsWith("file:")&&M?Z:"".concat(Z).concat(Date.now(),"/"),b._fileName=M,b._loadExtensions(),b._checkExtensions();var g="".concat(w.j[w.j.LOADING]," => ").concat(w.j[w.j.READY]),Q="".concat(w.j[w.j.LOADING]," => ").concat(w.j[w.j.COMPLETE]);b._parent._startPerformanceCounter(g),b._parent._startPerformanceCounter(Q),b._parent._setState(w.j.LOADING),b._extensionsOnLoading();var Y=new Array;if(!b.parent.loadOnlyMaterials)if(j)Y.push(b.loadSceneAsync("/nodes",{nodes:j,index:-1}));else if(void 0!=b._gltf.scene||b._gltf.scenes&&b._gltf.scenes[0]){var I=P.Get("/scene",b._gltf.scenes,b._gltf.scene||0);Y.push(b.loadSceneAsync("/scenes/".concat(I.index),I))}if(!b.parent.skipMaterials&&b.parent.loadAllMaterials&&b._gltf.materials)for(var E=0;E<b._gltf.materials.length;++E){var s=b._gltf.materials[E],i="/materials/"+E,a=T.d.TriangleFillMode;Y.push(b._loadMaterialAsync(i,s,null,a,(function(){})))}return b._parent.compileMaterials&&Y.push(b._compileMaterialsAsync()),b._parent.compileShadowGenerators&&Y.push(b._compileShadowGeneratorsAsync()),Promise.all(Y).then((function(){return b._rootBabylonMesh&&b._rootBabylonMesh.setEnabled(!0),b._extensionsOnReady(),b._parent._setState(w.j.READY),b._startAnimations(),K()})).then((function(Z){return b._parent._endPerformanceCounter(g),O.d.SetImmediate((function(){b._disposed||Promise.all(b._completePromises).then((function(){b._parent._endPerformanceCounter(Q),b._parent._setState(w.j.COMPLETE),b._parent.onCompleteObservable.notifyObservers(void 0),b._parent.onCompleteObservable.clear(),b.dispose()}),(function(Z){b._parent.onErrorObservable.notifyObservers(Z),b._parent.onErrorObservable.clear(),b.dispose()}))})),Z}))})).catch((function(Z){throw b._disposed||(b._parent.onErrorObservable.notifyObservers(Z),b._parent.onErrorObservable.clear(),b.dispose()),Z}))},Z.prototype._loadData=function(Z){if(this._gltf=Z.json,this._setupData(),Z.bin){var M=this._gltf.buffers;if(M&&M[0]&&!M[0].uri){var j=M[0];(j.byteLength<Z.bin.byteLength-3||j.byteLength>Z.bin.byteLength)&&W.c.Warn("Binary buffer length (".concat(j.byteLength,") from JSON does not match chunk length (").concat(Z.bin.byteLength,")")),this._bin=Z.bin}else W.c.Warn("Unexpected BIN chunk")}},Z.prototype._setupData=function(){if(P.Assign(this._gltf.accessors),P.Assign(this._gltf.animations),P.Assign(this._gltf.buffers),P.Assign(this._gltf.bufferViews),P.Assign(this._gltf.cameras),P.Assign(this._gltf.images),P.Assign(this._gltf.materials),P.Assign(this._gltf.meshes),P.Assign(this._gltf.nodes),P.Assign(this._gltf.samplers),P.Assign(this._gltf.scenes),P.Assign(this._gltf.skins),P.Assign(this._gltf.textures),this._gltf.nodes){for(var Z={},M=0,j=this._gltf.nodes;M<j.length;M++){if((Y=j[M]).children)for(var K=0,b=Y.children;K<b.length;K++){Z[b[K]]=Y.index}}for(var g=this._createRootNode(),O=0,Q=this._gltf.nodes;O<Q.length;O++){var Y,I=Z[(Y=Q[O]).index];Y.parent=void 0===I?g:this._gltf.nodes[I]}}},Z.prototype._loadExtensions=function(){for(var M in Z._RegisteredExtensions){var j=Z._RegisteredExtensions[M].factory(this);j.name!==M&&W.c.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(j.name," !== ").concat(M)),this._extensions.push(j),this._parent.onExtensionLoadedObservable.notifyObservers(j)}this._extensions.sort((function(Z,M){return(Z.order||Number.MAX_VALUE)-(M.order||Number.MAX_VALUE)})),this._parent.onExtensionLoadedObservable.clear()},Z.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var Z=function(Z){if(!M._extensions.some((function(M){return M.name===Z&&M.enabled})))throw new Error("Require extension ".concat(Z," is not available"))},M=this,j=0,K=this._gltf.extensionsRequired;j<K.length;j++){Z(K[j])}},Z.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=!!this._assetContainer,this._rootBabylonMesh=new F.b("__root__",this._babylonScene),this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var M={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case w.f.AUTO:this._babylonScene.useRightHandedSystem||(M.rotation=[0,1,0,0],M.scale=[1,1,-1],Z._LoadTransform(M,this._rootBabylonMesh));break;case w.f.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),M},Z.prototype.loadSceneAsync=function(Z,M){var j=this,K=this._extensionsLoadSceneAsync(Z,M);if(K)return K;var b=new Array;if(this.logOpen("".concat(Z," ").concat(M.name||"")),M.nodes)for(var g=0,O=M.nodes;g<O.length;g++){var Q=O[g],Y=P.Get("".concat(Z,"/nodes/").concat(Q),this._gltf.nodes,Q);b.push(this.loadNodeAsync("/nodes/".concat(Y.index),Y,(function(Z){Z.parent=j._rootBabylonMesh})))}for(var I=0,E=this._postSceneLoadActions;I<E.length;I++){(0,E[I])()}return b.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(b).then((function(){}))},Z.prototype._forEachPrimitive=function(Z,M){if(Z._primitiveBabylonMeshes)for(var j=0,K=Z._primitiveBabylonMeshes;j<K.length;j++){M(K[j])}},Z.prototype._getGeometries=function(){var Z=new Array,M=this._gltf.nodes;if(M)for(var j=0,K=M;j<K.length;j++){var b=K[j];this._forEachPrimitive(b,(function(M){var j=M.geometry;j&&-1===Z.indexOf(j)&&Z.push(j)}))}return Z},Z.prototype._getMeshes=function(){var Z=new Array;this._rootBabylonMesh&&Z.push(this._rootBabylonMesh);var M=this._gltf.nodes;if(M)for(var j=0,K=M;j<K.length;j++){var b=K[j];this._forEachPrimitive(b,(function(M){Z.push(M)}))}return Z},Z.prototype._getTransformNodes=function(){var Z=new Array,M=this._gltf.nodes;if(M)for(var j=0,K=M;j<K.length;j++){var b=K[j];b._babylonTransformNode&&"TransformNode"===b._babylonTransformNode.getClassName()&&Z.push(b._babylonTransformNode),b._babylonTransformNodeForSkin&&Z.push(b._babylonTransformNodeForSkin)}return Z},Z.prototype._getSkeletons=function(){var Z=new Array,M=this._gltf.skins;if(M)for(var j=0,K=M;j<K.length;j++){var b=K[j];b._data&&Z.push(b._data.babylonSkeleton)}return Z},Z.prototype._getAnimationGroups=function(){var Z=new Array,M=this._gltf.animations;if(M)for(var j=0,K=M;j<K.length;j++){var b=K[j];b._babylonAnimationGroup&&Z.push(b._babylonAnimationGroup)}return Z},Z.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case w.e.NONE:break;case w.e.FIRST:0!==(Z=this._getAnimationGroups()).length&&Z[0].start(!0);break;case w.e.ALL:for(var Z,M=0,j=Z=this._getAnimationGroups();M<j.length;M++){j[M].start(!0)}break;default:return void W.c.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"))}},Z.prototype.loadNodeAsync=function(M,j,K){var b=this;void 0===K&&(K=function(){});var g=this._extensionsLoadNodeAsync(M,j,K);if(g)return g;if(j._babylonTransformNode)throw new Error("".concat(M,": Invalid recursive node hierarchy"));var O=new Array;this.logOpen("".concat(M," ").concat(j.name||""));var Q=function(g){if(Z.AddPointerMetadata(g,M),Z._LoadTransform(j,g),void 0!=j.camera){var Q=P.Get("".concat(M,"/camera"),b._gltf.cameras,j.camera);O.push(b.loadCameraAsync("/cameras/".concat(Q.index),Q,(function(Z){Z.parent=g})))}if(j.children)for(var Y=0,I=j.children;Y<I.length;Y++){var E=I[Y],s=P.Get("".concat(M,"/children/").concat(E),b._gltf.nodes,E);O.push(b.loadNodeAsync("/nodes/".concat(s.index),s,(function(Z){Z.parent=g})))}K(g)};if(void 0==j.mesh||void 0!=j.skin){var Y=j.name||"node".concat(j.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var I=new R.d(Y,this._babylonScene);I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==j.mesh?j._babylonTransformNode=I:j._babylonTransformNodeForSkin=I,Q(I)}if(void 0!=j.mesh)if(void 0==j.skin){var E=P.Get("".concat(M,"/mesh"),this._gltf.meshes,j.mesh);O.push(this._loadMeshAsync("/meshes/".concat(E.index),j,E,Q))}else{E=P.Get("".concat(M,"/mesh"),this._gltf.meshes,j.mesh);O.push(this._loadMeshAsync("/meshes/".concat(E.index),j,E,(function(Z){var K=j._babylonTransformNodeForSkin;Z.metadata=H(K.metadata,Z.metadata||{});var g=P.Get("".concat(M,"/skin"),b._gltf.skins,j.skin);O.push(b._loadSkinAsync("/skins/".concat(g.index),j,g,(function(M){b._forEachPrimitive(j,(function(Z){Z.skeleton=M})),b._postSceneLoadActions.push((function(){if(void 0!=g.skeleton){var M=P.Get("/skins/".concat(g.index,"/skeleton"),b._gltf.nodes,g.skeleton).parent;j.index===M.index?Z.parent=K.parent:Z.parent=M._babylonTransformNode}else Z.parent=b._rootBabylonMesh;b._parent.onSkinLoadedObservable.notifyObservers({node:K,skinnedNode:Z})}))})))})))}return this.logClose(),Promise.all(O).then((function(){return b._forEachPrimitive(j,(function(Z){Z.geometry&&Z.geometry.useBoundingInfoFromGeometry?Z._updateBoundingInfo():Z.refreshBoundingInfo(!0)})),j._babylonTransformNode}))},Z.prototype._loadMeshAsync=function(Z,M,j,K){var b=j.primitives;if(!b||!b.length)throw new Error("".concat(Z,": Primitives are missing"));void 0==b[0].index&&P.Assign(b);var g=new Array;this.logOpen("".concat(Z," ").concat(j.name||""));var O=M.name||"node".concat(M.index);if(1===b.length){var Q=j.primitives[0];g.push(this._loadMeshPrimitiveAsync("".concat(Z,"/primitives/").concat(Q.index),O,M,j,Q,(function(Z){M._babylonTransformNode=Z,M._primitiveBabylonMeshes=[Z]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,M._babylonTransformNode=new R.d(O,this._babylonScene),M._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M._primitiveBabylonMeshes=[];for(var Y=0,I=b;Y<I.length;Y++){Q=I[Y];g.push(this._loadMeshPrimitiveAsync("".concat(Z,"/primitives/").concat(Q.index),"".concat(O,"_primitive").concat(Q.index),M,j,Q,(function(Z){Z.parent=M._babylonTransformNode,M._primitiveBabylonMeshes.push(Z)})))}}return K(M._babylonTransformNode),this.logClose(),Promise.all(g).then((function(){return M._babylonTransformNode}))},Z.prototype._loadMeshPrimitiveAsync=function(M,j,K,b,g,O){var Q=this,Y=this._extensionsLoadMeshPrimitiveAsync(M,j,K,b,g,O);if(Y)return Y;this.logOpen("".concat(M));var I,E,s=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==K.skin&&!b.primitives[0].targets;if(s&&g._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,(I=g._instanceData.babylonSourceMesh.createInstance(j))._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E=g._instanceData.promise;else{var i=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;var a=new F.b(j,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?T.d.CounterClockWiseSideOrientation:T.d.ClockWiseSideOrientation,this._createMorphTargets(M,K,b,g,a),i.push(this._loadVertexDataAsync(M,g,a).then((function(Z){return Q._loadMorphTargetsAsync(M,g,a,Z).then((function(){Q._disposed||(Q._babylonScene._blockEntityCollection=!!Q._assetContainer,Z.applyToMesh(a),Z._parentContainer=Q._assetContainer,Q._babylonScene._blockEntityCollection=!1)}))})));var z=Z._GetDrawMode(M,g.mode);if(void 0==g.material){var V=this._defaultBabylonMaterialData[z];V||(V=this._createDefaultMaterial("__GLTFLoader._default",z),this._parent.onMaterialLoadedObservable.notifyObservers(V),this._defaultBabylonMaterialData[z]=V),a.material=V}else if(!this.parent.skipMaterials){var o=P.Get("".concat(M,"/material"),this._gltf.materials,g.material);i.push(this._loadMaterialAsync("/materials/".concat(o.index),o,a,z,(function(Z){a.material=Z})))}E=Promise.all(i),s&&(g._instanceData={babylonSourceMesh:a,promise:E}),I=a}return Z.AddPointerMetadata(I,M),this._parent.onMeshLoadedObservable.notifyObservers(I),O(I),this.logClose(),E.then((function(){return I}))},Z.prototype._loadVertexDataAsync=function(Z,M,j){var K=this,g=this._extensionsLoadVertexDataAsync(Z,M,j);if(g)return g;var O=M.attributes;if(!O)throw new Error("".concat(Z,": Attributes are missing"));var Q=new Array,Y=new u.e(j.name,this._babylonScene);if(void 0==M.indices)j.isUnIndexed=!0;else{var I=P.Get("".concat(Z,"/indices"),this._gltf.accessors,M.indices);Q.push(this._loadIndicesAccessorAsync("/accessors/".concat(I.index),I).then((function(Z){Y.setIndices(Z)})))}var E=function(M,g,I){if(void 0!=O[M]){j._delayInfo=j._delayInfo||[],-1===j._delayInfo.indexOf(g)&&j._delayInfo.push(g);var E=P.Get("".concat(Z,"/attributes/").concat(M),K._gltf.accessors,O[M]);Q.push(K._loadVertexAccessorAsync("/accessors/".concat(E.index),E,g).then((function(Z){if(Z.getKind()===e.f.PositionKind&&!K.parent.alwaysComputeBoundingBox&&!j.skeleton){var M=E.min,g=E.max;if(void 0!==M&&void 0!==g){if(E.normalized&&5126!==E.componentType){var O=1;switch(E.componentType){case 5120:O=127;break;case 5121:O=255;break;case 5122:O=32767;break;case 5123:O=65535}for(var Q=0;Q<3;++Q)M[Q]=Math.max(M[Q]/O,-1),g[Q]=Math.max(g[Q]/O,-1)}var I=b.e.Vector3[0],s=b.e.Vector3[1];I.copyFromFloats.apply(I,M),s.copyFromFloats.apply(s,g),Y._boundingInfo=new J.c(I,s),Y.useBoundingInfoFromGeometry=!0}}Y.setVerticesBuffer(Z,E.count)}))),g==e.f.MatricesIndicesExtraKind&&(j.numBoneInfluencers=8),I&&I(E)}};return E("POSITION",e.f.PositionKind),E("NORMAL",e.f.NormalKind),E("TANGENT",e.f.TangentKind),E("TEXCOORD_0",e.f.UVKind),E("TEXCOORD_1",e.f.UV2Kind),E("TEXCOORD_2",e.f.UV3Kind),E("TEXCOORD_3",e.f.UV4Kind),E("TEXCOORD_4",e.f.UV5Kind),E("TEXCOORD_5",e.f.UV6Kind),E("JOINTS_0",e.f.MatricesIndicesKind),E("WEIGHTS_0",e.f.MatricesWeightsKind),E("JOINTS_1",e.f.MatricesIndicesExtraKind),E("WEIGHTS_1",e.f.MatricesWeightsExtraKind),E("COLOR_0",e.f.ColorKind,(function(Z){"VEC4"===Z.type&&(j.hasVertexAlpha=!0)})),Promise.all(Q).then((function(){return Y}))},Z.prototype._createMorphTargets=function(Z,M,j,K,b){if(K.targets){if(void 0==M._numMorphTargets)M._numMorphTargets=K.targets.length;else if(K.targets.length!==M._numMorphTargets)throw new Error("".concat(Z,": Primitives do not have the same number of targets"));var g=j.extras?j.extras.targetNames:null;b.morphTargetManager=new h(b.getScene()),b.morphTargetManager.areUpdatesFrozen=!0;for(var O=0;O<K.targets.length;O++){var Q=M.weights?M.weights[O]:j.weights?j.weights[O]:0,Y=g?g[O]:"morphTarget".concat(O);b.morphTargetManager.addTarget(new C(Y,Q,b.getScene()))}}},Z.prototype._loadMorphTargetsAsync=function(Z,M,j,K){if(!M.targets)return Promise.resolve();for(var b=new Array,g=j.morphTargetManager,O=0;O<g.numTargets;O++){var Q=g.getTarget(O);b.push(this._loadMorphTargetVertexDataAsync("".concat(Z,"/targets/").concat(O),K,M.targets[O],Q))}return Promise.all(b).then((function(){g.areUpdatesFrozen=!1}))},Z.prototype._loadMorphTargetVertexDataAsync=function(Z,M,j,K){var b=this,g=new Array,O=function(K,O,Q){if(void 0!=j[K]){var Y=M.getVertexBuffer(O);if(Y){var I=P.Get("".concat(Z,"/").concat(K),b._gltf.accessors,j[K]);g.push(b._loadFloatAccessorAsync("/accessors/".concat(I.index),I).then((function(Z){Q(Y,Z)})))}}};return O("POSITION",e.f.PositionKind,(function(Z,M){var j=new Float32Array(M.length);Z.forEach(M.length,(function(Z,K){j[K]=M[K]+Z})),K.setPositions(j)})),O("NORMAL",e.f.NormalKind,(function(Z,M){var j=new Float32Array(M.length);Z.forEach(j.length,(function(Z,K){j[K]=M[K]+Z})),K.setNormals(j)})),O("TANGENT",e.f.TangentKind,(function(Z,M){var j=new Float32Array(M.length/3*4),b=0;Z.forEach(M.length/3*4,(function(Z,K){(K+1)%4!==0&&(j[b]=M[b]+Z,b++)})),K.setTangents(j)})),Promise.all(g).then((function(){}))},Z._LoadTransform=function(Z,M){if(void 0==Z.skin){var j=b.k.Zero(),K=b.d.Identity(),g=b.k.One();if(Z.matrix)b.c.FromArray(Z.matrix).decompose(g,K,j);else Z.translation&&(j=b.k.FromArray(Z.translation)),Z.rotation&&(K=b.d.FromArray(Z.rotation)),Z.scale&&(g=b.k.FromArray(Z.scale));M.position=j,M.rotationQuaternion=K,M.scaling=g}},Z.prototype._loadSkinAsync=function(Z,M,j,K){var b=this,g=this._extensionsLoadSkinAsync(Z,M,j);if(g)return g;if(j._data)return K(j._data.babylonSkeleton),j._data.promise;var O="skeleton".concat(j.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var Q=new q(j.name||O,O,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(Z,j,Q);var Y=this._loadSkinInverseBindMatricesDataAsync(Z,j).then((function(Z){b._updateBoneMatrices(Q,Z)}));return j._data={babylonSkeleton:Q,promise:Y},K(Q),Y},Z.prototype._loadBones=function(Z,M,j){if(void 0==M.skeleton||this._parent.alwaysComputeSkeletonRootNode){var K=this._findSkeletonRootNode("".concat(Z,"/joints"),M.joints);if(K)if(void 0===M.skeleton)M.skeleton=K.index;else{var b=P.Get("".concat(Z,"/skeleton"),this._gltf.nodes,M.skeleton);b===K||function(Z,M){for(;M.parent;M=M.parent)if(M.parent===Z)return!0;return!1}(b,K)||(W.c.Warn("".concat(Z,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),M.skeleton=K.index)}else W.c.Warn("".concat(Z,": Failed to find common root"))}for(var g={},O=0,Q=M.joints;O<Q.length;O++){var Y=Q[O],I=P.Get("".concat(Z,"/joints/").concat(Y),this._gltf.nodes,Y);this._loadBone(I,M,j,g)}},Z.prototype._findSkeletonRootNode=function(Z,M){if(0===M.length)return null;for(var j={},K=0,b=M;K<b.length;K++){for(var g=b[K],O=new Array,Q=P.Get("".concat(Z,"/").concat(g),this._gltf.nodes,g);-1!==Q.index;)O.unshift(Q),Q=Q.parent;j[g]=O}for(var Y=null,I=0;;++I){if(I>=(O=j[M[0]]).length)return Y;Q=O[I];for(var E=1;E<M.length;++E)if(I>=(O=j[M[E]]).length||Q!==O[I])return Y;Y=Q}},Z.prototype._loadBone=function(Z,M,j,K){var b=K[Z.index];if(b)return b;var g=null;Z.index!==M.skeleton&&(Z.parent&&-1!==Z.parent.index?g=this._loadBone(Z.parent,M,j,K):void 0!==M.skeleton&&W.c.Warn("/skins/".concat(M.index,"/skeleton: Skeleton node is not a common root")));var O=M.joints.indexOf(Z.index);return b=new f(Z.name||"joint".concat(Z.index),j,g,this._getNodeMatrix(Z),null,null,O),K[Z.index]=b,this._postSceneLoadActions.push((function(){b.linkTransformNode(Z._babylonTransformNode)})),b},Z.prototype._loadSkinInverseBindMatricesDataAsync=function(Z,M){if(void 0==M.inverseBindMatrices)return Promise.resolve(null);var j=P.Get("".concat(Z,"/inverseBindMatrices"),this._gltf.accessors,M.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(j.index),j)},Z.prototype._updateBoneMatrices=function(Z,M){for(var j=0,K=Z.bones;j<K.length;j++){var g=K[j],O=b.c.Identity(),Q=g._index;M&&-1!==Q&&(b.c.FromArrayToRef(M,16*Q,O),O.invertToRef(O));var Y=g.getParent();Y&&O.multiplyToRef(Y.getInvertedAbsoluteTransform(),O),g.updateMatrix(O,!1,!1),g._updateDifferenceMatrix(void 0,!1)}},Z.prototype._getNodeMatrix=function(Z){return Z.matrix?b.c.FromArray(Z.matrix):b.c.Compose(Z.scale?b.k.FromArray(Z.scale):b.k.One(),Z.rotation?b.d.FromArray(Z.rotation):b.d.Identity(),Z.translation?b.k.FromArray(Z.translation):b.k.Zero())},Z.prototype.loadCameraAsync=function(M,j,K){void 0===K&&(K=function(){});var g=this._extensionsLoadCameraAsync(M,j,K);if(g)return g;var O=new Array;this.logOpen("".concat(M," ").concat(j.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;var I=new Y.d(j.name||"camera".concat(j.index),b.k.Zero(),this._babylonScene,!1);switch(I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I.ignoreParentScaling=!0,I.rotation=new b.k(0,Math.PI,0),j.type){case"perspective":var E=j.perspective;if(!E)throw new Error("".concat(M,": Camera perspective properties are missing"));I.fov=E.yfov,I.minZ=E.znear,I.maxZ=E.zfar||0;break;case"orthographic":if(!j.orthographic)throw new Error("".concat(M,": Camera orthographic properties are missing"));I.mode=Q.e.ORTHOGRAPHIC_CAMERA,I.orthoLeft=-j.orthographic.xmag,I.orthoRight=j.orthographic.xmag,I.orthoBottom=-j.orthographic.ymag,I.orthoTop=j.orthographic.ymag,I.minZ=j.orthographic.znear,I.maxZ=j.orthographic.zfar;break;default:throw new Error("".concat(M,": Invalid camera type (").concat(j.type,")"))}return Z.AddPointerMetadata(I,M),this._parent.onCameraLoadedObservable.notifyObservers(I),K(I),this.logClose(),Promise.all(O).then((function(){return I}))},Z.prototype._loadAnimationsAsync=function(){var Z=this._gltf.animations;if(!Z)return Promise.resolve();for(var M=new Array,j=0;j<Z.length;j++){var K=Z[j];M.push(this.loadAnimationAsync("/animations/".concat(K.index),K).then((function(Z){0===Z.targetedAnimations.length&&Z.dispose()})))}return Promise.all(M).then((function(){}))},Z.prototype.loadAnimationAsync=function(Z,M){var j=this._extensionsLoadAnimationAsync(Z,M);if(j)return j;this._babylonScene._blockEntityCollection=!!this._assetContainer;var K=new z(M.name||"animation".concat(M.index),this._babylonScene);K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M._babylonAnimationGroup=K;var b=new Array;P.Assign(M.channels),P.Assign(M.samplers);for(var g=0,O=M.channels;g<O.length;g++){var Q=O[g];b.push(this._loadAnimationChannelAsync("".concat(Z,"/channels/").concat(Q.index),Z,M,Q,K))}return Promise.all(b).then((function(){return K.normalize(0),K}))},Z.prototype._loadAnimationChannelAsync=function(Z,M,j,K,g,O){var Q=this;if(void 0===O&&(O=null),void 0==K.target.node)return Promise.resolve();var Y=P.Get("".concat(Z,"/target/node"),this._gltf.nodes,K.target.node);if("weights"===K.target.path&&!Y._numMorphTargets||"weights"!==K.target.path&&!Y._babylonTransformNode)return Promise.resolve();var E=P.Get("".concat(Z,"/sampler"),j.samplers,K.sampler);return this._loadAnimationSamplerAsync("".concat(M,"/samplers/").concat(K.sampler),E).then((function(M){var j,E;switch(K.target.path){case"translation":j="position",E=I.c.ANIMATIONTYPE_VECTOR3;break;case"rotation":j="rotationQuaternion",E=I.c.ANIMATIONTYPE_QUATERNION;break;case"scale":j="scaling",E=I.c.ANIMATIONTYPE_VECTOR3;break;case"weights":j="influence",E=I.c.ANIMATIONTYPE_FLOAT;break;default:throw new Error("".concat(Z,"/target/path: Invalid value (").concat(K.target.path,")"))}var s,i,a=0;switch(j){case"position":s=function(Z){var j=b.k.FromArray(M.output,a).scaleInPlace(Z);return a+=3,j};break;case"rotationQuaternion":s=function(Z){var j=b.d.FromArray(M.output,a).scaleInPlace(Z);return a+=4,j};break;case"scaling":s=function(Z){var j=b.k.FromArray(M.output,a).scaleInPlace(Z);return a+=3,j};break;case"influence":s=function(Z){for(var j=new Array(Y._numMorphTargets),K=0;K<Y._numMorphTargets;K++)j[K]=M.output[a++]*Z;return j}}switch(M.interpolation){case"STEP":i=function(Z){return{frame:M.input[Z]*Q.parent.targetFps,value:s(1),interpolation:p.d.STEP}};break;case"LINEAR":i=function(Z){return{frame:M.input[Z]*Q.parent.targetFps,value:s(1)}};break;case"CUBICSPLINE":var z=1/Q.parent.targetFps;i=function(Z){return{frame:M.input[Z]*Q.parent.targetFps,inTangent:s(z),value:s(1),outTangent:s(z)}}}for(var V=new Array(M.input.length),o=0;o<M.input.length;o++)V[o]=i(o);if("influence"===j)for(var c=function(Z){var M="".concat(g.name,"_channel").concat(g.targetedAnimations.length),K=new I.c(M,j,Q.parent.targetFps,E);K.setKeys(V.map((function(M){return{frame:M.frame,inTangent:M.inTangent?M.inTangent[Z]:void 0,value:M.value[Z],outTangent:M.outTangent?M.outTangent[Z]:void 0,interpolation:M.interpolation}}))),Q._forEachPrimitive(Y,(function(M){var j=M;if(j.morphTargetManager){var b=j.morphTargetManager.getTarget(Z),O=K.clone();b.animations.push(O),g.addTargetedAnimation(O,b)}}))},G=0;G<Y._numMorphTargets;G++)c(G);else{var f="".concat(g.name,"_channel").concat(g.targetedAnimations.length),X=new I.c(f,j,Q.parent.targetFps,E);X.setKeys(V),null!=O&&null!=O.animations?(O.animations.push(X),g.addTargetedAnimation(X,O)):(Y._babylonTransformNode.animations.push(X),g.addTargetedAnimation(X,Y._babylonTransformNode))}}))},Z.prototype._loadAnimationSamplerAsync=function(Z,M){if(M._data)return M._data;var j=M.interpolation||"LINEAR";switch(j){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(Z,"/interpolation: Invalid value (").concat(M.interpolation,")"))}var K=P.Get("".concat(Z,"/input"),this._gltf.accessors,M.input),b=P.Get("".concat(Z,"/output"),this._gltf.accessors,M.output);return M._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(K.index),K),this._loadFloatAccessorAsync("/accessors/".concat(b.index),b)]).then((function(Z){var M=Z[0],K=Z[1];return{input:M,interpolation:j,output:K}})),M._data},Z.prototype.loadBufferAsync=function(Z,M,j,K){var b=this._extensionsLoadBufferAsync(Z,M,j,K);if(b)return b;if(!M._data)if(M.uri)M._data=this.loadUriAsync("".concat(Z,"/uri"),M,M.uri);else{if(!this._bin)throw new Error("".concat(Z,": Uri is missing or the binary glTF is missing its binary chunk"));M._data=this._bin.readAsync(0,M.byteLength)}return M._data.then((function(M){try{return new Uint8Array(M.buffer,M.byteOffset+j,K)}catch(M){throw new Error("".concat(Z,": ").concat(M.message))}}))},Z.prototype.loadBufferViewAsync=function(Z,M){var j=this._extensionsLoadBufferViewAsync(Z,M);if(j)return j;if(M._data)return M._data;var K=P.Get("".concat(Z,"/buffer"),this._gltf.buffers,M.buffer);return M._data=this.loadBufferAsync("/buffers/".concat(K.index),K,M.byteOffset||0,M.byteLength),M._data},Z.prototype._loadAccessorAsync=function(M,j,K){var b=this;if(j._data)return j._data;var g=Z._GetNumComponents(M,j.type),O=g*e.f.GetTypeByteLength(j.componentType),Q=g*j.count;if(void 0==j.bufferView)j._data=Promise.resolve(new K(Q));else{var Y=P.Get("".concat(M,"/bufferView"),this._gltf.bufferViews,j.bufferView);j._data=this.loadBufferViewAsync("/bufferViews/".concat(Y.index),Y).then((function(b){if(5126!==j.componentType||j.normalized||Y.byteStride&&Y.byteStride!==O){var I=new K(Q);return e.f.ForEach(b,j.byteOffset||0,Y.byteStride||O,g,j.componentType,I.length,j.normalized||!1,(function(Z,M){I[M]=Z})),I}return Z._GetTypedArray(M,j.componentType,b,j.byteOffset,Q)}))}if(j.sparse){var I=j.sparse;j._data=j._data.then((function(Q){var Y=Q,E=P.Get("".concat(M,"/sparse/indices/bufferView"),b._gltf.bufferViews,I.indices.bufferView),s=P.Get("".concat(M,"/sparse/values/bufferView"),b._gltf.bufferViews,I.values.bufferView);return Promise.all([b.loadBufferViewAsync("/bufferViews/".concat(E.index),E),b.loadBufferViewAsync("/bufferViews/".concat(s.index),s)]).then((function(b){var Q,E=b[0],s=b[1],i=Z._GetTypedArray("".concat(M,"/sparse/indices"),I.indices.componentType,E,I.indices.byteOffset,I.count),a=g*I.count;if(5126!==j.componentType||j.normalized){var z=Z._GetTypedArray("".concat(M,"/sparse/values"),j.componentType,s,I.values.byteOffset,a);Q=new K(a),e.f.ForEach(z,0,O,g,j.componentType,Q.length,j.normalized||!1,(function(Z,M){Q[M]=Z}))}else Q=Z._GetTypedArray("".concat(M,"/sparse/values"),j.componentType,s,I.values.byteOffset,a);for(var V=0,o=0;o<i.length;o++)for(var c=i[o]*g,G=0;G<g;G++)Y[c++]=Q[V++];return Y}))}))}return j._data},Z.prototype._loadFloatAccessorAsync=function(Z,M){return this._loadAccessorAsync(Z,M,Float32Array)},Z.prototype._loadIndicesAccessorAsync=function(M,j){if("SCALAR"!==j.type)throw new Error("".concat(M,"/type: Invalid value ").concat(j.type));if(5121!==j.componentType&&5123!==j.componentType&&5125!==j.componentType)throw new Error("".concat(M,"/componentType: Invalid value ").concat(j.componentType));if(j._data)return j._data;if(j.sparse){var K=Z._GetTypedArrayConstructor("".concat(M,"/componentType"),j.componentType);j._data=this._loadAccessorAsync(M,j,K)}else{var b=P.Get("".concat(M,"/bufferView"),this._gltf.bufferViews,j.bufferView);j._data=this.loadBufferViewAsync("/bufferViews/".concat(b.index),b).then((function(K){return Z._GetTypedArray(M,j.componentType,K,j.byteOffset,j.count)}))}return j._data},Z.prototype._loadVertexBufferViewAsync=function(Z){if(Z._babylonBuffer)return Z._babylonBuffer;var M=this._babylonScene.getEngine();return Z._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(Z.index),Z).then((function(Z){return new e.e(M,Z,!1)})),Z._babylonBuffer},Z.prototype._loadVertexAccessorAsync=function(M,j,K){var b;if(null===(b=j._babylonVertexBuffer)||void 0===b?void 0:b[K])return j._babylonVertexBuffer[K];j._babylonVertexBuffer||(j._babylonVertexBuffer={});var g=this._babylonScene.getEngine();if(j.sparse)j._babylonVertexBuffer[K]=this._loadFloatAccessorAsync(M,j).then((function(Z){return new e.f(g,Z,K,!1)}));else if(K===e.f.MatricesIndicesKind||K===e.f.MatricesIndicesExtraKind)j._babylonVertexBuffer[K]=this._loadFloatAccessorAsync(M,j).then((function(Z){return new e.f(g,Z,K,!1)}));else{var O=P.Get("".concat(M,"/bufferView"),this._gltf.bufferViews,j.bufferView);j._babylonVertexBuffer[K]=this._loadVertexBufferViewAsync(O).then((function(b){var Q=Z._GetNumComponents(M,j.type);return new e.f(g,b,K,!1,!1,O.byteStride,!1,j.byteOffset,Q,j.componentType,j.normalized,!0,1,!0)}))}return j._babylonVertexBuffer[K]},Z.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(Z,M,j){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));var K=new Array;return M&&(M.baseColorFactor?(j.albedoColor=g.e.FromArray(M.baseColorFactor),j.alpha=M.baseColorFactor[3]):j.albedoColor=g.e.White(),j.metallic=void 0==M.metallicFactor?1:M.metallicFactor,j.roughness=void 0==M.roughnessFactor?1:M.roughnessFactor,M.baseColorTexture&&K.push(this.loadTextureInfoAsync("".concat(Z,"/baseColorTexture"),M.baseColorTexture,(function(Z){Z.name="".concat(j.name," (Base Color)"),j.albedoTexture=Z}))),M.metallicRoughnessTexture&&(M.metallicRoughnessTexture.nonColorData=!0,K.push(this.loadTextureInfoAsync("".concat(Z,"/metallicRoughnessTexture"),M.metallicRoughnessTexture,(function(Z){Z.name="".concat(j.name," (Metallic Roughness)"),j.metallicTexture=Z}))),j.useMetallnessFromMetallicTextureBlue=!0,j.useRoughnessFromMetallicTextureGreen=!0,j.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(K).then((function(){}))},Z.prototype._loadMaterialAsync=function(M,j,K,b,g){void 0===g&&(g=function(){});var O=this._extensionsLoadMaterialAsync(M,j,K,b,g);if(O)return O;j._data=j._data||{};var Q=j._data[b];if(!Q){this.logOpen("".concat(M," ").concat(j.name||""));var Y=this.createMaterial(M,j,b);Q={babylonMaterial:Y,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(M,j,Y)},j._data[b]=Q,Z.AddPointerMetadata(Y,M),this._parent.onMaterialLoadedObservable.notifyObservers(Y),this.logClose()}return K&&(Q.babylonMeshes.push(K),K.onDisposeObservable.addOnce((function(){var Z=Q.babylonMeshes.indexOf(K);-1!==Z&&Q.babylonMeshes.splice(Z,1)}))),g(Q.babylonMaterial),Q.promise.then((function(){return Q.babylonMaterial}))},Z.prototype._createDefaultMaterial=function(Z,M){this._babylonScene._blockEntityCollection=!!this._assetContainer;var j=new k(Z,this._babylonScene);return j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j.fillMode=M,j.enableSpecularAntiAliasing=!0,j.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,j.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,j.transparencyMode=k.PBRMATERIAL_OPAQUE,j.metallic=1,j.roughness=1,j},Z.prototype.createMaterial=function(Z,M,j){var K=this._extensionsCreateMaterial(Z,M,j);if(K)return K;var b=M.name||"material".concat(M.index);return this._createDefaultMaterial(b,j)},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this._extensionsLoadMaterialPropertiesAsync(Z,M,j);if(K)return K;var b=new Array;return b.push(this.loadMaterialBasePropertiesAsync(Z,M,j)),M.pbrMetallicRoughness&&b.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(Z,"/pbrMetallicRoughness"),M.pbrMetallicRoughness,j)),this.loadMaterialAlphaProperties(Z,M,j),Promise.all(b).then((function(){}))},Z.prototype.loadMaterialBasePropertiesAsync=function(Z,M,j){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));var K=new Array;return j.emissiveColor=M.emissiveFactor?g.e.FromArray(M.emissiveFactor):new g.e(0,0,0),M.doubleSided&&(j.backFaceCulling=!1,j.twoSidedLighting=!0),M.normalTexture&&(M.normalTexture.nonColorData=!0,K.push(this.loadTextureInfoAsync("".concat(Z,"/normalTexture"),M.normalTexture,(function(Z){Z.name="".concat(j.name," (Normal)"),j.bumpTexture=Z}))),j.invertNormalMapX=!this._babylonScene.useRightHandedSystem,j.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=M.normalTexture.scale&&j.bumpTexture&&(j.bumpTexture.level=M.normalTexture.scale),j.forceIrradianceInFragment=!0),M.occlusionTexture&&(M.occlusionTexture.nonColorData=!0,K.push(this.loadTextureInfoAsync("".concat(Z,"/occlusionTexture"),M.occlusionTexture,(function(Z){Z.name="".concat(j.name," (Occlusion)"),j.ambientTexture=Z}))),j.useAmbientInGrayScale=!0,void 0!=M.occlusionTexture.strength&&(j.ambientTextureStrength=M.occlusionTexture.strength)),M.emissiveTexture&&K.push(this.loadTextureInfoAsync("".concat(Z,"/emissiveTexture"),M.emissiveTexture,(function(Z){Z.name="".concat(j.name," (Emissive)"),j.emissiveTexture=Z}))),Promise.all(K).then((function(){}))},Z.prototype.loadMaterialAlphaProperties=function(Z,M,j){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));switch(M.alphaMode||"OPAQUE"){case"OPAQUE":j.transparencyMode=k.PBRMATERIAL_OPAQUE;break;case"MASK":j.transparencyMode=k.PBRMATERIAL_ALPHATEST,j.alphaCutOff=void 0==M.alphaCutoff?.5:M.alphaCutoff,j.albedoTexture&&(j.albedoTexture.hasAlpha=!0);break;case"BLEND":j.transparencyMode=k.PBRMATERIAL_ALPHABLEND,j.albedoTexture&&(j.albedoTexture.hasAlpha=!0,j.useAlphaFromAlbedoTexture=!0);break;default:throw new Error("".concat(Z,"/alphaMode: Invalid value (").concat(M.alphaMode,")"))}},Z.prototype.loadTextureInfoAsync=function(M,j,K){var b=this;void 0===K&&(K=function(){});var g=this._extensionsLoadTextureInfoAsync(M,j,K);if(g)return g;if(this.logOpen("".concat(M)),j.texCoord>=6)throw new Error("".concat(M,"/texCoord: Invalid value (").concat(j.texCoord,")"));var O=P.Get("".concat(M,"/index"),this._gltf.textures,j.index);O._textureInfo=j;var Q=this._loadTextureAsync("/textures/".concat(j.index),O,(function(g){g.coordinatesIndex=j.texCoord||0,Z.AddPointerMetadata(g,M),b._parent.onTextureLoadedObservable.notifyObservers(g),K(g)}));return this.logClose(),Q},Z.prototype._loadTextureAsync=function(M,j,K){void 0===K&&(K=function(){});var b=this._extensionsLoadTextureAsync(M,j,K);if(b)return b;this.logOpen("".concat(M," ").concat(j.name||""));var g=void 0==j.sampler?Z.DefaultSampler:P.Get("".concat(M,"/sampler"),this._gltf.samplers,j.sampler),O=P.Get("".concat(M,"/source"),this._gltf.images,j.source),Q=this._createTextureAsync(M,g,O,K,void 0,!j._textureInfo.nonColorData);return this.logClose(),Q},Z.prototype._createTextureAsync=function(Z,M,j,b,g,O){var Q=this;void 0===b&&(b=function(){});var Y=this._loadSampler("/samplers/".concat(M.index),M),I=new Array,E=new K;this._babylonScene._blockEntityCollection=!!this._assetContainer;var s={noMipmap:Y.noMipMaps,invertY:!1,samplingMode:Y.samplingMode,onLoad:function(){Q._disposed||E.resolve()},onError:function(M,j){Q._disposed||E.reject(new Error("".concat(Z,": ").concat(j&&j.message?j.message:M||"Failed to load texture")))},mimeType:j.mimeType,loaderOptions:g,useSRGBBuffer:!!O&&this._parent.useSRGBBuffers},i=new x.b(null,this._babylonScene,s);return i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I.push(E.promise),I.push(this.loadImageAsync("/images/".concat(j.index),j).then((function(Z){var M=j.uri||"".concat(Q._fileName,"#image").concat(j.index),K="data:".concat(Q._uniqueRootUrl).concat(M);i.updateURL(K,Z)}))),i.wrapU=Y.wrapU,i.wrapV=Y.wrapV,b(i),Promise.all(I).then((function(){return i}))},Z.prototype._loadSampler=function(M,j){return j._data||(j._data={noMipMaps:9728===j.minFilter||9729===j.minFilter,samplingMode:Z._GetTextureSamplingMode(M,j),wrapU:Z._GetTextureWrapMode("".concat(M,"/wrapS"),j.wrapS),wrapV:Z._GetTextureWrapMode("".concat(M,"/wrapT"),j.wrapT)}),j._data},Z.prototype.loadImageAsync=function(Z,M){if(!M._data){if(this.logOpen("".concat(Z," ").concat(M.name||"")),M.uri)M._data=this.loadUriAsync("".concat(Z,"/uri"),M,M.uri);else{var j=P.Get("".concat(Z,"/bufferView"),this._gltf.bufferViews,M.bufferView);M._data=this.loadBufferViewAsync("/bufferViews/".concat(j.index),j)}this.logClose()}return M._data},Z.prototype.loadUriAsync=function(M,j,K){var b=this,g=this._extensionsLoadUriAsync(M,j,K);if(g)return g;if(!Z._ValidateUri(K))throw new Error("".concat(M,": '").concat(K,"' is invalid"));if((0,m.e)(K)){var O=new Uint8Array((0,m.b)(K));return this.log("".concat(M,": Decoded ").concat(K.substr(0,64),"... (").concat(O.length," bytes)")),Promise.resolve(O)}return this.log("".concat(M,": Loading ").concat(K)),this._parent.preprocessUrlAsync(this._rootUrl+K).then((function(Z){return new Promise((function(j,g){b._parent._loadFile(b._babylonScene,Z,(function(Z){b._disposed||(b.log("".concat(M,": Loaded ").concat(K," (").concat(Z.byteLength," bytes)")),j(new Uint8Array(Z)))}),!0,(function(Z){g(new m.g("".concat(M,": Failed to load '").concat(K,"'").concat(Z?": "+Z.status+" "+Z.statusText:""),Z))}))}))}))},Z.AddPointerMetadata=function(Z,M){var j=Z.metadata=Z.metadata||{},K=j.gltf=j.gltf||{};(K.pointers=K.pointers||[]).push(M)},Z._GetTextureWrapMode=function(Z,M){switch(M=void 0==M?10497:M){case 33071:return x.b.CLAMP_ADDRESSMODE;case 33648:return x.b.MIRROR_ADDRESSMODE;case 10497:return x.b.WRAP_ADDRESSMODE;default:return W.c.Warn("".concat(Z,": Invalid value (").concat(M,")")),x.b.WRAP_ADDRESSMODE}},Z._GetTextureSamplingMode=function(Z,M){var j=void 0==M.magFilter?9729:M.magFilter,K=void 0==M.minFilter?9987:M.minFilter;if(9729===j)switch(K){case 9728:return x.b.LINEAR_NEAREST;case 9729:return x.b.LINEAR_LINEAR;case 9984:return x.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return x.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return x.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return x.b.LINEAR_LINEAR_MIPLINEAR;default:return W.c.Warn("".concat(Z,"/minFilter: Invalid value (").concat(K,")")),x.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==j&&W.c.Warn("".concat(Z,"/magFilter: Invalid value (").concat(j,")")),K){case 9728:return x.b.NEAREST_NEAREST;case 9729:return x.b.NEAREST_LINEAR;case 9984:return x.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return x.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return x.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return x.b.NEAREST_LINEAR_MIPLINEAR;default:return W.c.Warn("".concat(Z,"/minFilter: Invalid value (").concat(K,")")),x.b.NEAREST_NEAREST_MIPNEAREST}},Z._GetTypedArrayConstructor=function(Z,M){switch(M){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("".concat(Z,": Invalid component type ").concat(M))}},Z._GetTypedArray=function(M,j,K,b,g){var O=K.buffer;b=K.byteOffset+(b||0);var Q=Z._GetTypedArrayConstructor("".concat(M,"/componentType"),j),Y=e.f.GetTypeByteLength(j);return b%Y!==0?(W.c.Warn("".concat(M,": Copying buffer as byte offset (").concat(b,") is not a multiple of component type byte length (").concat(Y,")")),new Q(O.slice(b,b+g*Y),0)):new Q(O,b,g)},Z._GetNumComponents=function(Z,M){switch(M){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(Z,": Invalid type (").concat(M,")"))},Z._ValidateUri=function(Z){return O.d.IsBase64(Z)||-1===Z.indexOf("..")},Z._GetDrawMode=function(Z,M){switch(void 0==M&&(M=4),M){case 0:return T.d.PointListDrawMode;case 1:return T.d.LineListDrawMode;case 2:return T.d.LineLoopDrawMode;case 3:return T.d.LineStripDrawMode;case 4:return T.d.TriangleFillMode;case 5:return T.d.TriangleStripDrawMode;case 6:return T.d.TriangleFanDrawMode}throw new Error("".concat(Z,": Invalid mesh primitive mode (").concat(M,")"))},Z.prototype._compileMaterialsAsync=function(){var Z=this;this._parent._startPerformanceCounter("Compile materials");var M=new Array;if(this._gltf.materials)for(var j=0,K=this._gltf.materials;j<K.length;j++){var b=K[j];if(b._data)for(var g in b._data)for(var O=b._data[g],Q=0,Y=O.babylonMeshes;Q<Y.length;Q++){var I=Y[Q];I.computeWorldMatrix(!0);var E=O.babylonMaterial;M.push(E.forceCompilationAsync(I)),M.push(E.forceCompilationAsync(I,{useInstances:!0})),this._parent.useClipPlane&&(M.push(E.forceCompilationAsync(I,{clipPlane:!0})),M.push(E.forceCompilationAsync(I,{clipPlane:!0,useInstances:!0})))}}return Promise.all(M).then((function(){Z._parent._endPerformanceCounter("Compile materials")}))},Z.prototype._compileShadowGeneratorsAsync=function(){var Z=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var M=new Array,j=0,K=this._babylonScene.lights;j<K.length;j++){var b=K[j].getShadowGenerator();b&&M.push(b.forceCompilationAsync())}return Promise.all(M).then((function(){Z._parent._endPerformanceCounter("Compile shadow generators")}))},Z.prototype._forEachExtensions=function(Z){for(var M=0,j=this._extensions;M<j.length;M++){var K=j[M];K.enabled&&Z(K)}},Z.prototype._applyExtensions=function(Z,M,j){for(var K=0,b=this._extensions;K<b.length;K++){var g=b[K];if(g.enabled){var O="".concat(g.name,".").concat(M),Q=Z;Q._activeLoaderExtensionFunctions=Q._activeLoaderExtensionFunctions||{};var Y=Q._activeLoaderExtensionFunctions;if(!Y[O]){Y[O]=!0;try{var I=j(g);if(I)return I}finally{delete Y[O]}}}}return null},Z.prototype._extensionsOnLoading=function(){this._forEachExtensions((function(Z){return Z.onLoading&&Z.onLoading()}))},Z.prototype._extensionsOnReady=function(){this._forEachExtensions((function(Z){return Z.onReady&&Z.onReady()}))},Z.prototype._extensionsLoadSceneAsync=function(Z,M){return this._applyExtensions(M,"loadScene",(function(j){return j.loadSceneAsync&&j.loadSceneAsync(Z,M)}))},Z.prototype._extensionsLoadNodeAsync=function(Z,M,j){return this._applyExtensions(M,"loadNode",(function(K){return K.loadNodeAsync&&K.loadNodeAsync(Z,M,j)}))},Z.prototype._extensionsLoadCameraAsync=function(Z,M,j){return this._applyExtensions(M,"loadCamera",(function(K){return K.loadCameraAsync&&K.loadCameraAsync(Z,M,j)}))},Z.prototype._extensionsLoadVertexDataAsync=function(Z,M,j){return this._applyExtensions(M,"loadVertexData",(function(K){return K._loadVertexDataAsync&&K._loadVertexDataAsync(Z,M,j)}))},Z.prototype._extensionsLoadMeshPrimitiveAsync=function(Z,M,j,K,b,g){return this._applyExtensions(b,"loadMeshPrimitive",(function(O){return O._loadMeshPrimitiveAsync&&O._loadMeshPrimitiveAsync(Z,M,j,K,b,g)}))},Z.prototype._extensionsLoadMaterialAsync=function(Z,M,j,K,b){return this._applyExtensions(M,"loadMaterial",(function(g){return g._loadMaterialAsync&&g._loadMaterialAsync(Z,M,j,K,b)}))},Z.prototype._extensionsCreateMaterial=function(Z,M,j){return this._applyExtensions(M,"createMaterial",(function(K){return K.createMaterial&&K.createMaterial(Z,M,j)}))},Z.prototype._extensionsLoadMaterialPropertiesAsync=function(Z,M,j){return this._applyExtensions(M,"loadMaterialProperties",(function(K){return K.loadMaterialPropertiesAsync&&K.loadMaterialPropertiesAsync(Z,M,j)}))},Z.prototype._extensionsLoadTextureInfoAsync=function(Z,M,j){return this._applyExtensions(M,"loadTextureInfo",(function(K){return K.loadTextureInfoAsync&&K.loadTextureInfoAsync(Z,M,j)}))},Z.prototype._extensionsLoadTextureAsync=function(Z,M,j){return this._applyExtensions(M,"loadTexture",(function(K){return K._loadTextureAsync&&K._loadTextureAsync(Z,M,j)}))},Z.prototype._extensionsLoadAnimationAsync=function(Z,M){return this._applyExtensions(M,"loadAnimation",(function(j){return j.loadAnimationAsync&&j.loadAnimationAsync(Z,M)}))},Z.prototype._extensionsLoadSkinAsync=function(Z,M,j){return this._applyExtensions(j,"loadSkin",(function(K){return K._loadSkinAsync&&K._loadSkinAsync(Z,M,j)}))},Z.prototype._extensionsLoadUriAsync=function(Z,M,j){return this._applyExtensions(M,"loadUri",(function(K){return K._loadUriAsync&&K._loadUriAsync(Z,M,j)}))},Z.prototype._extensionsLoadBufferViewAsync=function(Z,M){return this._applyExtensions(M,"loadBufferView",(function(j){return j.loadBufferViewAsync&&j.loadBufferViewAsync(Z,M)}))},Z.prototype._extensionsLoadBufferAsync=function(Z,M,j,K){return this._applyExtensions(M,"loadBuffer",(function(b){return b.loadBufferAsync&&b.loadBufferAsync(Z,M,j,K)}))},Z.LoadExtensionAsync=function(Z,M,j,K){if(!M.extensions)return null;var b=M.extensions[j];return b?K("".concat(Z,"/extensions/").concat(j),b):null},Z.LoadExtraAsync=function(Z,M,j,K){if(!M.extras)return null;var b=M.extras[j];return b?K("".concat(Z,"/extras/").concat(j),b):null},Z.prototype.isExtensionUsed=function(Z){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(Z)},Z.prototype.logOpen=function(Z){this._parent._logOpen(Z)},Z.prototype.logClose=function(){this._parent._logClose()},Z.prototype.log=function(Z){this._parent._log(Z)},Z.prototype.startPerformanceCounter=function(Z){this._parent._startPerformanceCounter(Z)},Z.prototype.endPerformanceCounter=function(Z){this._parent._endPerformanceCounter(Z)},Z._RegisteredExtensions={},Z.DefaultSampler={index:-1},Z}();w.c._CreateGLTF2Loader=function(Z){return new D(Z)};var l=j(96658),t=j(37094),v=j(60766),r=j(76384),L=(j(37105),j(56965)),ZZ=(j(81965),j(42373),j(91156),j(28689),j(16179)),MZ=(j(83874),"varying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}");ZZ.d.ShadersStore.rgbdEncodePixelShader=MZ;j(69233);var jZ="image/png";function KZ(Z,M,j,K,b,g,O,Q,Y,I,E){return new Promise((function(s,i){if(j){var a=M.createTexture(null,!0,!0,null,1,null,(function(Z){i(Z)}),Z);K.getEffect().executeWhenCompiled((function(){K.externalTextureSamplerBinding=!0,K.onApply=function(j){j._bindTexture("textureSampler",a),j.setFloat2("scale",1,M._features.needsInvertingBitmap&&Z instanceof ImageBitmap?-1:1)},M.scenes.length&&(M.scenes[0].postProcessManager.directRender([K],I,!0,g,O),M.restoreDefaultFramebuffer(),a.dispose(),URL.revokeObjectURL(b),s())}))}else{if(M._uploadImageToTexture(E,Z,g,O),Q){var z=Y[O];z&&M._uploadImageToTexture(z._texture,Z,g,0)}s()}}))}function bZ(Z,M,j){if(void 0===j&&(j=jZ),!O.d.IsExponentOfTwo(Z.width))throw new Error("Texture size must be a power of two");var K=l.b.ILog2(Z.width)+1,b=Z.getEngine(),g=!1,Q=!1,Y=null,I=null,E=null,s=b.getCaps();if(Z.format=5,Z.type=0,Z.generateMipMaps=!0,Z._cachedAnisotropicFilteringLevel=null,b.updateTextureSamplingMode(3,Z),s.textureLOD?b._features.supportRenderAndCopyToLodForFloatTextures?s.textureHalfFloatRender&&s.textureHalfFloatLinearFiltering?(g=!0,Z.type=2):s.textureFloatRender&&s.textureFloatLinearFiltering&&(g=!0,Z.type=1):g=!1:(g=!1,Q=!0,E={}),g)Y=new L.d("rgbdDecode","rgbdDecode",null,null,1,null,3,b,!1,void 0,Z.type,void 0,null,!1),Z._isRGBD=!1,Z.invertY=!1,I=b.createRenderTargetCubeTexture(Z.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:Z.type,format:5});else if(Z._isRGBD=!0,Z.invertY=!0,Q)for(var i=Z._lodGenerationScale,a=Z._lodGenerationOffset,z=0;z<3;z++){var V=(K-1)*i+a,o=a+(V-a)*(1-z/2),c=Math.round(Math.min(Math.max(o,0),V)),G=new v.h(b,v.e.Temp);G.isCube=!0,G.invertY=!0,G.generateMipMaps=!1,b.updateTextureSamplingMode(2,G);var f=new r.e(null);switch(f.isCube=!0,f._texture=G,E[c]=f,z){case 0:Z._lodTextureLow=f;break;case 1:Z._lodTextureMid=f;break;case 2:Z._lodTextureHigh=f}}var X=[],d=function(K){for(var O=function(O){var s=M[K][O],i=new Blob([s],{type:j}),a=URL.createObjectURL(i),z=void 0;if("undefined"===typeof Image||b._features.forceBitmapOverHTMLImageElement)z=b.createImageBitmap(i,{premultiplyAlpha:"none"}).then((function(M){return KZ(M,b,g,Y,a,O,K,Q,E,I,Z)}));else{var V=new Image;V.src=a,z=new Promise((function(M,j){V.onload=function(){KZ(V,b,g,Y,a,O,K,Q,E,I,Z).then((function(){return M()})).catch((function(Z){j(Z)}))},V.onerror=function(Z){j(Z)}}))}X.push(z)},s=0;s<6;s++)O(s)};for(z=0;z<M.length;z++)d(z);if(M.length<K){var W=void 0,A=Math.pow(2,K-1-M.length),q=A*A*4;switch(Z.type){case 0:W=new Uint8Array(q);break;case 2:W=new Uint16Array(q);break;case 1:W=new Float32Array(q)}for(z=M.length;z<K;z++)for(var T=0;T<6;T++)b._uploadArrayBufferViewToTexture(Z,W,T,z)}return Promise.all(X).then((function(){I&&(b._releaseTexture(Z),I._swapAndDie(Z)),Y&&Y.dispose(),Q&&(Z._lodTextureHigh&&Z._lodTextureHigh._texture&&(Z._lodTextureHigh._texture.isReady=!0),Z._lodTextureMid&&Z._lodTextureMid._texture&&(Z._lodTextureMid._texture.isReady=!0),Z._lodTextureLow&&Z._lodTextureLow._texture&&(Z._lodTextureLow._texture.isReady=!0))}))}var gZ=j(16708),OZ=(j(36125),function(Z){function M(M,j,K,b,g,O,Q,Y,I){void 0===b&&(b=5),void 0===g&&(g=0),void 0===O&&(O=!1),void 0===Q&&(Q=!1),void 0===Y&&(Y=3),void 0===I&&(I=null);var E=Z.call(this,"",M)||this;return E._texture=M.getEngine().createRawCubeTexture(j,K,b,g,O,Q,Y,I),E}return(0,V.m)(M,Z),M.prototype.update=function(Z,M,j,K,b){void 0===b&&(b=null),this._texture.getEngine().updateRawCubeTexture(this._texture,Z,M,j,K,b)},M.prototype.updateRGBDAsync=function(Z,M,j,K){return void 0===M&&(M=null),void 0===j&&(j=.8),void 0===K&&(K=0),function(Z,M,j,K,b){var g=bZ(Z.getEngine().createRawCubeTexture(null,Z.width,Z.format,Z.type,Z.generateMipMaps,Z.invertY,Z.samplingMode,Z._compression),M).then((function(){return Z}));return Z.onRebuildCallback=function(Z){return{proxy:g,isReady:!0,isAsync:!0}},Z._source=v.e.CubeRawRGBD,Z._bufferViewArrayArray=M,Z._lodGenerationScale=K,Z._lodGenerationOffset=b,Z._sphericalPolynomial=j,bZ(Z,M).then((function(){return Z.isReady=!0,Z}))}(this._texture,Z,M,j,K).then((function(){}))},M.prototype.clone=function(){var Z=this;return B.b.Clone((function(){var j=Z.getScene(),K=Z._texture,b=new M(j,K._bufferViewArray,K.width,K.format,K.type,K.generateMipMaps,K.invertY,K.samplingMode,K._compression);return K.source===v.e.CubeRawRGBD&&b.updateRGBDAsync(K._bufferViewArrayArray,K._sphericalPolynomial,K._lodGenerationScale,K._lodGenerationOffset),b}),this)},M}(gZ.c)),QZ="EXT_lights_image_based",YZ=function(){function Z(Z){this.name=QZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(QZ)}return Z.prototype.dispose=function(){this._loader=null,delete this._lights},Z.prototype.onLoading=function(){var Z=this._loader.gltf.extensions;if(Z&&Z[this.name]){var M=Z[this.name];this._lights=M.lights}},Z.prototype.loadSceneAsync=function(Z,M){var j=this;return D.LoadExtensionAsync(Z,M,this.name,(function(K,b){var g=new Array;g.push(j._loader.loadSceneAsync(Z,M)),j._loader.logOpen("".concat(K));var O=P.Get("".concat(K,"/light"),j._lights,b.light);return g.push(j._loadLightAsync("/extensions/".concat(j.name,"/lights/").concat(b.light),O).then((function(Z){j._loader.babylonScene.environmentTexture=Z}))),j._loader.logClose(),Promise.all(g).then((function(){}))}))},Z.prototype._loadLightAsync=function(Z,M){var j=this;if(!M._loaded){var K=new Array;this._loader.logOpen("".concat(Z));for(var g=new Array(M.specularImages.length),O=function(j){var b=M.specularImages[j];g[j]=new Array(b.length);for(var O=function(M){var O="".concat(Z,"/specularImages/").concat(j,"/").concat(M);Q._loader.logOpen("".concat(O));var Y=b[M],I=P.Get(O,Q._loader.gltf.images,Y);K.push(Q._loader.loadImageAsync("/images/".concat(Y),I).then((function(Z){g[j][M]=Z}))),Q._loader.logClose()},Y=0;Y<b.length;Y++)O(Y)},Q=this,Y=0;Y<M.specularImages.length;Y++)O(Y);this._loader.logClose(),M._loaded=Promise.all(K).then((function(){var K=new OZ(j._loader.babylonScene,null,M.specularImageSize);if(K.name=M.name||"environment",M._babylonTexture=K,void 0!=M.intensity&&(K.level=M.intensity),M.rotation){var O=b.d.FromArray(M.rotation);j._loader.babylonScene.useRightHandedSystem||(O=b.d.Inverse(O)),b.c.FromQuaternionToRef(O,K.getReflectionTextureMatrix())}if(!M.irradianceCoefficients)throw new Error("".concat(Z,": Irradiance coefficients are missing"));var Q=t.c.FromArray(M.irradianceCoefficients);Q.scaleInPlace(M.intensity),Q.convertIrradianceToLambertianRadiance();var Y=t.f.FromHarmonics(Q),I=(g.length-1)/l.b.Log2(M.specularImageSize);return K.updateRGBDAsync(g,Y,I)}))}return M._loaded.then((function(){return M._babylonTexture}))},Z}();D.RegisterExtension(QZ,(function(Z){return new YZ(Z)}));j(14313);var IZ="EXT_mesh_gpu_instancing",EZ=function(){function Z(Z){this.name=IZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(IZ)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadNodeAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(Z,g){K._loader._disableInstancedMesh++;var O=K._loader.loadNodeAsync("/nodes/".concat(M.index),M,j);if(K._loader._disableInstancedMesh--,!M._primitiveBabylonMeshes)return O;var Q=new Array,Y=0,I=function(M){if(void 0!=g.attributes[M]){var j=P.Get("".concat(Z,"/attributes/").concat(M),K._loader.gltf.accessors,g.attributes[M]);if(Q.push(K._loader._loadFloatAccessorAsync("/accessors/".concat(j.bufferView),j)),0===Y)Y=j.count;else if(Y!==j.count)throw new Error("".concat(Z,"/attributes: Instance buffer accessors do not have the same count."))}else Q.push(Promise.resolve(null))};return I("TRANSLATION"),I("ROTATION"),I("SCALE"),O.then((function(Z){return Promise.all(Q).then((function(j){var K=j[0],g=j[1],O=j[2],Q=new Float32Array(16*Y);b.e.Vector3[0].copyFromFloats(0,0,0),b.e.Quaternion[0].copyFromFloats(0,0,0,1),b.e.Vector3[1].copyFromFloats(1,1,1);for(var I=0;I<Y;++I)K&&b.k.FromArrayToRef(K,3*I,b.e.Vector3[0]),g&&b.d.FromArrayToRef(g,4*I,b.e.Quaternion[0]),O&&b.k.FromArrayToRef(O,3*I,b.e.Vector3[1]),b.c.ComposeToRef(b.e.Vector3[1],b.e.Quaternion[0],b.e.Vector3[0],b.e.Matrix[0]),b.e.Matrix[0].copyToArray(Q,16*I);for(var E=0,s=M._primitiveBabylonMeshes;E<s.length;E++){s[E].thinInstanceSetBuffer("matrix",Q,16,!0)}return Z}))}))}))},Z}();D.RegisterExtension(IZ,(function(Z){return new EZ(Z)}));var sZ=function(){function Z(){var M=Z.Configuration.decoder;this._decoderModulePromise=O.d.LoadScriptAsync(O.d.GetAbsoluteUrl(M.url)).then((function(){return MeshoptDecoder.ready}))}return Object.defineProperty(Z,"Default",{get:function(){return Z._Default||(Z._Default=new Z),Z._Default},enumerable:!1,configurable:!0}),Z.prototype.dispose=function(){delete this._decoderModulePromise},Z.prototype.decodeGltfBufferAsync=function(Z,M,j,K,b){return this._decoderModulePromise.then((function(){var g=new Uint8Array(M*j);return MeshoptDecoder.decodeGltfBuffer(g,M,j,Z,K,b),g}))},Z.Configuration={decoder:{url:"https://preview.babylonjs.com/meshopt_decoder.js"}},Z._Default=null,Z}(),iZ="EXT_meshopt_compression",aZ=function(){function Z(Z){this.name=iZ,this.enabled=Z.isExtensionUsed(iZ),this._loader=Z}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadBufferViewAsync=function(Z,M){var j=this;return D.LoadExtensionAsync(Z,M,this.name,(function(K,b){var g=M;if(g._meshOptData)return g._meshOptData;var O=P.Get("".concat(Z,"/buffer"),j._loader.gltf.buffers,b.buffer);return g._meshOptData=j._loader.loadBufferAsync("/buffers/".concat(O.index),O,b.byteOffset||0,b.byteLength).then((function(Z){return sZ.Default.decodeGltfBufferAsync(Z,b.count,b.byteStride,b.mode,b.filter)})),g._meshOptData}))},Z}();D.RegisterExtension(iZ,(function(Z){return new aZ(Z)}));var zZ="EXT_texture_webp",VZ=function(){function Z(Z){this.name=zZ,this._loader=Z,this.enabled=Z.isExtensionUsed(zZ)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype._loadTextureAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=void 0==M.sampler?D.DefaultSampler:P.Get("".concat(Z,"/sampler"),K._loader.gltf.samplers,M.sampler),Q=P.Get("".concat(b,"/source"),K._loader.gltf.images,g.source);return K._loader._createTextureAsync(Z,O,Q,(function(Z){j(Z)}),void 0,!M._textureInfo.nonColorData)}))},Z}();D.RegisterExtension(zZ,(function(Z){return new VZ(Z)}));var oZ=j(40689),cZ="KHR_draco_mesh_compression",GZ=function(){function Z(Z){this.name=cZ,this._loader=Z,this.enabled=oZ.c.DecoderAvailable&&this._loader.isExtensionUsed(cZ)}return Z.prototype.dispose=function(){delete this.dracoCompression,this._loader=null},Z.prototype._loadVertexDataAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){if(void 0!=M.mode){if(5!==M.mode&&4!==M.mode)throw new Error("".concat(Z,": Unsupported mode ").concat(M.mode));if(5===M.mode)throw new Error("".concat(Z,": Mode ").concat(M.mode," is not currently supported"))}var O={},Q={},Y=function(b,Y){var I=g.attributes[b];if(void 0!==I&&void 0!==M.attributes[b]){O[Y]=I;var E=P.Get("".concat(Z,"/attributes/").concat(b),K._loader.gltf.accessors,M.attributes[b]);if(E.normalized&&5126!==E.componentType){var s=1;switch(E.componentType){case 5120:s=127;break;case 5121:s=255;break;case 5122:s=32767;break;case 5123:s=65535}Q[Y]=s}j._delayInfo=j._delayInfo||[],-1===j._delayInfo.indexOf(Y)&&j._delayInfo.push(Y)}};Y("POSITION",e.f.PositionKind),Y("NORMAL",e.f.NormalKind),Y("TANGENT",e.f.TangentKind),Y("TEXCOORD_0",e.f.UVKind),Y("TEXCOORD_1",e.f.UV2Kind),Y("TEXCOORD_2",e.f.UV3Kind),Y("TEXCOORD_3",e.f.UV4Kind),Y("TEXCOORD_4",e.f.UV5Kind),Y("TEXCOORD_5",e.f.UV6Kind),Y("JOINTS_0",e.f.MatricesIndicesKind),Y("WEIGHTS_0",e.f.MatricesWeightsKind),Y("COLOR_0",e.f.ColorKind);var I=P.Get(b,K._loader.gltf.bufferViews,g.bufferView);return I._dracoBabylonGeometry||(I._dracoBabylonGeometry=K._loader.loadBufferViewAsync("/bufferViews/".concat(I.index),I).then((function(M){return(K.dracoCompression||oZ.c.Default).decodeMeshAsync(M,O,Q).then((function(Z){var M=new u.e(j.name,K._loader.babylonScene);return Z.applyToGeometry(M),M})).catch((function(M){throw new Error("".concat(Z,": ").concat(M.message))}))}))),I._dracoBabylonGeometry}))},Z}();D.RegisterExtension(cZ,(function(Z){return new GZ(Z)}));var fZ=j(15706),XZ=j(315),dZ=j(13680);c.b.AddNodeConstructor("Light_Type_0",(function(Z,M){return function(){return new WZ(Z,b.k.Zero(),M)}}));var WZ=function(Z){function M(M,j,K){var b=Z.call(this,M,K)||this;return b._shadowAngle=Math.PI/2,b.position=j,b}return(0,V.m)(M,Z),Object.defineProperty(M.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(Z){this._shadowAngle=Z,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"direction",{get:function(){return this._direction},set:function(Z){var M=this.needCube();this._direction=Z,this.needCube()!==M&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"PointLight"},M.prototype.getTypeID=function(){return XZ.e.LIGHTTYPEID_POINTLIGHT},M.prototype.needCube=function(){return!this.direction},M.prototype.getShadowDirection=function(M){if(this.direction)return Z.prototype.getShadowDirection.call(this,M);switch(M){case 0:return new b.k(1,0,0);case 1:return new b.k(-1,0,0);case 2:return new b.k(0,-1,0);case 3:return new b.k(0,1,0);case 4:return new b.k(0,0,1);case 5:return new b.k(0,0,-1)}return b.k.Zero()},M.prototype._setDefaultShadowProjectionMatrix=function(Z,M,j){var K=this.getScene().activeCamera;if(K){var g=void 0!==this.shadowMinZ?this.shadowMinZ:K.minZ,O=void 0!==this.shadowMaxZ?this.shadowMaxZ:K.maxZ,Q=this.getScene().getEngine().useReverseDepthBuffer;b.c.PerspectiveFovLHToRef(this.shadowAngle,1,Q?O:g,Q?g:O,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Q)}},M.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},M.prototype.transferToEffect=function(Z,M){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,M):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,M),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,M),this},M.prototype.transferToNodeMaterialEffect=function(Z,M){return this.computeTransformedInformation()?Z.setFloat3(M,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):Z.setFloat3(M,this.position.x,this.position.y,this.position.z),this},M.prototype.prepareLightSpecificDefines=function(Z,M){Z["POINTLIGHT"+M]=!0},(0,V.l)([(0,B.z)()],M.prototype,"shadowAngle",null),M}(dZ.e);c.b.AddNodeConstructor("Light_Type_2",(function(Z,M){return function(){return new AZ(Z,b.k.Zero(),b.k.Zero(),0,0,M)}}));var AZ=function(Z){function M(M,j,K,g,O,Q){var Y=Z.call(this,M,Q)||this;return Y._innerAngle=0,Y._projectionTextureMatrix=b.c.Zero(),Y._projectionTextureLightNear=1e-6,Y._projectionTextureLightFar=1e3,Y._projectionTextureUpDirection=b.k.Up(),Y._projectionTextureViewLightDirty=!0,Y._projectionTextureProjectionLightDirty=!0,Y._projectionTextureDirty=!0,Y._projectionTextureViewTargetVector=b.k.Zero(),Y._projectionTextureViewLightMatrix=b.c.Zero(),Y._projectionTextureProjectionLightMatrix=b.c.Zero(),Y._projectionTextureScalingMatrix=b.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),Y.position=j,Y.direction=K,Y.angle=g,Y.exponent=O,Y}return(0,V.m)(M,Z),Object.defineProperty(M.prototype,"angle",{get:function(){return this._angle},set:function(Z){this._angle=Z,this._cosHalfAngle=Math.cos(.5*Z),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(Z){this._innerAngle=Z,this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(Z){this._shadowAngleScale=Z,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(Z){this._projectionTextureLightNear=Z,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(Z){this._projectionTextureLightFar=Z,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(Z){this._projectionTextureUpDirection=Z,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(Z){var j=this;this._projectionTexture!==Z&&(this._projectionTexture=Z,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(M._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((function(){j._markMeshesAsLightDirty()})):M._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((function(){j._markMeshesAsLightDirty()}))))},enumerable:!1,configurable:!0}),M._IsProceduralTexture=function(Z){return void 0!==Z.onGeneratedObservable},M._IsTexture=function(Z){return void 0!==Z.onLoadObservable},Object.defineProperty(M.prototype,"projectionTextureProjectionLightMatrix",{get:function(){return this._projectionTextureProjectionLightMatrix},set:function(Z){this._projectionTextureProjectionLightMatrix=Z,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"SpotLight"},M.prototype.getTypeID=function(){return XZ.e.LIGHTTYPEID_SPOTLIGHT},M.prototype._setDirection=function(M){Z.prototype._setDirection.call(this,M),this._projectionTextureViewLightDirty=!0},M.prototype._setPosition=function(M){Z.prototype._setPosition.call(this,M),this._projectionTextureViewLightDirty=!0},M.prototype._setDefaultShadowProjectionMatrix=function(Z,M,j){var K=this.getScene().activeCamera;if(K){this._shadowAngleScale=this._shadowAngleScale||1;var g=this._shadowAngleScale*this._angle,O=void 0!==this.shadowMinZ?this.shadowMinZ:K.minZ,Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:K.maxZ,Y=this.getScene().getEngine().useReverseDepthBuffer;b.c.PerspectiveFovLHToRef(g,1,Y?Q:O,Y?O:Q,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Y)}},M.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),b.c.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},M.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var Z=this.projectionTextureLightFar,M=this.projectionTextureLightNear,j=Z/(Z-M),K=-j*M,g=1/Math.tan(this._angle/2);b.c.FromValuesToRef(g/1,0,0,0,0,g,0,0,0,0,j,1,0,0,K,0,this._projectionTextureProjectionLightMatrix)},M.prototype._computeProjectionTextureMatrix=function(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof x.b){var Z=this._projectionTexture.uScale/2,M=this._projectionTexture.vScale/2;b.c.FromValuesToRef(Z,0,0,0,0,M,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},M.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},M.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},M.prototype.transferTexturesToEffect=function(Z,M){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),Z.setMatrix("textureProjectionMatrix"+M,this._projectionTextureMatrix),Z.setTexture("projectionLightSampler"+M,this.projectionTexture)),this},M.prototype.transferToEffect=function(Z,M){var j;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,M),j=b.k.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,M),j=b.k.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",j.x,j.y,j.z,this._cosHalfAngle,M),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,M),this},M.prototype.transferToNodeMaterialEffect=function(Z,M){var j;return j=this.computeTransformedInformation()?b.k.Normalize(this.transformedDirection):b.k.Normalize(this.direction),this.getScene().useRightHandedSystem?Z.setFloat3(M,-j.x,-j.y,-j.z):Z.setFloat3(M,j.x,j.y,j.z),this},M.prototype.dispose=function(){Z.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},M.prototype.getDepthMinZ=function(Z){var M=this._scene.getEngine(),j=void 0!==this.shadowMinZ?this.shadowMinZ:Z.minZ;return M.useReverseDepthBuffer&&M.isNDCHalfZRange?j:this._scene.getEngine().isNDCHalfZRange?0:j},M.prototype.getDepthMaxZ=function(Z){var M=this._scene.getEngine(),j=void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ;return M.useReverseDepthBuffer&&M.isNDCHalfZRange?0:j},M.prototype.prepareLightSpecificDefines=function(Z,M){Z["SPOTLIGHT"+M]=!0,Z["PROJECTEDLIGHTTEXTURE"+M]=!(!this.projectionTexture||!this.projectionTexture.isReady())},(0,V.l)([(0,B.z)()],M.prototype,"angle",null),(0,V.l)([(0,B.z)()],M.prototype,"innerAngle",null),(0,V.l)([(0,B.z)()],M.prototype,"shadowAngleScale",null),(0,V.l)([(0,B.z)()],M.prototype,"exponent",void 0),(0,V.l)([(0,B.z)()],M.prototype,"projectionTextureLightNear",null),(0,V.l)([(0,B.z)()],M.prototype,"projectionTextureLightFar",null),(0,V.l)([(0,B.z)()],M.prototype,"projectionTextureUpDirection",null),(0,V.l)([(0,B.s)("projectedLightTexture")],M.prototype,"_projectionTexture",void 0),M}(dZ.e),qZ="KHR_lights_punctual",TZ=function(){function Z(Z){this.name=qZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(qZ)}return Z.prototype.dispose=function(){this._loader=null,delete this._lights},Z.prototype.onLoading=function(){var Z=this._loader.gltf.extensions;if(Z&&Z[this.name]){var M=Z[this.name];this._lights=M.lights}},Z.prototype.loadNodeAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(O,Q){return K._loader.loadNodeAsync(Z,M,(function(Z){var M,Y=P.Get(O,K._lights,Q.light),I=Y.name||Z.name;switch(K._loader.babylonScene._blockEntityCollection=!!K._loader._assetContainer,Y.type){case"directional":M=new fZ.c(I,b.k.Backward(),K._loader.babylonScene);break;case"point":M=new WZ(I,b.k.Zero(),K._loader.babylonScene);break;case"spot":var E=new AZ(I,b.k.Zero(),b.k.Backward(),0,1,K._loader.babylonScene);E.angle=2*(Y.spot&&Y.spot.outerConeAngle||Math.PI/4),E.innerAngle=2*(Y.spot&&Y.spot.innerConeAngle||0),M=E;break;default:throw K._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(O,": Invalid light type (").concat(Y.type,")"))}M._parentContainer=K._loader._assetContainer,K._loader.babylonScene._blockEntityCollection=!1,M.falloffType=XZ.e.FALLOFF_GLTF,M.diffuse=Y.color?g.e.FromArray(Y.color):g.e.White(),M.intensity=void 0==Y.intensity?1:Y.intensity,M.range=void 0==Y.range?Number.MAX_VALUE:Y.range,M.parent=Z,K._loader._babylonLights.push(M),D.AddPointerMetadata(M,O),j(Z)}))}))},Z}();D.RegisterExtension(qZ,(function(Z){return new TZ(Z)}));var BZ="KHR_materials_pbrSpecularGlossiness",NZ=function(){function Z(Z){this.name=BZ,this.order=200,this._loader=Z,this.enabled=this._loader.isExtensionUsed(BZ)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=new Array;return O.push(K._loader.loadMaterialBasePropertiesAsync(Z,M,j)),O.push(K._loadSpecularGlossinessPropertiesAsync(b,M,g,j)),K._loader.loadMaterialAlphaProperties(Z,M,j),Promise.all(O).then((function(){}))}))},Z.prototype._loadSpecularGlossinessPropertiesAsync=function(Z,M,j,K){if(!(K instanceof k))throw new Error("".concat(Z,": Material type not supported"));var b=new Array;return K.metallic=null,K.roughness=null,j.diffuseFactor?(K.albedoColor=g.e.FromArray(j.diffuseFactor),K.alpha=j.diffuseFactor[3]):K.albedoColor=g.e.White(),K.reflectivityColor=j.specularFactor?g.e.FromArray(j.specularFactor):g.e.White(),K.microSurface=void 0==j.glossinessFactor?1:j.glossinessFactor,j.diffuseTexture&&b.push(this._loader.loadTextureInfoAsync("".concat(Z,"/diffuseTexture"),j.diffuseTexture,(function(Z){Z.name="".concat(K.name," (Diffuse)"),K.albedoTexture=Z}))),j.specularGlossinessTexture&&(b.push(this._loader.loadTextureInfoAsync("".concat(Z,"/specularGlossinessTexture"),j.specularGlossinessTexture,(function(Z){Z.name="".concat(K.name," (Specular Glossiness)"),K.reflectivityTexture=Z,K.reflectivityTexture.hasAlpha=!0}))),K.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(b).then((function(){}))},Z}();D.RegisterExtension(BZ,(function(Z){return new NZ(Z)}));var UZ="KHR_materials_unlit",nZ=function(){function Z(Z){this.name=UZ,this.order=210,this._loader=Z,this.enabled=this._loader.isExtensionUsed(UZ)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(){return K._loadUnlitPropertiesAsync(Z,M,j)}))},Z.prototype._loadUnlitPropertiesAsync=function(Z,M,j){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));var K=new Array;j.unlit=!0;var b=M.pbrMetallicRoughness;return b&&(b.baseColorFactor?(j.albedoColor=g.e.FromArray(b.baseColorFactor),j.alpha=b.baseColorFactor[3]):j.albedoColor=g.e.White(),b.baseColorTexture&&K.push(this._loader.loadTextureInfoAsync("".concat(Z,"/baseColorTexture"),b.baseColorTexture,(function(Z){Z.name="".concat(j.name," (Base Color)"),j.albedoTexture=Z})))),M.doubleSided&&(j.backFaceCulling=!1,j.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(Z,M,j),Promise.all(K).then((function(){}))},Z}();D.RegisterExtension(UZ,(function(Z){return new nZ(Z)}));var kZ="KHR_materials_clearcoat",xZ=function(){function Z(Z){this.name=kZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(kZ)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=new Array;return O.push(K._loader.loadMaterialPropertiesAsync(Z,M,j)),O.push(K._loadClearCoatPropertiesAsync(b,g,j)),Promise.all(O).then((function(){}))}))},Z.prototype._loadClearCoatPropertiesAsync=function(Z,M,j){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));var K=new Array;return j.clearCoat.isEnabled=!0,j.clearCoat.useRoughnessFromMainTexture=!1,j.clearCoat.remapF0OnInterfaceChange=!1,void 0!=M.clearcoatFactor?j.clearCoat.intensity=M.clearcoatFactor:j.clearCoat.intensity=0,M.clearcoatTexture&&K.push(this._loader.loadTextureInfoAsync("".concat(Z,"/clearcoatTexture"),M.clearcoatTexture,(function(Z){Z.name="".concat(j.name," (ClearCoat Intensity)"),j.clearCoat.texture=Z}))),void 0!=M.clearcoatRoughnessFactor?j.clearCoat.roughness=M.clearcoatRoughnessFactor:j.clearCoat.roughness=0,M.clearcoatRoughnessTexture&&(M.clearcoatRoughnessTexture.nonColorData=!0,K.push(this._loader.loadTextureInfoAsync("".concat(Z,"/clearcoatRoughnessTexture"),M.clearcoatRoughnessTexture,(function(Z){Z.name="".concat(j.name," (ClearCoat Roughness)"),j.clearCoat.textureRoughness=Z})))),M.clearcoatNormalTexture&&(M.clearcoatNormalTexture.nonColorData=!0,K.push(this._loader.loadTextureInfoAsync("".concat(Z,"/clearcoatNormalTexture"),M.clearcoatNormalTexture,(function(Z){Z.name="".concat(j.name," (ClearCoat Normal)"),j.clearCoat.bumpTexture=Z}))),j.invertNormalMapX=!j.getScene().useRightHandedSystem,j.invertNormalMapY=j.getScene().useRightHandedSystem,void 0!=M.clearcoatNormalTexture.scale&&(j.clearCoat.bumpTexture.level=M.clearcoatNormalTexture.scale)),Promise.all(K).then((function(){}))},Z}();D.RegisterExtension(kZ,(function(Z){return new xZ(Z)}));var RZ="KHR_materials_iridescence",eZ=function(){function Z(Z){this.name=RZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(RZ)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=new Array;return O.push(K._loader.loadMaterialPropertiesAsync(Z,M,j)),O.push(K._loadIridescencePropertiesAsync(b,g,j)),Promise.all(O).then((function(){}))}))},Z.prototype._loadIridescencePropertiesAsync=function(Z,M,j){var K,b,g,O,Q;if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));var Y=new Array;return j.iridescence.isEnabled=!0,j.iridescence.intensity=null!==(K=M.iridescenceFactor)&&void 0!==K?K:0,j.iridescence.indexOfRefraction=null!==(g=null!==(b=M.iridescenceIor)&&void 0!==b?b:M.iridescenceIOR)&&void 0!==g?g:1.3,j.iridescence.minimumThickness=null!==(O=M.iridescenceThicknessMinimum)&&void 0!==O?O:100,j.iridescence.maximumThickness=null!==(Q=M.iridescenceThicknessMaximum)&&void 0!==Q?Q:400,M.iridescenceTexture&&Y.push(this._loader.loadTextureInfoAsync("".concat(Z,"/iridescenceTexture"),M.iridescenceTexture,(function(Z){Z.name="".concat(j.name," (Iridescence Intensity)"),j.iridescence.texture=Z}))),M.iridescenceThicknessTexture&&Y.push(this._loader.loadTextureInfoAsync("".concat(Z,"/iridescenceThicknessTexture"),M.iridescenceThicknessTexture,(function(Z){Z.name="".concat(j.name," (Iridescence Thickness)"),j.iridescence.thicknessTexture=Z}))),Promise.all(Y).then((function(){}))},Z}();D.RegisterExtension(RZ,(function(Z){return new eZ(Z)}));var uZ="KHR_materials_emissive_strength",FZ=function(){function Z(Z){this.name=uZ,this.order=170,this._loader=Z,this.enabled=this._loader.isExtensionUsed(uZ)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){return K._loader.loadMaterialPropertiesAsync(Z,M,j).then((function(){K._loadEmissiveProperties(b,g,j)}))}))},Z.prototype._loadEmissiveProperties=function(Z,M,j){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));void 0!==M.emissiveStrength&&j.emissiveColor.scaleToRef(M.emissiveStrength,j.emissiveColor)},Z}();D.RegisterExtension(uZ,(function(Z){return new FZ(Z)}));var CZ="KHR_materials_sheen",yZ=function(){function Z(Z){this.name=CZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(CZ)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=new Array;return O.push(K._loader.loadMaterialPropertiesAsync(Z,M,j)),O.push(K._loadSheenPropertiesAsync(b,g,j)),Promise.all(O).then((function(){}))}))},Z.prototype._loadSheenPropertiesAsync=function(Z,M,j){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));var K=new Array;return j.sheen.isEnabled=!0,j.sheen.intensity=1,void 0!=M.sheenColorFactor?j.sheen.color=g.e.FromArray(M.sheenColorFactor):j.sheen.color=g.e.Black(),M.sheenColorTexture&&K.push(this._loader.loadTextureInfoAsync("".concat(Z,"/sheenColorTexture"),M.sheenColorTexture,(function(Z){Z.name="".concat(j.name," (Sheen Color)"),j.sheen.texture=Z}))),void 0!==M.sheenRoughnessFactor?j.sheen.roughness=M.sheenRoughnessFactor:j.sheen.roughness=0,M.sheenRoughnessTexture&&(M.sheenRoughnessTexture.nonColorData=!0,K.push(this._loader.loadTextureInfoAsync("".concat(Z,"/sheenRoughnessTexture"),M.sheenRoughnessTexture,(function(Z){Z.name="".concat(j.name," (Sheen Roughness)"),j.sheen.textureRoughness=Z})))),j.sheen.albedoScaling=!0,j.sheen.useRoughnessFromMainTexture=!1,Promise.all(K).then((function(){}))},Z}();D.RegisterExtension(CZ,(function(Z){return new yZ(Z)}));var SZ="KHR_materials_specular",hZ=function(){function Z(Z){this.name=SZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(SZ)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=new Array;return O.push(K._loader.loadMaterialPropertiesAsync(Z,M,j)),O.push(K._loadSpecularPropertiesAsync(b,g,j)),Promise.all(O).then((function(){}))}))},Z.prototype._loadSpecularPropertiesAsync=function(Z,M,j){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));var K=new Array;return void 0!==M.specularFactor&&(j.metallicF0Factor=M.specularFactor),void 0!==M.specularColorFactor&&(j.metallicReflectanceColor=g.e.FromArray(M.specularColorFactor)),M.specularTexture&&(M.specularTexture.nonColorData=!0,K.push(this._loader.loadTextureInfoAsync("".concat(Z,"/specularTexture"),M.specularTexture,(function(Z){Z.name="".concat(j.name," (Specular F0 Strength)"),j.metallicReflectanceTexture=Z,j.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),M.specularColorTexture&&K.push(this._loader.loadTextureInfoAsync("".concat(Z,"/specularColorTexture"),M.specularColorTexture,(function(Z){Z.name="".concat(j.name," (Specular F0 Color)"),j.reflectanceTexture=Z}))),Promise.all(K).then((function(){}))},Z}();D.RegisterExtension(SZ,(function(Z){return new hZ(Z)}));var wZ="KHR_materials_ior",pZ=function(){function Z(Z){this.name=wZ,this.order=180,this._loader=Z,this.enabled=this._loader.isExtensionUsed(wZ)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=new Array;return O.push(K._loader.loadMaterialPropertiesAsync(Z,M,j)),O.push(K._loadIorPropertiesAsync(b,g,j)),Promise.all(O).then((function(){}))}))},Z.prototype._loadIorPropertiesAsync=function(M,j,K){if(!(K instanceof k))throw new Error("".concat(M,": Material type not supported"));return void 0!==j.ior?K.indexOfRefraction=j.ior:K.indexOfRefraction=Z._DEFAULT_IOR,Promise.resolve()},Z._DEFAULT_IOR=1.5,Z}();D.RegisterExtension(wZ,(function(Z){return new pZ(Z)}));var mZ="KHR_materials_variants",JZ=function(){function Z(Z){this.name=mZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(mZ)}return Z.prototype.dispose=function(){this._loader=null},Z.GetAvailableVariants=function(Z){var M=this._GetExtensionMetadata(Z);return M?Object.keys(M.variants):[]},Z.prototype.getAvailableVariants=function(M){return Z.GetAvailableVariants(M)},Z.SelectVariant=function(Z,M){var j=this._GetExtensionMetadata(Z);if(!j)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(mZ," extension"));var K=function(Z){var M=j.variants[Z];if(M)for(var K=0,b=M;K<b.length;K++){var g=b[K];g.mesh.material=g.material}};if(M instanceof Array)for(var b=0,g=M;b<g.length;b++){K(g[b])}else K(M);j.lastSelected=M},Z.prototype.selectVariant=function(M,j){return Z.SelectVariant(M,j)},Z.Reset=function(Z){var M=this._GetExtensionMetadata(Z);if(!M)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(mZ," extension"));for(var j=0,K=M.original;j<K.length;j++){var b=K[j];b.mesh.material=b.material}M.lastSelected=null},Z.prototype.reset=function(M){return Z.Reset(M)},Z.GetLastSelectedVariant=function(Z){var M=this._GetExtensionMetadata(Z);if(!M)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(mZ," extension"));return M.lastSelected},Z.prototype.getLastSelectedVariant=function(M){return Z.GetLastSelectedVariant(M)},Z._GetExtensionMetadata=function(Z){var M,j;return(null===(j=null===(M=null===Z||void 0===Z?void 0:Z.metadata)||void 0===M?void 0:M.gltf)||void 0===j?void 0:j.KHR_materials_variants)||null},Z.prototype.onLoading=function(){var Z=this._loader.gltf.extensions;if(Z&&Z[this.name]){var M=Z[this.name];this._variants=M.variants}},Z.prototype._loadMeshPrimitiveAsync=function(M,j,K,b,g,O){var Q=this;return D.LoadExtensionAsync(M,g,this.name,(function(Y,I){var E=new Array;return E.push(Q._loader._loadMeshPrimitiveAsync(M,j,K,b,g,(function(j){if(O(j),j instanceof F.b){var K=D._GetDrawMode(M,g.mode),b=Q._loader.rootBabylonMesh,s=b?b.metadata=b.metadata||{}:{},i=s.gltf=s.gltf||{},a=i.KHR_materials_variants=i.KHR_materials_variants||{lastSelected:null,original:[],variants:{}};a.original.push({mesh:j,material:j.material});for(var z=function(M){var g=I.mappings[M],O=P.Get("".concat(Y,"/mappings/").concat(M,"/material"),Q._loader.gltf.materials,g.material);E.push(Q._loader._loadMaterialAsync("#/materials/".concat(g.material),O,j,K,(function(M){for(var K=function(K){var O=g.variants[K],Y=P.Get("/extensions/".concat(mZ,"/variants/").concat(O),Q._variants,O);a.variants[Y.name]=a.variants[Y.name]||[],a.variants[Y.name].push({mesh:j,material:M}),j.onClonedObservable.add((function(M){var K=M,g=null,O=K;do{if(!(O=O.parent))return;g=Z._GetExtensionMetadata(O)}while(null===g);if(b&&g===Z._GetExtensionMetadata(b)){for(var Q in O.metadata={},b.metadata)O.metadata[Q]=b.metadata[Q];for(var Q in O.metadata.gltf=[],b.metadata.gltf)O.metadata.gltf[Q]=b.metadata.gltf[Q];O.metadata.gltf.KHR_materials_variants={lastSelected:null,original:[],variants:{}};for(var I=0,E=g.original;I<E.length;I++){var s=E[I];O.metadata.gltf.KHR_materials_variants.original.push({mesh:s.mesh,material:s.material})}for(var Q in g.variants)if(Object.prototype.hasOwnProperty.call(g.variants,Q)){O.metadata.gltf.KHR_materials_variants.variants[Q]=[];for(var i=0,a=g.variants[Q];i<a.length;i++){var z=a[i];O.metadata.gltf.KHR_materials_variants.variants[Q].push({mesh:z.mesh,material:z.material})}}g=O.metadata.gltf.KHR_materials_variants}for(var V=0,o=g.original;V<o.length;V++){(f=o[V]).mesh===j&&(f.mesh=K)}for(var c=0,G=g.variants[Y.name];c<G.length;c++){var f;(f=G[c]).mesh===j&&(f.mesh=K)}}))},O=0;O<g.variants.length;++O)K(O)})))},V=0;V<I.mappings.length;++V)z(V)}}))),Promise.all(E).then((function(Z){return Z[0]}))}))},Z}();D.RegisterExtension(mZ,(function(Z){return new JZ(Z)}));var PZ=function(){return PZ=Object.assign||function(Z){for(var M,j=1,K=arguments.length;j<K;j++)for(var b in M=arguments[j])Object.prototype.hasOwnProperty.call(M,b)&&(Z[b]=M[b]);return Z},PZ.apply(this,arguments)};Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var HZ=j(52128),DZ=function(){function Z(){}return Z.ALPHA_DISABLE=0,Z.ALPHA_ADD=1,Z.ALPHA_COMBINE=2,Z.ALPHA_SUBTRACT=3,Z.ALPHA_MULTIPLY=4,Z.ALPHA_MAXIMIZED=5,Z.ALPHA_ONEONE=6,Z.ALPHA_PREMULTIPLIED=7,Z.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Z.ALPHA_INTERPOLATE=9,Z.ALPHA_SCREENMODE=10,Z.ALPHA_ONEONE_ONEONE=11,Z.ALPHA_ALPHATOCOLOR=12,Z.ALPHA_REVERSEONEMINUS=13,Z.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,Z.ALPHA_ONEONE_ONEZERO=15,Z.ALPHA_EXCLUSION=16,Z.ALPHA_LAYER_ACCUMULATE=17,Z.ALPHA_EQUATION_ADD=0,Z.ALPHA_EQUATION_SUBSTRACT=1,Z.ALPHA_EQUATION_REVERSE_SUBTRACT=2,Z.ALPHA_EQUATION_MAX=3,Z.ALPHA_EQUATION_MIN=4,Z.ALPHA_EQUATION_DARKEN=5,Z.DELAYLOADSTATE_NONE=0,Z.DELAYLOADSTATE_LOADED=1,Z.DELAYLOADSTATE_LOADING=2,Z.DELAYLOADSTATE_NOTLOADED=4,Z.NEVER=512,Z.ALWAYS=519,Z.LESS=513,Z.EQUAL=514,Z.LEQUAL=515,Z.GREATER=516,Z.GEQUAL=518,Z.NOTEQUAL=517,Z.KEEP=7680,Z.ZERO=0,Z.REPLACE=7681,Z.INCR=7682,Z.DECR=7683,Z.INVERT=5386,Z.INCR_WRAP=34055,Z.DECR_WRAP=34056,Z.TEXTURE_CLAMP_ADDRESSMODE=0,Z.TEXTURE_WRAP_ADDRESSMODE=1,Z.TEXTURE_MIRROR_ADDRESSMODE=2,Z.TEXTURE_CREATIONFLAG_STORAGE=1,Z.TEXTUREFORMAT_ALPHA=0,Z.TEXTUREFORMAT_LUMINANCE=1,Z.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Z.TEXTUREFORMAT_RGB=4,Z.TEXTUREFORMAT_RGBA=5,Z.TEXTUREFORMAT_RED=6,Z.TEXTUREFORMAT_R=6,Z.TEXTUREFORMAT_RG=7,Z.TEXTUREFORMAT_RED_INTEGER=8,Z.TEXTUREFORMAT_R_INTEGER=8,Z.TEXTUREFORMAT_RG_INTEGER=9,Z.TEXTUREFORMAT_RGB_INTEGER=10,Z.TEXTUREFORMAT_RGBA_INTEGER=11,Z.TEXTUREFORMAT_BGRA=12,Z.TEXTUREFORMAT_DEPTH24_STENCIL8=13,Z.TEXTUREFORMAT_DEPTH32_FLOAT=14,Z.TEXTUREFORMAT_DEPTH16=15,Z.TEXTUREFORMAT_DEPTH24=16,Z.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,Z.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,Z.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,Z.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,Z.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,Z.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,Z.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,Z.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,Z.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,Z.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,Z.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,Z.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,Z.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,Z.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,Z.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,Z.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,Z.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,Z.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,Z.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,Z.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,Z.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,Z.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,Z.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,Z.TEXTURETYPE_UNSIGNED_BYTE=0,Z.TEXTURETYPE_UNSIGNED_INT=0,Z.TEXTURETYPE_FLOAT=1,Z.TEXTURETYPE_HALF_FLOAT=2,Z.TEXTURETYPE_BYTE=3,Z.TEXTURETYPE_SHORT=4,Z.TEXTURETYPE_UNSIGNED_SHORT=5,Z.TEXTURETYPE_INT=6,Z.TEXTURETYPE_UNSIGNED_INTEGER=7,Z.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Z.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Z.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Z.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Z.TEXTURETYPE_UNSIGNED_INT_24_8=12,Z.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Z.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Z.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Z.TEXTURETYPE_UNDEFINED=16,Z.TEXTURE_NEAREST_SAMPLINGMODE=1,Z.TEXTURE_NEAREST_NEAREST=1,Z.TEXTURE_BILINEAR_SAMPLINGMODE=2,Z.TEXTURE_LINEAR_LINEAR=2,Z.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Z.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Z.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Z.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Z.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Z.TEXTURE_NEAREST_LINEAR=7,Z.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Z.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Z.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Z.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Z.TEXTURE_LINEAR_NEAREST=12,Z.TEXTURE_EXPLICIT_MODE=0,Z.TEXTURE_SPHERICAL_MODE=1,Z.TEXTURE_PLANAR_MODE=2,Z.TEXTURE_CUBIC_MODE=3,Z.TEXTURE_PROJECTION_MODE=4,Z.TEXTURE_SKYBOX_MODE=5,Z.TEXTURE_INVCUBIC_MODE=6,Z.TEXTURE_EQUIRECTANGULAR_MODE=7,Z.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Z.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Z.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,Z.TEXTURE_FILTERING_QUALITY_HIGH=64,Z.TEXTURE_FILTERING_QUALITY_MEDIUM=16,Z.TEXTURE_FILTERING_QUALITY_LOW=8,Z.SCALEMODE_FLOOR=1,Z.SCALEMODE_NEAREST=2,Z.SCALEMODE_CEILING=3,Z.MATERIAL_TextureDirtyFlag=1,Z.MATERIAL_LightDirtyFlag=2,Z.MATERIAL_FresnelDirtyFlag=4,Z.MATERIAL_AttributesDirtyFlag=8,Z.MATERIAL_MiscDirtyFlag=16,Z.MATERIAL_PrePassDirtyFlag=32,Z.MATERIAL_AllDirtyFlag=63,Z.MATERIAL_TriangleFillMode=0,Z.MATERIAL_WireFrameFillMode=1,Z.MATERIAL_PointFillMode=2,Z.MATERIAL_PointListDrawMode=3,Z.MATERIAL_LineListDrawMode=4,Z.MATERIAL_LineLoopDrawMode=5,Z.MATERIAL_LineStripDrawMode=6,Z.MATERIAL_TriangleStripDrawMode=7,Z.MATERIAL_TriangleFanDrawMode=8,Z.MATERIAL_ClockWiseSideOrientation=0,Z.MATERIAL_CounterClockWiseSideOrientation=1,Z.ACTION_NothingTrigger=0,Z.ACTION_OnPickTrigger=1,Z.ACTION_OnLeftPickTrigger=2,Z.ACTION_OnRightPickTrigger=3,Z.ACTION_OnCenterPickTrigger=4,Z.ACTION_OnPickDownTrigger=5,Z.ACTION_OnDoublePickTrigger=6,Z.ACTION_OnPickUpTrigger=7,Z.ACTION_OnPickOutTrigger=16,Z.ACTION_OnLongPressTrigger=8,Z.ACTION_OnPointerOverTrigger=9,Z.ACTION_OnPointerOutTrigger=10,Z.ACTION_OnEveryFrameTrigger=11,Z.ACTION_OnIntersectionEnterTrigger=12,Z.ACTION_OnIntersectionExitTrigger=13,Z.ACTION_OnKeyDownTrigger=14,Z.ACTION_OnKeyUpTrigger=15,Z.PARTICLES_BILLBOARDMODE_Y=2,Z.PARTICLES_BILLBOARDMODE_ALL=7,Z.PARTICLES_BILLBOARDMODE_STRETCHED=8,Z.MESHES_CULLINGSTRATEGY_STANDARD=0,Z.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Z.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Z.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Z.SCENELOADER_NO_LOGGING=0,Z.SCENELOADER_MINIMAL_LOGGING=1,Z.SCENELOADER_SUMMARY_LOGGING=2,Z.SCENELOADER_DETAILED_LOGGING=3,Z.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,Z.PREPASS_POSITION_TEXTURE_TYPE=1,Z.PREPASS_VELOCITY_TEXTURE_TYPE=2,Z.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,Z.PREPASS_COLOR_TEXTURE_TYPE=4,Z.PREPASS_DEPTH_TEXTURE_TYPE=5,Z.PREPASS_NORMAL_TEXTURE_TYPE=6,Z.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,Z.BUFFER_CREATIONFLAG_READ=1,Z.BUFFER_CREATIONFLAG_WRITE=2,Z.BUFFER_CREATIONFLAG_READWRITE=3,Z.BUFFER_CREATIONFLAG_UNIFORM=4,Z.BUFFER_CREATIONFLAG_VERTEX=8,Z.BUFFER_CREATIONFLAG_INDEX=16,Z.BUFFER_CREATIONFLAG_STORAGE=32,Z.RENDERPASS_MAIN=0,Z.INPUT_ALT_KEY=18,Z.INPUT_CTRL_KEY=17,Z.INPUT_META_KEY1=91,Z.INPUT_META_KEY2=92,Z.INPUT_META_KEY3=93,Z.INPUT_SHIFT_KEY=16,Z.SNAPSHOTRENDERING_STANDARD=0,Z.SNAPSHOTRENDERING_FAST=1,Z.PERSPECTIVE_CAMERA=0,Z.ORTHOGRAPHIC_CAMERA=1,Z.FOVMODE_VERTICAL_FIXED=0,Z.FOVMODE_HORIZONTAL_FIXED=1,Z.RIG_MODE_NONE=0,Z.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Z.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Z.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Z.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Z.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Z.RIG_MODE_VR=20,Z.RIG_MODE_WEBVR=21,Z.RIG_MODE_CUSTOM=22,Z.MAX_SUPPORTED_UV_SETS=6,Z.GL_ALPHA_EQUATION_ADD=32774,Z.GL_ALPHA_EQUATION_MIN=32775,Z.GL_ALPHA_EQUATION_MAX=32776,Z.GL_ALPHA_EQUATION_SUBTRACT=32778,Z.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,Z.GL_ALPHA_FUNCTION_SRC=768,Z.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,Z.GL_ALPHA_FUNCTION_SRC_ALPHA=770,Z.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,Z.GL_ALPHA_FUNCTION_DST_ALPHA=772,Z.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,Z.GL_ALPHA_FUNCTION_DST_COLOR=774,Z.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,Z.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,Z.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,Z.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,Z.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,Z.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,Z.SnippetUrl="https://snippet.babylonjs.com",Z}(),lZ=function(){function Z(M,j){var K=this;this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=PZ(PZ({},Z._GetDefaultOptions()),M),this._scene=j,this._scene._transmissionHelper=this,this.onErrorObservable=new E.b,this._scene.onDisposeObservable.addOnce((function(){K.dispose()})),this._parseScene(),this._setupRenderTargets()}return Z._GetDefaultOptions=function(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:DZ.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}},Z.prototype.updateOptions=function(Z){var M=this;if(Object.keys(Z).filter((function(j){return M._options[j]!==Z[j]})).length){var j=PZ(PZ({},this._options),Z),K=this._options;this._options=j,j.renderSize===K.renderSize&&j.renderTargetTextureType===K.renderTargetTextureType&&j.generateMipmaps===K.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=j.samples,this._opaqueRenderTarget.lodGenerationScale=j.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=j.lodGenerationOffset):this._setupRenderTargets()}},Z.prototype.getOpaqueTarget=function(){return this._opaqueRenderTarget},Z.prototype._shouldRenderAsTransmission=function(Z){return!!Z&&!!(Z instanceof k&&Z.subSurface.isRefractionEnabled)},Z.prototype._addMesh=function(Z){var M=this;this._materialObservers[Z.uniqueId]=Z.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),O.d.SetImmediate((function(){M._shouldRenderAsTransmission(Z.material)?(Z.material.refractionTexture=M._opaqueRenderTarget,M._transparentMeshesCache.push(Z)):M._opaqueMeshesCache.push(Z)}))},Z.prototype._removeMesh=function(Z){Z.onMaterialChangedObservable.remove(this._materialObservers[Z.uniqueId]),delete this._materialObservers[Z.uniqueId];var M=this._transparentMeshesCache.indexOf(Z);-1!==M&&this._transparentMeshesCache.splice(M,1),-1!==(M=this._opaqueMeshesCache.indexOf(Z))&&this._opaqueMeshesCache.splice(M,1)},Z.prototype._parseScene=function(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))},Z.prototype._onMeshMaterialChanged=function(Z){var M=this._transparentMeshesCache.indexOf(Z),j=this._opaqueMeshesCache.indexOf(Z);this._shouldRenderAsTransmission(Z.material)?(Z.material instanceof k&&(Z.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==j?(this._opaqueMeshesCache.splice(j,1),this._transparentMeshesCache.push(Z)):-1===M&&this._transparentMeshesCache.push(Z)):-1!==M?(this._transparentMeshesCache.splice(M,1),this._opaqueMeshesCache.push(Z)):-1===j&&this._opaqueMeshesCache.push(Z)},Z.prototype._setupRenderTargets=function(){var Z,M,j,K,b=this;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new HZ.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=null!==(M=null===(Z=this._options.clearColor)||void 0===Z?void 0:Z.clone())&&void 0!==M?M:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.onBeforeBindObservable.add((function(Z){K=b._scene.environmentIntensity,b._scene.environmentIntensity=1,j=b._scene.imageProcessingConfiguration.applyByPostProcess,b._options.clearColor?Z.clearColor.copyFrom(b._options.clearColor):b._scene.clearColor.toLinearSpaceToRef(Z.clearColor),b._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((function(){b._scene.environmentIntensity=K,b._scene.imageProcessingConfiguration._applyByPostProcess=j})),this._transparentMeshesCache.forEach((function(Z){b._shouldRenderAsTransmission(Z.material)&&(Z.material.refractionTexture=b._opaqueRenderTarget)}))},Z.prototype.dispose=function(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]},Z}(),tZ="KHR_materials_transmission",vZ=function(){function Z(Z){this.name=tZ,this.order=175,this._loader=Z,this.enabled=this._loader.isExtensionUsed(tZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=new Array;return O.push(K._loader.loadMaterialBasePropertiesAsync(Z,M,j)),O.push(K._loader.loadMaterialPropertiesAsync(Z,M,j)),O.push(K._loadTransparentPropertiesAsync(b,M,j,g)),Promise.all(O).then((function(){}))}))},Z.prototype._loadTransparentPropertiesAsync=function(Z,M,j,K){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));var b=j;if(b.subSurface.isRefractionEnabled=!0,b.subSurface.volumeIndexOfRefraction=1,b.subSurface.useAlbedoToTintRefraction=!0,void 0===K.transmissionFactor)return b.subSurface.refractionIntensity=0,b.subSurface.isRefractionEnabled=!1,Promise.resolve();b.subSurface.refractionIntensity=K.transmissionFactor;var g=b.getScene();return b.subSurface.refractionIntensity&&!g._transmissionHelper&&new lZ({},b.getScene()),b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=0,K.transmissionTexture?(K.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(Z,"/transmissionTexture"),K.transmissionTexture,void 0).then((function(Z){b.subSurface.refractionIntensityTexture=Z,b.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()},Z}();D.RegisterExtension(tZ,(function(Z){return new vZ(Z)}));var rZ="KHR_materials_translucency",LZ=function(){function Z(Z){this.name=rZ,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(rZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=new Array;return O.push(K._loader.loadMaterialBasePropertiesAsync(Z,M,j)),O.push(K._loader.loadMaterialPropertiesAsync(Z,M,j)),O.push(K._loadTranslucentPropertiesAsync(b,M,j,g)),Promise.all(O).then((function(){}))}))},Z.prototype._loadTranslucentPropertiesAsync=function(Z,M,j,K){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));var b=j;return b.subSurface.isTranslucencyEnabled=!0,b.subSurface.volumeIndexOfRefraction=1,b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=0,b.subSurface.useAlbedoToTintTranslucency=!0,void 0===K.translucencyFactor?(b.subSurface.translucencyIntensity=0,b.subSurface.isTranslucencyEnabled=!1,Promise.resolve()):(b.subSurface.translucencyIntensity=K.translucencyFactor,K.translucencyTexture?(K.translucencyTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(Z,"/translucencyTexture"),K.translucencyTexture).then((function(Z){b.subSurface.translucencyIntensityTexture=Z}))):Promise.resolve())},Z}();D.RegisterExtension(rZ,(function(Z){return new LZ(Z)}));var ZM="KHR_materials_volume",MM=function(){function Z(Z){this.name=ZM,this.order=173,this._loader=Z,this.enabled=this._loader.isExtensionUsed(ZM),this.enabled&&this._loader._disableInstancedMesh++}return Z.prototype.dispose=function(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=new Array;return O.push(K._loader.loadMaterialBasePropertiesAsync(Z,M,j)),O.push(K._loader.loadMaterialPropertiesAsync(Z,M,j)),O.push(K._loadVolumePropertiesAsync(b,M,j,g)),Promise.all(O).then((function(){}))}))},Z.prototype._loadVolumePropertiesAsync=function(Z,M,j,K){if(!(j instanceof k))throw new Error("".concat(Z,": Material type not supported"));if(!j.subSurface.isRefractionEnabled&&!j.subSurface.isTranslucencyEnabled||!K.thicknessFactor)return Promise.resolve();j.subSurface.volumeIndexOfRefraction=j.indexOfRefraction;var b=void 0!==K.attenuationDistance?K.attenuationDistance:Number.MAX_VALUE;return j.subSurface.tintColorAtDistance=b,void 0!==K.attenuationColor&&3==K.attenuationColor.length&&j.subSurface.tintColor.copyFromFloats(K.attenuationColor[0],K.attenuationColor[1],K.attenuationColor[2]),j.subSurface.minimumThickness=0,j.subSurface.maximumThickness=K.thicknessFactor,j.subSurface.useThicknessAsDepth=!0,K.thicknessTexture?(K.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(Z,"/thicknessTexture"),K.thicknessTexture).then((function(Z){j.subSurface.thicknessTexture=Z,j.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()},Z}();D.RegisterExtension(ZM,(function(Z){return new MM(Z)}));var jM="KHR_mesh_quantization",KM=function(){function Z(Z){this.name=jM,this.enabled=Z.isExtensionUsed(jM)}return Z.prototype.dispose=function(){},Z}();D.RegisterExtension(jM,(function(Z){return new KM(Z)}));var bM="KHR_texture_basisu",gM=function(){function Z(Z){this.name=bM,this._loader=Z,this.enabled=Z.isExtensionUsed(bM)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype._loadTextureAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){var O=void 0==M.sampler?D.DefaultSampler:P.Get("".concat(Z,"/sampler"),K._loader.gltf.samplers,M.sampler),Q=P.Get("".concat(b,"/source"),K._loader.gltf.images,g.source);return K._loader._createTextureAsync(Z,O,Q,(function(Z){j(Z)}),M._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!M._textureInfo.nonColorData)}))},Z}();D.RegisterExtension(bM,(function(Z){return new gM(Z)}));var OM="KHR_texture_transform",QM=function(){function Z(Z){this.name=OM,this._loader=Z,this.enabled=this._loader.isExtensionUsed(OM)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadTextureInfoAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(b,g){return K._loader.loadTextureInfoAsync(Z,M,(function(Z){if(!(Z instanceof x.b))throw new Error("".concat(b,": Texture type not supported"));g.offset&&(Z.uOffset=g.offset[0],Z.vOffset=g.offset[1]),Z.uRotationCenter=0,Z.vRotationCenter=0,g.rotation&&(Z.wAng=-g.rotation),g.scale&&(Z.uScale=g.scale[0],Z.vScale=g.scale[1]),void 0!=g.texCoord&&(Z.coordinatesIndex=g.texCoord),j(Z)}))}))},Z}();D.RegisterExtension(OM,(function(Z){return new QM(Z)}));var YM="KHR_xmp_json_ld",IM=function(){function Z(Z){this.name=YM,this.order=100,this._loader=Z,this.enabled=this._loader.isExtensionUsed(YM)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.onLoading=function(){var Z,M,j;if(null!==this._loader.rootBabylonMesh){var K=null===(Z=this._loader.gltf.extensions)||void 0===Z?void 0:Z.KHR_xmp_json_ld,b=null===(j=null===(M=this._loader.gltf.asset)||void 0===M?void 0:M.extensions)||void 0===j?void 0:j.KHR_xmp_json_ld;if(K&&b){var g=+b.packet;K.packets&&g<K.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=K.packets[g])}}},Z}();D.RegisterExtension(YM,(function(Z){return new IM(Z)}));var EM=function(){function Z(Z,M,j){this.frame=Z,this.action=M,this.onlyOnce=j,this.isDone=!1}return Z.prototype._clone=function(){return new Z(this.frame,this.action,this.onlyOnce)},Z}(),sM=j(90690),iM=j(50504),aM=function(){function Z(M,j,K,g,Q){void 0===g&&(g=null);var Y,I,i,a,z,V=this;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new E.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=b.k.Zero(),this._localDirection=new b.k(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=M,K=K||s.e.LastCreatedScene)if(this._scene=K,Z._SceneComponentInitialization(K),this._readyToPlayCallback=g,this._customAttenuationFunction=function(Z,M,j,K,b){return M<j?Z*(1-M/j):0},Q&&(this.autoplay=Q.autoplay||!1,this._loop=Q.loop||!1,void 0!==Q.volume&&(this._volume=Q.volume),this._spatialSound=null!==(Y=Q.spatialSound)&&void 0!==Y&&Y,this.maxDistance=null!==(I=Q.maxDistance)&&void 0!==I?I:100,this.useCustomAttenuation=null!==(i=Q.useCustomAttenuation)&&void 0!==i&&i,this.rolloffFactor=Q.rolloffFactor||1,this.refDistance=Q.refDistance||1,this.distanceModel=Q.distanceModel||"linear",this._playbackRate=Q.playbackRate||1,this._streaming=null!==(a=Q.streaming)&&void 0!==a&&a,this._length=Q.length,this._offset=Q.offset),(null===(z=sM.c.audioEngine)||void 0===z?void 0:z.canUseWebAudio)&&sM.c.audioEngine.audioContext){this._soundGain=sM.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);var o=!0;if(j)try{"string"===typeof j?this._urlType="String":j instanceof ArrayBuffer?this._urlType="ArrayBuffer":j instanceof HTMLMediaElement?this._urlType="MediaElement":j instanceof MediaStream?this._urlType="MediaStream":Array.isArray(j)&&(this._urlType="Array");var c=[],G=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=sM.c.audioEngine.audioContext.createMediaElementSource(j),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=sM.c.audioEngine.audioContext.createMediaStreamSource(j),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":j.byteLength>0&&(G=!0,this._soundLoaded(j));break;case"String":c.push(j);case"Array":0===c.length&&(c=j);for(var f=function(Z){var M=c[Z];if(G=Q&&Q.skipCodecCheck||-1!==M.indexOf(".mp3",M.length-4)&&sM.c.audioEngine.isMP3supported||-1!==M.indexOf(".ogg",M.length-4)&&sM.c.audioEngine.isOGGsupported||-1!==M.indexOf(".wav",M.length-4)||-1!==M.indexOf(".m4a",M.length-4)||-1!==M.indexOf(".mp4",M.length-4)||-1!==M.indexOf("blob:"))return X._streaming?(X._htmlAudioElement=new Audio(M),X._htmlAudioElement.controls=!1,X._htmlAudioElement.loop=X.loop,O.d.SetCorsBehavior(M,X._htmlAudioElement),X._htmlAudioElement.preload="auto",X._htmlAudioElement.addEventListener("canplaythrough",(function(){V._isReadyToPlay=!0,V.autoplay&&V.play(0,V._offset,V._length),V._readyToPlayCallback&&V._readyToPlayCallback()})),document.body.appendChild(X._htmlAudioElement),X._htmlAudioElement.load()):X._scene._loadFile(M,(function(Z){V._soundLoaded(Z)}),void 0,!0,!0,(function(Z){Z&&W.c.Error("XHR "+Z.status+" error on: "+M+"."),W.c.Error("Sound creation aborted."),V._scene.mainSoundTrack.removeSound(V)})),"break"},X=this,d=0;d<c.length;d++){if("break"===f(d))break}break;default:o=!1}o?G||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout((function(){V._readyToPlayCallback&&V._readyToPlayCallback()}),1e3)):W.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(Z){W.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),sM.c.audioEngine&&!sM.c.audioEngine.WarnedWebAudioUnsupported&&(W.c.Error("Web Audio is not supported by your browser."),sM.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout((function(){V._readyToPlayCallback&&V._readyToPlayCallback()}),1e3)}return Object.defineProperty(Z.prototype,"loop",{get:function(){return this._loop},set:function(Z){Z!==this._loop&&(this._loop=Z,this.updateOptions({loop:Z}))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"currentTime",{get:function(){var Z;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;var M=this._startOffset;return this.isPlaying&&(null===(Z=sM.c.audioEngine)||void 0===Z?void 0:Z.audioContext)&&(M+=sM.c.audioEngine.audioContext.currentTime-this._startTime),M},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"spatialSound",{get:function(){return this._spatialSound},set:function(Z){var M;this._spatialSound=Z,this._spatialSound&&(null===(M=sM.c.audioEngine)||void 0===M?void 0:M.canUseWebAudio)&&sM.c.audioEngine.audioContext&&this._createSpatialParameters()},enumerable:!1,configurable:!0}),Z.prototype.dispose=function(){var Z;(null===(Z=sM.c.audioEngine)||void 0===Z?void 0:Z.canUseWebAudio)&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},Z.prototype.isReady=function(){return this._isReadyToPlay},Z.prototype.getClassName=function(){return"Sound"},Z.prototype._soundLoaded=function(Z){var M,j=this;(null===(M=sM.c.audioEngine)||void 0===M?void 0:M.audioContext)&&sM.c.audioEngine.audioContext.decodeAudioData(Z,(function(Z){j._audioBuffer=Z,j._isReadyToPlay=!0,j.autoplay&&j.play(0,j._offset,j._length),j._readyToPlayCallback&&j._readyToPlayCallback()}),(function(Z){W.c.Error("Error while decoding audio data for: "+j.name+" / Error: "+Z)}))},Z.prototype.setAudioBuffer=function(Z){var M;(null===(M=sM.c.audioEngine)||void 0===M?void 0:M.canUseWebAudio)&&(this._audioBuffer=Z,this._isReadyToPlay=!0)},Z.prototype.updateOptions=function(Z){var M,j,K,b,g,O,Q,Y,I,E;Z&&(this.loop=null!==(M=Z.loop)&&void 0!==M?M:this.loop,this.maxDistance=null!==(j=Z.maxDistance)&&void 0!==j?j:this.maxDistance,this.useCustomAttenuation=null!==(K=Z.useCustomAttenuation)&&void 0!==K?K:this.useCustomAttenuation,this.rolloffFactor=null!==(b=Z.rolloffFactor)&&void 0!==b?b:this.rolloffFactor,this.refDistance=null!==(g=Z.refDistance)&&void 0!==g?g:this.refDistance,this.distanceModel=null!==(O=Z.distanceModel)&&void 0!==O?O:this.distanceModel,this._playbackRate=null!==(Q=Z.playbackRate)&&void 0!==Q?Q:this._playbackRate,this._length=null!==(Y=Z.length)&&void 0!==Y?Y:void 0,this._offset=null!==(I=Z.offset)&&void 0!==I?I:void 0,this.setVolume(null!==(E=Z.volume)&&void 0!==E?E:this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))},Z.prototype._createSpatialParameters=function(){var Z,M;(null===(Z=sM.c.audioEngine)||void 0===Z?void 0:Z.canUseWebAudio)&&sM.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=null!==(M=this._soundPanner)&&void 0!==M?M:sM.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))},Z.prototype._updateSpatialParameters=function(){this._spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},Z.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},Z.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},Z.prototype._switchPanningModel=function(){var Z;(null===(Z=sM.c.audioEngine)||void 0===Z?void 0:Z.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},Z.prototype.connectToSoundTrackAudioNode=function(Z){var M;(null===(M=sM.c.audioEngine)||void 0===M?void 0:M.canUseWebAudio)&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(Z),this._isOutputConnected=!0)},Z.prototype.setDirectionalCone=function(Z,M,j){M<Z?W.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=Z,this._coneOuterAngle=M,this._coneOuterGain=j,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))},Object.defineProperty(Z.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(Z){var M;if(Z!=this._coneInnerAngle){if(this._coneOuterAngle<Z)return void W.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z,(null===(M=sM.c.audioEngine)||void 0===M?void 0:M.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(Z){var M;if(Z!=this._coneOuterAngle){if(Z<this._coneInnerAngle)return void W.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z,(null===(M=sM.c.audioEngine)||void 0===M?void 0:M.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!1,configurable:!0}),Z.prototype.setPosition=function(Z){var M;Z.equals(this._position)||(this._position.copyFrom(Z),(null===(M=sM.c.audioEngine)||void 0===M?void 0:M.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))},Z.prototype.setLocalDirectionToMesh=function(Z){var M;this._localDirection=Z,(null===(M=sM.c.audioEngine)||void 0===M?void 0:M.canUseWebAudio)&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},Z.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var Z=this._connectedTransformNode.getWorldMatrix(),M=b.k.TransformNormal(this._localDirection,Z);M.normalize(),this._soundPanner.orientationX.value=M.x,this._soundPanner.orientationY.value=M.y,this._soundPanner.orientationZ.value=M.z}},Z.prototype.updateDistanceFromListener=function(){var Z;if((null===(Z=sM.c.audioEngine)||void 0===Z?void 0:Z.canUseWebAudio)&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var M=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,M,this.maxDistance,this.refDistance,this.rolloffFactor)}},Z.prototype.setAttenuationFunction=function(Z){this._customAttenuationFunction=Z},Z.prototype.play=function(Z,M,j){var K,b,g,O,Q=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&(null===(K=sM.c.audioEngine)||void 0===K?void 0:K.audioContext))try{this._startOffset<0&&(Z=-this._startOffset,this._startOffset=0);var Y=Z?(null===(b=sM.c.audioEngine)||void 0===b?void 0:b.audioContext.currentTime)+Z:null===(g=sM.c.audioEngine)||void 0===g?void 0:g.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(this._streamingSource||(this._streamingSource=sM.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){Q._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement){!function Z(){var M,j;if(null===(M=sM.c.audioEngine)||void 0===M?void 0:M.unlocked){var K=Q._htmlAudioElement.play();void 0!==K&&K.catch((function(){var M,j;null===(M=sM.c.audioEngine)||void 0===M||M.lock(),(Q.loop||Q.autoplay)&&(null===(j=sM.c.audioEngine)||void 0===j||j.onAudioUnlockedObservable.addOnce((function(){Z()})))}))}else(Q.loop||Q.autoplay)&&(null===(j=sM.c.audioEngine)||void 0===j||j.onAudioUnlockedObservable.addOnce((function(){Z()})))}()}}else{var I=function(){var K,b,g;if(null===(K=sM.c.audioEngine)||void 0===K?void 0:K.audioContext){if(j=j||Q._length,M=M||Q._offset,Q._soundSource){var O=Q._soundSource;O.onended=function(){O.disconnect()}}if(Q._soundSource=null===(b=sM.c.audioEngine)||void 0===b?void 0:b.audioContext.createBufferSource(),Q._soundSource&&Q._inputAudioNode){Q._soundSource.buffer=Q._audioBuffer,Q._soundSource.connect(Q._inputAudioNode),Q._soundSource.loop=Q.loop,void 0!==M&&(Q._soundSource.loopStart=M),void 0!==j&&(Q._soundSource.loopEnd=(0|M)+j),Q._soundSource.playbackRate.value=Q._playbackRate,Q._soundSource.onended=function(){Q._onended()},Y=Z?(null===(g=sM.c.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+Z:sM.c.audioEngine.audioContext.currentTime;var I=Q.isPaused?Q._startOffset%Q._soundSource.buffer.duration:M||0;Q._soundSource.start(Y,I,Q.loop?void 0:j)}}};"suspended"===(null===(O=sM.c.audioEngine)||void 0===O?void 0:O.audioContext.state)?setTimeout((function(){var Z;"suspended"===(null===(Z=sM.c.audioEngine)||void 0===Z?void 0:Z.audioContext.state)?(sM.c.audioEngine.lock(),(Q.loop||Q.autoplay)&&sM.c.audioEngine.onAudioUnlockedObservable.addOnce((function(){I()}))):I()}),500):I()}this._startTime=Y,this.isPlaying=!0,this.isPaused=!1}catch(Z){W.c.Error("Error while trying to play audio: "+this.name+", "+Z.message)}},Z.prototype._onended=function(){this.isPlaying=!1,this._startOffset=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},Z.prototype.stop=function(Z){var M,j=this;if(this.isPlaying)if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if((null===(M=sM.c.audioEngine)||void 0===M?void 0:M.audioContext)&&this._soundSource){var K=Z?sM.c.audioEngine.audioContext.currentTime+Z:void 0;this._soundSource.stop(K),void 0===K?(this.isPlaying=!1,this._soundSource.onended=function(){}):this._soundSource.onended=function(){j.isPlaying=!1},this.isPaused||(this._startOffset=0)}},Z.prototype.pause=function(){var Z;this.isPlaying&&(this.isPaused=!0,this._streaming?(this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect(),this.isPlaying=!1):(null===(Z=sM.c.audioEngine)||void 0===Z?void 0:Z.audioContext)&&(this.stop(0),this._startOffset+=sM.c.audioEngine.audioContext.currentTime-this._startTime))},Z.prototype.setVolume=function(Z,M){var j;(null===(j=sM.c.audioEngine)||void 0===j?void 0:j.canUseWebAudio)&&this._soundGain&&(M&&sM.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(sM.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,sM.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(Z,sM.c.audioEngine.audioContext.currentTime+M)):this._soundGain.gain.value=Z),this._volume=Z},Z.prototype.setPlaybackRate=function(Z){this._playbackRate=Z,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},Z.prototype.getVolume=function(){return this._volume},Z.prototype.attachToMesh=function(Z){var M=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=Z,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(Z){return M._onRegisterAfterWorldMatrixUpdate(Z)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},Z.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},Z.prototype._onRegisterAfterWorldMatrixUpdate=function(Z){var M;if(Z.getBoundingInfo){var j=Z.getBoundingInfo();this.setPosition(j.boundingSphere.centerWorld)}else this.setPosition(Z.absolutePosition);(null===(M=sM.c.audioEngine)||void 0===M?void 0:M.canUseWebAudio)&&this._isDirectional&&this.isPlaying&&this._updateDirection()},Z.prototype.clone=function(){var M=this;if(this._streaming)return null;var j={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},K=new Z(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,j);return this.useCustomAttenuation&&K.setAttenuationFunction(this._customAttenuationFunction),K.setPosition(this._position),K.setPlaybackRate(this._playbackRate),function Z(){M._isReadyToPlay?(K._audioBuffer=M.getAudioBuffer(),K._isReadyToPlay=!0,K.autoplay&&K.play(0,M._offset,M._length)):window.setTimeout(Z,300)}(),K},Z.prototype.getAudioBuffer=function(){return this._audioBuffer},Z.prototype.getSoundSource=function(){return this._soundSource},Z.prototype.getSoundGain=function(){return this._soundGain},Z.prototype.serialize=function(){var Z={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(Z.connectedMeshId=this._connectedTransformNode.id),Z.position=this._position.asArray(),Z.refDistance=this.refDistance,Z.distanceModel=this.distanceModel,Z.isDirectional=this._isDirectional,Z.localDirectionToMesh=this._localDirection.asArray(),Z.coneInnerAngle=this._coneInnerAngle,Z.coneOuterAngle=this._coneOuterAngle,Z.coneOuterGain=this._coneOuterGain),Z},Z.Parse=function(M,j,K,g){var O,Q=M.name;O=M.url?K+M.url:K+Q;var Y,I={autoplay:M.autoplay,loop:M.loop,volume:M.volume,spatialSound:M.spatialSound,maxDistance:M.maxDistance,rolloffFactor:M.rolloffFactor,refDistance:M.refDistance,distanceModel:M.distanceModel,playbackRate:M.playbackRate};if(g){Y=new Z(Q,new ArrayBuffer(0),j,null,I),function Z(){g._isReadyToPlay?(Y._audioBuffer=g.getAudioBuffer(),Y._isReadyToPlay=!0,Y.autoplay&&Y.play(0,Y._offset,Y._length)):window.setTimeout(Z,300)}()}else Y=new Z(Q,O,j,(function(){j._removePendingData(Y)}),I),j._addPendingData(Y);if(M.position){var E=b.k.FromArray(M.position);Y.setPosition(E)}if(M.isDirectional&&(Y.setDirectionalCone(M.coneInnerAngle||360,M.coneOuterAngle||360,M.coneOuterGain||0),M.localDirectionToMesh)){var s=b.k.FromArray(M.localDirectionToMesh);Y.setLocalDirectionToMesh(s)}if(M.connectedMeshId){var i=j.getMeshById(M.connectedMeshId);i&&Y.attachToMesh(i)}return M.metadata&&(Y.metadata=M.metadata),Y},Z._SceneComponentInitialization=function(Z){throw(0,iM.e)("AudioSceneComponent")},Z}(),zM=function(){function Z(Z,M,j){var K=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],M.length!==j.length)throw new Error("Sounds length does not equal weights length");this.loop=Z,this._weights=j;for(var b=0,g=0,O=j;g<O.length;g++){b+=O[g]}for(var Q=b>0?1/b:0,Y=0;Y<this._weights.length;Y++)this._weights[Y]*=Q;this._sounds=M;for(var I=0,E=this._sounds;I<E.length;I++){E[I].onEndedObservable.add((function(){K._onended()}))}}return Object.defineProperty(Z.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(Z){if(Z!==this._coneInnerAngle){if(this._coneOuterAngle<Z)return void W.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z;for(var M=0,j=this._sounds;M<j.length;M++){j[M].directionalConeInnerAngle=Z}}},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(Z){if(Z!==this._coneOuterAngle){if(Z<this._coneInnerAngle)return void W.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z;for(var M=0,j=this._sounds;M<j.length;M++){j[M].directionalConeOuterAngle=Z}}},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"volume",{get:function(){return this._volume},set:function(Z){if(Z!==this._volume)for(var M=0,j=this._sounds;M<j.length;M++){j[M].setVolume(Z)}},enumerable:!1,configurable:!0}),Z.prototype._onended=function(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},Z.prototype.pause=function(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()},Z.prototype.stop=function(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()},Z.prototype.play=function(Z){if(!this.isPaused){this.stop();for(var M=Math.random(),j=0,K=0;K<this._weights.length;K++)if(M<=(j+=this._weights[K])){this._currentIndex=K;break}}var b=this._sounds[this._currentIndex];b.isReady()?b.play(0,this.isPaused?void 0:Z):b.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},Z}(),VM="MSFT_audio_emitter",oM=function(){function Z(Z){this.name=VM,this._loader=Z,this.enabled=this._loader.isExtensionUsed(VM)}return Z.prototype.dispose=function(){this._loader=null,this._clips=null,this._emitters=null},Z.prototype.onLoading=function(){var Z=this._loader.gltf.extensions;if(Z&&Z[this.name]){var M=Z[this.name];this._clips=M.clips,this._emitters=M.emitters,P.Assign(this._clips),P.Assign(this._emitters)}},Z.prototype.loadSceneAsync=function(Z,M){var j=this;return D.LoadExtensionAsync(Z,M,this.name,(function(K,b){var g=new Array;g.push(j._loader.loadSceneAsync(Z,M));for(var O=0,Q=b.emitters;O<Q.length;O++){var Y=Q[O],I=P.Get("".concat(K,"/emitters"),j._emitters,Y);if(void 0!=I.refDistance||void 0!=I.maxDistance||void 0!=I.rolloffFactor||void 0!=I.distanceModel||void 0!=I.innerAngle||void 0!=I.outerAngle)throw new Error("".concat(K,": Direction or Distance properties are not allowed on emitters attached to a scene"));g.push(j._loadEmitterAsync("".concat(K,"/emitters/").concat(I.index),I))}return Promise.all(g).then((function(){}))}))},Z.prototype.loadNodeAsync=function(Z,M,j){var K=this;return D.LoadExtensionAsync(Z,M,this.name,(function(Z,g){var Q=new Array;return K._loader.loadNodeAsync(Z,M,(function(M){for(var Y=function(j){var g=P.Get("".concat(Z,"/emitters"),K._emitters,j);Q.push(K._loadEmitterAsync("".concat(Z,"/emitters/").concat(g.index),g).then((function(){for(var Z=0,j=g._babylonSounds;Z<j.length;Z++){var K=j[Z];K.attachToMesh(M),void 0==g.innerAngle&&void 0==g.outerAngle||(K.setLocalDirectionToMesh(b.k.Forward()),K.setDirectionalCone(2*O.d.ToDegrees(void 0==g.innerAngle?Math.PI:g.innerAngle),2*O.d.ToDegrees(void 0==g.outerAngle?Math.PI:g.outerAngle),0))}})))},I=0,E=g.emitters;I<E.length;I++){Y(E[I])}j(M)})).then((function(Z){return Promise.all(Q).then((function(){return Z}))}))}))},Z.prototype.loadAnimationAsync=function(Z,M){var j=this;return D.LoadExtensionAsync(Z,M,this.name,(function(K,b){return j._loader.loadAnimationAsync(Z,M).then((function(g){var O=new Array;P.Assign(b.events);for(var Q=0,Y=b.events;Q<Y.length;Q++){var I=Y[Q];O.push(j._loadAnimationEventAsync("".concat(K,"/events/").concat(I.index),Z,M,I,g))}return Promise.all(O).then((function(){return g}))}))}))},Z.prototype._loadClipAsync=function(Z,M){if(M._objectURL)return M._objectURL;var j;if(M.uri)j=this._loader.loadUriAsync(Z,M,M.uri);else{var K=P.Get("".concat(Z,"/bufferView"),this._loader.gltf.bufferViews,M.bufferView);j=this._loader.loadBufferViewAsync("/bufferViews/".concat(K.index),K)}return M._objectURL=j.then((function(Z){return URL.createObjectURL(new Blob([Z],{type:M.mimeType}))})),M._objectURL},Z.prototype._loadEmitterAsync=function(Z,M){var j=this;if(M._babylonSounds=M._babylonSounds||[],!M._babylonData){for(var K=new Array,b=M.name||"emitter".concat(M.index),g={loop:!1,autoplay:!1,volume:void 0==M.volume?1:M.volume},Q=function(Z){var O="/extensions/".concat(Y.name,"/clips"),Q=P.Get(O,Y._clips,M.clips[Z].clip);K.push(Y._loadClipAsync("".concat(O,"/").concat(M.clips[Z].clip),Q).then((function(K){var O=M._babylonSounds[Z]=new aM(b,K,j._loader.babylonScene,null,g);O.refDistance=M.refDistance||1,O.maxDistance=M.maxDistance||256,O.rolloffFactor=M.rolloffFactor||1,O.distanceModel=M.distanceModel||"exponential"})))},Y=this,I=0;I<M.clips.length;I++)Q(I);var E=Promise.all(K).then((function(){var Z=M.clips.map((function(Z){return Z.weight||1})),j=new zM(M.loop||!1,M._babylonSounds,Z);M.innerAngle&&(j.directionalConeInnerAngle=2*O.d.ToDegrees(M.innerAngle)),M.outerAngle&&(j.directionalConeOuterAngle=2*O.d.ToDegrees(M.outerAngle)),M.volume&&(j.volume=M.volume),M._babylonData.sound=j}));M._babylonData={loaded:E}}return M._babylonData.loaded},Z.prototype._getEventAction=function(Z,M,j,K,b){switch(j){case"play":return function(Z){var j=(b||0)+(Z-K);M.play(j)};case"stop":return function(){M.stop()};case"pause":return function(){M.pause()};default:throw new Error("".concat(Z,": Unsupported action ").concat(j))}},Z.prototype._loadAnimationEventAsync=function(Z,M,j,K,b){var g=this;if(0==b.targetedAnimations.length)return Promise.resolve();var O=b.targetedAnimations[0],Q=K.emitter,Y=P.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,Q);return this._loadEmitterAsync(Z,Y).then((function(){var M=Y._babylonData.sound;if(M){var j=new EM(K.time,g._getEventAction(Z,M,K.action,K.time,K.startOffset));O.animation.addEvent(j),b.onAnimationGroupEndObservable.add((function(){M.stop()})),b.onAnimationGroupPauseObservable.add((function(){M.pause()}))}}))},Z}();D.RegisterExtension(VM,(function(Z){return new oM(Z)}));var cM="MSFT_lod",GM=function(){function Z(Z){this.name=cM,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new E.b,this.onMaterialLODsLoadedObservable=new E.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=Z,this.enabled=this._loader.isExtensionUsed(cM)}return Z.prototype.dispose=function(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},Z.prototype.onReady=function(){for(var Z=this,M=function(M){var K=Promise.all(j._nodePromiseLODs[M]).then((function(){0!==M&&(Z._loader.endPerformanceCounter("Node LOD ".concat(M)),Z._loader.log("Loaded node LOD ".concat(M))),Z.onNodeLODsLoadedObservable.notifyObservers(M),M!==Z._nodePromiseLODs.length-1&&(Z._loader.startPerformanceCounter("Node LOD ".concat(M+1)),Z._loadBufferLOD(Z._nodeBufferLODs,M+1),Z._nodeSignalLODs[M]&&Z._nodeSignalLODs[M].resolve())}));j._loader._completePromises.push(K)},j=this,K=0;K<this._nodePromiseLODs.length;K++)M(K);var b=function(M){var j=Promise.all(g._materialPromiseLODs[M]).then((function(){0!==M&&(Z._loader.endPerformanceCounter("Material LOD ".concat(M)),Z._loader.log("Loaded material LOD ".concat(M))),Z.onMaterialLODsLoadedObservable.notifyObservers(M),M!==Z._materialPromiseLODs.length-1&&(Z._loader.startPerformanceCounter("Material LOD ".concat(M+1)),Z._loadBufferLOD(Z._materialBufferLODs,M+1),Z._materialSignalLODs[M]&&Z._materialSignalLODs[M].resolve())}));g._loader._completePromises.push(j)},g=this;for(K=0;K<this._materialPromiseLODs.length;K++)b(K)},Z.prototype.loadSceneAsync=function(Z,M){var j=this._loader.loadSceneAsync(Z,M);return this._loadBufferLOD(this._bufferLODs,0),j},Z.prototype.loadNodeAsync=function(Z,M,j){var b=this;return D.LoadExtensionAsync(Z,M,this.name,(function(Z,g){var O,Q=b._getLODs(Z,M,b._loader.gltf.nodes,g.ids);b._loader.logOpen("".concat(Z));for(var Y=function(Z){var M=Q[Z];0!==Z&&(b._nodeIndexLOD=Z,b._nodeSignalLODs[Z]=b._nodeSignalLODs[Z]||new K);var g=b._loader.loadNodeAsync("/nodes/".concat(M.index),M,(function(Z){j(Z),Z.setEnabled(!1)})).then((function(M){if(0!==Z){var j=Q[Z-1];j._babylonTransformNode&&(b._disposeTransformNode(j._babylonTransformNode),delete j._babylonTransformNode)}return M.setEnabled(!0),M}));b._nodePromiseLODs[Z]=b._nodePromiseLODs[Z]||[],0===Z?O=g:(b._nodeIndexLOD=null,b._nodePromiseLODs[Z].push(g))},I=0;I<Q.length;I++)Y(I);return b._loader.logClose(),O}))},Z.prototype._loadMaterialAsync=function(Z,M,j,K,b){var g=this;return this._nodeIndexLOD?null:D.LoadExtensionAsync(Z,M,this.name,(function(Z,O){var Q,Y=g._getLODs(Z,M,g._loader.gltf.materials,O.ids);g._loader.logOpen("".concat(Z));for(var I=function(Z){var M=Y[Z];0!==Z&&(g._materialIndexLOD=Z);var O=g._loader._loadMaterialAsync("/materials/".concat(M.index),M,j,K,(function(M){0===Z&&b(M)})).then((function(M){if(0!==Z){b(M);var j=Y[Z-1]._data;j[K]&&(g._disposeMaterials([j[K].babylonMaterial]),delete j[K])}return M}));g._materialPromiseLODs[Z]=g._materialPromiseLODs[Z]||[],0===Z?Q=O:(g._materialIndexLOD=null,g._materialPromiseLODs[Z].push(O))},E=0;E<Y.length;E++)I(E);return g._loader.logClose(),Q}))},Z.prototype._loadUriAsync=function(Z,M,j){var b=this;if(null!==this._nodeIndexLOD){this._loader.log("deferred");var g=this._nodeIndexLOD-1;return this._nodeSignalLODs[g]=this._nodeSignalLODs[g]||new K,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((function(){return b._loader.loadUriAsync(Z,M,j)}))}if(null!==this._materialIndexLOD){this._loader.log("deferred");g=this._materialIndexLOD-1;return this._materialSignalLODs[g]=this._materialSignalLODs[g]||new K,this._materialSignalLODs[g].promise.then((function(){return b._loader.loadUriAsync(Z,M,j)}))}return null},Z.prototype.loadBufferAsync=function(Z,M,j,b){if(this._loader.parent.useRangeRequests&&!M.uri){if(!this._loader.bin)throw new Error("".concat(Z,": Uri is missing or the binary glTF is missing its binary chunk"));var g=function(Z,M){var g=j,O=g+b-1,Q=Z[M];return Q?(Q.start=Math.min(Q.start,g),Q.end=Math.max(Q.end,O)):(Q={start:g,end:O,loaded:new K},Z[M]=Q),Q.loaded.promise.then((function(Z){return new Uint8Array(Z.buffer,Z.byteOffset+j-Q.start,b)}))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?g(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?g(this._materialBufferLODs,this._materialIndexLOD):g(this._bufferLODs,0)}return null},Z.prototype._loadBufferLOD=function(Z,M){var j=Z[M];j&&(this._loader.log("Loading buffer range [".concat(j.start,"-").concat(j.end,"]")),this._loader.bin.readAsync(j.start,j.end-j.start+1).then((function(Z){j.loaded.resolve(Z)}),(function(Z){j.loaded.reject(Z)})))},Z.prototype._getLODs=function(Z,M,j,K){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var b=new Array,g=K.length-1;g>=0;g--)if(b.push(P.Get("".concat(Z,"/ids/").concat(K[g]),j,K[g])),b.length===this.maxLODsToLoad)return b;return b.push(M),b},Z.prototype._disposeTransformNode=function(Z){var M=this,j=new Array,K=Z.material;K&&j.push(K);for(var b=0,g=Z.getChildMeshes();b<g.length;b++){var O=g[b];O.material&&j.push(O.material)}Z.dispose();var Q=j.filter((function(Z){return M._loader.babylonScene.meshes.every((function(M){return M.material!=Z}))}));this._disposeMaterials(Q)},Z.prototype._disposeMaterials=function(Z){for(var M={},j=0,K=Z;j<K.length;j++){for(var b=0,g=(E=K[j]).getActiveTextures();b<g.length;b++){var O=g[b];M[O.uniqueId]=O}E.dispose()}for(var Q in M)for(var Y=0,I=this._loader.babylonScene.materials;Y<I.length;Y++){var E;(E=I[Y]).hasTexture(M[Q])&&delete M[Q]}for(var Q in M)M[Q].dispose()},Z}();D.RegisterExtension(cM,(function(Z){return new GM(Z)}));var fM="MSFT_minecraftMesh",XM=function(){function Z(Z){this.name=fM,this._loader=Z,this.enabled=this._loader.isExtensionUsed(fM)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtraAsync(Z,M,this.name,(function(b,g){if(g){if(!(j instanceof k))throw new Error("".concat(b,": Material type not supported"));var O=K._loader.loadMaterialPropertiesAsync(Z,M,j);return j.needAlphaBlending()&&(j.forceDepthWrite=!0,j.separateCullingPass=!0),j.backFaceCulling=j.forceDepthWrite,j.twoSidedLighting=!0,O}return null}))},Z}();D.RegisterExtension(fM,(function(Z){return new XM(Z)}));var dM="MSFT_sRGBFactors",WM=function(){function Z(Z){this.name=dM,this._loader=Z,this.enabled=this._loader.isExtensionUsed(dM)}return Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadMaterialPropertiesAsync=function(Z,M,j){var K=this;return D.LoadExtraAsync(Z,M,this.name,(function(b,g){if(g){if(!(j instanceof k))throw new Error("".concat(b,": Material type not supported"));var O=K._loader.loadMaterialPropertiesAsync(Z,M,j);return j.albedoTexture||j.albedoColor.toLinearSpaceToRef(j.albedoColor),j.reflectivityTexture||j.reflectivityColor.toLinearSpaceToRef(j.reflectivityColor),O}return null}))},Z}();D.RegisterExtension(dM,(function(Z){return new WM(Z)}));var AM="ExtrasAsMetadata",qM=function(){function Z(Z){this.name=AM,this.enabled=!0,this._loader=Z}return Z.prototype._assignExtras=function(Z,M){if(M.extras&&Object.keys(M.extras).length>0){var j=Z.metadata=Z.metadata||{};(j.gltf=j.gltf||{}).extras=M.extras}},Z.prototype.dispose=function(){this._loader=null},Z.prototype.loadNodeAsync=function(Z,M,j){var K=this;return this._loader.loadNodeAsync(Z,M,(function(Z){K._assignExtras(Z,M),j(Z)}))},Z.prototype.loadCameraAsync=function(Z,M,j){var K=this;return this._loader.loadCameraAsync(Z,M,(function(Z){K._assignExtras(Z,M),j(Z)}))},Z.prototype.createMaterial=function(Z,M,j){var K=this._loader.createMaterial(Z,M,j);return this._assignExtras(K,M),K},Z}();D.RegisterExtension(AM,(function(Z){return new qM(Z)}))},47984:function(Z,M,j){"use strict";j.d(M,{c:function(){return A},e:function(){return b},f:function(){return K},j:function(){return g}});var K,b,g,O=j(9271),Q=j(9217),Y=j(67269),I=j(40061),E=j(60569),s=j(65847),i=j(9127),a=j(78588),z=function(Z){function M(){return null!==Z&&Z.apply(this,arguments)||this}return(0,I.m)(M,Z),M}(E.d),V=function(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]},o=function(Z){function M(M){var j=Z.call(this)||this;return j._wasAddedToScene=!1,(M=M||a.e.LastCreatedScene)?(j.scene=M,j.sounds=[],j.effectLayers=[],j.layers=[],j.lensFlareSystems=[],j.proceduralTextures=[],j.reflectionProbes=[],M.onDisposeObservable.add((function(){j._wasAddedToScene||j.dispose()})),j._onContextRestoredObserver=M.getEngine().onContextRestoredObservable.add((function(){for(var Z=0,M=j.geometries;Z<M.length;Z++){M[Z]._rebuild()}for(var K=0,b=j.meshes;K<b.length;K++){b[K]._rebuild()}for(var g=0,O=j.particleSystems;g<O.length;g++){O[g].rebuild()}for(var Q=0,Y=j.textures;Q<Y.length;Q++){Y[Q]._rebuild()}})),j):j}return(0,I.m)(M,Z),M.prototype.instantiateModelsToScene=function(Z,M,j){var K=this;void 0===M&&(M=!1);var b={},g={},O=new V,Q=[],Y=[];j||(j={doNotInstantiate:!0});var I=function(M,j){if(b[M.uniqueId]=j.uniqueId,g[j.uniqueId]=j,Z&&(j.name=Z(M.name)),j instanceof s.b){var K=j;if(K.morphTargetManager){var O=M.morphTargetManager;K.morphTargetManager=O.clone();for(var Q=0;Q<O.numTargets;Q++){var Y=O.getTarget(Q),I=K.morphTargetManager.getTarget(Q);b[Y.uniqueId]=I.uniqueId,g[I.uniqueId]=I}}}};return this.transformNodes.forEach((function(Z){if((!j||!j.predicate||j.predicate(Z))&&!Z.parent){var M=Z.instantiateHierarchy(null,j,(function(Z,M){I(Z,M)}));M&&O.rootNodes.push(M)}})),this.meshes.forEach((function(Q){if((!j||!j.predicate||j.predicate(Q))&&!Q.parent){var E=Q.instantiateHierarchy(null,j,(function(j,O){if(I(j,O),O.material){var Q=O;if(Q.material)if(M){var E=j.material;if(-1===Y.indexOf(E)){var s=E.clone(Z?Z(E.name):"Clone of "+E.name);if(Y.push(E),b[E.uniqueId]=s.uniqueId,g[s.uniqueId]=s,"MultiMaterial"===E.getClassName()){for(var i=E,a=0,z=i.subMaterials;a<z.length;a++){var V=z[a];V&&(s=V.clone(Z?Z(V.name):"Clone of "+V.name),Y.push(V),b[V.uniqueId]=s.uniqueId,g[s.uniqueId]=s)}i.subMaterials=i.subMaterials.map((function(Z){return Z&&g[b[Z.uniqueId]]}))}}"InstancedMesh"!==Q.getClassName()&&(Q.material=g[b[E.uniqueId]])}else"MultiMaterial"===Q.material.getClassName()?-1===K.scene.multiMaterials.indexOf(Q.material)&&K.scene.addMultiMaterial(Q.material):-1===K.scene.materials.indexOf(Q.material)&&K.scene.addMaterial(Q.material)}}));E&&O.rootNodes.push(E)}})),this.skeletons.forEach((function(M){if(!j||!j.predicate||j.predicate(M)){for(var Y=M.clone(Z?Z(M.name):"Clone of "+M.name),I=0,E=K.meshes;I<E.length;I++){var s=E[I];if(s.skeleton===M&&!s.isAnInstance){var i=g[b[s.uniqueId]];if(i.isAnInstance)continue;if(i.skeleton=Y,-1!==Q.indexOf(Y))continue;Q.push(Y);for(var a=0,z=Y.bones;a<z.length;a++){var V=z[a];V._linkedTransformNode&&(V._linkedTransformNode=g[b[V._linkedTransformNode.uniqueId]])}}}O.skeletons.push(Y)}})),this.animationGroups.forEach((function(M){if(!j||!j.predicate||j.predicate(M)){var K=M.clone(Z?Z(M.name):"Clone of "+M.name,(function(Z){return g[b[Z.uniqueId]]||Z}));O.animationGroups.push(K)}})),O},M.prototype.addAllToScene=function(){if(!this._wasAddedToScene){this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var Z=0,M=this.scene._serializableComponents;Z<M.length;Z++){M[Z].addFromContainer(this)}this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}},M.prototype.addToScene=function(Z){var M=this;void 0===Z&&(Z=null),this.cameras.forEach((function(j){Z&&!Z(j)||M.scene.addCamera(j)})),this.lights.forEach((function(j){Z&&!Z(j)||M.scene.addLight(j)})),this.meshes.forEach((function(j){Z&&!Z(j)||M.scene.addMesh(j)})),this.skeletons.forEach((function(j){Z&&!Z(j)||M.scene.addSkeleton(j)})),this.animations.forEach((function(j){Z&&!Z(j)||M.scene.addAnimation(j)})),this.animationGroups.forEach((function(j){Z&&!Z(j)||M.scene.addAnimationGroup(j)})),this.multiMaterials.forEach((function(j){Z&&!Z(j)||M.scene.addMultiMaterial(j)})),this.materials.forEach((function(j){Z&&!Z(j)||M.scene.addMaterial(j)})),this.morphTargetManagers.forEach((function(j){Z&&!Z(j)||M.scene.addMorphTargetManager(j)})),this.geometries.forEach((function(j){Z&&!Z(j)||M.scene.addGeometry(j)})),this.transformNodes.forEach((function(j){Z&&!Z(j)||M.scene.addTransformNode(j)})),this.actionManagers.forEach((function(j){Z&&!Z(j)||M.scene.addActionManager(j)})),this.textures.forEach((function(j){Z&&!Z(j)||M.scene.addTexture(j)})),this.reflectionProbes.forEach((function(j){Z&&!Z(j)||M.scene.addReflectionProbe(j)}))},M.prototype.removeAllFromScene=function(){this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var Z=0,M=this.scene._serializableComponents;Z<M.length;Z++){M[Z].removeFromContainer(this)}},M.prototype.removeFromScene=function(Z){var M=this;void 0===Z&&(Z=null),this.cameras.forEach((function(j){Z&&!Z(j)||M.scene.removeCamera(j)})),this.lights.forEach((function(j){Z&&!Z(j)||M.scene.removeLight(j)})),this.meshes.forEach((function(j){Z&&!Z(j)||M.scene.removeMesh(j)})),this.skeletons.forEach((function(j){Z&&!Z(j)||M.scene.removeSkeleton(j)})),this.animations.forEach((function(j){Z&&!Z(j)||M.scene.removeAnimation(j)})),this.animationGroups.forEach((function(j){Z&&!Z(j)||M.scene.removeAnimationGroup(j)})),this.multiMaterials.forEach((function(j){Z&&!Z(j)||M.scene.removeMultiMaterial(j)})),this.materials.forEach((function(j){Z&&!Z(j)||M.scene.removeMaterial(j)})),this.morphTargetManagers.forEach((function(j){Z&&!Z(j)||M.scene.removeMorphTargetManager(j)})),this.geometries.forEach((function(j){Z&&!Z(j)||M.scene.removeGeometry(j)})),this.transformNodes.forEach((function(j){Z&&!Z(j)||M.scene.removeTransformNode(j)})),this.actionManagers.forEach((function(j){Z&&!Z(j)||M.scene.removeActionManager(j)})),this.textures.forEach((function(j){Z&&!Z(j)||M.scene.removeTexture(j)})),this.reflectionProbes.forEach((function(j){Z&&!Z(j)||M.scene.removeReflectionProbe(j)}))},M.prototype.dispose=function(){this.cameras.slice(0).forEach((function(Z){Z.dispose()})),this.cameras=[],this.lights.slice(0).forEach((function(Z){Z.dispose()})),this.lights=[],this.meshes.slice(0).forEach((function(Z){Z.dispose()})),this.meshes=[],this.skeletons.slice(0).forEach((function(Z){Z.dispose()})),this.skeletons=[],this.animationGroups.slice(0).forEach((function(Z){Z.dispose()})),this.animationGroups=[],this.multiMaterials.slice(0).forEach((function(Z){Z.dispose()})),this.multiMaterials=[],this.materials.slice(0).forEach((function(Z){Z.dispose()})),this.materials=[],this.geometries.slice(0).forEach((function(Z){Z.dispose()})),this.geometries=[],this.transformNodes.slice(0).forEach((function(Z){Z.dispose()})),this.transformNodes=[],this.actionManagers.slice(0).forEach((function(Z){Z.dispose()})),this.actionManagers=[],this.textures.slice(0).forEach((function(Z){Z.dispose()})),this.textures=[],this.reflectionProbes.slice(0).forEach((function(Z){Z.dispose()})),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var Z=0,M=this.scene._serializableComponents;Z<M.length;Z++){M[Z].removeFromContainer(this,!0)}this._onContextRestoredObserver&&(this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)},M.prototype._moveAssets=function(Z,M,j){if(Z)for(var K=0,b=Z;K<b.length;K++){var g=b[K],O=!0;if(j)for(var Q=0,Y=j;Q<Y.length;Q++){if(g===Y[Q]){O=!1;break}}O&&(M.push(g),g._parentContainer=this)}},M.prototype.moveAllFromScene=function(Z){for(var M in this._wasAddedToScene=!1,void 0===Z&&(Z=new z),this)Object.prototype.hasOwnProperty.call(this,M)&&(this[M]=this[M]||("environmentTexture"===M?null:[]),this._moveAssets(this.scene[M],this[M],Z[M]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()},M.prototype.createRootMesh=function(){var Z=new s.b("assetContainerRootMesh",this.scene);return this.meshes.forEach((function(M){M.parent||Z.addChild(M)})),this.meshes.unshift(Z),Z},M.prototype.mergeAnimationsTo=function(Z,M,j){if(void 0===Z&&(Z=a.e.LastCreatedScene),void 0===j&&(j=null),!Z)return i.c.Error("No scene available to merge animations to"),[];var K=j||function(M){var j=null,K=M.animations.length?M.animations[0].targetProperty:"",b=M.name.split(".").join("").split("_primitive")[0];switch(K){case"position":case"rotationQuaternion":j=Z.getTransformNodeByName(M.name)||Z.getTransformNodeByName(b);break;case"influence":j=Z.getMorphTargetByName(M.name)||Z.getMorphTargetByName(b);break;default:j=Z.getNodeByName(M.name)||Z.getNodeByName(b)}return j};this.getNodes().forEach((function(Z){var M=K(Z);if(null!==M){for(var j=function(Z){for(var j=0,K=M.animations.filter((function(M){return M.targetProperty===Z.targetProperty}));j<K.length;j++){var b=K[j],g=M.animations.indexOf(b,0);g>-1&&M.animations.splice(g,1)}},b=0,g=Z.animations;b<g.length;b++){j(g[b])}M.animations=M.animations.concat(Z.animations)}}));var b=new Array;return this.animationGroups.slice().forEach((function(Z){b.push(Z.clone(Z.name,K)),Z.animatables.forEach((function(Z){Z.stop()}))})),M.forEach((function(M){var j=K(M.target);j&&(Z.beginAnimation(j,M.fromFrame,M.toFrame,M.loopAnimation,M.speedRatio,M.onAnimationEnd?M.onAnimationEnd:void 0,void 0,!0,void 0,M.onAnimationLoop?M.onAnimationLoop:void 0),Z.stopAnimation(M.target))})),b},M}(E.d),c=j(50459),G=function(){function Z(Z){this.byteOffset=0,this.buffer=Z}return Z.prototype.loadAsync=function(Z){var M=this;return this.buffer.readAsync(this.byteOffset,Z).then((function(Z){M._dataView=new DataView(Z.buffer,Z.byteOffset,Z.byteLength),M._dataByteOffset=0}))},Z.prototype.readUint32=function(){var Z=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,Z},Z.prototype.readUint8Array=function(Z){var M=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,Z);return this._dataByteOffset+=Z,this.byteOffset+=Z,M},Z.prototype.readString=function(Z){return(0,c.g)(this.readUint8Array(Z))},Z.prototype.skipBytes=function(Z){this._dataByteOffset+=Z,this.byteOffset+=Z},Z}(),f=j(36470),X=j(82790),d=j(33224);function W(Z,M,j){try{return Promise.resolve(new Uint8Array(Z,M,j))}catch(Z){return Promise.reject(Z)}}!function(Z){Z[Z.AUTO=0]="AUTO",Z[Z.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(K||(K={})),function(Z){Z[Z.NONE=0]="NONE",Z[Z.FIRST=1]="FIRST",Z[Z.ALL=2]="ALL"}(b||(b={})),function(Z){Z[Z.LOADING=0]="LOADING",Z[Z.READY=1]="READY",Z[Z.COMPLETE=2]="COMPLETE"}(g||(g={}));var A=function(){function Z(){this.onParsedObservable=new O.b,this.coordinateSystemMode=K.AUTO,this.animationStartMode=b.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.preprocessUrlAsync=function(Z){return Promise.resolve(Z)},this.onMeshLoadedObservable=new O.b,this.onSkinLoadedObservable=new O.b,this.onTextureLoadedObservable=new O.b,this.onMaterialLoadedObservable=new O.b,this.onCameraLoadedObservable=new O.b,this.onCompleteObservable=new O.b,this.onErrorObservable=new O.b,this.onDisposeObservable=new O.b,this.onExtensionLoadedObservable=new O.b,this.validate=!1,this.onValidatedObservable=new O.b,this._loader=null,this._state=null,this._requests=new Array,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this.onLoaderStateChangedObservable=new O.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(Z.prototype,"onParsed",{set:function(Z){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onMeshLoaded",{set:function(Z){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onTextureLoaded",{set:function(Z){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onMaterialLoaded",{set:function(Z){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onCameraLoaded",{set:function(Z){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onComplete",{set:function(Z){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onError",{set:function(Z){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onDispose",{set:function(Z){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onExtensionLoaded",{set:function(Z){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(Z)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(Z){this._loggingEnabled!==Z&&(this._loggingEnabled=Z,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(Z){this._capturePerformanceCounters!==Z&&(this._capturePerformanceCounters=Z,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"onValidated",{set:function(Z){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(Z)},enumerable:!1,configurable:!0}),Z.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var Z=0,M=this._requests;Z<M.length;Z++){M[Z].abort()}this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=function(Z){return Promise.resolve(Z)},this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},Z.prototype.loadFile=function(Z,M,j,K,b,g){var Y=this;this._progressCallback=K;var I=M.name?"file:":Q.d.GetFolderPath(M),E=M.name||Q.d.GetFilename(M);if(b){if(this.useRangeRequests){this.validate&&i.c.Warn("glTF validation is not supported when range requests are enabled");var s={abort:function(){},onCompleteObservable:new O.b},a={readAsync:function(j,K){return new Promise((function(b,g){Y._loadFile(Z,M,(function(Z){b(new Uint8Array(Z))}),!0,(function(Z){g(Z)}),(function(Z){Z.setRequestHeader("Range","bytes=".concat(j,"-").concat(j+K-1))}))}))},byteLength:0};return this._unpackBinaryAsync(new G(a)).then((function(Z){s.onCompleteObservable.notifyObservers(s),j(Z)}),g?function(Z){return g(void 0,Z)}:void 0),s}return this._loadFile(Z,M,(function(M){Y._validate(Z,M,I,E),Y._unpackBinaryAsync(new G({readAsync:function(Z,j){return W(M,Z,j)},byteLength:M.byteLength})).then((function(Z){j(Z)}),g?function(Z){return g(void 0,Z)}:void 0)}),!0,g)}return this._loadFile(Z,M,(function(M){Y._validate(Z,M,I,E),j({json:Y._parseJson(M)})}),b,g)},Z.prototype.importMeshAsync=function(Z,M,j,K,b,g){var O=this;return Promise.resolve().then((function(){return O.onParsedObservable.notifyObservers(j),O.onParsedObservable.clear(),O._log("Loading ".concat(g||"")),O._loader=O._getLoader(j),O._loader.importMeshAsync(Z,M,null,j,K,b,g)}))},Z.prototype.loadAsync=function(Z,M,j,K,b){var g=this;return Promise.resolve().then((function(){return g.onParsedObservable.notifyObservers(M),g.onParsedObservable.clear(),g._log("Loading ".concat(b||"")),g._loader=g._getLoader(M),g._loader.loadAsync(Z,M,j,K,b)}))},Z.prototype.loadAssetContainerAsync=function(Z,M,j,K,b){var g=this;return Promise.resolve().then((function(){g.onParsedObservable.notifyObservers(M),g.onParsedObservable.clear(),g._log("Loading ".concat(b||"")),g._loader=g._getLoader(M);var O=new o(Z),Q=[];g.onMaterialLoadedObservable.add((function(Z){Q.push(Z)}));var Y=[];g.onTextureLoadedObservable.add((function(Z){Y.push(Z)}));var I=[];return g.onCameraLoadedObservable.add((function(Z){I.push(Z)})),g._loader.importMeshAsync(null,Z,O,M,j,K,b).then((function(Z){return Array.prototype.push.apply(O.geometries,Z.geometries),Array.prototype.push.apply(O.meshes,Z.meshes),Array.prototype.push.apply(O.particleSystems,Z.particleSystems),Array.prototype.push.apply(O.skeletons,Z.skeletons),Array.prototype.push.apply(O.animationGroups,Z.animationGroups),Array.prototype.push.apply(O.materials,Q),Array.prototype.push.apply(O.textures,Y),Array.prototype.push.apply(O.lights,Z.lights),Array.prototype.push.apply(O.transformNodes,Z.transformNodes),Array.prototype.push.apply(O.cameras,I),O}))}))},Z.prototype.canDirectLoad=function(M){return-1!==M.indexOf("asset")&&-1!==M.indexOf("version")||M.startsWith("data:base64,"+Z._MagicBase64Encoded)||M.startsWith("data:;base64,"+Z._MagicBase64Encoded)||M.startsWith("data:application/octet-stream;base64,"+Z._MagicBase64Encoded)||M.startsWith("data:model/gltf-binary;base64,"+Z._MagicBase64Encoded)},Z.prototype.directLoad=function(M,j){if(j.startsWith("base64,"+Z._MagicBase64Encoded)||j.startsWith(";base64,"+Z._MagicBase64Encoded)||j.startsWith("application/octet-stream;base64,"+Z._MagicBase64Encoded)||j.startsWith("model/gltf-binary;base64,"+Z._MagicBase64Encoded)){var K=(0,X.b)(j);return this._validate(M,K),this._unpackBinaryAsync(new G({readAsync:function(Z,M){return W(K,Z,M)},byteLength:K.byteLength}))}return this._validate(M,j),Promise.resolve({json:this._parseJson(j)})},Z.prototype.createPlugin=function(){return new Z},Object.defineProperty(Z.prototype,"loaderState",{get:function(){return this._state},enumerable:!1,configurable:!0}),Z.prototype.whenCompleteAsync=function(){var Z=this;return new Promise((function(M,j){Z.onCompleteObservable.addOnce((function(){M()})),Z.onErrorObservable.addOnce((function(Z){j(Z)}))}))},Z.prototype._setState=function(Z){this._state!==Z&&(this._state=Z,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(g[this._state]))},Z.prototype._loadFile=function(Z,M,j,K,b,g){var O=this,Q=Z._loadFile(M,j,(function(Z){O._onProgress(Z,Q)}),!0,K,b,g);return Q.onCompleteObservable.add((function(Z){O._requests.splice(O._requests.indexOf(Z),1)})),this._requests.push(Q),Q},Z.prototype._onProgress=function(Z,M){if(this._progressCallback){M._lengthComputable=Z.lengthComputable,M._loaded=Z.loaded,M._total=Z.total;for(var j=!0,K=0,b=0,g=0,O=this._requests;g<O.length;g++){var Q=O[g];if(void 0===Q._lengthComputable||void 0===Q._loaded||void 0===Q._total)return;j=j&&Q._lengthComputable,K+=Q._loaded,b+=Q._total}this._progressCallback({lengthComputable:j,loaded:K,total:j?b:0})}},Z.prototype._validate=function(Z,M,j,K){var b=this;void 0===j&&(j=""),void 0===K&&(K=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),f.b.ValidateAsync(M,j,K,(function(M){return b.preprocessUrlAsync(j+M).then((function(M){return Z._loadFileAsync(M,void 0,!0,!0)}))})).then((function(Z){b._endPerformanceCounter("Validate JSON"),b.onValidatedObservable.notifyObservers(Z),b.onValidatedObservable.clear()}),(function(Z){b._endPerformanceCounter("Validate JSON"),Q.d.Warn("Failed to validate: ".concat(Z.message)),b.onValidatedObservable.clear()})))},Z.prototype._getLoader=function(M){var j=M.json.asset||{};this._log("Asset version: ".concat(j.version)),j.minVersion&&this._log("Asset minimum version: ".concat(j.minVersion)),j.generator&&this._log("Asset generator: ".concat(j.generator));var K=Z._parseVersion(j.version);if(!K)throw new Error("Invalid version: "+j.version);if(void 0!==j.minVersion){var b=Z._parseVersion(j.minVersion);if(!b)throw new Error("Invalid minimum version: "+j.minVersion);if(Z._compareVersion(b,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+j.minVersion)}var g={1:Z._CreateGLTF1Loader,2:Z._CreateGLTF2Loader}[K.major];if(!g)throw new Error("Unsupported version: "+j.version);return g(this)},Z.prototype._parseJson=function(Z){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(Z.length));var M=JSON.parse(Z);return this._endPerformanceCounter("Parse JSON"),M},Z.prototype._unpackBinaryAsync=function(Z){var M=this;return this._startPerformanceCounter("Unpack Binary"),Z.loadAsync(20).then((function(){var j=Z.readUint32();if(1179937895!==j)throw new d.i("Unexpected magic: "+j,d.g.GLTFLoaderUnexpectedMagicError);var K=Z.readUint32();M.loggingEnabled&&M._log("Binary version: ".concat(K));var b,g=Z.readUint32();if(0!==Z.buffer.byteLength&&g!==Z.buffer.byteLength)throw new Error("Length in header does not match actual data length: ".concat(g," != ").concat(Z.buffer.byteLength));switch(K){case 1:b=M._unpackBinaryV1Async(Z,g);break;case 2:b=M._unpackBinaryV2Async(Z,g);break;default:throw new Error("Unsupported version: "+K)}return M._endPerformanceCounter("Unpack Binary"),b}))},Z.prototype._unpackBinaryV1Async=function(Z,M){var j=Z.readUint32(),K=Z.readUint32();if(0!==K)throw new Error("Unexpected content format: ".concat(K));var b=M-Z.byteOffset,g={json:this._parseJson(Z.readString(j)),bin:null};if(0!==b){var O=Z.byteOffset;g.bin={readAsync:function(M,j){return Z.buffer.readAsync(O+M,j)},byteLength:b}}return Promise.resolve(g)},Z.prototype._unpackBinaryV2Async=function(Z,M){var j=this,K=1313821514,b=5130562,g=Z.readUint32();if(Z.readUint32()!==K)throw new Error("First chunk format is not JSON");return Z.byteOffset+g===M?Z.loadAsync(g).then((function(){return{json:j._parseJson(Z.readString(g)),bin:null}})):Z.loadAsync(g+8).then((function(){var O={json:j._parseJson(Z.readString(g)),bin:null};return function j(){var g=Z.readUint32();switch(Z.readUint32()){case K:throw new Error("Unexpected JSON chunk");case b:var Q=Z.byteOffset;O.bin={readAsync:function(M,j){return Z.buffer.readAsync(Q+M,j)},byteLength:g},Z.skipBytes(g);break;default:Z.skipBytes(g)}return Z.byteOffset!==M?Z.loadAsync(8).then(j):Promise.resolve(O)}()}))},Z._parseVersion=function(Z){if("1.0"===Z||"1.0.1"===Z)return{major:1,minor:0};var M=(Z+"").match(/^(\d+)\.(\d+)/);return M?{major:parseInt(M[1]),minor:parseInt(M[2])}:null},Z._compareVersion=function(Z,M){return Z.major>M.major?1:Z.major<M.major?-1:Z.minor>M.minor?1:Z.minor<M.minor?-1:0},Z.prototype._logOpen=function(Z){this._log(Z),this._logIndentLevel++},Z.prototype._logClose=function(){--this._logIndentLevel},Z.prototype._logEnabled=function(M){var j=Z._logSpaces.substr(0,2*this._logIndentLevel);i.c.Log("".concat(j).concat(M))},Z.prototype._logDisabled=function(Z){},Z.prototype._startPerformanceCounterEnabled=function(Z){Q.d.StartPerformanceCounter(Z)},Z.prototype._startPerformanceCounterDisabled=function(Z){},Z.prototype._endPerformanceCounterEnabled=function(Z){Q.d.EndPerformanceCounter(Z)},Z.prototype._endPerformanceCounterDisabled=function(Z){},Z.IncrementalLoading=!0,Z.HomogeneousCoordinates=!1,Z._MagicBase64Encoded="Z2xURg",Z._logSpaces="                                ",Z}();Y.d&&Y.d.RegisterPlugin(new A)},36470:function(Z,M,j){"use strict";j.d(M,{b:function(){return O}});var K=j(9217);function b(Z,M,j,K){var b={externalResourceFunction:function(Z){return K(Z).then((function(Z){return new Uint8Array(Z)}))}};return j&&(b.uri="file:"===M?j:M+j),Z instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(Z),b):GLTFValidator.validateString(Z,b)}function g(){var Z=[];onmessage=function(M){var j=M.data;switch(j.id){case"init":importScripts(j.url);break;case"validate":b(j.data,j.rootUrl,j.fileName,(function(M){return new Promise((function(j,K){var b=Z.length;Z.push({resolve:j,reject:K}),postMessage({id:"getExternalResource",index:b,uri:M})}))})).then((function(Z){postMessage({id:"validate.resolve",value:Z})}),(function(Z){postMessage({id:"validate.reject",reason:Z})}));break;case"getExternalResource.resolve":Z[j.index].resolve(j.value);break;case"getExternalResource.reject":Z[j.index].reject(j.reason)}}}var O=function(){function Z(){}return Z.ValidateAsync=function(Z,M,j,O){var Q=this;return"function"===typeof Worker?new Promise((function(K,Y){var I="".concat(b,"(").concat(g,")()"),E=URL.createObjectURL(new Blob([I],{type:"application/javascript"})),s=new Worker(E),i=function Z(M){s.removeEventListener("error",Z),s.removeEventListener("message",a),Y(M)},a=function Z(M){var j=M.data;switch(j.id){case"getExternalResource":O(j.uri).then((function(Z){s.postMessage({id:"getExternalResource.resolve",index:j.index,value:Z},[Z])}),(function(Z){s.postMessage({id:"getExternalResource.reject",index:j.index,reason:Z})}));break;case"validate.resolve":s.removeEventListener("error",i),s.removeEventListener("message",Z),K(j.value),s.terminate();break;case"validate.reject":s.removeEventListener("error",i),s.removeEventListener("message",Z),Y(j.reason),s.terminate()}};s.addEventListener("error",i),s.addEventListener("message",a),s.postMessage({id:"init",url:Q.Configuration.url}),s.postMessage({id:"validate",data:Z,rootUrl:M,fileName:j})})):(this._LoadScriptPromise||(this._LoadScriptPromise=K.d.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((function(){return b(Z,M,j,O)})))},Z.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"},Z}()},66285:function(Z,M,j){"use strict";j.d(M,{d:function(){return X}});var K=function(Z,M){return K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Z,M){Z.__proto__=M}||function(Z,M){for(var j in M)Object.prototype.hasOwnProperty.call(M,j)&&(Z[j]=M[j])},K(Z,M)};function b(Z,M){if("function"!==typeof M&&null!==M)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function j(){this.constructor=Z}K(Z,M),Z.prototype=null===M?Object.create(M):(j.prototype=M.prototype,new j)}function g(Z,M,j,K){var b,g=arguments.length,O=g<3?M:null===K?K=Object.getOwnPropertyDescriptor(M,j):K;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)O=Reflect.decorate(Z,M,j,K);else for(var Q=Z.length-1;Q>=0;Q--)(b=Z[Q])&&(O=(g<3?b(O):g>3?b(M,j,O):b(M,j))||O);return g>3&&O&&Object.defineProperty(M,j,O),O}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var O=j(9892),Q=j(80105),Y=j(4241),I=j(33048),E=j(29553),s=j(43251),i=j(37105),a=j(31709),z=j(16179),V=(j(76578),j(35850),j(84098),j(80345),"#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n");z.d.IncludesShadersStore.imageProcessingCompatibility=V;var o="precision highp float;\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;\nuniform vec3 cameraOffset;\nuniform vec3 up;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;\nconst float pi=3.141592653589793238462643383279502884197169;\nconst float n=1.0003;\nconst float N=2.545E25;\nconst float pn=0.035;\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\nconst vec3 K=vec3(0.686,0.678,0.666);\nconst float v=4.0;\nconst float rayleighZenithLength=8.4E3;\nconst float mieZenithLength=1.25E3;\nconst float EE=1000.0;\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle=pi/1.95;\nconst float steepness=1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005/vec3(94,40,18);\n}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\n}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{\nfloat c=(0.2*T )*10E-18;\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\n}\nfloat hgPhase(float cosTheta,float g)\n{\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\n}\nfloat A=0.15;\nfloat B=0.50;\nfloat C=0.10;\nfloat D=0.20;\nfloat EEE=0.02;\nfloat F=0.30;\nfloat W=1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\nvec3 sunDirection=normalize(sunPosition);\nfloat sunE=sunIntensity(dot(sunDirection,up));\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta=betaR*rPhase;\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\nvec3 betaMTheta=betaM*mPhase;\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\nvec3 direction=normalize(vPositionW-cameraPosition);\nfloat theta=acos(direction.y);\nfloat phi=atan(direction.z,direction.x);\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\nvec3 L0=vec3(0.1)*Fex;\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0+=(sunE*19000.0*Fex)*sundisk;\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor=(Lin+L0);\ntexColor*=0.04 ;\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance=1.0;\nfloat fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\nvec3 retColor=curr*whiteScale;\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";z.d.ShadersStore.skyPixelShader=o;j(49329),j(23654),j(61906),j(32560);var c="precision highp float;\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);\nvec4 worldPos=world*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";z.d.ShadersStore.skyVertexShader=c;var G=j(54497),f=function(Z){function M(){var M=Z.call(this)||this;return M.CLIPPLANE=!1,M.CLIPPLANE2=!1,M.CLIPPLANE3=!1,M.CLIPPLANE4=!1,M.CLIPPLANE5=!1,M.CLIPPLANE6=!1,M.POINTSIZE=!1,M.FOG=!1,M.VERTEXCOLOR=!1,M.VERTEXALPHA=!1,M.IMAGEPROCESSINGPOSTPROCESS=!1,M.SKIPFINALCOLORCLAMP=!1,M.rebuild(),M}return b(M,Z),M}(Y.c),X=function(Z){function M(M,j){var K=Z.call(this,M,j)||this;return K.luminance=1,K.turbidity=10,K.rayleigh=2,K.mieCoefficient=.005,K.mieDirectionalG=.8,K.distance=500,K.inclination=.49,K.azimuth=.25,K.sunPosition=new Q.k(0,100,0),K.useSunPosition=!1,K.cameraOffset=Q.k.Zero(),K.up=Q.k.Up(),K._cameraPosition=Q.k.Zero(),K._skyOrientation=new Q.d,K}return b(M,Z),M.prototype.needAlphaBlending=function(){return this.alpha<1},M.prototype.needAlphaTesting=function(){return!1},M.prototype.getAlphaTestTexture=function(){return null},M.prototype.isReadyForSubMesh=function(Z,M){if(this.isFrozen&&M.effect&&M.effect._wasPreviouslyReady)return!0;M.materialDefines||(M.materialDefines=new f);var j=M.materialDefines,K=this.getScene();if(this._isReadyForSubMesh(M))return!0;if(I.b.PrepareDefinesForMisc(Z,K,!1,this.pointsCloud,this.fogEnabled,!1,j),I.b.PrepareDefinesForAttributes(Z,j,!0,!1),j.IMAGEPROCESSINGPOSTPROCESS!==K.imageProcessingConfiguration.applyByPostProcess&&j.markAsMiscDirty(),j.isDirty){j.markAsProcessed(),K.resetCachedMaterial();var b=new G.b;j.FOG&&b.addFallback(1,"FOG"),j.IMAGEPROCESSINGPOSTPROCESS=K.imageProcessingConfiguration.applyByPostProcess;var g=[s.f.PositionKind];j.VERTEXCOLOR&&g.push(s.f.ColorKind);var O=j.toString();M.setEffect(K.getEngine().createEffect("sky",g,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"],[],O,b,this.onCompiled,this.onError),j,this._materialContext)}return!(!M.effect||!M.effect.isReady())&&(j._renderId=K.getRenderId(),M.effect._wasPreviouslyReady=!0,!0)},M.prototype.bindForSubMesh=function(Z,M,j){var K=this.getScene();if(j.materialDefines){var b=j.effect;if(b){this._activeEffect=b,this.bindOnlyWorldMatrix(Z),this._activeEffect.setMatrix("viewProjection",K.getTransformMatrix()),this._mustRebind(K,b)&&(I.b.BindClipPlane(this._activeEffect,K),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)),K.fogEnabled&&M.applyFog&&K.fogMode!==i.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",K.getViewMatrix()),I.b.BindFogParameters(K,M,this._activeEffect);var g=K.activeCamera;if(g){var O=g.getWorldMatrix();this._cameraPosition.x=O.m[12],this._cameraPosition.y=O.m[13],this._cameraPosition.z=O.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){var Y=Math.PI*(this.inclination-.5),E=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(E)*Math.cos(Y),this.sunPosition.y=this.distance*Math.sin(-Y),this.sunPosition.z=this.distance*Math.sin(E)*Math.cos(Y),Q.d.FromUnitVectorsToRef(Q.k.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(M,this._activeEffect)}}},M.prototype.getAnimatables=function(){return[]},M.prototype.dispose=function(M){Z.prototype.dispose.call(this,M)},M.prototype.clone=function(Z){var j=this;return O.b.Clone((function(){return new M(Z,j.getScene())}),this)},M.prototype.serialize=function(){var M=Z.prototype.serialize.call(this);return M.customType="BABYLON.SkyMaterial",M},M.prototype.getClassName=function(){return"SkyMaterial"},M.Parse=function(Z,j,K){return O.b.Parse((function(){return new M(Z.name,j)}),Z,j,K)},g([(0,O.z)()],M.prototype,"luminance",void 0),g([(0,O.z)()],M.prototype,"turbidity",void 0),g([(0,O.z)()],M.prototype,"rayleigh",void 0),g([(0,O.z)()],M.prototype,"mieCoefficient",void 0),g([(0,O.z)()],M.prototype,"mieDirectionalG",void 0),g([(0,O.z)()],M.prototype,"distance",void 0),g([(0,O.z)()],M.prototype,"inclination",void 0),g([(0,O.z)()],M.prototype,"azimuth",void 0),g([(0,O.x)()],M.prototype,"sunPosition",void 0),g([(0,O.z)()],M.prototype,"useSunPosition",void 0),g([(0,O.x)()],M.prototype,"cameraOffset",void 0),g([(0,O.x)()],M.prototype,"up",void 0),M}(E.e);(0,a.c)("BABYLON.SkyMaterial",X)},22494:function(Z,M,j){"use strict";function K(Z,M){M.headers=Z.headers||{},M.statusMessage=Z.statusText,M.statusCode=Z.status,M.data=Z.response}function b(Z,M,j){return new Promise((function(b,g){j=j||{};var O,Q,Y,I=new XMLHttpRequest,E=j.body,s=j.headers||{};for(O in j.timeout&&(I.timeout=j.timeout),I.ontimeout=I.onerror=function(Z){Z.timeout="timeout"==Z.type,g(Z)},I.open(Z,M.href||M),I.onload=function(){for(Y=I.getAllResponseHeaders().trim().split(/[\r\n]+/),K(I,I);Q=Y.shift();)Q=Q.split(": "),I.headers[Q.shift().toLowerCase()]=Q.join(": ");if((Q=I.headers["content-type"])&&~Q.indexOf("application/json"))try{I.data=JSON.parse(I.data,j.reviver)}catch(Z){return K(I,Z),g(Z)}(I.status>=400?g:b)(I)},typeof FormData<"u"&&E instanceof FormData||E&&"object"==typeof E&&(s["content-type"]="application/json",E=JSON.stringify(E)),I.withCredentials=!!j.withCredentials,s)I.setRequestHeader(O,s[O]);I.send(E)}))}j.r(M),j.d(M,{del:function(){return Y},get:function(){return g},patch:function(){return Q},post:function(){return O},put:function(){return I},send:function(){return b}});var g=b.bind(b,"GET"),O=b.bind(b,"POST"),Q=b.bind(b,"PATCH"),Y=b.bind(b,"DELETE"),I=b.bind(b,"PUT")},4088:function(Z,M,j){"use strict";Math.sqrt(3),Math.sqrt(3),Math.sqrt(5),Math.sqrt(5),new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0])}}]);